Option Strict Off
Option Explicit On
Imports FarPoint.Win.Spread
Imports FarPoint.Win
Imports System.Collections.Generic
Imports System.Threading

Friend Class frmNSK0000HA
    Inherits General.FormBase
    Public NSK0000H_sql As New clsNSK0000H_sql
    '=====================================================================================
    '   定  数  宣  言
    '=====================================================================================
    'ｽﾌﾟﾚｯﾄﾞ 列項目 定数
    Private Const M_HyojiNo_Col As Integer = 0 'Noの表示列
    Private Const M_StaffName_Col As Integer = 1 '職員氏名の表示列
    Private Const M_FrozenCol As Integer = 3 '左固定列数設定 
    Private Const M_FrozenHideCol As Integer = 0 '固定列の内隠しセルの列数
    Private Const M_EmpShrtNghtData_Col As Integer = 2 '採用・夜専・短時間列
    Private Const M_KinmuDataStart_Col As Integer = 3 '勤務ﾃﾞｰﾀの表示開始列 
    Private Const M_First_Col As Integer = 0 'ｽﾌﾟﾚｯﾄﾞ1列目
    'ｽﾌﾟﾚｯﾄﾞ 行項目 定数
    Private Const M_Interval_Row As Integer = 0 '計画期間の期間色表示行
    Private Const M_MonthLabel_Row As Integer = 1 '計画月/ﾀｰﾑ表示行
    Private Const M_DayLabel_Row As Integer = 2 '日付表示行
    Private Const M_WeekLabel_Row As Integer = 3 '曜日表示行
    Private Const M_YYYYMMDDLabel_Row As Integer = 4 '日付表示行(隠しｾﾙ)
    Private Const M_EVENTLABEL_ROW As Integer = 5 '行事予定
    Private Const M_FrozenRow As Integer = 6 '上固定行数設定 
    Private Const M_FrozenHideRow As Integer = 1 '固定行の内隠しセルの行数
    Private Const M_KinmuDataStart_Row As Integer = 6 '勤務ﾃﾞｰﾀの表示開始行
    Private Const M_First_Row As Integer = 0 'ｽﾌﾟﾚｯﾄﾞ1行目
    '職員情報項目 定数
    Private Const M_StaffData_MaxIndex As Integer = 10 '職員情報項目数
    Private Const M_StaffID As Integer = 1 '職員管理番号
    Private Const M_SaiyoYMD As Integer = 2 '採用年月日
    Private Const M_JobHyojiNo As Integer = 3 '職種表示No
    Private Const M_PostHyojiNo As Integer = 4 '役職表示No
    Private Const M_GiryoHyojiNo As Integer = 5 '技量表示No
    Private Const M_StaffHyojiNo As Integer = 6 '職員表示No
    Private Const M_Team As Integer = 7 'ﾁｰﾑ
    Private Const M_SyokuinNo As Integer = 8 '職員番号
    Private Const M_SortTeam As Integer = 9 'ソート用
    Private Const M_HairetuNo As Integer = 10 'ﾃﾞｰﾀ格納配列番号

    '隠しセルの幅、高さ（基本的にすべて０とするが、デバッグ等で必要なときは適当な値に設定する）
    Private Const M_HideCellWidth_StaffDataCol As Double = 0 '職員属性ﾃﾞｰﾀ
    Private Const M_HideCellWidth_KinmuDataCol As Double = 0 'ﾒｲﾝｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ表示部（集計含む）
    Private Const M_HideCellHeight_FullDateRow As Double = 0 '日付設定行
    Private Const M_HideCellHeight_TempAreaRow As Double = 0 'コピー、Undoｴﾘｱ
    Private Const M_HideCellHeight_TeamRow As Double = 0 'ﾁｰﾑ分け時の未選択ﾁｰﾑ（集計含む）
    Private Const M_HideCellHeight_PlanTwoRow As Double = 0 '実績変更で一段表示の時の計画行

    '----- ﾒﾆｭｰﾊﾞｰ番号 定義 --------------------------------------------------
    'ﾒﾆｭｰﾊﾞｰ配列のインデックスを表す定数
    '<< ﾒｲﾝﾒﾆｭｰ >>
    Private Const M_MenuFile As Integer = 0 'ﾌｧｲﾙ
    Private Const M_MenuEdit As Integer = 1 '編集
    Private Const M_MenuView As Integer = 2 '表示
    Private Const M_MenuJidou As Integer = 3 '自動割当
    Private Const M_MenuSet As Integer = 4 '設定
    Private Const M_MenuData As Integer = 5 'ﾃﾞｰﾀ
    Private Const M_MenuTool As Integer = 6 'ﾂｰﾙ
    Private Const M_MenuPopup As Integer = 7 'ﾎﾟｯﾌﾟｱｯﾌﾟ
    '[ﾌｧｲﾙ]メニュー配列のインデックスを表す定数
    Private Const M_MenuSave As Integer = 0 '保存
    Private Const M_MenuFile_Line1 As Integer = 1 '区切り線１
    Private Const M_MenuWrite As Integer = 2 '書き込み
    Private Const M_MenuLoad As Integer = 3 '読み込み
    Private Const M_MenuFile_Line2 As Integer = 4 '区切り線２
    Private Const M_MenuPrint As Integer = 5 '印刷
    Private Const M_MenuFile_Line3 As Integer = 6 '区切り線３
    Private Const M_MenuSaveCall As Integer = 7 '保存呼出 '2017/08/09 Angelo Add
    '2017/08/09 Angelo Upd st--------------------------------------
    'Private Const M_MenuKakutei As Integer = 7 '確定終了
    'Private Const M_MenuEnd As Integer = 8 '終了
    Private Const M_MenuKakutei As Integer = 8 '確定終了
    Private Const M_MenuEnd As Integer = 9 '終了
    '2017/08/09 Angelo Upd en--------------------------------------
    '[編集]メニュー配列のインデックスを表す定数
    Private Const M_MenuUndo As Integer = 0 '元に戻す
    Private Const M_MenuEdit_Line1 As Integer = 1 '区切り線１
    Private Const M_MenuCut As Integer = 2 '切り取り
    Private Const M_MenuCopy As Integer = 3 'コピー
    Private Const M_MenuPaste As Integer = 4 '貼り付け
    Private Const M_MenuDelete As Integer = 5 '削除
    Private Const M_MenuEdit_Line2 As Integer = 6 '区切り線２
    Private Const M_MenuKensaku As Integer = 7 '検索
    Private Const M_MenuChikan As Integer = 8 '置換
    Private Const M_MenuEdit_Line3 As Integer = 9 '区切り線３
    Private Const M_MenuAllClear As Integer = 10 '全ｸﾘｱ
    Private Const M_MenuAllClear_Normal As Integer = 13 '全ｸﾘｱ(通常) 
    Private Const M_MenuRedo As Integer = 14 'やり直し '2016/04/05 Ishiga add

    '[表示]メニュー配列のインデックスを表す定数
    Private Const M_MenuPalette As Integer = 0 'ﾊﾟﾚｯﾄ
    Private Const M_MenuView_Line1 As Integer = 1 '区切り線１
    Private Const M_MenuToolBar As Integer = 2 'ﾂｰﾙﾊﾞｰ
    Private Const M_MenuStatusBar As Integer = 3 'ｽﾃｰﾀｽﾊﾞｰ
    Private Const M_MenuView_Line2 As Integer = 4 '区切り線２
    Private Const M_MenuPersonalKinmu As Integer = 5 '個人別勤務登録
    Private Const M_MenuView_Line3 As Integer = 6 '区切り線３
    Private Const M_MenuShukei As Integer = 7 '集計の固定
    Private Const M_MenuView_Line4 As Integer = 8 '区切り線４
    Private Const M_MenuPlanTwo As Integer = 9 '勤務表示切替
    Private Const M_MenuFont As Integer = 10 'ﾌｫﾝﾄ
    Private Const M_MenuEmpRowDisp As Integer = 11 '採用列表示 
    '2014/06/20 Y.Doi P-06980 ADD START--------------------------
    Private Const M_MenuView_Line5 As Integer = 12 '区切り線５
    Private Const M_MenuTimeTable As Integer = 13  'ﾀｲﾑﾃｰﾌﾞﾙ
    '2014/06/20 Y.Doi P-06980 ADD END----------------------------
    '[表示]-[ﾌｫﾝﾄ]メニュー配列のインデックスを表す定数
    Private Const M_MenuFontBig As Integer = 0 '大
    Private Const M_MenuFontMiddle As Integer = 1 '中
    Private Const M_MenuFontSmall As Integer = 2 '小
    '[自動割当]メニュー配列のインデックスを表す定数
    Private Const M_MenuJidouRun As Integer = 0 '自動割当
    '[設定]メニュー配列のインデックスを表す定数
    Private Const M_MenuStaff As Integer = 0 '職員情報設定
    Private Const M_MenuRule As Integer = 1 'ﾙｰﾙ設定
    Private Const M_MenuSetKinmu As Integer = 2 'セット勤務
    '[ﾃﾞｰﾀ]メニュー配列のインデックスを表す定数
    Private Const M_MenuKikanSelect As Integer = 0 '計画期間選択（ｻﾌﾞﾒﾆｭｰあり Pgm内で動的に設定）
    Private Const M_MenuData_Line1 As Integer = 1 '区切り線１
    Private Const M_MenuSort As Integer = 2 '並び替え
    Private Const M_MenuTeamSelect As Integer = 3 'ﾁｰﾑ選択（ｻﾌﾞﾒﾆｭｰあり Pgm内で動的に設定）
    '[ﾂｰﾙ]メニュー配列のインデックスを表す定数
    Private Const M_MenuJidouCheck As Integer = 0 '自動ﾁｪｯｸ
    Private Const M_MenuReCheck As Integer = 1 '再ﾁｪｯｸ実行
    Private Const M_MenuTool_Line1 As Integer = 2 '区切り線１
    Private Const M_MenuCheck As Integer = 3 'ﾁｪｯｸ項目
    Private Const M_MenuKibouChk As Integer = 4 '希望勤務への入力警告
    Private Const M_MenuYouseiChk As Integer = 5 '要請勤務への入力警告
    Private Const M_MenuErrorAbsoluteKinmu As Integer = 6 '必須勤務の警告
    Private Const M_MenuErrorList As Integer = 7 'エラーリスト
    '[ﾂｰﾙ]-[ﾁｪｯｸ項目]メニュー配列のインデックスを表す定数
    Private Const M_MenuNinzuu As Integer = 0 '必要人数ﾁｪｯｸ
    Private Const M_MenuGiryoCheck As Integer = 1 '経験区分の組み合わせﾁｪｯｸ
    Private Const M_MenuKinmuCount As Integer = 2 '勤務/休み回数ﾁｪｯｸ
    Private Const M_MenuKinmuInterval As Integer = 3 '勤務/休み間隔ﾁｪｯｸ
    Private Const M_MenuRenzokuKinmuInterval As Integer = 4 '勤務/休み連続ﾁｪｯｸ
    Private Const M_MenuHolCount As Integer = 5 '休み回数ﾁｪｯｸ（勤務回数に統合）
    Private Const M_MenuHolInterval As Integer = 6 '休み間隔ﾁｪｯｸ（勤務間隔に統合）
    Private Const M_MenuKinmuPattern As Integer = 7 '禁止勤務ﾊﾟﾀｰﾝﾁｪｯｸ
    Private Const M_MenuKinsiKinmu As Integer = 8 '禁止勤務ﾁｪｯｸ
    Private Const M_MenuStaffPattern As Integer = 9 '禁止職員ﾊﾟﾀｰﾝﾁｪｯｸ
    Private Const M_MenuAbsoluteKinmu As Integer = 10 '必須勤務ﾁｪｯｸ

    '[ﾎﾟｯﾌﾟｱｯﾌﾟ]メニュー配列のインデックスを表す定数
    Private Const M_PopUndo As Integer = 0 '元に戻す
    Private Const M_Pop_Line1 As Integer = 1 '区切り線１
    Private Const M_PopCut As Integer = 2 '切り取り
    Private Const M_PopCopy As Integer = 3 'コピー
    Private Const M_PopPaste As Integer = 4 '貼り付け
    Private Const M_PopDelete As Integer = 5 '消去
    Private Const M_Pop_Line2 As Integer = 6 '区切り線２
    Private Const M_PopKensaku As Integer = 7 '検索
    Private Const M_PopChikan As Integer = 8 '置換
    Private Const M_Pop_Line3 As Integer = 9 '区切り線３
    Private Const M_PopAllClear As Integer = 10 '全消去
    Private Const M_Pop_Line4 As Integer = 11 '区切り線４
    Private Const M_InputJikanNenkyu As Integer = 12 '時間年休入力
    Private Const M_PopAllClear_Normal As Integer = 13 '全消去（通常） 
    Private Const M_PopRedo As Integer = 14 'やり直し '2016/04/05 Ishiga add

    'ﾂｰﾙﾊﾞｰのKey定数
    Private Const M_ToolBarKey_NormalEnd As String = "NormalEnd" '終了
    Private Const M_ToolBarKey_KakuteiEnd As String = "KakuteiEnd" '確定終了
    Private Const M_ToolBarKey_SaveCall As String = "SaveCall" '保存呼出 '2017/08/07 Angelo Add
    Private Const M_ToolBarKey_StaffEdit As String = "StaffEdit" '職員情報設定
    Private Const M_ToolBarKey_AutoAssign As String = "AutoAssign" '自動割当
    Private Const M_ToolBarKey_Palette As String = "Palette" 'パレット
    Private Const M_ToolBarKey_Search As String = "KinmuSerach" '検索
    Private Const M_ToolBarKey_Tikan As String = "KinmuTikan" '置換
    Private Const M_ToolBarKey_PlanTwo As String = "DispChange" '表示切替
    Private Const M_ToolBarKey_ErrorCheck As String = "ErrorCheck" 'エラーチェック
    Private Const M_ToolBarKey_ErrorList As String = "ErrorList" 'エラー一覧
    Private Const M_ToolBarKey_Gyouji As String = "Gyouji" '行事 
    '2014/06/03 Shimizu add start P-06980----
    Private Const M_ToolBarKey_TimeTable As String = "TimeTable" 'タイムテーブル
    '2014/06/03 Shimizu add end P-06980----
    'ｽﾃｰﾀｽﾊﾞｰﾊﾟﾈﾙのKey定数
    Private Const M_StatusBarKey_InformationText As String = "Messege" '情報文字列
    Private Const M_StatusBarKey_UserName As String = "UserName" '操作者名
    Private Const M_StatusBarKey_NowDate As String = "NowDate" 'システム日付
    Private Const M_StatusBarKey_NowTime As String = "NowTime" 'システム時刻（現在時刻）

    Private Const M_FourWeek_Color1 As Integer = 16744576
    Private Const M_FourWeek_Color2 As Integer = 16776960

    'ﾌｫﾝﾄｻｲｽﾞ定数
    Private Const M_FontSize_Big As Integer = 14.25 '「大」ﾌｫﾝﾄｻｲｽﾞ=14
    Private Const M_FontSize_Middle As Integer = 12 '「中」ﾌｫﾝﾄｻｲｽﾞ=12
    Private Const M_FontSize_Small As Integer = 9 '「小」ﾌｫﾝﾄｻｲｽﾞ=9
    '2014/04/23 Saijo add start P-06979--------------------------------------
    Private Const M_FontSize_Second_Big As Integer = 10 '「大」ﾌｫﾝﾄｻｲｽﾞ=10
    Private Const M_FontSize_Second_Middle As Integer = 9 '「中」ﾌｫﾝﾄｻｲｽﾞ=9
    Private Const M_FontSize_Second_Small As Integer = 7 '「小」ﾌｫﾝﾄｻｲｽﾞ=7
    '2014/04/23 Saijo add end P-06979----------------------------------------

    '2017/09/08 Angelo del st----------------------------------------------
    ''ﾃﾞｰﾀﾀｲﾌﾟ
    'Private Const M_PLANDATA As String = "0" '計画ﾃﾞｰﾀ
    'Private Const M_JISSEKIDATA As String = "1" '実績ﾃﾞｰﾀ
    '2017/09/08 Angelo del en----------------------------------------------
    '確定部署
    Private Const M_GAITOBUSHO As String = "0" '該当部署
    Private Const M_TABUSHO As String = "1" '他部署
    'データ存在有無
    Private Const M_DATA_OK As String = "1" 'DBにﾃﾞｰﾀあり
    Private Const M_DATA_None As String = "0" 'DBにﾃﾞｰﾀなし
    'ﾃﾞｰﾀ操作の有無
    Private Const M_DataFlg_Insert As String = "1" 'ﾃﾞｰﾀ追加
    Private Const M_DataFlg_Update As String = "2" 'ﾃﾞｰﾀUpdate
    Private Const M_DataFlg_Delete As String = "3" 'ﾃﾞｰﾀ削除

    'ﾃｷｽﾄﾌｧｲﾙ保存時のﾍｯﾀﾞｰ文字列（この文字列で読み込み時に計画ファイルか判断する）
    Private Const M_TextFileHeader_NsAidKey As String = "NSK0000H SAVE File   "

    '----個別勤務計画作成画面のｽﾌﾟﾚｯﾄﾞ用-----------
    'ﾌｫｰﾑの高さ
    Private Const M_FORMHEIGHT As Integer = 5000
    '行ﾀｲﾄﾙ(先頭日) 開始ｾﾙ 位置
    Private Const M_RowTitle_Row As Integer = 0
    Private Const M_RowTitle_Col As Integer = 1
    '列ﾀｲﾄﾙ(氏名 等) 開始ｾﾙ 位置
    Private Const M_ColTitle_Row As Integer = 3
    Private Const M_ColTitle_Col As Integer = 0
    '勤務記号ﾃﾞｰﾀ 開始ｾﾙ 位置
    Private Const M_KinmuData_Row As Integer = 3
    Private Const M_KinmuData_Col As Integer = 2
    'ﾌｫﾝﾄ配列のインデックスを表す定数
    Private Const M_Font_Big As Integer = 0 '大
    Private Const M_Font_Middle As Integer = 1 '中
    Private Const M_Font_Small As Integer = 2 '小
    'ﾊﾟﾚｯﾄ勤務最大表示数
    Private Const M_PARET_NUM As Integer = 20

    '代休チェック時イベント定数
    Private Const M_PASTE As String = "1"
    Private Const M_DELETE As String = "2"
    Private Const M_CUT As String = "3"
    Private Const M_CHANGE As String = "4"
    Private Const M_ALLCHANGE_DEL As String = "5"
    Private Const M_ALL_CHK As String = "6"
    Private Const M_ALLDELETE As String = "7"
    Private Const M_SET As String = "8"

    Private Const M_AJUSTDAIKYUCOLOR As Integer = 729309

    Private Const M_SKILLBUNRUICD_1 As String = "1"
    Private Const M_SKILLBUNRUICD_2 As String = "2"
    Private Const M_SKILLBUNRUICD_3 As String = "3"
    Private Const M_SKILLBUNRUICD_4 As String = "4"

    Private Const M_GYOJIMAXLETTER As Integer = 10 '行事最大文字数
    '=====================================================================================
    '   変  数  宣  言
    '=====================================================================================
    '起動元画面からの受け取りデータ（レジストリ経由）
    Private m_PlanNo As Integer '計画番号
    Private m_PgmFlg As String '画面起動ﾓｰﾄﾞ
    Private m_strAccessModule As String '起動元画面ID
    '2017/11/08 Angelo add st---------------------------------------------------
    Private m_blnSaveCallApplyFLG As Boolean 'True:適用ボタン押下時処理を実行しますのとき
    Private m_intSelSaveNo As Short = 0 '保存番号
    Private m_intNextFormSaveNo As Short '次の画面のコマンドラインで使う保存番号
    Private m_ProgressForm As frmNSK0000HM
    '2017/11/08 Angelo add en---------------------------------------------------


    'ｵﾌﾞｼﾞｪｸﾄ　変数
    Private WithEvents m_PaletteForm As frmNSK0000HB 'パレット画面
    Private WithEvents m_KensakuForm As frmNSK0000HD '検索画面
    Private WithEvents m_ChikanForm As frmNSK0000HD '置換画面
    Private WithEvents m_SortForm As frmNSK0000HG '並び替え画面
    Private WithEvents m_EventForm As frmNSK0000HO '行事一覧画面 

    '病院情報、看護単位情報
    Private m_SystemStartDay As Integer 'ｼｽﾃﾑ開始日
    Private m_PlanType As BasNSK0000H.gePlanType '計画単位
    Private m_ViewFromTo As BasNSK0000H.geViewType '表示期間
    Private m_TeamCnt As Integer 'ﾁｰﾑ数
    Private m_OuenTeam As Integer '応援勤務者用チーム
    Private m_ByotoKBN As String '部署区分
    Private m_PackageFLG As Integer 'パッケージマスタ(0:届出×日当直×,1:届出×日当直○,2:届出○日当直×,3:届出○日当直○)
    Private m_MaxShowLine As Integer '最大表示段数

    'ｽﾌﾟﾚｯﾄﾞ用変数
    Private m_Spread() As FpSpread 'ｽﾌﾟﾚｯﾄﾞｼｰﾄ名(1：1ｹ月/1ｹ月,4週/4週用ｽﾌﾟﾚｯﾄﾞ名 ,2：4週/1ｹ月用ｽﾌﾟﾚｯﾄﾞ名)
    Private m_DayStr As String '日付検索用文字列(1か月/1ｹ月, 4週/1ｹ月)
    Private m_DayStr2 As String '日付検索用文字列(4週/1ｹ月)

    '表示ﾌｫﾝﾄｻｲｽﾞでのｾﾙの幅/高さ
    Private m_CellHeight As Double '高さ
    Private m_CellWidth As Double '幅
    Private m_TotalWidth As Double '集計用幅
    Private m_TotalWidth_Kotei As Double '集計（時間・累計用）
    Private m_TotalWidth_Yakan As Double '集計夜間看護加算モード時の時間

    'ｴﾗｰ ｾﾙ色番号 格納変数
    Private m_Error_Name_ForeColor As Integer '日付欄
    Private m_Error_Name_BackColor As Integer '職員名欄
    Private m_Error_Col_ForeColor As Integer '日付欄
    Private m_Error_Col_BackColor As Integer '職員名欄
    Private m_Error_Row_ForeColor As Integer '日付欄
    Private m_Error_Row_BackColor As Integer '職員名欄
    Private m_Error_Col_ForeColor2 As Integer '日付欄
    Private m_Error_Col_BackColor2 As Integer '職員名欄
    '技量分類によるｾﾙ色番号
    Private m_NoAssign_Fore As Integer '割当非対象者 文字色
    Private m_NoAssign_Back As Integer '割当非対象者 背景色
    Private m_Leader_Fore As Integer 'ﾘｰﾀﾞｰ 文字色
    Private m_Leader_Back As Integer 'ﾘｰﾀﾞｰ 背景色
    Private m_SubLeader_Fore As Integer 'ｻﾌﾞﾘｰﾀﾞｰ 文字色
    Private m_SubLeader_Back As Integer 'ｻﾌﾞﾘｰﾀﾞｰ 背景色
    Private m_Staff_Fore As Integer 'ｽﾀｯﾌ 文字色
    Private m_Staff_Back As Integer 'ｽﾀｯﾌ 背景色
    Private m_NewFace_Fore As Integer '新人 文字色
    Private m_NewFace_Back As Integer '新人 背景色
    Private m_Ouen_Name_Back As Integer '応援勤務者氏名欄背景色
    Private m_Ouen_Name_Fore As Integer '応援勤務者氏名欄文字色
    Private m_UseOutputFlg As Boolean = False
    Private m_Pointer_Back As Integer 'ﾎﾟｲﾝﾀ位置表示  背景色

    '勤務分類による色番号
    Private m_Yousei_Fore As Integer '要請勤務　文字色
    Private m_Yousei_Back As Integer '要請勤務　背景色
    Private m_Kibou_Fore As Integer '希望勤務　文字色
    Private m_Kibou_Back As Integer '希望勤務　背景色
    '2015/07/21 Bando Add Start =============================
    Private m_KibouCom_Fore As Integer '希望勤務コメント有　文字色
    Private m_KibouCom_Back As Integer '希望勤務コメント有　背景色
    '2015/07/21 Bando Add End   =============================
    Private m_Saikei_Fore As Integer '再掲勤務  文字色
    Private m_Saikei_Back As Integer '再掲勤務  背景色
    Private m_Iin_Fore As Integer '委員会 　 文字色
    Private m_Iin_Back As Integer '委員会　  背景色
    Private m_Ouen_Fore As Integer '応援勤務　文字色
    Private m_Ouen_Back As Integer '応援勤務  背景色
    Private m_Daikyu_Fore As Integer '代休発生勤務　文字色
    Private m_Daikyu_Back As Integer '代休発生勤務　背景色
    Private m_Appli_Fore As Integer '届出勤務　文字色
    Private m_Appli_Back As Integer '届出勤務　背景色
    Private m_Comp_Fore As Integer '予定⇒実績変更勤務  文字色
    Private m_WeekEnd_Back As Integer
    '勤務入力不可能（前月実績・部署異動）
    Private m_MonthBefore_Fore As Integer '文字色
    Private m_MonthBefore_Back As Integer '背景色
    '他部署確定データ
    Private m_Tabusho_Fore As Integer '文字色
    '計画期間外の4週部分
    Private m_Jisseki4W_Fore As Integer '文字色
    Private m_Jisseki4W_Back As Integer '背景色
    '時間年休入力ﾃﾞｰﾀ
    Private m_KinmuTime_Fore As Integer '文字色
    Private m_KinmuTime_Back As Integer '背景色
    '2015/07/22 Bando Add Start ===========================
    '控除入力ﾃﾞｰﾀ
    Private m_Kojo_Fore As Integer '文字色
    Private m_Kojo_Back As Integer '背景色
    '2015/07/22 Bando Add End   ===========================

    Private m_BtnClickFlg As Boolean 'True:消しｺﾞﾑﾎﾞﾀﾝ Or 勤務ﾎﾞﾀﾝがｸﾘｯｸされているとき,False:ｸﾘｯｸされていないとき
    '現在選択 勤務記号
    Private m_SelNowKinmuCD As String 'KinmuCD
    Private m_SelNowRiyuKbn As String '理由区分
    '職員情報設定ﾁｪｯｸ
    Private m_DefStaffFlg As Boolean 'True:職員情報がﾃﾞﾌｫﾙﾄ値のとき
    Private m_SetStaffFlg As Boolean 'True:職員情報設定を行ったとき

    Private m_EndFlg As Integer '終了ﾒﾆｭｰ

    '代休取得関連変数
    Private m_DaikyuMsgFlg As Integer '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
    Private m_SundayDaikyuFlg As Integer '代休取得可能日に日曜日を含めるか(0:含めない,1:含める)
    Private m_DaikyuAdvFlg As Integer '代休の先取りを可能にするか(0:しない,1:する)
    Private m_DaikyuSumBasiDate As Integer '代休集計基準日（0：月初、1：月末、以外：月初）
    Private m_SaturdayDaikyuFlg As Integer '代休取得可能日に土曜日を含めるか(0:含めない,1:含める)
    Private m_DaikyuAdvThisMonthFlg As Integer '代休先取り当月制限フラグ(0:OFF,1:ON)
    Private m_YakanKangoDispFlg As Integer '夜勤時間計算結果を表示するか(1:しない,0:する)
    Private m_OuenKinmuCalcFlg As Integer '応援勤務者を夜勤時間等の計算に含めるか(0:含めない,1:含める)
    Private m_LastMonthDays As Integer '4週表示で最後の日(翌月の日数)
    Private m_SelectDate As Long         '自動割当開始日
    '2016/04/21 Yamanishi Add ------------------------------------------------------------------
    Private m_Youshiki9_H28_Flg As Integer '様式９はH28年度版以降か(1:はい,0:いいえ)
    Private m_DefaltTodokedeKbn As Integer '届出区分のデフォルト(H28年度版以降の場合:7 他:0)
    Private m_NotCalcTotalNightKojyoCD As String '夜勤総時間を減算しない控除ＣＤ
    '-------------------------------------------------------------------------------------------

    '応援者の総夜勤時間をフルで出力するフラグ(0:出力しない,1：出力する)
    Private m_OuenTotalNightFullFlg As Integer  '追加仕様：応援者・月中異動者の総夜勤を全部出す
    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
    Private Enum gKinmuTimeMCol As Integer
        WorkTimeNum        '実勤務時間
        DayTime            '日勤時間
        NightTime          '夜勤時間
        NextNightTime      '翌日夜勤時間
        TotalNightTime     '総夜勤時間
        NextTotalNightTime '翌夜勤総時間
        FirstFromTime      '前半開始時刻
        SecToTime          '後半終了時刻
    End Enum
    Private Const M_gKinmuTimeMCol_Min As Integer = gKinmuTimeMCol.WorkTimeNum
    Private Const M_gKinmuTimeMCol_Max As Integer = gKinmuTimeMCol.SecToTime
    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

    '希望勤務への入力警告
    Private m_KibouInputChk As Boolean

    '要請勤務への入力警告
    Private m_YouseiInputChk As Boolean
    '必須勤務の警告
    Private m_KinmuChk As Boolean

    Private Structure AbsType
        Dim KinmuCD() As String
        Dim AllocKbn As String
    End Structure

    Private m_strAbsKinmuCD() As AbsType
    Private m_RenzokuCnt(,) As Integer

    '締切日
    Private m_Simekiribi As Integer

    '対象ﾃﾞｰﾀの確定状況
    Private m_TargetData As Boolean '対象勤務ﾃﾞｰﾀが確定ﾃﾞｰﾀか（True:確定済，False:未確定）
    '検索用文字列
    Private m_HolDateStr As String '祝日 検索用文字列
    Private m_OffDayStr As String '休日 検索用文字列
    Private m_HolidayCount As Integer 'エラーチェック用休日回数

    '個人別集計欄の書式
    Private m_PersonalTotalSet As Integer '0=正数、1=小数点
    Private m_JitsudouGensanTaishouKoujo As String '実働時間減算対象控除（DB取得値）
    Private m_ArrayJitsudouGensanTaishouKoujo As String() '実働時間減算対象控除

    Private m_JitsudouGensanTaishouJikanKyu As String   '実働時間減算対象時間休（DB取得値）
    Private m_ArrayJitsudouGensanTaishouJikanKyu As String() '実働時間減算対象時間休
    Private m_sumLineDispFlg As Boolean '集計まで線を描画するフラグ
    Private m_scrollBerSize As Short 'スクロールバーの太さ

    '************************Sumiya Add 2012/11/06 Start ------**************************************
    Private m_udtAccessLog As DATABEAN.AccessLog_Type     'Sumiya Add 2012/11/05 保存用変数の設定
    Private m_strUseAccessLog As String
    '************************Sumiya Add 2012/11/06 End ------****************************************
    '2014/04/23 Saijo add start P-06979---------------------------------------------------------------
    Private m_strKinmuEmSecondFlg As String '勤務記号全角２文字対応フラグ(0：対応しない、1:対応する)
    '2014/04/23 Saijo add end P-06979-----------------------------------------------------------------

    '表示順名取得用
    Private m_strHyoujijunMei As String
    Private m_HyoujijunMeiIdx As Short
    Private m_HyoujijunMeiIdx2 As Short

    '2014/07/03 Ishiga add start---------------------------------------
    Private m_strVerPath As String  'パッケージ情報(0:標準版,1:Lite版)
    '2014/07/03 Ishiga add end-----------------------------------------

    '2017/09/04 Angelo Del st-------------BasNSK0000Hに転送---------------------------------------------------------------------------------------------
    ''勤務情報
    'Private Structure KinmuData_Type
    '    Dim KinmuCD As String 'KinmuCD
    '    Dim Date_Renamed As Integer '日付
    '    Dim RiyuKBN As String '理由区分
    '    Dim Time As String '時間年休（最大４件まで）
    '    Dim DataFlg As String '計画ﾃﾞｰﾀ,実績ﾃﾞｰﾀ判別用ﾌﾗｸﾞ(0:計画ﾃﾞｰﾀ,1:実績ﾃﾞｰﾀ)
    '    Dim KakuteiFlg As String '確定判別用ﾌﾗｸﾞ(0:該当部署,1:他部署)
    '    Dim DataChk As String 'DBの存在の有無("1":DBﾃﾞｰﾀあり，"":DBﾃﾞｰﾀなし）
    '    Dim OuenKangoCD As String '応援先看護単位CD
    '    Dim FirstRegistTimeDate As Double
    '    Dim LastUpdTimeDate As Double
    '    Dim RegistID As String
    '    Dim Comment As String '希望コメント　2015/04/10 Bando Add
    'End Structure

    ''年休詳細情報
    'Private Structure NenkyuDetail_Type
    '    Dim GetContentsKbn As String '取得内容区分(1:全日,2:前半,3:後半,4:時間年休)
    '    Dim HolidayBunruiCD As String '休み分類CD
    '    Dim FromTime As Integer '開始時間
    '    Dim ToTime As Integer '終了時間
    '    Dim DateKbn As String '年月日区分(0:当日,1:翌日)
    '    Dim NenkyuTime As Integer '時間年休
    '    Dim HolSubFlg As String '休憩減算フラグ
    '    Dim DayTime As Integer '日勤時間
    '    Dim NightTime As Integer '夜勤時間
    '    Dim NextNightTime As Integer '翌日夜勤時間
    'End Structure

    ''年休情報
    'Private Structure NenkyuData_Type
    '    Dim Date_Renamed As Integer '日付
    '    '*=*=*=*=*=*=*=*=*=*=*=*=排他処理対応の為の一時保存スペース*=*=*=*=*=*=*=*=*=*=*=*=*
    '    'この構造体は更新処理(「Save_PlanData」「Save_PlanData_4W」「Save_JissekiData」)の時
    '    'に値を入れ「UpDate_JikanNenkyu」でＤＢ上(NS_NENKYU_F)に保存しにいく為に使用してます
    '    Dim Detail() As NenkyuDetail_Type
    '    '*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*
    '    Dim DataFlg As Boolean 'データ更新FLG(True:更新する，False:更新しない)
    '    Dim DataChk As Boolean 'DBの存在の有無(True:DBﾃﾞｰﾀあり，False:DBﾃﾞｰﾀなし）
    '    Dim FirstRegistTimeDate As Double
    '    Dim LastUpdTimeDate As Double
    '    Dim RegistID As String
    'End Structure

    ''勤務地異動情報
    'Private Structure IdoData_Type
    '    Dim CD As String '追加仕様：応援者・月中異動者の総夜勤を全部出す
    '    Dim IdoYMD As Integer '異動年月日
    '    Dim IdoYMD2 As Integer '異動年月日２
    '    Dim SyuryoYMD As Integer '終了年月日
    'End Structure

    ''個人別勤務条件
    'Private Structure PersonalCondition_Type
    '    Dim NotKinmu As Boolean 'True:割当不可，False:割当可
    '    Dim CountMax As Integer
    '    Dim CountMin As Integer
    '    Dim IntervalMax As Integer
    '    Dim IntervalMin As Integer
    '    Dim MondayNot As Boolean 'True:割当不可，False:割当可
    '    Dim TuesdayNot As Boolean 'True:割当不可，False:割当可
    '    Dim WednesdayNot As Boolean 'True:割当不可，False:割当可
    '    Dim ThursdayNot As Boolean 'True:割当不可，False:割当可
    '    Dim FridayNot As Boolean 'True:割当不可，False:割当可
    '    Dim SaturdayNot As Boolean 'True:割当不可，False:割当可
    '    Dim SundayNot As Boolean 'True:割当不可，False:割当可
    '    '2015/05/13 Ishiga add start---------------------
    '    Dim RenzokuCountMax As Integer '連続勤務上限回数
    '    Dim RenkyuCountMax As Integer '連休上限回数
    '    '2015/05/13 Ishiga add end-----------------------
    'End Structure

    ''看護加算計算用データ構造体
    'Private Structure Kangokasan_Type
    '    Dim PostCD As String
    '    Dim JobCD As String
    '    Dim SaiyoCD As String
    '    Dim YakinKBN As String
    '    Dim ChildShort As Boolean '短時間
    'End Structure

    ''代休詳細用構造体
    ''Private Structure DaikyuDetail_Type
    '<Serializable()> Private Structure DaikyuDetail_Type '2016/04/06 Yamanishi Upd
    '    Dim DaikyuDate As Integer '代休消化日
    '    Dim DaikyuKinmuCD As String '代休消化勤務ＣＤ
    '    Dim GetFlg As String '取得タイプ(0:1日、1:0.5日)
    'End Structure

    ''代休用構造体
    ''Private Structure Daikyu_Type
    '<Serializable()> Private Structure Daikyu_Type '2016/04/06 Yamanishi Upd
    '    Dim HolDate As Integer
    '    Dim HolKinmuCD As String
    '    Dim DaikyuDetail() As DaikyuDetail_Type '代休詳細
    '    Dim GetKbn As String '代休発生量タイプ(0:1日分,1:1.5日分)
    '    Dim RemainderHol As Double '残り代休
    '    Dim OutPutList As String '代休取得時にリストにあげるかどうかのﾌﾗｸﾞ("0":代休取得日非対象 "1":代休取得日対象)
    '    Dim FirstRegistTimeDate As Double
    '    Dim LastUpdTimeDate As Double
    '    Dim RegistID As String
    'End Structure

    ''時間年休用構造体
    'Private Structure JikanNenkyu_Type
    '    Dim Date_Renamed As Integer
    '    Dim StrData As String
    'End Structure

    ''採用履歴情報
    'Private Structure SaiyoData_Type
    '    Dim SaiyoDate As Integer
    '    Dim TentaiDate As Integer
    '    Dim SaiyoCD As String
    '    Dim strStaffNo As String
    '    Dim lngHaizoku As Integer
    '    Dim blnHaizokuFLG As Boolean
    '    Dim strSecName As String
    'End Structure

    ''Private Structure KojyoData_Type
    '<Serializable()> Private Structure KojyoData_Type '2016/04/06 Yamanishi Upd
    '    Dim lngDate As Integer '年月日
    '    Dim lngKinmuDetailDate() As Integer '勤務詳細年月日
    '    Dim strKinmuDetailCD() As String '勤務詳細CD
    '    Dim lngTimeFrom() As Integer '時間帯From
    '    Dim lngTimeTo() As Integer '時間帯To
    '    Dim lngNikkinTime() As Integer '日勤時間
    '    Dim lngYakinTime() As Integer '夜勤時間
    '    Dim lngYokuYakinTime() As Integer '翌日夜勤時間
    '    Dim strNextFlg() As String '翌週FLG
    '    Dim lngKinmuDetailTime() As Integer '控除時間
    '    Dim strHolSubFlg() As String '休憩減算フラグ
    '    Dim strShinryoKbn() As String '診療報酬計算区分
    '    Dim UniqueseqNo() As String 'ユニークNO
    '    Dim Seq() As Integer
    '    Sub init()
    '        ReDim lngKinmuDetailDate(0)
    '        ReDim strKinmuDetailCD(0)
    '        ReDim lngTimeFrom(0)
    '        ReDim lngTimeTo(0)
    '        ReDim lngNikkinTime(0)
    '        ReDim lngYakinTime(0)
    '        ReDim lngYokuYakinTime(0)
    '        ReDim strNextFlg(0)
    '        ReDim lngKinmuDetailTime(0)
    '        ReDim strHolSubFlg(0)
    '        ReDim strShinryoKbn(0)
    '        ReDim UniqueseqNo(0)
    '        ReDim Seq(0)
    '    End Sub
    'End Structure

    'Private Structure SumCntDeteil_Type
    '    Dim GetFlg As Boolean
    '    Dim Cnt As Double
    'End Structure

    'Private Structure SumCntData_Type
    '    Dim SumSeq() As SumCntDeteil_Type
    'End Structure

    ''対象職員情報
    'Private Structure StaffData_Type
    '    Dim ID As String '職員管理番号
    '    Dim PreID As String '職員番号
    '    Dim StaffName As String '氏名
    '    Dim SaiyoYMD As Integer '採用年月日
    '    Dim TentaiYMD As Integer '転退年月日
    '    Dim IdoData() As IdoData_Type '異動情報（該当部署分のみ）
    '    Dim InitialHyojiNo As Integer '表示No(初期値)
    '    Dim HyojiNo As Integer '表示No
    '    Dim HyojiNo1 As Integer '表示No1
    '    Dim HyojiNo2 As Integer '表示No2
    '    Dim HyojiNo3 As Integer '表示No3
    '    Dim HyojiNo4 As Integer '表示No4
    '    Dim HyojiNo5 As Integer '表示No5
    '    Dim Team As Integer 'ﾁｰﾑ
    '    Dim AutoKBN As String '自動割当区分
    '    Dim JobHyojiNo As Integer '職種表示No
    '    Dim PostHyojiNo As Integer '役職表示No
    '    Dim GiryoHyojiNo As Integer '技量表示No
    '    Dim GiryoLvCD As String 'SkillLvlCD
    '    Dim GiryoBunruiCD As String 'SkillBunruiCD
    '    Dim KinmuData() As KinmuData_Type '勤務ﾃﾞｰﾀ
    '    Dim SaikeiData() As KinmuData_Type '再掲ﾃﾞｰﾀ（再掲部署のみ）
    '    Dim CompKinmuData() As KinmuData_Type '勤務ﾃﾞｰﾀ(予定ﾃﾞｰﾀ[実績ﾃﾞｰﾀとの比較用])
    '    Dim NenkyuData() As NenkyuData_Type '年休ﾃﾞｰﾀ
    '    Dim KinmuCondition() As PersonalCondition_Type '個人別勤務条件データ
    '    Dim PersonalError As Boolean 'True:エラー，False:エラーなし
    '    Dim JobCode As String '職種CD     (I/F)
    '    Dim PostCode As String '役職CD     (I/F)
    '    Dim PostName As String '役職名称     (I/F)　
    '    Dim HaizokuIF As Integer '配属日     (I/F)
    '    Dim TensyutuIF As Integer '転出日     (I/F)
    '    Dim Syokai As Double 'RegistFirstTimeDate
    '    Dim Saisyu As Double 'LastUpdTimeDate
    '    Dim UpdateFlg As String '職員歴Ｆ（ﾃﾞﾌｫﾙﾄ値:"0" Or 該当計画番号:"1" Or 前計画番号:"2"）
    '    Dim YakinKBN As String '夜勤専従者区分
    '    Dim PatternCD As String 'パターンコード
    '    Dim OuenStaffFlg As Integer '応援勤務者かどうかの判断（0：対象部署所属　1：応援勤務者）
    '    Dim TargetKikanFlg As Boolean '対象期間内（１ヶ月）の間に在職しているか（職員取得は１ヶ月で行っていないため、職員情報設定画面にデータを渡す際に使用） (True:在職, False:在職してない)
    '    Dim KangoKasanData() As Kangokasan_Type '看護加算計算用データ
    '    Dim Daikyu() As Daikyu_Type '代休データ
    '    Dim LoadDaikyu() As Daikyu_Type '画面ﾛｰﾄﾞ時の代休データ（勤務変更個人別画面時に使用）
    '    'Dim BackDaikyu() As Daikyu_Type '代休データ退避用 '2016/04/06 Yamanishi Del
    '    Dim WariateJikanNenkyu() As JikanNenkyu_Type '自動割り当て時の時間年休退避用配列
    '    Dim WariateOuenKinmu() As JikanNenkyu_Type '自動割り当て時の応援勤務退避用配列
    '    Dim WariateComment() As JikanNenkyu_Type '自動割り当て時の希望コメント退避用配列 2015/04/10 Bando Add
    '    Dim SaiyoData() As SaiyoData_Type '採用履歴情報
    '    Dim RuikeiTime As Integer '累計時間(該当計画番号の２つ前まで)
    '    Dim RuikeiTime_Jisseki As Integer '実績期間(該当計画番号の１つ前の時間)
    '    Dim Kojyo() As KojyoData_Type
    '    Dim blnEndDayChangeFlg As Boolean '強制的に異動暦のENDDATEを期間の最終日に変換したか(99999999や0を20080331へ)
    '    Dim NightWork() As NghtShrtData_Type '夜勤専従情報
    '    Dim ShortWork() As NghtShrtData_Type '短時間制度情報
    '    Dim SumCntData As SumCntData_Type
    '    Dim SumCntData_4W() As SumCntData_Type
    '    Dim ResultCnt() As Integer
    '    '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------------------
    '    Dim BeforeKinmuData() As KinmuData_Type
    '    Dim IdoHistory() As IdoData_Type
    '    'Dim BeforeJikanNenkyu() As JikanNenkyu_Type '2016/06/15 Yamanishi Del
    '    '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------------------
    'End Structure
    '2017/09/04 Angelo Del en------------------------------------------------------------------------------------------------------------------------

    Private m_StaffData() As StaffData_Type

    '-- 自動割当ｴﾝｼﾞﾝ ﾊﾟﾗﾒｰﾀ -----------
    Private Structure Date_Type
        Dim StartDate As Integer '開始日
        Dim EndDate As Integer '終了日
    End Structure

    Private m_Display As Date_Type '表示開始日,終了日
    Private m_Calendar As Date_Type 'ｶﾚﾝﾀﾞｰ開始日,終了日
    Private m_Schedule As Date_Type '割当開始日,終了日

    '-- 自動割当結果読み込み時に使用する --------------
    Private Structure StaffRow_Type
        Dim StaffDataIdx As Integer '職員情報格納変数の配列Index
        Dim StaffID As String '職員管理番号
        Dim MonthSprRow As Integer '1ヶ月用ｽﾌﾟﾚｯﾄﾞの行番号
        Dim WeekSprRow As Integer '4週用ｽﾌﾟﾚｯﾄﾞの行番号
    End Structure

    '計画期間列ﾃﾞｰﾀ
    Private Structure KikanCol_Type
        Dim PlanNo As Integer '計画番号(４週期間用変数では使用しない)
        Dim TarmNo As Integer 'ﾀｰﾑ番号(４週期間用変数では使用しない)
        Dim StartDate As Integer '開始日
        Dim EndDate As Integer '終了日
        Dim KinmuDataStartCol As Integer '勤務ﾃﾞｰﾀ開始列
        Dim KinmuDataEndCol As Integer '勤務ﾃﾞｰﾀ終了列
        Dim PersonalStartCol As Integer '個人別集計開始列
        Dim PersonalEndCol As Integer '個人別集計終了列
        Dim KoteiStartCol As Integer '固定集計Spreadの開始列(実績期間用変数では使用しない)
        Dim KoteiEndCol As Integer '固定集計Spreadの終了列(実績期間用変数では使用しない)
    End Structure

    Private m_KeikakuKikan As KikanCol_Type '計画期間
    Private m_JissekiKikan As KikanCol_Type '実績期間
    Private m_4WeekKikan() As KikanCol_Type '４週期間

    '日別集計行ﾃﾞｰﾀ
    Private Structure DayKikanRow_type
        Dim StartRow As Integer '開始行
        Dim EndRow As Integer '終了行
        Dim KoteiStartRow As Integer '固定集計Spreadの開始行
        Dim KoteiEndRow As Integer '固定集計Spreadの終了行
    End Structure

    Private m_DayDataRow() As DayKikanRow_type '日別集計ﾃﾞｰﾀ(0:ALL n:ﾁｰﾑ番号)
    '2016/04/06 Yamanishi Add --------------------------------
    Private Structure UndoKojyo_Type
        Dim StaffMngID As String
        Dim Data() As KojyoData_Type
    End Structure
    Private Structure UndoDaikyu_Type
        Dim StaffMngID As String
        Dim Data() As Daikyu_Type
    End Structure
    '---------------------------------------------------------
    Private Structure Row_type
        Dim StartRow As Integer '開始行
        Dim EndRow As Integer '終了行
        '2016/04/06 Yamanishi Add --------------------------------
        Dim UndoKojyo() As UndoKojyo_Type
        Dim UndoDaikyu() As UndoDaikyu_Type
        '---------------------------------------------------------
    End Structure

    Private m_StaffRow As Row_type '職員ﾃﾞｰﾀ
    Private m_OuenStaffRow As Row_type '応援職員ﾃﾞｰﾀ
    Private m_ViewRow As Row_type '表示されているﾃﾞｰﾀ
    Private m_DayAreaRow As Row_type '日別集計ｴﾘｱ
    Private m_CopyArea As Row_type 'ｺﾋﾟｰｴﾘｱﾃﾞｰﾀ
    '2016/04/05 Ishiga upd start-------------------------
    'Private m_UndoArea As Row_type 'Undoｴﾘｱﾃﾞｰﾀ
    Private m_UndoArea() As Row_type 'Undoｴﾘｱﾃﾞｰﾀ
    Private m_UndoMaxKensu As Short 'Undo最大件数
    Private m_UndoKaisu As Short 'Undoカウント
    Private m_RedoCnt As Short 'Redo制御カウント
    Private m_DispMsgFlg As Boolean
    Private m_ProForm As Object
    Private m_FirstFlg As Boolean '初回起動フラグ
    '2016/04/05 Ishiga upd end---------------------------

    '職員属性
    Private Structure StaffZokusei_Type
        Dim ListName As String '名称
        Dim SetCol_M As Integer '1ｹ月/1ｹ月,4週/4週ｽﾌﾟﾚｯﾄﾞの設定列
        Dim SetCol_4W As Integer '4週/1ｹ月ｽﾌﾟﾚｯﾄﾞの設定列
        Dim SetCol_PTotal As Integer '個人別集計ｽﾌﾟﾚｯﾄﾞの設定列
        Dim HyojiFlg As Boolean '表示Flg
    End Structure

    Private m_StaffZokusei(11) As StaffZokusei_Type

    'ｺﾋﾟｰ、Undoﾃﾞｰﾀ
    Private Structure CopyUndoData_Type
        Dim StartRow As Integer '開始行
        Dim EndRow As Integer '終了行
        Dim StartCol As Integer '開始列
        Dim EndCol As Integer '終了列
        Dim MotoStartRow As Integer 'Undo元開始行(ｺﾋﾟｰでは使用しない)
        Dim MotoEndRow As Integer 'Undo元終了行(ｺﾋﾟｰでは使用しない)
        Dim MotoStartCol As Integer 'Undo元開始列(ｺﾋﾟｰでは使用しない)
        Dim MotoEndCol As Integer 'Undo元終了列(ｺﾋﾟｰでは使用しない)
    End Structure

    Private m_CopyData As CopyUndoData_Type 'ｺﾋﾟｰﾃﾞｰﾀ
    '2016/04/05 Ishiga upd start----------------------------------------
    'Private m_UndoData() As CopyUndoData_Type 'Undoﾃﾞｰﾀ
    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
    'Private Structure UndoData_Type
    '    Dim UndoData() As CopyUndoData_Type '開始行
    'End Structure
    '----------------------------------------------------------------------------------------------------
    Private m_UndoIdx As Integer '元に戻す際最新のｲﾝﾃﾞｯｸｽ
    Private m_UndoIdxHendou As Integer '最大数を越えて変動するｲﾝﾃﾞｯｸｽ
    '2016/04/05 Ishiga upd end------------------------------------------

    Private Structure JissekiWariCol_Type
        Dim StartDate As Integer '開始日
        Dim EndDate As Integer '終了日
        Dim StartCol As Integer '開始列番号
        Dim EndCol As Integer '終了列番号
    End Structure

    Private m_PcheckD() As JissekiWariCol_Type '割当ﾁｪｯｸ 開始日/終了日 情報

    'ﾃﾞｰﾀ表示列
    Private Structure DataHyojiCol_Type
        Dim StartCol As Integer '開始列
        Dim EndCol As Integer '終了列
    End Structure

    Private m_DataHyojiCol As DataHyojiCol_Type

    '各集計項目の構造体
    Private Structure MtrxType
        Dim BunruiCD As String '分類CD（必要人数、勤務回数等で比較する割当CD）
        Dim MtrxName As String '集計項目名
        Dim Ratio() As Single '集計比率
        Dim CalcKinmuStr As String '集計対象勤務 検索用文字列
        Dim CntKbn As String '集計区分(1:集計比率 2:時間 3:累計)
        Dim CalcJobStr As String '集計対象外職種 検索用文字列
        Dim CalcPostStr As String '集計対象外役職 検索用文字列
    End Structure

    Private m_VMtrx() As MtrxType '1ｹ月用日別集計(縦集計)
    Private m_HMtrx() As MtrxType '1ｹ月用個人別集計(横集計)
    Private m_HMtrx_4Week() As MtrxType '4週用個人別集計(横集計)
    Private m_CheckHMtrx() As MtrxType '個人別ｴﾗｰﾁｪｯｸ用集計項目(横集計)

    '日別集計用の構造体
    Private Structure DayGoukei_Type
        Dim Goukei As Single
    End Structure

    Private Structure DaySEQ_Type
        Dim Seq() As DayGoukei_Type
    End Structure

    '希望勤務情報用の構造体
    Private Structure KibouKinmu_Type
        Dim StaffRow As Integer
        Dim KibouCnt As Integer
    End Structure

    '勤務時間M
    ''Private m_objGetTimeM As Hashtable
    'Private m_dicKinmuTimeM As Dictionary(Of String, Integer) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
    Private m_dicKinmuTimeM As Dictionary(Of String, String) '2018/03/01 Yamanishi Upd
    Private m_lngNightStartTime As Integer
    Private m_lngNightEndTime As Integer

    '******************************************************************************
    '       集計固定時の処理に使用する変数群
    '******************************************************************************
    Private m_MaxMainWidth As Single '明細スプレッドの最大幅（すべての列が表示しきれる場合の幅）
    Private m_MaxMainHeight As Single '明細スプレッドの最大高さ（すべての行が表示しきれる場合の高さ）
    Private m_PersonalTotalWidth As Single '固定用個人別集計の幅
    Private m_DayTotalHeight As Single '固定用日別集計の高さ

    Private Structure CtrlSizeType
        Dim NormalModeMaxWidth As Single '通常表示時（1ヶ月なら1ヶ月、４週なら４週）のﾃﾞｰﾀ部分ｽﾌﾟﾚｯﾄﾞの最大幅
        Dim WeekModeMaxWidth As Single '４週表示時のﾃﾞｰﾀ部分ｽﾌﾟﾚｯﾄﾞの最大幅（1ヶ月/1ヶ月，4週/4週の場合は未使用）
        Dim DataAreaMaxHeight(,) As Single 'ﾃﾞｰﾀ部分ｽﾌﾟﾚｯﾄﾞの最大高さ（配列はチーム番号，一段or二段表示）
        Dim NormalModePersonalTotalWidth As Single '通常表示時の固定個人別集計幅
        Dim WeekModePersonalTotalWidth As Single '４週表示時の固定個人別集計幅（1ヶ月/1ヶ月，4週/4週の場合は未使用）
        Dim NormalModeDayTotalHeight As Single '通常表示時（全職員表示）の固定日別集計高さ
        Dim TeamModeDayTotalHeight As Single 'チーム別表示時の固定日別集計高さ（チーム合計と全体合計表示）
    End Structure

    '配列はﾌｫﾝﾄの大きさで格納（ﾌｫﾝﾄ設定ﾒﾆｭｰのｲﾝﾃﾞｯｸｽに合わす　0:大，1:中，2:小）
    Private m_CtrlSize(2) As CtrlSizeType '各表示形態による大きさを格納
    Private m_ResizeEventFlg As Boolean 'Resizeイベントを起こすかどうか（True:起こす，False:起こさない）
    Private m_SelViewKikan As Integer '現在の表示種別（0:1ヶ月表示，1～:４週表示(配列Index)）
    Private m_TotalFrozen As Boolean '集計ｴﾘｱが固定されているか（True:固定，False:固定されていない）
    Private m_SelTeamNo As Integer '選択ﾁｰﾑ（0:すべて，1～:選択ﾁｰﾑ番号）
    Private m_FontIndex As Integer 'ﾌｫﾝﾄの大きさ（ﾒﾆｭｰのIndexとする 0:大，1:中，2:小）
    Private m_intProcessKikan As Integer '処理中の期間
    Private m_SelHyoujijunMei As Integer '選択表示順名(0：勤務計画作成用，1：勤務表提出用，2～4：予備)

    '******************************************************************************
    '       ﾏｳｽ位置設定に使用する変数群
    '******************************************************************************
    Private m_MouseSelectColText As String 'ﾏｳｽ位置設定時に元の設定文字列を退避する（列：日付の上）
    Private m_MouseSelectRowText_M As String '   　　　　　　〃　　　　　　　　　　　（行：№列）
    Private m_MouseSelectRowText_4W As String '   　　　　　　〃　　　　　　　　　　　（行：№列）
    Private m_MousePointerCol_4W As Integer '４週用ｽﾌﾟﾚｯﾄﾞのﾏｳｽﾎﾟｲﾝﾀｰ位置列退避変数
    Private m_MousePointerCol_M As Integer '１ヶ月用　　　　　〃
    Private m_MousePointerCol_PTotal As Integer '個人別集計　　　　〃
    Private m_MousePointerRow_DataArea As Integer '勤務ﾃﾞｰﾀｴﾘｱ　　　〃
    Private m_MousePointerRow_DayTotal As Integer '日別集計　　　　 〃
    Private m_BackColorPointerCol_M As Integer '１ヶ月用ｽﾌﾟﾚｯﾄﾞのﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀｰ位置列退避変数
    Private m_BackColorPointerCol_4W As Integer '４週用ｽﾌﾟﾚｯﾄﾞ    〃
    Private m_BackColorPointerRow_M As Integer '１ヶ月用ｽﾌﾟﾚｯﾄﾞ　〃
    Private m_BackColorPointerRow_4W As Integer '４週用ｽﾌﾟﾚｯﾄﾞ　　〃

    '**********************************************************************************
    '       ｿｰﾄで使用する変数群
    '**********************************************************************************
    Private Structure SortInf_Type 'ｿｰﾄ情報設定画面からの情報を格納する（ｿｰﾄ情報がない場合は SortKeyIndex=0 に設定する）
        Dim SortKeyIndex As Integer '並べ替え対象の職員データの格納配列
        Dim SortOrder As Boolean '昇順 Or 降順？
    End Structure

    Private m_SortData(3) As SortInf_Type '配列はそれぞれｿｰﾄのキー番号

    '実際のスプレッドのソート用データ格納（RunSort内のﾛｰｶﾙ変数で使用する）
    Private Structure SortKeyOrder_Type
        Dim SortKeyCol As Integer
        Dim SortOrderVal As Boolean
    End Structure

    '----個別勤務計画作成画面のｽﾌﾟﾚｯﾄﾞ用-----------
    '計画ﾃﾞｰﾀ 開始/終了 列番号情報
    Private m_KeikakuD_StartCol As Integer
    Private m_KeikakuD_EndCol As Integer
    '個人別入力画面の起動行 確保
    Private m_ActiveRow As Integer

    '**********************************************************************************
    '   ﾙｰﾙ情報格納変数 （勤務別条件、個人別勤務条件は職員データ格納変数で宣言）
    '**********************************************************************************
    '必要人数設定
    Private Structure NeedCount_Type
        Dim KinmuCD As String
        Dim MondayCnt As Integer
        Dim TuesdayCnt As Integer
        Dim WednesdayCnt As Integer
        Dim ThursdayCnt As Integer
        Dim FridayCnt As Integer
        Dim SaturdayCnt As Integer
        Dim SundayCnt As Integer
        Dim HolidayCnt As Integer
    End Structure

    Private Structure NeedCountKinmu_Type
        Dim NeedCount() As NeedCount_Type '配列は勤務件数
    End Structure

    Private m_NeedCountData() As NeedCountKinmu_Type '配列はﾁｰﾑ番号

    '禁止勤務パターン
    Private Structure NotPattern_Type
        Dim PatternKinmu As String
        Dim PatternCount As Integer
    End Structure

    Private m_NotPattern() As NotPattern_Type

    Private m_MouseX As Single
    '**************************************************************
    '   職員情報引き渡し用変数[職員情報設定画面]
    '**************************************************************
    Private m_Staff_ID As Object        '職員管理番号
    Private m_Staff_PreID As Object     '職員番号
    Private m_StaffTeam As Object       'ﾁｰﾑ
    Private m_StaffName As Object       '氏名
    Private m_StaffJobCD As Object      '職種CD
    Private m_StaffPostCD As Object     '役職CD
    Private m_StaffGiryoLvCD As Object  'SkillLvlCD
    Private m_StaffSaiyoDate As Object  '採用年月日
    Private m_StaffStartDate As Object  '配属年月日
    Private m_StaffEndDate As Object    '転出日
    Private m_StaffAutoKBN As Object    '自動割当対象区分
    Private m_StaffSyokai As Object     'RegistFirstTimeDate
    Private m_StaffSaisyu As Object         'LastUpdTimeDate
    Private m_StaffTourokuID As Object      'RegistrantID
    Private m_StaffTaisyokuDate As Object '退職日
    Private m_StaffKousinFlg As Object '更新ﾌﾗｸﾞ
    Private m_StaffNo As Object '表示NO
    Private m_StaffNo1 As Object '表示NO1
    Private m_StaffNo2 As Object '表示NO2
    Private m_StaffNo3 As Object '表示NO3
    Private m_StaffNo4 As Object '表示NO4
    Private m_StaffNo5 As Object '表示NO5
    Private m_StaffGiryoBunruiCD As Object '技量分類CD
    Private m_StaffGiryoHyojiNo As Object '技量表示No
    Private m_StaffYakinKBN As Object '夜勤専従者区分
    Private m_StaffPatternCD As Object 'パターンコード
    Private m_MaxTeamCnt As Integer '最大ﾁｰﾑ数

    'ﾃﾞｰﾀﾌﾗｸﾞ定数（該当計画番号ﾃﾞｰﾀ Or 前計画番号ﾃﾞｰﾀ）
    Private Const M_DataFlg_DefaultData As String = "0"
    Private Const M_DataFlg_GaitoPlanNoData As String = "1"
    Private Const M_DataFlg_BeforePlanNoData As String = "2"
    Private m_OuenStaffCnt As Integer '応援勤務者数

    '看護単位Ｍ用構造体
    Private Structure KangoM_Type
        Dim CD As String '看護単位CD
        Dim Name_Renamed As String '名称
        Dim IntegerNm As String '略称
    End Structure

    Private m_KangoM() As KangoM_Type

    '日当直グループＭ用構造体
    Private m_DutyGroupM() As KangoM_Type

    '届出Ｍ用構造体
    Private m_AppliCationM() As KangoM_Type

    '非常勤者の採用別週労働時間
    Private Structure HijokinTime_Type
        Dim CD As String
        Dim Time As String
    End Structure

    '看護加算帳票設定用構造体(小数の扱いについての設定)
    Private Structure TyohyoSettei_type
        Dim Value1 As String '(0：小数第1位 1:小数第2位 2:小数第3位)
        Dim Value2 As String '(0：切り上げ 1:切り捨て 2:四捨五入）
    End Structure

    '代休整合性チェック用構造体
    Private Structure Adjust_Daikyu_Type
        Dim StartDate As Integer
        Dim EndDate As Integer
        Dim PlanNo As Integer
    End Structure

    '時間Ｍデータ用構造体
    Private Structure TimeM_Type
        Dim KinmuCD As String
        Dim Time As Integer
        Dim DayTime As Integer '日勤時間
        Dim NightTime As Integer '夜勤時間
        Dim NextNightTime As Integer '翌日夜勤時間
    End Structure

    Private Structure Saiyo_Type
        Dim SaiyoCD As String
        Dim Time() As TimeM_Type
    End Structure

    Private m_Caption As String 'ﾌｫｰﾑのｷｬﾌﾟｼｮﾝ退避用
    '2016/05/06 Yamanishi Add -----------------------------------------------
    'Private m_YakinJujiCnt As Single 'トータル夜勤従事者カウント
    'Private m_YakinJujiCnt_4W() As Single 'トータル夜勤従事者カウント４週用
    Private m_YakinJujiCnt As Double 'トータル夜勤従事者カウント
    Private m_YakinJujiCnt_4W() As Double 'トータル夜勤従事者カウント４週用
    '------------------------------------------------------------------------
    Private m_TotalTime As Double '総合計
    Private m_TotalTime_4W() As Double '総時間４週用

    Private Structure YakinData_Type
        'Dim JujiCnt As Single
        Dim JujiCnt As Double '2016/05/06 Yamanishi Add
        Dim Time As Double
    End Structure

    Private m_YakinData() As YakinData_Type

    Private m_AveInPatient As Single 'AveInPatientNum
    Private m_TodokedeKbn As Integer '届出区分    
    Private m_SortIdx As Integer '夜間看護加算対象役職CD＆職種CD取得時のソートの値 (期間開始時:0 期間終了時:1)
    Private m_NotCntPostCD As String '集計対象外役職CD文字列
    Private m_NotCntJobCD As String '集計対象外職種CD文字列
    Private m_SaiyoTypeTime() As HijokinTime_Type '非常勤職員　採用CD & 週労働時間
    Private m_JokinSaiyoCD As String '常勤者対象採用CD
    Private m_JokinTime As Single '常勤者週労働時間
    Private m_KangoSettei(4) As TyohyoSettei_type '看護加算帳票設定用(小数の扱いについての設定)
    Private m_JikanNenkyu() As JikanNenkyu_Type '時間年休用配列
    Private m_lngDaikyuPastPeriod As Integer '過去の代休取得時の休日出勤日の有効範囲（何日前までの休日出勤は有効って感じ）
    Private m_lngDaikyuStartDate As Integer '代休データ取得開始日(計画期間開始日から有効期間日数分過去の日付)
    Private m_lngDaikyuEndDate As Integer '代休データ取得終了日
    Private m_lngDaikyuStartDate_Cnt As Integer 'カウント用代休データ取得開始日(計画期間開始日から有効期間日数分過去の日付)
    Private m_lngDaikyuEndDate_Cnt As Integer 'カウント用代休データ取得終了日
    Private m_BackColorFlg As Boolean '代休データ貼り付け時判断
    Private m_SaiyoCD As String '労働時間取得時に使用
    Private m_TimeM() As Saiyo_Type '時間Ｍデータ格納労働時間取得時に使用
    Private m_AveNightTime As Double '月平均夜勤時間基準時間
    Private m_PersonalSpreadSize As Double
    Private m_RuikeiStartNo As Integer
    Private m_RuikeiEndNo As Integer
    Private m_JissekiRuikeiFlg As Boolean '実績期間の時間を累計させるかどうかのﾌﾗｸﾞ
    Private m_blnLoadErr As Boolean 'ﾌｫｰﾑﾛｰﾄﾞ中のｴﾗｰﾌﾗｸﾞ
    Private m_Row As Integer
    Private m_Col As Integer
    Private m_CurRow As Integer
    Private m_CurCol As Integer
    Private m_bln As Boolean
    Private m_CellRange_v As Model.CellRange
    Private m_CellRange_h As Model.CellRange
    Private m_v_yPos As Integer
    Private m_v_xPos As Integer
    Private m_h_yPos As Integer
    Private m_h_xPos As Integer
    Private m_SelSheet As Spread.FpSpread
    Private m_NightShortJudgeKBN As String '夜専・短時間判定区分
    Private m_NightShortJudgeDay As Integer '夜専・短時間判定日数
    Private m_ChildShortEmpCD As String '育児短時間対象採用コード
    Private m_ChildShortReasonCD As String '育児短時間対象短時間理由コード
    Private m_WeekEndColorFlg As String '土日背景色フラグ
    Private m_HolidayColorFlg As String '祝休日背景色フラグ
    Private m_SumStMMdd As String '累計開始月日

    '右クリックを押した時のメニューの使用可 or 不可のバックアップ用
    Private m_blnPopupFLG As Boolean
    Private m_blnPopCutFLG As Boolean '切り取り
    Private m_blnPopCopyFLG As Boolean 'コピー
    Private m_blnPopPasteFLG As Boolean '貼り付け
    Private m_DutyData As Integer '日当直表示行
    Private m_KinmuPlan As Integer '勤務予定表示行
    Private m_KinmuJisseki As Integer '勤務実績表示行
    Private m_AppliData As Integer '届出表示行
    Private m_blnJissekiUseFlg As Boolean '表示ﾌﾗｸﾞ(勤務実績)
    Private m_blnAppliUseFlg As Boolean '表示ﾌﾗｸﾞ(届出)
    Private m_4WeekFLG As Boolean '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
    Private m_lngColFrozen As Integer
    Private m_intCalcSpr_Flg As Integer
    Private m_lngRowFrozen As Integer '日別集計項目の固定値
    Private m_intLastSumDispFlg As Integer  '前回計画集計表示フラグ 

    '職員禁止パターン 構造体
    Private Structure NotSetStaffSeqType
        Dim Seq As Integer 'SEQ
        Dim StaffMngID() As String
    End Structure

    Private Structure NotSetStaffType
        Dim AllocCD As String '割当CD
        Dim Data() As NotSetStaffSeqType
    End Structure

    Private m_NotStaffPatternInfo() As NotSetStaffType

    '割当勤務格納構造体・変数
    Private Structure StaffInfo_Type
        Dim StaffRow As String '行
        Dim StaffName As String '職員氏名
        Dim StaffMngID As String '職員管理番号
    End Structure

    Private Structure AllocKinmuInfo_Type
        Dim KinmuMark As String '勤務記号
        Dim KinmuCD As String '勤務ｺｰﾄﾞ
        Dim BunruiCD As String '分類ｺｰﾄﾞ
        Dim StaffInfo() As StaffInfo_Type
    End Structure

    Private m_AllocKinmuData() As AllocKinmuInfo_Type

    Private m_Daikyu15KinmuCD() As String '代休が1.5日発生する勤務ＣＤ
    Private m_strOuenKojyoCD As String '応援控除分類CD

    '採用記号情報
    Private Structure dispEmpMark
        Dim Mark As String
        Dim EmpCd As String
    End Structure
    Private m_DispEmpMark() As dispEmpMark
    Private m_dipsMarkChkKbn As Integer

    '経験区分の組み合わせチェック用構造体
    Private Structure Giryo_Type
        Dim Mark As String
        Dim Seq As Integer
        Dim GiryoNinzu1 As Integer
        Dim GiryoNinzu2 As Integer
        Dim GiryoNinzu3 As Integer
        Dim GiryoNinzu4 As Integer
    End Structure

    Private Structure GiryoCheck_Type
        Dim KinmuCD As String
        Dim Giryo() As Giryo_Type
    End Structure

    Private m_GiryoCheck() As GiryoCheck_Type

    Private Structure ErrStaffData_Type
        Dim StaffName As String
        Dim Row As Integer
        Dim Col As Integer
        Dim ErrorDate As Integer
    End Structure

    Private m_ErrStaffData() As ErrStaffData_Type
    Private m_KojyoCopyData() As KojyoData_Type
    'Private m_KojyoUndoData() As KojyoData_Type '2016/04/06 Yamanishi Del

    Private Structure Calc_CD_Type
        Dim strCD As String
        Dim strKBN As String
    End Structure

    Private m_lstmnuCheck As New List(Of Object)
    Private m_lstmnuData As New List(Of Object)
    Private m_lstmnuEdit As New List(Of Object)
    Private m_lstmnuFile As New List(Of Object)
    Private m_lstmnuFont As New List(Of Object)
    Private m_lstmnuJidou As New List(Of Object)
    Private m_lstmnuKikan As New List(Of Object)
    Private m_lstmnuKinmuView As New List(Of Object)
    Private m_lstmnuMain As New List(Of Object)
    Private m_lstmnuPopup As New List(Of Object)
    Private m_lstmnuSet As New List(Of Object)
    Private m_lstmnuTeam As New List(Of Object)
    Private m_lstmnuTool As New List(Of Object)
    Private m_lstmnuView As New List(Of Object)
    '2014/05/27 Shimizu add start P-06980----
    Private m_lstmnuTimeTable As New List(Of Object)
    '2014/05/27 Shimizu add end P-06980----
    Private m_CmbHT As New Hashtable
    Private m_PrintFlg As Boolean
    Private m_GyoujiFlg As Boolean '行事行表示非表示
    Private m_gyoujiHeight As Double
    Private m_EventData() As EventList_Type

    Private Structure SumHolTimeData_Type
        Dim SEQ As Integer
        Dim CD As String
    End Structure
    Private m_SumHolTimeData() As SumHolTimeData_Type
    Private m_SumHolTimeData_4W() As SumHolTimeData_Type

    Private Sub BackColorPoint_M(ByVal p_Col As Integer, ByVal p_Row As Integer)
        Const W_SUBNAME As String = "NSK0000HA BackColorPoint_M"
        Try
            '縦の背景色設定
            If m_BackColorPointerCol_M <> 0 Then
                '１ヶ月用ｽﾌﾟﾚｯﾄﾞに設定されている場合
                If (m_StaffRow.StartRow <= p_Row AndAlso p_Row <= m_StaffRow.EndRow) AndAlso (M_KinmuDataStart_Col <= p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                    If m_BackColorPointerCol_M <> p_Col Then
                        '--------------------
                        '背景色を元に戻す
                        '--------------------
                        '明細の背景色を元に戻す
                        If m_BackColorPointerCol_M = m_KeikakuKikan.KinmuDataStartCol - 1 Then
                        Else
                            Call SetBorder(sprSheet_M, M_DayLabel_Row, m_BackColorPointerCol_M, m_StaffRow.EndRow, m_BackColorPointerCol_M, 0, 0, 0, 1, 0, Color.Black)
                        End If

                        '日次集計エリア
                        Call SetBorder(sprDayTotal_M, M_First_Row, m_BackColorPointerCol_M, m_StaffRow.EndRow, m_BackColorPointerCol_M, 0, 0, 0, 1, 0, Color.Black)
                    End If
                End If
            End If

            '横の背景色設定
            If m_BackColorPointerRow_M <> 0 Then
                If (m_StaffRow.StartRow <= p_Row AndAlso p_Row <= m_StaffRow.EndRow) AndAlso (M_KinmuDataStart_Col <= p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                    If m_BackColorPointerRow_M <> p_Row Then
                        '--------------------
                        '背景色を元に戻す
                        '--------------------
                        '明細の背景色を元に戻す
                        If m_MaxShowLine > 1 AndAlso (m_BackColorPointerRow_M - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                            Call SetBorder(sprSheet_M, m_BackColorPointerRow_M, M_StaffName_Col, m_BackColorPointerRow_M, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                        Else
                            Call SetBorder(sprSheet_M, m_BackColorPointerRow_M, M_StaffName_Col, m_BackColorPointerRow_M, m_KeikakuKikan.KinmuDataEndCol, 0, 1, 0, 0, 0, Color.Black)
                        End If

                        '個人集計エリア
                        If m_MaxShowLine > 1 AndAlso (m_BackColorPointerRow_M - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                            Call SetBorder(sprPTotal, m_BackColorPointerRow_M, M_First_Col, m_BackColorPointerRow_M, m_KeikakuKikan.KinmuDataEndCol, 1, 1, 1, 1, 1, Color.Black)
                        Else
                            Call SetBorder(sprPTotal, m_BackColorPointerRow_M, M_First_Col, m_BackColorPointerRow_M, m_KeikakuKikan.KinmuDataEndCol, 1, 1, 1, 1, 1, Color.Black)
                        End If
                    End If
                End If
            End If


            If (M_YYYYMMDDLabel_Row < p_Row AndAlso p_Row <= m_StaffRow.EndRow AndAlso p_Col > M_StaffName_Col) OrElse (p_Row > m_StaffRow.EndRow AndAlso M_StaffName_Col < p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                If p_Row <> m_BackColorPointerRow_M OrElse p_Col <> m_BackColorPointerCol_M Then
                    If m_BackColorPointerCol_M = m_KeikakuKikan.KinmuDataStartCol - 1 Then
                    Else
                        '縦設定
                        Call SetBorder(sprSheet_M, M_DayLabel_Row, p_Col, m_StaffRow.EndRow, p_Col, 0, 0, 0, 2, 0, Color.Red)
                    End If


                    '横設定
                    Call SetBorder(sprSheet_M, p_Row, M_StaffName_Col, p_Row, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Red)

                    '個人集計エリア
                    Call SetBorder(sprPTotal, p_Row, M_First_Col, p_Row, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Red)

                    '日次集計エリア
                    Call SetBorder(sprDayTotal_M, M_First_Row, p_Col, m_StaffRow.EndRow, p_Col, 0, 0, 0, 2, 0, Color.Red)
                End If
            End If

            If (M_YYYYMMDDLabel_Row < p_Row AndAlso p_Row <= m_StaffRow.EndRow AndAlso p_Col > M_StaffName_Col) OrElse (p_Row > m_StaffRow.EndRow AndAlso M_StaffName_Col < p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                If p_Row <> m_BackColorPointerRow_M OrElse p_Col <> m_BackColorPointerCol_M Then
                    '設定列番号
                    m_BackColorPointerCol_M = p_Col
                End If
            End If

            If ((M_YYYYMMDDLabel_Row < p_Row AndAlso p_Row <= m_StaffRow.EndRow AndAlso p_Col > M_StaffName_Col) OrElse (p_Row > m_StaffRow.EndRow AndAlso M_StaffName_Col < p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol)) Then
                If p_Row <> m_BackColorPointerRow_M OrElse p_Col <> m_BackColorPointerCol_M Then
                    '設定列番号
                    m_BackColorPointerRow_M = p_Row
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub ChangeSpr_StaffData()

        Const W_SUBNAME As String = "NSK0000HA ChangeSpr_StaffData"

        Dim w_Sql As String
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_SprLoop As Integer
        Dim w_Var As Object
        Dim w_DataIndex As Integer
        Dim w_StaffID As String
        Dim w_Rs As ADODB.Recordset
        Dim w_StaffID_F As ADODB.Field
        Dim w_StaffViewNo_F As ADODB.Field
        Dim w_StaffViewNo_F1 As ADODB.Field
        Dim w_StaffViewNo_F2 As ADODB.Field
        Dim w_StaffViewNo_F3 As ADODB.Field
        Dim w_StaffViewNo_F4 As ADODB.Field
        Dim w_StaffViewNo_F5 As ADODB.Field
        Dim w_Team_F As ADODB.Field
        Dim w_AutoKbn_F As ADODB.Field
        Dim w_GiryoLvCD_F As ADODB.Field
        Dim w_GiryoBunruiCD_F As ADODB.Field
        Dim w_GiryoViewNO_F As ADODB.Field
        Dim w_SyokaiYMDHN_F As ADODB.Field
        Dim w_SaisyuYMDHN_F As ADODB.Field
        Dim w_YakinKBN_F As ADODB.Field
        Dim w_PatternCD_F As ADODB.Field
        Dim w_Int As Integer
        Dim w_ProcessForm As Object
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Try
            '自画面非表示
            Me.Hide()

            '処理経過ﾌｫｰﾑ表示
            w_ProcessForm = New frmNSK0000HM
            w_ProcessForm.Show()

            '処理経過ﾌｫｰﾑ設定
            w_ProcessForm.pForeColor = ColorTranslator.ToOle(Color.Lime)
            w_ProcessForm.pSyoriText = "職員情報設定中..."

            '職員歴ﾃﾞｰﾀ取得
            If General.g_InstallType = General.gInstall_Enum.AccessType_Mdb OrElse General.g_InstallType = General.gInstall_Enum.AccessType_SQL OrElse General.g_InstallType = General.gInstall_Enum.AccessType_post Then
                w_Sql = "Select NS_STAFFHISTORY_F.StaffMngID"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.SkillLvlCD"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo" & m_HyoujijunMeiIdx & " As 職員表示"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo1 As 職員表示1"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo2 As 職員表示2"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo3 As 職員表示3"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo4 As 職員表示4"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo5 As 職員表示5"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.AutoAllocKbn"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.Team"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.NightOnlyStaffKbn"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.PATTERNCD"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.RegistFirstTimeDate"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.LastUpdTimeDate"
                w_Sql = w_Sql & ", NS_SKILL_M.DispNo As 技量表示"
                w_Sql = w_Sql & ", NS_SKILL_M.SkillBunruiCD"
                w_Sql = w_Sql & " FROM NS_STAFFHISTORY_F LEFT JOIN NS_SKILL_M"
                w_Sql = w_Sql & " ON (NS_STAFFHISTORY_F.SkillLvlCD = NS_SKILL_M.SkillLvlCD)"
                w_Sql = w_Sql & " AND (NS_STAFFHISTORY_F.HospitalCD = NS_SKILL_M.HospitalCD)"
                w_Sql = w_Sql & " Where NS_STAFFHISTORY_F.KinmuDeptCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " And NS_STAFFHISTORY_F.PlanNo = " & Convert.ToString(m_PlanNo)
                w_Sql = w_Sql & " And NS_STAFFHISTORY_F.HospitalCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " Order By NS_STAFFHISTORY_F.DispNo" & m_HyoujijunMeiIdx & ""

                w_Sql = w_Sql & " "
            Else
                w_Sql = "Select NS_STAFFHISTORY_F.StaffMngID"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.SkillLvlCD"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo" & m_HyoujijunMeiIdx & " As 職員表示"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo1 As 職員表示1"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo2 As 職員表示2"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo3 As 職員表示3"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo4 As 職員表示4"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.DispNo5 As 職員表示5"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.AutoAllocKbn"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.Team"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.NightOnlyStaffKbn"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.PATTERNCD"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.RegistFirstTimeDate"
                w_Sql = w_Sql & ", NS_STAFFHISTORY_F.LastUpdTimeDate"
                w_Sql = w_Sql & ", NS_SKILL_M.DispNo As 技量表示"
                w_Sql = w_Sql & ", NS_SKILL_M.SkillBunruiCD"
                w_Sql = w_Sql & " From NS_SKILL_M, NS_STAFFHISTORY_F"
                w_Sql = w_Sql & " Where NS_SKILL_M.SkillLvlCD(+) = NS_STAFFHISTORY_F.SkillLvlCD"
                w_Sql = w_Sql & " And NS_SKILL_M.HospitalCD(+) = NS_STAFFHISTORY_F.HospitalCD"
                w_Sql = w_Sql & " And NS_STAFFHISTORY_F.KinmuDeptCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " And NS_STAFFHISTORY_F.PlanNo = " & Convert.ToString(m_PlanNo)
                w_Sql = w_Sql & " And NS_STAFFHISTORY_F.HospitalCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " Order By NS_STAFFHISTORY_F.DispNo" & m_HyoujijunMeiIdx & ""

                w_Sql = w_Sql & " "
            End If

            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs

                If .RecordCount > 0 Then
                    'ﾃﾞｰﾀが存在するとき

                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    w_StaffID_F = .Fields("StaffMngID")
                    w_StaffViewNo_F = .Fields("職員表示")
                    w_StaffViewNo_F1 = .Fields("職員表示1")
                    w_StaffViewNo_F2 = .Fields("職員表示2")
                    w_StaffViewNo_F3 = .Fields("職員表示3")
                    w_StaffViewNo_F4 = .Fields("職員表示4")
                    w_StaffViewNo_F5 = .Fields("職員表示5")
                    w_Team_F = .Fields("Team")
                    w_YakinKBN_F = .Fields("NightOnlyStaffKbn")
                    w_PatternCD_F = .Fields("PATTERNCD")
                    w_AutoKbn_F = .Fields("AutoAllocKbn")
                    w_GiryoLvCD_F = .Fields("SkillLvlCD")
                    w_GiryoBunruiCD_F = .Fields("SkillBunruiCD")
                    w_GiryoViewNO_F = .Fields("技量表示")
                    w_SyokaiYMDHN_F = .Fields("RegistFirstTimeDate")
                    w_SaisyuYMDHN_F = .Fields("LastUpdTimeDate")

                    '処理経過画面設定
                    w_ProcessForm.pMaxValue = w_DataCnt

                    '取得ﾃﾞｰﾀ件数分Loop
                    For w_DataLoop = 1 To w_DataCnt

                        '職員管理番号取得
                        w_StaffID = w_StaffID_F.Value

                        'ｽﾌﾟﾚｯﾄﾞのﾃﾞｰﾀ行分Loop
                        For w_SprLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_SprLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                                '配列Indexを取得する
                                w_Var = sprSheet_M.Sheets(0).GetText(w_SprLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)

                                If w_Var <> "" Then
                                    If IsNumeric(w_Var) = True Then

                                        'ﾃﾞｰﾀIndexを取得する
                                        w_DataIndex = Integer.Parse(w_Var)

                                        If w_StaffID = m_StaffData(w_DataIndex).ID Then

                                            'ﾃﾞｰﾀ格納配列変数値変更
                                            m_StaffData(w_DataIndex).HyojiNo = General.paGetDbFieldVal(w_StaffViewNo_F, -1)
                                            m_StaffData(w_DataIndex).HyojiNo1 = General.paGetDbFieldVal(w_StaffViewNo_F1, -1)
                                            m_StaffData(w_DataIndex).HyojiNo2 = General.paGetDbFieldVal(w_StaffViewNo_F2, -1)
                                            m_StaffData(w_DataIndex).HyojiNo3 = General.paGetDbFieldVal(w_StaffViewNo_F3, -1)
                                            m_StaffData(w_DataIndex).HyojiNo4 = General.paGetDbFieldVal(w_StaffViewNo_F4, -1)
                                            m_StaffData(w_DataIndex).HyojiNo5 = General.paGetDbFieldVal(w_StaffViewNo_F5, -1)
                                            m_StaffData(w_DataIndex).Team = IIf(IsDBNull(w_Team_F.Value), 1, w_Team_F.Value)
                                            m_StaffData(w_DataIndex).AutoKBN = w_AutoKbn_F.Value & ""
                                            m_StaffData(w_DataIndex).GiryoLvCD = w_GiryoLvCD_F.Value & ""
                                            m_StaffData(w_DataIndex).GiryoBunruiCD = w_GiryoBunruiCD_F.Value & ""
                                            m_StaffData(w_DataIndex).GiryoHyojiNo = IIf(IsDBNull(w_GiryoViewNO_F.Value), 1, w_GiryoViewNO_F.Value)
                                            m_StaffData(w_DataIndex).YakinKBN = IIf(IsDBNull(w_YakinKBN_F.Value), "1", w_YakinKBN_F.Value)
                                            m_StaffData(w_DataIndex).PatternCD = IIf(IsDBNull(w_PatternCD_F.Value), "", w_PatternCD_F.Value)

                                            If m_YakanKangoDispFlg = 0 Then
                                                '職員の看護加算用データ取得
                                                Call Get_YakanKangoData(w_DataIndex)
                                            End If

                                            '*************************************************
                                            '   職員情報設定画面引き渡し用
                                            '*************************************************
                                            For w_Int = 1 To UBound(m_Staff_ID)
                                                If m_Staff_ID(w_Int) = m_StaffData(w_DataIndex).ID Then
                                                    '更新後の職員情報の格納
                                                    m_StaffTeam(w_Int) = DirectCast(m_StaffData(w_DataIndex).Team, Object) 'Team
                                                    m_StaffGiryoLvCD(w_Int) = DirectCast(m_StaffData(w_DataIndex).GiryoLvCD, Object) 'SkillLvlCD
                                                    m_StaffAutoKBN(w_Int) = DirectCast(m_StaffData(w_DataIndex).AutoKBN, Object) 'AutoAllocKbn
                                                    m_StaffSyokai(w_Int) = IIf(IsDBNull(w_SyokaiYMDHN_F.Value), 0, w_SyokaiYMDHN_F.Value) 'RegistFirstTimeDate
                                                    m_StaffSaisyu(w_Int) = IIf(IsDBNull(w_SaisyuYMDHN_F.Value), 0, w_SaisyuYMDHN_F.Value) 'LastUpdTimeDate
                                                    m_StaffData(w_Int).UpdateFlg = M_DataFlg_GaitoPlanNoData '職員情報格納配列に更新ﾌﾗｸﾞを格納
                                                    m_StaffKousinFlg(w_Int) = DirectCast(m_StaffData(w_DataIndex).UpdateFlg, Object) '更新ﾌﾗｸﾞ
                                                    m_StaffNo(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo, Object) 'DispNo
                                                    m_StaffNo1(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo1, Object) 'DispNo1
                                                    m_StaffNo2(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo2, Object) 'DispNo2
                                                    m_StaffNo3(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo3, Object) 'DispNo3
                                                    m_StaffNo4(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo4, Object) 'DispNo4
                                                    m_StaffNo5(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo5, Object) 'DispNo5
                                                    m_StaffYakinKBN(w_Int) = DirectCast(m_StaffData(w_DataIndex).YakinKBN, Object) '夜勤専従者区分
                                                    m_StaffPatternCD(w_Int) = DirectCast(m_StaffData(w_DataIndex).PatternCD, Object) 'パターンコード
                                                End If
                                            Next w_Int

                                            'ｽﾌﾟﾚｯﾄﾞの格納ﾃﾞｰﾀ変更（１ヶ月、４週、個人別集計）
                                            For w_Int = 0 To m_MaxShowLine - 1
                                                '表示№
                                                w_Var = m_StaffData(w_DataIndex).HyojiNo

                                                Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_M, w_Var)
                                                Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_4W, w_Var)
                                                Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_PTotal, w_Var)
                                                'Team
                                                Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_M, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                                Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_4W, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                                Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_PTotal, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                                '技量表示№
                                                Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_M, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                                Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_4W, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                                Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_PTotal, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                            Next w_Int

                                            '技量、自動割当区分による色分け変更
                                            If m_StaffData(w_DataIndex).AutoKBN = "1" Then
                                                '自動割当対象（経験区分による色分け）
                                                Select Case m_StaffData(w_DataIndex).GiryoBunruiCD
                                                    Case "1" 'ﾘｰﾀﾞｰ
                                                        w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_Leader_Fore)
                                                    Case "2" 'ｻﾌﾞﾘｰﾀﾞｰ
                                                        w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_SubLeader_Fore)
                                                    Case "3" 'ｽﾀｯﾌ
                                                        w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_Staff_Fore)
                                                    Case "4" '新人
                                                        w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_NewFace_Fore)
                                                    Case Else '設定不備（エラーとする）
                                                        w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                                End Select
                                            Else
                                                '自動割当非対象（カレンダー通りの勤務）
                                                w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                            End If

                                            If m_MaxShowLine > 1 Then
                                                sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                                                sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                                                sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                                                sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                                            Else
                                                sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).BackColor = w_BackColor
                                                sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).ForeColor = w_ForeColor
                                                sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).BackColor = w_BackColor
                                                sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).ForeColor = w_ForeColor
                                            End If

                                            Exit For ' ---> w_SprLoop抜け出し
                                        End If ' ---> 検索ｽﾀｯﾌ？
                                    End If ' ---> 取得ｽﾌﾟﾚｯﾄﾞﾃﾞｰﾀは数値？
                                End If ' ---> 配列Index取得できた？
                            End If
                        Next w_SprLoop

                        .MoveNext()

                        '処理経過ｶｳﾝﾄ
                        w_ProcessForm.pCountValue = w_DataLoop
                    Next w_DataLoop ' ---> 取得ﾃﾞｰﾀ件数分Loop

                    'ﾁｰﾑ別の更新
                    Call PickUpData(m_SelTeamNo)

                    '自画面表示
                    Me.Show()
                    w_ProcessForm.Close()
                    w_ProcessForm = Nothing

                    'ｾﾙの再設定を行う。
                    Call Set_SpreadAdd()

                    '選択セルとスクロール位置設定
                    Call Set_KeikakuFirstCell()

                    '変更ﾃﾞｰﾀで再ソートする
                    Call RunSort(True)

                End If ' ---> 取得データ存在？
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '必要人数のエラーチェック
    '   与えられた列番号のチェックを行う
    '   注意：この列番号は1ヶ月用ｽﾌﾟﾚｯﾄﾞの列番号のみとします
    '   　　　４週用のｽﾌﾟﾚｯﾄﾞからこの関数を呼ぶ場合は、
    '   　　　１ヶ月用の列番号を取得後使用してください
    Private Sub Check_DayNeedNumber(ByVal pCol As Integer)

        Const W_SUBNAME As String = "NSK0000HA Check_DayNeedNumber"

        Dim w_Col4W As Integer
        Dim w_RowDataSheet As Integer
        Dim w_RowTotalSheet As Integer
        Dim w_TeamLoop As Integer
        Dim w_MtrxLoop As Integer
        Dim w_MtrxCnt As Integer
        Dim w_Var As Object
        Dim w_NeedNumberLoop As Integer
        Dim w_NeedNumberCnt As Integer
        Dim w_TeamNo As Integer
        Dim w_TargetNumber As Integer
        Dim w_WeekDay As Integer
        Dim w_ErrorFlg As Boolean
        Dim w_TeamCnt As Integer
        Try
            '与えられた列番号が計画期間列以降か
            If pCol < m_KeikakuKikan.KinmuDataStartCol AndAlso m_KeikakuKikan.KinmuDataEndCol < pCol Then
                '計画期間外なので計算しない
                Exit Sub
            End If

            '該当列の曜日を求める
            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, pCol)
            If w_Var = "" Then
                '日付が取得できないので処理抜け出し
                Exit Sub
            End If

            If IsNumeric(w_Var) = False Then
                Exit Sub
            End If

            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                '日付として判断できないので処理抜け出し
                Exit Sub
            End If

            If InStr(m_HolDateStr, Convert.ToString(w_Var)) > 0 Then
                '祝祭日
                w_WeekDay = 8
            Else
                w_WeekDay = Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00")))
            End If

            '4週用列番号取得
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(w_Var, w_Col4W) = False Then
                    Exit Sub
                End If
            End If

            '集計項目数取得
            w_MtrxCnt = UBound(m_VMtrx)

            '集計開始行取得
            w_RowDataSheet = m_DayAreaRow.StartRow
            w_RowTotalSheet = 0

            'エラーフラグ初期化
            w_ErrorFlg = False

            If m_OuenTeam <= 0 Then
                w_TeamCnt = m_TeamCnt
            Else
                w_TeamCnt = m_OuenTeam
            End If

            'ﾁｰﾑ数分Loop（ﾁｰﾑ設定無しでも１ﾁｰﾑとしてﾁｰﾑ別集計行あり）
            For w_TeamLoop = 1 To w_TeamCnt
                If m_TeamCnt > 1 Then
                    If w_TeamLoop <= UBound(m_NeedCountData) Then
                        w_TeamNo = w_TeamLoop
                        w_NeedNumberCnt = UBound(m_NeedCountData(w_TeamNo).NeedCount)
                    Else
                        w_NeedNumberCnt = 0
                    End If
                Else
                    'ﾁｰﾑ分割無しの場合
                    w_TeamNo = 0
                    w_NeedNumberCnt = UBound(m_NeedCountData(w_TeamNo).NeedCount)
                End If

                '集計項目数Loop
                For w_MtrxLoop = 1 To w_MtrxCnt
                    If m_VMtrx(w_MtrxLoop).BunruiCD <> "30" Then
                        '休み以外の場合チェック

                        '固定日別集計の値を使用してチェックする
                        w_Var = sprDayTotal_M.Sheets(0).GetText(w_RowTotalSheet, pCol)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then

                                '必要人数を取得
                                w_TargetNumber = 0
                                For w_NeedNumberLoop = 1 To w_NeedNumberCnt
                                    If m_VMtrx(w_MtrxLoop).BunruiCD = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).KinmuCD Then
                                        Select Case w_WeekDay
                                            Case FirstDayOfWeek.Monday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).MondayCnt
                                            Case FirstDayOfWeek.Tuesday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).TuesdayCnt
                                            Case FirstDayOfWeek.Wednesday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).WednesdayCnt
                                            Case FirstDayOfWeek.Thursday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).ThursdayCnt
                                            Case FirstDayOfWeek.Friday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).FridayCnt
                                            Case FirstDayOfWeek.Saturday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).SaturdayCnt
                                            Case FirstDayOfWeek.Sunday
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).SundayCnt
                                            Case 8 '祝祭日
                                                w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).HolidayCnt
                                        End Select
                                        Exit For
                                    End If
                                Next w_NeedNumberLoop

                                '集計値とチェックする
                                If Single.Parse(w_Var) < w_TargetNumber AndAlso m_lstmnuCheck(M_MenuNinzuu).Checked = True Then
                                    'エラー
                                    w_ErrorFlg = True

                                    'データ用ｽﾌﾟﾚｯﾄﾞ
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                    '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                        '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                        If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                            '表示4週期間内の列なら
                                            'データ用ｽﾌﾟﾚｯﾄﾞ
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                            '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)
                                        End If
                                    End If
                                ElseIf Single.Parse(w_Var) > w_TargetNumber AndAlso m_lstmnuCheck(M_MenuNinzuu).Checked = True Then
                                    '必要人数より実勤務人数が多い場合
                                    'エラー
                                    w_ErrorFlg = True

                                    'データ用ｽﾌﾟﾚｯﾄﾞ
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                    '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                        '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                        If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                            '表示4週期間内の列なら
                                            'データ用ｽﾌﾟﾚｯﾄﾞ
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                            '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)
                                        End If
                                    End If
                                Else
                                    'エラーでない場合
                                    'データ用ｽﾌﾟﾚｯﾄﾞ
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = SystemColors.Control
                                    sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = Color.Black

                                    '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = SystemColors.Control
                                    sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = Color.Black

                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                        '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                        If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                            '表示4週期間内の列なら
                                            'データ用ｽﾌﾟﾚｯﾄﾞ
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = SystemColors.Control
                                            sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = Color.Black

                                            '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = SystemColors.Control
                                            sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = Color.Black
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If

                    '行番号をｶｳﾝﾄ
                    w_RowTotalSheet = w_RowTotalSheet + 1
                    w_RowDataSheet = w_RowDataSheet + 1
                Next w_MtrxLoop
            Next w_TeamLoop

            '全体の必要人数チェックを行う
            w_TeamNo = 0
            w_NeedNumberCnt = UBound(m_NeedCountData(w_TeamNo).NeedCount)

            '集計項目数Loop
            For w_MtrxLoop = 1 To w_MtrxCnt
                If m_VMtrx(w_MtrxLoop).BunruiCD <> "30" Then
                    '休み以外の場合チェック

                    '固定日別集計の値を使用してチェックする
                    w_Var = sprDayTotal_M.Sheets(0).GetText(w_RowTotalSheet, pCol)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then

                            '必要人数を取得
                            w_TargetNumber = 0
                            For w_NeedNumberLoop = 1 To w_NeedNumberCnt
                                If m_VMtrx(w_MtrxLoop).BunruiCD = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).KinmuCD Then
                                    Select Case w_WeekDay
                                        Case FirstDayOfWeek.Monday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).MondayCnt
                                        Case FirstDayOfWeek.Tuesday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).TuesdayCnt
                                        Case FirstDayOfWeek.Wednesday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).WednesdayCnt
                                        Case FirstDayOfWeek.Thursday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).ThursdayCnt
                                        Case FirstDayOfWeek.Friday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).FridayCnt
                                        Case FirstDayOfWeek.Saturday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).SaturdayCnt
                                        Case FirstDayOfWeek.Sunday
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).SundayCnt
                                        Case 8 '祝祭日
                                            w_TargetNumber = m_NeedCountData(w_TeamNo).NeedCount(w_NeedNumberLoop).HolidayCnt
                                    End Select
                                    Exit For
                                End If
                            Next w_NeedNumberLoop

                            '集計値とチェックする
                            If Single.Parse(w_Var) < w_TargetNumber AndAlso m_lstmnuCheck(M_MenuNinzuu).Checked = True Then
                                'エラー
                                w_ErrorFlg = True
                                'データ用ｽﾌﾟﾚｯﾄﾞ
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                    '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                    If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                        '表示4週期間内の列なら
                                        'データ用ｽﾌﾟﾚｯﾄﾞ
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                                        '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)
                                    End If
                                End If
                            ElseIf Single.Parse(w_Var) > w_TargetNumber AndAlso m_lstmnuCheck(M_MenuNinzuu).Checked = True Then
                                '必要人数より実勤務人数が多い場合
                                'エラー
                                w_ErrorFlg = True
                                'データ用ｽﾌﾟﾚｯﾄﾞ
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                    '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                    If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                        '表示4週期間内の列なら
                                        'データ用ｽﾌﾟﾚｯﾄﾞ
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)

                                        '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor2)
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor2)
                                    End If
                                End If
                            Else
                                'エラーでない場合
                                'データ用ｽﾌﾟﾚｯﾄﾞ
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).BackColor = SystemColors.Control
                                sprSheet_M.Sheets(0).Cells(w_RowDataSheet, pCol).ForeColor = Color.Black

                                '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).BackColor = SystemColors.Control
                                sprDayTotal_M.Sheets(0).Cells(w_RowTotalSheet, pCol).ForeColor = Color.Black

                                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                                    '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                                    If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                        '表示4週期間内の列なら
                                        'データ用ｽﾌﾟﾚｯﾄﾞ
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).BackColor = SystemColors.Control
                                        sprSheet_4W.Sheets(0).Cells(w_RowDataSheet, w_Col4W).ForeColor = Color.Black

                                        '固定集計用ｽﾌﾟﾚｯﾄﾞ
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).BackColor = SystemColors.Control
                                        sprDayTotal_4W.Sheets(0).Cells(w_RowTotalSheet, w_Col4W).ForeColor = Color.Black
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If

                '行番号をｶｳﾝﾄ
                w_RowTotalSheet = w_RowTotalSheet + 1
                w_RowDataSheet = w_RowDataSheet + 1
            Next w_MtrxLoop

            'ｴﾗｰの場合は計画期間行をｴﾗｰ色に
            If w_ErrorFlg = True AndAlso m_lstmnuCheck(M_MenuNinzuu).Checked = True Then
                'ｴﾗｰの場合
                'データ用ｽﾌﾟﾚｯﾄﾞ
                sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, pCol).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, pCol).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                    '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                    If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                        '表示4週期間内の列なら
                        'データ用ｽﾌﾟﾚｯﾄﾞ
                        sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).BackColor = ColorTranslator.FromOle(m_Error_Col_BackColor)
                        sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).ForeColor = ColorTranslator.FromOle(m_Error_Col_ForeColor)
                    End If
                End If
            Else
                'ｴﾗｰでない場合
                'データ用ｽﾌﾟﾚｯﾄﾞ
                sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, pCol).BackColor = SystemColors.Control
                sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, pCol).ForeColor = Color.Black

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 AndAlso m_SelViewKikan <= UBound(m_4WeekKikan) Then
                    '4週/1ｹ月の場合で4週用ｽﾌﾟﾚｯﾄﾞが表示されている場合
                    If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                        '表示4週期間内の列なら
                        'データ用ｽﾌﾟﾚｯﾄﾞ
                        sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).BackColor = SystemColors.Control
                        sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).ForeColor = Color.Black
                    End If
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'pColより過去にさかのぼって間隔チェックを行う（勤務の分類のみ）
    '   引き数：pMtrx----->エラーチェック集計項目
    '   　　　　pCol------>該当列番号（この番号より過去にさかのぼって間隔チェックを行う）
    '   　　　　pRow------>該当行番号
    '   　　　　pIndex---->該当行の職員格納変数配列ｲﾝﾃﾞｯｸｽ
    '   　　　　pKinmuCD-->該当列の勤務CD
    '   戻り値：チェック結果 ---> True:ｴﾗｰなし，False:ｴﾗｰ
    Private Function CheckRule_Interval2(ByVal pMtrx As Integer, ByVal pCol As Integer, ByVal pRow As Integer, ByVal pIndex As Integer, ByVal pKinmuCD As String, ByVal pPlanTwoFlg As Boolean) As Boolean '2006/10/10 KatouY UPD

        Const W_SUBNAME As String = "NSK0000HA CheckRule_Interval2"

        Dim w_Col As Integer
        Dim w_SprObj As FpSpread
        Dim w_DataArea() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_WeekKikanLoop As Integer
        Dim w_WeekKikanCnt As Integer
        Dim w_AreaOKFlg As Boolean
        Dim w_Var As Object
        Dim w_KinmuCD As String
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Interval As Integer
        Dim w_ErrFlg As Boolean
        Dim w_KangoCD As String = String.Empty

        'エラー無しで初期化
        w_ErrFlg = True
        Try
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                '4週/1ヶ月
                w_SprObj = sprSheet_4W
                w_WeekKikanCnt = UBound(m_4WeekKikan)
                ReDim w_DataArea(w_WeekKikanCnt)
                For w_WeekKikanLoop = 1 To w_WeekKikanCnt
                    w_DataArea(w_WeekKikanLoop).StartCol = m_4WeekKikan(w_WeekKikanLoop).KinmuDataStartCol
                    w_DataArea(w_WeekKikanLoop).EndCol = m_4WeekKikan(w_WeekKikanLoop).KinmuDataEndCol
                Next w_WeekKikanLoop
            Else
                '4週/4週，1ヶ月/1ヶ月
                w_SprObj = sprSheet_M
                ReDim w_DataArea(2)
                w_DataArea(1).StartCol = m_JissekiKikan.KinmuDataStartCol
                w_DataArea(1).EndCol = m_JissekiKikan.KinmuDataEndCol
                w_DataArea(2).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_DataArea(2).EndCol = m_KeikakuKikan.KinmuDataEndCol
            End If

            '過去に戻って間隔チェックを行う
            For w_Col = pCol - 1 To M_KinmuDataStart_Col Step -1

                '勤務ｺｰﾄﾞ初期化
                w_KinmuCD = ""

                'ﾃﾞｰﾀｴﾘｱか？
                w_WeekKikanCnt = UBound(w_DataArea)
                w_AreaOKFlg = False
                For w_WeekKikanLoop = 1 To w_WeekKikanCnt
                    If w_DataArea(w_WeekKikanLoop).StartCol <= w_Col AndAlso w_Col <= w_DataArea(w_WeekKikanLoop).EndCol Then
                        w_AreaOKFlg = True
                        Exit For
                    End If
                Next w_WeekKikanLoop

                If w_AreaOKFlg = True Then '集計部以外
                    If m_blnJissekiUseFlg AndAlso pPlanTwoFlg Then
                        '二段表示の時
                        w_Var = w_SprObj.Sheets(0).GetText(pRow + 1, w_Col)
                        If w_Var <> "" Then
                            'まず下段を確認する
                        Else
                            '下段にデータが存在しない時は上段を確認する
                            w_Var = w_SprObj.Sheets(0).GetText(pRow, w_Col)
                        End If
                    Else
                        w_Var = w_SprObj.Sheets(0).GetText(pRow, w_Col)
                    End If

                    If w_Var <> "" Then

                        '2015/04/10 Bando Upd Start ===========================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                        '2015/04/10 Bando Upd End   ===========================

                        If InStr(m_CheckHMtrx(pMtrx).CalcKinmuStr, w_KinmuCD) > 0 AndAlso w_KinmuCD <> "" Then
                            '同一集計項目の勤務が見つかった場合
                            '勤務の場合（設定値以上あけなくてはならない）
                            If w_Interval < m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMax Then
                                'エラーとし処理抜け出し
                                w_ErrFlg = False
                            End If

                            If w_Interval > m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMin AndAlso m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMin > 0 Then
                                'エラーとし処理抜け出し
                                w_ErrFlg = False
                            End If
                            Exit For
                        Else
                            '同一集計項目の勤務でない場合
                            w_Interval = w_Interval + 1
                        End If
                    Else
                        '勤務が取得できない場合
                        w_Interval = w_Interval + 1
                    End If
                End If

                '該当勤務の間隔MAX値、間隔MIN値を超えた場合
                If m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMax > 0 Then
                    If w_Interval >= m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMax Then
                        'エラーとせずに処理抜け出し
                        w_ErrFlg = True
                        Exit For
                    End If
                End If
            Next w_Col

            CheckRule_Interval2 = w_ErrFlg

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    'pColより過去にさかのぼって間隔チェックを行う（勤務の分類のみ）
    '   引き数：pMtrx----->エラーチェック集計項目
    '   　　　　pCol------>該当列番号（この番号より過去にさかのぼって間隔チェックを行う）
    '   　　　　pRow------>該当行番号
    '   　　　　pIndex---->該当行の職員格納変数配列ｲﾝﾃﾞｯｸｽ
    '   　　　　pKinmuCD-->該当列の勤務CD
    '   戻り値：チェック結果 ---> True:ｴﾗｰなし，False:ｴﾗｰ
    Private Function CheckRule_Interval(ByVal pMtrx As Integer, ByVal pCol As Integer, ByVal pRow As Integer, ByVal pIndex As Integer, ByVal pKinmuCD As String, ByVal pPlanTwoFlg As Boolean) As Boolean '2006/10/10 KatouY UPD

        Const W_SUBNAME As String = "NSK0000HA CheckRule_Interval"

        Dim w_Col As Integer
        Dim w_SprObj As FpSpread
        Dim w_DataArea() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_WeekKikanLoop As Integer
        Dim w_WeekKikanCnt As Integer
        Dim w_AreaOKFlg As Boolean
        Dim w_Var As Object
        Dim w_KinmuCD As String
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Interval As Integer
        Dim w_ErrFlg As Boolean
        Dim w_KangoCD As String = String.Empty

        'エラー無しで初期化
        w_ErrFlg = True
        Try
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                '4週/1ヶ月
                w_SprObj = sprSheet_4W
                w_WeekKikanCnt = UBound(m_4WeekKikan)
                ReDim w_DataArea(w_WeekKikanCnt)
                For w_WeekKikanLoop = 1 To w_WeekKikanCnt
                    w_DataArea(w_WeekKikanLoop).StartCol = m_4WeekKikan(w_WeekKikanLoop).KinmuDataStartCol
                    w_DataArea(w_WeekKikanLoop).EndCol = m_4WeekKikan(w_WeekKikanLoop).KinmuDataEndCol
                Next w_WeekKikanLoop
            Else
                '4週/4週，1ヶ月/1ヶ月
                w_SprObj = sprSheet_M
                ReDim w_DataArea(2)
                w_DataArea(1).StartCol = m_JissekiKikan.KinmuDataStartCol
                w_DataArea(1).EndCol = m_JissekiKikan.KinmuDataEndCol
                w_DataArea(2).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_DataArea(2).EndCol = m_KeikakuKikan.KinmuDataEndCol
            End If

            '過去に戻って間隔チェックを行う
            For w_Col = pCol - 1 To M_KinmuDataStart_Col Step -1

                '勤務ｺｰﾄﾞ初期化
                w_KinmuCD = ""

                'ﾃﾞｰﾀｴﾘｱか？
                w_WeekKikanCnt = UBound(w_DataArea)
                w_AreaOKFlg = False
                For w_WeekKikanLoop = 1 To w_WeekKikanCnt
                    If w_DataArea(w_WeekKikanLoop).StartCol <= w_Col AndAlso w_Col <= w_DataArea(w_WeekKikanLoop).EndCol Then
                        w_AreaOKFlg = True
                        Exit For
                    End If
                Next w_WeekKikanLoop

                If w_AreaOKFlg = True Then '集計部以外
                    If m_blnJissekiUseFlg AndAlso pPlanTwoFlg Then
                        '二段表示の時
                        w_Var = w_SprObj.Sheets(0).GetText(pRow + 1, w_Col)
                        If w_Var <> "" Then
                            'まず下段を確認する
                        Else
                            '下段にデータが存在しない時は上段を確認する
                            w_Var = w_SprObj.Sheets(0).GetText(pRow, w_Col)
                        End If
                    Else
                        w_Var = w_SprObj.Sheets(0).GetText(pRow, w_Col)
                    End If

                    If w_Var <> "" Then

                        '2015/04/10 Bando Upd Start ======================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                        '2015/04/10 Bando Upd End   ======================

                        If InStr(m_CheckHMtrx(pMtrx).CalcKinmuStr, w_KinmuCD) > 0 AndAlso w_KinmuCD <> "" Then
                            '同一集計項目の勤務が見つかった場合
                            If m_CheckHMtrx(pMtrx).BunruiCD = "30" Then

                            Else
                                '勤務の場合（設定値以上あけなくてはならない）
                                If w_Interval < m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMax Then
                                    'エラーとし処理抜け出し
                                    w_ErrFlg = False
                                End If
                            End If
                            Exit For
                        Else
                            '同一集計項目の勤務でない場合
                            w_Interval = w_Interval + 1
                        End If
                    Else
                        '勤務が取得できない場合
                        w_Interval = w_Interval + 1
                    End If
                End If

                '該当勤務の間隔MAX値、間隔MIN値を超えた場合
                If m_CheckHMtrx(pMtrx).BunruiCD = "30" Then
                Else
                    If w_Interval >= m_StaffData(pIndex).KinmuCondition(pMtrx).IntervalMax Then
                        'エラーとせずに処理抜け出し
                        w_ErrFlg = True
                        Exit For
                    End If
                End If
            Next w_Col

            CheckRule_Interval = w_ErrFlg

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    'ｴﾗｰﾁｪｯｸ用集計
    '   与えられた行番号の集計・ｴﾗｰﾁｪｯｸを行う
    Private Sub Check_PersonalCalc(ByVal pRow As Integer, ByVal pPlanTwoFlg As Boolean)
        Const W_SUBNAME As String = "NSK0000HA Check_PersonalCalc"

        Dim w_IdxLoop As Integer
        Dim w_IdxCnt As Integer
        Dim w_CheckSpanCnt As Integer
        Dim w_Col As Integer
        Dim w_ObjSpread As FpSpread
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_4WCol As Integer
        Dim w_4WLoop As Integer
        Dim w_4WCnt As Integer
        Dim w_Check4WCol As Integer
        Dim w_NotPattern4WCol As Integer
        Dim w_Var As Object
        Dim w_StaffIdx As Integer
        Dim w_CountTarget() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_CountFlg As Boolean
        Dim w_KinmuCD As String
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_FindInt As Integer
        Dim w_RatioIdx As Integer
        Dim w_IntervalFlg As Boolean
        Dim w_NotPatternFlg As Boolean
        Dim w_NotPatternEndCol As Integer
        Dim w_KinmuBlock As String
        Dim w_FirstDate As Integer
        Dim w_HolChkCnt As Integer
        Dim w_DayCnt As Integer
        Dim w_PatternStart As Integer
        Dim w_ChkDate As Integer
        Dim w_PatternCnt As Integer
        Dim w_PatternFlg As Boolean
        Dim w_TempDay As Integer
        Dim w_PatternCode As String
        Dim w_ConnectMark As String
        Dim w_HolInterval As Integer
        Dim w_IntervalStartCol As Integer
        Dim w_HolidayMtrxIdx As Integer
        Dim w_GetCol As Integer
        Dim w_HolIntervalFlg As Boolean
        Dim w_DateVar As Object
        Dim w_PlanTarget() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_TargetPlanFlg As Boolean
        Dim w_DateDiff As Integer
        Dim w_SearchCnt As Integer
        Dim w_SearchLoop As Integer
        Dim w_StartInt As Integer
        Dim w_KangoCD As String = String.Empty
        '2015/04/10 Bando Add Start ===========================
        '作業用個人別集計列（エラーチェックを判定するために使用）
        Dim w_PersonalStartCol As Integer
        Dim w_PersonalEndCol As Integer
        '2015/04/10 Bando Add End   ===========================

        Try
            '休みﾁｪｯｸの集計名称格納配列ｲﾝﾃﾞｯｸｽ取得
            w_HolidayMtrxIdx = -1
            w_IdxCnt = UBound(m_CheckHMtrx)
            For w_IdxLoop = 1 To w_IdxCnt
                If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                    w_HolidayMtrxIdx = w_IdxLoop
                    Exit For
                End If
            Next w_IdxLoop

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ヶ月
                w_ObjSpread = sprSheet_4W

                '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                w_Var = w_ObjSpread.Sheets(0).GetText(pRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    If IsNumeric(w_Var) = True Then
                        w_StaffIdx = Integer.Parse(w_Var)
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_ObjSpread = Nothing
                        Exit Sub
                    End If
                Else
                    '職員情報が取得できないので処理抜け出し
                    w_ObjSpread = Nothing
                    Exit Sub
                End If

                '回数ﾁｪｯｸ
                If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_4WCol) = False Then
                    w_4WCol = M_KinmuData_Col
                End If

                w_4WCnt = UBound(m_4WeekKikan)

                For w_4WLoop = 1 To w_4WCnt
                    If m_4WeekKikan(w_4WLoop).KinmuDataStartCol <= w_4WCol AndAlso w_4WCol <= m_4WeekKikan(w_4WLoop).KinmuDataEndCol Then
                        w_Check4WCol = m_4WeekKikan(w_4WLoop).KinmuDataStartCol
                        Exit For
                    End If
                Next w_4WLoop

                '禁止パターン
                If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                    w_Var = DirectCast(m_KeikakuKikan.StartDate, Object)
                    If Get_Col_4W(w_Var, w_NotPattern4WCol) = False Then
                        w_NotPattern4WCol = M_KinmuData_Col
                    End If
                    w_IntervalStartCol = w_NotPattern4WCol
                Else
                    If w_HolidayMtrxIdx = -1 Then
                        w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")
                        If Get_Col_4W(w_Var, w_NotPattern4WCol) = False Then
                            w_NotPattern4WCol = M_KinmuData_Col
                        End If
                        w_IntervalStartCol = w_NotPattern4WCol
                    Else
                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 1 > 4 Then
                            w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -1 * (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2), Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")
                        Else
                            w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")
                        End If

                        If Get_Col_4W(Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd"), w_NotPattern4WCol) = False Then
                            w_NotPattern4WCol = M_KinmuData_Col
                        End If

                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 Then
                            If Get_Col_4W(Format(Date.Parse(DateAdd(DateInterval.Day, -1 * (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2), Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd"), w_IntervalStartCol) = False Then
                                w_IntervalStartCol = M_KinmuData_Col
                            End If
                        Else
                            If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_IntervalStartCol) = False Then
                                w_IntervalStartCol = M_KinmuData_Col
                            End If
                        End If
                    End If
                End If

                If Get_Col_4W(w_Var, w_GetCol) = False Then
                    w_GetCol = w_Check4WCol + 1
                End If

                If w_GetCol < w_Check4WCol Then
                    w_StartCol = w_GetCol
                Else
                    w_StartCol = w_Check4WCol
                End If

                '終了ｾﾙ
                w_EndCol = m_4WeekKikan(w_4WCnt).KinmuDataEndCol
                '禁止パターン用勤務取得終了ｾﾙ
                w_Var = DirectCast(m_KeikakuKikan.EndDate, Object)
                If Get_Col_4W(w_Var, w_NotPatternEndCol) = False Then
                    w_NotPatternEndCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                End If

                '休みｶｳﾝﾄ対象期間
                ReDim w_CountTarget(w_4WCnt - w_4WLoop + 1)
                w_IdxCnt = 0
                For w_IdxLoop = w_4WLoop To w_4WCnt
                    w_IdxCnt = w_IdxCnt + 1
                    w_CountTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                    w_CountTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                Next w_IdxLoop

                '計画表示対象期間
                ReDim w_PlanTarget(w_4WCnt - w_4WLoop + 1)
                w_IdxCnt = 0
                For w_IdxLoop = w_4WLoop To w_4WCnt
                    w_IdxCnt = w_IdxCnt + 1
                    If w_IdxLoop = w_4WLoop Then
                        w_PlanTarget(w_IdxCnt).StartCol = w_4WCol
                        w_PlanTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                    ElseIf w_IdxLoop = w_4WCnt Then
                        w_PlanTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                        If Get_Col_4W(DirectCast(m_KeikakuKikan.EndDate, Object), w_4WCol) = False Then
                            w_4WCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                        End If
                        w_PlanTarget(w_IdxCnt).EndCol = w_4WCol
                    Else
                        w_PlanTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                        w_PlanTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                    End If
                Next w_IdxLoop
            Else
                '4週/4週，1ヶ月/1ヶ月
                w_ObjSpread = sprSheet_M

                '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                w_Var = w_ObjSpread.Sheets(0).GetText(pRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    If IsNumeric(w_Var) = True Then
                        w_StaffIdx = Integer.Parse(w_Var)
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_ObjSpread = Nothing
                        Exit Sub
                    End If
                Else
                    '職員情報が取得できないので処理抜け出し
                    w_ObjSpread = Nothing
                    Exit Sub
                End If

                '集計開始ｾﾙ（禁止パターン用に実績部分４日間も考慮する
                If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                    '実績期間がない場合
                    w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                    w_NotPattern4WCol = w_StartCol
                    w_IntervalStartCol = w_StartCol
                Else
                    If w_HolidayMtrxIdx = -1 Then
                        '実績期間がある場合（禁止パターン考慮(実績部分最後の４日間考慮する)）
                        w_StartCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                        w_IntervalStartCol = 0
                    Else
                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 1 > 4 Then
                            w_StartCol = m_JissekiKikan.KinmuDataEndCol - (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2)
                        Else
                            w_StartCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                        End If

                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 Then
                            w_IntervalStartCol = m_JissekiKikan.KinmuDataEndCol - (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2)
                        Else
                            w_IntervalStartCol = m_KeikakuKikan.KinmuDataStartCol
                        End If
                    End If
                    w_NotPattern4WCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                End If

                '終了ｾﾙ
                w_EndCol = m_KeikakuKikan.KinmuDataEndCol
                '禁止パターン用勤務取得終了ｾﾙ
                w_NotPatternEndCol = w_EndCol

                '休みｶｳﾝﾄ対象期間
                ReDim w_CountTarget(1)
                w_CountTarget(1).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_CountTarget(1).EndCol = m_KeikakuKikan.KinmuDataEndCol
                '休み間隔対象期間
                ReDim w_PlanTarget(1)
                w_PlanTarget(1).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_PlanTarget(1).EndCol = m_KeikakuKikan.KinmuDataEndCol
            End If

            'ｴﾗｰ格納変数の初期化を行う
            '勤務回数/間隔
            w_IdxCnt = UBound(m_CheckHMtrx)
            w_CheckSpanCnt = UBound(w_CountTarget)
            ReDim g_KikanError(w_IdxCnt)

            For w_IdxLoop = 1 To w_IdxCnt
                g_KikanError(w_IdxLoop).ErrName = m_CheckHMtrx(w_IdxLoop).MtrxName
                g_KikanError(w_IdxLoop).ErrBunrui = m_CheckHMtrx(w_IdxLoop).BunruiCD

                ReDim g_KikanError(w_IdxLoop).CheckSpan(w_CheckSpanCnt)
            Next w_IdxLoop

            '2015/05/13 Ishiga add start----------------------------------------------
            '勤務上限回数
            w_IdxCnt = UBound(m_CheckHMtrx)
            w_CheckSpanCnt = UBound(w_CountTarget)
            ReDim g_RenzokuError(w_IdxCnt)

            For w_IdxLoop = 1 To w_IdxCnt
                g_RenzokuError(w_IdxLoop).ErrName = m_CheckHMtrx(w_IdxLoop).MtrxName
                g_RenzokuError(w_IdxLoop).ErrBunrui = m_CheckHMtrx(w_IdxLoop).BunruiCD

                ReDim g_RenzokuError(w_IdxLoop).CheckSpan(w_CheckSpanCnt)
            Next w_IdxLoop
            '2015/05/13 Ishiga add end------------------------------------------------

            '禁止パターン
            g_NotPatternError.ErrorPattern = ""
            g_NotPatternError.ErrorDate = 0
            g_NotPatternError.ErrorFlg = False
            '否定勤務
            g_NotKinmuError.KinmuName = ""
            g_NotKinmuError.ErrorDate = 0
            g_NotKinmuError.ErrorFlg = False

            '禁止パターンの勤務群の最初の日付 初期化
            w_FirstDate = 0
            w_KinmuBlock = ""
            '休みｶｳﾝﾄ変数初期化
            w_HolInterval = 0

            '対象期間分Loop
            For w_Col = w_StartCol To w_EndCol
                w_NotPatternFlg = False
                w_HolIntervalFlg = False
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ヶ月
                    w_4WCnt = UBound(m_4WeekKikan)
                    For w_4WLoop = 1 To w_4WCnt
                        If m_4WeekKikan(w_4WLoop).KinmuDataStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_4WLoop).KinmuDataEndCol Then
                            '勤務ﾃﾞｰﾀ表示範囲のｾﾙの場合（集計列を省く）
                            '勤務パターン考慮対象列検索
                            If w_NotPattern4WCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                                w_NotPatternFlg = True
                            End If
                            '休日間隔対象列検索
                            If w_IntervalStartCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                                w_HolIntervalFlg = True
                            End If
                            Exit For
                        End If
                    Next w_4WLoop
                Else
                    '4週/4週，1ヶ月/1ヶ月
                    '2015/04/10 Bando Add Start ==========================
                    If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                        '実績変更
                        w_PersonalStartCol = m_KeikakuKikan.PersonalStartCol
                        w_PersonalEndCol = m_KeikakuKikan.PersonalEndCol
                    Else
                        '新規計画
                        w_PersonalStartCol = m_JissekiKikan.PersonalStartCol
                        w_PersonalEndCol = m_JissekiKikan.PersonalEndCol
                    End If
                    '2015/04/10 Bando Add End   ==========================
                    If (m_JissekiKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_JissekiKikan.KinmuDataEndCol) OrElse (m_KeikakuKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                        '勤務ﾃﾞｰﾀ表示範囲のｾﾙの場合（集計列を省く）
                        '勤務パターン考慮対象列検索
                        If w_NotPattern4WCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                            w_NotPatternFlg = True
                        End If
                        '休日間隔対象列検索
                        If w_IntervalStartCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                            w_HolIntervalFlg = True
                        End If
                    End If
                End If

                '日付を取得する
                w_DateVar = w_ObjSpread.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)

                '勤務を取得する
                If m_blnJissekiUseFlg AndAlso pPlanTwoFlg Then
                    '二段表示の時
                    w_Var = w_ObjSpread.Sheets(0).GetText(pRow + 1, w_Col)
                    If w_Var <> "" Then
                        'まず下段を確認する
                    Else
                        '下段にデータが存在しない時は上段を確認する
                        w_Var = w_ObjSpread.Sheets(0).GetText(pRow, w_Col)
                    End If
                Else
                    w_Var = w_ObjSpread.Sheets(0).GetText(pRow, w_Col)
                End If

                If w_Var <> "" Then
                    '勤務が取得できた場合のみ
                    '2015/04/10 Bando Add Start ==================================
                    '個人別集計列の場合、処理しない
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        If w_4WLoop > UBound(m_4WeekKikan) Then
                            Continue For
                        Else
                            If m_4WeekKikan(w_4WLoop).PersonalStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_4WLoop).PersonalEndCol Then
                                '4週/1ヶ月
                                Continue For
                            End If
                        End If
                    Else
                        If w_PersonalStartCol <= w_Col AndAlso w_Col <= w_PersonalEndCol Then
                            '4週/4週，1ヶ月/1ヶ月
                            Continue For
                        End If
                    End If
                    '2015/04/10 Bando Add End   ==================================

                    '初期化
                    w_KinmuCD = ""

                    '取得勤務ﾃﾞｰﾀの詳細ｺｰﾄﾞ等を取得する
                    '2015/04/10 Bando Upd Start ==========================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                    '2015/04/10 Bando Upd End   ==========================
                    If w_KinmuCD <> "" Then
                        '勤務ｺｰﾄﾞが取得できた場合のみ

                        '回数ｶｳﾝﾄ
                        w_CountFlg = False
                        For w_4WLoop = 1 To w_CheckSpanCnt
                            If w_CountTarget(w_4WLoop).StartCol <= w_Col AndAlso w_Col <= w_CountTarget(w_4WLoop).EndCol Then
                                w_CountFlg = True
                                Exit For
                            End If
                        Next w_4WLoop

                        If w_CountFlg = True Then
                            '集計
                            w_IdxCnt = UBound(m_CheckHMtrx)
                            For w_IdxLoop = 1 To w_IdxCnt
                                w_FindInt = InStr(m_CheckHMtrx(w_IdxLoop).CalcKinmuStr, w_KinmuCD) '集計対象勤務
                                If w_FindInt > 0 AndAlso w_KinmuCD <> "" Then
                                    '集計対象勤務の場合
                                    w_RatioIdx = (w_FindInt \ 4) + 1 '勤務CD３桁化
                                    '４週毎の集計
                                    g_KikanError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount = g_KikanError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)

                                    '１ヶ月期間内のチェックは日付で行う
                                    If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                        If m_KeikakuKikan.StartDate <= w_DateVar AndAlso w_DateVar <= m_KeikakuKikan.EndDate Then
                                            '計画期間内なら１ヶ月集計にも加算する
                                            g_KikanError(w_IdxLoop).CheckSpan(0).KinmuCount = g_KikanError(w_IdxLoop).CheckSpan(0).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)
                                        End If
                                    End If

                                    '2015/05/13 Ishiga add start-----------------------------------------------------------------------------------------------------------------------------------------
                                    '４週毎の集計
                                    g_RenzokuError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount = g_RenzokuError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)

                                    '１ヶ月期間内のチェックは日付で行う
                                    If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                        If m_KeikakuKikan.StartDate <= w_DateVar AndAlso w_DateVar <= m_KeikakuKikan.EndDate Then
                                            '計画期間内なら１ヶ月集計にも加算する
                                            g_RenzokuError(w_IdxLoop).CheckSpan(0).KinmuCount = g_RenzokuError(w_IdxLoop).CheckSpan(0).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)
                                        End If
                                    End If
                                    '2015/05/13 Ishiga add end-------------------------------------------------------------------------------------------------------------------------------------------

                                End If
                            Next w_IdxLoop
                        End If

                        '表示期間内の列？
                        w_TargetPlanFlg = False
                        w_IdxCnt = UBound(w_PlanTarget)
                        For w_IdxLoop = 1 To w_IdxCnt
                            If w_PlanTarget(w_IdxLoop).StartCol <= w_Col AndAlso w_Col <= w_PlanTarget(w_IdxLoop).EndCol Then
                                w_TargetPlanFlg = True
                                Exit For
                            End If
                        Next w_IdxLoop

                        '休みの間隔ｶｳﾝﾄ
                        If w_HolIntervalFlg = True AndAlso w_HolidayMtrxIdx <> -1 Then
                            If g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = False Then
                                If InStr(m_CheckHMtrx(w_HolidayMtrxIdx).CalcKinmuStr, w_KinmuCD) > 0 Then
                                    '休みの場合（間隔ｶｳﾝﾄ変数を初期化する）
                                    w_HolInterval = 0
                                Else
                                    w_HolInterval = w_HolInterval + 1 '休み間隔ｶｳﾝﾄｱｯﾌﾟ
                                    If w_HolInterval >= m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin AndAlso m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 AndAlso w_TargetPlanFlg = True Then
                                        '休み間隔ｴﾗｰ
                                        g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = True
                                        If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                            g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorDate = Integer.Parse(w_DateVar)
                                        End If
                                    End If
                                End If
                            End If
                        End If

                        '間隔、否定チェック
                        If w_TargetPlanFlg = True Then
                            '計画期間内で所属している日のみが対象

                            If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then

                                w_IntervalFlg = False
                                w_IdxCnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                For w_IdxLoop = 1 To w_IdxCnt
                                    If m_StaffData(w_StaffIdx).IdoData(w_IdxLoop).IdoYMD <= Integer.Parse(w_DateVar) AndAlso Integer.Parse(w_DateVar) <= m_StaffData(w_StaffIdx).IdoData(w_IdxLoop).SyuryoYMD Then
                                        w_IntervalFlg = True
                                        Exit For
                                    End If
                                Next w_IdxLoop

                                If w_IntervalFlg = True Then
                                    '配属期間内の場合
                                    w_IdxCnt = UBound(m_CheckHMtrx)
                                    For w_IdxLoop = 1 To w_IdxCnt 'このループは、複数の集計項目に同一の勤務ｺｰﾄﾞが含まれている場合を考慮するためです。（実際に発生するかは？？？）
                                        If InStr(m_CheckHMtrx(w_IdxLoop).CalcKinmuStr, w_KinmuCD) > 0 Then

                                            '間隔チェック
                                            If g_KikanError(w_IdxLoop).InterValErr.ErrorFlg = False AndAlso m_CheckHMtrx(w_IdxLoop).BunruiCD <> "30" Then
                                                'ｴﾗｰでなく、休み以外の場合にﾁｪｯｸを行う
                                                If CheckRule_Interval(w_IdxLoop, w_Col, pRow, w_StaffIdx, w_KinmuCD, pPlanTwoFlg) = False Then
                                                    'ｴﾗｰ発生
                                                    g_KikanError(w_IdxLoop).InterValErr.ErrorFlg = True 'ｴﾗｰ
                                                    g_KikanError(w_IdxLoop).InterValErr.ErrorDate = Integer.Parse(w_DateVar) 'ｴﾗｰが発生している日
                                                End If
                                            End If

                                            '否定チェック
                                            If g_NotKinmuError.ErrorFlg = False Then
                                                If CheckRule_NotKinmu(w_IdxLoop, w_StaffIdx, Integer.Parse(w_DateVar)) = False Then
                                                    'ｴﾗｰ
                                                    g_NotKinmuError.ErrorFlg = True 'ｴﾗｰ
                                                    g_NotKinmuError.ErrorDate = Integer.Parse(w_DateVar) 'ｴﾗｰが発生している日
                                                    If IsNumeric(w_KinmuCD) = True Then
                                                        g_NotKinmuError.KinmuName = g_KinmuM(Integer.Parse(w_KinmuCD)).Mark
                                                    Else
                                                        g_NotKinmuError.KinmuName = "　"
                                                    End If
                                                End If
                                            End If
                                        End If '---> 取得勤務に該当する集計項目
                                    Next w_IdxLoop '---> 集計項目数Loop
                                End If '---> 配属？
                            End If '---> 日付の妥当性ﾁｪｯｸ
                        End If '---> 計画期間？

                        '禁止勤務パターン
                        If w_NotPatternFlg = True Then
                            If w_FirstDate = 0 Then
                                '日付を取得していない場合は日付を取得
                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                    w_FirstDate = Integer.Parse(w_DateVar)
                                    w_KinmuBlock = w_KinmuBlock & w_KinmuCD & ","
                                End If
                            Else
                                'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                                w_KinmuBlock = w_KinmuBlock & w_KinmuCD & ","
                            End If
                        End If
                    Else
                        '勤務ｺｰﾄﾞが取得できなかった場合

                        '休みの間隔ｶｳﾝﾄ
                        If w_HolIntervalFlg = True AndAlso w_HolidayMtrxIdx <> -1 Then
                            If g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = False Then
                                w_HolInterval = w_HolInterval + 1 '休み間隔ｶｳﾝﾄｱｯﾌﾟ
                                w_TargetPlanFlg = False
                                w_IdxCnt = UBound(w_PlanTarget)

                                For w_IdxLoop = 1 To w_IdxCnt
                                    If w_PlanTarget(w_IdxLoop).StartCol <= w_Col AndAlso w_Col <= w_PlanTarget(w_IdxLoop).EndCol Then
                                        w_TargetPlanFlg = True
                                        Exit For
                                    End If
                                Next w_IdxLoop

                                If w_HolInterval >= m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin AndAlso m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 AndAlso w_TargetPlanFlg = True Then
                                    '休み間隔ｴﾗｰ
                                    g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = True
                                    If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                        g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorDate = Integer.Parse(w_DateVar)
                                    End If
                                End If
                            End If
                        End If

                        '禁止勤務パターン
                        If w_NotPatternFlg = True Then
                            If w_FirstDate = 0 Then
                                '日付を取得していない場合は日付を取得
                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                    w_FirstDate = Integer.Parse(w_DateVar)
                                    w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                                End If
                            Else
                                'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                                w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                            End If
                        End If
                    End If '---> 勤務ｺｰﾄﾞ取得ＯＫ？
                Else
                    '勤務ｺｰﾄﾞが取得できなかった場合

                    '休みの間隔ｶｳﾝﾄ
                    If w_HolIntervalFlg = True AndAlso w_HolidayMtrxIdx <> -1 Then
                        If g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = False Then
                            w_HolInterval = w_HolInterval + 1 '休み間隔ｶｳﾝﾄｱｯﾌﾟ
                            w_TargetPlanFlg = False
                            w_IdxCnt = UBound(w_PlanTarget)
                            For w_IdxLoop = 1 To w_IdxCnt
                                If w_PlanTarget(w_IdxLoop).StartCol <= w_Col AndAlso w_Col <= w_PlanTarget(w_IdxLoop).EndCol Then
                                    w_TargetPlanFlg = True
                                    Exit For
                                End If
                            Next w_IdxLoop
                            If w_HolInterval >= m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin AndAlso m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 AndAlso w_TargetPlanFlg = True Then
                                '休み間隔ｴﾗｰ
                                g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorFlg = True
                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                    g_KikanError(w_HolidayMtrxIdx).InterValErr.ErrorDate = Integer.Parse(w_DateVar)
                                End If
                            End If
                        End If
                    End If

                    '禁止勤務パターン
                    If w_NotPatternFlg = True Then
                        If w_FirstDate = 0 Then
                            '日付を取得していない場合は日付を取得
                            If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                w_FirstDate = Integer.Parse(w_DateVar)
                                w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                            End If
                        Else
                            'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                            w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                        End If
                    End If
                End If '---> 勤務取得ＯＫ？
            Next w_Col

            '=================================================================
            '   ｴﾗｰﾁｪｯｸ用 集計終了  回数、禁止パターンチェック
            '=================================================================
            '回数チェック
            w_IdxCnt = UBound(m_CheckHMtrx)
            For w_IdxLoop = 1 To w_IdxCnt
                If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                    '休みの場合

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week OrElse m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                        w_HolChkCnt = 8
                    Else
                        If m_HolidayCount < m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax Then
                            w_HolChkCnt = m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax
                        Else
                            w_HolChkCnt = m_HolidayCount
                        End If
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ヶ月
                        w_4WCnt = UBound(g_KikanError(w_IdxLoop).CheckSpan)
                        For w_4WLoop = 1 To w_4WCnt
                            '各計画期間毎にチェック
                            If g_KikanError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount < w_HolChkCnt Then
                                g_KikanError(w_IdxLoop).CheckSpan(w_4WLoop).ErrorFlg = True
                            End If
                        Next w_4WLoop
                    Else
                        '4週/4週，1ヶ月/1ヶ月
                        If g_KikanError(w_IdxLoop).CheckSpan(0).KinmuCount < w_HolChkCnt Then
                            g_KikanError(w_IdxLoop).CheckSpan(0).ErrorFlg = True
                        End If
                    End If
                Else
                    '勤務の場合（常に1ヶ月(4週/4週の場合は4週)単位でチェック）

                    If g_KikanError(w_IdxLoop).CheckSpan(0).KinmuCount > m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax AndAlso m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax > 0 Then
                        '集計値が設定値より大きい場合エラー
                        g_KikanError(w_IdxLoop).CheckSpan(0).ErrorFlg = True
                    End If
                End If
            Next w_IdxLoop

            '2015/05/13 Ishiga add start--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            w_IdxCnt = UBound(m_CheckHMtrx)
            For w_IdxLoop = 1 To w_IdxCnt
                If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                    '休みの場合

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week OrElse m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                        w_HolChkCnt = 8
                    Else
                        If m_HolidayCount < m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax Then
                            w_HolChkCnt = m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax
                        Else
                            w_HolChkCnt = m_HolidayCount
                        End If
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ヶ月
                        w_4WCnt = UBound(g_RenzokuError(w_IdxLoop).CheckSpan)
                        For w_4WLoop = 1 To w_4WCnt
                            '各計画期間毎にチェック
                            If g_RenzokuError(w_IdxLoop).CheckSpan(w_4WLoop).KinmuCount < w_HolChkCnt Then
                                g_RenzokuError(w_IdxLoop).CheckSpan(w_4WLoop).ErrorFlg = True
                            End If
                        Next w_4WLoop
                    Else
                        '4週/4週，1ヶ月/1ヶ月
                        If g_RenzokuError(w_IdxLoop).CheckSpan(0).KinmuCount < w_HolChkCnt Then
                            g_RenzokuError(w_IdxLoop).CheckSpan(0).ErrorFlg = True
                        End If
                    End If
                Else
                    '勤務の場合（常に1ヶ月(4週/4週の場合は4週)単位でチェック）

                    If g_RenzokuError(w_IdxLoop).CheckSpan(0).KinmuCount > m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax AndAlso m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax > 0 Then
                        '集計値が設定値より大きい場合エラー
                        g_RenzokuError(w_IdxLoop).CheckSpan(0).ErrorFlg = True
                    End If
                End If
            Next w_IdxLoop
            '2015/05/13 Ishiga add end----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            '禁止勤務パターンチェック
            w_IdxCnt = UBound(m_NotPattern)
            w_DateDiff = DateDiff(DateInterval.Day, Date.Parse(Format(w_FirstDate, "0000/00/00")), Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")))

            For w_IdxLoop = 1 To w_IdxCnt

                '禁止勤務パターンが存在しているか
                If m_NotPattern(w_IdxLoop).PatternKinmu = "" Then
                    w_FindInt = 0
                Else
                    w_SearchCnt = w_DateDiff - m_NotPattern(w_IdxLoop).PatternCount + 1
                    w_StartInt = 1
                    For w_SearchLoop = 1 To w_SearchCnt
                        'ﾊﾟﾀｰﾝﾁｪｯｸ開始位置取得
                        w_StartInt = InStr(w_StartInt, w_KinmuBlock, ",") + 1
                    Next w_SearchLoop
                    w_FindInt = InStr(w_StartInt, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu)
                End If

                '禁止パターンが存在していた場合
                If w_FindInt > 0 Then

                    '禁止パターンが何日目からか
                    w_DayCnt = (w_FindInt \ 4) + 1 '勤務CD３桁化

                    '該当パターンの初日取得
                    w_PatternStart = Integer.Parse(Format(DateAdd(DateInterval.Day, w_DayCnt - 1, Date.Parse(Format(w_FirstDate, "0000/00/00"))), "yyyyMMdd"))
                    w_ChkDate = w_PatternStart

                    w_PatternFlg = False
                    For w_PatternCnt = 1 To m_NotPattern(w_IdxLoop).PatternCount
                        w_4WCnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                        For w_4WLoop = 1 To w_4WCnt
                            If m_StaffData(w_StaffIdx).IdoData(w_4WLoop).IdoYMD <= w_ChkDate AndAlso w_ChkDate <= m_StaffData(w_StaffIdx).IdoData(w_4WLoop).SyuryoYMD Then
                                w_PatternFlg = True
                                Exit For
                            End If
                        Next w_4WLoop
                        w_ChkDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(w_ChkDate, "0000/00/00"))), "yyyyMMdd"))
                    Next w_PatternCnt

                    If w_PatternFlg = True Then
                        '禁止勤務パターンエラー

                        'より計画期間開始日に近い禁止パターンをエラーとする
                        If w_DayCnt < w_TempDay OrElse g_NotPatternError.ErrorFlg = False Then
                            w_TempDay = w_DayCnt
                            g_NotPatternError.ErrorFlg = True
                            g_NotPatternError.ErrorDate = w_PatternStart
                            g_NotPatternError.ErrorPattern = ""
                            For w_PatternCnt = 1 To m_NotPattern(w_IdxLoop).PatternCount
                                If w_PatternCnt = m_NotPattern(w_IdxLoop).PatternCount Then
                                    w_ConnectMark = ""
                                Else
                                    w_ConnectMark = "-"
                                End If

                                w_PatternCode = Mid(m_NotPattern(w_IdxLoop).PatternKinmu, (4 * w_PatternCnt) - 3, 3) '勤務CD３桁化
                                If IsNumeric(w_PatternCode) = True Then
                                    If g_KinmuM(Integer.Parse(w_PatternCode)).Mark = "" Then
                                        g_NotPatternError.ErrorPattern = g_NotPatternError.ErrorPattern & Space(3) & w_ConnectMark '勤務CD３桁化
                                    Else
                                        g_NotPatternError.ErrorPattern = g_NotPatternError.ErrorPattern & g_KinmuM(Integer.Parse(w_PatternCode)).Mark & w_ConnectMark
                                    End If
                                Else
                                    g_NotPatternError.ErrorPattern = g_NotPatternError.ErrorPattern & Space(3) & w_ConnectMark '勤務CD３桁化
                                End If
                            Next w_PatternCnt
                        End If
                    End If
                End If
            Next w_IdxLoop

            'ｽﾌﾟﾚｯﾄﾞｵﾌﾞｼﾞｪｸﾄの解放
            w_ObjSpread = Nothing

            '=================================================================
            '   エラーが発生しているかチェックする
            '=================================================================
            m_StaffData(w_StaffIdx).PersonalError = False '初期化

            '回数チェック
            If m_lstmnuCheck(M_MenuKinmuCount).Checked = True Then
                w_IdxCnt = UBound(m_CheckHMtrx)
                For w_IdxLoop = 1 To w_IdxCnt
                    If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                        '休み
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月
                            w_4WCnt = UBound(g_KikanError(w_IdxLoop).CheckSpan)
                            For w_4WLoop = 1 To w_4WCnt
                                '各計画期間毎にチェック
                                If g_KikanError(w_IdxLoop).CheckSpan(w_4WLoop).ErrorFlg = True Then
                                    m_StaffData(w_StaffIdx).PersonalError = True
                                    Exit Sub
                                End If
                            Next w_4WLoop
                        Else
                            '1ヶ月/1ヶ月
                            If g_KikanError(w_IdxLoop).CheckSpan(0).ErrorFlg = True Then
                                m_StaffData(w_StaffIdx).PersonalError = True
                                Exit Sub
                            End If
                        End If
                    Else
                        '勤務
                        If g_KikanError(w_IdxLoop).CheckSpan(0).ErrorFlg = True Then
                            m_StaffData(w_StaffIdx).PersonalError = True
                            Exit Sub
                        End If
                    End If
                Next w_IdxLoop
            End If

            '2015/05/13 Ishiga add start---------------------------------------------------------------------------------------------------------------
            If m_lstmnuCheck(M_MenuRenzokuKinmuInterval).Checked = True Then
                w_IdxCnt = UBound(m_CheckHMtrx)
                For w_IdxLoop = 1 To w_IdxCnt
                    If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                        '休み
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月
                            w_4WCnt = UBound(g_RenzokuError(w_IdxLoop).CheckSpan)
                            For w_4WLoop = 1 To w_4WCnt
                                '各計画期間毎にチェック
                                If g_RenzokuError(w_IdxLoop).CheckSpan(w_4WLoop).ErrorFlg = True Then
                                    m_StaffData(w_StaffIdx).PersonalError = True
                                    Exit Sub
                                End If
                            Next w_4WLoop
                        Else
                            '1ヶ月/1ヶ月
                            If g_RenzokuError(w_IdxLoop).CheckSpan(0).ErrorFlg = True Then
                                m_StaffData(w_StaffIdx).PersonalError = True
                                Exit Sub
                            End If
                        End If
                    Else
                        '勤務
                        If g_RenzokuError(w_IdxLoop).CheckSpan(0).ErrorFlg = True Then
                            m_StaffData(w_StaffIdx).PersonalError = True
                            Exit Sub
                        End If
                    End If
                Next w_IdxLoop
            End If
            '2015/05/13 Ishiga add end-----------------------------------------------------------------------------------------------------------------

            '間隔チェック
            If m_lstmnuCheck(M_MenuKinmuInterval).Checked = True Then
                w_IdxCnt = UBound(m_CheckHMtrx)
                For w_IdxLoop = 1 To w_IdxCnt
                    If g_KikanError(w_IdxLoop).InterValErr.ErrorFlg = True Then
                        m_StaffData(w_StaffIdx).PersonalError = True
                        Exit Sub
                    End If
                Next w_IdxLoop
            End If

            '禁止パターンチェック
            If m_lstmnuCheck(M_MenuKinmuPattern).Checked = True Then
                If g_NotPatternError.ErrorFlg = True Then
                    m_StaffData(w_StaffIdx).PersonalError = True
                    Exit Sub
                End If
            End If

            '否定勤務チェック
            If m_lstmnuCheck(M_MenuKinsiKinmu).Checked = True Then
                If g_NotKinmuError.ErrorFlg = True Then
                    m_StaffData(w_StaffIdx).PersonalError = True
                    Exit Sub
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｴﾗｰﾁｪｯｸ用集計
    '   与えられた行番号の集計・ｴﾗｰﾁｪｯｸを行う
    Private Sub Check_PersonalCalc2(ByVal pRow As Integer, ByVal pPlanTwoFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Check_PersonalCalc2"

        Dim w_IdxLoop As Integer
        Dim w_IdxCnt As Integer
        Dim w_CheckSpanCnt As Integer
        Dim w_Col As Integer
        Dim w_ObjSpread As FpSpread
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_4WCol As Integer
        Dim w_4WLoop As Integer
        Dim w_4WCnt As Integer
        Dim w_Check4WCol As Integer
        Dim w_NotPattern4WCol As Integer
        Dim w_Var As Object
        Dim w_StaffIdx As Integer
        Dim w_CountTarget() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_CountFlg As Boolean
        Dim w_KinmuCD As String
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_FindInt As Integer
        Dim w_FindInt2() As Integer
        Dim w_StartInt As Integer
        Dim w_RatioIdx As Integer
        Dim w_IntervalFlg As Boolean
        Dim w_NotPatternFlg As Boolean
        Dim w_NotPatternEndCol As Integer
        Dim w_KinmuBlock As String
        Dim w_FirstDate As Integer
        Dim w_DayCnt As Integer
        Dim w_PatternStart As Integer
        Dim w_ChkDate As Integer
        Dim w_PatternCnt As Integer
        Dim w_PatternFlg As Boolean
        Dim w_TempDay As Integer
        Dim w_PatternCode As String
        Dim w_ConnectMark As String
        Dim w_HolInterval As Integer
        Dim w_IntervalStartCol As Integer
        Dim w_HolidayMtrxIdx As Integer
        Dim w_GetCol As Integer
        Dim w_HolIntervalFlg As Boolean
        Dim w_DateVar As Object
        Dim w_PlanTarget() As DataHyojiCol_Type 'StartCol, EndCol
        Dim w_TargetPlanFlg As Boolean
        Dim w_DateDiff As Integer
        Dim w_SearchCnt As Integer
        Dim w_SearchLoop As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_intPatternErrorIdx As Integer
        Dim w_intKinmuErrorIdx As Integer
        Dim w_intKikanIdx As Integer
        Dim w_intDataIdx As Integer
        Dim w_Int As Integer
        Dim w_lngCount As Integer
        '2015/04/10 Bando Add Start ========================
        '作業用個人別集計列（エラーチェックを判定するために使用）
        Dim w_PersonalStartCol As Integer
        Dim w_PersonalEndCol As Integer
        '2015/04/10 Bando Add End   ========================
        Try
            ReDim w_FindInt2(0)

            '休みﾁｪｯｸの集計名称格納配列ｲﾝﾃﾞｯｸｽ取得
            w_HolidayMtrxIdx = -1
            w_IdxCnt = UBound(m_CheckHMtrx)
            For w_IdxLoop = 1 To w_IdxCnt
                If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                    w_HolidayMtrxIdx = w_IdxLoop
                    Exit For
                End If
            Next w_IdxLoop

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                '4週/1ヶ月
                w_ObjSpread = sprSheet_4W

                '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                w_Var = w_ObjSpread.Sheets(0).GetText(pRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    If IsNumeric(w_Var) = True Then
                        w_StaffIdx = Integer.Parse(w_Var)
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_ObjSpread = Nothing
                        Exit Sub
                    End If
                Else
                    '職員情報が取得できないので処理抜け出し
                    w_ObjSpread = Nothing
                    Exit Sub
                End If

                '回数ﾁｪｯｸ
                If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_4WCol) = False Then
                    w_4WCol = M_KinmuData_Col
                End If

                w_4WCnt = UBound(m_4WeekKikan)

                For w_4WLoop = 1 To w_4WCnt
                    If m_4WeekKikan(w_4WLoop).KinmuDataStartCol <= w_4WCol AndAlso w_4WCol <= m_4WeekKikan(w_4WLoop).KinmuDataEndCol Then
                        w_Check4WCol = m_4WeekKikan(w_4WLoop).KinmuDataStartCol
                        Exit For
                    End If
                Next w_4WLoop

                '禁止パターン
                If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                    w_Var = DirectCast(m_KeikakuKikan.StartDate, Object)

                    If Get_Col_4W(w_Var, w_NotPattern4WCol) = False Then
                        w_NotPattern4WCol = M_KinmuData_Col
                    End If

                    w_IntervalStartCol = w_NotPattern4WCol
                Else
                    If w_HolidayMtrxIdx = -1 Then
                        w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")

                        If Get_Col_4W(w_Var, w_NotPattern4WCol) = False Then
                            w_NotPattern4WCol = M_KinmuData_Col
                        End If

                        w_IntervalStartCol = w_NotPattern4WCol
                    Else
                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 1 > 4 Then
                            w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -1 * (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2), Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")
                        Else
                            w_Var = Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd")
                        End If

                        If Get_Col_4W(Format(Date.Parse(DateAdd(DateInterval.Day, -3, Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd"), w_NotPattern4WCol) = False Then
                            w_NotPattern4WCol = M_KinmuData_Col
                        End If

                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 Then
                            If Get_Col_4W(Format(Date.Parse(DateAdd(DateInterval.Day, -1 * (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2), Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), "yyyyMMdd"), w_IntervalStartCol) = False Then
                                w_IntervalStartCol = M_KinmuData_Col
                            End If
                        Else
                            If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_IntervalStartCol) = False Then
                                w_IntervalStartCol = M_KinmuData_Col
                            End If
                        End If
                    End If
                End If

                If Get_Col_4W(w_Var, w_GetCol) = False Then
                    w_GetCol = w_Check4WCol + 1
                End If

                If w_GetCol < w_Check4WCol Then
                    w_StartCol = w_GetCol
                Else
                    w_StartCol = w_Check4WCol
                End If

                '終了ｾﾙ
                w_EndCol = m_4WeekKikan(w_4WCnt).KinmuDataEndCol
                '禁止パターン用勤務取得終了ｾﾙ
                w_Var = DirectCast(m_KeikakuKikan.EndDate, Object)
                If Get_Col_4W(w_Var, w_NotPatternEndCol) = False Then
                    w_NotPatternEndCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                End If

                '休みｶｳﾝﾄ対象期間
                ReDim w_CountTarget(w_4WCnt - w_4WLoop + 1)
                w_IdxCnt = 0
                For w_IdxLoop = w_4WLoop To w_4WCnt
                    w_IdxCnt = w_IdxCnt + 1
                    w_CountTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                    w_CountTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                Next w_IdxLoop

                '計画表示対象期間
                ReDim w_PlanTarget(w_4WCnt - w_4WLoop + 1)
                w_IdxCnt = 0
                For w_IdxLoop = w_4WLoop To w_4WCnt
                    w_IdxCnt = w_IdxCnt + 1
                    If w_IdxLoop = w_4WLoop Then
                        w_PlanTarget(w_IdxCnt).StartCol = w_4WCol
                        w_PlanTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                    ElseIf w_IdxLoop = w_4WCnt Then
                        w_PlanTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                        If Get_Col_4W(DirectCast(m_KeikakuKikan.EndDate, Object), w_4WCol) = False Then
                            w_4WCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                        End If
                        w_PlanTarget(w_IdxCnt).EndCol = w_4WCol
                    Else
                        w_PlanTarget(w_IdxCnt).StartCol = m_4WeekKikan(w_IdxLoop).KinmuDataStartCol
                        w_PlanTarget(w_IdxCnt).EndCol = m_4WeekKikan(w_IdxLoop).KinmuDataEndCol
                    End If
                Next w_IdxLoop
            Else
                '4週/4週，1ヶ月/1ヶ月
                w_ObjSpread = sprSheet_M

                '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                w_Var = w_ObjSpread.Sheets(0).GetText(pRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    If IsNumeric(w_Var) = True Then
                        w_StaffIdx = Integer.Parse(w_Var)
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_ObjSpread = Nothing
                        Exit Sub
                    End If
                Else
                    '職員情報が取得できないので処理抜け出し
                    w_ObjSpread = Nothing
                    Exit Sub
                End If

                '集計開始ｾﾙ（禁止パターン用に実績部分４日間も考慮する
                If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                    '実績期間がない場合
                    w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                    w_NotPattern4WCol = w_StartCol
                    w_IntervalStartCol = w_StartCol
                Else
                    If w_HolidayMtrxIdx = -1 Then
                        '実績期間がある場合（禁止パターン考慮(実績部分最後の４日間考慮する)）
                        w_StartCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                        w_IntervalStartCol = 0
                    Else
                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 1 > 4 Then
                            w_StartCol = m_JissekiKikan.KinmuDataEndCol - (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2)
                        Else
                            w_StartCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                        End If

                        If m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin > 0 Then
                            w_IntervalStartCol = m_JissekiKikan.KinmuDataEndCol - (m_StaffData(w_StaffIdx).KinmuCondition(w_HolidayMtrxIdx).IntervalMin - 2)
                        Else
                            w_IntervalStartCol = m_KeikakuKikan.KinmuDataStartCol
                        End If
                    End If
                    w_NotPattern4WCol = m_JissekiKikan.KinmuDataEndCol - (4 - 1)
                End If

                '終了ｾﾙ
                w_EndCol = m_KeikakuKikan.KinmuDataEndCol
                '禁止パターン用勤務取得終了ｾﾙ
                w_NotPatternEndCol = w_EndCol

                '休みｶｳﾝﾄ対象期間
                ReDim w_CountTarget(1)
                w_CountTarget(1).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_CountTarget(1).EndCol = m_KeikakuKikan.KinmuDataEndCol
                '休み間隔対象期間
                ReDim w_PlanTarget(1)
                w_PlanTarget(1).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_PlanTarget(1).EndCol = m_KeikakuKikan.KinmuDataEndCol
            End If

            'ｴﾗｰ格納変数の初期化を行う//////////////////////////////////////////////////////////////////
            '勤務回数/間隔
            w_IdxCnt = UBound(m_CheckHMtrx)
            w_CheckSpanCnt = UBound(w_CountTarget)

            w_intKikanIdx = UBound(g_KikanError2) + 1
            ReDim Preserve g_KikanError2(w_intKikanIdx)
            ReDim Preserve g_KikanError2(w_intKikanIdx).CheckSpan(0)
            ReDim Preserve g_KikanError2(w_intKikanIdx).InterValErr(0)

            For w_IdxLoop = 1 To w_IdxCnt
                g_KikanError2(w_intKikanIdx).ErrName = m_CheckHMtrx(w_IdxLoop).MtrxName
                g_KikanError2(w_intKikanIdx).ErrBunrui = m_CheckHMtrx(w_IdxLoop).BunruiCD
                g_KikanError2(w_intKikanIdx).StaffName = m_StaffData(w_StaffIdx).StaffName
                g_KikanError2(w_intKikanIdx).StaffIdx = pRow

                ReDim Preserve g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxCnt)
            Next w_IdxLoop

            '禁止パターン
            w_intPatternErrorIdx = UBound(g_NotPatternError2) + 1
            ReDim Preserve g_NotPatternError2(w_intPatternErrorIdx)

            g_NotPatternError2(w_intPatternErrorIdx).StaffIdx = pRow
            g_NotPatternError2(w_intPatternErrorIdx).StaffName = m_StaffData(w_StaffIdx).StaffName

            ReDim Preserve g_NotPatternError2(w_intPatternErrorIdx).Data(0)

            '否定勤務
            w_intKinmuErrorIdx = UBound(g_NotKinmuError2) + 1
            ReDim Preserve g_NotKinmuError2(w_intKinmuErrorIdx)

            g_NotKinmuError2(w_intKinmuErrorIdx).StaffIdx = pRow
            g_NotKinmuError2(w_intKinmuErrorIdx).StaffName = m_StaffData(w_StaffIdx).StaffName

            ReDim Preserve g_NotKinmuError2(w_intKinmuErrorIdx).Data(0)

            '禁止パターンの勤務群の最初の日付 初期化
            w_FirstDate = 0
            w_KinmuBlock = ""
            '休みｶｳﾝﾄ変数初期化
            w_HolInterval = 0

            '対象期間分Loop
            For w_Col = w_StartCol To w_EndCol

                w_NotPatternFlg = False
                w_HolIntervalFlg = False
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                    '4週/1ヶ月
                    w_4WCnt = UBound(m_4WeekKikan)
                    For w_4WLoop = 1 To w_4WCnt
                        If m_4WeekKikan(w_4WLoop).KinmuDataStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_4WLoop).KinmuDataEndCol Then
                            '勤務ﾃﾞｰﾀ表示範囲のｾﾙの場合（集計列を省く）
                            '勤務パターン考慮対象列検索
                            If w_NotPattern4WCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                                w_NotPatternFlg = True
                            End If
                            '休日間隔対象列検索
                            If w_IntervalStartCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                                w_HolIntervalFlg = True
                            End If
                            Exit For
                        End If
                    Next w_4WLoop
                Else
                    '4週/4週，1ヶ月/1ヶ月
                    '2015/04/10 Bando Add Start ==========================
                    If m_JissekiKikan.KinmuDataStartCol = 0 OrElse m_JissekiKikan.KinmuDataEndCol = -1 Then
                        '実績変更
                        w_PersonalStartCol = m_KeikakuKikan.PersonalStartCol
                        w_PersonalEndCol = m_KeikakuKikan.PersonalEndCol
                    Else
                        '新規計画
                        w_PersonalStartCol = m_JissekiKikan.PersonalStartCol
                        w_PersonalEndCol = m_JissekiKikan.PersonalEndCol
                    End If
                    '2015/04/10 Bando Add End   ==========================
                    If (m_JissekiKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_JissekiKikan.KinmuDataEndCol) OrElse (m_KeikakuKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                        '勤務ﾃﾞｰﾀ表示範囲のｾﾙの場合（集計列を省く）
                        '勤務パターン考慮対象列検索
                        If w_NotPattern4WCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                            w_NotPatternFlg = True
                        End If
                        '休日間隔対象列検索
                        If w_IntervalStartCol <= w_Col AndAlso w_Col <= w_NotPatternEndCol Then
                            w_HolIntervalFlg = True
                        End If
                    End If
                End If

                '日付を取得する
                w_DateVar = w_ObjSpread.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)

                '勤務を取得する
                If m_blnJissekiUseFlg AndAlso pPlanTwoFlg Then
                    '二段表示の時
                    w_Var = w_ObjSpread.Sheets(0).GetText(pRow + 1, w_Col)
                    If w_Var <> "" Then
                        'まず下段を確認する
                        w_blnFLG = True
                    Else
                        '下段にデータが存在しない時は上段を確認する
                        w_Var = w_ObjSpread.Sheets(0).GetText(pRow, w_Col)
                    End If
                Else
                    w_Var = w_ObjSpread.Sheets(0).GetText(pRow, w_Col)
                End If

                If w_Var <> "" Then
                    '勤務が取得できた場合のみ

                    '2015/04/10 Bando Add Start ==================================
                    '個人別集計列の場合、処理しない
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                        If w_4WLoop > UBound(m_4WeekKikan) Then
                            Continue For
                        Else
                            If m_4WeekKikan(w_4WLoop).PersonalStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_4WLoop).PersonalEndCol Then
                                '4週/1ヶ月
                                Continue For
                            End If
                        End If
                    Else
                        If w_PersonalStartCol <= w_Col AndAlso w_Col <= w_PersonalEndCol Then
                            '4週/4週，1ヶ月/1ヶ月
                            Continue For
                        End If
                    End If
                    '2015/04/10 Bando Add End   ==================================

                    '初期化
                    w_KinmuCD = ""

                    '取得勤務ﾃﾞｰﾀの詳細ｺｰﾄﾞ等を取得する
                    '2015/04/10 Bando Upd Start =====================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                    '2015/04/10 Bando Upd End   =====================================

                    If w_KinmuCD <> "" Then
                        '勤務ｺｰﾄﾞが取得できた場合のみ

                        '回数ｶｳﾝﾄ
                        w_CountFlg = False
                        For w_4WLoop = 1 To w_CheckSpanCnt
                            If w_CountTarget(w_4WLoop).StartCol <= w_Col AndAlso w_Col <= w_CountTarget(w_4WLoop).EndCol Then
                                w_CountFlg = True
                                Exit For
                            End If
                        Next w_4WLoop

                        If w_CountFlg = True Then
                            '集計
                            w_IdxCnt = UBound(m_CheckHMtrx)
                            For w_IdxLoop = 1 To w_IdxCnt
                                w_FindInt = InStr(m_CheckHMtrx(w_IdxLoop).CalcKinmuStr, w_KinmuCD) '集計対象勤務
                                If w_FindInt > 0 AndAlso w_KinmuCD <> "" Then
                                    '集計対象勤務の場合
                                    w_RatioIdx = (w_FindInt \ 4) + 1 '勤務CD３桁化

                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            If m_4WeekKikan(cmbKikan.SelectedIndex).StartDate <= w_DateVar AndAlso m_4WeekKikan(cmbKikan.SelectedIndex).EndDate >= w_DateVar Then

                                                '４週毎の集計
                                                g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount = g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)

                                                '回数不正の最初の日付
                                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True AndAlso g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = 0 Then
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = Integer.Parse(w_DateVar)
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ColIdx = w_Col
                                                End If
                                            End If
                                        Else
                                            If m_4WeekKikan(cmbKikan.SelectedIndex + 1).StartDate <= w_DateVar AndAlso m_4WeekKikan(cmbKikan.SelectedIndex + 1).EndDate >= w_DateVar Then
                                                '４週毎の集計
                                                g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount = g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)

                                                '回数不正の最初の日付
                                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True AndAlso g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = 0 Then
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = Integer.Parse(w_DateVar)
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ColIdx = w_Col
                                                End If
                                            End If
                                        End If
                                    Else
                                        '１ヶ月期間内のチェックは日付で行う
                                        If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                            If m_KeikakuKikan.StartDate <= w_DateVar AndAlso w_DateVar <= m_KeikakuKikan.EndDate Then
                                                '計画期間内なら１ヶ月集計にも加算する
                                                g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount = g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount + m_CheckHMtrx(w_IdxLoop).Ratio(w_RatioIdx)

                                                '回数不正の最初の日付
                                                If g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = 0 Then
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorDate = Integer.Parse(w_DateVar)
                                                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ColIdx = w_Col
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            Next w_IdxLoop
                        End If

                        '表示期間内の列？
                        w_TargetPlanFlg = False
                        w_IdxCnt = UBound(w_PlanTarget)

                        For w_IdxLoop = 1 To w_IdxCnt
                            If w_PlanTarget(w_IdxLoop).StartCol <= w_Col AndAlso w_Col <= w_PlanTarget(w_IdxLoop).EndCol Then
                                w_TargetPlanFlg = True
                                Exit For
                            End If
                        Next w_IdxLoop

                        '間隔、否定チェック
                        If w_TargetPlanFlg = True Then
                            '計画期間内で所属している日のみが対象

                            If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then

                                w_IntervalFlg = False
                                w_IdxCnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                For w_IdxLoop = 1 To w_IdxCnt
                                    If m_StaffData(w_StaffIdx).IdoData(w_IdxLoop).IdoYMD <= Integer.Parse(w_DateVar) AndAlso Integer.Parse(w_DateVar) <= m_StaffData(w_StaffIdx).IdoData(w_IdxLoop).SyuryoYMD Then
                                        w_IntervalFlg = True
                                        Exit For
                                    End If
                                Next w_IdxLoop

                                If w_IntervalFlg = True Then
                                    '配属期間内の場合
                                    w_IdxCnt = UBound(m_CheckHMtrx)
                                    For w_IdxLoop = 1 To w_IdxCnt 'このループは、複数の集計項目に同一の勤務ｺｰﾄﾞが含まれている場合を考慮するためです。（実際に発生するかは？？？）
                                        If InStr(m_CheckHMtrx(w_IdxLoop).CalcKinmuStr, w_KinmuCD) > 0 Then

                                            '間隔チェック
                                            'ｴﾗｰでなく、休み以外の場合にﾁｪｯｸを行う
                                            If CheckRule_Interval2(w_IdxLoop, w_Col, pRow, w_StaffIdx, w_KinmuCD, pPlanTwoFlg) = False Then
                                                'ｴﾗｰ発生
                                                w_intDataIdx = UBound(g_KikanError2(w_intKikanIdx).InterValErr) + 1
                                                ReDim Preserve g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx)

                                                g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx).ErrorFlg = True 'ｴﾗｰ
                                                If g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx).ErrorDate = 0 Then
                                                    g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx).ErrorDate = Integer.Parse(w_DateVar) 'ｴﾗｰが発生している日
                                                    g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx).ColIdx = w_Col
                                                End If
                                                g_KikanError2(w_intKikanIdx).InterValErr(w_intDataIdx).ErrorName = m_CheckHMtrx(w_IdxLoop).MtrxName
                                            End If

                                            '否定チェック
                                            If CheckRule_NotKinmu(w_IdxLoop, w_StaffIdx, Integer.Parse(w_DateVar)) = False Then
                                                w_intDataIdx = UBound(g_NotKinmuError2(w_intKinmuErrorIdx).Data) + 1
                                                ReDim Preserve g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx)

                                                'ｴﾗｰ
                                                g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx).ErrorFlg = True 'ｴﾗｰ
                                                g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx).ErrorDate = Integer.Parse(w_DateVar) 'ｴﾗｰが発生している日
                                                g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx).ColIdx = w_Col
                                                If IsNumeric(w_KinmuCD) = True Then
                                                    g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx).KinmuName = g_KinmuM(Integer.Parse(w_KinmuCD)).Mark
                                                Else
                                                    g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_intDataIdx).KinmuName = "　"
                                                End If
                                            End If
                                        End If '---> 取得勤務に該当する集計項目
                                    Next w_IdxLoop '---> 集計項目数Loop
                                End If '---> 配属？
                            End If '---> 日付の妥当性ﾁｪｯｸ
                        End If '---> 計画期間？

                        '禁止勤務パターン
                        If w_NotPatternFlg = True Then
                            If w_FirstDate = 0 Then
                                '日付を取得していない場合は日付を取得
                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                    w_FirstDate = Integer.Parse(w_DateVar)
                                    w_KinmuBlock = w_KinmuBlock & w_KinmuCD & ","
                                End If
                            Else
                                'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                                w_KinmuBlock = w_KinmuBlock & w_KinmuCD & ","
                            End If
                        End If
                    Else
                        '勤務ｺｰﾄﾞが取得できなかった場合

                        '禁止勤務パターン
                        If w_NotPatternFlg = True Then
                            If w_FirstDate = 0 Then
                                '日付を取得していない場合は日付を取得
                                If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                    w_FirstDate = Integer.Parse(w_DateVar)
                                    w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                                End If
                            Else
                                'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                                w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                            End If
                        End If
                    End If '---> 勤務ｺｰﾄﾞ取得ＯＫ？
                Else
                    '勤務ｺｰﾄﾞが取得できなかった場合

                    '休みの間隔ｶｳﾝﾄ
                    '禁止勤務パターン
                    If w_NotPatternFlg = True Then
                        If w_FirstDate = 0 Then
                            '日付を取得していない場合は日付を取得
                            If IsDate(Format(Integer.Parse(w_DateVar), "0000/00/00")) = True Then
                                w_FirstDate = Integer.Parse(w_DateVar)
                                w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                            End If
                        Else
                            'すでに日付を取得している場合は勤務ｺｰﾄﾞのみ取得
                            w_KinmuBlock = w_KinmuBlock & Space(3) & "," '勤務CD３桁化
                        End If
                    End If
                End If '---> 勤務取得ＯＫ？
            Next w_Col

            '=================================================================
            '   ｴﾗｰﾁｪｯｸ用 集計終了  回数、禁止パターンチェック
            '=================================================================
            '回数チェック
            w_IdxCnt = UBound(m_CheckHMtrx)
            For w_IdxLoop = 1 To w_IdxCnt

                '勤務の場合（常に1ヶ月(4週/4週の場合は4週)単位でチェック）
                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week OrElse m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0) AndAlso m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                    w_lngCount = 8
                Else
                    w_lngCount = m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).CountMax
                End If

                If g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuCount > w_lngCount AndAlso w_lngCount > 0 Then
                    '集計値が設定値より大きい場合エラー
                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorFlg = True
                    g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).KinmuName = m_CheckHMtrx(w_IdxLoop).MtrxName
                End If

            Next w_IdxLoop

            '禁止勤務パターンチェック
            w_IdxCnt = UBound(m_NotPattern)

            w_DateDiff = DateDiff(DateInterval.Day, Date.Parse(Format(w_FirstDate, "0000/00/00")), Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")))

            For w_IdxLoop = 1 To w_IdxCnt

                w_StartInt = 1
                w_SearchCnt = w_DateDiff - m_NotPattern(w_IdxLoop).PatternCount + 1

                ReDim w_FindInt2(0)

                Do
                    '禁止勤務パターンが存在しているか
                    If m_NotPattern(w_IdxLoop).PatternKinmu = "" Then
                        w_FindInt2(UBound(w_FindInt2)) = 0
                        Exit Do
                    Else
                        For w_SearchLoop = 1 To w_SearchCnt
                            'ﾊﾟﾀｰﾝﾁｪｯｸ開始位置取得
                            w_StartInt = InStr(w_StartInt, w_KinmuBlock, ",") + 1
                        Next w_SearchLoop

                        If UBound(w_FindInt2) > 0 Then
                            If w_FindInt2(UBound(w_FindInt2) - 1) <> InStr(w_FindInt2(UBound(w_FindInt2) - 1) + 1, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu) AndAlso InStr(w_FindInt2(UBound(w_FindInt2) - 1) + 1, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu) > 0 Then
                                w_FindInt2(UBound(w_FindInt2)) = InStr(w_FindInt2(UBound(w_FindInt2) - 1) + 1, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu)
                                ReDim Preserve w_FindInt2(UBound(w_FindInt2) + 1)
                            ElseIf InStr(w_FindInt2(UBound(w_FindInt2) - 1) + 1, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu) = 0 Then
                                Exit Do
                            End If
                        Else
                            If InStr(w_StartInt, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu) > 0 Then
                                w_FindInt2(UBound(w_FindInt2)) = InStr(w_StartInt, w_KinmuBlock, m_NotPattern(w_IdxLoop).PatternKinmu)
                                w_SearchCnt = w_SearchCnt + w_FindInt2(UBound(w_FindInt2))
                                ReDim Preserve w_FindInt2(UBound(w_FindInt2) + 1)
                            Else
                                Exit Do
                            End If
                        End If
                    End If
                Loop

                For w_Int = 0 To UBound(w_FindInt2)
                    '禁止パターンが存在していた場合
                    If w_FindInt2(w_Int) > 0 Then

                        '禁止パターンが何日目からか
                        w_DayCnt = (w_FindInt2(w_Int) \ 4) + 1 '勤務CD３桁化

                        '該当パターンの初日取得
                        w_PatternStart = Integer.Parse(Format(DateAdd(DateInterval.Day, w_DayCnt - 1, Date.Parse(Format(w_FirstDate, "0000/00/00"))), "yyyyMMdd"))
                        w_ChkDate = w_PatternStart

                        w_PatternFlg = False
                        For w_PatternCnt = 1 To m_NotPattern(w_IdxLoop).PatternCount
                            w_4WCnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                            For w_4WLoop = 1 To w_4WCnt
                                If m_StaffData(w_StaffIdx).IdoData(w_4WLoop).IdoYMD <= w_ChkDate AndAlso w_ChkDate <= m_StaffData(w_StaffIdx).IdoData(w_4WLoop).SyuryoYMD Then
                                    w_PatternFlg = True
                                    Exit For
                                End If
                            Next w_4WLoop
                            w_ChkDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(w_ChkDate, "0000/00/00"))), "yyyyMMdd"))
                        Next w_PatternCnt

                        If w_PatternFlg = True Then

                            '禁止勤務パターンエラー
                            'より計画期間開始日に近い禁止パターンをエラーとする
                            w_TempDay = w_DayCnt

                            w_intDataIdx = UBound(g_NotPatternError2(w_intPatternErrorIdx).Data) + 1
                            ReDim Preserve g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx)

                            g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorFlg = True
                            g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorDate = w_PatternStart
                            g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern = ""

                            For w_Col = w_StartCol To w_EndCol
                                '日付を取得する
                                w_DateVar = w_ObjSpread.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If String.IsNullOrEmpty(w_DateVar) = False AndAlso Double.Parse(w_DateVar) = w_PatternStart Then
                                    g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ColIdx = w_Col
                                    Exit For
                                End If
                            Next w_Col

                            g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).EndDate = Double.Parse(Format(DateAdd(DateInterval.Day, m_NotPattern(w_IdxLoop).PatternCount, Date.Parse(Format(w_PatternStart, "0000/00/00"))), "yyyyMMdd")) - 1

                            For w_PatternCnt = 1 To m_NotPattern(w_IdxLoop).PatternCount
                                If w_PatternCnt = m_NotPattern(w_IdxLoop).PatternCount Then
                                    w_ConnectMark = ""
                                Else
                                    w_ConnectMark = "-"
                                End If

                                w_PatternCode = Mid(m_NotPattern(w_IdxLoop).PatternKinmu, (4 * w_PatternCnt) - 3, 3) '勤務CD３桁化
                                If IsNumeric(w_PatternCode) = True Then
                                    If g_KinmuM(Integer.Parse(w_PatternCode)).Mark = "" Then
                                        g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern = g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern & Space(3) & w_ConnectMark '勤務CD３桁化
                                    Else
                                        g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern = g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern & g_KinmuM(Integer.Parse(w_PatternCode)).Mark & w_ConnectMark
                                    End If
                                Else
                                    g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern = g_NotPatternError2(w_intPatternErrorIdx).Data(w_intDataIdx).ErrorPattern & Space(3) & w_ConnectMark '勤務CD３桁化
                                End If
                            Next w_PatternCnt
                        End If
                    End If
                Next w_Int
            Next w_IdxLoop

            'ｽﾌﾟﾚｯﾄﾞｵﾌﾞｼﾞｪｸﾄの解放
            w_ObjSpread = Nothing

            '=================================================================
            '   エラーが発生しているかチェックする
            '=================================================================
            m_StaffData(w_StaffIdx).PersonalError = False '初期化

            '回数チェック
            If m_lstmnuCheck(M_MenuKinmuCount).Checked = True Then
                w_IdxCnt = UBound(m_CheckHMtrx)
                For w_IdxLoop = 1 To w_IdxCnt
                    If m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" Then
                        '休み
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                            '4週/1ヶ月
                            w_4WCnt = UBound(g_KikanError2(w_intKikanIdx).CheckSpan)
                            For w_4WLoop = 1 To w_4WCnt
                                '各計画期間毎にチェック
                                If g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorFlg = True Then
                                    m_StaffData(w_StaffIdx).PersonalError = True
                                    Exit Sub
                                End If
                            Next w_4WLoop
                        Else
                            '1ヶ月/1ヶ月
                            If g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorFlg = True Then
                                m_StaffData(w_StaffIdx).PersonalError = True
                                Exit Sub
                            End If
                        End If
                    Else
                        '勤務
                        If g_KikanError2(w_intKikanIdx).CheckSpan(w_IdxLoop).ErrorFlg = True Then
                            m_StaffData(w_StaffIdx).PersonalError = True
                            Exit Sub
                        End If
                    End If

                Next w_IdxLoop
            End If

            '間隔チェック
            If m_lstmnuCheck(M_MenuKinmuInterval).Checked = True Then
                w_IdxCnt = UBound(g_KikanError2(w_intKikanIdx).InterValErr)
                For w_IdxLoop = 1 To w_IdxCnt
                    If g_KikanError2(w_intKikanIdx).InterValErr(w_IdxLoop).ErrorFlg = True Then
                        m_StaffData(w_StaffIdx).PersonalError = True
                        Exit Sub
                    End If
                Next w_IdxLoop
            End If

            '禁止パターンチェック
            If m_lstmnuCheck(M_MenuKinmuPattern).Checked = True Then
                For w_IdxLoop = 1 To UBound(g_NotPatternError2(w_intPatternErrorIdx).Data)
                    If g_NotPatternError2(w_intPatternErrorIdx).Data(w_IdxLoop).ErrorFlg = True Then
                        m_StaffData(w_StaffIdx).PersonalError = True
                        Exit Sub
                    End If
                Next w_IdxLoop
            End If

            '否定勤務チェック
            If m_lstmnuCheck(M_MenuKinsiKinmu).Checked = True Then
                For w_IdxLoop = 1 To UBound(g_NotKinmuError2(w_intKinmuErrorIdx).Data)
                    If g_NotKinmuError2(w_intKinmuErrorIdx).Data(w_IdxLoop).ErrorFlg = True Then
                        m_StaffData(w_StaffIdx).PersonalError = True
                        Exit Sub
                    End If
                Next w_IdxLoop
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｴﾗｰﾁｪｯｸ用集計
    '   与えられた行番号の集計・ｴﾗｰﾁｪｯｸを行う
    Private Sub Check_PersonalCalc3(ByVal pRow As Integer, ByVal pPlanTwoFlg As Boolean)
        Const W_SUBNAME As String = "NSK0000HA Check_PersonalCalc3"

        Dim w_Var As Object
        Dim w_StaffIdx As Integer
        Dim w_DateVar As Object
        Dim w_KinmuCD As String
        Dim w_IdxLoop As Integer
        Dim w_KinmuCnt() As Integer
        Dim w_ErrCnt As Integer

        Try
            w_ErrCnt = UBound(g_RenzokuError2)
            ReDim w_KinmuCnt(UBound(m_CheckHMtrx))

            '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            w_Var = sprSheet_M.Sheets(0).GetText(pRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
            If String.IsNullOrEmpty(w_Var) Then
                '職員情報が取得できないので処理抜け出し
                Exit Sub
            Else
                If IsNumeric(w_Var) Then
                    w_StaffIdx = w_Var
                Else
                    '職員情報が取得できないので処理抜け出し
                    Exit Sub
                End If
            End If

            '過去データ参照
            Call subGetResultCntData(w_StaffIdx)

            For i As Integer = 1 To UBound(m_CheckHMtrx)
                w_KinmuCnt(i) = m_StaffData(w_StaffIdx).ResultCnt(i)
            Next

            For w_Col As Integer = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '日付を取得する
                w_DateVar = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)

                '勤務を取得する
                If m_blnJissekiUseFlg AndAlso pPlanTwoFlg Then
                    '二段表示の時
                    w_Var = sprSheet_M.Sheets(0).GetText(pRow + 1, w_Col)
                    If String.IsNullOrEmpty(w_Var) Then
                        '下段にデータが存在しない時は上段を確認する
                        w_Var = sprSheet_M.Sheets(0).GetText(pRow, w_Col)
                    End If
                Else
                    w_Var = sprSheet_M.Sheets(0).GetText(pRow, w_Col)
                End If

                w_KinmuCD = ""

                '取得勤務ﾃﾞｰﾀの詳細ｺｰﾄﾞ等を取得する
                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")

                If String.IsNullOrEmpty(w_KinmuCD) Then
                    '勤務が無い場合、カウント初期化
                    For w_IdxLoop = 1 To UBound(m_CheckHMtrx)
                        w_KinmuCnt(w_IdxLoop) = 0
                    Next
                Else
                    For w_IdxLoop = 1 To UBound(m_CheckHMtrx)
                        If InStr(m_CheckHMtrx(w_IdxLoop).CalcKinmuStr, w_KinmuCD) > 0 Then
                            w_KinmuCnt(w_IdxLoop) = w_KinmuCnt(w_IdxLoop) + 1
                        Else
                            w_KinmuCnt(w_IdxLoop) = 0
                        End If

                        If (m_CheckHMtrx(w_IdxLoop).BunruiCD <> "30" AndAlso
                                m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).RenzokuCountMax < w_KinmuCnt(w_IdxLoop) AndAlso
                                m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).RenzokuCountMax > 0) OrElse
                                (m_CheckHMtrx(w_IdxLoop).BunruiCD = "30" AndAlso
                                m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).RenkyuCountMax < w_KinmuCnt(w_IdxLoop) AndAlso
                                m_StaffData(w_StaffIdx).KinmuCondition(w_IdxLoop).RenkyuCountMax > 0) Then
                            '連続勤務回数が設定値より大きい場合エラー
                            If w_ErrCnt > 0 AndAlso
                                    g_RenzokuError2(w_ErrCnt).StaffIdx = pRow AndAlso
                                    g_RenzokuError2(w_ErrCnt).CheckSpan(0).KinmuName = m_CheckHMtrx(w_IdxLoop).MtrxName AndAlso
                                    g_RenzokuError2(w_ErrCnt).CheckSpan(0).KinmuCount < w_KinmuCnt(w_IdxLoop) Then
                                '更新
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).ErrorDate = w_DateVar
                                If m_SelViewKikan = 0 Then
                                    g_RenzokuError2(w_ErrCnt).CheckSpan(0).ColIdx = w_Col
                                Else
                                    If Not Get_Col_4W(w_DateVar, g_RenzokuError2(w_ErrCnt).CheckSpan(0).ColIdx) Then
                                        Exit Sub
                                    End If
                                End If
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).KinmuCount = w_KinmuCnt(w_IdxLoop)
                            Else
                                w_ErrCnt = w_ErrCnt + 1
                                ReDim Preserve g_RenzokuError2(w_ErrCnt)
                                ReDim g_RenzokuError2(w_ErrCnt).CheckSpan(0)
                                g_RenzokuError2(w_ErrCnt).StaffName = m_StaffData(w_StaffIdx).StaffName
                                g_RenzokuError2(w_ErrCnt).StaffIdx = pRow
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).ErrorFlg = True
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).ErrorDate = w_DateVar
                                If m_SelViewKikan = 0 Then
                                    g_RenzokuError2(w_ErrCnt).CheckSpan(0).ColIdx = w_Col
                                Else
                                    If Not Get_Col_4W(w_DateVar, g_RenzokuError2(w_ErrCnt).CheckSpan(0).ColIdx) Then
                                        Exit Sub
                                    End If
                                End If
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).KinmuName = m_CheckHMtrx(w_IdxLoop).MtrxName
                                g_RenzokuError2(w_ErrCnt).CheckSpan(0).KinmuCount = w_KinmuCnt(w_IdxLoop)
                            End If
                        End If
                    Next
                End If
            Next

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub


    Private Sub Set_Cursor(ByVal p_RowIdx As Integer, ByVal p_ColIdx As Integer)

        Const W_SUBNAME As String = "NSK0000HA Set_Cursor"

        Dim w_ObjSpread As FpSpread
        Try
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_SelViewKikan <> 0 Then
                '4週/1ヶ月
                w_ObjSpread = sprSheet_4W
            Else
                '4週/4週，1ヶ月/1ヶ月
                w_ObjSpread = sprSheet_M
            End If

            w_ObjSpread.Sheets(0).SetActiveCell(p_RowIdx, p_ColIdx)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '否定勤務のｴﾗｰﾁｪｯｸを行う
    '   引き数：pMtrx----->エラーチェック集計項目
    '   　　　　pIndex---->該当行の職員格納変数配列ｲﾝﾃﾞｯｸｽ
    '   　　　　pDate----->該当列の日付
    '   戻り値：チェック結果 ---> True:ｴﾗｰなし，False:ｴﾗｰ
    Private Function CheckRule_NotKinmu(ByVal pMtrx As Integer, ByVal pIndex As Integer, ByVal pDate As Integer) As Boolean
        Const W_SUBNAME As String = "NSK0000HA CheckRule_NotKinmu"
        Try
            '勤務自体の割当可否（曜日考慮しない）
            If m_StaffData(pIndex).KinmuCondition(pMtrx).NotKinmu = True Then
                CheckRule_NotKinmu = False
                Exit Function
            End If

            '***** 各曜日ごとの割当可否 *******
            If IsDate(Format(pDate, "0000/00/00")) = False Then
                '日付として判断できないので、ｴﾗｰなしとして処理抜け出し
                CheckRule_NotKinmu = True
                Exit Function
            End If

            Select Case Weekday(Date.Parse(Format(pDate, "0000/00/00")))

                Case FirstDayOfWeek.Monday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).MondayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Tuesday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).TuesdayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Wednesday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).WednesdayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Thursday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).ThursdayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Friday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).FridayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Saturday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).FridayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

                Case FirstDayOfWeek.Sunday
                    If m_StaffData(pIndex).KinmuCondition(pMtrx).SundayNot = True Then
                        CheckRule_NotKinmu = False
                        Exit Function
                    End If

            End Select

            'ｴﾗｰなし
            CheckRule_NotKinmu = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '自動割当用I/Fﾃﾞｰﾀ作成
    Private Sub CreateAutoSchedIFData()
        Const W_SUBNAME As String = "NSK0000HA CreateAutoSchedIFData"

        Dim w_FilePath As String
        Dim w_FileNo As Integer
        Dim w_FileText As String = ""    '2014/06/19 TAKEBAYASHI P-07100 UPD (空文字をﾃﾞﾌｫﾙﾄ値として指定)
        Dim w_Spr As FpSpread
        Dim w_SystemType As Integer '(1:4週／1ヶ月，2:4週／4週、1ヶ月／1ヶ月）
        Dim w_Row As Integer
        Dim w_OpenFlg As Boolean
        Dim w_Var As Object
        Dim w_DataIndex As Integer
        Dim w_Col As Integer
        Dim w_TargetCol As Integer
        Dim w_DefData As String
        Dim w_KinmuDataCol() As DataHyojiCol_Type '（StartColとEndColの構造体）
        Dim w_Loop As Integer
        Dim w_KinmuCode As String
        Dim w_RiyuKBN As String
        Dim w_Time As String
        Dim w_Flg As String = String.Empty
        Dim w_Another As Boolean
        Dim w_IdoLoop As Integer
        Dim w_KangoCD As String
        Dim w_CurrentDate As Integer
        Dim w_JikanCnt As Integer
        Dim w_OuenCnt As Integer
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            'I/Fﾌｧｲﾙのパス、ファイル名取得
            w_FilePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "DataPath", "")
            w_FilePath = w_FilePath & "Schedif.dat"

            '空ﾌｧｲﾙ№取得
            w_FileNo = FreeFile()

            'I/Fﾃｷｽﾄﾌｧｲﾙ OPEN
            FileOpen(w_FileNo, w_FilePath, OpenMode.Output, OpenAccess.Write, OpenShare.LockReadWrite)
            w_OpenFlg = True

            'システム形態により取り込みｽﾌﾟﾚｯﾄﾞ変更
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週／1ヶ月の場合
                w_SystemType = 1
                ReDim w_KinmuDataCol(UBound(m_4WeekKikan))
                For w_Loop = 1 To UBound(m_4WeekKikan)
                    w_KinmuDataCol(w_Loop).StartCol = m_4WeekKikan(w_Loop).KinmuDataStartCol
                    w_KinmuDataCol(w_Loop).EndCol = m_4WeekKikan(w_Loop).KinmuDataEndCol
                Next w_Loop
                w_Spr = sprSheet_4W
            Else
                '4週／4週、1ヶ月／1ヶ月の場合
                w_SystemType = 2
                ReDim w_KinmuDataCol(2)
                w_KinmuDataCol(1).StartCol = m_JissekiKikan.KinmuDataStartCol
                w_KinmuDataCol(1).EndCol = m_JissekiKikan.KinmuDataEndCol
                w_KinmuDataCol(2).StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_KinmuDataCol(2).EndCol = m_KeikakuKikan.KinmuDataEndCol
                w_Spr = sprSheet_M
            End If

            With w_Spr.Sheets(0)
                '職員ﾃﾞｰﾀ格納配列Index取得
                If w_SystemType = 1 Then
                    w_TargetCol = m_StaffZokusei(M_HairetuNo).SetCol_4W
                Else
                    w_TargetCol = m_StaffZokusei(M_HairetuNo).SetCol_M
                End If

                '職員数分Loop
                '計画画面複数段対応
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        w_Var = .GetText(w_Row, w_TargetCol)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then
                                'データ配列Indexを取得
                                w_DataIndex = Integer.Parse(w_Var)

                                '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) START-->>
                                If m_SelTeamNo = 0 Or m_SelTeamNo = m_StaffData(w_DataIndex).Team Then
                                    '職員管理番号（10桁左詰 後ろスペース）
                                    w_FileText = General.paLeft(m_StaffData(w_DataIndex).ID & Space(10), 10)
                                    'SkillLvlCD（4桁左詰 後ろスペース）
                                    w_FileText = w_FileText & General.paLeft(m_StaffData(w_DataIndex).GiryoLvCD & Space(4), 4)
                                    '自動割当対象区分
                                    If m_StaffData(w_DataIndex).AutoKBN = "1" OrElse m_StaffData(w_DataIndex).AutoKBN = "2" Then
                                        w_DefData = m_StaffData(w_DataIndex).AutoKBN
                                    Else
                                        w_DefData = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY6, "DEFAUTOKBN", "2", General.g_strHospitalCD) 'ﾃﾞﾌｫﾙﾄ技量ﾚﾍﾞﾙCD
                                        If w_DefData <> "1" AndAlso w_DefData <> "2" Then
                                            w_DefData = "2"
                                        End If
                                    End If
                                    w_FileText = w_FileText & General.paLeft(w_DefData & Space(1), 1)
                                    'ﾁｰﾑ番号
                                    If m_StaffData(w_DataIndex).Team <= 0 OrElse 10 <= m_StaffData(w_DataIndex).Team Then
                                        w_DefData = "1"
                                    Else
                                        w_DefData = Convert.ToString(m_StaffData(w_DataIndex).Team)
                                    End If
                                    w_FileText = w_FileText & w_DefData
                                End If
                                '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) END<<--

                                '時間年休用配列初期化
                                ReDim m_StaffData(w_DataIndex).WariateJikanNenkyu(0)

                                '応援勤務用配列初期化
                                ReDim m_StaffData(w_DataIndex).WariateOuenKinmu(0)

                                '2015/04/10 Bando Add Start ================
                                '希望コメント用配列初期化
                                ReDim m_StaffData(w_DataIndex).WariateComment(0)
                                '2015/04/10 Bando Add End   ================

                                '勤務ﾃﾞｰﾀ取得（対象期間分Loop）
                                For w_Loop = 1 To UBound(w_KinmuDataCol)
                                    '対象期間列分Loop
                                    For w_Col = w_KinmuDataCol(w_Loop).StartCol To w_KinmuDataCol(w_Loop).EndCol
                                        '他部署のデータ確認ﾌﾗｸﾞ初期化
                                        w_Another = False

                                        '年月日を取得し、実績・配属？ﾁｪｯｸを行う
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            If IsNumeric(w_Var) = True Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                                '計画期間内のデータならば異動ﾁｪｯｸ
                                                If m_KeikakuKikan.StartDate <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_KeikakuKikan.EndDate Then
                                                    '異動ﾁｪｯｸ
                                                    w_Another = True '他部署異動として設定する
                                                    For w_IdoLoop = 1 To UBound(m_StaffData(w_DataIndex).IdoData)
                                                        If m_StaffData(w_DataIndex).IdoData(w_IdoLoop).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_DataIndex).IdoData(w_IdoLoop).SyuryoYMD Then
                                                            '該当部署所属日
                                                            w_Another = False
                                                            Exit For
                                                        End If
                                                    Next w_IdoLoop
                                                End If
                                            End If
                                        End If

                                        '勤務ｺｰﾄﾞ、理由区分用変数初期化
                                        w_KinmuCode = ""
                                        w_RiyuKBN = ""
                                        w_KangoCD = ""
                                        w_Time = ""

                                        'ｽﾌﾟﾚｯﾄﾞに設定されている勤務データを取得する
                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            '取得ｽﾌﾟﾚｯﾄﾞﾃｷｽﾄを各勤務ﾃﾞｰﾀに分割する
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Var, w_KinmuCode, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                            Call Get_KinmuMark(w_Var, w_KinmuCode, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                            '2015/04/10 Bando Upd Start =========================================

                                            If General.g_lngDaikyuMng = 0 Then
                                                If Check_DaikyuRunAuto(w_CurrentDate, w_DataIndex) = True Then
                                                    w_RiyuKBN = "7"
                                                End If
                                            End If
                                        End If

                                        '勤務データを取得し出力変数に設定
                                        If w_Another = True Then
                                            '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) START-->>
                                            If m_SelTeamNo = 0 Or m_SelTeamNo = m_StaffData(w_DataIndex).Team Then
                                                '他部署所属
                                                If IsNumeric(w_KinmuCode) = True Then
                                                    w_FileText = w_FileText & General.paLeft(Format(Integer.Parse(w_KinmuCode), "000"), 3)
                                                Else
                                                    w_FileText = w_FileText & General.G_MiwariateCD
                                                End If
                                                w_FileText = w_FileText & "9"
                                            End If
                                            '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) END<<--
                                        Else
                                            '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) START-->>
                                            If m_SelTeamNo = 0 Or m_SelTeamNo = m_StaffData(w_DataIndex).Team Then
                                                '該当部署所属 Or 実績期間
                                                If IsNumeric(w_KinmuCode) = True Then
                                                    w_FileText = w_FileText & General.paLeft(Format(Integer.Parse(w_KinmuCode), "000"), 3)
                                                    w_FileText = w_FileText & w_RiyuKBN
                                                Else
                                                    w_FileText = w_FileText & General.G_MiwariateCD
                                                    w_FileText = w_FileText & "0"
                                                End If
                                            End If
                                            '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) END<<--

                                            '時間年休データ
                                            If w_Time <> "" Then
                                                w_JikanCnt = UBound(m_StaffData(w_DataIndex).WariateJikanNenkyu) + 1
                                                ReDim Preserve m_StaffData(w_DataIndex).WariateJikanNenkyu(w_JikanCnt)
                                                m_StaffData(w_DataIndex).WariateJikanNenkyu(w_JikanCnt).StrData = w_Time
                                                m_StaffData(w_DataIndex).WariateJikanNenkyu(w_JikanCnt).Date_Renamed = w_CurrentDate
                                            End If

                                            '応援看護データ
                                            'If w_KangoCD <> "" Then
                                            If w_RiyuKBN = "6" Then '2018/03/01 Yamanishi Upd
                                                w_OuenCnt = UBound(m_StaffData(w_DataIndex).WariateOuenKinmu) + 1
                                                ReDim Preserve m_StaffData(w_DataIndex).WariateOuenKinmu(w_OuenCnt)
                                                m_StaffData(w_DataIndex).WariateOuenKinmu(w_OuenCnt).StrData = w_KangoCD
                                                m_StaffData(w_DataIndex).WariateOuenKinmu(w_OuenCnt).Date_Renamed = w_CurrentDate
                                            End If

                                            '2015/04/10 Bando Add Start ==================================
                                            '希望コメントデータ
                                            If w_Comment <> "" Then
                                                w_OuenCnt = UBound(m_StaffData(w_DataIndex).WariateComment) + 1
                                                ReDim Preserve m_StaffData(w_DataIndex).WariateComment(w_OuenCnt)
                                                m_StaffData(w_DataIndex).WariateComment(w_OuenCnt).StrData = w_Comment
                                                m_StaffData(w_DataIndex).WariateComment(w_OuenCnt).Date_Renamed = w_CurrentDate
                                            End If
                                            '2015/04/10 Bando Add End   ==================================
                                        End If
                                    Next w_Col '---> 対象期間列分Loop
                                Next w_Loop '---> 計画期間分Loop

                                '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) START-->>
                                If m_SelTeamNo = 0 Or m_SelTeamNo = m_StaffData(w_DataIndex).Team Then
                                    'ﾃｷｽﾄﾃﾞｰﾀ追加(ﾚｺｰﾄﾞ更新)
                                    PrintLine(w_FileNo, w_FileText)
                                End If
                                '2014/06/13 TAKEBAYASHI P-07100 UPD (条件文を追加) END<<--
                            End If '---> 取得配列番号が数値か？
                        End If '---> 職員ﾃﾞｰﾀ格納配列が取得できたか？
                    End If
                Next w_Row '---> 職員データ行数分Loop
            End With

            w_OpenFlg = False
            'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
            FileClose(w_FileNo)

        Catch ex As Exception
            If w_OpenFlg = True Then
                'ﾌｧｲﾙOpenの場合はﾌｧｲﾙをCloseする
                FileClose(w_FileNo)
            End If
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Edit_RuleData()
        Const W_SUBNAME As String = "NSK0000HA Edit_RuleData"

        Dim w_clsObj As Object
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Try
            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成
            w_clsObj = New NsAid_NSK0010H.clsNSK0010H

            'ﾌﾟﾛﾊﾟﾃｨ設定
            'Inatalltype渡し
            w_clsObj.pInstallType = General.g_InstallType
            w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm
            w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = Trim(General.g_strSelKinmuDeptNm)
            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName
            w_clsObj.pFromToDate(m_KeikakuKikan.StartDate) = m_KeikakuKikan.EndDate
            w_clsObj.pGetMasterObj = General.g_objGetMaster

            Call General.paNotTopPos(Me)
            w_clsObj.pProcessObj = Me
            'ﾙｰﾙ設定画面表示
            w_clsObj.mShowWindow()

            ReDim w_strMsg(0)
            Call Set_MsgZOrder("", w_strMsg, w_MsgRc, 1)

            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄの解放
            w_clsObj = Nothing

            'ﾙｰﾙﾃﾞｰﾀの再取得
            Call Get_RuleData()

            '自動ﾁｪｯｸの場合は再ﾁｪｯｸ
            If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                'ｴﾗｰﾁｪｯｸを行う
                Call RunErrorCheck()
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'セット勤務設定画面
    Private Sub Edit_SetKinmuData()
        Const W_SUBNAME As String = "NSK0000HA Edit_SetKinmuData"

        Dim w_clsObj As Object
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Try
            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成
            w_clsObj = New NsAid_NSK0040H.clsNSK0040H

            'プロパティ設定
            'Inatalltype渡し
            w_clsObj.pInstallType = General.g_InstallType
            '施設情報
            w_clsObj.pHospitalInfo = General.g_strHospitalCD
            '勤務部署情報
            w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = Trim(General.g_strSelKinmuDeptNm)
            '利用者情報
            w_clsObj.pUserInfo = General.g_strUserID
            '部品
            w_clsObj.pGetDataObj = General.g_objGetData '職員取得系部品
            w_clsObj.pGetMasterObj = General.g_objGetMaster 'マスタ系取得部品

            Call General.paNotTopPos(Me)
            w_clsObj.pProcessObj = Me
            'ﾙｰﾙ設定画面表示
            w_clsObj.mShowWindow()

            ReDim w_strMsg(0)
            Call Set_MsgZOrder("", w_strMsg, w_MsgRc, 1)

            If w_clsObj.pEndStatus = True Then
                Call m_PaletteForm.Set_KinmuData(True)
            End If

            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄの解放
            w_clsObj = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '職員情報設定画面呼び出し
    Private Sub Edit_StaffData()
        Const W_SUBNAME As String = "NSK0000HA Edit_StaffData"

        Dim w_EditObj As Object
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Dim w_Index As Integer '2011/09/07 Y.I Add
        Try
            '職員情報設定画面ｵﾌﾞｼﾞｪｸﾄ設定
            w_EditObj = New NsAid_NSC0140H.clsNSC0140H

            '各種ﾌﾟﾛﾊﾟﾃｨ設定
            'Inatalltype渡し
            w_EditObj.pInstallType = General.g_InstallType

            '基本情報
            w_EditObj.pHospitalInfo = General.g_strHospitalCD 'HospitalCD
            w_EditObj.pKangoTaniInfo = General.g_strSelKinmuDeptCD '看護単位CD
            w_EditObj.pUserInfo = General.g_strUserID '操作者ID
            'Pgm情報
            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN AndAlso m_Simekiribi >= Integer.Parse(Format(Now, "yyyyMMdd"))) OrElse (m_Simekiribi = 0 AndAlso m_TargetData = False) Then
                w_EditObj.pCallKeikaku = "1" '新規（新規 Or 計画変更で締切前 Or 締切日設定なしで確定ﾃﾞｰﾀの場合）
            Else
                w_EditObj.pCallKeikaku = "2" '変更
            End If
            w_EditObj.pCallExe = "2" '計画画面からの起動
            w_EditObj.pDateInfo(m_KeikakuKikan.StartDate) = m_KeikakuKikan.EndDate '計画期間（From-To）
            w_EditObj.pPlanNoInfo = m_PlanNo '計画番号
            '職員情報引き渡し
            w_EditObj.pStaffID = m_Staff_ID '職員管理番号
            w_EditObj.pStaffPreID = m_Staff_PreID '職員番号
            w_EditObj.pStaffTeam = m_StaffTeam 'ﾁｰﾑ
            w_EditObj.pStaffName = m_StaffName '氏名
            w_EditObj.pStaffJobCD = m_StaffJobCD '職種CD
            w_EditObj.pStaffPostCD = m_StaffPostCD '役職CD
            w_EditObj.pStaffGiryoLvCD = m_StaffGiryoLvCD 'SkillLvlCD
            w_EditObj.pStaffSaiyoDate = m_StaffSaiyoDate '採用年月日
            w_EditObj.pStaffStartDate = m_StaffStartDate '配属年月日
            w_EditObj.pStaffEndDate = m_StaffEndDate '転出日
            w_EditObj.pStaffAutoKBN = m_StaffAutoKBN '自動割当対象区分
            w_EditObj.pStaffSyokai = m_StaffSyokai 'RegistFirstTimeDate
            w_EditObj.pStaffSaisyu = m_StaffSaisyu 'LastUpdTimeDate
            w_EditObj.pStaffTourokuID = m_StaffTourokuID 'RegistrantID
            w_EditObj.pStaffTaisyokuDate = m_StaffTaisyokuDate '退職日
            w_EditObj.pStaffKousinFlg = m_StaffKousinFlg '更新ﾌﾗｸﾞ
            w_EditObj.pStaffNo = m_StaffNo '表示NO
            w_EditObj.pStaffNo1 = m_StaffNo1 '表示NO1
            w_EditObj.pStaffNo2 = m_StaffNo2 '表示NO2
            w_EditObj.pStaffNo3 = m_StaffNo3 '表示NO3
            w_EditObj.pStaffNo4 = m_StaffNo4 '表示NO4
            w_EditObj.pStaffNo5 = m_StaffNo5 '表示NO5
            w_EditObj.pMaxTeamCnt = m_MaxTeamCnt '最大のﾁｰﾑ数
            w_EditObj.pStaffYakinKBN = m_StaffYakinKBN '夜勤専従者区分
            w_EditObj.pStaffPatternCD = m_StaffPatternCD 'パターンコード
            w_EditObj.pGetDataObj = General.g_objGetData
            w_EditObj.pGetMasterObj = General.g_objGetMaster
            w_EditObj.pHyoujijunMei = m_HyoujijunMeiIdx '表示順名

            Call General.paNotTopPos(Me)
            w_EditObj.pProcessObj = Me
            '職員情報設定画面表示
            w_EditObj.mShowWindow()

            Me.Refresh()

            ReDim w_strMsg(0)
            Call Set_MsgZOrder("", w_strMsg, w_MsgRc, 1)

            'データ変更の有無
            If w_EditObj.pStaffUpdateInfo = True Then

                m_HyoujijunMeiIdx = w_EditObj.pHyoujijunMei

                '職員データの再表示
                Call ChangeSpr_StaffData()

                '2011/09/07 Y.I Add St-----
                '個人集計 取得/設定
                For w_Index = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        Call RunReCalc_PUser(w_Index)
                        Call RunReCalc_User_4W(w_Index)
                    End If
                Next w_Index
                '夜間看護加算の表示
                If m_YakanKangoDispFlg = 0 Then
                    Call Set_KangoKasanTotalData()
                End If
                '2011/09/07 Y.I Add Ed-----

                '職員情報更新
                m_SetStaffFlg = True

                'SelectedIndexChangedイベントの解放
                RemoveHandler cmbHyoujijunMei.SelectedIndexChanged, AddressOf Me.cmbHyoujijunMei_SelectedIndexChanged
                cmbHyoujijunMei.SelectedIndex = m_HyoujijunMeiIdx - 1
                m_SelHyoujijunMei = cmbHyoujijunMei.SelectedIndex
                'SelectedIndexChangedイベントの追加
                AddHandler cmbHyoujijunMei.SelectedIndexChanged, AddressOf Me.cmbHyoujijunMei_SelectedIndexChanged
            End If

            w_EditObj = Nothing

            'エラーチェックの再読み込み-----------------------
            Call Get_RuleData()
            '自動ﾁｪｯｸの場合は再ﾁｪｯｸ
            If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                'ｴﾗｰﾁｪｯｸを行う
                Call RunErrorCheck()
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '*********************************
    '   Form_Load時のｺﾝﾄﾛｰﾙｻｲｽﾞ設定
    '   Create S.Ooeki  2000/08/20
    '*********************************
    Private Sub First_SetControlSize()
        Const W_SUBNAME As String = "NSK0000HA First_SetControlSize"

        Dim w_Left As Single
        Dim w_Top As Single
        Dim w_Width As Single
        Dim w_Height As Single
        Dim w_tbrHeight As Single
        Dim w_sbrHeight As Single
        Try
            w_Left = General.paTwipsTopixels(60)
            w_Width = Me.ClientRectangle.Width - w_Left * 2
            If w_Width < 0 Then
                w_Width = 0
            End If

            If tbrMain.Visible = False Then
                'ﾂｰﾙﾊﾞｰが非表示の場合
                w_tbrHeight = tbrMain.Top
            Else
                'ﾂｰﾙﾊﾞｰが表示されている場合
                w_tbrHeight = tbrMain.Height + tbrMain.Top
            End If


            If sbrMain.Visible = False Then
                'ｽﾃｰﾀｽﾊﾞｰが非表示の場合
                w_sbrHeight = 0
            Else
                'ｽﾃｰﾀｽﾊﾞｰが表示されている場合
                w_sbrHeight = sbrMain.Height
            End If
            w_Top = w_tbrHeight
            w_Height = Me.ClientRectangle.Height - (w_tbrHeight + w_sbrHeight)
            If w_Height < 0 Then
                w_Height = 0
            End If

            picBase.SetBounds(w_Left, w_Top, w_Width, w_Height)
            picHide.SetBounds(w_Left, w_Top, w_Width, w_Height)

            'ｽﾌﾟﾚｯﾄﾞの大きさを設定する
            Call Resize_SpreadCtrl()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '技量のﾃﾞﾌｫﾙﾄ設定値を取得する
    Private Sub Get_DefGiryoInf(ByRef pGiryoCD As String, ByRef pGiryoNo As Integer, ByRef pGiryoKbn As String)
        Const W_SUBNAME As String = "NSK0000HA Get_DefGiryoInf"

        'Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Try
            'Richard update start
            'w_Sql = "Select DispNo"
            'w_Sql = w_Sql & ", SkillBunruiCD"
            'w_Sql = w_Sql & " From NS_SKILL_M"
            'w_Sql = w_Sql & " Where SkillLvlCD = '" & pGiryoCD & "'"
            'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " "

            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            NSK0000H_sql.select_NS_SKILL_M_01(w_Rs, pGiryoCD) '<4>
            'Richard update end

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀないときは不正な技量CDとみなしﾃﾞﾌｫﾙﾄ設定なしとする
                    pGiryoCD = ""
                    pGiryoNo = 0
                    pGiryoKbn = ""
                Else
                    'ﾃﾞｰﾀあり（1件のみ）
                    pGiryoNo = IIf(IsDBNull(.Fields("DispNo").Value), 0, .Fields("DispNo").Value)
                    pGiryoKbn = .Fields("SkillBunruiCD").Value & ""
                End If
            End With

            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Get_ErrorCheckMatrix()
        Const W_SUBNAME As String = "NSK0000HA Get_ErrorCheckMatrix"

        Dim w_SumID As String
        Dim w_DataCount As Integer
        Dim w_DataLoop As Integer
        Dim w_str As String
        Dim w_Var As Object
        Dim w_j As Integer
        Try
            '配列確保
            ReDim m_CheckHMtrx(w_DataCount)
            ReDim m_CheckHMtrx(0).Ratio(0)

            If g_SaikeiFlg = True Then
                '再掲部署の場合
                w_SumID = General.g_strSelKinmuDeptCD & "CH"
            Else
                '一般部署の場合（外来、中央、部署 等）
                w_SumID = g_AppName & "CH"
            End If

            'ｴﾗｰﾁｪｯｸ用集計ﾃﾞｰﾀ取得
            With General.g_objGetMaster
                '集計ID(ﾁｪｯｸ用)
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pMtrx_SumID = w_SumID '集計ID
                .pMtrx_KinmuDeptCD = General.g_strSelKinmuDeptCD '勤務部署コード
                .pMtrx_ZokuseiKbn = 0 '0:両方 1:職種 2:役職

                '取得実行
                If .mGetMatrix = False Then
                Else
                    'ﾃﾞｰﾀが存在した場合
                    '横集計件数取得
                    w_DataCount = .fMtrx_HSumCount

                    '配列確保
                    ReDim m_CheckHMtrx(w_DataCount)

                    '横集計件数分ﾙｰﾌﾟ
                    For w_DataLoop = 1 To w_DataCount

                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .mMtrx_HSumIdx = w_DataLoop

                        m_CheckHMtrx(w_DataLoop).MtrxName = .fMtrx_HSumName
                        m_CheckHMtrx(w_DataLoop).BunruiCD = .fMtrx_HSumBunruiCD
                        m_CheckHMtrx(w_DataLoop).CalcKinmuStr = .fMtrx_HSumKinmuCD
                        w_str = .fMtrx_HSumHiritsu
                        w_Var = General.paSplit(w_str, ",")

                        '集計比率配列確保
                        ReDim m_CheckHMtrx(w_DataLoop).Ratio(UBound(w_Var))

                        '集計比率格納
                        For w_j = 1 To UBound(w_Var)
                            m_CheckHMtrx(w_DataLoop).Ratio(w_j) = Single.Parse(w_Var(w_j - 1))
                        Next w_j
                    Next w_DataLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Get_RuleData()
        Const W_SUBNAME As String = "NSK0000HA Get_RuleData"

        Dim w_Sql As String
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_FieldLoop As Integer
        Dim w_MaxTeamNo As Integer
        Dim w_TeamNo As Integer
        Dim w_KinmuCount As Integer
        Dim w_ChkMtrxCnt As Integer
        Dim w_ChkMtrxLoop As Integer
        Dim w_KinmuCD As String
        Dim w_CntMax As Integer
        Dim w_CntMin As Integer
        Dim w_IntervalMax As Integer
        Dim w_IntervalMin As Integer
        '2015/05/13 Ishiga add start------------
        Dim w_ContinueKinmuCountMax As Integer
        Dim w_ContinueHolCountMax As Integer
        '2015/05/13 Ishiga add end--------------
        Dim w_StaffLoop As Integer
        Dim w_StaffCnt As Integer
        Dim w_StaffID As String
        Dim w_TempStaffID As String
        Dim w_StaffIdx As Integer
        Dim w_Count As Integer
        Dim w_NotStatus As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Field() As ADODB.Field
        Dim w_AllocCD As String
        Dim w_PreAlloc As String = String.Empty
        Dim w_intSeq As Integer
        Dim w_PreIntSeq As Integer
        Dim w_Count2 As Integer
        Dim w_Count3 As Integer
        Try
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   必要人数Ｍデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            'Richard update start
            'w_Sql = "SELECT TEAM"
            'w_Sql = w_Sql & ", KINMUCD"
            'w_Sql = w_Sql & ", MONNINZU"
            'w_Sql = w_Sql & ", TUENINZU"
            'w_Sql = w_Sql & ", WEDNINZU"
            'w_Sql = w_Sql & ", THUNINZU"
            'w_Sql = w_Sql & ", FRININZU"
            'w_Sql = w_Sql & ", SATNINZU"
            'w_Sql = w_Sql & ", SUNNINZU"
            'w_Sql = w_Sql & ", HOLNINZU"
            'w_Sql = w_Sql & " FROM NS_NECESSARYNUM_M"
            'w_Sql = w_Sql & " WHERE KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " ORDER BY TEAM, KINMUCD"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_NECESSARYNUM_M_01(w_Rs) '<5>
            'Richard update end

            With w_Rs
                If .RecordCount <= 0 Then
                    'データなし
                    ReDim m_NeedCountData(0)
                    ReDim m_NeedCountData(0).NeedCount(0)
                Else
                    'ﾃﾞｰﾀあり
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(10)
                    w_Field(1) = .Fields("TEAM")
                    w_Field(2) = .Fields("KINMUCD")
                    w_Field(3) = .Fields("MONNINZU")
                    w_Field(4) = .Fields("TUENINZU")
                    w_Field(5) = .Fields("WEDNINZU")
                    w_Field(6) = .Fields("THUNINZU")
                    w_Field(7) = .Fields("FRININZU")
                    w_Field(8) = .Fields("SATNINZU")
                    w_Field(9) = .Fields("SUNNINZU")
                    w_Field(10) = .Fields("HOLNINZU")

                    '配列の確保
                    ReDim m_NeedCountData(9)
                    For w_DataLoop = 0 To 9
                        ReDim m_NeedCountData(w_DataLoop).NeedCount(0)
                    Next w_DataLoop

                    w_MaxTeamNo = 0
                    For w_DataLoop = 1 To w_DataCnt
                        w_TeamNo = w_Field(1).Value 'ﾁｰﾑ番号
                        If w_TeamNo > w_MaxTeamNo Then
                            w_MaxTeamNo = w_TeamNo
                        End If
                        w_KinmuCount = UBound(m_NeedCountData(w_TeamNo).NeedCount) + 1
                        ReDim Preserve m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).KinmuCD = w_Field(2).Value
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).MondayCnt = IIf(IsDBNull(w_Field(3).Value), 0, w_Field(3).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).TuesdayCnt = IIf(IsDBNull(w_Field(4).Value), 0, w_Field(4).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).WednesdayCnt = IIf(IsDBNull(w_Field(5).Value), 0, w_Field(5).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).ThursdayCnt = IIf(IsDBNull(w_Field(6).Value), 0, w_Field(6).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).FridayCnt = IIf(IsDBNull(w_Field(7).Value), 0, w_Field(7).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).SaturdayCnt = IIf(IsDBNull(w_Field(8).Value), 0, w_Field(8).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).SundayCnt = IIf(IsDBNull(w_Field(9).Value), 0, w_Field(9).Value)
                        m_NeedCountData(w_TeamNo).NeedCount(w_KinmuCount).HolidayCnt = IIf(IsDBNull(w_Field(10).Value), 0, w_Field(10).Value)
                        .MoveNext()
                    Next w_DataLoop

                    '配列の最適化（ﾁｰﾑ配列）
                    ReDim Preserve m_NeedCountData(w_MaxTeamNo)
                End If
            End With
            w_Rs.Close()

            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   勤務パターンＦデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            If General.g_InstallType = General.gInstall_Enum.AccessType_Mdb OrElse General.g_InstallType = General.gInstall_Enum.AccessType_SQL OrElse General.g_InstallType = General.gInstall_Enum.AccessType_post Then
                w_Sql = "SELECT NS_KINMUPATTERN_F.KINMUCD1"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD2"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD3"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD4"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD5"
                w_Sql = w_Sql & " FROM NS_CONDITION_F INNER JOIN NS_KINMUPATTERN_F"
                w_Sql = w_Sql & " ON (NS_CONDITION_F.CONDCD = NS_KINMUPATTERN_F.CONDCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.KINMUDEPTCD = NS_KINMUPATTERN_F.KINMUDEPTCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.HOSPITALCD = NS_KINMUPATTERN_F.HOSPITALCD)"
                w_Sql = w_Sql & " WHERE NS_KINMUPATTERN_F.ALLOCKBN = '1'" '禁止
                w_Sql = w_Sql & " AND NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_KINMUPATTERN_F.SEQ"
                w_Sql = w_Sql & " "
            Else
                w_Sql = "SELECT NS_KINMUPATTERN_F.KINMUCD1"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD2"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD3"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD4"
                w_Sql = w_Sql & ", NS_KINMUPATTERN_F.KINMUCD5"
                w_Sql = w_Sql & " FROM NS_KINMUPATTERN_F"
                w_Sql = w_Sql & ", NS_CONDITION_F"
                w_Sql = w_Sql & " WHERE NS_KINMUPATTERN_F.ALLOCKBN = '1'" '禁止
                w_Sql = w_Sql & " AND NS_KINMUPATTERN_F.CONDCD = NS_CONDITION_F.CONDCD"
                w_Sql = w_Sql & " AND NS_KINMUPATTERN_F.KINMUDEPTCD = NS_CONDITION_F.KINMUDEPTCD"
                w_Sql = w_Sql & " AND NS_KINMUPATTERN_F.HOSPITALCD = NS_CONDITION_F.HOSPITALCD"
                w_Sql = w_Sql & " AND NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_KINMUPATTERN_F.SEQ"
                w_Sql = w_Sql & " "
            End If
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs
                If .RecordCount <= 0 Then
                    w_DataCnt = 0
                Else
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(5)
                    w_Field(1) = .Fields("KINMUCD1")
                    w_Field(2) = .Fields("KINMUCD2")
                    w_Field(3) = .Fields("KINMUCD3")
                    w_Field(4) = .Fields("KINMUCD4")
                    w_Field(5) = .Fields("KINMUCD5")
                End If

                ReDim m_NotPattern(w_DataCnt)

                For w_DataLoop = 1 To w_DataCnt
                    m_NotPattern(w_DataLoop).PatternKinmu = ""
                    m_NotPattern(w_DataLoop).PatternCount = 0

                    For w_FieldLoop = 1 To 5
                        If IIf(IsDBNull(w_Field(w_FieldLoop).Value), "", w_Field(w_FieldLoop).Value) <> "" Then
                            'パターン構成勤務をカンマ編集で取得
                            If w_Field(w_FieldLoop).Value = "000" Then
                                m_NotPattern(w_DataLoop).PatternKinmu = m_NotPattern(w_DataLoop).PatternKinmu & Space(3) & "," '勤務CD３桁化
                            Else
                                m_NotPattern(w_DataLoop).PatternKinmu = m_NotPattern(w_DataLoop).PatternKinmu & w_Field(w_FieldLoop).Value & ","
                            End If

                            'パターン構成勤務数カウント
                            m_NotPattern(w_DataLoop).PatternCount = m_NotPattern(w_DataLoop).PatternCount + 1
                        End If
                    Next w_FieldLoop

                    If m_NotPattern(w_DataLoop).PatternKinmu <> "" Then
                        m_NotPattern(w_DataLoop).PatternKinmu = General.paLeft(m_NotPattern(w_DataLoop).PatternKinmu, Len(m_NotPattern(w_DataLoop).PatternKinmu) - 1)
                    End If

                    .MoveNext()
                Next w_DataLoop
            End With
            w_Rs.Close()

            '職員数取得
            w_StaffCnt = UBound(m_StaffData)

            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   勤務条件Ｆデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            If General.g_InstallType = General.gInstall_Enum.AccessType_Mdb OrElse General.g_InstallType = General.gInstall_Enum.AccessType_SQL OrElse General.g_InstallType = General.gInstall_Enum.AccessType_post Then
                w_Sql = "SELECT NS_KINMUCONDITION_F.KINMUCD"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.COUNTMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.COUNTMIN"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.INTERVALMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.INTERVALMIN"
                '2015/05/13 Ishiga add start-----------------------------------
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.CONTINUEKINMUCOUNTMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.CONTINUEHOLCOUNTMAX"
                '2015/05/13 Ishiga add end-------------------------------------
                w_Sql = w_Sql & " FROM NS_CONDITION_F INNER JOIN NS_KINMUCONDITION_F"
                w_Sql = w_Sql & " ON (NS_CONDITION_F.CONDCD = NS_KINMUCONDITION_F.CONDCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.KINMUDEPTCD = NS_KINMUCONDITION_F.KINMUDEPTCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.HOSPITALCD = NS_KINMUCONDITION_F.HOSPITALCD)"
                w_Sql = w_Sql & " WHERE NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_KINMUCONDITION_F.KINMUCD"
                w_Sql = w_Sql & " "
            Else
                w_Sql = "SELECT NS_KINMUCONDITION_F.KINMUCD"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.COUNTMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.COUNTMIN"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.INTERVALMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.INTERVALMIN"
                '2015/05/13 Ishiga add start-----------------------------------
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.CONTINUEKINMUCOUNTMAX"
                w_Sql = w_Sql & ", NS_KINMUCONDITION_F.CONTINUEHOLCOUNTMAX"
                '2015/05/13 Ishiga add end-------------------------------------
                w_Sql = w_Sql & " FROM NS_KINMUCONDITION_F"
                w_Sql = w_Sql & ", NS_CONDITION_F"
                w_Sql = w_Sql & " WHERE NS_KINMUCONDITION_F.CONDCD = NS_CONDITION_F.CONDCD"
                w_Sql = w_Sql & " AND NS_KINMUCONDITION_F.KINMUDEPTCD = NS_CONDITION_F.KINMUDEPTCD"
                w_Sql = w_Sql & " AND NS_KINMUCONDITION_F.HOSPITALCD = NS_CONDITION_F.HOSPITALCD"
                w_Sql = w_Sql & " AND NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_KINMUCONDITION_F.KINMUCD"
                w_Sql = w_Sql & " "
            End If

            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀなし
                    w_DataCnt = 0
                Else
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(7)
                    w_Field(1) = .Fields("KINMUCD")
                    w_Field(2) = .Fields("COUNTMAX")
                    w_Field(3) = .Fields("COUNTMIN")
                    w_Field(4) = .Fields("INTERVALMAX")
                    w_Field(5) = .Fields("INTERVALMIN")
                    '2015/05/13 Ishiga add start-----------------
                    w_Field(6) = .Fields("CONTINUEKINMUCOUNTMAX")
                    w_Field(7) = .Fields("CONTINUEHOLCOUNTMAX")
                    '2015/05/13 Ishiga add end-------------------
                End If

                w_ChkMtrxCnt = UBound(m_CheckHMtrx)
                For w_StaffLoop = 1 To w_StaffCnt
                    ReDim m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxCnt)
                    ReDim m_StaffData(w_StaffLoop).ResultCnt(0)
                Next w_StaffLoop

                'ﾁｪｯｸ用集計ﾏﾄﾘｯｸｽ配列に格納さている順番にあわす
                For w_DataLoop = 1 To w_DataCnt
                    'ﾃﾞｰﾀを変数に退避
                    w_KinmuCD = w_Field(1).Value
                    If IsNumeric(w_KinmuCD) = True Then
                        w_CntMax = IIf(IsDBNull(w_Field(2).Value), 0, w_Field(2).Value)
                        w_CntMin = IIf(IsDBNull(w_Field(3).Value), 0, w_Field(3).Value)
                        w_IntervalMax = IIf(IsDBNull(w_Field(4).Value), 0, w_Field(4).Value)
                        w_IntervalMin = IIf(IsDBNull(w_Field(5).Value), 0, w_Field(5).Value)
                        '2015/05/13 Ishiga add start-----------------------------------------------------
                        w_ContinueKinmuCountMax = IIf(IsDBNull(w_Field(6).Value), 0, w_Field(6).Value)
                        w_ContinueHolCountMax = IIf(IsDBNull(w_Field(7).Value), 0, w_Field(7).Value)
                        '2015/05/13 Ishiga add end-------------------------------------------------------
                        For w_ChkMtrxLoop = 1 To w_ChkMtrxCnt
                            If g_KinmuM(Integer.Parse(w_KinmuCD)).WBunruiCD = m_CheckHMtrx(w_ChkMtrxLoop).BunruiCD Then
                                For w_StaffLoop = 1 To w_StaffCnt
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).CountMax = w_CntMax
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).CountMin = w_CntMin
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).IntervalMax = w_IntervalMax
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).IntervalMin = w_IntervalMin
                                    '2015/05/13 Ishiga add start----------------------------------------------------------------------
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).RenzokuCountMax = w_ContinueKinmuCountMax
                                    m_StaffData(w_StaffLoop).KinmuCondition(w_ChkMtrxLoop).RenkyuCountMax = w_ContinueHolCountMax
                                    '2015/05/13 Ishiga add end------------------------------------------------------------------------
                                Next w_StaffLoop
                                Exit For
                            End If
                        Next w_ChkMtrxLoop
                    End If

                    .MoveNext()
                Next w_DataLoop
            End With
            w_Rs.Close()

            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   個人別勤務条件Ｆデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            'RICHARD UPDATE START
            'w_Sql = "SELECT "
            'w_Sql = w_Sql & "	PKC.STAFFMNGID, "
            'w_Sql = w_Sql & "	PKC.KINMUCD, "
            'w_Sql = w_Sql & "	PKC.ALLOCCHKFLG, "
            'w_Sql = w_Sql & "	PKC.COUNTMAX, "
            'w_Sql = w_Sql & "	PKC.COUNTMIN, "
            'w_Sql = w_Sql & "	PKC.MONSPECIFY, "
            'w_Sql = w_Sql & "	PKC.TUESPECIFY, "
            'w_Sql = w_Sql & "	PKC.WEDSPECIFY, "
            'w_Sql = w_Sql & "	PKC.THUSPECIFY, "
            'w_Sql = w_Sql & "	PKC.FRISPECIFY, "
            'w_Sql = w_Sql & "	PKC.SATSPECIFY, "
            'w_Sql = w_Sql & "	PKC.SUNSPECIFY, "
            'w_Sql = w_Sql & "	PKC.CONTINUECOUNTMAX "
            'w_Sql = w_Sql & "FROM NS_PERSONALKINMUCOND_F PKC "
            'w_Sql = w_Sql & "INNER JOIN NS_STAFFHISTORY_F SH ON "
            'w_Sql = w_Sql & "	SH.HOSPITALCD = PKC.HOSPITALCD "
            'w_Sql = w_Sql & "	AND SH.PLANNO = " & m_PlanNo & " "
            'w_Sql = w_Sql & "	AND SH.KINMUDEPTCD = PKC.KINMUDEPTCD "
            'w_Sql = w_Sql & "	AND SH.STAFFMNGID = PKC.STAFFMNGID "
            'w_Sql = w_Sql & "	AND SH.AUTOALLOCKBN = '1' "
            'w_Sql = w_Sql & "	AND SH.PATTERNCD IS NULL "
            'w_Sql = w_Sql & "WHERE "
            'w_Sql = w_Sql & "	PKC.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
            'w_Sql = w_Sql & "	AND PKC.HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "ORDER BY PKC.STAFFMNGID, PKC.KINMUCD "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PERSONALKINMUCOND_F_01(w_Rs, m_PlanNo) '<6>
            'RICHARD UPDATE END

            With w_Rs
                If .RecordCount > 0 Then

                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(13)
                    w_Field(1) = .Fields("STAFFMNGID")
                    w_Field(2) = .Fields("KINMUCD")
                    w_Field(3) = .Fields("ALLOCCHKFLG")
                    w_Field(4) = .Fields("COUNTMAX")
                    w_Field(5) = .Fields("COUNTMIN")
                    w_Field(6) = .Fields("MONSPECIFY")
                    w_Field(7) = .Fields("TUESPECIFY")
                    w_Field(8) = .Fields("WEDSPECIFY")
                    w_Field(9) = .Fields("THUSPECIFY")
                    w_Field(10) = .Fields("FRISPECIFY")
                    w_Field(11) = .Fields("SATSPECIFY")
                    w_Field(12) = .Fields("SUNSPECIFY")
                    '2015/05/13 Ishiga add start------------------
                    w_Field(13) = .Fields("CONTINUECOUNTMAX")
                    '2015/05/13 Ishiga add end--------------------

                    w_TempStaffID = ""

                    For w_DataLoop = 1 To w_DataCnt

                        '職員管理番号取得
                        w_StaffID = w_Field(1).Value

                        If w_TempStaffID <> w_StaffID Then
                            '職員管理番号が変わった場合
                            w_TempStaffID = w_StaffID
                            w_StaffIdx = -1
                            For w_StaffLoop = 1 To w_StaffCnt
                                If m_StaffData(w_StaffLoop).ID = w_StaffID Then
                                    w_StaffIdx = w_StaffLoop
                                    Exit For
                                End If
                            Next w_StaffLoop
                        End If

                        '勤務を取得
                        w_KinmuCD = w_Field(2).Value

                        '職員データが存在した場合（該当計画期間に所属している職員のﾃﾞｰﾀのみを取得する）
                        If w_StaffIdx <> -1 AndAlso IsNumeric(w_KinmuCD) = True Then

                            '勤務を検索
                            For w_ChkMtrxLoop = 1 To w_ChkMtrxCnt
                                If g_KinmuM(Integer.Parse(w_KinmuCD)).WBunruiCD = m_CheckHMtrx(w_ChkMtrxLoop).BunruiCD Then
                                    'ﾁｪｯｸ用集計ﾏﾄﾘｯｸｽ配列に格納さている順番にあわす

                                    '回数MAX、回数MINを取得する（0より大きい場合のみ設定ありとして取得する）
                                    w_Count = IIf(IsDBNull(w_Field(4).Value), 0, w_Field(4).Value)
                                    If w_Count > 0 Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).CountMax = w_Count
                                    End If

                                    w_Count = IIf(IsDBNull(w_Field(5).Value), 0, w_Field(5).Value)
                                    If w_Count > 0 Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).CountMin = w_Count
                                    End If

                                    'AllocChkFlg
                                    w_NotStatus = w_Field(3).Value & ""
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).NotKinmu = True
                                    End If

                                    '各曜日の割当可否
                                    w_NotStatus = w_Field(6).Value & "" '月曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).MondayNot = True
                                    End If
                                    w_NotStatus = w_Field(7).Value & "" '火曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).TuesdayNot = True
                                    End If
                                    w_NotStatus = w_Field(8).Value & "" '水曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).WednesdayNot = True
                                    End If
                                    w_NotStatus = w_Field(9).Value & "" '木曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).ThursdayNot = True
                                    End If
                                    w_NotStatus = w_Field(10).Value & "" '金曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).FridayNot = True
                                    End If
                                    w_NotStatus = w_Field(11).Value & "" '土曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).SaturdayNot = True
                                    End If
                                    w_NotStatus = w_Field(12).Value & "" '日曜日
                                    If w_NotStatus = "2" Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).SundayNot = True
                                    End If
                                    '2015/05/13 Ishiga add start-----------------------------------------------------------
                                    w_Count = IIf(IsDBNull(w_Field(13).Value), 0, w_Field(13).Value)
                                    If w_Count > 0 Then
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).RenzokuCountMax = w_Count
                                        m_StaffData(w_StaffIdx).KinmuCondition(w_ChkMtrxLoop).RenkyuCountMax = w_Count
                                    End If
                                    '2015/05/13 Ishiga add end-------------------------------------------------------------

                                    Exit For

                                End If '---> 分類ｺｰﾄﾞのﾏｯﾁﾝｸﾞ
                            Next w_ChkMtrxLoop '---> ﾁｪｯｸ用集計項目Loop
                        End If '---> 職員ﾃﾞｰﾀ検索結果OK Or 勤務ｺｰﾄﾞOK

                        .MoveNext()
                    Next w_DataLoop
                End If
            End With
            w_Rs.Close()

            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   禁止職員ﾊﾟﾀｰﾝデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '初期化
            ReDim m_NotStaffPatternInfo(0)
            ReDim m_NotStaffPatternInfo(0).Data(0)
            w_Count = 0

            If General.g_InstallType = General.gInstall_Enum.AccessType_Mdb OrElse General.g_InstallType = General.gInstall_Enum.AccessType_SQL OrElse General.g_InstallType = General.gInstall_Enum.AccessType_post Then
                w_Sql = "SELECT NS_NOTSETSTAFFPATTERN_M.ALLOCCD"
                w_Sql = w_Sql & ", NS_NOTSETSTAFFPATTERN_M.SEQ"
                w_Sql = w_Sql & ", NS_NOTSETSTAFFPATTERN_M.STAFFMNGID"
                w_Sql = w_Sql & " FROM NS_CONDITION_F INNER JOIN NS_NOTSETSTAFFPATTERN_M"
                w_Sql = w_Sql & " ON (NS_CONDITION_F.CONDCD = NS_NOTSETSTAFFPATTERN_M.CONDCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.KINMUDEPTCD = NS_NOTSETSTAFFPATTERN_M.KINMUDEPTCD)"
                w_Sql = w_Sql & " AND (NS_CONDITION_F.HOSPITALCD = NS_NOTSETSTAFFPATTERN_M.HOSPITALCD)"
                w_Sql = w_Sql & " WHERE NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_NOTSETSTAFFPATTERN_M.ALLOCCD,NS_NOTSETSTAFFPATTERN_M.SEQ"
                w_Sql = w_Sql & " "
            Else
                w_Sql = "SELECT NS_NOTSETSTAFFPATTERN_M.ALLOCCD"
                w_Sql = w_Sql & ", NS_NOTSETSTAFFPATTERN_M.SEQ"
                w_Sql = w_Sql & ", NS_NOTSETSTAFFPATTERN_M.STAFFMNGID"
                w_Sql = w_Sql & " FROM NS_NOTSETSTAFFPATTERN_M"
                w_Sql = w_Sql & ", NS_CONDITION_F"
                w_Sql = w_Sql & " WHERE NS_NOTSETSTAFFPATTERN_M.CONDCD = NS_CONDITION_F.CONDCD"
                w_Sql = w_Sql & " AND NS_NOTSETSTAFFPATTERN_M.KINMUDEPTCD = NS_CONDITION_F.KINMUDEPTCD"
                w_Sql = w_Sql & " AND NS_NOTSETSTAFFPATTERN_M.HOSPITALCD = NS_CONDITION_F.HOSPITALCD"
                w_Sql = w_Sql & " AND NS_CONDITION_F.APPLYKBN = '1'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_Sql = w_Sql & " ORDER BY NS_NOTSETSTAFFPATTERN_M.ALLOCCD,NS_NOTSETSTAFFPATTERN_M.SEQ"
                w_Sql = w_Sql & " "
            End If
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'データなし
                Else
                    'ﾃﾞｰﾀあり
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(3)
                    w_Field(1) = .Fields("ALLOCCD")
                    w_Field(2) = .Fields("SEQ")
                    w_Field(3) = .Fields("STAFFMNGID")

                    'データ件数分ﾙｰﾌﾟ
                    For w_DataLoop = 1 To w_DataCnt
                        w_AllocCD = w_Field(1).Value '割当CD
                        w_intSeq = IIf(IsDBNull(w_Field(2).Value), 0, w_Field(2).Value) 'SEQ
                        w_StaffID = IIf(IsDBNull(w_Field(3).Value), "", w_Field(3).Value) '職員管理番号

                        If w_AllocCD <> w_PreAlloc Then
                            '割当CDが変わった場合
                            '配列確保
                            w_Count = w_Count + 1
                            w_Count2 = 1
                            w_Count3 = 1
                            ReDim Preserve m_NotStaffPatternInfo(w_Count)
                            ReDim m_NotStaffPatternInfo(w_Count).Data(w_Count2)
                            ReDim m_NotStaffPatternInfo(w_Count).Data(w_Count2).StaffMngID(w_Count3)

                            m_NotStaffPatternInfo(w_Count).AllocCD = w_AllocCD
                            m_NotStaffPatternInfo(w_Count).Data(w_Count2).Seq = w_intSeq
                        ElseIf w_intSeq <> w_PreIntSeq Then
                            'パターンが変わった場合
                            '配列確保
                            w_Count2 = w_Count2 + 1
                            w_Count3 = 1

                            ReDim Preserve m_NotStaffPatternInfo(w_Count).Data(w_Count2)
                            ReDim m_NotStaffPatternInfo(w_Count).Data(w_Count2).StaffMngID(w_Count3)

                            m_NotStaffPatternInfo(w_Count).Data(w_Count2).Seq = w_intSeq
                        Else
                            w_Count3 = w_Count3 + 1

                            '配列確保
                            ReDim Preserve m_NotStaffPatternInfo(w_Count).Data(w_Count2).StaffMngID(w_Count3)
                        End If

                        '職員管理番号
                        m_NotStaffPatternInfo(w_Count).Data(w_Count2).StaffMngID(w_Count3) = w_StaffID

                        '退避
                        w_PreAlloc = w_AllocCD
                        w_PreIntSeq = w_intSeq

                        w_Rs.MoveNext()
                    Next w_DataLoop
                End If
            End With
            w_Rs.Close()

            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '   経験区分の組み合わせデータ取得
            '☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
            '初期化
            ReDim m_GiryoCheck(0)
            ReDim m_GiryoCheck(0).Giryo(0)
            w_Count = 0

            'RICHAR UPDATE START
            'w_Sql = "SELECT NS_SKILLSET_F.KINMUCD, NS_SKILLSET_F.SEQ"
            'w_Sql = w_Sql & ", NS_SKILLSET_F.SKILLNINZU1"
            'w_Sql = w_Sql & ", NS_SKILLSET_F.SKILLNINZU2"
            'w_Sql = w_Sql & ", NS_SKILLSET_F.SKILLNINZU3"
            'w_Sql = w_Sql & ", NS_SKILLSET_F.SKILLNINZU4"
            'w_Sql = w_Sql & ", NS_KINMUNAME_M.MARKF"
            'w_Sql = w_Sql & " FROM NS_SKILLSET_F, NS_CONDITION_F, NS_KINMUNAME_M"
            'w_Sql = w_Sql & " WHERE NS_SKILLSET_F.CONDCD = NS_CONDITION_F.CONDCD"
            'w_Sql = w_Sql & " AND NS_SKILLSET_F.KINMUDEPTCD = NS_CONDITION_F.KINMUDEPTCD"
            'w_Sql = w_Sql & " AND NS_SKILLSET_F.HOSPITALCD = NS_CONDITION_F.HOSPITALCD"
            'w_Sql = w_Sql & " AND NS_KINMUNAME_M.HOSPITALCD = NS_CONDITION_F.HOSPITALCD"
            'w_Sql = w_Sql & " AND NS_KINMUNAME_M.KINMUCD = NS_SKILLSET_F.KINMUCD"
            'w_Sql = w_Sql & " AND NS_CONDITION_F.APPLYKBN = '1'"
            'w_Sql = w_Sql & " AND NS_CONDITION_F.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            'w_Sql = w_Sql & " AND NS_CONDITION_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " ORDER BY NS_SKILLSET_F.KINMUCD,NS_SKILLSET_F.SEQ"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_SKILLSET_F_01(w_Rs) '<8>
            'RICHARD UPDATE END

            With w_Rs
                If .RecordCount <= 0 Then
                    'データなし
                Else
                    'ﾃﾞｰﾀあり
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()
                    ReDim w_Field(7)
                    w_Field(1) = .Fields("KINMUCD")
                    w_Field(2) = .Fields("SEQ")
                    w_Field(3) = .Fields("SKILLNINZU1")
                    w_Field(4) = .Fields("SKILLNINZU2")
                    w_Field(5) = .Fields("SKILLNINZU3")
                    w_Field(6) = .Fields("SKILLNINZU4")
                    w_Field(7) = .Fields("MARKF")

                    'データ件数分ﾙｰﾌﾟ
                    For w_DataLoop = 1 To w_DataCnt
                        w_KinmuCD = w_Field(1).Value '割当CD
                        w_intSeq = IIf(IsDBNull(w_Field(2).Value), 0, w_Field(2).Value) 'SEQ

                        If w_KinmuCD <> w_PreAlloc Then
                            '割当CDが変わった場合
                            '配列確保
                            w_Count = w_Count + 1
                            w_Count2 = 1
                            w_Count3 = 1

                            ReDim Preserve m_GiryoCheck(w_Count)
                            ReDim m_GiryoCheck(w_Count).Giryo(w_Count2)

                            m_GiryoCheck(w_Count).KinmuCD = w_KinmuCD
                            m_GiryoCheck(w_Count).Giryo(w_Count2).Seq = w_intSeq
                            m_GiryoCheck(w_Count).Giryo(w_Count2).Mark = IIf(IsDBNull(w_Field(7).Value), "", w_Field(7).Value)
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu1 = IIf(IsDBNull(w_Field(3).Value), "", w_Field(3).Value) '技量人数（１）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu2 = IIf(IsDBNull(w_Field(4).Value), "", w_Field(4).Value) '技量人数（２）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu3 = IIf(IsDBNull(w_Field(5).Value), "", w_Field(5).Value) '技量人数（３）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu4 = IIf(IsDBNull(w_Field(6).Value), "", w_Field(6).Value) '技量人数（４）
                        ElseIf w_intSeq <> w_PreIntSeq Then
                            'パターンが変わった場合
                            '配列確保
                            w_Count2 = w_Count2 + 1
                            w_Count3 = 1

                            ReDim Preserve m_GiryoCheck(w_Count).Giryo(w_Count2)

                            m_GiryoCheck(w_Count).Giryo(w_Count2).Seq = w_intSeq
                            m_GiryoCheck(w_Count).Giryo(w_Count2).Mark = IIf(IsDBNull(w_Field(7).Value), "", w_Field(7).Value)
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu1 = IIf(IsDBNull(w_Field(3).Value), "", w_Field(3).Value) '技量人数（１）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu2 = IIf(IsDBNull(w_Field(4).Value), "", w_Field(4).Value) '技量人数（２）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu3 = IIf(IsDBNull(w_Field(5).Value), "", w_Field(5).Value) '技量人数（３）
                            m_GiryoCheck(w_Count).Giryo(w_Count2).GiryoNinzu4 = IIf(IsDBNull(w_Field(6).Value), "", w_Field(6).Value) '技量人数（４）
                        End If

                        '退避
                        w_PreAlloc = w_KinmuCD
                        w_PreIntSeq = w_intSeq

                        w_Rs.MoveNext()
                    Next w_DataLoop
                End If
            End With
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Get_SaikeiData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_SaikeiData"

        Dim w_Row As Integer
        Dim w_StaffIdx As Integer
        Dim w_Var As Object
        Dim w_From As Integer
        Dim w_To As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_KinmuCD As String
        Dim w_Riyu As String
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_Col As Integer
        Dim w_DataCol As Integer
        Dim w_BaseCol As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_IdoLoop As Integer
        Dim w_Idocnt As Integer
        Dim w_intCount As Integer
        Dim w_lngDate As Integer
        Dim w_KangoCD As String
        Dim w_Int3 As Integer
        Dim w_Time As String
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String
        Dim w_DivideNum As Integer
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Red)
            pProcessForm.pSyoriText = "再掲･委員会データ取得中..."
            w_DivideNum = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ UBound(m_StaffData)

            '処理経過ﾌｫｰﾑ初期化
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ w_DivideNum
            w_intCount = 0

            '職員数Loop
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                '職員管理番号取得
                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                '職員情報格納配列取得OK？
                If IsNumeric(w_Var) = True Then

                    '職員ﾃﾞｰﾀ格納配列番号取得
                    w_StaffIdx = Integer.Parse(w_Var)

                    'PlanPeriodFrom
                    w_From = m_KeikakuKikan.StartDate
                    'PlanPeriodTo
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ヶ月の場合は最終の4週期間終了日
                        w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                        If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_BaseCol) = False Then
                            Exit For
                        End If
                        w_DataCnt = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - w_BaseCol + 1
                    Else
                        '4週/4週，1ヶ月/1ヶ月の場合は計画立案期間終了日
                        w_To = m_KeikakuKikan.EndDate
                        w_BaseCol = m_KeikakuKikan.KinmuDataStartCol
                        w_DataCnt = m_KeikakuKikan.KinmuDataEndCol - w_BaseCol + 1
                    End If

                    ReDim m_StaffData(w_StaffIdx).SaikeiData(w_DataCnt)

                    '再掲部署でない場合は、年休のみ取得する
                    If g_SaikeiFlg = False Then
                        Call Get_JikanNenkyu(w_From, w_To, w_StaffIdx)
                        '控除データ取得
                        '表示期間中の全ての控除データを取得する
                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                            '1ｹ月/1ｹ月,4週/4週の場合
                            Call Get_KojyoData(Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(w_From, "0000/00/00"))), "yyyyMMdd")), w_To, w_StaffIdx)
                        ElseIf (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                            '4週/1ｹ月の場合
                            Call Get_KojyoData(m_4WeekKikan(1).StartDate, w_To, w_StaffIdx)
                        End If
                    Else
                        '2017/11/17 Angelo add st----------------------------------------------
                        '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                        If m_intSelSaveNo > 0 Then
                            '一時保存からデータの取得
                            General.g_objGetData.p取得区分 = 1
                            General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                            General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                        Else
                            '予定勤務からデータの取得
                            General.g_objGetData.p取得区分 = 0
                        End If
                        '2017/11/17 Angelo add en----------------------------------------------

                        '職員区分
                        General.g_objGetData.p職員区分 = 0

                        '職員番号
                        General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                        '勤務取得区分(予定)
                        General.g_objGetData.p勤務取得区分 = 0

                        '日付区分
                        General.g_objGetData.p日付区分 = 1

                        '開始年月日
                        General.g_objGetData.p開始年月日 = w_From

                        '終了年月日
                        General.g_objGetData.p終了年月日 = w_To

                        'ﾃﾞｰﾀ取得実行
                        If General.g_objGetData.mGetkinmu = False Then
                        Else
                            'ﾃﾞｰﾀ件数取得
                            w_DataCnt = General.g_objGetData.f期間日数

                            w_lngDate = w_From

                            '時間年休取得
                            Call Get_JikanNenkyu(w_From, w_To, w_StaffIdx)

                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                '1ｹ月/1ｹ月,4週/4週の場合
                                Call Get_KojyoData(Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(w_From, "0000/00/00"))), "yyyyMMdd")), w_To, w_StaffIdx)
                            ElseIf (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                '4週/1ｹ月の場合
                                Call Get_KojyoData(m_4WeekKikan(1).StartDate, w_To, w_StaffIdx)
                            End If

                            '日付を渡す
                            General.g_objGetData.p予定年月日 = w_lngDate

                            'ﾃﾞｰﾀ件数Loop
                            For w_DataLoop = 1 To w_DataCnt

                                '日付取得
                                w_YYYYMMDD = General.g_objGetData.f予定年月日

                                If w_YYYYMMDD <> 0 Then
                                    '在職期間を対象とする
                                    If w_YYYYMMDD <= m_StaffData(w_StaffIdx).TentaiYMD OrElse m_StaffData(w_StaffIdx).TentaiYMD = 0 Then

                                        '勤務ｺｰﾄﾞ・理由区分取得
                                        w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        w_Riyu = General.g_objGetData.f予定理由区分
                                        w_KangoCD = General.g_objGetData.f予定応援看護単位CD
                                        w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                        w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務予定最終更新日時

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '勤務ﾃﾞｰﾀ格納相対位置取得（配列番号）
                                        If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                            w_Col = 0
                                        End If

                                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                            '4週/1ヶ月の場合
                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_DataCol) = False Then
                                                w_DataCol = 0
                                            End If
                                        Else
                                            '4週/4週，1ヶ月/1ヶ月の場合
                                            w_DataCol = w_Col
                                        End If

                                        If w_DataCol > 0 Then
                                            w_DataCol = w_DataCol - w_BaseCol + 1
                                        End If

                                        '配属しているの？
                                        w_Idocnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                        w_HaizokuFlg = False
                                        For w_IdoLoop = 1 To w_Idocnt
                                            If m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).SyuryoYMD Then
                                                w_HaizokuFlg = True
                                                Exit For
                                            End If
                                        Next w_IdoLoop

                                        '再掲部署の場合はデータを変数に格納
                                        If g_SaikeiFlg = True AndAlso w_DataCol > 0 Then

                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).RiyuKBN = w_Riyu

                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).RegistID = w_RegistID

                                            If Trim(w_KinmuCD) = "" Then
                                                '勤務ｺｰﾄﾞが未設定の場合は削除
                                                m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).DataChk = M_DataFlg_Delete
                                            Else
                                                m_StaffData(w_StaffIdx).SaikeiData(w_DataCol).DataChk = M_DataFlg_Update
                                            End If
                                        End If
                                    End If '---> 在職中？（退職日チェック）
                                End If

                                '１日加算
                                w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_DataLoop, Date.Parse(Format(w_From, "0000/00/00"))), "yyyyMMdd"))
                                General.g_objGetData.m翌日予定()
                            Next w_DataLoop
                        End If
                    End If
                End If '---> 職員情報格納配列取得OK？

                If w_Row <> m_StaffRow.EndRow Then
                    '処理経過ｶｳﾝﾄ
                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount \ w_DivideNum + 1
                End If
            Next w_Row

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub HideModelessForm()
        Const W_SUBNAME As String = "NSK0000HA HideModelessForm"
        Try
            'ﾊﾟﾚｯﾄ、検索･置換画面が開いている場合は閉じる
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                m_PaletteForm.Hide()
                '[表示]-[パレット]ﾒﾆｭｰ項目の横にﾁｪｯｸﾏｰｸを非表示に切替
                m_lstmnuView(M_MenuPalette).Checked = False
                '検索/置換画面使用可
                m_lstmnuEdit(M_MenuKensaku).Enabled = True
                m_lstmnuEdit(M_MenuChikan).Enabled = True
                m_lstmnuPopup(M_PopKensaku).Enabled = True
                m_lstmnuPopup(M_PopChikan).Enabled = True
                tbrMain.Items.Item(M_ToolBarKey_Search).Visible = True
                tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = True
            End If

            '検索画面が表示されている場合
            If m_KensakuForm.pShowFlg = True Then
                m_KensakuForm.Hide()
                m_KensakuForm.pShowFlg = False
                'ﾊﾟﾚｯﾄ使用可
                m_lstmnuView(M_MenuPalette).Enabled = True
                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
            End If

            If m_ChikanForm.pShowFlg = True Then
                '置換画面が表示されている場合
                m_ChikanForm.Hide()
                m_ChikanForm.pShowFlg = False
                'ﾊﾟﾚｯﾄ使用可
                m_lstmnuView(M_MenuPalette).Enabled = True
                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
            End If

            If m_EventForm.pShowFlg = True Then
                '行事一覧画面が表示されている場合
                m_EventForm.Hide()
                m_EventForm.pShowFlg = False
                'ﾊﾟﾚｯﾄ使用可
                m_lstmnuView(M_MenuPalette).Enabled = True
                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '自動割当された勤務をｽﾌﾟﾚｯﾄﾞに反映させる
    Private Sub LoadSchedFile()

        Const W_SUBNAME As String = "NSK0000HA LoadSchedFile"

        Dim w_StaffRow() As StaffRow_Type
        Dim w_MaxIndex As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_4WRow As Integer
        Dim w_4WSearchFlg As Boolean
        Dim w_FilePath As String
        Dim w_FileNo As Integer
        Dim w_OpenFlg As Boolean
        Dim w_LineText As String
        Dim w_StaffID As String
        Dim w_JissekiPos As Integer
        Dim w_Position As Integer
        Dim w_VarDate1 As Object
        Dim w_VarDate2 As Object
        Dim w_M_SearchRow As Integer
        Dim w_4W_SearchRow As Integer
        Dim w_StaffIdx As Integer
        Dim w_IdoLoop As Integer
        Dim w_IdoFlg As Boolean
        Dim w_Col As Integer
        Dim w_TextKinmuCD As String
        Dim w_TextRiyuKbn As String
        Dim w_Code As String
        Dim w_Riyu As String
        Dim w_Time As String = String.Empty
        Dim w_Flg As String
        Dim w_4WCol As Integer
        Dim w_YYYYMMDD As Object
        Dim w_KangoCD As String
        Dim w_Int As Integer
        Dim w_blnFLG As Boolean
        Dim w_lngLoop As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Const W_ADD_POSITION As Integer = 4
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            '行情報変数配列定義
            w_MaxIndex = (m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine
            ReDim w_StaffRow(w_MaxIndex)

            '職員管理番号ごとに行番号を取得する（4週用、1ヶ月用）
            w_Index = 0

            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                    '職員ﾃﾞｰﾀ変数のIndex取得
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            'ｲﾝﾃﾞｯｸｽ値ｶｳﾝﾄｱｯﾌﾟ
                            w_Index = w_Index + 1

                            '職員情報格納変数の配列ｲﾝﾃﾞｯｸｽ
                            w_StaffRow(w_Index).StaffDataIdx = Integer.Parse(w_Var)

                            '職員管理番号取得
                            w_StaffRow(w_Index).StaffID = m_StaffData(w_StaffRow(w_Index).StaffDataIdx).ID

                            '1ヶ月用の行番号取得
                            w_StaffRow(w_Index).MonthSprRow = w_Row

                            '4週／1ヶ月の場合のみ4週用を考慮する
                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週用の行番号取得（4週用と1ヶ月用の職員の並び順は同一なので、w_RowからLoopをはじめる）
                                '初期化
                                w_StaffRow(w_Index).WeekSprRow = 0
                                w_4WSearchFlg = False
                                For w_4WRow = w_Row To m_StaffRow.EndRow
                                    If (w_4WRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                        w_Var = sprSheet_4W.Sheets(0).GetText(w_4WRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If w_Var <> "" Then
                                            If IsNumeric(w_Var) = True Then
                                                If w_StaffRow(w_Index).StaffID = m_StaffData(Integer.Parse(w_Var)).ID Then
                                                    w_StaffRow(w_Index).WeekSprRow = w_4WRow
                                                    w_4WSearchFlg = True
                                                    Exit For
                                                End If
                                            End If
                                        End If
                                    End If
                                Next w_4WRow

                                If w_4WSearchFlg = False Then '上のLoopで見つからない場合のみ行う
                                    For w_4WRow = m_StaffRow.StartRow To w_Row - 1
                                        If (w_4WRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                            w_Var = sprSheet_4W.Sheets(0).GetText(w_4WRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                            If w_Var <> "" Then
                                                If IsNumeric(w_Var) = True Then
                                                    If w_StaffRow(w_Index).StaffID = m_StaffData(Integer.Parse(w_Var)).ID Then
                                                        w_StaffRow(w_Index).WeekSprRow = w_4WRow
                                                        w_4WSearchFlg = True
                                                        Exit For
                                                    End If
                                                End If
                                            End If
                                        End If
                                    Next w_4WRow
                                End If
                            End If
                        End If
                    End If
                End If
            Next w_Row

            'I/Fﾌｧｲﾙのパス、ファイル名取得
            w_FilePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "DataPath", "")
            w_FilePath = w_FilePath & "Schedif.dat"

            '空ﾌｧｲﾙ№取得
            w_FileNo = FreeFile()

            'I/Fﾃｷｽﾄﾌｧｲﾙ OPEN
            FileOpen(w_FileNo, w_FilePath, OpenMode.Input, OpenAccess.Read, OpenShare.LockRead)
            w_OpenFlg = True

            '計画期間ﾃﾞｰﾀの開始位置を設定する
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週／1ヶ月の場合
                w_VarDate1 = DirectCast(Format(m_4WeekKikan(1).StartDate, "0000/00/00"), Object)
                w_VarDate2 = DirectCast(Format(m_JissekiKikan.EndDate, "0000/00/00"), Object)
                w_JissekiPos = DateDiff(DateInterval.Day, Date.Parse(w_VarDate1), Date.Parse(w_VarDate2)) + 1
            Else
                '4週／4週、1ヶ月／1ヶ月
                w_VarDate1 = DirectCast(Format(m_JissekiKikan.StartDate, "0000/00/00"), Object)
                w_VarDate2 = DirectCast(Format(m_JissekiKikan.EndDate, "0000/00/00"), Object)
                w_JissekiPos = DateDiff(DateInterval.Day, Date.Parse(w_VarDate1), Date.Parse(w_VarDate2)) + 1
            End If
            w_JissekiPos = w_JissekiPos * 4 '勤務CD３桁化

            Do While Not EOF(w_FileNo)
                '行を変数に読み込みます。
                w_LineText = LineInput(w_FileNo)

                '職員管理番号
                w_StaffID = Trim(General.paLeft(w_LineText, 10))

                '計画開始位置計算（(職員管理番号(10)+技量(4)+自動割当対象区分(1)+ﾁｰﾑ(1)+1＝17)＋(実績日数×３→４)）
                w_Position = 17 + w_JissekiPos

                '該当職員の行取得
                w_M_SearchRow = 0
                w_4W_SearchRow = 0
                For w_Index = 1 To UBound(w_StaffRow)
                    If w_StaffRow(w_Index).StaffID = w_StaffID Then
                        w_StaffIdx = w_StaffRow(w_Index).StaffDataIdx
                        w_M_SearchRow = w_StaffRow(w_Index).MonthSprRow
                        w_4W_SearchRow = w_StaffRow(w_Index).WeekSprRow
                        Exit For
                    End If
                Next w_Index

                'ｽﾌﾟﾚｯﾄﾞに反映させる
                For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    '計画期間分Loop
                    '該当部署に配属しているの？
                    w_IdoFlg = True '日付が正しく取得できない場合は配属とみなして処理を行う
                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var <> "" Then '日付（YYYYMMDD形式）を取得
                        If IsNumeric(w_Var) = True Then
                            w_IdoFlg = False
                            For w_IdoLoop = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                If m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).SyuryoYMD Then
                                    w_IdoFlg = True

                                    Exit For
                                End If
                            Next w_IdoLoop
                        End If
                    End If

                    w_YYYYMMDD = w_Var

                    If w_IdoFlg = True Then
                        'I/Fﾌｧｲﾙから該当日（該当列）の勤務ｺｰﾄﾞ、理由ｺｰﾄﾞを取得する
                        w_TextKinmuCD = General.paLeft(Mid(w_LineText, w_Position, 4), 3)
                        w_TextRiyuKbn = General.paRight(Mid(w_LineText, w_Position, 4), 1)

                        '1ヶ月（計画期間用）ｽﾌﾟﾚｯﾄﾞ更新
                        With sprSheet_M.Sheets(0)
                            '自動割当開始日以前の日付は処理をしない
                            If m_SelectDate <= w_YYYYMMDD Then
                                '一旦ｾﾙをクリアする
                                .Cells(w_M_SearchRow, w_Col).BackColor = Color.White
                                .Cells(w_M_SearchRow, w_Col).ForeColor = Color.Black
                                .SetText(w_M_SearchRow, w_Col, "")
                            Else
                                w_Position = w_Position + W_ADD_POSITION
                                Continue For
                            End If


                            If w_TextKinmuCD <> "000" AndAlso IsNumeric(w_TextKinmuCD) = True Then
                                '勤務が割当られている場合のみ
                                '該当セルの情報を取得
                                w_Code = ""
                                w_Riyu = ""
                                w_Time = ""
                                w_KangoCD = ""
                                w_Comment = "" '2016/03/02 Ishiga add
                                w_Flg = M_GAITOBUSHO

                                w_Var = .GetText(w_M_SearchRow, w_Col)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start =========================================
                                    'Call Get_KinmuMark(w_Var, w_Code, w_Riyu, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_Code, w_Riyu, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   =========================================
                                End If

                                '応援勤務が応援勤務退避用配列にあるか（割り当て前に応援勤務が入力されていた状態にする）
                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).WariateOuenKinmu)
                                    If m_StaffData(w_StaffIdx).WariateOuenKinmu(w_Int).Date_Renamed = w_YYYYMMDD Then
                                        w_KangoCD = m_StaffData(w_StaffIdx).WariateOuenKinmu(w_Int).StrData
                                    End If
                                Next w_Int

                                '2015/04/10 Bando Add Start ================
                                '希望コメントが退避用配列にあるか
                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).WariateComment)
                                    If m_StaffData(w_StaffIdx).WariateComment(w_Int).Date_Renamed = w_YYYYMMDD Then
                                        w_Comment = m_StaffData(w_StaffIdx).WariateComment(w_Int).StrData
                                    End If
                                Next w_Int
                                '2015/04/10 Bando Add End   ================

                                '代休管理を行う場合のみ
                                If General.g_lngDaikyuMng = 0 Then
                                    If InStr(m_HolDateStr, w_YYYYMMDD) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_YYYYMMDD), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_YYYYMMDD), "0000/00/00"))) = 7) Then
                                        If g_KinmuM(Integer.Parse(w_TextKinmuCD)).DaikyuFlg = "1" Then
                                            '初期化
                                            w_blnFLG = False
                                            If UBound(m_StaffData(w_StaffIdx).Daikyu) > 0 Then '代休情報がある場合
                                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                    If m_StaffData(w_StaffIdx).Daikyu(w_Int).HolDate = w_YYYYMMDD Then
                                                        w_blnFLG = True
                                                        Exit For
                                                    End If
                                                Next w_Int

                                                If w_blnFLG = False Then '同じ代休情報が無ければ配列に格納
                                                    ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu) + 1)
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_TextKinmuCD
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                    '取得区分
                                                    'とりあえず１日としてセット
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1

                                                    '代休1.5日分発生対象勤務かチェック
                                                    For w_lngLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                        If w_TextKinmuCD = m_Daikyu15KinmuCD(w_lngLoop) Then
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                            Exit For
                                                        End If
                                                    Next w_lngLoop

                                                    ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""

                                                    w_TextRiyuKbn = Convert.ToString(7)
                                                End If
                                            Else '代休情報がない場合
                                                ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(1)
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_TextKinmuCD
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                '取得区分
                                                'とりあえず１日としてセット
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1

                                                '代休1.5日分発生対象勤務かチェック
                                                For w_lngLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                    If w_TextKinmuCD = m_Daikyu15KinmuCD(w_lngLoop) Then
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                        Exit For
                                                    End If
                                                Next w_lngLoop

                                                ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""

                                                w_TextRiyuKbn = Convert.ToString(7)
                                            End If
                                        End If
                                    End If
                                End If

                                If IsNumeric(w_TextKinmuCD) = True Then
                                    'ｾﾙ設定文字列取得
                                    '2015/04/10 Bando Upd Start =========================================
                                    'w_Var = Set_KinmuMark(w_TextKinmuCD, w_TextRiyuKbn, w_Flg, w_KangoCD, w_Time)
                                    w_Var = Set_KinmuMark(w_TextKinmuCD, w_TextRiyuKbn, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   =========================================
                                    'ｾﾙに勤務ﾃﾞｰﾀを設定する
                                    Call .SetText(w_M_SearchRow, w_Col, w_Var)

                                    '理由区分によりｾﾙの色分けを行う
                                    Select Case w_TextRiyuKbn
                                        Case "1" '通常
                                            w_BackColor = Color.White
                                            w_ForeColor = Color.Black
                                        Case "2" '要請
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                        Case "3" '希望
                                            '2015/07/21 Bando Upd Start ==================
                                            If w_Comment = "" Then
                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                            Else
                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                            End If
                                            '2015/07/21 Bando Upd End   ==================
                                        Case "4" '再掲
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                        Case "5" '委員会
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                        Case "6" '応援
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                    End Select

                                    If General.g_lngDaikyuMng = 0 Then
                                        If Check_DaikyuBackColor(w_YYYYMMDD, w_StaffIdx) = True Then
                                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                        End If
                                    End If

                                    If w_Time <> "" Then
                                        '勤務時間が登録されている場合
                                        w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                        w_ForeColor = ColorTranslator.FromOle(m_KinmuTime_Fore)
                                    End If

                                    .Cells(w_M_SearchRow, w_Col).BackColor = w_BackColor
                                    .Cells(w_M_SearchRow, w_Col).ForeColor = w_ForeColor
                                End If
                            End If '---> 割当勤務？
                        End With

                        '4週／1ヶ月の場合で日付が正しく取得できていれば4週用ｽﾌﾟﾚｯﾄﾞにも反映させる
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso IsNumeric(w_YYYYMMDD) = True Then
                            With sprSheet_4W.Sheets(0)
                                '4週ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                                If Get_Col_4W(w_YYYYMMDD, w_4WCol) = True Then
                                    If m_SelectDate <= w_YYYYMMDD Then
                                        '一旦ｾﾙをクリアする
                                        .Cells(w_4W_SearchRow, w_4WCol).BackColor = Color.White
                                        .Cells(w_4W_SearchRow, w_4WCol).ForeColor = Color.Black
                                        .SetText(w_4W_SearchRow, w_4WCol, "")
                                    Else
                                        w_Position = w_Position + W_ADD_POSITION
                                        Continue For
                                    End If

                                    If w_TextKinmuCD <> "000" AndAlso IsNumeric(w_TextKinmuCD) = True Then
                                        '勤務が割当られている場合のみ
                                        If IsNumeric(w_TextKinmuCD) = True Then
                                            'ｾﾙに勤務ﾃﾞｰﾀを設定する
                                            Call .SetText(w_4W_SearchRow, w_4WCol, w_Var)

                                            '理由区分によりｾﾙの色分けを行う
                                            Select Case w_TextRiyuKbn
                                                Case "1" '通常
                                                    w_BackColor = Color.White
                                                    w_ForeColor = Color.Black
                                                Case "2" '要請
                                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                    w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                                Case "3" '希望
                                                    '2015/07/21 Bando Upd Start ==================
                                                    If w_Comment = "" Then
                                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                                    Else
                                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                        w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                                    End If
                                                    '2015/07/21 Bando Upd End   ==================
                                                Case "4" '再掲
                                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                    w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                                Case "5" '委員会
                                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                    w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                                Case "6" '応援
                                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                    w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                            End Select

                                            If General.g_lngDaikyuMng = 0 Then
                                                If Check_DaikyuBackColor(w_YYYYMMDD, w_StaffIdx) = True Then
                                                    w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                End If
                                            End If

                                            If w_Time <> "" Then
                                                '勤務時間が登録されている場合
                                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_KinmuTime_Fore)
                                            End If

                                            .Cells(w_4W_SearchRow, w_4WCol).BackColor = w_BackColor
                                            .Cells(w_4W_SearchRow, w_4WCol).ForeColor = w_ForeColor
                                        End If
                                    End If '---> 割当勤務？
                                End If
                            End With
                        End If '---> 4週用ｽﾌﾟﾚｯﾄﾞにも反映？
                    End If '---> 配属？

                    '文字取得位置
                    w_Position = w_Position + W_ADD_POSITION '勤務CD３桁化
                Next w_Col '---> 計画期間列数分Loop（開始列から終了列まで）
            Loop  '---> I/Fﾌｧｲﾙﾃﾞｰﾀの終端までLoop（Do While文）

            w_OpenFlg = False
            'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
            FileClose(w_FileNo)

        Catch ex As Exception
            If w_OpenFlg = True Then
                'ﾌｧｲﾙOpenの場合はﾌｧｲﾙをCloseする
                FileClose(w_FileNo)
            End If
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub RunErrorCheck()

        Const W_SUBNAME As String = "NSK0000HA RunErrorCheck"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Try
            Me.Cursor = Cursors.WaitCursor

            '必要人数ﾁｪｯｸ必要
            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                Call Check_DayNeedNumber(w_Col)
            Next w_Col

            '個人別エラーチェック
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        'エラー用集計／チェック
                        Call Check_PersonalCalc(w_Row + m_KinmuPlan, True)
                    Else
                        'エラー用集計／チェック
                        Call Check_PersonalCalc(w_Row + m_KinmuPlan, False)
                    End If
                End If
            Next w_Row

            Me.Cursor = Cursors.Default

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '自動割当実行
    Private Sub RunAutoAssign()

        Const W_SUBNAME As String = "NSK0000HA RunAutoAssign"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_MsgRc As Integer
        Dim w_SchedForm As frmNSK0000HH
        Dim w_CalStartDate As Date
        Dim w_TargetDate As Date
        Dim w_Lng As Integer
        Dim w_Index As Integer
        Dim w_SelectIndex As Integer
        Dim w_strMsg() As String
        Try
            If m_PgmFlg <> General.G_PGMSTARTFLG_NEWPLAN AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                Exit Sub
            End If

            'ﾙｰﾙ設定がなされているか？
            'RICHARD UPDATE START
            'w_Sql = "SELECT CONDCD"
            'w_Sql = w_Sql & " FROM NS_CONDITION_F"
            'w_Sql = w_Sql & " WHERE APPLYKBN = '1'"
            'w_Sql = w_Sql & " AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)

            Call NSK0000H_sql.select_NS_CONDITION_F_03(w_Rs) '<7>
            'RICHARD UPDATE END

            If w_Rs.RecordCount <= 0 Then
                'ﾙｰﾙ設定がなされていない場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "割当ルール情報"
                Call Set_MsgZOrder("NS0010", w_strMsg, w_MsgRc, 0)
                w_Rs.Close()
                Exit Sub
            End If
            w_Rs.Close()

            '☆☆☆☆ ﾙｰﾙ設定OKの場合 ☆☆☆☆
            Cursor.Current = Cursors.WaitCursor

            'ﾊﾟﾚｯﾄ、検索･置換画面が開いている場合は閉じる
            Call HideModelessForm()

            '自動割当用 I/Fﾌｧｲﾙ 作成
            Call CreateAutoSchedIFData()

            '自動割当実行画面のｲﾝｽﾀﾝｽ生成
            w_SchedForm = New frmNSK0000HH

            '各種ﾌﾟﾛﾊﾟﾃｨ値設定
            'ｶﾚﾝﾀﾞｰ開始日・終了日
            w_SchedForm.pAutoCalStartDate = m_Calendar.StartDate
            w_SchedForm.pAutoCalEndDate = m_Calendar.EndDate
            'ｶﾚﾝﾀﾞｰ開始日を日付型変数に変換して格納
            w_CalStartDate = Date.Parse(Format(m_Calendar.StartDate, "0000/00/00"))

            '割当開始日・終了日
            w_SchedForm.pAutoScheduleStartDate = m_Schedule.StartDate
            w_SchedForm.pAutoScheduleEndDate = m_Schedule.EndDate
            '割当開始・終了相対列
            w_TargetDate = Date.Parse(Format(m_Schedule.StartDate, "0000/00/00"))
            w_SchedForm.pAutoScheduleStartCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))
            w_TargetDate = Date.Parse(Format(m_Schedule.EndDate, "0000/00/00"))
            w_SchedForm.pAutoScheduleEndCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))

            '表示期間開始・終了日
            w_SchedForm.pAutoDisplayStartDate = m_Display.StartDate
            w_SchedForm.pAutoDisplayEndDate = m_Display.EndDate
            '表示期間開始・終了相対列
            w_TargetDate = Date.Parse(Format(m_Display.StartDate, "0000/00/00"))
            w_SchedForm.pAutoDisplayStartCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))
            w_TargetDate = Date.Parse(Format(m_Display.EndDate, "0000/00/00"))
            w_SchedForm.pAutoDisplayEndCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))

            'ﾕｰｻﾞｰ指定開始・終了相対列（割当開始・終了相対列と同じ）
            w_TargetDate = Date.Parse(Format(m_Schedule.StartDate, "0000/00/00"))
            w_SchedForm.pAutoUserStartCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))
            w_TargetDate = Date.Parse(Format(m_Schedule.EndDate, "0000/00/00"))
            w_SchedForm.pAutoUserEndCol = Integer.Parse(DateDiff(DateInterval.Day, w_CalStartDate, w_TargetDate))

            '2012/11/16 Ishiga add start------
            '計画番号
            w_SchedForm.p_PlanNO = m_PlanNo
            '2012/11/16 Ishiga add end--------

            '2014/06/13 TAKEBAYASHI P-07100 Add (ﾊﾟﾗﾒｰﾀの設定) START-->>
            'ﾁｰﾑ番号
            w_SchedForm.p_SelTeamNo = m_SelTeamNo
            w_SchedForm.p_OuenTeam = m_OuenTeam
            w_SchedForm.p_TeamCnt = m_TeamCnt
            '2014/06/13 TAKEBAYASHI P-07100 Add (ﾊﾟﾗﾒｰﾀの設定) END<<--

            'ｺﾝﾎﾞﾎﾞｯｸｽ選択開始年月日
            w_Index = cmbKikan.SelectedIndex
            If w_Index <> -1 Then
                w_SelectIndex = Integer.Parse(GetItemData(cmbKikan, w_Index))
                w_SchedForm.pKikanStart = Convert.ToString(m_4WeekKikan(w_SelectIndex).StartDate)
                w_SchedForm.pKikanEnd = Convert.ToString(m_4WeekKikan(w_SelectIndex).EndDate)
            Else
                w_SchedForm.pKikanStart = Convert.ToString(0)
                w_SchedForm.pKikanEnd = Convert.ToString(0)
            End If

            Cursor.Current = Cursors.Default

            '画面表示
            w_SchedForm.ShowDialog(Me)

            Me.Refresh()

            Cursor.Current = Cursors.WaitCursor
            '自動割当開始日を取得
            m_SelectDate = w_SchedForm.p_SelectDate

            '終了処理
            If w_SchedForm.pSchedSaveFlg = True Then
                '結果反映ﾌﾗｸﾞがTrueの場合のみ処理を行う
                '割当結果をｽﾌﾟﾚｯﾄﾞに反映させる
                Call LoadSchedFile()

                '個人別集計 計算実行(計画期間)
                For w_Lng = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        '個人別集計 計算実行(計画期間)
                        Call RunReCalc_PUser(w_Lng)
                        '4週個人別集計 計算実行(計画期間)   注：4週用ｽﾌﾟﾚｯﾄﾞの設定の有無は関数内でチェックしている
                        Call RunReCalc_User_4W(w_Lng)
                        Call RunReCalc_PUser_Jisseki(w_Lng)
                    End If
                Next w_Lng

                '日別集計 計算実行(計画期間)
                For w_Lng = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    Call RunReCalc_PDay(w_Lng)
                Next w_Lng
            End If

            '自動割当実行画面 解放
            w_SchedForm = Nothing

            Cursor.Current = Cursors.Default

            '自画面を表示する
            Me.Show()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub RunFontSizeChange()

        Const W_SUBNAME As String = "NSK0000HA RunFontSizeChange"

        Dim w_TotalLeft As Integer
        Dim w_intSelLine As Integer
        Dim w_Loop As Integer
        Try
            w_intSelLine = 0
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PackageFLG <> 0 Then
                '勤務変更 又は (計画新規 or 計画変更で届出か日当直を使用してる) 画面の時
                For w_Loop = 0 To 3
                    If m_lstmnuKinmuView(w_Loop).Available Then
                        If m_lstmnuKinmuView(w_Loop).Checked Then
                            w_intSelLine = w_Loop + 1
                        End If
                    End If
                Next w_Loop
            Else
                '計画新規 or 計画変更で届出も日当直も使用していない 画面の時
                w_intSelLine = 1
            End If

            'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
            If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                m_MaxMainWidth = m_CtrlSize(m_FontIndex).NormalModeMaxWidth
                m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).NormalModePersonalTotalWidth
            Else
                m_MaxMainWidth = m_CtrlSize(m_FontIndex).WeekModeMaxWidth
                m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).WeekModePersonalTotalWidth
            End If

            If m_SelTeamNo = 0 Then
                m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(m_SelTeamNo, w_intSelLine) + 2
                If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight
                m_DayTotalHeight = m_CtrlSize(m_FontIndex).NormalModeDayTotalHeight
            Else
                m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(m_SelTeamNo, w_intSelLine) + 2
                If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight
                m_DayTotalHeight = m_CtrlSize(m_FontIndex).TeamModeDayTotalHeight
            End If

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                    w_TotalLeft = m_KeikakuKikan.KoteiStartCol
                Else
                    w_TotalLeft = m_4WeekKikan(m_SelViewKikan).KoteiStartCol
                End If

                sprPTotal.SetViewportLeftColumn(0, w_TotalLeft)
            End If

            picBase.Visible = False

            'ﾌｫﾝﾄｻｲｽﾞを設定する
            Call ChangeFontSize(m_FontIndex)

            'ｽﾌﾟﾚｯﾄﾞのｾﾙ設定
            Call Set_CellSize()

            'ｻｲｽﾞ調整する
            Call Resize_SpreadCtrl()

            picBase.Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub RunOneTwoChange(ByVal p_ResizeFLG As Boolean, ByVal p_Index As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunOneTwoChange"

        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Col As Integer
        Dim w_4Week As Integer
        Dim w_VarPlan As Object '上段⇔下段　文字入替
        Dim w_VarJisseki As Object '上段⇔下段　文字入替
        Dim w_Plan_Fore As Integer '上段⇔下段　文字色入替
        Dim w_Plan_Back As Integer '上段⇔下段　背景色入替
        Dim w_Jisseki_Fore As Integer '上段⇔下段　文字色入替
        Dim w_Jisseki_Back As Integer '上段⇔下段　背景色入替
        Dim w_Spr As FpSpread
        Dim w_blnDutyUseFlg As Boolean
        Dim w_blnJissekiUseFlg As Boolean
        Dim w_blnAppliUseFlg As Boolean
        Dim w_StaffIdx As Integer
        Dim w_Var As Object
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_GetCol As Integer
        Try
            picBase.Visible = False

            w_blnDutyUseFlg = False
            w_blnJissekiUseFlg = False
            w_blnAppliUseFlg = False
            Call Get_UseFlg(w_blnDutyUseFlg, w_blnJissekiUseFlg, w_blnAppliUseFlg)

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                '勤務実績の段の表示を変更した場合
                If m_blnJissekiUseFlg <> w_blnJissekiUseFlg Then
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                        '勤務実績の段の表示を制御する
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                            'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                            w_VarPlan = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                            w_VarJisseki = sprSheet_M.Sheets(0).GetText(w_Row - 1, w_Col)

                            If w_VarPlan <> "" AndAlso w_VarJisseki = "" Then
                                w_VarJisseki = w_VarPlan
                                sprSheet_M.Sheets(0).SetText(w_Row - 1, w_Col, w_VarJisseki)
                            End If

                            If w_VarPlan = "" Then
                            Else

                                w_Plan_Fore = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_Col).ForeColor)
                                If sprSheet_M.Sheets(0).Cells(w_Row, w_Col).BackColor.A = 0 Then
                                    w_Plan_Back = ColorTranslator.ToOle(Color.White)
                                Else
                                    w_Plan_Back = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_Col).BackColor)
                                End If

                                w_VarJisseki = sprSheet_M.Sheets(0).GetText(w_Row - 1, w_Col)

                                w_Jisseki_Fore = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).ForeColor)
                                If sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).BackColor.A = 0 Then
                                    w_Jisseki_Back = ColorTranslator.ToOle(Color.White)
                                Else
                                    w_Jisseki_Back = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).BackColor)
                                End If

                                sprSheet_M.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                                sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)

                                sprSheet_M.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                                sprSheet_M.Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_Jisseki_Fore)
                                sprSheet_M.Sheets(0).Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_Jisseki_Back)
                            End If

                            If p_Index <> 0 Then
                                If w_VarPlan = w_VarJisseki Then

                                    w_VarJisseki = sprSheet_M.Sheets(0).GetText(w_Row - 1, w_Col)

                                    If m_Comp_Fore = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_Col).ForeColor) Then
                                        sprSheet_M.Sheets(0).SetText(w_Row - 1, w_Col, "")
                                    End If
                                End If

                                '上記チェックのみでは不十分な箇所がある
                                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                                If IsNumeric(w_Var) Then
                                    w_StaffIdx = Integer.Parse(w_Var)
                                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)

                                    w_YYYYMMDD = w_Var

                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_YYYYMMDD, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        End If
                                    End If

                                    w_Jisseki_Back = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row - 1, w_Col).BackColor)

                                    '対象職員の対象日のデータがデータ無し or 他部署確定データの時
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = "" OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" AndAlso w_Jisseki_Back <> m_MonthBefore_Back Then
                                        sprSheet_M.Sheets(0).SetText(w_Row - 1, w_Col, "")
                                    End If
                                End If
                            End If
                        Next w_Col

                        '集計部分も上段と下段を入れ替える
                        For w_Col = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                            w_VarPlan = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                            w_VarJisseki = sprSheet_M.Sheets(0).GetText(w_Row - 1, w_Col)

                            sprSheet_M.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                            sprSheet_M.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                        Next w_Col

                        For w_Col = m_KeikakuKikan.KoteiStartCol To m_KeikakuKikan.KoteiEndCol
                            w_VarPlan = sprPTotal.Sheets(0).GetText(w_Row, w_Col)
                            w_VarJisseki = sprPTotal.Sheets(0).GetText(w_Row - 1, w_Col)

                            sprPTotal.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                            sprPTotal.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                        Next w_Col

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月の場合
                            For w_4Week = 1 To UBound(m_4WeekKikan)
                                For w_Col = m_4WeekKikan(w_4Week).KinmuDataStartCol To m_4WeekKikan(w_4Week).KinmuDataEndCol
                                    'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                                    w_VarPlan = sprSheet_4W.Sheets(0).GetText(w_Row, w_Col)
                                    w_VarJisseki = sprSheet_4W.Sheets(0).GetText(w_Row - 1, w_Col)

                                    If w_VarPlan <> "" AndAlso w_VarJisseki = "" Then
                                        w_VarJisseki = w_VarPlan
                                        sprSheet_4W.Sheets(0).SetText(w_Row - 1, w_Col, w_VarJisseki)
                                    End If

                                    'ｽﾌﾟﾚｯﾄﾞの背景色取得
                                    If w_blnJissekiUseFlg Then
                                        w_Plan_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor)
                                    Else
                                        w_Plan_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).BackColor)
                                    End If

                                    If w_VarPlan = "" AndAlso w_Plan_Back <> ColorTranslator.ToOle(Color.Black) Then
                                    Else

                                        w_Plan_Fore = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).ForeColor)
                                        If sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor.A = 0 Then
                                            w_Plan_Back = ColorTranslator.ToOle(Color.White)
                                        Else
                                            w_Plan_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor)
                                        End If

                                        w_VarJisseki = sprSheet_4W.Sheets(0).GetText(w_Row - 1, w_Col)
                                        w_Jisseki_Fore = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).ForeColor)
                                        If sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).BackColor.A = 0 Then
                                            w_Jisseki_Back = ColorTranslator.ToOle(Color.White)
                                        Else
                                            w_Jisseki_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).BackColor)
                                        End If

                                        sprSheet_4W.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                                        sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                        sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)

                                        sprSheet_4W.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                                        sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_Jisseki_Fore)
                                        sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_Jisseki_Back)
                                    End If

                                    If p_Index <> 0 Then
                                        If w_VarPlan = w_VarJisseki Then
                                            w_VarJisseki = sprSheet_4W.Sheets(0).GetText(w_Row - 1, w_Col)
                                            If m_Comp_Fore = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).ForeColor) Then
                                                sprSheet_4W.Sheets(0).SetText(w_Row - 1, w_Col, "")
                                            End If
                                        End If

                                        '上記チェックのみでは不十分な箇所がある
                                        w_Var = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)

                                        If IsNumeric(w_Var) Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)

                                            w_YYYYMMDD = w_Var

                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                '1ｹ月/1ｹ月,4週/4週の場合
                                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                w_Cnt = w_Col - w_KeikakuCol + 1
                                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                '4週/1ｹ月の場合
                                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_YYYYMMDD, w_GetCol) = True Then
                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                End If
                                            End If

                                            w_Jisseki_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - 1, w_Col).BackColor)

                                            If w_Cnt > 0 Then
                                                '対象職員の対象日のデータがデータ無し or 他部署確定データの時
                                                If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = "" OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" AndAlso w_Jisseki_Back <> m_MonthBefore_Back Then
                                                    sprSheet_4W.Sheets(0).SetText(w_Row - 1, w_Col, "")
                                                End If
                                            End If
                                        End If
                                    End If
                                Next w_Col

                                '集計部分も上段と下段を入れ替える
                                For w_Col = m_4WeekKikan(w_4Week).PersonalStartCol To m_4WeekKikan(w_4Week).PersonalEndCol
                                    w_VarPlan = sprSheet_4W.Sheets(0).GetText(w_Row, w_Col)
                                    w_VarJisseki = sprSheet_4W.Sheets(0).GetText(w_Row - 1, w_Col)

                                    sprSheet_4W.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                                    sprSheet_4W.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                                Next w_Col

                                For w_Col = m_4WeekKikan(w_4Week).KoteiStartCol To m_4WeekKikan(w_4Week).KoteiEndCol
                                    w_VarPlan = sprPTotal.Sheets(0).GetText(w_Row, w_Col)
                                    w_VarJisseki = sprPTotal.Sheets(0).GetText(w_Row - 1, w_Col)

                                    sprPTotal.Sheets(0).SetText(w_Row, w_Col, w_VarJisseki)
                                    sprPTotal.Sheets(0).SetText(w_Row - 1, w_Col, w_VarPlan)
                                Next w_Col
                            Next w_4Week
                        End If
                    End If
                End If

                '届出の段の表示を変更した場合
                If m_blnAppliUseFlg <> w_blnAppliUseFlg Then
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                        '届出の段の表示を制御する
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                            'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                            w_VarPlan = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                            If w_VarPlan <> "" Then
                                If w_blnAppliUseFlg Then
                                    '背景色を元に戻す
                                    If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor) = m_Appli_Fore AndAlso
                                            ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor) = m_Appli_Back Then
                                        sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor = Color.Black
                                        sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor = Color.White
                                    End If
                                Else
                                    '背景色を届出にする
                                    If sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor.Equals(Color.Black) AndAlso
                                            sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor.Equals(Color.White) Then
                                        sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor = ColorTranslator.FromOle(m_Appli_Fore)
                                        sprSheet_M.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor = ColorTranslator.FromOle(m_Appli_Back)
                                    End If
                                End If
                            End If
                        Next w_Col

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月の場合
                            For w_4Week = 1 To UBound(m_4WeekKikan)
                                For w_Col = m_4WeekKikan(w_4Week).KinmuDataStartCol To m_4WeekKikan(w_4Week).KinmuDataEndCol
                                    'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                                    w_VarPlan = sprSheet_4W.Sheets(0).GetText(w_Row, w_Col)
                                    If w_VarPlan <> "" Then
                                        If w_blnAppliUseFlg Then
                                            '背景色を元に戻す
                                            If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor) = m_Appli_Fore AndAlso
                                                    ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor) = m_Appli_Back Then
                                                sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor = Color.Black
                                                sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor = Color.White
                                            End If
                                        Else
                                            '背景色を届出にする
                                            If sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor.Equals(Color.Black) AndAlso
                                                    sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor.Equals(Color.White) Then
                                                sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).ForeColor = ColorTranslator.FromOle(m_Appli_Fore)
                                                sprSheet_4W.Sheets(0).Cells(w_Row - m_AppliData + m_KinmuPlan, w_Col).BackColor = ColorTranslator.FromOle(m_Appli_Back)
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            Next w_4Week
                        End If
                    End If
                End If

                If p_ResizeFLG Then
                    w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then
                        '日当直の段の表示を制御する
                        If w_blnDutyUseFlg Then
                            '表示するときは通常幅
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, sprSheet_M.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, sprSheet_4W.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, sprPTotal.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                        Else
                            '表示しないときは幅「０」
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                        End If
                    ElseIf (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        '勤務予定の段の表示はなにもしない
                    ElseIf (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                        '勤務実績の段の表示を制御する
                        If w_blnJissekiUseFlg Then
                            '二段表示のときは通常幅
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, sprSheet_M.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, sprSheet_4W.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, sprPTotal.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                        Else
                            '一段表示のときは幅「０」
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                        End If
                    ElseIf (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                        '届出の段の表示を制御する
                        If w_blnAppliUseFlg Then
                            '表示するときは通常幅
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, sprSheet_M.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, sprSheet_4W.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, sprPTotal.Sheets(0).GetRowHeight(w_Row2 + m_KinmuPlan))
                        Else
                            '表示しないときは幅「０」
                            sprSheet_M.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprSheet_4W.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                            sprPTotal.Sheets(0).SetRowHeight(w_Row, M_HideCellHeight_PlanTwoRow)
                        End If
                    End If
                End If
            Next w_Row

            If p_ResizeFLG Then
                m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(m_SelTeamNo, p_Index + 1) + 2
                If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight

                'ｻｲｽﾞ調整する
                Call Resize_SpreadCtrl()
            End If

            If m_SelViewKikan = 0 Then
                '1ヶ月用
                w_Spr = sprSheet_M
            Else
                '４週用
                w_Spr = sprSheet_4W
            End If

            If (w_Spr.Sheets(0).ActiveRow.Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then
                'セルの位置が日当直の段の場合
                If w_blnDutyUseFlg = False Then
                    '日当直の段を表示しない時
                    '勤務予定の段に移動させる
                    w_Spr.Sheets(0).SetActiveCell(w_Spr.Sheets(0).ActiveRow.Index - m_DutyData + m_KinmuPlan, w_Spr.Sheets(0).ActiveColumn.Index)
                End If
            ElseIf (w_Spr.Sheets(0).ActiveRow.Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                'セルの位置が勤務実績の段の場合
                If w_blnJissekiUseFlg = False Then
                    '勤務実績の段を表示しない時
                    '勤務予定の段に移動させる
                    w_Spr.Sheets(0).SetActiveCell(w_Spr.Sheets(0).ActiveRow.Index - m_KinmuJisseki + m_KinmuPlan, w_Spr.Sheets(0).ActiveColumn.Index)
                End If
            ElseIf (w_Spr.Sheets(0).ActiveRow.Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                'セルの位置が届出の段の場合
                If w_blnAppliUseFlg = False Then
                    '届出の段を表示しない時
                    '勤務予定の段に移動させる
                    w_Spr.Sheets(0).SetActiveCell(w_Spr.Sheets(0).ActiveRow.Index - m_AppliData + m_KinmuPlan, w_Spr.Sheets(0).ActiveColumn.Index)
                End If
            End If

            If w_blnJissekiUseFlg Then
                '勤務実績の段を表示する時
                '「切り取り」と「貼り付け」を使用不可にする
                m_blnPopupFLG = False
                m_lstmnuPopup(M_PopCut).Enabled = False
                m_lstmnuEdit(M_MenuCut).Enabled = False
                m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                m_lstmnuPopup(M_PopPaste).Enabled = False
                m_lstmnuEdit(M_MenuPaste).Enabled = False
            Else
                '勤務実績の段を表示しない時
                '元に戻す
                m_blnPopupFLG = True
                m_lstmnuPopup(M_PopCut).Enabled = m_blnPopCutFLG
                m_lstmnuEdit(M_MenuCut).Enabled = m_blnPopCutFLG
                m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopPasteFLG
                m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopPasteFLG
            End If

            m_blnJissekiUseFlg = w_blnJissekiUseFlg
            m_blnAppliUseFlg = w_blnAppliUseFlg

            picBase.Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '*****************************************************************************************
    '   ソート実行関数
    '   与えられた情報でソートを行う
    '
    '   引数：pFlg --> True：m_SortData変数の値でソートする
    '   　　　         False：pSortIndexとpSortOrderを使用してソートする
    '   　　　pSortIndex(省略可) --> ソートを行う職員属性格納配列のIndex指定
    '                               （配列(1ｵﾘｼﾞﾝ)のVariant型） ※但し、配列の最高は３までとする
    '   　　　pSortOrder(省略可) --> ソートを「昇順(SS_SORT_ORDER_ASCENDING)」で行うか、
    '                                       「降順(SS_SORT_ORDER_DESCENDING)」で行うか
    '                               （配列(1ｵﾘｼﾞﾝ)のVariant型） ※但し、配列の最高は３までとする
    '
    '   ※　pFlg=Falseで第２引数(pSortIndex)、第３引数(pSortOrder)を省略した場合は、ソートを行いません
    '   ※　pFlg=Falseで第２引数(pSortIndex)が不正な値の場合は、ソートを行いません。
    '
    '   Create  S.Ooeki     2000/08/22
    '*****************************************************************************************
    Private Sub RunSort(ByVal pFlg As Boolean, Optional ByRef pSortIndex As Object = Nothing, Optional ByRef pSortOrder As Object = Nothing)
        Const W_SUBNAME As String = "NSK0000HA RunSort"

        Dim w_SprIndex As Integer
        Dim w_SortInf() As SortKeyOrder_Type
        Dim w_Loop As Integer
        Dim w_Count As Integer
        Dim w_SortOrder() As Integer
        Dim w_OrderFlg As Boolean
        Dim w_OrderCount As Integer
        Dim w_SortInfo As SortInfo()
        '2017/09/29 Yamanishi Add ---------------------------------------------------
        Dim w_Row As Integer
        Dim w_Height As Integer
        Dim w_SprSheet As SheetView
        Dim w_StaffMngIDCol As Integer
        Dim w_dicStaffMngID2Height As New Dictionary(Of String, Integer)
        '----------------------------------------------------------------------------
        Try
            '2017/09/29 Yamanishi Add Start --------------------------------------------
            If m_ViewRow.StartRow <> 0 AndAlso m_ViewRow.EndRow <> -1 Then
                '職員ﾃﾞｰﾀを一旦全て表示
                w_Count = UBound(m_Spread) + 1

                For w_SprIndex = 1 To w_Count
                    Select Case w_SprIndex
                        Case 1
                            w_SprSheet = m_Spread(w_SprIndex).Sheets(0)
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_M
                        Case w_Count
                            w_SprSheet = sprPTotal_Sheet1
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_PTotal
                        Case Else
                            w_SprSheet = m_Spread(w_SprIndex).Sheets(0)
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_4W
                    End Select

                    With w_SprSheet
                        For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow Step m_MaxShowLine
                            For w_Loop = 0 To m_MaxShowLine - 1
                                w_Height = .GetRowHeight(w_Row + w_Loop)
                                w_dicStaffMngID2Height(w_SprIndex & "|" & .GetText(w_Row, w_StaffMngIDCol) & "|" & w_Loop) = w_Height
                                If w_Height = 0 Then
                                    '非表示のとき
                                    .SetRowHeight(w_Row + w_Loop, m_CellHeight)
                                End If
                            Next w_Loop
                        Next w_Row
                    End With
                Next w_SprIndex
            End If
            '2017/09/29 Yamanishi Add End ----------------------------------------------
            If pFlg = False Then
                'pSortIndexの情報によりソートする
                If IsNothing(pSortIndex) = True Then
                    'pSortIndexに値が与えられない場合は無効（ソートしない）
                    Exit Sub
                End If

                If IsArray(pSortIndex) = True Then
                    '配列で渡されている場合
                    If UBound(pSortIndex) <= 0 Then
                        '配列が０の場合は無効（ソートしない）
                        Exit Sub
                    End If
                Else
                    '配列で渡されていない場合は無効（ソートしない）
                    Exit Sub
                End If

                'pSortOrderの情報
                w_OrderFlg = False
                If IsNothing(pSortOrder) = False AndAlso IsArray(pSortOrder) = True Then
                    'SortOrderが設定されていない場合はすべて「昇順」として処理する
                    w_OrderCount = UBound(pSortOrder)
                    If w_OrderCount > 0 Then
                        w_OrderFlg = True
                    End If
                End If

                'SortOrderの情報を退避する
                w_Count = UBound(pSortIndex)
                ReDim w_SortOrder(w_Count)
                If w_OrderFlg = True Then
                    'pSortOrderが妥当なときは、設定情報でソートする
                    For w_Loop = 1 To w_Count
                        If w_Loop <= w_OrderCount Then
                            w_SortOrder(w_Loop) = pSortOrder(w_Loop)
                        Else
                            w_SortOrder(w_Loop) = True
                        End If
                    Next w_Loop
                Else
                    'pSortOrderが妥当でない場合は、昇順でソートする
                    For w_Loop = 1 To w_Count
                        w_SortOrder(w_Loop) = True
                    Next w_Loop
                End If
            End If

            '--- データ表示スプレッドのソート
            For w_SprIndex = 1 To UBound(m_Spread)

                '配列の初期化
                ReDim w_SortInf(0)

                'Sort情報を取得する
                If pFlg = True Then
                    'm_SortDataでソートを行う
                    For w_Loop = 1 To UBound(m_SortData)
                        If m_SortData(w_Loop).SortKeyIndex <= 0 OrElse M_StaffData_MaxIndex < m_SortData(w_Loop).SortKeyIndex Then
                            Exit For
                        End If

                        '配列を拡張
                        ReDim Preserve w_SortInf(w_Loop)

                        'SortKey列
                        If w_SprIndex = 1 Then
                            'SprSheet_Mが対象の場合
                            w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(m_SortData(w_Loop).SortKeyIndex).SetCol_M
                        Else
                            'SprSheet_4Wが対象の場合
                            w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(m_SortData(w_Loop).SortKeyIndex).SetCol_4W
                        End If

                        'SortOrder値
                        If m_SortData(w_Loop).SortOrder = False Then
                            w_SortInf(w_Loop).SortOrderVal = False
                        Else
                            w_SortInf(w_Loop).SortOrderVal = True
                        End If
                    Next w_Loop
                Else
                    '与えられた引数でソートする
                    For w_Loop = 1 To w_Count
                        If pSortIndex(w_Loop) <= 0 OrElse M_StaffData_MaxIndex < pSortIndex(w_Loop) Then
                            Exit For
                        End If

                        '配列を拡張
                        ReDim Preserve w_SortInf(w_Loop)

                        'SortKey列
                        If w_SprIndex = 1 Then
                            'SprSheet_Mが対象の場合
                            w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(pSortIndex(w_Loop)).SetCol_M
                        Else
                            'SprSheet_4Wが対象の場合
                            w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(pSortIndex(w_Loop)).SetCol_4W
                        End If

                        'SortOrder値
                        If w_SortOrder(w_Loop) = False Then
                            w_SortInf(w_Loop).SortOrderVal = False
                        Else
                            w_SortInf(w_Loop).SortOrderVal = True
                        End If
                    Next w_Loop
                End If

                '配列を拡張
                ReDim Preserve w_SortInf(w_Loop)
                'SortKey列
                If w_SprIndex = 1 Then
                    'SprSheet_Mが対象の場合
                    w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(M_SortTeam).SetCol_M
                Else
                    'SprSheet_4Wが対象の場合
                    w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(M_SortTeam).SetCol_4W
                End If

                'SortOrder値
                w_SortInf(w_Loop).SortOrderVal = True

                If UBound(w_SortInf) = 0 Then
                    'ｿｰﾄ情報設定無し
                    Exit Sub
                End If

                With m_Spread(w_SprIndex).Sheets(0)
                    If m_ViewRow.StartRow <> 0 AndAlso m_ViewRow.EndRow <> -1 Then

                        'Sort情報を設定する
                        For w_Loop = 1 To UBound(w_SortInf)
                            If 4 < w_Loop Then
                                'ｿｰﾄ設定は４つまで
                                Exit For
                            End If
                            ReDim Preserve w_SortInfo(w_Loop - 1)
                            w_SortInfo(w_Loop - 1) = New SortInfo(w_SortInf(w_Loop).SortKeyCol, w_SortInf(w_Loop).SortOrderVal)
                        Next w_Loop

                        .SortRange(m_ViewRow.StartRow, M_StaffName_Col, (m_ViewRow.EndRow - m_ViewRow.StartRow) + 1, (.ColumnCount - M_StaffName_Col), True, w_SortInfo)
                    End If
                End With
            Next w_SprIndex

            '--- 個人別集計スプレッドのソート
            '配列の初期化
            ReDim w_SortInf(0)

            'Sort情報を取得する
            If pFlg = True Then
                'm_SortDataでソートを行う
                For w_Loop = 1 To UBound(m_SortData)
                    If m_SortData(w_Loop).SortKeyIndex <= 0 OrElse M_StaffData_MaxIndex < m_SortData(w_Loop).SortKeyIndex Then
                        Exit For
                    End If

                    '配列を拡張
                    ReDim Preserve w_SortInf(w_Loop)

                    'SortKey列
                    w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(m_SortData(w_Loop).SortKeyIndex).SetCol_PTotal

                    'SortOrder値
                    If m_SortData(w_Loop).SortOrder = False Then
                        w_SortInf(w_Loop).SortOrderVal = False
                    Else
                        w_SortInf(w_Loop).SortOrderVal = True
                    End If
                Next w_Loop
            Else
                '与えられた引数でソートする
                For w_Loop = 1 To w_Count
                    If pSortIndex(w_Loop) <= 0 OrElse M_StaffData_MaxIndex < pSortIndex(w_Loop) Then
                        Exit For
                    End If

                    '配列を拡張
                    ReDim Preserve w_SortInf(w_Loop)

                    'SortKey列
                    w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(pSortIndex(w_Loop)).SetCol_PTotal

                    'SortOrder値
                    If w_SortOrder(w_Loop) = False Then
                        w_SortInf(w_Loop).SortOrderVal = False
                    Else
                        w_SortInf(w_Loop).SortOrderVal = True
                    End If
                Next w_Loop
            End If

            '配列を拡張
            ReDim Preserve w_SortInf(w_Loop)
            'SortKey列
            w_SortInf(w_Loop).SortKeyCol = m_StaffZokusei(M_SortTeam).SetCol_PTotal
            'SortOrder値
            w_SortInf(w_Loop).SortOrderVal = True

            With sprPTotal.Sheets(0)
                If m_ViewRow.StartRow <> 0 AndAlso m_ViewRow.EndRow <> -1 Then

                    'Sort情報を設定する
                    ReDim w_SortInfo(3)

                    For w_Loop = 1 To UBound(w_SortInf)
                        If 4 < w_Loop Then
                            'ｿｰﾄ設定は４つまで
                            Exit For
                        End If
                        w_SortInfo(w_Loop - 1) = New SortInfo(w_SortInf(w_Loop).SortKeyCol, w_SortInf(w_Loop).SortOrderVal)
                    Next w_Loop

                    '.SortRange(m_ViewRow.StartRow, M_HyojiNo_Col, (m_ViewRow.EndRow - m_ViewRow.StartRow) + 1, (.ColumnCount - M_HyojiNo_Col) + 1, True, w_SortInfo)
                    .SortRange(m_ViewRow.StartRow, M_HyojiNo_Col, (m_ViewRow.EndRow - m_ViewRow.StartRow) + 1, (.ColumnCount - M_HyojiNo_Col), True, w_SortInfo)    '2011/09/07 Y.I Mod
                End If
            End With
            '2017/09/29 Yamanishi Add Start --------------------------------------------
            If m_ViewRow.StartRow <> 0 AndAlso m_ViewRow.EndRow <> -1 Then
                '職員ﾃﾞｰﾀの表示を元に戻す
                w_Count = UBound(m_Spread) + 1

                For w_SprIndex = 1 To w_Count
                    Select Case w_SprIndex
                        Case 1
                            w_SprSheet = m_Spread(w_SprIndex).Sheets(0)
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_M
                        Case w_Count
                            w_SprSheet = sprPTotal_Sheet1
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_PTotal
                        Case Else
                            w_SprSheet = m_Spread(w_SprIndex).Sheets(0)
                            w_StaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_4W
                    End Select

                    With w_SprSheet
                        For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow Step m_MaxShowLine
                            For w_Loop = 0 To m_MaxShowLine - 1
                                w_Height = w_dicStaffMngID2Height(w_SprIndex & "|" & .GetText(w_Row, w_StaffMngIDCol) & "|" & w_Loop)
                                If w_Height <> .GetRowHeight(w_Row + w_Loop) Then
                                    '非表示のとき
                                    .SetRowHeight(w_Row + w_Loop, w_Height)
                                End If
                            Next w_Loop
                        Next w_Row
                    End With
                Next w_SprIndex
            End If
            '2017/09/29 Yamanishi Add End ----------------------------------------------
            '非表示行再設定
            Call RunFontSizeChange()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '*********************************
    '   画面の初期設定（ﾃﾞﾌｫﾙﾄ値設定）
    '*********************************
    Private Sub DefaultSet()

        Const W_SUBNAME As String = "NSK0000HA DefaultSet"

        Dim w_Loop As Integer
        Dim w_intSelLine As Integer
        Dim w_intShowLine As Integer
        Dim w_ShowLineFLG As Boolean
        Dim w_RtnReg As String
        Dim w_FormCaption As String = String.Empty
        Try
            'ﾂｰﾙﾊﾞｰの設定
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ToolBar", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            tbrMain.Visible = fncGetBool(Integer.Parse(w_RtnReg))
            If Panel1.Visible Then
                Panel1.Visible = tbrMain.Visible
            End If
            m_lstmnuView(M_MenuToolBar).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            'ｽﾃｰﾀｽﾊﾞｰの設定
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "StatusBar", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            sbrMain.Visible = fncGetBool(Integer.Parse(w_RtnReg))
            m_lstmnuView(M_MenuStatusBar).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '勤務表示切替の設定
            w_intSelLine = 0
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PackageFLG <> 0 Then
                '勤務変更 又は (計画新規 or 計画変更で届出か日当直を使用してる) 画面の時
                w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "PlanTwo", Convert.ToString(3))
                If IsNumeric(w_RtnReg) = False Then
                    w_RtnReg = Convert.ToString(3)
                End If
                w_intShowLine = -1
                w_ShowLineFLG = False
                For w_Loop = 0 To 3
                    If m_lstmnuKinmuView(w_Loop).Available Then
                        If w_Loop = Integer.Parse(w_RtnReg) Then
                            m_lstmnuKinmuView(w_Loop).Checked = True
                            w_intSelLine = w_Loop
                            w_ShowLineFLG = True
                        Else
                            m_lstmnuKinmuView(w_Loop).Checked = False
                        End If
                        w_intShowLine = w_Loop
                    End If
                Next w_Loop
                If w_ShowLineFLG = False AndAlso w_intShowLine > -1 Then
                    m_lstmnuKinmuView(w_intShowLine).Checked = True
                End If
                Call RunOneTwoChange(False, Integer.Parse(w_RtnReg))
            End If

            '計画ﾃﾞｰﾀ表示形態の設定
            m_SelViewKikan = 0 '起動時は１ヶ月表示とする
            If cmbKikan.Items.Count > 0 Then
                cmbKikan.SelectedIndex = 0 '起動時は１ヶ月表示とする
            End If
            '集計の固定化
            m_TotalFrozen = True '起動時は集計固定とする
            'ﾁｰﾑ選択
            m_SelTeamNo = 0 '起動時は「すべて」表示とする
            If cmbTeam.Items.Count > 0 Then
                cmbTeam.SelectedIndex = 0 '起動時は「すべて」表示とする
            End If
            'ﾃﾞｰﾀ表示開始行、終了行を設定する
            m_ViewRow.StartRow = m_StaffRow.StartRow
            m_ViewRow.EndRow = m_StaffRow.EndRow
            'ﾌｫﾝﾄｻｲｽﾞ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "FontSize", Convert.ToString(M_MenuFontMiddle))
            If IsNumeric(w_RtnReg) = False Then
                m_FontIndex = M_MenuFontMiddle
            Else
                Select Case Integer.Parse(w_RtnReg)
                    Case M_MenuFontBig, M_MenuFontMiddle, M_MenuFontSmall
                        m_FontIndex = Integer.Parse(w_RtnReg)
                    Case Else
                        m_FontIndex = M_MenuFontMiddle
                End Select
            End If
            'ﾒﾆｭｰのﾁｪｯｸをする
            m_lstmnuFont(M_MenuFontBig).Checked = False
            m_lstmnuFont(M_MenuFontMiddle).Checked = False
            m_lstmnuFont(M_MenuFontSmall).Checked = False
            m_lstmnuFont(m_FontIndex).Checked = True

            'ｴﾗｰ自動ﾁｪｯｸ設定
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ErrChk", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(False))
            End If
            If g_LimitedFlg = False Then
                m_lstmnuTool(M_MenuJidouCheck).Checked = fncGetBool(Integer.Parse(w_RtnReg))
                If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                    m_lstmnuTool(M_MenuReCheck).Enabled = False
                    tbrMain.Items.Item(M_ToolBarKey_ErrorCheck).Visible = False
                Else
                    m_lstmnuTool(M_MenuReCheck).Enabled = True
                    If g_LimitedFlg = False Then
                        tbrMain.Items.Item(M_ToolBarKey_ErrorCheck).Visible = True
                    End If
                End If
            End If

            'ﾁｪｯｸ項目の保存
            '必要人数
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem0", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuNinzuu).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            ''経験区分の組み合わせチェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem1", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuGiryoCheck).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '勤務回数ﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem2", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuKinmuCount).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '勤務間隔ﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem3", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuKinmuInterval).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '休み回数ﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem4", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuHolCount).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '休み間隔ﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem5", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuHolInterval).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '禁止勤務ﾊﾟﾀｰﾝﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem6", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuKinmuPattern).Checked = fncGetBool(Integer.Parse(w_RtnReg))
            '禁止勤務ﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem7", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuKinsiKinmu).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '希望勤務の入力警告チェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "KibouChk", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuTool(M_MenuKibouChk).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '要請勤務の入力警告チェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "YouseiChk", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuTool(M_MenuYouseiChk).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '必須勤務の警告チェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmuChk", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuTool(M_MenuErrorAbsoluteKinmu).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '勤務連続チェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "RenzokuKinmuInterval", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuRenzokuKinmuInterval).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '必須勤務チェック
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmu", Convert.ToString(fncGetNum(False)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuAbsoluteKinmu).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '禁止職員ﾊﾟﾀｰﾝﾁｪｯｸ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem8", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuCheck(M_MenuStaffPattern).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '行事行表示フラグ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "DispEventRowFlg", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_GyoujiFlg = fncGetBool(Integer.Parse(w_RtnReg))

            '2014/07/03 Ishiga add start---
            If m_strVerPath = 1 Then
                m_GyoujiFlg = False
            End If
            '2014/07/03 Ishiga add end-----

            '採用条件列表示フラグ
            w_RtnReg = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "DispEmpColFlg", Convert.ToString(fncGetNum(True)))
            If IsNumeric(w_RtnReg) = False Then
                w_RtnReg = Convert.ToString(fncGetNum(True))
            End If
            m_lstmnuView(M_MenuEmpRowDisp).Checked = fncGetBool(Integer.Parse(w_RtnReg))

            '他の職員の勤務を変更できない権限の場合
            If g_LimitedFlg = True Then
                m_lstmnuFile(M_MenuKakutei).Available = False '確定終了非表示
                m_lstmnuFile(M_MenuPrint).Available = False '印刷
                m_lstmnuFile(M_MenuWrite).Available = False '書き込み
                m_lstmnuFile(M_MenuLoad).Available = False '読み込み
                m_lstmnuFile(M_MenuFile_Line2).Available = False '区切り線
                m_lstmnuFile(M_MenuFile_Line3).Available = False '区切り線
                m_lstmnuEdit(M_MenuAllClear).Enabled = False '全消去使用不可
                m_lstmnuEdit(M_MenuAllClear_Normal).Enabled = False '全消去使用不可 
                m_lstmnuEdit(M_MenuChikan).Enabled = False '置換
                m_lstmnuEdit(M_MenuCut).Enabled = False '切り取り
                m_lstmnuEdit(M_MenuCopy).Enabled = False 'コピー
                m_lstmnuEdit(M_MenuPaste).Enabled = False '貼り付け
                m_lstmnuEdit(M_MenuDelete).Enabled = False '消去
                m_lstmnuPopup(M_PopAllClear).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ全消去使用不可
                m_lstmnuPopup(M_PopAllClear_Normal).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ全消去(通常)使用不可
                m_lstmnuPopup(M_PopChikan).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ置換使用不可
                m_lstmnuPopup(M_PopCopy).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟコピー使用不可
                m_lstmnuPopup(M_PopPaste).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ貼り付け使用不可
                m_lstmnuPopup(M_PopDelete).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ消去使用不可
                m_lstmnuPopup(M_PopCut).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ切り取り使用不可
                m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ時間年休入力使用不可
                m_lstmnuMain(M_MenuJidou).Available = False '自動割当非表示
                m_lstmnuMain(M_MenuSet).Available = False '設定非表示
                m_lstmnuMain(M_MenuData).Available = False 'データ非表示
                m_lstmnuMain(M_MenuTool).Available = False 'ツール非表示
                m_blnPopCutFLG = False '切り取り
                m_blnPopCopyFLG = False 'コピー
                m_blnPopPasteFLG = False '貼り付け

                'ﾂｰﾙﾎﾞﾀﾝ
                tbrMain.Items.Item(M_ToolBarKey_KakuteiEnd).Visible = False '確定終了非表示
                tbrMain.Items.Item(M_ToolBarKey_AutoAssign).Visible = False '自動割当非表示
                tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False '置換非表示
                tbrMain.Items.Item(M_ToolBarKey_StaffEdit).Visible = False '職員情報
                If g_LimitedFlg = False Then
                    tbrMain.Items.Item(M_ToolBarKey_ErrorCheck).Visible = False 'エラーチェック
                End If
                tbrMain.Items.Item("Space2").Visible = False 'ｽﾍﾟｰｽ
                tbrMain.Items.Item("Space3").Visible = False 'ｽﾍﾟｰｽ
                tbrMain.Items.Item("Space5").Visible = False 'ｽﾍﾟｰｽ
            End If

            'ﾌｫｰﾑのCaption設定  (計画新規・変更の区別をﾌｫｰﾑｷｬﾌﾟｼｮﾝに表示）
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                w_FormCaption = "勤務変更メニュー"
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                w_FormCaption = "勤務計画作成メニュー（計画変更）"
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                w_FormCaption = "勤務計画作成メニュー（新規作成）"
            End If
            w_FormCaption = w_FormCaption & "　－　" & General.g_strSelKinmuDeptNm & "　－　"
            If m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '表示期間が１ヶ月の場合
                w_FormCaption = w_FormCaption & Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")), "yyyy")
                w_FormCaption = w_FormCaption & "年"
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", Month(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))))
                w_FormCaption = w_FormCaption & "月分"
            ElseIf m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week Then
                '表示期間が４週の場合
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", m_KeikakuKikan.TarmNo) & "Ｔ"
                w_FormCaption = w_FormCaption & "（"
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", Month(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))))
                w_FormCaption = w_FormCaption & "/"
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).Day)
                w_FormCaption = w_FormCaption & "～"
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", Month(Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))))
                w_FormCaption = w_FormCaption & "/"
                w_FormCaption = w_FormCaption & String.Format("{0, 2}", Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00")).Day)
                w_FormCaption = w_FormCaption & "）"
            End If
            Me.Text = w_FormCaption

            'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
            m_MaxMainWidth = m_CtrlSize(m_FontIndex).NormalModeMaxWidth
            m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(m_SelTeamNo, w_intSelLine + 1) + 2
            If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight
            m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).NormalModePersonalTotalWidth
            m_DayTotalHeight = m_CtrlSize(m_FontIndex).NormalModeDayTotalHeight

            'ﾌｫﾝﾄｻｲｽﾞを設定する
            Call ChangeFontSize(m_FontIndex)
            '2016/04/05 Ishiga add start------------------
            m_ProForm.pCountValue = 2
            System.Windows.Forms.Application.DoEvents()
            '2016/04/05 Ishiga add end--------------------
            'ｽﾌﾟﾚｯﾄﾞのｾﾙ設定
            Call Set_CellSize()

            '行ﾀｲﾄﾙ 固定列数 設定（１ヶ月用ﾃﾞｰﾀｽﾌﾟﾚｯﾄﾞ、４週用ﾃﾞｰﾀｽﾌﾟﾚｯﾄﾞ、固定個人別集計用ｽﾌﾟﾚｯﾄﾞ）
            sprSheet_M.Sheets(0).FrozenRowCount = M_FrozenRow
            sprSheet_4W.Sheets(0).FrozenRowCount = M_FrozenRow
            sprPTotal.Sheets(0).FrozenRowCount = M_FrozenRow
            '列ﾀｲﾄﾙ 固定列数 設定
            sprSheet_M.Sheets(0).FrozenColumnCount = M_FrozenCol
            sprSheet_4W.Sheets(0).FrozenColumnCount = M_FrozenCol
            sprDayTotal_M.Sheets(0).FrozenColumnCount = M_FrozenCol
            sprDayTotal_4W.Sheets(0).FrozenColumnCount = M_FrozenCol

            '1ヶ月用ｽﾌﾟﾚｯﾄﾞ表示
            sprSheet_M.Visible = True
            sprDayTotal_M.Visible = True
            sprPTotal.Visible = True
            '不必要ｽﾌﾟﾚｯﾄﾞ非表示
            sprSheet_4W.Visible = False
            sprDayTotal_4W.Visible = False

            'ｽﾌﾟﾚｯﾄﾞのｺﾝﾃﾅの背景色設定
            picBase.BackColor = Me.BackColor
            picHide.BackColor = Me.BackColor

            'ｺﾝﾃﾅｺﾝﾄﾛｰﾙ（Picture）の表示、非表示設定
            picBase.Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '各設定色を取得する
    Private Sub Get_Color()
        Const W_SUBNAME As String = "NSK0000HA Get_Color"
        Try
            'ﾚｼﾞｽﾄﾘ格納先
            Const w_RegStr As String = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1 & "\" & General.G_CURRENT_KEY

            '要請勤務 文字/背景色
            m_Yousei_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Yousei_Fore", Convert.ToString(General.G_BLACK)))
            m_Yousei_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Yousei_Back", Convert.ToString(General.G_PALEGREEN)))
            '希望勤務 文字/背景色
            m_Kibou_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Kibou_Fore", Convert.ToString(General.G_BLACK)))
            m_Kibou_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Kibou_Back", Convert.ToString(General.G_PLUM)))
            '2015/07/21 Bando Add Start ===============================
            '希望勤務　コメント有　文字/背景色
            m_KibouCom_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "HopeCom_Fore", Convert.ToString(General.G_BLACK)))
            m_KibouCom_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "HopeCom_Back", ColorTranslator.ToOle(Color.IndianRed)))
            '2015/07/21 Bando Add End   ===============================
            '再掲勤務 文字/背景色
            m_Saikei_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Saikei_Fore", Convert.ToString(General.G_BLACK)))
            m_Saikei_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Saikei_Back", Convert.ToString(General.G_LIGHTCYAN)))
            '委員会勤務 文字/背景色
            m_Iin_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Iin_Fore", Convert.ToString(General.G_BLACK)))
            m_Iin_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Iin_Back", Convert.ToString(General.G_LIGHTBLUE)))
            '応援勤務 文字/背景色
            m_Ouen_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Ouen_Fore", Convert.ToString(General.G_BLACK)))
            m_Ouen_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Ouen_Back", Convert.ToString(General.G_ORANGE)))
            '代休発生勤務 文字/背景色
            m_Daikyu_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Daikyu_Fore", Convert.ToString(General.G_BLACK)))
            m_Daikyu_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Daikyu_Back", Convert.ToString(General.G_LIGHTYELLOW)))
            '届出勤務 文字/背景色
            m_Appli_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Appli_Fore", Convert.ToString(General.G_CORAL)))
            m_Appli_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Appli_Back", Convert.ToString(General.G_MEDIUMBLUE)))
            '計画期間外の4週部分 背景色
            m_Jisseki4W_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Jisseki4W_Back", ColorTranslator.ToOle(Color.Cyan).ToString))
            '他部署確定データ 文字色
            m_Tabusho_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Tabusho_Fore", Convert.ToString(3014445)))
            '土日祝 背景色
            m_WeekEnd_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "WeekEnd_Back", ColorTranslator.ToOle(Color.LavenderBlush)))

            '時間入力勤務 背景色
            m_KinmuTime_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "TimeInput_Back", Convert.ToString(16627152)))
            '2015/07/22 Bando Add Start ==========================
            '控除 背景色
            m_Kojo_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Kojo_Back", ColorTranslator.ToOle(Color.GreenYellow)))
            '2015/07/22 Bando Add End   ==========================
            '実績が予定と異なる場合 文字/背景色
            m_Comp_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Comp_Fore", Convert.ToString(ColorTranslator.ToOle(Color.Red))))

            '割当非対象者 文字/背景色
            m_NoAssign_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "NoAssign_Fore", Convert.ToString(General.G_BLACK)))
            m_NoAssign_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "NoAssign_Back", Convert.ToString(General.G_WHITE)))
            'ﾘｰﾀﾞｰ 文字/背景色
            m_Leader_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Leader_Fore", Convert.ToString(General.G_BLACK)))
            m_Leader_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Leader_Back", Convert.ToString(General.G_LIGHTCYAN)))
            'ｻﾌﾞﾘｰﾀﾞｰ 文字/背景色
            m_SubLeader_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "SubLeader_Fore", Convert.ToString(General.G_BLACK)))
            m_SubLeader_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "SubLeader_Back", Convert.ToString(General.G_LIGHTGREEN)))
            'ｽﾀｯﾌ 文字/背景色
            m_Staff_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Staff_Fore", Convert.ToString(General.G_BLACK)))
            m_Staff_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Staff_Back", Convert.ToString(General.G_KHAKI)))
            '新人 文字/背景色
            m_NewFace_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "NewFace_Fore", Convert.ToString(General.G_BLACK)))
            m_NewFace_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "NewFace_Back", Convert.ToString(General.G_LIGHTPINK)))

            'ｴﾗｰ 職員名 文字/背景色
            m_Error_Name_ForeColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Name_Fore", Convert.ToString(General.G_VIOLET)))
            m_Error_Name_BackColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Name_Back", Convert.ToString(General.G_RED)))
            'ｴﾗｰ 集計列 文字/背景色
            m_Error_Col_ForeColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Col_Fore", Convert.ToString(General.G_BLACK)))
            m_Error_Col_BackColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Col_Back", Convert.ToString(General.G_VIOLET)))
            'ｴﾗｰ 集計列 文字/背景色
            m_Error_Col_ForeColor2 = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Col_Fore2", Convert.ToString(General.G_BLACK)))
            m_Error_Col_BackColor2 = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Col_Back2", Convert.ToString(General.G_LIMEGREEN)))
            'ｴﾗｰ 集計行 文字/背景色
            m_Error_Row_ForeColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Row_Fore", Convert.ToString(General.G_PINK)))
            m_Error_Row_BackColor = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Error_Row_Back", Convert.ToString(General.G_RED)))
            '前月 文字/背景色
            m_MonthBefore_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "MonthBefore_Fore", General.G_BLACK))
            m_MonthBefore_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "MonthBefore_Back", General.G_LIGHTGRAY))

            'ﾎﾟｲﾝﾀ位置表示　背景色
            m_Pointer_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Pointer_Back", Convert.ToString(7190198)))

            '応援勤務者の氏名欄 文字/背景色
            m_Ouen_Name_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "OuenName_Fore", Convert.ToString(General.G_BLACK)))
            m_Ouen_Name_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "OuenName_Back", Convert.ToString(General.G_LIGHTSALMON)))

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '*******************************
    '   ﾌｫﾝﾄｻｲｽﾞを変更する
    '*******************************
    Private Sub ChangeFontSize(ByVal pFontIndex As Integer)

        Const W_SUBNAME As String = "NSK0000HA ChangeFontSize"

        Dim w_FontSize As Integer
        Dim w_Index As Integer
        Dim w_ColLoop As Integer
        Dim w_RowLoop As Integer
        Const W_Adjust_Big As Double = -5
        Const W_Adjust_Middle As Double = -2
        Const W_Adjust_Small As Double = 1
        '2014/04/23 Saijo add start P-06979----------
        '全角２文字対応用
        Const W_Adjust_Second_Big As Double = 5
        Const W_Adjust_Second_Middle As Double = 4
        Const W_Adjust_Second_Small As Double = 7
        Dim w_Big As Double
        Dim w_Middle As Double
        Dim w_Small As Double
        Dim w_FontSize2 As Integer
        '2014/04/23 Saijo add end P-06979------------
        Dim w_Adjust_Width As Double
        Try
            '2014/04/23 Saijo upd start P-06979-------------
            'Select Case pFontIndex
            '    Case M_MenuFontBig
            '        w_FontSize = M_FontSize_Big
            '        w_Adjust_Width = W_Adjust_Big
            '    Case M_MenuFontMiddle
            '        w_FontSize = M_FontSize_Middle
            '        w_Adjust_Width = W_Adjust_Middle
            '    Case M_MenuFontSmall
            '        w_FontSize = M_FontSize_Small
            '        w_Adjust_Width = W_Adjust_Small
            'End Select

            '勤務記号全角２文字対応フラグ判定
            If m_strKinmuEmSecondFlg = "0" Then
                '0：対応しない(従来の正方形の幅)
                w_Big = W_Adjust_Big
                w_Middle = W_Adjust_Middle
                w_Small = W_Adjust_Small
            Else
                '1：対応する(全角２文字が表示できる幅)
                w_Big = W_Adjust_Second_Big
                w_Middle = W_Adjust_Second_Middle
                w_Small = W_Adjust_Second_Small
            End If

            Select Case pFontIndex
                Case M_MenuFontBig
                    w_FontSize = M_FontSize_Big
                    w_Adjust_Width = w_Big
                    w_FontSize2 = M_FontSize_Second_Big
                Case M_MenuFontMiddle
                    w_FontSize = M_FontSize_Middle
                    w_Adjust_Width = w_Middle
                    w_FontSize2 = M_FontSize_Second_Middle
                Case M_MenuFontSmall
                    w_FontSize = M_FontSize_Small
                    w_Adjust_Width = w_Small
                    w_FontSize2 = M_FontSize_Second_Small
            End Select
            '2014/04/23 Saijo upd end P-06979---------------

            'ﾌｫﾝﾄに合わせたセルの大きさを取得する
            m_CellHeight = TextRenderer.MeasureText("Ｗ", New Font("ＭＳ ゴシック", w_FontSize)).Height + 3
            m_CellWidth = TextRenderer.MeasureText("Ｗ", New Font("ＭＳ ゴシック", w_FontSize)).Width + w_Adjust_Width

            If m_PersonalTotalSet = 0 Then
                m_TotalWidth = m_CellWidth '小数点対応（現時点では通常の幅としておく）
                m_TotalWidth_Yakan = m_TotalWidth * 2.5
                m_TotalWidth_Kotei = m_TotalWidth * 3.2
            Else
                m_TotalWidth = m_CellWidth * 2 '小数点対応（現時点では通常の幅としておく）  ★★
                m_TotalWidth_Kotei = m_TotalWidth * 1.5
                m_TotalWidth_Yakan = m_CellWidth * 2.5
            End If


            'ﾌｫﾝﾄｻｲｽﾞ変更（１ヶ月用ﾃﾞｰﾀｽﾌﾟﾚｯﾄﾞ）
            '2014/04/23 Saijo upd start P-06979----------------------------------
            'sprSheet_M.Font = New Font("ＭＳ ゴシック", w_FontSize)
            If m_strKinmuEmSecondFlg = "0" Then
                sprSheet_M.Font = New Font("ＭＳ ゴシック", w_FontSize)
            Else
                sprSheet_M.Font = New Font("ＭＳ ゴシック", w_FontSize2)
            End If
            '2014/04/23 Saijo upd end P-06979------------------------------------
            'ｾﾙの大きさを一旦0にする
            '2016/04/05 Ishiga upd start----------------------------------------------------------------------
            'For w_RowLoop = 0 To sprSheet_M.Sheets(0).RowCount
            '    sprSheet_M.Sheets(0).SetRowHeight(w_RowLoop, m_CellHeight)
            'Next
            'For w_ColLoop = 0 To sprSheet_M.Sheets(0).ColumnCount
            '    sprSheet_M.Sheets(0).SetColumnWidth(w_ColLoop, m_CellWidth)
            'Next
            sprSheet_M.Sheets(0).SetMultipleRowHeights(0, m_StaffRow.EndRow + 1, m_CellHeight)
            sprSheet_M.Sheets(0).SetMultipleColumnWidths(0, sprSheet_M.Sheets(0).ColumnCount, m_CellWidth)
            '2016/04/05 Ishiga upd end------------------------------------------------------------------------

            'ﾌｫﾝﾄｻｲｽﾞ変更（４週用ﾃﾞｰﾀｽﾌﾟﾚｯﾄﾞ）
            '2014/04/23 Saijo upd start P-06979----------------------------------
            'sprSheet_4W.Font = New Font("ＭＳ ゴシック", w_FontSize)
            If m_strKinmuEmSecondFlg = "0" Then
                sprSheet_4W.Font = New Font("ＭＳ ゴシック", w_FontSize)
            Else
                sprSheet_4W.Font = New Font("ＭＳ ゴシック", w_FontSize2)
            End If
            '2014/04/23 Saijo upd end P-06979------------------------------------
            'ｾﾙの大きさを一旦0にする
            '2016/04/05 Ishiga upd start----------------------------------------------------------------------
            'For w_RowLoop = 0 To sprSheet_4W.Sheets(0).RowCount
            '    sprSheet_4W.Sheets(0).SetRowHeight(w_RowLoop, m_CellHeight)
            'Next
            'For w_ColLoop = 0 To sprSheet_4W.Sheets(0).ColumnCount
            '    sprSheet_4W.Sheets(0).SetColumnWidth(w_ColLoop, m_CellWidth)
            'Next
            sprSheet_4W.Sheets(0).SetMultipleRowHeights(0, m_StaffRow.EndRow + 1, m_CellHeight)
            sprSheet_4W.Sheets(0).SetMultipleColumnWidths(0, sprSheet_4W.Sheets(0).ColumnCount, m_CellWidth)
            '2016/04/05 Ishiga upd end------------------------------------------------------------------------

            '2014/07/11 Shimizu add start P-06980----
            '行事予定用ﾌｫﾝﾄｻｲｽﾞ変更
            sprSheet_M.Sheets(0).Rows(M_EVENTLABEL_ROW).Font = New Font("ＭＳ ゴシック", w_FontSize)
            sprSheet_4W.Sheets(0).Rows(M_EVENTLABEL_ROW).Font = New Font("ＭＳ ゴシック", w_FontSize)
            ''2014/07/11 Shimizu add end P-06980----

            'ﾌｫﾝﾄｻｲｽﾞ変更（固定個人別集計用ｽﾌﾟﾚｯﾄﾞ）
            If m_PersonalTotalSet = 0 Then
                sprPTotal.Font = New Font("ＭＳ ゴシック", w_FontSize)
            Else
                If w_FontSize = M_FontSize_Middle OrElse w_FontSize = M_FontSize_Big Then
                    sprPTotal.Font = New Font("ＭＳ ゴシック", w_FontSize - 2)
                Else
                    sprPTotal.Font = New Font("ＭＳ ゴシック", w_FontSize)
                End If
            End If
            'ｾﾙの大きさを一旦0にする
            '2016/04/05 Ishiga upd start----------------------------------------------------------------------
            'For w_RowLoop = 0 To sprPTotal.Sheets(0).RowCount
            '    sprPTotal.Sheets(0).SetRowHeight(w_RowLoop, m_CellHeight)
            'Next
            'For w_ColLoop = 0 To sprPTotal.Sheets(0).ColumnCount
            '    sprPTotal.Sheets(0).SetColumnWidth(w_ColLoop, m_CellWidth)
            'Next
            sprPTotal.Sheets(0).SetMultipleRowHeights(0, sprPTotal.Sheets(0).RowCount, m_CellHeight)
            sprPTotal.Sheets(0).SetMultipleColumnWidths(0, sprPTotal.Sheets(0).ColumnCount, m_CellWidth)
            '2016/04/05 Ishiga upd end------------------------------------------------------------------------

            'ﾌｫﾝﾄｻｲｽﾞ変更（固定日別集計１ヶ月用ｽﾌﾟﾚｯﾄﾞ）
            sprDayTotal_M.Font = New Font("ＭＳ ゴシック", w_FontSize)
            'ｾﾙの大きさを一旦0にする
            '2016/04/05 Ishiga upd start----------------------------------------------------------------------
            'For w_RowLoop = 0 To sprDayTotal_M.Sheets(0).RowCount
            '    sprDayTotal_M.Sheets(0).SetRowHeight(w_RowLoop, m_CellHeight)
            'Next
            'For w_ColLoop = 0 To sprDayTotal_M.Sheets(0).ColumnCount
            '    sprDayTotal_M.Sheets(0).SetColumnWidth(w_ColLoop, m_CellWidth)
            'Next
            sprDayTotal_M.Sheets(0).SetMultipleRowHeights(0, sprDayTotal_M.Sheets(0).RowCount, m_CellHeight)
            sprDayTotal_M.Sheets(0).SetMultipleColumnWidths(0, sprDayTotal_M.Sheets(0).ColumnCount, m_CellWidth)
            '2016/04/05 Ishiga upd end------------------------------------------------------------------------

            'ﾌｫﾝﾄｻｲｽﾞ変更（固定日別集計４週用ｽﾌﾟﾚｯﾄﾞ）
            sprDayTotal_4W.Font = New Font("ＭＳ ゴシック", w_FontSize)
            'ｾﾙの大きさを一旦0にする
            '2016/04/05 Ishiga upd start----------------------------------------------------------------------
            'For w_RowLoop = 0 To sprDayTotal_4W.Sheets(0).RowCount
            '    sprDayTotal_4W.Sheets(0).SetRowHeight(w_RowLoop, m_CellHeight)
            'Next
            'For w_ColLoop = 0 To sprDayTotal_4W.Sheets(0).ColumnCount
            '    sprDayTotal_4W.Sheets(0).SetColumnWidth(w_ColLoop, m_CellWidth)
            'Next
            sprDayTotal_4W.Sheets(0).SetMultipleRowHeights(0, sprDayTotal_4W.Sheets(0).RowCount, m_CellHeight)
            sprDayTotal_4W.Sheets(0).SetMultipleColumnWidths(0, sprDayTotal_4W.Sheets(0).ColumnCount, m_CellWidth)
            '2016/04/05 Ishiga upd end------------------------------------------------------------------------

            If cmbKikan.SelectedIndex = -1 Then
            Else
                w_Index = cmbKikan.SelectedIndex
                Call Set_StaffData(w_Index)
            End If

            '行事予定行は最大値数文字分
            m_gyoujiHeight = m_CellHeight * M_GYOJIMAXLETTER

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '次画面呼び出し処理
    Private Sub Execute_NextPgm()

        Const W_SUBNAME As String = "NSK0000HA Execute_NextPgm"

        Dim w_ExePath As String
        Dim w_ExeName As String
        Try
            '**** 初期画面呼び出し ****
            '初期ﾒﾆｭｰ起動ﾌﾗｸﾞ 設定(ﾊﾟｽﾜｰﾄﾞ入力画面なし)
            Call General.paSaveSetting(General.G_SYSTEM_WIN7, General.G_STRMAINKEY1, "PSWDISPFLG", "1")

            'ﾃﾞｰﾀﾍﾞｰｽ 接続解除
            Call General.paDisConnect()

            'EXE.PATH 取得
            w_ExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

            'ExeNameをｺﾏﾝﾄﾞﾗｲﾝから取得する
            w_ExeName = m_strAccessModule & ".exe"

            '次画面呼び出し（初期画面）
            Call Shell(w_ExePath & w_ExeName, AppWinStyle.NormalFocus)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '対象職員 取得/設定
    Private Function Get_StaffData(ByVal pPrcessForm As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Get_StaffData"

        Dim w_From As Integer
        Dim w_To As Integer
        Dim w_ChofukuFlg As Boolean
        Dim w_Index As Integer
        Dim w_Index2 As Integer
        Dim w_RecCnt As Integer
        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_MaxTeamCnt As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_EndTo As Integer
        Dim w_Col As Integer
        Dim w_From_Col() As Integer
        Dim w_To_Col() As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_Date As Date
        Dim w_Date2 As Date
        Dim w_StartCol As Integer
        Dim w_ShukeiFlg As Boolean
        Dim w_DefGiryoLvCD As String '対象職員情報　技量ﾚﾍﾞﾙCDﾃﾞﾌｫﾙﾄ値
        Dim w_DefGiryoNo As Integer '対象職員情報　ﾃﾞﾌｫﾙﾄ技量ﾚﾍﾞﾙの表示№
        Dim w_DefGiryoKbn As String = String.Empty '対象職員情報　ﾃﾞﾌｫﾙﾄ技量ﾚﾍﾞﾙの分類ｺｰﾄﾞ
        Dim w_DefTeam As Integer '対象職員情報　ﾁｰﾑﾃﾞﾌｫﾙﾄ値
        Dim w_DefAutoKBN As String '対象職員情報　自動割当区分ﾃﾞﾌｫﾙﾄ値
        Dim w_MsgRc As Integer
        Dim w_Bool As Boolean
        Dim w_SysDate As Double '更新日時
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset = Nothing
        Dim w_StaffMngID_F As ADODB.Field
        Dim w_StaffName_F As ADODB.Field
        Dim w_DateF_F As ADODB.Field
        Dim w_StaffID As String
        Dim w_PreStaffID As String
        Dim w_lngDate As Integer
        Dim w_OuenIdx As Integer
        Dim w_OuenCnt As Integer
        Dim w_OuenStaffID As String
        Dim w_PreOuenStaffID As String = String.Empty
        Dim w_strStaffID As String '職員検索用文字列
        Dim w_str As String
        Dim w_PreStr As String = String.Empty
        Dim w_Pos As Integer
        Dim w_MaxHyojiNo As Integer
        Dim w_TargetTable As String
        Dim w_IdoIdx As Integer
        Dim w_SyokuinRekiCnt As Integer
        Dim w_strSubKey As String
        Dim w_strWorkValue As String
        Dim w_varWork As Object
        Dim w_strMsg() As String
        Dim w_LastMonthDays As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color

        Try
            ReDim m_TimeM(0)

            m_LastMonthDays = 999

            '更新日時 取得
            w_SysDate = Double.Parse(General.paGetDateString(Now, True))

            '処理経過ﾌｫｰﾑ設定
            pPrcessForm.pForeColor = ColorTranslator.ToOle(Color.Lime)
            pPrcessForm.pSyoriText = "職員情報を取得中..."

            'ﾃﾞﾌｫﾙﾄ技量ﾚﾍﾞﾙCDをﾚｼﾞｽﾄﾘから取得
            w_DefGiryoLvCD = Trim(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY6, "DEFGIRYOLVCD", "", General.g_strHospitalCD))
            If w_DefGiryoLvCD <> "" Then '（ﾃﾞﾌｫﾙﾄ技量情報(表示№、分類)取得）
                Call Get_DefGiryoInf(w_DefGiryoLvCD, w_DefGiryoNo, w_DefGiryoKbn)
            End If
            'ﾃﾞﾌｫﾙﾄﾁｰﾑ
            w_DefTeam = 1
            'ﾃﾞﾌｫﾙﾄ自動割当区分をﾚｼﾞｽﾄﾘから取得
            w_DefAutoKBN = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY6, "DEFAUTOKBN", "2", General.g_strHospitalCD)
            If w_DefAutoKBN <> "1" AndAlso w_DefAutoKBN <> "2" Then
                w_DefAutoKBN = "2"
            End If

            'Iniから常勤対象採用CD,採用CD別週労働時間,常勤者週労働時間
            If g_AppName = "NSK0001H" Then
                w_strSubKey = General.G_STRSUBKEY9
            Else
                w_strSubKey = General.G_STRSUBKEY8
            End If
            m_JokinSaiyoCD = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "JOKINSAIYOCD", "", General.g_strHospitalCD)
            '2013/07/10 Bando Add Start ==============================================================
            w_varWork = General.paSplit(m_JokinSaiyoCD, ",")
            '一度初期化した後に"@@@"にフォーマットされたデータを再度格納
            m_JokinSaiyoCD = ""
            For w_Int = 0 To UBound(w_varWork)
                m_JokinSaiyoCD = m_JokinSaiyoCD & General.paFormatSpace(w_varWork(w_Int), 5) & ","
            Next w_Int
            '2013/07/10 Bando Add End   ==============================================================
            m_JokinTime = Single.Parse(General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "JOKINTIME", Convert.ToString(40), General.g_strHospitalCD))

            'ファイル出力、読込使用フラグ
            m_UseOutputFlg = False
            Dim str As String = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SAVEPATH", "", General.g_strHospitalCD)
            If Not String.IsNullOrEmpty(str) Then m_UseOutputFlg = True

            '採用CD(非常勤)ごとの週労働時間
            '初期化
            ReDim m_SaiyoTypeTime(0)
            w_strWorkValue = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "SAIYOTIME", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_strWorkValue, ",")

            If w_strWorkValue <> "" Then
                For w_Int = 0 To UBound(w_varWork)
                    w_str = w_varWork(w_Int)

                    w_Int2 = UBound(m_SaiyoTypeTime) + 1
                    ReDim Preserve m_SaiyoTypeTime(w_Int2)

                    w_Pos = InStr(w_str, "~")
                    m_SaiyoTypeTime(w_Int2).CD = Mid(w_str, 1, w_Pos - 1)
                    m_SaiyoTypeTime(w_Int2).Time = Mid(w_str, w_Pos + 1)
                Next w_Int
            End If

            '--------------------------------------------------
            'PlanPeriodTo/列番号 設定
            '--------------------------------------------------
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                '計画期間終了日を終了日とする
                w_EndTo = m_KeikakuKikan.EndDate
            ElseIf (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                '4週/1ｹ月の場合
                '最後の４週期間終了日を終了日とする
                w_EndTo = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                w_From = m_KeikakuKikan.StartDate
                w_To = m_KeikakuKikan.EndDate
            Else
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '計画期間を含む４週期間の開始日
                    w_From = m_4WeekKikan(1).StartDate
                    '計画期間を含む４週期間の終了日
                    w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                Else
                    '計画期間を含む４週期間の開始日
                    w_From = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_4WeekKikan(1).EndDate, "0000/00/00"))), "yyyyMMdd"))
                    '計画期間を含む４週期間の終了日
                    w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                End If
            End If

            '代休の有効期間を求める(ﾃﾞﾌｫﾙﾄは８週間)
            m_lngDaikyuPastPeriod = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "PASTDAIKYUPERIOD", "56", General.g_strHospitalCD))
            '代休取得期間に制限をかける？-----
            If m_lngDaikyuPastPeriod = -1 Then '制限なし
                If m_DaikyuAdvFlg = 0 Then ''先取りなし

                    '代休データ取得期間(計画期間の開始日から有効期間数過去の日付)
                    m_lngDaikyuStartDate = 0
                    '代休データ取得期間
                    m_lngDaikyuEndDate = w_To

                    '代休集計基準が月初か月末か？
                    If m_DaikyuSumBasiDate <> 1 Then
                        '月初
                        m_lngDaikyuStartDate_Cnt = 0
                    Else
                        '月末
                        m_lngDaikyuStartDate_Cnt = 0
                    End If
                    m_lngDaikyuEndDate_Cnt = m_KeikakuKikan.EndDate
                Else ''先取りあり
                    '代休データ取得期間(計画期間の開始日から有効期間数過去の日付)
                    m_lngDaikyuStartDate = 0
                    '代休データ取得期間
                    If m_DaikyuAdvThisMonthFlg = 0 Then
                        m_lngDaikyuEndDate = 99999999
                    Else
                        m_lngDaikyuEndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, DateAdd(DateInterval.Month, 1, Date.Parse(Format(General.paLeft(Convert.ToString(w_To), 6) & "01", "0000/00/00")))), "yyyyMMdd"))
                    End If

                    '代休集計基準が月初か月末か？
                    If m_DaikyuSumBasiDate <> 1 Then
                        '月初
                        m_lngDaikyuStartDate_Cnt = 0
                    Else
                        '月末
                        m_lngDaikyuStartDate_Cnt = 0
                    End If
                    m_lngDaikyuEndDate_Cnt = m_lngDaikyuEndDate
                End If
            Else '制限あり
                If m_DaikyuAdvFlg = 0 Then ''先取りなし

                    '代休データ取得期間(計画期間の開始日から有効期間数過去の日付)
                    m_lngDaikyuStartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))
                    '代休データ取得期間
                    m_lngDaikyuEndDate = w_To

                    '代休集計基準が月初か月末か？
                    If m_DaikyuSumBasiDate <> 1 Then
                        '月初
                        m_lngDaikyuStartDate_Cnt = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))
                    Else
                        '月末
                        m_lngDaikyuStartDate_Cnt = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                    End If
                    m_lngDaikyuEndDate_Cnt = m_KeikakuKikan.EndDate
                Else ''先取りあり
                    '代休データ取得期間(計画期間の開始日から有効期間数過去の日付)
                    m_lngDaikyuStartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))

                    '代休データ取得期間
                    If m_DaikyuAdvThisMonthFlg = 0 Then
                        m_lngDaikyuEndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * 1, Date.Parse(Format(w_To, "0000/00/00"))), "yyyyMMdd"))
                    Else
                        m_lngDaikyuEndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, DateAdd(DateInterval.Month, 1, Date.Parse(Format(Integer.Parse(General.paLeft(Convert.ToString(w_To), 6) & "01"), "0000/00/00")))), "yyyyMMdd"))
                    End If

                    '代休集計基準が月初か月末か？
                    If m_DaikyuSumBasiDate <> 1 Then
                        '月初
                        m_lngDaikyuStartDate_Cnt = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))
                    Else
                        '月末
                        m_lngDaikyuStartDate_Cnt = Integer.Parse(Format(DateAdd(DateInterval.Day, m_lngDaikyuPastPeriod * -1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                    End If
                    m_lngDaikyuEndDate_Cnt = m_lngDaikyuEndDate
                End If
            End If

            '累計時間取得対象の計画番号を取得
            Call Get_TargetNo()

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .pソート順 = 0
                .pチーム区分 = 0
                .pシステム区分 = 0
                .p日付区分 = 1 '日付区分
                '.p開始年月日 = w_From '開始年月日
                .p開始年月日 = m_Calendar.StartDate '開始年月日 '2015/04/09 Yamanishi Add Upd
                .p終了年月日 = w_To '終了年月日
                .p勤務対象FLG = 1 '勤務対象FLG
                .p職員取得FLG = 0 '職員対象フラグ
                If g_SaikeiFlg = True Then
                    .p優先順位 = 9 '再掲部署CDを指定
                Else
                    .p優先順位 = 0 '勤務部署CDを指定
                End If
                .p対象CD = General.g_strSelKinmuDeptCD '勤務部署CD

                'ﾃﾞｰﾀ取得実行
                If .mGetStaff = False Then
                    'ﾃﾞｰﾀがないとき
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "職員情報"
                    Call Set_MsgZOrder("NS0031", w_strMsg, w_MsgRc, 0)
                    Exit Function
                Else
                    '初期化
                    ReDim m_StaffData(0)
                    ReDim m_StaffData(0).IdoData(0)
                    ReDim m_StaffData(0).KinmuCondition(0)
                    ReDim m_StaffData(0).KinmuData(0)
                    ReDim m_StaffData(0).BeforeKinmuData(0) '追加仕様：応援者・月中異動者の総夜勤を全部出す
                    ReDim m_StaffData(0).NenkyuData(0)
                    ReDim m_StaffData(0).NenkyuData(0).Detail(0)
                    ReDim m_StaffData(0).Daikyu(0)
                    ReDim m_StaffData(0).Kojyo(0)

                    w_StaffID = ""
                    w_PreStaffID = ""
                    w_strStaffID = ""

                    'ﾃﾞｰﾀ件数取得
                    w_RecCnt = .f職員件数

                    '処理経過画面設定
                    pPrcessForm.pMaxValue = w_RecCnt

                    'ﾃﾞｰﾀ件数分ﾙｰﾌﾟ
                    For w_Int = 1 To w_RecCnt

                        w_ChofukuFlg = False

                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .p職員索引 = w_Int

                        w_StaffID = .f職員管理番号2

                        '新しい職員か？
                        For w_Int2 = 1 To UBound(m_StaffData)
                            If m_StaffData(w_Int2).ID = w_StaffID Then
                                w_ChofukuFlg = True

                                '異動情報配列拡張
                                w_Index2 = UBound(m_StaffData(w_Int2).IdoData) + 1
                                ReDim Preserve m_StaffData(w_Int2).IdoData(w_Index2)

                                '-----------------
                                '異動情報
                                '-----------------
                                w_lngDate = .f異動年月日

                                If w_lngDate < w_From Then
                                    m_StaffData(w_Int2).IdoData(w_Index2).IdoYMD = w_From
                                Else
                                    m_StaffData(w_Int2).IdoData(w_Index2).IdoYMD = w_lngDate
                                End If
                                If w_lngDate < m_Calendar.StartDate Then
                                    m_StaffData(w_Int2).IdoData(w_Index2).IdoYMD2 = m_Calendar.StartDate
                                Else
                                    m_StaffData(w_Int2).IdoData(w_Index2).IdoYMD2 = w_lngDate
                                End If

                                m_StaffData(w_Index).blnEndDayChangeFlg = False

                                w_lngDate = .f終了年月日
                                If w_lngDate = 0 Then
                                    m_StaffData(w_Int2).IdoData(w_Index2).SyuryoYMD = w_EndTo
                                    m_StaffData(w_Index).blnEndDayChangeFlg = True
                                ElseIf w_lngDate > w_EndTo Then
                                    m_StaffData(w_Int2).IdoData(w_Index2).SyuryoYMD = w_EndTo
                                    m_StaffData(w_Index).blnEndDayChangeFlg = True
                                Else
                                    m_StaffData(w_Int2).IdoData(w_Index2).SyuryoYMD = w_lngDate
                                End If
                                '最新の転退年月日を取得
                                m_StaffData(w_Index).TentaiYMD = .f転退年月日2
                            End If
                        Next w_Int2

                        If w_ChofukuFlg = False Then
                            '配列拡張
                            w_Index = UBound(m_StaffData) + 1
                            ReDim Preserve m_StaffData(w_Index)
                            ReDim m_StaffData(w_Index).IdoData(1)
                            ReDim m_StaffData(w_Index).KinmuCondition(0)
                            ReDim m_StaffData(w_Index).KinmuData(0)
                            'ReDim m_StaffData(w_Index).BeforeKinmuData(0) '追加仕様：応援者・月中異動者の総夜勤を全部出す '2016/06/15 Yamanishi Del
                            ReDim m_StaffData(w_Index).NenkyuData(0)
                            ReDim m_StaffData(w_Index).NenkyuData(0).Detail(0)
                            ReDim Preserve m_StaffData(w_Index).Daikyu(0)
                            ReDim m_StaffData(w_Index).Kojyo(0)
                            ReDim m_StaffData(w_Index).SumCntData.SumSeq(UBound(m_HMtrx))
                            ReDim m_StaffData(w_Index).SumCntData_4W(UBound(m_4WeekKikan))
                            ReDim m_StaffData(w_Index).ResultCnt(0)
                            For i As Integer = 1 To UBound(m_4WeekKikan)
                                ReDim m_StaffData(w_Index).SumCntData_4W(i).SumSeq(UBound(m_HMtrx_4Week))
                            Next

                            m_StaffData(w_Index).ID = .f職員管理番号2
                            m_StaffData(w_Index).PreID = .f職員番号2
                            m_StaffData(w_Index).StaffName = .f氏名2
                            m_StaffData(w_Index).SaiyoYMD = .f採用年月日2
                            m_StaffData(w_Index).TentaiYMD = .f転退年月日2

                            m_StaffData(w_Index).OuenStaffFlg = 0

                            w_lngDate = General.g_objGetData.f異動年月日
                            If w_lngDate < w_From Then
                                m_StaffData(w_Index).IdoData(1).IdoYMD = w_From
                            Else
                                m_StaffData(w_Index).IdoData(1).IdoYMD = w_lngDate
                            End If
                            If w_lngDate < m_Calendar.StartDate Then
                                m_StaffData(w_Index).IdoData(1).IdoYMD2 = m_Calendar.StartDate
                            Else
                                m_StaffData(w_Index).IdoData(1).IdoYMD2 = w_lngDate
                            End If

                            'OrderInterFace用 配属日取得
                            m_StaffData(w_Index).HaizokuIF = w_lngDate

                            m_StaffData(w_Index).blnEndDayChangeFlg = False

                            w_lngDate = General.g_objGetData.f終了年月日

                            If w_lngDate > .f転退年月日2 AndAlso .f転退年月日2 < w_EndTo Then
                                m_StaffData(w_Index).IdoData(1).SyuryoYMD = .f転退年月日2
                            ElseIf w_lngDate = 0 Then
                                m_StaffData(w_Index).IdoData(1).SyuryoYMD = w_EndTo
                                m_StaffData(w_Index).blnEndDayChangeFlg = True
                            ElseIf w_lngDate > w_EndTo Then
                                m_StaffData(w_Index).IdoData(1).SyuryoYMD = w_EndTo
                                m_StaffData(w_Index).blnEndDayChangeFlg = True
                            Else
                                m_StaffData(w_Index).IdoData(1).SyuryoYMD = w_lngDate
                            End If

                            'OrderInterFace用 転出日取得
                            m_StaffData(w_Index).TensyutuIF = w_lngDate
                            If m_StaffData(w_Index).TensyutuIF = 0 Then
                                m_StaffData(w_Index).TensyutuIF = 99999999
                            End If

                            '計画期間内在職職員フラグ初期化
                            m_StaffData(w_Index).TargetKikanFlg = False

                            '代休情報取得
                            If General.g_lngDaikyuMng = 0 Then
                                Call Get_Daikyu(w_Index)
                            End If

                            '採用履歴情報取得
                            Call Get_SaiyoData(w_Index, w_From, w_To)

                            '累計時間取得(該当計画番号の２つ前まで)
                            Call Get_RuikeiTime(w_Index)
                        End If

                        '処理経過ｶｳﾝﾄ
                        pPrcessForm.pCountValue = w_Int

                        '退避
                        w_PreStaffID = w_StaffID

                    Next w_Int

                    '********************************************************************************
                    '       職員歴と役職・職種を取得（計画期間内）
                    '********************************************************************************
                    .p病院CD = General.g_strHospitalCD
                    .pソート順 = 0
                    .pチーム区分 = 0
                    .pシステム区分 = 0
                    .p日付区分 = 1 '日付区分
                    .p開始年月日 = m_KeikakuKikan.StartDate '開始年月日
                    .p終了年月日 = m_KeikakuKikan.EndDate '終了年月日
                    .p勤務対象FLG = 1 '勤務対象FLG
                    .p職員取得FLG = 0 '職員対象フラグ
                    If g_SaikeiFlg = True Then
                        .p優先順位 = 9 '再掲部署CDを指定
                    Else
                        .p優先順位 = 0 '勤務部署CDを指定
                    End If
                    .p対象CD = General.g_strSelKinmuDeptCD '勤務部署CD

                    'ﾃﾞｰﾀ取得実行
                    If .mGetStaff = False Then
                    Else
                        'ﾃﾞｰﾀ件数取得
                        w_RecCnt = .f職員件数

                        ReDim m_Staff_ID(0) '職員管理番号
                        ReDim m_Staff_PreID(0) '職員番号
                        ReDim m_StaffTeam(0) 'チーム
                        ReDim m_StaffName(0) '氏名
                        ReDim m_StaffJobCD(0) '職種CD
                        ReDim m_StaffPostCD(0) '役職CD
                        ReDim m_StaffGiryoLvCD(0) '技量コード
                        ReDim m_StaffSaiyoDate(0) '採用年月日
                        ReDim m_StaffStartDate(0) '配属年月日
                        ReDim m_StaffEndDate(0) '転出日
                        ReDim m_StaffAutoKBN(0) '自動割当対象区分
                        ReDim m_StaffSyokai(0) '初回登録年月日
                        ReDim m_StaffSaisyu(0) '最終更新年月日
                        ReDim m_StaffTourokuID(0) '登録者ID
                        ReDim m_StaffTaisyokuDate(0) '退職日
                        ReDim m_StaffKousinFlg(0) '更新ﾌﾗｸﾞ
                        ReDim m_StaffNo(0) '表示NO
                        ReDim m_StaffNo1(0) '表示NO1
                        ReDim m_StaffNo2(0) '表示NO2
                        ReDim m_StaffNo3(0) '表示NO3
                        ReDim m_StaffNo4(0) '表示NO4
                        ReDim m_StaffNo5(0) '表示NO5
                        ReDim m_StaffGiryoBunruiCD(0) '技量分類CD
                        ReDim m_StaffGiryoHyojiNo(0) '技量表示No
                        ReDim m_StaffYakinKBN(0) '夜勤専従者区分
                        ReDim m_StaffPatternCD(0) 'パターンコード

                        '初期化
                        w_SyokuinRekiCnt = 0

                        pPrcessForm.pForeColor = ColorTranslator.ToOle(Color.Lime)
                        pPrcessForm.pSyoriText = "職員情報履歴を取得中..."

                        For w_Int = 1 To w_RecCnt

                            '処理経過画面設定
                            pPrcessForm.pMaxValue = w_RecCnt

                            'ｲﾝﾃﾞｯｸｽ引渡し
                            .p職員索引 = w_Int

                            w_str = .f職員管理番号2

                            If InStr(w_PreStr, w_str) = 0 AndAlso w_str <> "" Then
                                For w_Int2 = 1 To UBound(m_StaffData)
                                    If w_str = m_StaffData(w_Int2).ID Then

                                        w_SyokuinRekiCnt = w_SyokuinRekiCnt + 1

                                        '*************************************************
                                        '   職員情報設定画面引き渡し用
                                        '*************************************************
                                        '配列の確保
                                        ReDim Preserve m_Staff_ID(w_SyokuinRekiCnt) 'StaffMngID
                                        ReDim Preserve m_Staff_PreID(w_SyokuinRekiCnt) '職員番号
                                        ReDim Preserve m_StaffTeam(w_SyokuinRekiCnt) 'ﾁｰﾑ
                                        ReDim Preserve m_StaffName(w_SyokuinRekiCnt) 'StaffName
                                        ReDim Preserve m_StaffJobCD(w_SyokuinRekiCnt) '職種CD
                                        ReDim Preserve m_StaffPostCD(w_SyokuinRekiCnt) '役職CD
                                        ReDim Preserve m_StaffGiryoLvCD(w_SyokuinRekiCnt) 'SkillLvlCD
                                        ReDim Preserve m_StaffSaiyoDate(w_SyokuinRekiCnt) 'EmpDate
                                        ReDim Preserve m_StaffStartDate(w_SyokuinRekiCnt) '配属年月日
                                        ReDim Preserve m_StaffEndDate(w_SyokuinRekiCnt) '転出日
                                        ReDim Preserve m_StaffAutoKBN(w_SyokuinRekiCnt) '自動割当対象区分
                                        ReDim Preserve m_StaffSyokai(w_SyokuinRekiCnt) 'RegistFirstTimeDate
                                        ReDim Preserve m_StaffSaisyu(w_SyokuinRekiCnt) 'LastUpdTimeDate
                                        ReDim Preserve m_StaffTourokuID(w_SyokuinRekiCnt) 'RegistrantID
                                        ReDim Preserve m_StaffTaisyokuDate(w_SyokuinRekiCnt) '退職日
                                        ReDim Preserve m_StaffKousinFlg(w_SyokuinRekiCnt) '更新ﾌﾗｸﾞ
                                        ReDim Preserve m_StaffNo(w_SyokuinRekiCnt) '表示NO
                                        ReDim Preserve m_StaffNo1(w_SyokuinRekiCnt) '表示NO1
                                        ReDim Preserve m_StaffNo2(w_SyokuinRekiCnt) '表示NO2
                                        ReDim Preserve m_StaffNo3(w_SyokuinRekiCnt) '表示NO3
                                        ReDim Preserve m_StaffNo4(w_SyokuinRekiCnt) '表示NO4
                                        ReDim Preserve m_StaffNo5(w_SyokuinRekiCnt) '表示NO5
                                        ReDim Preserve m_StaffGiryoBunruiCD(w_SyokuinRekiCnt) '技量分類CD
                                        ReDim Preserve m_StaffGiryoHyojiNo(w_SyokuinRekiCnt) '技量表示No
                                        ReDim Preserve m_StaffYakinKBN(w_SyokuinRekiCnt) '夜勤専従者区分
                                        ReDim Preserve m_StaffPatternCD(w_SyokuinRekiCnt) 'パターンコード

                                        '表示NO取得
                                        m_StaffData(w_Int2).HyojiNo = w_Int
                                        m_StaffData(w_Int2).InitialHyojiNo = w_Int
                                        m_StaffData(w_Int2).HyojiNo1 = .f表示順No1
                                        m_StaffData(w_Int2).HyojiNo2 = .f表示順No2
                                        m_StaffData(w_Int2).HyojiNo3 = .f表示順No3
                                        m_StaffData(w_Int2).HyojiNo4 = .f表示順No4
                                        m_StaffData(w_Int2).HyojiNo5 = .f表示順No5
                                        '最大表示Noを取得
                                        If w_MaxHyojiNo < m_StaffData(w_Int2).HyojiNo Then
                                            w_MaxHyojiNo = m_StaffData(w_Int2).HyojiNo
                                        End If

                                        'ﾁｰﾑ
                                        m_StaffData(w_Int2).Team = General.g_objGetData.fチーム2

                                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                            '計画新規のときに看護単位ﾁｰﾑ数より大きい場合、ﾁｰﾑ数「１」に設定
                                            If m_StaffData(w_Int2).Team > m_TeamCnt Then
                                                m_StaffData(w_Int2).Team = 1
                                            End If
                                        End If

                                        If w_MaxTeamCnt < m_StaffData(w_Int2).Team Then
                                            '最大のﾁｰﾑ数取得
                                            w_MaxTeamCnt = m_StaffData(w_Int2).Team
                                        End If

                                        '自動割当区分
                                        m_StaffData(w_Int2).AutoKBN = .f自動割当対象区分2
                                        '夜勤専従者KBN
                                        m_StaffData(w_Int2).YakinKBN = .f夜勤専従者KBN2
                                        '技量ﾚﾍﾞﾙｺｰﾄﾞ
                                        m_StaffData(w_Int2).GiryoLvCD = .f技量レベルCD2
                                        'SkillBunruiCD
                                        m_StaffData(w_Int2).GiryoBunruiCD = .f技量分類CD2
                                        '技量表示NO
                                        m_StaffData(w_Int2).GiryoHyojiNo = .f技量表示順
                                        '更新FLG
                                        m_StaffData(w_Int2).UpdateFlg = .f更新FLG
                                        '役職CD
                                        m_StaffData(w_Int2).PostCode = .f役職CD2
                                        m_StaffData(w_Int2).PostName = .f役職名称2
                                        '役職表示NO
                                        m_StaffData(w_Int2).PostHyojiNo = .f役職表示順
                                        '職種CD
                                        m_StaffData(w_Int2).JobCode = .f職種CD2
                                        '職種表示NO
                                        m_StaffData(w_Int2).JobHyojiNo = .f職種表示順
                                        '計画期間内在職職員
                                        m_StaffData(w_Int2).TargetKikanFlg = True
                                        'パターンコード
                                        m_StaffData(w_Int2).PatternCD = .f割当パターンCD
                                        '初回更新年月日
                                        m_StaffData(w_Int2).Syokai = .f職員初回登録日時
                                        '最終更新年月日
                                        m_StaffData(w_Int2).Saisyu = .f職員最終更新日時

                                        '*************************************************
                                        '   職員情報設定画面引き渡し用
                                        '*************************************************
                                        '職員情報の格納
                                        m_Staff_ID(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).ID, Object) 'StaffMngID
                                        m_Staff_PreID(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).PreID, Object) '職員番号
                                        m_StaffTeam(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).Team, Object) 'ﾁｰﾑ
                                        m_StaffName(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).StaffName, Object) 'StaffName
                                        m_StaffJobCD(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).JobCode, Object) '職種CD
                                        m_StaffPostCD(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).PostCode, Object) '役職CD
                                        m_StaffGiryoLvCD(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).GiryoLvCD, Object) 'SkillLvlCD
                                        m_StaffSaiyoDate(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).SaiyoYMD, Object) 'EmpDate
                                        m_StaffStartDate(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HaizokuIF, Object) '配属年月日
                                        m_StaffEndDate(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).TensyutuIF, Object) '転出日
                                        m_StaffAutoKBN(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).AutoKBN, Object) '自動割当対象区分
                                        m_StaffSyokai(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).Syokai, Object) 'RegistFirstTimeDate
                                        m_StaffSaisyu(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).Saisyu, Object) 'LastUpdTimeDate
                                        m_StaffTourokuID(w_SyokuinRekiCnt) = DirectCast(General.g_strUserID, Object) 'RegistrantID
                                        m_StaffTaisyokuDate(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).TentaiYMD, Object) '退職日
                                        m_StaffKousinFlg(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).UpdateFlg, Object) '更新ﾌﾗｸﾞ
                                        m_StaffNo(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo, Object) '表示NO
                                        m_StaffNo1(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo1, Object) '表示NO1
                                        m_StaffNo2(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo2, Object) '表示NO2
                                        m_StaffNo3(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo3, Object) '表示NO3
                                        m_StaffNo4(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo4, Object) '表示NO4
                                        m_StaffNo5(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).HyojiNo5, Object) '表示NO5
                                        m_StaffGiryoBunruiCD(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).GiryoBunruiCD, Object) '技量分類CD
                                        m_StaffGiryoHyojiNo(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).GiryoHyojiNo, Object) '技量表示No
                                        m_StaffYakinKBN(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).YakinKBN, Object) '夜勤専従者区分
                                        m_StaffPatternCD(w_SyokuinRekiCnt) = DirectCast(m_StaffData(w_Int2).PatternCD, Object) 'パターンコード

                                        '職員管理番号退避
                                        w_PreStr = w_PreStr & "," & w_str

                                        Exit For
                                    End If
                                Next w_Int2
                            End If

                            '処理経過ｶｳﾝﾄ
                            pPrcessForm.pCountValue = w_Int
                        Next w_Int
                    End If

                    m_MaxTeamCnt = w_MaxTeamCnt '最大のﾁｰﾑ数

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                        '計画変更または勤務変更のとき最大のﾁｰﾑ数を看護単位ﾁｰﾑ数に設定
                        m_TeamCnt = w_MaxTeamCnt
                    End If

                    '計画期間内に在職しない職員の設定
                    For w_Int = 1 To UBound(m_StaffData)
                        If m_StaffData(w_Int).TargetKikanFlg = False Then
                            m_StaffData(w_Int).GiryoLvCD = w_DefGiryoLvCD
                            m_StaffData(w_Int).GiryoHyojiNo = w_DefGiryoNo '(デフォルト技量LVCDの表示№取得)
                            m_StaffData(w_Int).GiryoBunruiCD = w_DefGiryoKbn '(デフォルト技量LVCDの分類CD取得)
                            m_StaffData(w_Int).Team = w_DefTeam
                            m_StaffData(w_Int).AutoKBN = w_DefAutoKBN
                            w_MaxHyojiNo = w_MaxHyojiNo + 1
                            m_StaffData(w_Int).HyojiNo = w_MaxHyojiNo
                            m_StaffData(w_Int).UpdateFlg = M_DataFlg_DefaultData
                            m_StaffData(w_Int).Syokai = w_SysDate
                            m_StaffData(w_Int).Saisyu = w_SysDate
                            m_StaffData(w_Int).YakinKBN = "1"
                            m_StaffData(w_Int).PatternCD = ""
                            m_StaffData(w_Int).JobCode = "" '職種CD
                            m_StaffData(w_Int).JobHyojiNo = 99 '職種表示順
                            m_StaffData(w_Int).PostCode = "" '役職CD
                            m_StaffData(w_Int).PostName = "" '役職CD 
                            m_StaffData(w_Int).PostHyojiNo = 99 '役職表示順
                        End If
                    Next w_Int

                    '***************************************************
                    '        応援勤務者取得
                    '***************************************************
                    '初期化
                    m_OuenStaffCnt = 0

                    If General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "OUENDISPFLG", "1", General.g_strHospitalCD) = "0" Then
                        'If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                        '    '2015/04/09 Yamanishi Add Upd Start ----------------------------------------------------
                        '    ''新規作成または勤務変更のとき
                        '    'If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        '    '    w_TargetTable = "NS_KINMUPLAN_F"
                        '    'Else
                        '    '    w_TargetTable = "NS_KINMURESULT_F"
                        '    'End If
                        '    'w_Sql = "SELECT NS_STAFFBASISINFO_F.STAFFMNGID"
                        '    'w_Sql = w_Sql & ", NS_STAFFBASISINFO_F.STAFFNAME"
                        '    'w_Sql = w_Sql & ", " & w_TargetTable & ".DATEF"
                        '    'w_Sql = w_Sql & " FROM NS_STAFFBASISINFO_F, " & w_TargetTable
                        '    'w_Sql = w_Sql & " WHERE " & w_TargetTable & ".OUENKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".DATEF <= " & w_To
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".DATEF >= " & w_From
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".STAFFMNGID = NS_STAFFBASISINFO_F.STAFFMNGID"
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".HOSPITALCD = NS_STAFFBASISINFO_F.HOSPITALCD"
                        '    'w_Sql = w_Sql & " AND NS_STAFFBASISINFO_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                        '    'w_Sql = w_Sql & " ORDER BY NS_STAFFBASISINFO_F.STAFFMNGID"

                        '    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        '        'RICHARD UPDATE START
                        '        '.AppendLine("SELECT SB.STAFFMNGID")
                        '        '.AppendLine("     , SB.STAFFNAME")
                        '        '.AppendLine("     , KP.DATEF")
                        '        '.AppendLine("  FROM NS_STAFFBASISINFO_F SB")
                        '        '.AppendLine("    INNER JOIN NS_PLANCONTROL_F PC")
                        '        '.AppendLine("        ON  PC.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine("    INNER JOIN NS_KINMUPLAN_F KP")
                        '        '.AppendLine("        ON  KP.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine("        AND KP.STAFFMNGID = SB.STAFFMNGID")
                        '        '.AppendLine("        AND KP.DATEF  >= PC.PLANPERIODFROM")
                        '        '.AppendLine("        AND (KP.DATEF <= PC.PLANPERIODTO")
                        '        '.AppendLine("          OR NOT EXISTS(SELECT * FROM NS_KINMURESULT_F KR")
                        '        '.AppendLine("                         WHERE KR.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine("                           AND KR.STAFFMNGID = SB.STAFFMNGID")
                        '        '.AppendLine("                           AND KP.DATEF BETWEEN PC.PLANPERIODTO + 1")
                        '        '.AppendLine("                                            AND " & w_To & "))")
                        '        '.AppendLine(" WHERE SB.HOSPITALCD = '" & General.g_strHospitalCD & "'")
                        '        '.AppendLine("   AND PC.PLANNO     =  " & m_PlanNo)
                        '        '.AppendLine("   AND KP.OUENKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'")
                        '        '.AppendLine("   AND KP.DATEF     BETWEEN  " & m_Calendar.StartDate)
                        '        '.AppendLine("                        AND  " & w_To)
                        '        '.AppendLine("UNION ALL")
                        '        '.AppendLine("SELECT SB.STAFFMNGID")
                        '        '.AppendLine("     , SB.STAFFNAME")
                        '        '.AppendLine("     , KR.DATEF")
                        '        '.AppendLine("  FROM NS_STAFFBASISINFO_F SB")
                        '        '.AppendLine("    INNER JOIN NS_PLANCONTROL_F PC")
                        '        '.AppendLine("        ON  PC.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine("    INNER JOIN NS_KINMURESULT_F KR")
                        '        '.AppendLine("        ON  KR.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine("        AND KR.STAFFMNGID = SB.STAFFMNGID")
                        '        '.AppendLine("        AND NOT KR.DATEF BETWEEN PC.PLANPERIODFROM")
                        '        '.AppendLine("                             AND PC.PLANPERIODTO")
                        '        '.AppendLine(" WHERE SB.HOSPITALCD = '" & General.g_strHospitalCD & "'")
                        '        '.AppendLine("   AND PC.PLANNO     =  " & m_PlanNo)
                        '        '.AppendLine("   AND KR.OUENKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'")
                        '        '.AppendLine("   AND KR.DATEF     BETWEEN  " & m_Calendar.StartDate)
                        '        '.AppendLine("                        AND  " & w_To)
                        '        '.AppendLine(" ORDER BY STAFFMNGID")
                        '        Call NSK0000H_sql.select_NS_STAFFBASISINFO_F_01(w_Rs, w_To, m_PlanNo, m_Calendar.StartDate) '<9>
                        '        'RICHARD UPDATE END
                        '    Else
                        '        'RICHARD UPDATE START
                        '        '.AppendLine("SELECT SB.STAFFMNGID")
                        '        '.AppendLine("     , SB.STAFFNAME")
                        '        '.AppendLine("     , KR.DATEF")
                        '        '.AppendLine("  FROM NS_STAFFBASISINFO_F SB")
                        '        '.AppendLine("    INNER JOIN NS_KINMURESULT_F KR")
                        '        '.AppendLine("        ON  KR.STAFFMNGID = SB.STAFFMNGID")
                        '        '.AppendLine("        AND KR.HOSPITALCD = SB.HOSPITALCD")
                        '        '.AppendLine(" WHERE SB.HOSPITALCD      = '" & General.g_strHospitalCD & "'")
                        '        '.AppendLine("   AND KR.OUENKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'")
                        '        '.AppendLine("   AND KR.DATEF     BETWEEN  " & w_From)
                        '        '.AppendLine("                        AND  " & w_To)
                        '        '.AppendLine(" ORDER BY SB.STAFFMNGID")
                        '        Call NSK0000H_sql.select_NS_STAFFBASISINFO_F_02(w_Rs, w_From, w_To) '<10>
                        '    End If


                        '    If w_Rs.RecordCount <= 0 Then
                        '        '何もしない
                        '    Else
                        '        With w_Rs
                        '            .MoveLast()
                        '            w_OuenCnt = .RecordCount
                        '            .MoveFirst()

                        '            w_StaffMngID_F = .Fields("STAFFMNGID")
                        '            w_StaffName_F = .Fields("STAFFNAME")
                        '            w_DateF_F = .Fields("DATEF")

                        '            '1件でもﾃﾞｰﾀが合った場合は最大チーム数を１つ増やす（応援勤務者用チーム）
                        '            m_OuenTeam = m_TeamCnt + 1

                        '            For w_Int = 1 To w_OuenCnt

                        '                w_OuenStaffID = w_StaffMngID_F.Value

                        '                'すでに取得済みの配列に同じ職員番号がないか検索（何日かだけこの部署に所属した職員が他部署でこの部署に応援にきていたときのため）
                        '                If InStr(w_strStaffID, w_OuenStaffID) = 0 Then

                        '                    w_lngDate = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)

                        '                    '勤務を作成後、転退日を入力された場合に対応
                        '                    If SearchZaisyoku(w_OuenStaffID, w_lngDate) = True Then

                        '                        If w_PreOuenStaffID <> w_OuenStaffID Then
                        '                            '応援勤務者数ｶｳﾝﾄｱｯﾌﾟ
                        '                            m_OuenStaffCnt = m_OuenStaffCnt + 1

                        '                            w_OuenIdx = UBound(m_StaffData) + 1
                        '                            '配列拡張
                        '                            ReDim Preserve m_StaffData(w_OuenIdx)
                        '                            ReDim m_StaffData(w_OuenIdx).Daikyu(0)

                        '                            m_StaffData(w_OuenIdx).ID = w_StaffMngID_F.Value
                        '                            m_StaffData(w_OuenIdx).StaffName = IIf(IsDBNull(w_StaffName_F.Value), "", w_StaffName_F.Value)
                        '                            m_StaffData(w_OuenIdx).SaiyoYMD = w_From
                        '                            m_StaffData(w_OuenIdx).TentaiYMD = w_To
                        '                            m_StaffData(w_OuenIdx).OuenStaffFlg = 1 '応援勤務者

                        '                            ReDim m_StaffData(w_OuenIdx).Daikyu(0)
                        '                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0)
                        '                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0).Detail(0)
                        '                            ReDim m_StaffData(w_OuenIdx).Kojyo(0)
                        '                            ReDim m_StaffData(w_OuenIdx).SumCntData.SumSeq(UBound(m_HMtrx))
                        '                            ReDim m_StaffData(w_OuenIdx).SumCntData_4W(UBound(m_4WeekKikan))
                        '                            '2016/02/01 T.K add st ----------------------------------------
                        '                            For i As Integer = 1 To UBound(m_4WeekKikan)
                        '                                ReDim m_StaffData(w_OuenIdx).SumCntData_4W(i).SumSeq(UBound(m_HMtrx_4Week))
                        '                            Next
                        '                            '2016/02/01 T.K add ed ----------------------------------------
                        '                            ReDim m_StaffData(w_OuenIdx).ResultCnt(0)

                        '                            m_StaffData(w_OuenIdx).Team = m_OuenTeam '応援勤務者用チームを格納
                        '                            m_StaffData(w_OuenIdx).HyojiNo = 100 + w_OuenIdx

                        '                            ReDim m_StaffData(w_OuenIdx).IdoData(1)

                        '                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD2 = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(1).SyuryoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)

                        '                            '代休情報取得
                        '                            If General.g_lngDaikyuMng = 0 Then
                        '                                Call Get_Daikyu(w_OuenIdx)
                        '                            End If

                        '                            '採用履歴情報取得
                        '                            Call Get_SaiyoData(w_OuenIdx, w_From, w_To)
                        '                        Else
                        '                            '異動情報を拡張
                        '                            w_IdoIdx = UBound(m_StaffData(w_OuenIdx).IdoData) + 1
                        '                            ReDim Preserve m_StaffData(w_OuenIdx).IdoData(w_IdoIdx)

                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD2 = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).SyuryoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                        End If

                        '                        '職員管理番号退避
                        '                        w_PreOuenStaffID = w_OuenStaffID
                        '                    End If
                        '                End If

                        '                .MoveNext()
                        '            Next w_Int
                        '        End With
                        '    End If
                        'ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '    '計画変更の場合（該当計画番号が確定されていればＮＳ勤務実績Ｆ、されていない場合はＮＳ勤務予定Ｆ）
                        '    'RICHARD UPDATE START
                        '    'w_Sql = "Select NS_STAFFBASISINFO_F.STAFFMNGID"
                        '    'w_Sql = w_Sql & ", NS_STAFFBASISINFO_F.STAFFNAME"
                        '    'If SearchKakuteiData() = False Then
                        '    '    w_TargetTable = "NS_KINMUPLAN_F"
                        '    'Else
                        '    '    w_TargetTable = "NS_KINMURESULT_F"
                        '    'End If
                        '    'w_Sql = w_Sql & ", " & w_TargetTable & ".DATEF"
                        '    'w_Sql = w_Sql & " FROM NS_STAFFBASISINFO_F, " & w_TargetTable
                        '    'w_Sql = w_Sql & " WHERE " & w_TargetTable & ".OUENKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".DATEF <= " & w_To
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".DATEF >= " & w_From
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".STAFFMNGID = NS_STAFFBASISINFO_F.STAFFMNGID"
                        '    'w_Sql = w_Sql & " AND " & w_TargetTable & ".HOSPITALCD = NS_STAFFBASISINFO_F.HOSPITALCD"
                        '    'w_Sql = w_Sql & " AND NS_STAFFBASISINFO_F.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                        '    'w_Sql = w_Sql & " ORDER BY NS_STAFFBASISINFO_F.STAFFMNGID"
                        '    'w_Rs = General.paDBRecordSetOpen(w_Sql)
                        '    Call NSK0000H_sql.select_NS_STAFFBASISINFO_F_03(w_Rs, SearchKakuteiData(), w_TargetTable, w_To, w_From) '<11>
                        '    'RICHARD UPDATE END

                        '    If w_Rs.RecordCount <= 0 Then
                        '        '何もしない
                        '    Else
                        '        With w_Rs
                        '            .MoveLast()
                        '            w_OuenCnt = .RecordCount
                        '            .MoveFirst()

                        '            w_StaffMngID_F = .Fields("STAFFMNGID")
                        '            w_StaffName_F = .Fields("STAFFNAME")
                        '            w_DateF_F = .Fields("DATEF")

                        '            '1件でもﾃﾞｰﾀが合った場合は最大チーム数を１つ増やす（応援勤務者用チーム）
                        '            m_OuenTeam = m_TeamCnt + 1

                        '            For w_Int = 1 To w_OuenCnt

                        '                w_OuenStaffID = w_StaffMngID_F.Value

                        '                'すでに取得済みの配列に同じ職員番号がないか検索（何日かだけこの部署に所属した職員が他部署でこの部署に応援にきていたときのため）
                        '                If InStr(w_strStaffID, w_OuenStaffID) = 0 Then

                        '                    w_lngDate = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)

                        '                    '勤務を作成後、転退日を入力された場合に対応
                        '                    If SearchZaisyoku(w_OuenStaffID, w_lngDate) = True Then

                        '                        If w_PreOuenStaffID <> w_OuenStaffID Then
                        '                            '応援勤務者数ｶｳﾝﾄｱｯﾌﾟ
                        '                            m_OuenStaffCnt = m_OuenStaffCnt + 1

                        '                            w_OuenIdx = UBound(m_StaffData) + 1
                        '                            '配列拡張
                        '                            ReDim Preserve m_StaffData(w_OuenIdx)

                        '                            m_StaffData(w_OuenIdx).ID = w_StaffMngID_F.Value
                        '                            m_StaffData(w_OuenIdx).StaffName = IIf(IsDBNull(w_StaffName_F.Value), "", w_StaffName_F.Value)
                        '                            m_StaffData(w_OuenIdx).SaiyoYMD = w_From
                        '                            m_StaffData(w_OuenIdx).TentaiYMD = w_To
                        '                            m_StaffData(w_OuenIdx).OuenStaffFlg = 1 '応援勤務者

                        '                            ReDim m_StaffData(w_OuenIdx).Daikyu(0)
                        '                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0)
                        '                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0).Detail(0)
                        '                            ReDim m_StaffData(w_OuenIdx).Kojyo(0)
                        '                            ReDim m_StaffData(w_OuenIdx).SumCntData.SumSeq(UBound(m_HMtrx))
                        '                            ReDim m_StaffData(w_OuenIdx).SumCntData_4W(UBound(m_4WeekKikan))
                        '                            '2016/02/01 T.K add st ----------------------------------------
                        '                            For i As Integer = 1 To UBound(m_4WeekKikan)
                        '                                ReDim m_StaffData(w_OuenIdx).SumCntData_4W(i).SumSeq(UBound(m_HMtrx_4Week))
                        '                            Next
                        '                            '2016/02/01 T.K add ed ----------------------------------------
                        '                            ReDim m_StaffData(w_OuenIdx).ResultCnt(0)

                        '                            m_StaffData(w_OuenIdx).Team = m_OuenTeam '応援勤務者用チームを格納
                        '                            m_StaffData(w_OuenIdx).HyojiNo = 100 + w_OuenIdx

                        '                            ReDim m_StaffData(w_OuenIdx).IdoData(1)

                        '                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD2 = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(1).SyuryoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)

                        '                            '採用履歴情報取得
                        '                            Call Get_SaiyoData(w_OuenIdx, w_From, w_To)
                        '                        Else
                        '                            '異動情報を拡張
                        '                            w_IdoIdx = UBound(m_StaffData(w_OuenIdx).IdoData) + 1
                        '                            ReDim Preserve m_StaffData(w_OuenIdx).IdoData(w_IdoIdx)

                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD2 = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).SyuryoYMD = IIf(IsDBNull(w_DateF_F.Value), 0, w_DateF_F.Value)
                        '                        End If

                        '                        '職員管理番号退避
                        '                        w_PreOuenStaffID = w_OuenStaffID
                        '                    End If
                        '                End If

                        '                .MoveNext()
                        '            Next w_Int
                        '        End With
                        '    End If
                        'End If
                        'w_Rs.Close()

                        '********************************************************************************
                        '       応援職員を取得
                        '********************************************************************************
                        .p病院CD = General.g_strHospitalCD
                        .p開始年月日 = w_From   '開始年月日
                        .p終了年月日 = w_To     '終了年月日
                        .p日付区分 = 1          '日付区分
                        .p計画番号 = m_PlanNo
                        Select Case m_PgmFlg
                            Case General.G_PGMSTARTFLG_NEWPLAN
                                .p勤務取得区分 = 2 '--- 予定／実績
                            Case General.G_PGMSTARTFLG_CHANGEPLAN
                                .p勤務取得区分 = 1 '--- 実績のみ
                            Case General.G_PGMSTARTFLG_CHANGEJISSEKI
                                If SearchKakuteiData() Then
                                    .p勤務取得区分 = 1 '実績のみ
                                Else
                                    .p勤務取得区分 = 0 '予定のみ
                                End If
                        End Select

                        If .mGetOuenStaff(General.g_strSelKinmuDeptCD) Then
                            '1件でもﾃﾞｰﾀが合った場合は最大チーム数を１つ増やす（応援勤務者用チーム）
                            If .f職員件数 > 0 Then
                                m_OuenTeam = m_TeamCnt + 1
                            End If

                            For i As Integer = 1 To .f職員件数
                                .p職員索引 = i
                                w_OuenStaffID = .f職員管理番号2

                                'すでに取得済みの配列に同じ職員番号がないか検索（何日かだけこの部署に所属した職員が他部署でこの部署に応援にきていたときのため）
                                If InStr(w_strStaffID, w_OuenStaffID) = 0 Then

                                    w_lngDate = .f応援勤務日
                                    '勤務を作成後、転退日を入力された場合に対応
                                    If SearchZaisyoku(w_OuenStaffID, w_lngDate) Then
                                        If w_PreOuenStaffID <> w_OuenStaffID Then
                                            '応援勤務者数ｶｳﾝﾄｱｯﾌﾟ
                                            m_OuenStaffCnt += 1
                                            w_OuenIdx = UBound(m_StaffData) + 1
                                            '配列拡張
                                            ReDim Preserve m_StaffData(w_OuenIdx)
                                            ReDim m_StaffData(w_OuenIdx).Daikyu(0)

                                            m_StaffData(w_OuenIdx).ID = w_OuenStaffID
                                            m_StaffData(w_OuenIdx).StaffName = .f氏名2
                                            m_StaffData(w_OuenIdx).SaiyoYMD = w_From
                                            m_StaffData(w_OuenIdx).TentaiYMD = w_To
                                            m_StaffData(w_OuenIdx).OuenStaffFlg = 1 '応援勤務者

                                            ReDim m_StaffData(w_OuenIdx).Daikyu(0)
                                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0)
                                            ReDim m_StaffData(w_OuenIdx).NenkyuData(0).Detail(0)
                                            ReDim m_StaffData(w_OuenIdx).Kojyo(0)
                                            ReDim m_StaffData(w_OuenIdx).SumCntData.SumSeq(UBound(m_HMtrx))
                                            ReDim m_StaffData(w_OuenIdx).SumCntData_4W(UBound(m_4WeekKikan))
                                            For j As Integer = 1 To UBound(m_4WeekKikan)
                                                ReDim m_StaffData(w_OuenIdx).SumCntData_4W(j).SumSeq(UBound(m_HMtrx_4Week))
                                            Next j
                                            ReDim m_StaffData(w_OuenIdx).ResultCnt(0)

                                            m_StaffData(w_OuenIdx).Team = m_OuenTeam '応援勤務者用チームを格納
                                            m_StaffData(w_OuenIdx).HyojiNo = 100 + w_OuenIdx

                                            ReDim m_StaffData(w_OuenIdx).IdoData(1)

                                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD = w_lngDate
                                            m_StaffData(w_OuenIdx).IdoData(1).IdoYMD2 = w_lngDate
                                            m_StaffData(w_OuenIdx).IdoData(1).SyuryoYMD = w_lngDate

                                            '代休情報取得
                                            If General.g_lngDaikyuMng = 0 Then
                                                Call Get_Daikyu(w_OuenIdx)
                                            End If

                                            '採用履歴情報取得
                                            Call Get_SaiyoData(w_OuenIdx, w_From, w_To)

                                            '2018/10/09 Yamanishi Add -------------------------------------------------------
                                            With General.g_objIdoData
                                                .pHospitalCD = General.g_strHospitalCD
                                                .pStaffMngID = w_OuenStaffID
                                                .pDateTo = m_KeikakuKikan.EndDate
                                                .pDateFrom = 0
                                                .pDateFlg = 1
                                                .pSortFlg = 0

                                                If .mGetJobIdo Then
                                                    .mJI_JobIdx = 1
                                                    m_StaffData(w_OuenIdx).JobCode = .fJI_CD
                                                End If
                                                If .mGetPostIdo Then
                                                    .mPI_PostIdx = 1
                                                    m_StaffData(w_OuenIdx).PostCode = .fPI_CD
                                                End If
                                            End With
                                            '--------------------------------------------------------------------------------
                                        Else
                                            '異動情報を拡張
                                            w_IdoIdx = UBound(m_StaffData(w_OuenIdx).IdoData) + 1
                                            ReDim Preserve m_StaffData(w_OuenIdx).IdoData(w_IdoIdx)

                                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD = w_lngDate
                                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).IdoYMD2 = w_lngDate
                                            m_StaffData(w_OuenIdx).IdoData(w_IdoIdx).SyuryoYMD = w_lngDate
                                        End If

                                        '職員管理番号退避
                                        w_PreOuenStaffID = w_OuenStaffID
                                    End If
                                End If
                            Next i
                        End If
                    End If
                End If
            End With

            '夜勤専従 and 短時間者情報取得
            Call subGetNightShortData(w_From, w_To)

            '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------------------
            For w_Int = 1 To UBound(m_StaffData)
                ReDim m_StaffData(w_Int).BeforeKinmuData(0) '2016/06/15 Yamanishi Add
                'RICHARD UPDATE START
                'w_Sql = ""
                'w_Sql = w_Sql & " SELECT "
                'w_Sql = w_Sql & "   KINMUDEPTCD "
                'w_Sql = w_Sql & " , IDODATE "
                'w_Sql = w_Sql & " , ENDDATE "
                'w_Sql = w_Sql & " FROM NS_KINMUIDOINFO_F "
                'w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                'w_Sql = w_Sql & " AND STAFFMNGID = '" & m_StaffData(w_Int).ID & "' "
                'w_Sql = w_Sql & " ORDER BY IDODATE "
                'w_Rs = General.paDBRecordSetOpen(w_Sql)
                Call NSK0000H_sql.select_NS_KINMUIDOINFO_F_01(w_Rs, m_StaffData(w_Int).ID) '<12>
                'RICHARD UPDATE END

                ReDim m_StaffData(w_Int).IdoHistory(w_Rs.RecordCount)

                For w_IdoIdx = 1 To UBound(m_StaffData(w_Int).IdoHistory)
                    m_StaffData(w_Int).IdoHistory(w_IdoIdx).CD = w_Rs.Fields("KINMUDEPTCD").Value
                    m_StaffData(w_Int).IdoHistory(w_IdoIdx).IdoYMD = Integer.Parse(w_Rs.Fields("IDODATE").Value)
                    m_StaffData(w_Int).IdoHistory(w_IdoIdx).SyuryoYMD = Integer.Parse("0" & w_Rs.Fields("ENDDATE").Value)
                    If m_StaffData(w_Int).IdoHistory(w_IdoIdx).SyuryoYMD = 0 Then
                        m_StaffData(w_Int).IdoHistory(w_IdoIdx).SyuryoYMD = 999999999
                    End If
                    Call w_Rs.MoveNext()
                Next w_IdoIdx
                Call w_Rs.Close()
            Next w_Int
            '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------------------


            '---------------------------------------------
            '   ｽﾌﾟﾚｯﾄﾞに職員を設定する
            '---------------------------------------------
            w_Row = M_KinmuDataStart_Row

            'ﾃﾞｰﾀ行数 開始行 情報 設定
            m_StaffRow.StartRow = M_KinmuDataStart_Row

            '計画期間開始日の列番号が4週のスプレッドのときの列番号取得
            If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                w_StartCol = M_KinmuData_Col
            End If


            '処理経過ﾌｫｰﾑ設定
            pPrcessForm.pForeColor = ColorTranslator.ToOle(Color.Lime)
            pPrcessForm.pSyoriText = "職員情報設定中..."

            '処理経過画面設定
            pPrcessForm.pMaxValue = UBound(m_StaffData)

            'ﾃﾞｰﾀ件数 繰り返し
            For w_Int = 1 To UBound(m_StaffData)

                w_LastMonthDays = 0

                If m_YakanKangoDispFlg = 0 Then
                    '看護加算計算時用CD取得(役職・職種・採用CD・夜勤専従者区分)
                    Call Get_YakanKangoData(w_Int)
                End If

                With m_Spread(1).Sheets(0)
                    'No. 設定
                    w_Var = Convert.ToString(w_Int)
                    .SetText(w_Row, M_HyojiNo_Col, w_Var)

                    'StaffName 設定
                    w_Var = DirectCast(m_StaffData(w_Int).StaffName, Object)
                    .SetText(w_Row, M_StaffName_Col, w_Var)

                    'StaffMngID 設定
                    w_Var = DirectCast(m_StaffData(w_Int).ID, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffID).SetCol_M, w_Var)
                    Next w_Int2

                    '採用日 設定
                    w_Var = DirectCast(m_StaffData(w_Int).SaiyoYMD, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SaiyoYMD).SetCol_M, w_Var)
                    Next w_Int2

                    '職種表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).JobHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_JobHyojiNo).SetCol_M, w_Var)
                    Next w_Int2

                    '役職表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).PostHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_PostHyojiNo).SetCol_M, w_Var)
                    Next w_Int2

                    '技量表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).GiryoHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_GiryoHyojiNo).SetCol_M, w_Var)
                    Next w_Int2

                    '表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).HyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffHyojiNo).SetCol_M, w_Var)
                    Next w_Int2

                    'ﾁｰﾑ 設定
                    w_Var = Convert.ToString(m_StaffData(w_Int).Team)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_Team).SetCol_M, w_Var)
                    Next w_Int2

                    '職員番号
                    w_Var = DirectCast(m_StaffData(w_Int).PreID, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SyokuinNo).SetCol_M, w_Var)
                    Next w_Int2

                    'ソート用
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        w_Var = DirectCast((m_StaffData(w_Int).HyojiNo - 1) * m_MaxShowLine + w_Int2 + 1, Object)
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SortTeam).SetCol_M, w_Var)
                    Next w_Int2

                    'ﾃﾞｰﾀ格納配列番号 設定
                    w_Var = Convert.ToString(w_Int)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_M, w_Var)
                    Next w_Int2

                    '-- StaffName 色設定 -------------
                    '自動割当対象区分 ?
                    If g_HopeMode <> "1" Then
                        If m_StaffData(w_Int).AutoKBN = "1" Then
                            'SkillBunruiCD ?
                            If m_StaffData(w_Int).GiryoBunruiCD = "1" Then
                                'ﾘｰﾀﾞｰ
                                w_ForeColor = ColorTranslator.FromOle(m_Leader_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                            ElseIf m_StaffData(w_Int).GiryoBunruiCD = "2" Then
                                'ｻﾌﾞﾘｰﾀﾞｰ
                                w_ForeColor = ColorTranslator.FromOle(m_SubLeader_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                            ElseIf m_StaffData(w_Int).GiryoBunruiCD = "3" Then
                                'ｽﾀｯﾌ
                                w_ForeColor = ColorTranslator.FromOle(m_Staff_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                            ElseIf m_StaffData(w_Int).GiryoBunruiCD = "4" Then
                                '新人
                                w_ForeColor = ColorTranslator.FromOle(m_NewFace_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                            Else
                                'ERROR
                                '自動割当対象外 に設定
                                w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                            End If
                        Else
                            If m_StaffData(w_Int).OuenStaffFlg = 1 Then
                                '応援勤務者の場合
                                w_ForeColor = ColorTranslator.FromOle(m_Ouen_Name_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Name_Back)
                            Else
                                '非対象の場合
                                w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                            End If
                        End If
                    Else
                        '非対象の場合
                        w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                    End If

                    If m_MaxShowLine > 1 Then
                        .Cells(w_Row, M_StaffName_Col, w_Row + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                        .Cells(w_Row, M_StaffName_Col, w_Row + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                    Else
                        .Cells(w_Row, M_StaffName_Col).BackColor = w_BackColor
                        .Cells(w_Row, M_StaffName_Col).ForeColor = w_ForeColor
                    End If

                    ReDim w_From_Col(UBound(m_StaffData(w_Int).IdoData))
                    ReDim w_To_Col(UBound(m_StaffData(w_Int).IdoData))

                    For w_Int2 = 1 To UBound(m_StaffData(w_Int).IdoData)
                        '年月日から配属日/転出日の列番号 取得
                        w_Date = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))
                        w_Date2 = Date.Parse(Format(m_StaffData(w_Int).IdoData(w_Int2).IdoYMD, "0000/00/00"))
                        w_From_Col(w_Int2) = DateDiff(DateInterval.Day, w_Date, w_Date2) + m_KeikakuKikan.KinmuDataStartCol

                        w_Date2 = Date.Parse(Format(m_StaffData(w_Int).IdoData(w_Int2).SyuryoYMD, "0000/00/00"))
                        w_To_Col(w_Int2) = DateDiff(DateInterval.Day, w_Date, w_Date2) + m_KeikakuKikan.KinmuDataStartCol
                    Next w_Int2

                    '配属期間外表示色設定
                    For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                        w_HaizokuFlg = False
                        For w_Int2 = 1 To UBound(w_From_Col)
                            If w_From_Col(w_Int2) <= w_Col AndAlso w_Col <= w_To_Col(w_Int2) Then
                                '配属期間内のとき
                                w_HaizokuFlg = True
                                Exit For
                            End If
                        Next w_Int2

                        '応援勤務者は配属期間外とする
                        If m_StaffData(w_Int).OuenStaffFlg = 1 Then
                            w_HaizokuFlg = False
                        End If

                        If w_HaizokuFlg = True Then
                            '配属期間内のとき
                            w_ForeColor = Color.Black
                            w_BackColor = Color.White
                        Else
                            '配属期間外の時
                            w_ForeColor = ColorTranslator.FromOle(m_MonthBefore_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                        End If

                        If m_MaxShowLine > 1 Then
                            .Cells(w_Row, w_Col, w_Row + m_MaxShowLine - 1, w_Col).BackColor = w_BackColor
                            .Cells(w_Row, w_Col, w_Row + m_MaxShowLine - 1, w_Col).ForeColor = w_ForeColor
                        Else
                            .Cells(w_Row, w_Col).BackColor = w_BackColor
                            .Cells(w_Row, w_Col).ForeColor = w_ForeColor
                        End If
                    Next w_Col
                End With

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    With m_Spread(2).Sheets(0)
                        'No. 設定
                        w_Var = Convert.ToString(w_Int)
                        .SetText(w_Row, M_HyojiNo_Col, w_Var)

                        'StaffName 設定
                        w_Var = DirectCast(m_StaffData(w_Int).StaffName, Object)
                        .SetText(w_Row, M_StaffName_Col, w_Var)

                        'StaffMngID 設定
                        w_Var = DirectCast(m_StaffData(w_Int).ID, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffID).SetCol_4W, w_Var)
                        Next w_Int2

                        '採用日 設定
                        w_Var = DirectCast(m_StaffData(w_Int).SaiyoYMD, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_SaiyoYMD).SetCol_4W, w_Var)
                        Next w_Int2

                        '職種表示No 設定
                        w_Var = DirectCast(m_StaffData(w_Int).JobHyojiNo, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_JobHyojiNo).SetCol_4W, w_Var)
                        Next w_Int2

                        '役職表示No 設定
                        w_Var = DirectCast(m_StaffData(w_Int).PostHyojiNo, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_PostHyojiNo).SetCol_4W, w_Var)
                        Next w_Int2

                        '技量表示No 設定
                        w_Var = DirectCast(m_StaffData(w_Int).GiryoHyojiNo, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_GiryoHyojiNo).SetCol_4W, w_Var)
                        Next w_Int2

                        '表示No 設定
                        w_Var = DirectCast(m_StaffData(w_Int).HyojiNo, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffHyojiNo).SetCol_4W, w_Var)
                        Next w_Int2

                        'ﾁｰﾑ 設定
                        w_Var = Convert.ToString(m_StaffData(w_Int).Team)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_Team).SetCol_4W, w_Var)
                        Next w_Int2

                        '職員番号
                        w_Var = DirectCast(m_StaffData(w_Int).PreID, Object)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_SyokuinNo).SetCol_4W, w_Var)
                        Next w_Int2

                        'ソート用
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            w_Var = DirectCast((m_StaffData(w_Int).HyojiNo - 1) * m_MaxShowLine + w_Int2 + 1, Object)
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_SortTeam).SetCol_4W, w_Var)
                        Next w_Int2

                        'ﾃﾞｰﾀ格納配列番号 設定
                        w_Var = Convert.ToString(w_Int)
                        For w_Int2 = 0 To m_MaxShowLine - 1
                            .SetText(w_Row + w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_4W, w_Var)
                        Next w_Int2

                        '-- StaffName 色設定 -------------
                        '自動割当対象区分 ?
                        If g_HopeMode <> "1" Then
                            If m_StaffData(w_Int).AutoKBN = "1" Then
                                'SkillBunruiCD ?
                                If m_StaffData(w_Int).GiryoBunruiCD = "1" Then
                                    'ﾘｰﾀﾞｰ
                                    w_ForeColor = ColorTranslator.FromOle(m_Leader_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                                ElseIf m_StaffData(w_Int).GiryoBunruiCD = "2" Then
                                    'ｻﾌﾞﾘｰﾀﾞｰ
                                    w_ForeColor = ColorTranslator.FromOle(m_SubLeader_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                                ElseIf m_StaffData(w_Int).GiryoBunruiCD = "3" Then
                                    'ｽﾀｯﾌ
                                    w_ForeColor = ColorTranslator.FromOle(m_Staff_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                                ElseIf m_StaffData(w_Int).GiryoBunruiCD = "4" Then
                                    '新人
                                    w_ForeColor = ColorTranslator.FromOle(m_NewFace_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                                Else
                                    'ERROR
                                    '自動割当対象外 に設定
                                    w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                End If
                            Else
                                If m_StaffData(w_Int).OuenStaffFlg = 1 Then
                                    '応援勤務者の場合
                                    w_ForeColor = ColorTranslator.FromOle(m_Ouen_Name_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Name_Back)
                                Else
                                    '非対象の場合
                                    w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                End If
                            End If
                        Else
                            '非対象の場合
                            w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                        End If

                        If m_MaxShowLine > 1 Then
                            .Cells(w_Row, M_StaffName_Col, w_Row + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                            .Cells(w_Row, M_StaffName_Col, w_Row + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                        Else
                            .Cells(w_Row, M_StaffName_Col).BackColor = w_BackColor
                            .Cells(w_Row, M_StaffName_Col).ForeColor = w_ForeColor
                        End If

                        ReDim w_From_Col(UBound(m_StaffData(w_Int).IdoData))
                        ReDim w_To_Col(UBound(m_StaffData(w_Int).IdoData))

                        For w_Int2 = 1 To UBound(m_StaffData(w_Int).IdoData)
                            '年月日から配属日/転出日の列番号 取得
                            w_Bool = Get_Col_4W(m_StaffData(w_Int).IdoData(w_Int2).IdoYMD, w_From_Col(w_Int2))
                            If w_Bool = True Then
                                If m_StaffData(w_Int).IdoData(w_Int2).SyuryoYMD < m_KeikakuKikan.EndDate Then
                                    w_Bool = Get_Col_4W(m_StaffData(w_Int).IdoData(w_Int2).SyuryoYMD, w_To_Col(w_Int2))
                                Else
                                    w_Bool = Get_Col_4W(m_KeikakuKikan.EndDate, w_To_Col(w_Int2))
                                End If
                            End If
                        Next w_Int2

                        '配属期間外表示色設定
                        For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol

                            w_HaizokuFlg = False
                            If w_Bool = True Then
                                For w_Int2 = 1 To UBound(w_From_Col)
                                    If w_From_Col(w_Int2) <= w_Col AndAlso w_Col <= w_To_Col(w_Int2) Then
                                        '配属期間内のとき
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int2
                            End If

                            '応援勤務者は配属期間外とする
                            If m_StaffData(w_Int).OuenStaffFlg = 1 Then
                                w_HaizokuFlg = False
                            End If

                            If w_HaizokuFlg = True Then
                                '配属期間内のとき
                                w_ForeColor = Color.Black
                                w_BackColor = Color.White
                            Else
                                '配属期間外の時
                                w_ShukeiFlg = False
                                For w_Int2 = 1 To UBound(m_4WeekKikan)
                                    If m_4WeekKikan(w_Int2).PersonalStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_Int2).PersonalEndCol Then
                                        w_ShukeiFlg = True
                                        Exit For
                                    End If
                                Next w_Int2

                                If w_ShukeiFlg = False Then
                                    '４週期間の個人別集計範囲外のとき
                                    w_ForeColor = ColorTranslator.FromOle(m_MonthBefore_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)

                                    w_LastMonthDays = w_LastMonthDays + 1
                                Else
                                    '４週期間の個人別集計範囲内のとき
                                    w_ForeColor = Color.Black
                                    w_BackColor = Color.White
                                End If
                            End If

                            If m_MaxShowLine > 1 Then
                                .Cells(w_Row, w_Col, w_Row + m_MaxShowLine - 1, w_Col).BackColor = w_BackColor
                                .Cells(w_Row, w_Col, w_Row + m_MaxShowLine - 1, w_Col).ForeColor = w_ForeColor
                            Else
                                .Cells(w_Row, w_Col).BackColor = w_BackColor
                                .Cells(w_Row, w_Col).ForeColor = w_ForeColor
                            End If
                        Next w_Col
                    End With
                End If

                With sprPTotal.Sheets(0)
                    'StaffMngID 設定
                    w_Var = DirectCast(m_StaffData(w_Int).ID, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffID).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '採用日 設定
                    w_Var = DirectCast(m_StaffData(w_Int).SaiyoYMD, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SaiyoYMD).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '職種表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).JobHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_JobHyojiNo).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '役職表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).PostHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_PostHyojiNo).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '技量表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).GiryoHyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_GiryoHyojiNo).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '表示No 設定
                    w_Var = DirectCast(m_StaffData(w_Int).HyojiNo, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_StaffHyojiNo).SetCol_PTotal, w_Var)
                    Next w_Int2

                    'ﾁｰﾑ 設定
                    w_Var = Convert.ToString(m_StaffData(w_Int).Team)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_Team).SetCol_PTotal, w_Var)
                    Next w_Int2

                    '職員番号
                    w_Var = DirectCast(m_StaffData(w_Int).PreID, Object)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SyokuinNo).SetCol_PTotal, w_Var)
                    Next w_Int2

                    'ソート用
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        w_Var = DirectCast((m_StaffData(w_Int).HyojiNo - 1) * m_MaxShowLine + w_Int2 + 1, Object)
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_SortTeam).SetCol_PTotal, w_Var)
                    Next w_Int2

                    'ﾃﾞｰﾀ格納配列番号 設定
                    w_Var = Convert.ToString(w_Int)
                    For w_Int2 = 0 To m_MaxShowLine - 1
                        .SetText(w_Row + w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_PTotal, w_Var)
                    Next w_Int2
                End With

                '処理経過ｶｳﾝﾄ
                pPrcessForm.pCountValue = w_Int

                '行数ｶｳﾝﾄ
                w_Row = w_Row + m_MaxShowLine

                If m_LastMonthDays > w_LastMonthDays Then
                    m_LastMonthDays = w_LastMonthDays
                End If
            Next w_Int

            'ﾃﾞｰﾀ行数 終了行 情報 設定
            m_StaffRow.EndRow = w_Row - 1

            '計画画面複数段対応
            m_OuenStaffRow.StartRow = m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine) + 1

            m_OuenStaffRow.EndRow = m_StaffRow.EndRow

            '正常終了
            Get_StaffData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '共通情報 ﾃﾞｰﾀ取得
    Private Function Get_HospitalData() As Boolean
        Const W_SUBNAME As String = "Nskk001 Get_HospitalData"

        Dim w_Sql As String
        Dim w_PlanType As String
        Dim w_ViewType As String
        Dim w_MsgRc As Integer
        Dim w_Rs As ADODB.Recordset
        Dim w_strMsg() As String
        Dim w_開始日_F As ADODB.Field
        Dim w_PlanUnit_F As ADODB.Field
        Dim w_DispPeriod_F As ADODB.Field
        Dim w_Name_F As ADODB.Field
        Dim w_希望回数_F As ADODB.Field
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_希望回数日付別_F As ADODB.Field
        '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
        Try
            '--------------------------------------------------
            '   共通情報 取得
            '--------------------------------------------------
            'Select文 編集
            'RICHARD UPDATE START
            'w_Sql = "SELECT   SYSFROMDAY"
            'w_Sql = w_Sql & ",PLANUNIT "
            'w_Sql = w_Sql & ",DISPPERIOD "
            'w_Sql = w_Sql & ",NAME "
            'w_Sql = w_Sql & ",HOPENUM "
            'w_Sql = w_Sql & ",HOPENUMDATE "
            'w_Sql = w_Sql & "FROM NS_COMMONINFO_M "
            'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_COMMONINFO_M_01(w_Rs) '<13>
            'RICHARD UPDATE END

            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀがないとき
                ReDim w_strMsg(1)
                w_strMsg(1) = "共通情報"
                Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                w_Rs.Close()
                Exit Function
            Else
                With w_Rs
                    'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ生成
                    w_開始日_F = .Fields("SYSFROMDAY")
                    w_PlanUnit_F = .Fields("PLANUNIT")
                    w_DispPeriod_F = .Fields("DISPPERIOD")
                    w_Name_F = .Fields("NAME")
                    w_希望回数_F = .Fields("HOPENUM")
                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    w_希望回数日付別_F = .Fields("HOPENUMDATE")
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                    'SysFromDay
                    m_SystemStartDay = IIf(IsDBNull(w_開始日_F.Value), 0, w_開始日_F.Value)
                    'PlanUnit
                    w_PlanType = IIf(IsDBNull(w_PlanUnit_F.Value), "", w_PlanUnit_F.Value)
                    'DispPeriod
                    w_ViewType = IIf(IsDBNull(w_DispPeriod_F.Value), "", w_DispPeriod_F.Value)
                    'Name
                    General.g_strHospitalNm = IIf(IsDBNull(w_Name_F.Value), "", w_Name_F.Value)
                    '希望回数
                    g_HopeNum = IIf(IsDBNull(w_希望回数_F.Value), 0, w_希望回数_F.Value)
                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    '希望回数(日付別)
                    g_HopeNumDate = IIf(IsDBNull(w_希望回数日付別_F.Value), 0, w_希望回数日付別_F.Value)
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
                    General.g_UseMultiOuenFlg = (General.paGetDbFieldVal(w_Rs.Fields("MULTIOUEN"), "") = "1") '2018/02/27 Yamanishi Add
                End With
            End If

            'ｵﾌﾞｼﾞｪｸﾄを削除
            w_Rs.Close()

            'ﾃﾞｰﾀの妥当性チェック
            'SysFromDay
            If IsDate(Format(m_SystemStartDay, "0000/00/00")) = False Then
                'ﾃﾞｰﾀ不正な場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "システム開始日"
                Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If
            'PlanUnit
            If w_PlanType = "1" Then
                m_PlanType = BasNSK0000H.gePlanType.PlanType_Month '1ヶ月
            ElseIf w_PlanType = "2" Then
                m_PlanType = BasNSK0000H.gePlanType.PlanType_Week '４週
            Else
                ReDim w_strMsg(1)
                w_strMsg(1) = "基準期間"
                Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If
            'DispPeriod
            If w_ViewType = "1" Then
                m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month '１ヶ月
            ElseIf w_ViewType = "2" Then
                m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week '４週
                '任意の場合は、1ヶ月と同じ扱い
            ElseIf w_ViewType = "3" Then
                m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month '任意
            Else
                ReDim w_strMsg(1)
                w_strMsg(1) = "表示期間"
                Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If

            '正常終了
            Get_HospitalData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '看護単位情報 ﾃﾞｰﾀ取得/設定
    Private Function Get_KinmuDeptData() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Get_KinmuDeptData"

        Dim w_MsgRc As Integer
        Dim w_KangoCnt As Integer
        Dim w_Int As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_strMsg() As String
        Try
            '--------------------------------------------------
            ' 勤務部署情報 取得
            '--------------------------------------------------
            '配列初期化
            ReDim m_KangoM(0)

            'システム日付
            w_YYYYMMDD = Integer.Parse(Format(Now, "yyyyMMdd"))

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pKD_KinmuDeptCD = General.g_strSelKinmuDeptCD '勤務部署コード
                .pKD_KijunDate = w_YYYYMMDD '基準日

                If .mGetKinmuDept = False Then
                    'ﾃﾞｰﾀがないとき
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "勤務部署情報"
                    Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                    Exit Function
                Else
                    'ｲﾝﾃﾞｯｸｽ引渡し(1件しかない)
                    .mKD_KinmuDeptIdx = 1
                    '名称取得
                    General.g_strSelKinmuDeptNm = .fKD_KinmuDeptName
                    'ﾁｰﾑ数
                    If .fKD_DivisionFlg = "2" Then
                        m_TeamCnt = .fKD_TeamCount
                    Else
                        m_TeamCnt = 1
                    End If

                    '希望回数制限フラグ
                    g_HopeNumFlg = IIf(IsDBNull(.fKD_HopeNumFlg), "2", .fKD_HopeNumFlg)
                    '2014/05/22 Shimpo add start P-06991-----------------------------------------------------------------------
                    '希望回数(日付別)制限フラグ
                    g_HopeNumDateFlg = IIf(IsDBNull(.fKD_HopeNumDateFlg), "2", .fKD_HopeNumDateFlg)
                    '2014/05/22 Shimpo add end P-06991-------------------------------------------------------------------------

                    '2015/04/13 Bando Add Start ========================
                    g_InputHopeCommentFlg = IIf(IsDBNull(.fKD_InputHopeCommentFlg), "2", .fKD_InputHopeCommentFlg)
                    '2015/04/13 Bando Add End   ========================

                    If .fKD_SaikeiFlg = "1" Then
                        g_SaikeiFlg = True
                    End If
                End If

                '-------------------------------------------------
                '勤務部署全件取得（応援勤務先看護単位名称のため）
                '-------------------------------------------------
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pKD_KinmuDeptCD = "" '空白(全件)
                .pKD_KijunDate = w_YYYYMMDD '基準日

                If .mGetKinmuDept = False Then
                    'ﾃﾞｰﾀがないとき
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "勤務部署情報"
                    Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                    Exit Function
                Else
                    '勤務部署件数取得
                    w_KangoCnt = .fKD_KinmuDeptCount

                    '配列確保
                    ReDim m_KangoM(w_KangoCnt)

                    For w_Int = 1 To w_KangoCnt
                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .mKD_KinmuDeptIdx = w_Int

                        '●勤務部署コード
                        m_KangoM(w_Int).CD = .fKD_KinmuDeptCD
                        '●勤務部署名称
                        m_KangoM(w_Int).Name_Renamed = .fKD_KinmuDeptName
                        '●看護単位略称取得
                        m_KangoM(w_Int).IntegerNm = .fKD_SecName
                    Next w_Int
                End If
            End With

            '正常終了
            Get_KinmuDeptData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '日当直グループ情報 ﾃﾞｰﾀ取得/設定
    Private Function Get_DutyGroupData() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Get_DutyGroupData"

        Dim w_KangoCnt As Integer
        Dim w_Int As Integer
        Dim w_YYYYMMDD As Integer
        Try
            '--------------------------------------------------
            ' 日当直グループ情報 取得
            '--------------------------------------------------
            '配列初期化
            ReDim m_DutyGroupM(0)

            If m_PackageFLG = 0 OrElse m_PackageFLG = 2 Then
                '日当直を使用していない場合

                '正常終了
                Get_DutyGroupData = True

                Exit Function
            End If

            'システム日付
            w_YYYYMMDD = Integer.Parse(Format(Now, "yyyyMMdd"))

            With General.g_objGetMaster
                '-------------------------------------------------
                '日当直グループ全件取得
                '-------------------------------------------------
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pDG_GROUPCD = "" '空白(全件)
                .pDG_KijunDate = w_YYYYMMDD '基準日

                If .mGetDutyGroup = False Then
                    'ﾃﾞｰﾀがないとき
                    '日当直なしにする
                    m_PackageFLG = m_PackageFLG - 1 'パッケージマスタ(0:届出×日当直×,1:届出×日当直○,2:届出○日当直×,3:届出○日当直○)
                    m_MaxShowLine = m_MaxShowLine - 1 '最大表示段数

                    m_DutyData = -1
                    m_KinmuPlan = -1
                    m_KinmuJisseki = -1
                    m_AppliData = -1

                    m_blnJissekiUseFlg = False
                    m_blnAppliUseFlg = False

                    'パッケージマスタ
                    Select Case m_PackageFLG
                        Case 0 '0:届出×日当直×
                            m_KinmuPlan = 0
                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                m_KinmuJisseki = 1
                            End If
                        Case 2 '2:届出○日当直×
                            m_KinmuPlan = 0
                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                m_KinmuJisseki = 1
                                m_AppliData = 2
                            Else
                                m_AppliData = 1
                            End If
                            m_blnAppliUseFlg = True
                    End Select
                Else
                    '日当直グループ件数取得
                    w_KangoCnt = .fDG_DataCount

                    '配列確保
                    ReDim m_DutyGroupM(w_KangoCnt)

                    For w_Int = 1 To w_KangoCnt
                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .mDG_DataIdx = w_Int

                        '●日当直グループコード
                        m_DutyGroupM(w_Int).CD = .fDG_GroupCD
                        '●日当直グループ名称
                        m_DutyGroupM(w_Int).Name_Renamed = .fDG_GroupName
                        '●日当直グループ略称取得
                        m_DutyGroupM(w_Int).IntegerNm = .fDG_SecName
                    Next w_Int
                End If
            End With

            '正常終了
            Get_DutyGroupData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '届出情報 ﾃﾞｰﾀ取得/設定
    Private Function Get_AppliCationData() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Get_AppliCationData"

        Dim w_MsgRc As Integer
        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_KangoCnt As Integer
        Dim w_Int As Integer
        Dim w_strMsg() As String
        Dim w_CD_F As ADODB.Field
        Dim w_Name_F As ADODB.Field
        Dim w_SName_F As ADODB.Field
        Try
            '--------------------------------------------------
            ' 届出情報 取得
            '--------------------------------------------------
            '配列初期化
            ReDim m_AppliCationM(0)

            If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                '届出を使用していない場合

                '正常終了
                Get_AppliCationData = True

                Exit Function
            End If

            '-------------------------------------------------
            '届出マスタ全件取得
            '-------------------------------------------------
            w_strSql = "Select AppliCD , Name , SecName "
            w_strSql = w_strSql & "From NS_APPLICATION_M "
            w_strSql = w_strSql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
            w_strSql = w_strSql & "Order By DispNo "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ 生成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀがないとき
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "届出情報"
                    Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                    Exit Function
                Else
                    '届出マスタ件数取得
                    .MoveLast()
                    w_KangoCnt = .RecordCount
                    .MoveFirst()

                    '配列確保
                    ReDim m_AppliCationM(w_KangoCnt)

                    w_CD_F = .Fields("AppliCD")
                    w_Name_F = .Fields("Name")
                    w_SName_F = .Fields("SecName")

                    For w_Int = 1 To w_KangoCnt
                        '●届出コード
                        m_AppliCationM(w_Int).CD = w_CD_F.Value
                        '●届出名称
                        m_AppliCationM(w_Int).Name_Renamed = IIf(IsDBNull(w_Name_F.Value), "", w_Name_F.Value)
                        '●届出略称取得
                        m_AppliCationM(w_Int).IntegerNm = IIf(IsDBNull(w_SName_F.Value), "", w_SName_F.Value)

                        .MoveNext()
                    Next w_Int
                End If
            End With

            '正常終了
            Get_AppliCationData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function
    '2017/11/21 Yamanishi Add Start -----------------------------------------------------------------------------
    ''*****************************************************************************************************
    ''   ｽﾌﾟﾚｯﾄﾞの時間年休文字列を各データ毎に分割する
    ''   ﾊﾟﾗﾒｰﾀ：p_Str(I)（時間年休文字列）
    ''           p_NenkyuDetail(O)（時間年休詳細情報）
    ''   編集仕様
    ''       休み分類ｺｰﾄﾞ(2)＋時間FROM(4)＋時間TO(4)＋翌日FLG(1)＋２件目(休み分類ｺｰﾄﾞ(2)＋時間FROM(4)＋時間TO(4)＋翌日FLG(1))＋３件目以降・・・
    ''       全１１バイト×件数分
    ''           1) 休み分類CD---１ﾊﾞｲﾄ目から２ﾊﾞｲﾄ分（Trimで余分なｽﾍﾟｰｽを省く）
    ''           2) 取得内容区分---34ﾊﾞｲﾄ目から１ﾊﾞｲﾄ分
    ''               （"1":全日、"2":前半、"3":後半、"4":時間年休）
    ''           3) 時間FROM---３ﾊﾞｲﾄ目から４ﾊﾞｲﾄ分
    ''           4) 時間TO---７ﾊﾞｲﾄ目から４ﾊﾞｲﾄ分
    ''           5) 翌日FLG---11ﾊﾞｲﾄ目から１ﾊﾞｲﾄ分
    ''           6) ２件目以降---12ﾊﾞｲﾄ目から11バイト分
    ''*****************************************************************************************************
    'Private Sub Get_NenkyuDetail(ByVal p_Str As String, ByVal p_Str2 As String, ByRef p_NenkyuDetail() As NenkyuDetail_Type, ByVal p_HolCD As String)
    '    Const W_SUBNAME As String = "NSK0000HA Get_NenkyuDetail"

    '    Dim w_Loop As Integer
    '    Dim w_Index As Integer
    '    Dim w_RecCnt As Integer
    '    Dim w_Pos As Integer
    '    Dim w_StartTime As String 'FromTime
    '    Dim w_EndTime As String 'ToTime
    '    Dim w_NenkyuTime As Integer '時間年休
    '    Dim w_DayTime As Integer '日勤時間
    '    Dim w_NightTime As Integer '夜勤時間
    '    Dim w_NextNightTime As Integer '翌日夜勤時間
    '    Dim w_obj As Object
    '    Try
    '        '時間年休がある時のみ
    '        If p_Str <> "" Then
    '            '時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
    '            w_RecCnt = Len(p_Str) / 28
    '            w_Index = UBound(p_NenkyuDetail)
    '            ReDim Preserve p_NenkyuDetail(w_Index + w_RecCnt)

    '            w_Pos = 1

    '            'ｽﾌﾟﾚｯﾄﾞ貼り付け文字列を分割する
    '            For w_Loop = 1 To w_RecCnt
    '                '取得内容区分(4:時間年休)
    '                p_NenkyuDetail(w_Index + w_Loop).GetContentsKbn = "4"

    '                'HolidayBunruiCD
    '                p_NenkyuDetail(w_Index + w_Loop).HolidayBunruiCD = Mid(p_Str, w_Pos, 2)

    '                w_Pos = w_Pos + 2

    '                'FromTime
    '                w_StartTime = Mid(p_Str, w_Pos, 4)
    '                If IsNumeric(w_StartTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).FromTime = Integer.Parse(w_StartTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).FromTime = 0
    '                End If

    '                w_Pos = w_Pos + 4

    '                'ToTime
    '                w_EndTime = Mid(p_Str, w_Pos, 4)
    '                If IsNumeric(w_EndTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).ToTime = Integer.Parse(w_EndTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).ToTime = 0
    '                End If

    '                w_Pos = w_Pos + 4

    '                'DateKbn
    '                p_NenkyuDetail(w_Index + w_Loop).DateKbn = Mid(p_Str, w_Pos, 1)

    '                w_Pos = w_Pos + 1

    '                '時間年休
    '                w_NenkyuTime = Integer.Parse(Mid(p_Str, w_Pos, 4))
    '                If IsNumeric(w_NenkyuTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).NenkyuTime = Integer.Parse(w_NenkyuTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).NenkyuTime = 0
    '                End If

    '                w_Pos = w_Pos + 4

    '                '休憩減算フラグ
    '                p_NenkyuDetail(w_Index + w_Loop).HolSubFlg = Mid(p_Str, w_Pos, 1)

    '                w_Pos = w_Pos + 1

    '                '日勤時間
    '                w_DayTime = Integer.Parse(Mid(p_Str, w_Pos, 4))
    '                If IsNumeric(w_DayTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).DayTime = Integer.Parse(w_DayTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).DayTime = 0
    '                End If

    '                w_Pos = w_Pos + 4

    '                '夜勤時間
    '                w_NightTime = Integer.Parse(Mid(p_Str, w_Pos, 4))
    '                If IsNumeric(w_NightTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).NightTime = Integer.Parse(w_NightTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).NightTime = 0
    '                End If

    '                w_Pos = w_Pos + 4

    '                '翌日夜勤時間
    '                w_NextNightTime = Integer.Parse(Mid(p_Str, w_Pos, 4))
    '                If IsNumeric(w_NextNightTime) Then
    '                    p_NenkyuDetail(w_Index + w_Loop).NextNightTime = Integer.Parse(w_NextNightTime)
    '                Else
    '                    p_NenkyuDetail(w_Index + w_Loop).NextNightTime = 0
    '                End If

    '                w_Pos = w_Pos + 4
    '            Next w_Loop
    '        End If

    '        '全半日年休がある時のみ
    '        If p_Str2 <> "" Then
    '            '年休件数取得
    '            w_Index = UBound(p_NenkyuDetail)

    '            If p_Str2 = "2,3" Then
    '                w_obj = General.paSplit(p_HolCD, ",")
    '                ReDim Preserve p_NenkyuDetail(w_Index + 2)
    '                '取得内容区分
    '                p_NenkyuDetail(w_Index + 1).GetContentsKbn = "2"
    '                'HolidayBunruiCD
    '                p_NenkyuDetail(w_Index + 1).HolidayBunruiCD = w_obj(0)
    '                'FromTime
    '                p_NenkyuDetail(w_Index + 1).FromTime = 0
    '                'ToTime
    '                p_NenkyuDetail(w_Index + 1).ToTime = 0
    '                'DateKbn
    '                p_NenkyuDetail(w_Index + 1).DateKbn = "0"
    '                '取得内容区分
    '                p_NenkyuDetail(w_Index + 2).GetContentsKbn = "3"
    '                'HolidayBunruiCD
    '                p_NenkyuDetail(w_Index + 2).HolidayBunruiCD = w_obj(1)
    '                'FromTime
    '                p_NenkyuDetail(w_Index + 2).FromTime = 0
    '                'ToTime
    '                p_NenkyuDetail(w_Index + 2).ToTime = 0
    '                'DateKbn
    '                p_NenkyuDetail(w_Index + 2).DateKbn = "0"
    '            Else
    '                ReDim Preserve p_NenkyuDetail(w_Index + 1)
    '                '取得内容区分
    '                p_NenkyuDetail(w_Index + 1).GetContentsKbn = p_Str2
    '                'HolidayBunruiCD
    '                p_NenkyuDetail(w_Index + 1).HolidayBunruiCD = p_HolCD
    '                'FromTime
    '                p_NenkyuDetail(w_Index + 1).FromTime = 0
    '                'ToTime
    '                p_NenkyuDetail(w_Index + 1).ToTime = 0
    '                'DateKbn
    '                p_NenkyuDetail(w_Index + 1).DateKbn = "0"
    '            End If
    '        End If

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
    '        End
    '    End Try
    'End Sub
    '2017/11/21 Yamanishi Add End -------------------------------------------------------------------------------
    '集計項目/集計対象勤務の取得
    Private Sub Get_Matrix()

        Const W_SUBNAME As String = "NSK0000HA Get_Matrix"

        Dim w_i As Integer
        Dim w_RecCnt As Integer 'ﾚｺｰﾄﾞ･ｶｳﾝﾄ
        'ﾏﾄﾘｯｸｽ別 変数
        Dim w_SumID As String '集計ID
        Dim w_SumID2 As String '４週用集計ID
        'ﾌｨｰﾙﾄﾞ･ｵﾌﾞｼﾞｪｸﾄ
        Dim w_str As String
        Dim w_Var As Object
        Dim w_j As Integer
        Dim w_CntKbn As String
        Dim w_CntFlg As Boolean
        Dim w_Cnt As Integer
        Dim w_DataCnt As Integer
        Try
            '再掲部署の場合、部署CDが集計IDとする
            w_SumID = g_AppName
            w_SumID2 = g_AppName & "4W"

            '各配列の初期化
            ReDim m_VMtrx(0) '日別ﾏﾄﾘｯｸｽ･･･縦軸
            ReDim m_HMtrx(0) '個人別 〃 ･･･横軸
            ReDim m_HMtrx_4Week(0) '4週個人別 〃 ･･･横軸

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pMtrx_SumID = w_SumID '集計ID
                .pMtrx_KinmuDeptCD = General.g_strSelKinmuDeptCD '勤務部署コード
                .pMtrx_ZokuseiKbn = 0 '0:両方 1:職種 2:役職

                '取得実行
                If .mGetMatrix = False Then
                Else
                    'ﾃﾞｰﾀが存在した場合

                    '縦集計件数取得
                    w_RecCnt = .fMtrx_VSumCount

                    'ﾏﾄﾘｯｸｽ配列 一時的に確保
                    w_DataCnt = 0

                    '_/_/ 縦集計分 繰り返し（日別集計）_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                    For w_i = 1 To w_RecCnt
                        .mMtrx_VSumIdx = w_i '--- ｲﾝﾃﾞｯｸｽ引渡し

                        If .fMtrx_VSumDispFlg = "1" Then
                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve m_VMtrx(w_DataCnt)
                            m_VMtrx(w_DataCnt).MtrxName = .fMtrx_VSumName
                            m_VMtrx(w_DataCnt).BunruiCD = .fMtrx_VSumBunruiCD
                            m_VMtrx(w_DataCnt).CalcKinmuStr = .fMtrx_VSumKinmuCD
                            w_str = .fMtrx_VSumHiritsu
                            If Trim(w_str) <> "" Then
                                w_Var = General.paSplit(w_str, ",")

                                '集計比率配列確保
                                ReDim m_VMtrx(w_DataCnt).Ratio(UBound(w_Var))

                                '集計比率格納
                                For w_j = 1 To UBound(w_Var)
                                    m_VMtrx(w_DataCnt).Ratio(w_j) = Single.Parse(w_Var(w_j - 1))
                                Next w_j
                            End If
                            '集計対象外者の職種、役職CDを格納
                            m_VMtrx(w_DataCnt).CalcJobStr = .fMtrx_VSumZokuseiJobCD
                            m_VMtrx(w_DataCnt).CalcPostStr = .fMtrx_VSumZokuseiPostCD
                        End If
                    Next w_i

                    If m_lngRowFrozen = 0 Then
                        m_lngRowFrozen = UBound(m_VMtrx)
                    End If

                    '横集計件数取得
                    w_RecCnt = .fMtrx_HSumCount

                    'ﾏﾄﾘｯｸｽ配列 一時的に確保
                    w_DataCnt = 0

                    '_/_/ 横集計分 繰り返し（個人別集計）_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                    For w_i = 1 To w_RecCnt
                        .mMtrx_HSumIdx = w_i '--- ｲﾝﾃﾞｯｸｽ引渡し

                        If .fMtrx_HSumDispFlg = "1" Then
                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve m_HMtrx(w_DataCnt)
                            m_HMtrx(w_DataCnt).CntKbn = .fMtrx_HSumKbn
                            m_HMtrx(w_DataCnt).MtrxName = .fMtrx_HSumName
                            If m_HMtrx(w_DataCnt).CntKbn = "1" OrElse
                                    m_HMtrx(w_DataCnt).CntKbn = "6" OrElse
                                    m_HMtrx(w_DataCnt).CntKbn = "8" Then
                                m_HMtrx(w_DataCnt).BunruiCD = .fMtrx_HSumBunruiCD
                                m_HMtrx(w_DataCnt).CalcKinmuStr = .fMtrx_HSumKinmuCD
                                w_str = .fMtrx_HSumHiritsu
                                If Trim(w_str) <> "" Then
                                    w_Var = General.paSplit(w_str, ",")

                                    '集計比率配列確保
                                    ReDim m_HMtrx(w_DataCnt).Ratio(UBound(w_Var))

                                    '集計比率格納
                                    For w_j = 1 To UBound(w_Var)
                                        m_HMtrx(w_DataCnt).Ratio(w_j) = Single.Parse(w_Var(w_j - 1))
                                    Next w_j
                                End If
                            End If
                        End If
                    Next w_i
                End If

                '------------------
                '集計ID(4週用)
                '------------------
                w_Cnt = 0
                .pMtrx_SumID = w_SumID2 '集計ID

                If .mGetMatrix = False Then
                Else

                    '横集計件数取得
                    w_RecCnt = .fMtrx_HSumCount

                    'ﾃﾞｰﾀｶｳﾝﾄ初期化
                    w_DataCnt = 0

                    '_/_/ 横集計分 繰り返し（個人別集計）_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                    For w_i = 1 To w_RecCnt
                        .mMtrx_HSumIdx = w_i '--- ｲﾝﾃﾞｯｸｽ引渡し

                        '1ヶ月/4週の場合で累計以外を配列に格納
                        w_CntKbn = .fMtrx_HSumKbn

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            If w_CntKbn = "3" Then
                                w_CntFlg = False
                            Else
                                w_CntFlg = True
                            End If
                        Else
                            w_CntFlg = True
                        End If

                        If w_CntFlg = True AndAlso .fMtrx_HSumDispFlg = "1" Then
                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve m_HMtrx_4Week(w_DataCnt)

                            m_HMtrx_4Week(w_DataCnt).CntKbn = .fMtrx_HSumKbn
                            m_HMtrx_4Week(w_DataCnt).MtrxName = .fMtrx_HSumName

                            If m_HMtrx_4Week(w_DataCnt).CntKbn = "1" OrElse
                                    m_HMtrx_4Week(w_DataCnt).CntKbn = "6" OrElse
                                    m_HMtrx_4Week(w_DataCnt).CntKbn = "8" Then
                                m_HMtrx_4Week(w_DataCnt).BunruiCD = .fMtrx_HSumBunruiCD
                                m_HMtrx_4Week(w_DataCnt).CalcKinmuStr = .fMtrx_HSumKinmuCD
                                w_str = .fMtrx_HSumHiritsu

                                If Trim(w_str) <> "" Then
                                    w_Var = General.paSplit(w_str, ",")

                                    '集計比率配列確保
                                    ReDim m_HMtrx_4Week(w_DataCnt).Ratio(UBound(w_Var))

                                    '集計比率格納
                                    For w_j = 1 To UBound(w_Var)
                                        m_HMtrx_4Week(w_DataCnt).Ratio(w_j) = Single.Parse(w_Var(w_j - 1))
                                    Next w_j
                                End If
                            End If
                        End If
                    Next w_i
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Get_UseFlg(ByRef p_blnDutyUseFlg As Boolean, ByRef p_blnJissekiUseFlg As Boolean, ByRef p_blnAppliUseFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Get_UseFlg"
        Try
            p_blnDutyUseFlg = False
            p_blnJissekiUseFlg = False
            p_blnAppliUseFlg = False

            'パッケージマスタ
            Select Case m_PackageFLG
                Case 0 '0:届出×日当直×
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnJissekiUseFlg = True
                        End If
                    End If
                Case 1 '1:届出×日当直○
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnJissekiUseFlg = True
                        ElseIf m_lstmnuKinmuView(2).Checked Then
                            p_blnDutyUseFlg = True
                            p_blnJissekiUseFlg = True
                        End If
                    Else
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnDutyUseFlg = True
                        End If
                    End If
                Case 2 '2:届出○日当直×
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnJissekiUseFlg = True
                        ElseIf m_lstmnuKinmuView(2).Checked Then
                            p_blnJissekiUseFlg = True
                            p_blnAppliUseFlg = True
                        End If
                    Else
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnAppliUseFlg = True
                        End If
                    End If
                Case 3 '3:届出○日当直○
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_lstmnuKinmuView(1).Checked Then
                            p_blnJissekiUseFlg = True
                        ElseIf m_lstmnuKinmuView(2).Checked Then
                            p_blnJissekiUseFlg = True
                            If m_AppliData <= m_DutyData Then
                                p_blnAppliUseFlg = True
                            Else
                                p_blnDutyUseFlg = True
                            End If
                        ElseIf m_lstmnuKinmuView(3).Checked Then
                            p_blnDutyUseFlg = True
                            p_blnJissekiUseFlg = True
                            p_blnAppliUseFlg = True
                        End If
                    Else
                        If m_lstmnuKinmuView(1).Checked Then
                            If m_AppliData <= m_DutyData Then
                                p_blnAppliUseFlg = True
                            Else
                                p_blnDutyUseFlg = True
                            End If
                        ElseIf m_lstmnuKinmuView(2).Checked Then
                            p_blnDutyUseFlg = True
                            p_blnAppliUseFlg = True
                        End If
                    End If
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '夜間看護加算計算用　役職CD＆職種CDを取得
    Private Sub Get_YakanKangoData(ByVal p_Index As Integer)

        Const W_SUBNAME As String = "NSK0000HA Get_YakanKangoData"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_RecCnt As Integer
        Dim w_lngDate As Integer
        Dim w_StartIdx As Integer
        Dim w_HairetuIdx As Integer
        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Rs2 As ADODB.Recordset
        Dim w_PostCD_F As ADODB.Field
        Dim w_JobCD_F As ADODB.Field
        Dim w_EmpCD_F As ADODB.Field
        Dim w_NIGHTONLYSTAFFKBN_F As ADODB.Field
        Dim w_CalcFrom As Integer
        Dim w_CalcTo As Integer
        Dim w_Day As Integer
        Dim w_TargetFlg As Boolean
        Dim w_EmpHisData() As Date_Type

        Try
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    ReDim m_StaffData(p_Index).KangoKasanData(UBound(m_4WeekKikan) + 1)
                Else
                    ReDim m_StaffData(p_Index).KangoKasanData(UBound(m_4WeekKikan)) '４週期間配列の内、実績期間のものはいらない（４週期間数－１＋計画期間）
                End If
            Else
                ReDim m_StaffData(p_Index).KangoKasanData(1)
            End If

            For w_Int = 1 To UBound(m_StaffData(p_Index).IdoData)
                If m_SortIdx = 0 Then
                    If m_StaffData(p_Index).IdoData(w_Int).IdoYMD <= m_KeikakuKikan.EndDate AndAlso m_StaffData(p_Index).IdoData(w_Int).SyuryoYMD >= m_KeikakuKikan.StartDate Then
                        w_lngDate = m_StaffData(p_Index).IdoData(w_Int).IdoYMD

                        If w_lngDate < m_KeikakuKikan.StartDate Then
                            w_lngDate = m_KeikakuKikan.StartDate
                        End If

                        Exit For
                    End If
                Else
                    If m_StaffData(p_Index).IdoData(w_Int).IdoYMD <= m_KeikakuKikan.EndDate AndAlso m_StaffData(p_Index).IdoData(w_Int).SyuryoYMD >= m_KeikakuKikan.StartDate Then
                        w_lngDate = m_StaffData(p_Index).IdoData(w_Int).SyuryoYMD

                        If w_lngDate > m_KeikakuKikan.EndDate Then
                            w_lngDate = m_KeikakuKikan.EndDate
                        End If
                    End If
                End If
            Next w_Int

            m_StaffData(p_Index).KangoKasanData(1).JobCD = ""
            m_StaffData(p_Index).KangoKasanData(1).PostCD = ""
            m_StaffData(p_Index).KangoKasanData(1).SaiyoCD = ""
            m_StaffData(p_Index).KangoKasanData(1).YakinKBN = "1"
            m_StaffData(p_Index).KangoKasanData(1).ChildShort = False

            '*********************
            '役職情報
            '*********************
            w_strSql = ""
            w_strSql = "select PostCD"
            w_strSql = w_strSql & " from NS_POSTIDOINFO_F"
            w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
            w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
            w_strSql = w_strSql & " and IdoDate <= " & w_lngDate
            w_strSql = w_strSql & " order by IdoDate desc"

            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then
            Else
                With w_Rs

                    .MoveLast()
                    w_RecCnt = .RecordCount
                    .MoveFirst()

                    w_PostCD_F = .Fields("PostCD") '役職CD

                    '役職CD
                    m_StaffData(p_Index).KangoKasanData(1).PostCD = w_PostCD_F.Value & ""
                End With
            End If

            w_Rs.Close()
            w_Rs = Nothing

            '*********************
            '職種情報
            '*********************
            w_strSql = ""
            w_strSql = "select JobCD"
            w_strSql = w_strSql & " from NS_JOBIDOINFO_F"
            w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
            w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
            w_strSql = w_strSql & " and IdoDate <= " & w_lngDate
            w_strSql = w_strSql & " order by IdoDate desc"

            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then
            Else
                With w_Rs

                    .MoveLast()
                    w_RecCnt = .RecordCount
                    .MoveFirst()

                    w_JobCD_F = .Fields("JobCD") '職種CD

                    '職種CD
                    m_StaffData(p_Index).KangoKasanData(1).JobCD = w_JobCD_F.Value & ""
                End With
            End If

            w_Rs.Close()
            w_Rs = Nothing

            '*********************
            '採用CD
            '*********************
            w_strSql = ""
            w_strSql = "select EmpCD"
            w_strSql = w_strSql & " from NS_STAFFMNGHISTORY_F"
            w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
            w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
            w_strSql = w_strSql & " and EmpDate <= " & w_lngDate
            w_strSql = w_strSql & " order by EmpDate desc"

            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then
            Else
                With w_Rs

                    .MoveLast()
                    w_RecCnt = .RecordCount
                    .MoveFirst()

                    w_EmpCD_F = .Fields("EmpCD") '採用条件CD

                    '採用条件CD
                    m_StaffData(p_Index).KangoKasanData(1).SaiyoCD = w_EmpCD_F.Value & ""
                End With
            End If

            w_Rs.Close()
            w_Rs = Nothing

            '*********************
            '育児短時間判定
            '*********************
            w_Day = 0
            w_TargetFlg = False
            ReDim w_EmpHisData(0)

            With General.g_objIdoData
                .pHospitalCD = General.g_strHospitalCD
                .pStaffMngID = m_StaffData(p_Index).ID
                .pDateFlg = 1
                .pDateFrom = m_KeikakuKikan.StartDate
                .pDateTo = m_KeikakuKikan.EndDate
                .pSortFlg = 0

                If .mGetSaiyoIdo Then
                    ReDim w_EmpHisData(.fSI_SaiyoCount)

                    For i As Integer = 1 To .fSI_SaiyoCount
                        .mSI_SaiyoIdx = i

                        w_CalcFrom = .fSI_EmpDate
                        If w_CalcFrom < m_KeikakuKikan.StartDate Then
                            w_CalcFrom = m_KeikakuKikan.StartDate
                        End If
                        w_CalcTo = .fSI_RetireDate
                        If w_CalcTo > m_KeikakuKikan.EndDate Then
                            w_CalcTo = m_KeikakuKikan.EndDate
                        End If

                        w_EmpHisData(i).StartDate = w_CalcFrom
                        w_EmpHisData(i).EndDate = w_CalcTo

                        '短時間判定処理
                        If Not String.IsNullOrEmpty(.fSI_EmpCD) AndAlso
                                InStr(m_ChildShortEmpCD, .fSI_EmpCD) > 0 Then
                            '育児短時間対象採用の場合
                            If m_NightShortJudgeKBN = "0" AndAlso i = 1 Then
                                w_TargetFlg = True
                                w_CalcFrom = .fSI_EmpDate
                                If w_CalcFrom < m_KeikakuKikan.StartDate Then
                                    w_CalcFrom = m_KeikakuKikan.StartDate
                                End If

                                Exit For
                            ElseIf m_NightShortJudgeKBN = "1" AndAlso i = .fSI_SaiyoCount Then
                                w_TargetFlg = True
                                w_CalcTo = .fSI_RetireDate
                                If w_CalcTo > m_KeikakuKikan.EndDate Then
                                    w_CalcTo = m_KeikakuKikan.EndDate
                                End If

                                Exit For
                            ElseIf m_NightShortJudgeKBN = "2" Then
                                w_Day = w_Day + DateDiff(DateInterval.Day,
                                        Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1
                            End If
                        End If
                    Next

                    If (m_NightShortJudgeKBN = "2" AndAlso w_Day >= m_NightShortJudgeDay) OrElse w_TargetFlg Then
                        m_StaffData(p_Index).KangoKasanData(1).ChildShort = True
                    End If
                End If
            End With

            w_Day = 0
            With General.g_objIdoData
                .pHospitalCD = General.g_strHospitalCD
                .pStaffMngID = m_StaffData(p_Index).ID
                .pDateFlg = 1
                .pSortFlg = 0

                Select Case m_NightShortJudgeKBN
                    Case "0"
                        '月初
                        .pDateFrom = w_CalcFrom
                        .pDateTo = w_CalcFrom
                    Case "1"
                        '月末
                        .pDateFrom = w_CalcTo
                        .pDateTo = w_CalcTo
                    Case "2"
                        '日数
                        .pDateFrom = m_KeikakuKikan.StartDate
                        .pDateTo = m_KeikakuKikan.EndDate
                End Select

                If .mGetShortTimeIdo Then
                    If m_NightShortJudgeKBN = "2" Then
                        '日数

                        '日数計算を行う
                        For i As Integer = 1 To .fST_ShortTimeCount
                            .mST_ShortTimeIdx = i

                            If InStr(m_ChildShortReasonCD, General.paFormatSpace(.fST_ReasonCd, 5)) > 0 Then
                                For j As Integer = 1 To UBound(w_EmpHisData)
                                    If w_EmpHisData(j).StartDate < .fST_DateFrom Then
                                        w_CalcFrom = .fST_DateFrom
                                    Else
                                        w_CalcFrom = w_EmpHisData(j).StartDate
                                    End If
                                    If w_EmpHisData(j).EndDate < .fST_DateTo Then
                                        w_CalcTo = w_EmpHisData(j).EndDate
                                    Else
                                        w_CalcTo = .fST_DateTo
                                    End If

                                    w_Day = w_Day + DateDiff(DateInterval.Day,
                                            Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1

                                    If w_Day >= m_NightShortJudgeDay Then
                                        '指定の日数に達した場合、育児短時間
                                        m_StaffData(p_Index).KangoKasanData(1).ChildShort = True
                                        Exit For
                                    End If
                                Next

                                If m_StaffData(p_Index).KangoKasanData(1).ChildShort Then
                                    Exit For
                                End If
                            End If
                        Next
                    Else
                        '月初,月末
                        For i As Integer = 1 To .fST_ShortTimeCount
                            .mST_ShortTimeIdx = i

                            If InStr(m_ChildShortReasonCD, General.paFormatSpace(.fST_ReasonCd, 5)) > 0 Then
                                'データがあれば、育児短時間
                                m_StaffData(p_Index).KangoKasanData(1).ChildShort = True
                            End If
                        Next
                    End If
                End If
            End With

            '*********************
            '夜間専従者区分
            '*********************
            w_Day = 0
            With General.g_objIdoData
                .pHospitalCD = General.g_strHospitalCD
                .pStaffMngID = m_StaffData(p_Index).ID
                .pDateFlg = 1
                .pSortFlg = 0

                Select Case m_NightShortJudgeKBN
                    Case "0"
                        '月初
                        .pDateFrom = w_CalcFrom
                        .pDateTo = w_CalcFrom
                    Case "1"
                        '月末
                        .pDateFrom = w_CalcTo
                        .pDateTo = w_CalcTo
                    Case "2"
                        '日数
                        .pDateFrom = m_KeikakuKikan.StartDate
                        .pDateTo = m_KeikakuKikan.EndDate
                End Select

                If .mGetNightWorkerIdo Then
                    If m_NightShortJudgeKBN = "2" Then
                        '日数

                        '日数計算を行う
                        For i As Integer = 1 To .fNW_NightWorkerCount
                            .mNW_NightWorkerIdx = i

                            For j As Integer = 1 To UBound(w_EmpHisData)
                                If w_EmpHisData(j).StartDate < .fNW_DateFrom Then
                                    w_CalcFrom = .fNW_DateFrom
                                Else
                                    w_CalcFrom = w_EmpHisData(j).StartDate
                                End If
                                If w_EmpHisData(j).EndDate < .fNW_DateTo Then
                                    w_CalcTo = w_EmpHisData(j).EndDate
                                Else
                                    w_CalcTo = .fNW_DateTo
                                End If

                                w_Day = w_Day + DateDiff(DateInterval.Day,
                                        Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1

                                If w_Day >= m_NightShortJudgeDay Then
                                    '指定の日数に達した場合、夜専
                                    m_StaffData(p_Index).KangoKasanData(1).YakinKBN = "0"
                                    Exit For
                                End If
                            Next

                            If m_StaffData(p_Index).KangoKasanData(1).YakinKBN = "0" Then
                                Exit For
                            End If
                        Next
                    Else
                        '月初,月末
                        If .fNW_NightWorkerCount > 0 Then
                            'データがあれば、夜専
                            m_StaffData(p_Index).KangoKasanData(1).YakinKBN = "0"
                        End If
                    End If
                End If
            End With

            '勤務変更の場合は４週期間のﾙｰﾌﾟを１から　それ以外の場合は２から（実績期間はカウント不要のため）
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                w_StartIdx = 1
            Else
                w_StartIdx = 2
            End If

            For w_Int = w_StartIdx To UBound(m_4WeekKikan)
                For w_Int2 = 1 To UBound(m_StaffData(p_Index).IdoData)
                    If m_SortIdx = 0 Then
                        If m_StaffData(p_Index).IdoData(w_Int2).IdoYMD <= m_4WeekKikan(w_Int).EndDate AndAlso m_StaffData(p_Index).IdoData(w_Int2).SyuryoYMD >= m_4WeekKikan(w_Int).StartDate Then
                            w_lngDate = m_StaffData(p_Index).IdoData(w_Int2).IdoYMD

                            If w_lngDate < m_4WeekKikan(w_Int).StartDate Then
                                w_lngDate = m_4WeekKikan(w_Int).StartDate
                            End If

                            Exit For
                        End If
                    Else
                        If m_StaffData(p_Index).IdoData(w_Int2).IdoYMD <= m_4WeekKikan(w_Int).EndDate AndAlso m_StaffData(p_Index).IdoData(w_Int2).SyuryoYMD >= m_4WeekKikan(w_Int).StartDate Then
                            w_lngDate = m_StaffData(p_Index).IdoData(w_Int2).SyuryoYMD

                            If w_lngDate > m_4WeekKikan(w_Int).EndDate Then
                                w_lngDate = m_4WeekKikan(w_Int).EndDate
                            End If
                        End If
                    End If
                Next w_Int2

                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    w_HairetuIdx = w_Int + 1
                Else
                    w_HairetuIdx = w_Int
                End If

                m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).JobCD = ""
                m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).PostCD = ""
                m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).SaiyoCD = ""
                m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).YakinKBN = "1"

                '*********************
                '役職情報
                '*********************
                w_strSql = ""
                w_strSql = "select PostCD"
                w_strSql = w_strSql & " from NS_POSTIDOINFO_F"
                w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
                w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
                w_strSql = w_strSql & " and IdoDate <= " & w_lngDate
                w_strSql = w_strSql & " order by IdoDate desc"

                'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
                w_Rs = General.paDBRecordSetOpen(w_strSql)

                If w_Rs.RecordCount <= 0 Then
                Else
                    With w_Rs

                        .MoveLast()
                        w_RecCnt = .RecordCount
                        .MoveFirst()

                        w_PostCD_F = .Fields("PostCD") '役職CD

                        '役職CD
                        m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).PostCD = w_PostCD_F.Value & ""
                    End With
                End If

                w_Rs.Close()
                w_Rs = Nothing

                '*********************
                '職種情報
                '*********************
                w_strSql = ""
                w_strSql = "select JobCD"
                w_strSql = w_strSql & " from NS_JOBIDOINFO_F"
                w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
                w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
                w_strSql = w_strSql & " and IdoDate <= " & w_lngDate
                w_strSql = w_strSql & " order by IdoDate desc"

                'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
                w_Rs = General.paDBRecordSetOpen(w_strSql)

                If w_Rs.RecordCount <= 0 Then
                Else
                    With w_Rs

                        .MoveLast()
                        w_RecCnt = .RecordCount
                        .MoveFirst()

                        w_JobCD_F = .Fields("JobCD") '職種CD

                        '職種CD
                        m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).JobCD = w_JobCD_F.Value & ""
                    End With
                End If

                w_Rs.Close()
                w_Rs = Nothing

                '*********************
                '採用CD
                '*********************
                w_strSql = ""
                w_strSql = "select EmpCD"
                w_strSql = w_strSql & " from NS_STAFFMNGHISTORY_F"
                w_strSql = w_strSql & " where HospitalCD = '" & Trim(General.g_strHospitalCD) & "'"
                w_strSql = w_strSql & " and StaffMngID = '" & Trim(m_StaffData(p_Index).ID) & "'"
                w_strSql = w_strSql & " and EmpDate <= " & w_lngDate
                w_strSql = w_strSql & " order by EmpDate desc"

                'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
                w_Rs = General.paDBRecordSetOpen(w_strSql)

                If w_Rs.RecordCount <= 0 Then
                Else
                    With w_Rs

                        .MoveLast()
                        w_RecCnt = .RecordCount
                        .MoveFirst()

                        w_EmpCD_F = .Fields("EmpCD") '採用条件CD

                        '採用条件CD
                        m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).SaiyoCD = w_EmpCD_F.Value & ""
                    End With
                End If

                w_Rs.Close()
                w_Rs = Nothing

                '*********************
                '育児短時間判定
                '*********************
                w_Day = 0
                w_TargetFlg = False
                ReDim w_EmpHisData(0)

                With General.g_objIdoData
                    .pHospitalCD = General.g_strHospitalCD
                    .pStaffMngID = m_StaffData(p_Index).ID
                    .pDateFlg = 1
                    .pDateFrom = m_4WeekKikan(w_Int).StartDate
                    .pDateTo = m_4WeekKikan(w_Int).EndDate
                    .pSortFlg = 0

                    If .mGetSaiyoIdo Then
                        ReDim w_EmpHisData(.fSI_SaiyoCount)

                        For i As Integer = 1 To .fSI_SaiyoCount
                            .mSI_SaiyoIdx = i

                            w_CalcFrom = .fSI_EmpDate
                            If w_CalcFrom < m_4WeekKikan(w_Int).StartDate Then
                                w_CalcFrom = m_4WeekKikan(w_Int).StartDate
                            End If
                            w_CalcTo = .fSI_RetireDate
                            If w_CalcTo > m_4WeekKikan(w_Int).EndDate Then
                                w_CalcTo = m_4WeekKikan(w_Int).EndDate
                            End If

                            w_EmpHisData(i).StartDate = w_CalcFrom
                            w_EmpHisData(i).EndDate = w_CalcTo

                            '短時間判定処理
                            If Not String.IsNullOrEmpty(.fSI_EmpCD) AndAlso
                                    InStr(m_ChildShortEmpCD, .fSI_EmpCD) > 0 Then
                                '育児短時間対象採用の場合
                                If m_NightShortJudgeKBN = "0" AndAlso i = 1 Then
                                    w_TargetFlg = True
                                    w_CalcFrom = .fSI_EmpDate
                                    If w_CalcFrom < m_4WeekKikan(w_Int).StartDate Then
                                        w_CalcFrom = m_4WeekKikan(w_Int).StartDate
                                    End If

                                    Exit For
                                ElseIf m_NightShortJudgeKBN = "1" AndAlso i = .fSI_SaiyoCount Then
                                    w_TargetFlg = True
                                    w_CalcTo = .fSI_RetireDate
                                    If w_CalcTo > m_4WeekKikan(w_Int).EndDate Then
                                        w_CalcTo = m_4WeekKikan(w_Int).EndDate
                                    End If

                                    Exit For
                                ElseIf m_NightShortJudgeKBN = "2" Then
                                    w_Day = w_Day + DateDiff(DateInterval.Day,
                                            Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1
                                End If
                            End If
                        Next

                        If (m_NightShortJudgeKBN = "2" AndAlso w_Day >= m_NightShortJudgeDay) OrElse w_TargetFlg Then
                            m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).ChildShort = True
                        End If
                    End If
                End With

                w_Day = 0
                With General.g_objIdoData
                    .pHospitalCD = General.g_strHospitalCD
                    .pStaffMngID = m_StaffData(p_Index).ID
                    .pDateFlg = 1
                    .pSortFlg = 0

                    Select Case m_NightShortJudgeKBN
                        Case "0"
                            '月初
                            .pDateFrom = w_CalcFrom
                            .pDateTo = w_CalcFrom
                        Case "1"
                            '月末
                            .pDateFrom = w_CalcTo
                            .pDateTo = w_CalcTo
                        Case "2"
                            '日数
                            .pDateFrom = m_4WeekKikan(w_Int).StartDate
                            .pDateTo = m_4WeekKikan(w_Int).EndDate
                    End Select

                    If .mGetShortTimeIdo Then
                        If m_NightShortJudgeKBN = "2" Then
                            '日数

                            '日数計算を行う
                            For i As Integer = 1 To .fST_ShortTimeCount
                                .mST_ShortTimeIdx = i

                                If InStr(m_ChildShortReasonCD, General.paFormatSpace(.fST_ReasonCd, 5)) > 0 Then
                                    For j As Integer = 1 To UBound(w_EmpHisData)
                                        If w_EmpHisData(j).StartDate < .fST_DateFrom Then
                                            w_CalcFrom = .fST_DateFrom
                                        Else
                                            w_CalcFrom = w_EmpHisData(j).StartDate
                                        End If
                                        If w_EmpHisData(j).EndDate < .fST_DateTo Then
                                            w_CalcTo = w_EmpHisData(j).EndDate
                                        Else
                                            w_CalcTo = .fST_DateTo
                                        End If

                                        w_Day = w_Day + DateDiff(DateInterval.Day,
                                                Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1

                                        If w_Day >= m_NightShortJudgeDay Then
                                            '指定の日数に達した場合、夜専
                                            m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).ChildShort = True
                                            Exit For
                                        End If
                                    Next

                                    If m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).ChildShort Then
                                        Exit For
                                    End If
                                End If
                            Next
                        Else
                            '月初,月末
                            For i As Integer = 1 To .fST_ShortTimeCount
                                .mST_ShortTimeIdx = i

                                If InStr(m_ChildShortReasonCD, General.paFormatSpace(.fST_ReasonCd, 5)) > 0 Then
                                    'データがあれば、夜専
                                    m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).ChildShort = True
                                End If
                            Next
                        End If
                    End If
                End With

                '*********************
                '夜間専従者区分
                '*********************
                w_Day = 0
                With General.g_objIdoData
                    .pHospitalCD = General.g_strHospitalCD
                    .pStaffMngID = m_StaffData(p_Index).ID
                    .pDateFlg = 1
                    .pSortFlg = 0

                    Select Case m_NightShortJudgeKBN
                        Case "0"
                            '月初
                            .pDateFrom = w_CalcFrom
                            .pDateTo = w_CalcFrom
                        Case "1"
                            '月末
                            .pDateFrom = w_CalcTo
                            .pDateTo = w_CalcTo
                        Case "2"
                            '日数
                            .pDateFrom = m_4WeekKikan(w_Int).StartDate
                            .pDateTo = m_4WeekKikan(w_Int).EndDate
                    End Select

                    If .mGetNightWorkerIdo Then
                        If m_NightShortJudgeKBN = "2" Then
                            '日数

                            '日数計算を行う
                            For i As Integer = 1 To .fNW_NightWorkerCount
                                .mNW_NightWorkerIdx = i

                                For j As Integer = 1 To UBound(w_EmpHisData)
                                    If w_EmpHisData(j).StartDate < .fNW_DateFrom Then
                                        w_CalcFrom = .fNW_DateFrom
                                    Else
                                        w_CalcFrom = w_EmpHisData(j).StartDate
                                    End If
                                    If w_EmpHisData(j).EndDate < .fNW_DateTo Then
                                        w_CalcTo = w_EmpHisData(j).EndDate
                                    Else
                                        w_CalcTo = .fNW_DateTo
                                    End If

                                    w_Day = w_Day + DateDiff(DateInterval.Day,
                                            Date.Parse(Format(w_CalcFrom, "0000/00/00")), Date.Parse(Format(w_CalcTo, "0000/00/00"))) + 1

                                    If w_Day >= m_NightShortJudgeDay Then
                                        '指定の日数に達した場合、夜専
                                        m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).YakinKBN = "0"
                                        Exit For
                                    End If
                                Next

                                If m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).YakinKBN = "0" Then
                                    Exit For
                                End If
                            Next
                        Else
                            '月初,月末
                            If .fNW_NightWorkerCount > 0 Then
                                'データがあれば、夜専
                                m_StaffData(p_Index).KangoKasanData(w_HairetuIdx).YakinKBN = "0"
                            End If
                        End If
                    End If
                End With
            Next w_Int

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '夜間看護加算帳票設定取得
    Private Sub Get_YakanKangoM()
        Const W_SUBNAME As String = "NSK0000HA Get_YakanKangoM"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_平均入院_F As ADODB.Field
        Try
            'Richard update start
            'w_Sql = "SELECT AVEINPATIENTNUM , TODOKEDEKBN FROM NS_HOSPBASCHARGES_M"
            'w_Sql = w_Sql & " WHERE KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            'If m_SortIdx = 0 Then
            '    w_Sql = w_Sql & " AND FROMDATE <= " & m_KeikakuKikan.StartDate
            '    w_Sql = w_Sql & " AND (TODATE >= " & m_KeikakuKikan.StartDate
            '    w_Sql = w_Sql & " OR TODATE = 0 OR TODATE IS NULL)"
            'Else
            '    w_Sql = w_Sql & " AND FROMDATE <= " & m_KeikakuKikan.EndDate
            '    w_Sql = w_Sql & " AND (TODATE >= " & m_KeikakuKikan.EndDate
            '    w_Sql = w_Sql & " OR TODATE = 0 OR TODATE IS NULL)"
            'End If
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_HOSPBASCHARGES_M_01(w_Rs, m_SortIdx, m_KeikakuKikan.StartDate, m_KeikakuKikan.EndDate) '<15>
            'Richard update end

            If w_Rs.RecordCount <= 0 Then
                m_AveInPatient = 0
                m_TodokedeKbn = m_DefaltTodokedeKbn
            Else
                w_平均入院_F = w_Rs.Fields("AveInPatientNum")

                m_AveInPatient = IIf(IsDBNull(w_平均入院_F.Value), 0, w_平均入院_F.Value)
                m_TodokedeKbn = General.paGetDbFieldVal(w_Rs.Fields("TODOKEDEKBN"), m_DefaltTodokedeKbn)
            End If
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Calc_YakanKango(ByVal p_Index As Integer, ByVal p_TotalTime As Double, ByVal p_Flg As Integer, ByVal p_Cnt As Integer, ByVal p_TotalTimeN As Double, ByVal p_blnOuenFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Calc_YakanKango"

        Dim w_j As Integer
        Dim w_SaiyoCD As String
        Dim w_KangoIdx As Integer
        Dim w_JujiCalc1 As Double
        Dim w_JujiCalc2 As Double
        Dim w_JujiCalc3 As Double
        Dim w_JujiCalc4 As Double
        Dim w_Nissu As Integer
        Dim w_WorkCnt As Double
        Dim w_sngYakin_ari As Double '夜勤の有無（有）
        Dim w_sngYakin_nasi As Double '夜勤の有無（無）
        Dim w_sngJyokin As Double '雇用・勤務形態（常勤）
        Dim w_sngHiJyokin As Double '雇用・勤務形態（非常勤）
        Dim w_sngYakinSenjyusya As Double '夜勤の有無(夜専)
        Dim w_sngKenmu As Double '雇用・勤務形態（他部署兼務）
        Dim w_JujiCalc4_work As Double
        Dim w_blnSonzaiFlg As Boolean
        Dim w_HH As Integer
        Dim w_MM As Integer
        Dim w_TotalTime As Double
        Dim w_TotalTimeN As Double

        '初期化
        w_sngYakin_ari = 0
        w_sngYakin_nasi = 0
        w_sngJyokin = 0
        w_sngHiJyokin = 0
        w_sngYakinSenjyusya = 0
        w_sngKenmu = 0
        Try
            If (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) AndAlso p_Flg <> 0 Then
                w_KangoIdx = p_Cnt + 1
            Else
                w_KangoIdx = p_Cnt
            End If

            w_blnSonzaiFlg = False
            If cmbKikan.SelectedIndex > 0 Then
                '４週期間が選択されている場合
                For w_j = 1 To UBound(m_StaffData(p_Index).IdoData)
                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_StaffData(p_Index).IdoData(w_j).SyuryoYMD AndAlso m_StaffData(p_Index).IdoData(w_j).IdoYMD <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                        w_blnSonzaiFlg = True
                        Exit For
                    End If
                Next w_j
            Else
                w_blnSonzaiFlg = m_StaffData(p_Index).TargetKikanFlg
            End If

            If w_blnSonzaiFlg = False AndAlso (m_StaffData(p_Index).OuenStaffFlg = 0 OrElse m_OuenKinmuCalcFlg = 0) Then
                '期間に所属していない職員の場合
                Exit Sub
            End If

            w_SaiyoCD = m_StaffData(p_Index).KangoKasanData(w_KangoIdx).SaiyoCD

            '=============================================
            '夜勤従事者数に関する計算
            '=============================================
            '夜勤の有無, 雇用・勤務形態
            If m_StaffData(p_Index).KangoKasanData(w_KangoIdx).ChildShort Then
                If p_TotalTime >= 12 Then
                    w_sngYakin_ari = 1
                    w_sngYakin_nasi = 0
                Else
                    w_sngYakin_ari = 0
                    w_sngYakin_nasi = 1
                End If

                w_sngJyokin = 0
                w_sngHiJyokin = 1
            Else
                If p_TotalTime > 16 Then
                    w_sngYakin_ari = 1
                    w_sngYakin_nasi = 0
                Else
                    w_sngYakin_ari = 0
                    w_sngYakin_nasi = 1
                End If
                '2013/07/10 Bando Chg Start ======================================================
                'If InStr(m_JokinSaiyoCD, w_SaiyoCD) > 0 And w_SaiyoCD <> "" Then
                If InStr(m_JokinSaiyoCD, General.paFormatSpace(w_SaiyoCD, 5)) > 0 And w_SaiyoCD <> "" Then
                    '2013/07/10 Bando Chg End   ======================================================
                    w_sngJyokin = 1
                    w_sngHiJyokin = 0
                Else
                    w_sngJyokin = 0
                    w_sngHiJyokin = 1
                End If
            End If

            '夜勤の有無(夜専)J34
            If m_StaffData(p_Index).KangoKasanData(w_KangoIdx).YakinKBN = "0" Then
                w_sngYakinSenjyusya = 1
            Else
                w_sngYakinSenjyusya = 0
            End If

            '雇用・勤務形態（他部署兼務）G34
            If p_blnOuenFlg Then
                w_sngJyokin = 0
                w_sngHiJyokin = 0
                w_sngKenmu = 1
            End If

            '計画期間日数
            If m_SelViewKikan = 0 Then
                w_Nissu = m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol + 1
            Else
                w_Nissu = 28
            End If

            '夜勤16時間以上かつ常勤者
            'IF(E34+H34=2,1,0)
            If w_sngYakin_ari + w_sngJyokin = 2 Then
                w_JujiCalc1 = 1
            Else
                w_JujiCalc1 = 0
            End If

            '夜勤16時間以上かつ常勤者
            'IF(E34+H34=2,0,1)
            If w_sngYakin_ari + w_sngJyokin = 2 Then
                w_JujiCalc2 = 0
            Else
                w_JujiCalc2 = 1
            End If

            '夜勤16時間以下　又は　夜勤専従者
            'IF(I34+J34=1,0,1)
            If w_sngYakin_nasi + w_sngYakinSenjyusya = 1 Then
                w_JujiCalc3 = 0
            Else
                w_JujiCalc3 = 1
            End If

            w_HH = General.paRoundDown(p_TotalTimeN, 0)
            w_MM = (p_TotalTimeN - w_HH) * 100
            w_TotalTimeN = w_HH + (w_MM / 60)
            w_HH = General.paRoundDown(p_TotalTime, 0)
            w_MM = (p_TotalTime - w_HH) * 100
            w_TotalTime = w_HH + (w_MM / 60)

            '(IF(F34+G34+H34=2,(AR33+AR34)/(L27*L26/7),1))
            If w_sngHiJyokin + w_sngKenmu + w_sngYakin_ari = 2 Then
                w_JujiCalc4_work = (w_TotalTimeN + w_TotalTime) / (m_JokinTime * w_Nissu / 7)
            Else
                w_JujiCalc4_work = 1
            End If

            'IF((IF(F34+G34+H34=2,(AR33+AR34)/(L27*L26/7),1))>1,1,(AR33+AR34)/(L27*L26/7))
            If w_JujiCalc4_work > 1 Then
                w_JujiCalc4 = 1
            Else
                w_JujiCalc4 = (w_TotalTimeN + w_TotalTime) / (m_JokinTime * w_Nissu / 7)
            End If

            '１ヶ月の場合
            If p_Flg = 0 Then

                '夜勤従事者数退避
                w_WorkCnt = m_YakinJujiCnt

                '夜勤従事者数
                'IF(E34+H34=2,1,0)+IF(E34+H34=2,0,1)*(IF(I34+J34=1,0,1)*IF((IF(F34+G34+H34=2,(AR33+AR34)/(L27*L26/7),1))>1,1,(AR33+AR34)/(L27*L26/7)))
                If w_sngYakinSenjyusya = 0 Then
                    m_YakinData(p_Index).JujiCnt = w_JujiCalc1 + w_JujiCalc2 * (w_JujiCalc3 * w_JujiCalc4)
                    '2011/09/07 Y.I Add St-----
                Else
                    m_YakinData(p_Index).JujiCnt = 0
                    '2011/09/07 Y.I Add Ed-----

                End If

                If m_YakinData(p_Index).JujiCnt > 0 Then
                    '（再掲）夜勤専従者及び月16時間以下の者の夜勤時間数の場合、総合計にカウント
                    m_YakinData(p_Index).Time = fncChangeMinite(p_TotalTime)
                Else
                    m_YakinData(p_Index).Time = 0
                End If
                '４週の場合
            Else

                w_WorkCnt = m_YakinJujiCnt_4W(p_Cnt)

                '夜勤従事者数
                'IF(E34+H34=2,1,0)+IF(E34+H34=2,0,1)*(IF(I34+J34=1,0,1)*IF((IF(F34+G34+H34=2,(AR33+AR34)/(L27*L26/7),1))>1,1,(AR33+AR34)/(L27*L26/7)))
                If w_sngYakinSenjyusya = 0 Then
                    m_YakinData(p_Index).JujiCnt = w_JujiCalc1 + w_JujiCalc2 * (w_JujiCalc3 * w_JujiCalc4)
                    '2011/09/07 Y.I Add St-----
                Else
                    m_YakinData(p_Index).JujiCnt = 0
                    '2011/09/07 Y.I Add Ed-----
                End If

                If m_YakinData(p_Index).JujiCnt > 0 Then
                    '（再掲）夜勤専従者及び月16時間以下の者の夜勤時間数の場合、総合計にカウント
                    m_YakinData(p_Index).Time = fncChangeMinite(p_TotalTime)
                Else
                    m_YakinData(p_Index).Time = 0
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '2016/04/21 Yamanishi Add Start -----------------------------------------------------------------------------------------------------------------------------
    ''' <summary>
    ''' H28年度版様式９に合わせた計算
    ''' （メソッド内に準拠した説明あり）
    ''' </summary>
    ''' <param name="p_Idx">職員インデックス</param>
    ''' <param name="p_NightTime">夜勤時間合計</param>
    ''' <param name="p_TotalNightTime">総夜勤時間合計</param>
    ''' <param name="p_Flg"></param>
    ''' <param name="p_Cnt"></param>
    ''' <remarks></remarks>
    Private Sub Calc_YakanKango2(ByVal p_Idx As Integer, ByVal p_NightTime As Double, ByVal p_TotalNightTime As Double, ByVal p_Flg As Integer, ByVal p_Cnt As Integer)

        Const W_SUBNAME As String = "NSK0000HA Calc_YakanKango2"
        Try
            Dim w_SaiyoCD As String
            Dim w_KangoIdx As Integer
            Dim w_SyozokuFlg As Boolean
            Dim w_NightKinmuFlg As Boolean
            Dim w_NightJujiCnt As Double
            Dim w_NightTime As Integer
            Dim w_TotalNightTime As Integer

            If (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) AndAlso p_Flg <> 0 Then
                w_KangoIdx = p_Cnt + 1
            Else
                w_KangoIdx = p_Cnt
            End If

            w_SyozokuFlg = False
            If cmbKikan.SelectedIndex > 0 Then
                '４週期間が選択されている場合
                For i As Integer = 1 To UBound(m_StaffData(p_Idx).IdoData)
                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_StaffData(p_Idx).IdoData(i).SyuryoYMD AndAlso
                       m_StaffData(p_Idx).IdoData(i).IdoYMD <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                        w_SyozokuFlg = True
                        Exit For
                    End If
                Next i
            Else
                w_SyozokuFlg = m_StaffData(p_Idx).TargetKikanFlg
            End If

            If (Not w_SyozokuFlg) AndAlso (m_StaffData(p_Idx).OuenStaffFlg = 0 OrElse m_OuenKinmuCalcFlg = 0) Then
                '期間に所属していない職員の場合
                Exit Sub
            End If

            '分数に変換して格納
            w_NightTime = fncChangeMinite(p_NightTime)
            w_TotalNightTime = fncChangeMinite(p_TotalNightTime)

            w_SaiyoCD = m_StaffData(p_Idx).KangoKasanData(w_KangoIdx).SaiyoCD

            '必要項目
            '$I$5
            'm_TodokedeKbn
            'G56
            'm_StaffData(p_Idx).KangoKasanData(w_KangoIdx).ChildShort 'True:1, False;0
            'M56 夜専(夜勤の有無)
            'm_StaffData(p_Idx).KangoKasanData(w_KangoIdx).YakinKBN   '"0":1, "1":1
            'AU56
            'p_NightTime
            'AU57
            'p_TotalNightTime

            '=============================================
            '夜勤従事者数に関する計算
            '=============================================
            '有（夜勤の有無）K56
            '=IF(AND(F56=0,G56=0,H56=0,I56=0), 0, IF( OR($I$5=7,$I$5=10), IF(OR(AND(G56=1,AU56>=12),AND(G56<>1,AU56>=16)),1,0), IF(AU56>=8,1,0)))

            'AND(F56=0,G56=0,H56=0,I56=0)
            '出力対象職員であれば必ずFALSEなので考慮する必要なし

            Select Case m_TodokedeKbn
                Case 7, 10 'OR($I$5=7,$I$5=10)
                    'IF(OR(AND(G56=1,AU56>=12),AND(G56<>1,AU56>=16)),1,0)
                    If m_StaffData(p_Idx).KangoKasanData(w_KangoIdx).ChildShort Then 'G56=1
                        'AU56>=12 'AND(G56=1,AU56>=12)
                        w_NightKinmuFlg = (p_NightTime >= 12)
                    Else 'G56<>1
                        'AU56>=16 'AND(G56<>1,AU56>=16)
                        w_NightKinmuFlg = (p_NightTime >= 16)
                    End If
                Case Else
                    w_NightKinmuFlg = (p_NightTime >= 8) 'IF(AU56>=8,1,0)
            End Select

            '夜勤従事者
            '=IF(OR(M56=1,K56<>1),0,MIN(1,AU56/AU57))
            '夜勤の有無(夜専)M56
            If m_StaffData(p_Idx).KangoKasanData(w_KangoIdx).YakinKBN = "0" OrElse (Not w_NightKinmuFlg) Then 'OR(M56=1,K56<>1)
                w_NightJujiCnt = 0
            Else
                If p_TotalNightTime > 0 Then
                    w_NightJujiCnt = w_NightTime / w_TotalNightTime
                    If w_NightJujiCnt > 1 Then w_NightJujiCnt = 1 'MIN(1,AU56/AU57)
                Else
                    w_NightJujiCnt = 0 'シートなら!DIV/0でもいいがプログラム上では落ちるため
                End If
            End If

            '夜勤従事者数格納
            m_YakinData(p_Idx).JujiCnt = w_NightJujiCnt

            '月延べ夜勤時間数　〔D－E〕
            '再掲）月平均夜勤時間数の計算に含まない者の夜勤時間数
            '=IF(OR(M56=1,L56=1),AU56,0)

            'L56=IF(AND(F56=0,G56=0,H56=0,I56=0), 0, IF(K56<>1, 1, 0))

            'AND(F56=0,G56=0,H56=0,I56=0)
            '出力対象職員であれば必ずFALSEなので考慮する必要なし

            'IF(K56<>1, 1, 0)
            '(Not w_NightKinmuFlg)を使えばよい

            'OR(M56=1,L56=1)
            If m_StaffData(p_Idx).KangoKasanData(w_KangoIdx).YakinKBN = "0" OrElse (Not w_NightKinmuFlg) Then
                m_YakinData(p_Idx).Time = 0
            Else
                'AU56
                m_YakinData(p_Idx).Time = w_NightTime
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Err.Number, W_SUBNAME)
            End
        End Try
    End Sub
    '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
    Private Function Calc_NotZaikinTotalNight(ByVal p_Idx As Integer, ByVal p_strDate As String,
            ByVal p_Row As Integer, ByVal p_PostCD As String, ByVal p_JobCD As String, ByVal p_IsLastDay As Boolean) As Integer

        Const W_SUBNAME As String = "NSK0000HA Calc_NotZaikinTotalNight"

        Dim w_iDate As Integer
        Dim i, j As Integer
        Dim w_Time As String
        Dim w_strTime As String
        Dim w_NightCalcTime As Integer
        Dim w_NextNightCalcTime As Integer
        Dim w_SaiyoCD As String
        Dim w_KinmuTime3 As Integer
        Dim w_TotalNightTime As Integer
        Dim w_KinmuCD As String
        Dim w_KinmuDeptCD As String
        Dim w_NotZaisekiFlg As Boolean
        Dim w_HHmm As Integer
        '2018/03/08 Yamanishi Add ---------------------
        Dim w_NightHHmm As Integer
        Dim w_NextNightHHmm As Integer
        '----------------------------------------------
        Dim w_NotCalcKojyoCD As String
        Try
            w_TotalNightTime = 0
            w_NotCalcKojyoCD = m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD

            If m_YakanKangoDispFlg = 0 AndAlso m_OuenTotalNightFullFlg = 1 AndAlso
              (m_StaffData(p_Idx).OuenStaffFlg = 0 OrElse m_OuenKinmuCalcFlg = 1) Then

                w_Time = "" '2016/06/15 Yamanishi Add
                w_KinmuCD = ""
                w_NotZaisekiFlg = False

                '2017/01/11 K.I Upd Start------------------------------------------------------------------------------------------
                'If (InStr(m_NotCntPostCD, p_PostCD) > 0 AndAlso p_PostCD <> "") OrElse _
                '   (InStr(m_NotCntJobCD, p_JobCD) > 0 AndAlso p_JobCD <> "") Then
                If (InStr(m_NotCntPostCD, General.paFormatSpace(p_PostCD, 10)) > 0 AndAlso p_PostCD <> "") _
               OrElse (InStr(m_NotCntJobCD, General.paFormatSpace(p_JobCD, 10)) > 0 AndAlso p_JobCD <> "") Then
                    '2017/01/11 K.I Upd End--------------------------------------------------------------------------------------------

                    '対象外役職CD or 対象外職種CDの場合はカウントしない
                ElseIf p_strDate <> "" Then

                    w_iDate = Integer.Parse(p_strDate)

                    w_SaiyoCD = ""
                    w_NotZaisekiFlg = False
                    For i = 1 To UBound(m_StaffData(p_Idx).SaiyoData)
                        If m_StaffData(p_Idx).SaiyoData(i).SaiyoDate <= w_iDate And
                           w_iDate <= m_StaffData(p_Idx).SaiyoData(i).TentaiDate Then
                            w_SaiyoCD = m_StaffData(p_Idx).SaiyoData(i).SaiyoCD
                            w_NotZaisekiFlg = True
                            Exit For
                        End If
                    Next i

                    If w_NotZaisekiFlg Then
                        w_NotZaisekiFlg = False
                        For i = 1 To UBound(m_StaffData(p_Idx).IdoHistory)
                            If m_StaffData(p_Idx).IdoHistory(i).IdoYMD <= w_iDate And
                               w_iDate <= m_StaffData(p_Idx).IdoHistory(i).SyuryoYMD Then
                                w_KinmuDeptCD = m_StaffData(p_Idx).IdoHistory(i).CD
                                '対象部署に在籍して「いない」とき
                                w_NotZaisekiFlg = (General.g_strSelKinmuDeptCD <> w_KinmuDeptCD)
                                Exit For
                            End If
                        Next i
                    End If

                    If w_NotZaisekiFlg Then
                        '応援勤務は対象外（後で計算されるため）
                        For i = 1 To UBound(m_StaffData(p_Idx).BeforeKinmuData)
                            If m_StaffData(p_Idx).BeforeKinmuData(i).Date_Renamed = w_iDate Then
                                w_KinmuCD = m_StaffData(p_Idx).BeforeKinmuData(i).KinmuCD
                                w_Time = m_StaffData(p_Idx).BeforeKinmuData(i).Time '2016/06/15 Yamanishi Add
                                If m_OuenKinmuCalcFlg = 1 Then
                                    w_NotZaisekiFlg = (m_StaffData(p_Idx).BeforeKinmuData(i).OuenKangoCD <> General.g_strSelKinmuDeptCD)
                                End If
                                Exit For
                            End If
                        Next i
                    End If

                    If w_NotZaisekiFlg Then

                        Call Get_TimeM(p_Idx, w_KinmuCD, w_iDate, 3, p_Row, , w_KinmuTime3)

                        w_TotalNightTime = w_KinmuTime3

                        '控除時間を考慮する
                        For i = 1 To UBound(m_StaffData(p_Idx).Kojyo)
                            '現在のセルのデータのみ計算
                            If w_iDate = m_StaffData(p_Idx).Kojyo(i).lngDate Then
                                For j = 1 To UBound(m_StaffData(p_Idx).Kojyo(i).strKinmuDetailCD)
                                    '2018/03/08 Yamanishi Add ------------------------------------------------------------------------------
                                    If General.g_UseMultiOuenFlg AndAlso m_StaffData(p_Idx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                        '時間応援のうち一つでも対象部署の場合、処理を飛ばす
                                        Return 0
                                    End If
                                    '-------------------------------------------------------------------------------------------------------
                                    If InStr(w_NotCalcKojyoCD, General.paFormatSpace(m_StaffData(p_Idx).Kojyo(i).strKinmuDetailCD(j), 10)) = 0 Then
                                        '夜勤時間を合計
                                        w_HHmm = m_StaffData(p_Idx).Kojyo(i).lngYakinTime(j)
                                        w_NightCalcTime = w_NightCalcTime + (w_HHmm \ 100) * 60 + (w_HHmm Mod 100)
                                        '翌日夜勤時間を合計
                                        w_HHmm = m_StaffData(p_Idx).Kojyo(i).lngYokuYakinTime(j)
                                        w_NextNightCalcTime = w_NextNightCalcTime + (w_HHmm \ 100) * 60 + (w_HHmm Mod 100)
                                    End If
                                Next j
                            End If
                        Next i
                        '2016/06/15 Yamanishi Del --------------------------------------------------------------------
                        ''年休時間を考慮する
                        'w_Time = ""
                        'For j = 1 To UBound(m_StaffData(p_Idx).BeforeJikanNenkyu)
                        '    If m_StaffData(p_Idx).BeforeJikanNenkyu(j).Date_Renamed = w_iDate Then
                        '        w_Time = m_StaffData(p_Idx).BeforeJikanNenkyu(j).StrData
                        '        Exit For
                        '    End If
                        'Next j
                        '---------------------------------------------------------------------------------------------
                        '個人別時間年休を計算する
                        w_strTime = w_Time
                        While w_strTime <> ""
                            '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                            'w_Time = General.paLeft(w_strTime, 28)
                            'w_strTime = Mid(w_strTime, 29)
                            ''当日夜勤時間
                            'w_HHmm = Integer.Parse(Mid(w_Time, 21, 4))
                            'w_NightCalcTime = w_NightCalcTime + (w_HHmm \ 100) * 60 + (w_HHmm Mod 100)
                            ''翌日夜勤時間
                            'w_HHmm = Integer.Parse(Mid(w_Time, 25, 4))
                            'w_NextNightCalcTime = w_NextNightCalcTime + (w_HHmm \ 100) * 60 + (w_HHmm Mod 100)

                            w_strTime = Get_NenkyuTime(w_strTime, 0, w_NightHHmm, w_NextNightHHmm)
                            '当日夜勤時間
                            w_NightCalcTime = w_NightCalcTime + (w_NightHHmm \ 100) * 60 + (w_NightHHmm Mod 100)
                            '翌日夜勤時間
                            w_NextNightCalcTime = w_NextNightCalcTime + (w_NextNightHHmm \ 100) * 60 + (w_NextNightHHmm Mod 100)
                            '------------------------------------------------------------------------------------------------------
                        End While
                        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                        'If Convert.ToString(m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "A")) = "" Then
                        '    w_SaiyoCD = "00000"
                        'End If
                        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                        If w_NightCalcTime <> 0 OrElse w_NextNightCalcTime <> 0 Then
                            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                            'If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G") > w_NightCalcTime Then
                            '    w_TotalNightTime = w_TotalNightTime - w_NightCalcTime
                            'Else
                            '    w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G")
                            'End If
                            'If Not p_IsLastDay Then
                            '    If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H") > w_NextNightCalcTime Then
                            '        w_TotalNightTime = w_TotalNightTime - w_NextNightCalcTime
                            '    Else
                            '        w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H")
                            '    End If
                            'End If
                            If GetKinmuTime(w_KinmuCD, p_Idx, w_iDate, gKinmuTimeMCol.TotalNightTime) > w_NightCalcTime Then
                                w_TotalNightTime = w_TotalNightTime - w_NightCalcTime
                            Else
                                w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, p_Idx, w_iDate, gKinmuTimeMCol.TotalNightTime)
                            End If
                            If Not p_IsLastDay Then
                                If GetKinmuTime(w_KinmuCD, p_Idx, w_iDate, gKinmuTimeMCol.NextTotalNightTime) > w_NextNightCalcTime Then
                                    w_TotalNightTime = w_TotalNightTime - w_NextNightCalcTime
                                Else
                                    w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, p_Idx, w_iDate, gKinmuTimeMCol.NextTotalNightTime)
                                End If
                            End If
                            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                        End If
                    End If
                End If
            End If

            Return w_TotalNightTime

        Catch ex As Exception
            Call General.paTrpMsg(Err.Number, W_SUBNAME)
            End
        End Try
    End Function
    '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
    '2016/04/21 Yamanishi Add End -------------------------------------------------------------------------------------------------------------------------------

    '小数の扱いについてウィザード設定通りに計算し結果を返す
    'p_Value ------- 計算前の値
    'p_Index ------- ウィザードのSEQ番号
    'p_Answer ------- 計算後の結果
    Private Sub Calc_SyosuSettei(ByVal p_Value As Double, ByVal p_Index As Integer, ByRef p_Answer As Double)

        Const W_SUBNAME As String = "NSK0000HA Calc_SyosuSettei"

        p_Answer = 0
        Try
            Select Case m_KangoSettei(p_Index).Value2
                Case "0" '切り上げ
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_Answer = General.paRoundUp(p_Value, 0)
                        Case "1" '小数第2位
                            p_Answer = General.paRoundUp(p_Value, 1)
                        Case "2" '小数第3位
                            p_Answer = General.paRoundUp(p_Value, 2)
                    End Select
                Case "1" '切り捨て
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_Answer = General.paRoundDown(p_Value, 0)
                        Case "1" '小数第2位
                            p_Answer = General.paRoundDown(p_Value, 1)
                        Case "2" '小数第3位
                            p_Answer = General.paRoundDown(p_Value, 2)
                    End Select
                Case "2" '四捨五入
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_Answer = General.paRound(p_Value, 0)
                        Case "1" '小数第2位
                            p_Answer = General.paRound(p_Value, 1)
                        Case "2" '小数第3位
                            p_Answer = General.paRound(p_Value, 2)
                    End Select
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ウィザード設定による小数設定の表示形式にする
    'p_Value ------- 実際の値
    'p_Index ------- ウィザードのSEQ番号
    'p_strFormat --- 表示形式の値
    Private Sub Calc_Format(ByVal p_Value As Double, ByVal p_Index As Integer, ByRef p_strFormat As String)

        Const W_SUBNAME As String = "NSK0000HA Calc_Format"
        Try
            p_strFormat = Convert.ToString(p_Value)

            Select Case m_KangoSettei(p_Index).Value2
                Case "0" '切り上げ
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_strFormat = Convert.ToString(p_Value)
                        Case "1" '小数第2位
                            p_strFormat = Format(p_Value, "##0.0")
                        Case "2" '小数第3位
                            p_strFormat = Format(p_Value, "##0.00")
                    End Select
                Case "1" '切り捨て
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_strFormat = Convert.ToString(p_Value)
                        Case "1" '小数第2位
                            p_strFormat = Format(p_Value, "##0.0")
                        Case "2" '小数第3位
                            p_strFormat = Format(p_Value, "##0.00")
                    End Select
                Case "2" '四捨五入
                    Select Case m_KangoSettei(p_Index).Value1
                        Case "0" '小数第1位
                            p_strFormat = Convert.ToString(p_Value)
                        Case "1" '小数第2位
                            p_strFormat = Format(p_Value, "##0.0")
                        Case "2" '小数第3位
                            p_strFormat = Format(p_Value, "##0.00")
                    End Select
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '********************************
    '   ﾒｲﾝのPictureｺﾝﾄﾛｰﾙｻｲｽﾞ調整
    '   Create  S.Ooeki 2000/08/12
    '********************************
    Private Sub Resize_ContanarCtrl()

        Const W_SUBNAME As String = "NSK0000HA Resize_ContanarCtrl"

        Dim w_Left As Single
        Dim w_Top As Single
        Dim w_Width As Single
        Dim w_Height As Single
        Dim w_tbrHeight As Single
        Dim w_sbrHeight As Single
        Try
            w_Left = General.paTwipsTopixels(60)
            w_Width = Me.ClientRectangle.Width - w_Left * 2
            If w_Width < 0 Then
                w_Width = 0
            End If

            If tbrMain.Visible = False Then
                'ﾂｰﾙﾊﾞｰが非表示の場合
                w_tbrHeight = tbrMain.Top
            Else
                'ﾂｰﾙﾊﾞｰが表示されている場合
                w_tbrHeight = tbrMain.Height + tbrMain.Top
            End If
            If sbrMain.Visible = False Then
                'ｽﾃｰﾀｽﾊﾞｰが非表示の場合
                w_sbrHeight = 0
            Else
                'ｽﾃｰﾀｽﾊﾞｰが表示されている場合
                w_sbrHeight = sbrMain.Height
            End If
            w_Top = w_tbrHeight
            w_Height = Me.ClientRectangle.Height - (w_tbrHeight + w_sbrHeight)
            If w_Height < 0 Then
                w_Height = 0
            End If

            picBase.SetBounds(w_Left, w_Top, w_Width, w_Height)
            picHide.SetBounds(w_Left, w_Top, w_Width, w_Height)

            'ｽﾌﾟﾚｯﾄﾞの大きさを設定する
            picBase.Visible = False
            Call Resize_SpreadCtrl()
            picBase.Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Save_SaikeiData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Save_SaikeiData"

        Dim w_Int As Integer
        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_KinmuCD As String = String.Empty 'KinmuCD
        Dim w_RiyuKBN As String = String.Empty '理由区分
        Dim w_Time As String = String.Empty '時間数
        Dim w_Flg As String = String.Empty '確定部署Flg
        Dim w_SysDate As String '更新日時
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StartDate As Integer
        Dim w_StaffIdx As Integer
        Dim w_Idocnt As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_NenkyuIdx As Integer
        Dim w_GetCol As Integer
        Dim w_SQLOracle As String
        Dim w_StartCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_EndCol As Integer
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Red)
            pProcessForm.pSyoriText = "再掲データ保存中..."

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            'トランザクション開始
            Call General.paBeginTrans()

            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '計画確定Ｆ削除
                Call Save_PlanKakutei(True)
            End If

            '処理経過初期化
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

            w_intCount = 0

            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                    '配列番号 取得
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If IsNumeric(w_Var) = True Then
                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽが取得できる場合

                        '配列ｲﾝﾃﾞｯｸｽ取得
                        w_StaffIdx = Integer.Parse(w_Var)
                        '職員管理番号 取得
                        w_StaffID = m_StaffData(w_StaffIdx).ID

                        '職員歴Ｆ更新
                        '希望勤務だった場合更新しない
                        If Not (g_HopeMode = 1) Then
                            Call Save_Shokuinreki(w_StaffIdx)
                        End If

                        '代休管理Ｆ更新
                        If General.g_lngDaikyuMng = 0 Then
                            Call Save_DaikyuData(w_StaffIdx)
                        End If

                        w_SQLOracle = ""
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                            '日付取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If
                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If
                            End If

                            '更新期間の設定(配属日している期間のみ)
                            w_HaizokuFlg = False
                            If w_CurrentDate <> 0 AndAlso w_Cnt > 0 Then
                                w_Idocnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                For w_Int = 1 To w_Idocnt
                                    If (m_StaffData(w_StaffIdx).IdoData(w_Int).IdoYMD <= w_CurrentDate) AndAlso (w_CurrentDate <= m_StaffData(w_StaffIdx).IdoData(w_Int).SyuryoYMD) AndAlso w_CurrentDate <> 0 Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If

                            '配属期間内？
                            If w_HaizokuFlg = True Then
                                '配属期間内の場合

                                '日付ｲﾝﾃﾞｯｸｽ 取得
                                w_NenkyuIdx = 0
                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).NenkyuData)
                                    If m_StaffData(w_StaffIdx).NenkyuData(w_Int).Date_Renamed = w_CurrentDate Then
                                        w_NenkyuIdx = w_Int
                                        Exit For
                                    End If
                                Next w_Int

                                '勤務ﾃﾞｰﾀ 取得
                                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN AndAlso w_Var = "" Then
                                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                End If

                                '勤務ﾃﾞｰﾀ分割
                                '2015/04/10 Bando Upd Start ==================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd End   ==================

                                If Trim(w_KinmuCD) = "" Then
                                    '勤務CDが取得できない 又は 理由区分が再掲("4")以外の場合
                                    If m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Delete OrElse (m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg <> M_JISSEKIDATA) Then
                                        '再掲Ｆにﾃﾞｰﾀがある場合は削除する
                                        'RICHARD UPDATE START
                                        'w_Sql = "Delete From NS_KINMUPLAN_F"
                                        'w_Sql = w_Sql & " Where StaffMngID = '" & m_StaffData(w_StaffIdx).ID & "'"
                                        'w_Sql = w_Sql & " And DateF = " & Convert.ToString(w_CurrentDate)
                                        'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                        'w_Sql = w_Sql & " "
                                        'Call General.paDBExecute(w_Sql)
                                        Call NSK0000H_sql.delete_NS_KINMUPLAN_F_01(m_StaffData(w_StaffIdx).ID, w_CurrentDate)
                                        'RICHARD UPDATE END

                                        m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).KinmuCD = ""
                                        m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).RiyuKBN = ""
                                        m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Date_Renamed = 0
                                        m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = ""
                                        m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Comment = "" '2015/04/10 Bando Add
                                    End If
                                Else
                                    '再掲ﾃﾞｰﾀの場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg <> M_JISSEKIDATA Then
                                        '勤務ﾃﾞｰﾀが実績ﾃﾞｰﾀでない場合（再掲勤務が入力可能な場合）
                                        If m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Delete OrElse m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update Then
                                            '再掲Ｆにﾃﾞｰﾀがある場合は更新する
                                            If m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Comment <> w_Comment Then
                                                '勤務が異なる場合
                                                'RICHARD UPDATE START
                                                'w_Sql = "Update NS_KINMUPLAN_F Set"
                                                'w_Sql = w_Sql & " KinmuCD = '" & w_KinmuCD & "'"
                                                'w_Sql = w_Sql & ", ReasonKbn = '" & w_RiyuKBN & "'"
                                                'w_Sql = w_Sql & ", HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ", LastUpdTimeDate = " & w_SysDate
                                                'w_Sql = w_Sql & ", RegistrantID = '" & General.g_strUserID & "'"
                                                'w_Sql = w_Sql & " Where StaffMngID = '" & m_StaffData(w_StaffIdx).ID & "'"
                                                'w_Sql = w_Sql & " And DateF = " & Convert.ToString(w_CurrentDate)
                                                'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                'w_Sql = w_Sql & " "
                                                'Call General.paDBExecute(w_Sql)
                                                '<36>
                                                Call NSK0000H_sql.update_NS_KINMUPLAN_F_01(w_KinmuCD, w_RiyuKBN, w_Comment, w_SysDate, m_StaffData(w_StaffIdx).ID, w_CurrentDate)
                                                'RICHARD UPDATE END

                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).KinmuCD = w_KinmuCD
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Date_Renamed = w_CurrentDate
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update
                                                m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                            End If
                                        Else
                                            '再掲Ｆにﾃﾞｰﾀがない場合
                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update Then
                                                If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment <> w_Comment Then
                                                    '勤務データがある場合
                                                    w_Sql = "Update NS_KINMUPLAN_F SET"
                                                    w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "'"
                                                    w_Sql = w_Sql & ", REASONKBN = '" & w_RiyuKBN & "'"
                                                    w_Sql = w_Sql & ", HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                    w_Sql = w_Sql & ", LASTUPDTIMEDATE = " & w_SysDate
                                                    w_Sql = w_Sql & ", REGISTRANTID = '" & General.g_strUserID & "'"
                                                    w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
                                                    w_Sql = w_Sql & " AND DATEF = " & Convert.ToString(w_CurrentDate)
                                                    w_Sql = w_Sql & " AND STAFFMNGID = '" & m_StaffData(w_StaffIdx).ID & "'"
                                                    Call General.paDBExecute(w_Sql)
                                                End If
                                            Else
                                                '勤務データがない場合
                                                w_Sql = "Insert Into NS_KINMUPLAN_F ("
                                                w_Sql = w_Sql & " HospitalCD"
                                                w_Sql = w_Sql & ", DateF"
                                                w_Sql = w_Sql & ", StaffMngID"
                                                w_Sql = w_Sql & ", KinmuCD"
                                                w_Sql = w_Sql & ", ReasonKbn"
                                                w_Sql = w_Sql & ", HOPECOMMENT" '2015/04/10 Bando Add
                                                w_Sql = w_Sql & ", RegistFirstTimeDate"
                                                w_Sql = w_Sql & ", LastUpdTimeDate"
                                                w_Sql = w_Sql & ", RegistrantID"
                                                w_Sql = w_Sql & " ) Values ("
                                                w_Sql = w_Sql & " '" & General.g_strHospitalCD & "'"
                                                w_Sql = w_Sql & ", " & Convert.ToString(w_CurrentDate)
                                                w_Sql = w_Sql & ", '" & m_StaffData(w_StaffIdx).ID & "'"
                                                w_Sql = w_Sql & ", '" & w_KinmuCD & "'"
                                                w_Sql = w_Sql & ", '" & w_RiyuKBN & "'"
                                                w_Sql = w_Sql & ", '" & w_Comment & "'" '2015/04/10 Bando Add
                                                w_Sql = w_Sql & ", " & w_SysDate
                                                w_Sql = w_Sql & ", " & w_SysDate
                                                w_Sql = w_Sql & ", '" & General.g_strUserID & "'"
                                                w_Sql = w_Sql & " )"
                                                w_Sql = w_Sql & " "
                                                Call General.paDBExecute(w_Sql)
                                            End If

                                            m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Date_Renamed = w_CurrentDate
                                            m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update
                                            m_StaffData(w_StaffIdx).SaikeiData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                        End If '---> 再掲ﾃﾞｰﾀあり？
                                    End If '---> 勤務ﾃﾞｰﾀが実績ﾃﾞｰﾀ？
                                End If '---> 勤務CD設定 再掲勤務？
                            End If '---> 配属しているの？
                        Next w_Col
                    End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得可能？

                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount
                End If
            Next w_Row

            '4週分更新********************************************************************************
            '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
            m_4WeekFLG = False

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            '計画終了日+1日
            w_StartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
            If Get_Col_4W(w_StartDate, w_StartCol) = False Then
                Exit Sub
            End If

            '最終4週期間終了日
            w_EndCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol

            w_intCount = 0

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)

                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                    '配列番号 取得
                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If IsNumeric(w_Var) = True Then
                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽが取得できる場合

                        '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                        w_Index = Integer.Parse(w_Var)
                        '職員管理番号 取得
                        w_StaffID = m_StaffData(w_Index).ID

                        '代休管理Ｆ更新
                        If General.g_lngDaikyuMng = 0 Then
                            Call Save_DaikyuData(w_Index)
                        End If

                        w_Cnt = 0
                        w_SQLOracle = ""
                        For w_Col = w_StartCol To w_EndCol
                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                            Else
                                w_Cnt = 0
                            End If

                            '更新期間の設定(配属日している期間のみ)
                            w_HaizokuFlg = False
                            If w_CurrentDate <> 0 AndAlso w_Cnt > 0 Then
                                w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                                For w_Int = 1 To w_Idocnt
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If

                            '配属期間内のﾃﾞｰﾀのみを更新する
                            If w_HaizokuFlg = True Then

                                'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                                If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                    '二段表示してる時　かつ　勤務変更時
                                    '下段を確認する（計画終了日+1日～最終4週期間終了日　この期間、上段にはデータない）
                                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row + 1, w_Col)
                                Else
                                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row, w_Col)
                                End If

                                '勤務ﾃﾞｰﾀ分割
                                '2015/04/10 Bando Upd Start =========================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd End   =========================

                                If Trim(w_KinmuCD) = "" Then
                                    '勤務CDが取得できない 又は 理由区分が再掲("4")以外の場合
                                    If m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Delete OrElse (m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg <> M_JISSEKIDATA) Then
                                        '再掲Ｆにﾃﾞｰﾀがある場合は削除する
                                        w_Sql = "Delete From NS_KINMUPLAN_F"
                                        w_Sql = w_Sql & " Where StaffMngID = '" & m_StaffData(w_Index).ID & "'"
                                        w_Sql = w_Sql & " And DateF = " & Convert.ToString(w_CurrentDate)
                                        w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                        w_Sql = w_Sql & " "
                                        Call General.paDBExecute(w_Sql)

                                        m_StaffData(w_Index).SaikeiData(w_Cnt).KinmuCD = ""
                                        m_StaffData(w_Index).SaikeiData(w_Cnt).RiyuKBN = ""
                                        m_StaffData(w_Index).SaikeiData(w_Cnt).Date_Renamed = 0
                                        m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = ""
                                        m_StaffData(w_Index).SaikeiData(w_Cnt).Comment = "" '2015/04/10 Bando Add
                                    End If
                                Else
                                    '再掲ﾃﾞｰﾀの場合
                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg <> M_JISSEKIDATA Then
                                        '勤務ﾃﾞｰﾀが実績ﾃﾞｰﾀでない場合（再掲勤務が入力可能な場合）
                                        If m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Delete OrElse m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update Then
                                            '再掲Ｆにﾃﾞｰﾀがある場合は更新する
                                            If m_StaffData(w_Index).SaikeiData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).Comment <> w_Comment Then
                                                '勤務が異なる場合
                                                'RICHARD UPDATE START
                                                'w_Sql = "Update NS_KINMUPLAN_F Set"
                                                'w_Sql = w_Sql & " KinmuCD = '" & w_KinmuCD & "'"
                                                'w_Sql = w_Sql & ", ReasonKbn = '" & w_RiyuKBN & "'"
                                                'w_Sql = w_Sql & ", HOPECOMMENT = '" & w_Comment & "'" '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ", LastUpdTimeDate = " & w_SysDate
                                                'w_Sql = w_Sql & ", RegistrantID = '" & General.g_strUserID & "'"
                                                'w_Sql = w_Sql & " Where StaffMngID = '" & m_StaffData(w_Index).ID & "'"
                                                'w_Sql = w_Sql & " And DateF = " & Convert.ToString(w_CurrentDate)
                                                'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                'w_Sql = w_Sql & " "
                                                'Call General.paDBExecute(w_Sql)
                                                Call NSK0000H_sql.update_NS_KINMUPLAN_F_01(w_KinmuCD, w_RiyuKBN, w_Comment, w_SysDate, m_StaffData(w_Index).ID, w_CurrentDate)
                                                'RICHARD UPDATE END

                                                m_StaffData(w_Index).SaikeiData(w_Cnt).KinmuCD = w_KinmuCD
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).Date_Renamed = w_CurrentDate
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update
                                                m_StaffData(w_Index).SaikeiData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                            End If
                                        Else
                                            '再掲Ｆにﾃﾞｰﾀがない場合
                                            If m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update Then
                                                If m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).Comment <> w_Comment Then
                                                    '勤務データがある場合
                                                    'RICHARD UPDATE STAR
                                                    'w_Sql = "Update NS_KINMUPLAN_F SET"
                                                    'w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "'"
                                                    'w_Sql = w_Sql & ", REASONKBN = '" & w_RiyuKBN & "'"
                                                    'w_Sql = w_Sql & ", HOPECOMMENT = '" & w_Comment & "'" '2015/04/10 Bando Add
                                                    'w_Sql = w_Sql & ", LASTUPDTIMEDATE = " & w_SysDate
                                                    'w_Sql = w_Sql & ", REGISTRANTID = '" & General.g_strUserID & "'"
                                                    'w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
                                                    'w_Sql = w_Sql & " AND DATEF = " & Convert.ToString(w_CurrentDate)
                                                    'w_Sql = w_Sql & " AND STAFFMNGID = '" & m_StaffData(w_Index).ID & "'"
                                                    'Call General.paDBExecute(w_Sql)
                                                    '<38>
                                                    Call NSK0000H_sql.update_NS_KINMUPLAN_F_03(w_KinmuCD,
                                                                                              w_RiyuKBN,
                                                                                              w_Comment,
                                                                                              w_SysDate,
                                                                                              w_CurrentDate,
                                                                                              m_StaffData(w_Index).ID)
                                                    'RICHARD UPDATE END


                                                End If
                                            Else
                                                '勤務データがない場合
                                                'RICHARD UPDATE START
                                                'w_Sql = "Insert Into NS_KINMUPLAN_F ("
                                                'w_Sql = w_Sql & " HospitalCD"
                                                'w_Sql = w_Sql & ", DateF"
                                                'w_Sql = w_Sql & ", StaffMngID"
                                                'w_Sql = w_Sql & ", KinmuCD"
                                                'w_Sql = w_Sql & ", ReasonKbn"
                                                'w_Sql = w_Sql & ", HOPECOMMENT" '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ", RegistFirstTimeDate"
                                                'w_Sql = w_Sql & ", LastUpdTimeDate"
                                                'w_Sql = w_Sql & ", RegistrantID"
                                                'w_Sql = w_Sql & " ) Values ("
                                                'w_Sql = w_Sql & " '" & General.g_strHospitalCD & "'"
                                                'w_Sql = w_Sql & ", " & Convert.ToString(w_CurrentDate)
                                                'w_Sql = w_Sql & ", '" & m_StaffData(w_Index).ID & "'"
                                                'w_Sql = w_Sql & ", '" & w_KinmuCD & "'"
                                                'w_Sql = w_Sql & ", '" & w_RiyuKBN & "'"
                                                'w_Sql = w_Sql & ", '" & w_Comment & "'" '2015/04/10 Bando Add 
                                                'w_Sql = w_Sql & ", " & w_SysDate
                                                'w_Sql = w_Sql & ", " & w_SysDate
                                                'w_Sql = w_Sql & ", '" & General.g_strUserID & "'"
                                                'w_Sql = w_Sql & " )"
                                                'w_Sql = w_Sql & " "
                                                'Call General.paDBExecute(w_Sql)
                                                '<34>
                                                Call NSK0000H_sql.insert_NS_KINMUPLAN_F_01(w_CurrentDate,
                                                                                          m_StaffData(w_Index).ID,
                                                                                          w_KinmuCD,
                                                                                          w_RiyuKBN,
                                                                                          w_Comment,
                                                                                          w_SysDate)
                                                'RICHARD UPDATE END

                                            End If

                                            m_StaffData(w_Index).SaikeiData(w_Cnt).KinmuCD = w_KinmuCD
                                            m_StaffData(w_Index).SaikeiData(w_Cnt).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_Index).SaikeiData(w_Cnt).Date_Renamed = w_CurrentDate
                                            m_StaffData(w_Index).SaikeiData(w_Cnt).DataChk = M_DataFlg_Update
                                            m_StaffData(w_Index).SaikeiData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                        End If '---> 再掲ﾃﾞｰﾀあり？
                                    End If '---> 勤務ﾃﾞｰﾀが実績ﾃﾞｰﾀ？
                                End If '---> 勤務CD設定 再掲勤務？
                            End If
                        Next w_Col

                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                End If
            Next w_Row

            'ｺﾐｯﾄ
            Call General.paCommit()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '確定済みかを検索する
    '   戻り値：True（確定済），False（未確定）
    Private Function SearchKakuteiData() As Boolean

        Const W_SUBNAME As String = "NSK0000HA SearchKakuteiData"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Bool As Boolean
        Try
            'RICHARD UPDATE START
            'w_Sql = "SELECT DECISIONDATE"
            'w_Sql = w_Sql & " FROM NS_PLANDECISION_F"
            'w_Sql = w_Sql & " WHERE PLANNO = " & Convert.ToString(m_PlanNo)
            'w_Sql = w_Sql & " AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANDECISION_F_01(w_Rs, m_PlanNo) '<24>
            'RICHARD UPDATE END
            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀ無しの場合は未確定
                    w_Bool = False
                Else
                    'ﾃﾞｰﾀありの場合は未確定（1件のみ）
                    w_Bool = True
                End If
            End With
            w_Rs.Close()

            '戻り値設定
            SearchKakuteiData = w_Bool

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '採用されていれていて、転退してないか
    '   戻り値：True（在職），False（在職してない）
    Private Function SearchZaisyoku(ByVal p_StaffID As String, ByVal p_Date As Integer) As Boolean

        Const W_SUBNAME As String = "NSK0000HA SearchZaisyoku"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Bool As Boolean
        Dim w_Saiyo_F As ADODB.Field
        Dim w_Tentai_F As ADODB.Field
        Dim w_Int As Integer
        Dim w_RecCnt As Integer
        Dim w_From As Integer
        Dim w_To As Integer

        w_Bool = False
        Try
            If p_Date = 0 Then
                SearchZaisyoku = w_Bool
                Exit Function
            End If
            'RICHARD UPDATE START
            'w_Sql = "SELECT EMPDATE, RETIREDATE"
            'w_Sql = w_Sql & " FROM NS_STAFFMNGHISTORY_F"
            'w_Sql = w_Sql & " WHERE STAFFMNGID = '" & p_StaffID & "'"
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_STAFFMNGHISTORY_F_02(w_Rs, p_StaffID) '<14>
            'RICHARD UPDATE END

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀ無しの場合
                Else
                    'ﾃﾞｰﾀありの場合
                    .MoveLast()
                    w_RecCnt = .RecordCount
                    .MoveFirst()

                    w_Saiyo_F = .Fields("EmpDate")
                    w_Tentai_F = .Fields("RetireDate")

                    For w_Int = 1 To w_RecCnt
                        w_From = IIf(IsDBNull(w_Saiyo_F.Value), 0, w_Saiyo_F.Value)
                        w_To = IIf(IsDBNull(w_Tentai_F.Value), 99999999, w_Tentai_F.Value)

                        If w_From <= p_Date AndAlso p_Date <= w_To Then
                            w_Bool = True
                            Exit For
                        End If

                        .MoveNext()
                    Next w_Int
                End If
            End With
            w_Rs.Close()

            '戻り値設定
            SearchZaisyoku = w_Bool

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '******************************
    '   ｾﾙの大きさを設定する
    '******************************
    Private Sub Set_CellSize()

        Const W_SUBNAME As String = "NSK0000HA Set_CellSize"

        Dim w_DataAreaLoop As Integer
        Dim w_WeekLoop As Integer
        Dim w_WeekCnt As Integer
        Dim w_TeamLoop As Integer
        Dim w_TeamCnt As Integer
        Dim w_BeforeWeek As Integer
        Dim w_Dbl As Double
        Dim w_ColCnt As Integer
        Dim w_blnFlgA As Boolean
        Dim w_blnFlgB As Boolean
        Dim w_blnDutyUseFlg As Boolean
        Dim w_blnJissekiUseFlg As Boolean
        Dim w_blnAppliUseFlg As Boolean
        Dim w_from As Integer
        Dim w_to As Integer
        Dim idx As Integer
        Dim var As Object
        Dim setSize As Integer
        Dim wkCellType As FarPoint.Win.Spread.CellType.ButtonCellType
        Dim w_Style As FarPoint.Win.Spread.StyleInfo
        Dim w_empMark As String = String.Empty
        Dim w_empColor As Color
        Dim w_font As Font
        Dim w_FontSize As Integer
        w_blnDutyUseFlg = False
        w_blnJissekiUseFlg = False
        w_blnAppliUseFlg = False
        Try
            Call Get_UseFlg(w_blnDutyUseFlg, w_blnJissekiUseFlg, w_blnAppliUseFlg)

            '***************************
            '   各セルの幅設定
            '***************************

            '№、氏名列
            If sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth > m_CellWidth Then
                w_Dbl = sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth
            Else
                w_Dbl = m_CellWidth
            End If
            sprSheet_M.Sheets(0).SetColumnWidth(M_HyojiNo_Col, w_Dbl) 'ﾒｲﾝｽﾌﾟﾚｯﾄﾞ設定
            sprDayTotal_M.Sheets(0).SetColumnWidth(M_HyojiNo_Col, w_Dbl) '固定日別集計ｽﾌﾟﾚｯﾄﾞ設定
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '４週／１ヶ月の場合
                sprSheet_4W.Sheets(0).SetColumnWidth(M_HyojiNo_Col, w_Dbl) 'ﾒｲﾝｽﾌﾟﾚｯﾄﾞ設定
                sprDayTotal_4W.Sheets(0).SetColumnWidth(M_HyojiNo_Col, w_Dbl) '固定日別集計ｽﾌﾟﾚｯﾄﾞ設定
            End If

            '氏名列
            If sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth > sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth Then
                w_Dbl = sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth
            Else
                w_Dbl = sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth
            End If
            sprSheet_M.Sheets(0).SetColumnWidth(M_StaffName_Col, w_Dbl) 'ﾒｲﾝｽﾌﾟﾚｯﾄﾞ設定
            sprDayTotal_M.Sheets(0).SetColumnWidth(M_StaffName_Col, w_Dbl) '固定日別集計ｽﾌﾟﾚｯﾄﾞ設定
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '４週／１ヶ月の場合
                sprSheet_4W.Sheets(0).SetColumnWidth(M_StaffName_Col, w_Dbl) 'ﾒｲﾝｽﾌﾟﾚｯﾄﾞ設定
                sprDayTotal_4W.Sheets(0).SetColumnWidth(M_StaffName_Col, w_Dbl) '固定日別集計ｽﾌﾟﾚｯﾄﾞ設定
            End If

            If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                '１ヶ月表示の場合

                '集計部分設定
                w_ColCnt = 0
                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '実績部分集計列設定
                    For w_DataAreaLoop = m_JissekiKikan.PersonalStartCol To m_JissekiKikan.PersonalEndCol
                        '労働時間対応
                        w_ColCnt = w_ColCnt + 1
                        If w_ColCnt <= UBound(m_HMtrx) Then
                            If m_HMtrx(w_ColCnt).CntKbn = "1" And m_intLastSumDispFlg = 1 Then
                                sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                sprDayTotal_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                            Else
                                sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                sprDayTotal_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            End If
                        Else
                            sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            sprDayTotal_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        End If
                    Next w_DataAreaLoop
                End If

                '集計部分設定
                w_ColCnt = 0
                If m_TotalFrozen = True Then
                    '集計が固定されている場合は、ﾒｲﾝｽﾌﾟﾚｯﾄﾞの個人別集計を非表示する
                    For w_DataAreaLoop = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                        sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        sprDayTotal_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                    Next w_DataAreaLoop
                Else
                    '集計が固定されていない場合
                    For w_DataAreaLoop = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                        sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                        sprDayTotal_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                    Next w_DataAreaLoop
                End If

                '固定集計ｽﾌﾟﾚｯﾄﾞ
                For w_DataAreaLoop = m_KeikakuKikan.KoteiStartCol To m_KeikakuKikan.KoteiEndCol
                    '労働時間・累計時間対応
                    If w_DataAreaLoop + 1 <= UBound(m_HMtrx) Then
                        If m_HMtrx(w_DataAreaLoop + 1).CntKbn = "1" OrElse
                                m_HMtrx(w_DataAreaLoop + 1).CntKbn = "6" OrElse
                                m_HMtrx(w_DataAreaLoop + 1).CntKbn = "8" Then
                            sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                            w_blnFlgA = True
                        Else
                            sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth_Kotei)
                            w_blnFlgB = True
                        End If
                    Else
                        sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                    End If
                Next w_DataAreaLoop
                '４週用集計部分は非表示
                w_WeekCnt = UBound(m_4WeekKikan)
                For w_WeekLoop = 1 To w_WeekCnt
                    For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KoteiStartCol To m_4WeekKikan(w_WeekLoop).KoteiEndCol
                        'セル幅を０にする
                        sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                    Next w_DataAreaLoop
                Next w_WeekLoop
            Else
                '４週表示の場合
                w_blnFlgA = False
                w_blnFlgB = False

                w_BeforeWeek = 0
                If m_SelViewKikan - 1 > 0 AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                    '選択４週の前４週が存在する場合
                    w_BeforeWeek = m_SelViewKikan - 1
                End If

                '４週期間分Loop
                w_WeekCnt = UBound(m_4WeekKikan)
                For w_WeekLoop = 1 To w_WeekCnt
                    If w_WeekLoop = m_SelViewKikan Then
                        '選択４週期間
                        w_ColCnt = 0
                        If m_TotalFrozen = True Then
                            '集計が固定されている場合は、ﾒｲﾝｽﾌﾟﾚｯﾄﾞの個人別集計を非表示する
                            For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                                sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            Next w_DataAreaLoop
                        Else
                            '集計が固定されていない場合
                            For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                                w_ColCnt = w_ColCnt + 1
                                If w_ColCnt <= UBound(m_HMtrx_4Week) Then
                                    sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                    sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                Else
                                    sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                    sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                End If
                            Next w_DataAreaLoop
                        End If

                        '固定集計ｽﾌﾟﾚｯﾄﾞ
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KoteiStartCol To m_4WeekKikan(w_WeekLoop).KoteiEndCol
                            '労働時間対応
                            w_ColCnt = w_ColCnt + 1
                            If w_ColCnt <= UBound(m_HMtrx_4Week) Then
                                If m_HMtrx_4Week(w_ColCnt).CntKbn = "1" OrElse
                                        m_HMtrx_4Week(w_ColCnt).CntKbn = "8" Then
                                    sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                    w_blnFlgA = True
                                Else
                                    sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth_Kotei)
                                    w_blnFlgB = True
                                End If
                            Else
                                sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            End If
                        Next w_DataAreaLoop
                    ElseIf w_WeekLoop = w_BeforeWeek Then
                        '選択４週間の前４週間
                        w_ColCnt = 0
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                            w_ColCnt = w_ColCnt + 1

                            '労働時間対応
                            If w_ColCnt <= UBound(m_HMtrx_4Week) Then
                                If m_HMtrx_4Week(w_ColCnt).CntKbn = "1" And m_intLastSumDispFlg = 1 Then
                                    sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                    sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                Else
                                    sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                    sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                End If
                            Else
                                sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            End If
                        Next w_DataAreaLoop
                        '固定集計ｽﾌﾟﾚｯﾄﾞ
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KoteiStartCol To m_4WeekKikan(w_WeekLoop).KoteiEndCol
                            sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        Next w_DataAreaLoop
                    Else
                        '表示対象期間とその実績期間以外の場合
                        '勤務ﾃﾞｰﾀｴﾘｱ
                        w_ColCnt = 0
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KinmuDataStartCol To m_4WeekKikan(w_WeekLoop).KinmuDataEndCol
                            'セル幅を０に設定
                            sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        Next w_DataAreaLoop
                        '集計ｴﾘｱ
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                            'セル幅を０に設定
                            sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            sprDayTotal_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        Next w_DataAreaLoop
                        '固定集計ｽﾌﾟﾚｯﾄﾞ
                        For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KoteiStartCol To m_4WeekKikan(w_WeekLoop).KoteiEndCol
                            sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                        Next w_DataAreaLoop
                    End If
                Next w_WeekLoop

                '固定集計ｽﾌﾟﾚｯﾄﾞの１ヶ月用集計列を非表示に
                For w_DataAreaLoop = m_KeikakuKikan.KoteiStartCol To m_KeikakuKikan.KoteiEndCol
                    sprPTotal.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                Next w_DataAreaLoop
            End If

            '職員属性格納セルを非表示に
            For w_DataAreaLoop = 1 To UBound(m_StaffZokusei)
                sprSheet_M.Sheets(0).SetColumnWidth(m_StaffZokusei(w_DataAreaLoop).SetCol_M, M_HideCellWidth_StaffDataCol) '１ヶ月用ｽﾌﾟﾚｯﾄﾞ
                sprSheet_4W.Sheets(0).SetColumnWidth(m_StaffZokusei(w_DataAreaLoop).SetCol_4W, M_HideCellWidth_StaffDataCol) '４週用ｽﾌﾟﾚｯﾄﾞ
                sprPTotal.Sheets(0).SetColumnWidth(m_StaffZokusei(w_DataAreaLoop).SetCol_PTotal, M_HideCellWidth_StaffDataCol) '固定集計部分ｽﾌﾟﾚｯﾄﾞ
            Next w_DataAreaLoop

            '採用列の情報を期間に合わせる
            If m_SelViewKikan = 0 Then
                idx = 1
                w_from = m_KeikakuKikan.StartDate
                w_to = m_KeikakuKikan.EndDate
                setSize = m_StaffZokusei(M_HairetuNo).SetCol_M
            Else
                idx = 2
                w_from = m_4WeekKikan(m_SelViewKikan).StartDate
                w_to = m_4WeekKikan(m_SelViewKikan).EndDate
                setSize = m_StaffZokusei(M_HairetuNo).SetCol_4W
            End If
            'フォントサイズ
            Select Case m_FontIndex
                Case M_MenuFontBig
                    w_FontSize = M_FontSize_Big
                Case M_MenuFontMiddle
                    w_FontSize = M_FontSize_Middle
                Case M_MenuFontSmall
                    w_FontSize = M_FontSize_Small
            End Select
            w_font = New Font("Arial", w_FontSize - 1, FontStyle.Bold)
            'ｽﾌﾟﾚｯﾄﾞのﾃﾞｰﾀ行分Loop
            For i_Row As Integer = m_StaffRow.StartRow To m_StaffRow.EndRow
                If (i_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                    '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                    var = m_Spread(idx).Sheets(0).GetText(i_Row, setSize)

                    '採用条件マーク
                    If fncGetEmpMark(Integer.Parse(var), w_from, w_to, w_empMark, w_empColor) Then
                        wkCellType = New FarPoint.Win.Spread.CellType.ButtonCellType
                        w_Style = New FarPoint.Win.Spread.StyleInfo()
                        wkCellType.Text = w_empMark
                        wkCellType.ButtonColor = w_empColor
                        w_Style.Reset()
                        w_Style.CellType = wkCellType
                        w_Style.HorizontalAlignment = CellHorizontalAlignment.Center
                        w_Style.Locked = True
                        m_Spread(idx).Sheets(0).Models.Style.SetDirectInfo(i_Row, M_EmpShrtNghtData_Col, w_Style)
                        m_Spread(idx).Sheets(0).Cells(i_Row, M_EmpShrtNghtData_Col).Font = w_font
                    End If
                End If
            Next
            For i As Integer = 1 To UBound(m_StaffData)

            Next

            '***************************
            '   各セルの高さ設定
            '***************************
            'タイトル行の設定
            '計画期間色設定行（Interval行）
            w_Dbl = m_CellHeight / 3
            sprSheet_M.Sheets(0).SetRowHeight(M_Interval_Row, w_Dbl)
            sprSheet_4W.Sheets(0).SetRowHeight(M_Interval_Row, w_Dbl)
            sprPTotal.Sheets(0).SetRowHeight(M_Interval_Row, w_Dbl)
            '曜日設定行
            sprSheet_M.Sheets(0).SetRowHeight(M_YYYYMMDDLabel_Row, M_HideCellHeight_FullDateRow)
            sprSheet_4W.Sheets(0).SetRowHeight(M_YYYYMMDDLabel_Row, M_HideCellHeight_FullDateRow)
            sprPTotal.Sheets(0).SetRowHeight(M_YYYYMMDDLabel_Row, M_HideCellHeight_FullDateRow)

            '行事予定行
            If Not m_GyoujiFlg Then
                sprSheet_M.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
                sprSheet_4W.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
                sprPTotal.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
            Else
                sprSheet_M.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
                sprSheet_4W.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
                sprPTotal.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
            End If

            'ﾃﾞｰﾀ部の高さ（職員データ表示行を一旦Loop）
            For w_DataAreaLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                If w_DataAreaLoop < m_ViewRow.StartRow OrElse m_ViewRow.EndRow < w_DataAreaLoop Then
                    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                    sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                    sprPTotal.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                ElseIf (w_DataAreaLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then
                    '日当直
                    If w_blnDutyUseFlg = False Then
                        '表示しないときは幅「０」
                        sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprPTotal.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                    End If
                ElseIf (w_DataAreaLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                    '勤務実績
                    If w_blnJissekiUseFlg = False Then
                        '表示しないときは幅「０」
                        sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprPTotal.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                    End If
                ElseIf (w_DataAreaLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                    '届出
                    If w_blnAppliUseFlg = False Then
                        '表示しないときは幅「０」
                        sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                        sprPTotal.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_PlanTwoRow)
                    End If
                End If
            Next w_DataAreaLoop

            '固定集計部（日別）
            If m_TotalFrozen = True Then
                '集計が固定されている場合
                For w_DataAreaLoop = m_DayAreaRow.StartRow To m_DayAreaRow.EndRow
                    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                    sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                Next w_DataAreaLoop
            Else
                '集計が固定されていない場合
                w_TeamCnt = UBound(m_DayDataRow)
                For w_TeamLoop = 1 To w_TeamCnt
                    If m_SelTeamNo <> w_TeamLoop Then
                        For w_DataAreaLoop = m_DayDataRow(w_TeamLoop).StartRow To m_DayDataRow(w_TeamLoop).EndRow
                            sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                            sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                        Next w_DataAreaLoop
                    End If
                Next w_TeamLoop
            End If

            '固定集計ｽﾌﾟﾚｯﾄﾞ設定
            w_TeamCnt = UBound(m_DayDataRow)
            For w_TeamLoop = 1 To w_TeamCnt
                If m_SelTeamNo <> w_TeamLoop Then
                    For w_DataAreaLoop = m_DayDataRow(w_TeamLoop).KoteiStartRow To m_DayDataRow(w_TeamLoop).KoteiEndRow
                        sprDayTotal_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                        sprDayTotal_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TeamRow)
                    Next w_DataAreaLoop
                Else
                    For w_DataAreaLoop = 0 To Integer.Parse(UBound(m_VMtrx)) - 1
                        If w_DataAreaLoop + 1 > m_lngRowFrozen Then
                            sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_DataAreaLoop, M_HideCellHeight_TeamRow)
                            sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_DataAreaLoop, M_HideCellHeight_TeamRow)
                        End If
                    Next w_DataAreaLoop

                    'sprDayTotal_M------------------------------------------------
                    If UBound(m_VMtrx) > m_lngRowFrozen Then
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + m_lngRowFrozen, m_KeikakuKikan.PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + m_lngRowFrozen, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    Else
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + UBound(m_VMtrx) - 1, m_KeikakuKikan.PersonalEndCol, 1, 1, 1, 1, 2, Color.Black)
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + UBound(m_VMtrx) - 1, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    End If

                    If UBound(m_VMtrx) > m_lngRowFrozen Then
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), m_KeikakuKikan.KinmuDataStartCol, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + m_lngRowFrozen, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    Else
                        Call SetBorder(sprDayTotal_M, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), m_KeikakuKikan.KinmuDataStartCol, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + UBound(m_VMtrx) - 1, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    End If
                    'sprDayTotal_M------------------------------------------------

                    'sprDayTotal_4W-----------------------------------------------
                    If UBound(m_VMtrx) > m_lngRowFrozen Then
                        Call SetBorder(sprDayTotal_4W, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + m_lngRowFrozen, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                        Call SetBorder(sprDayTotal_4W, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + m_lngRowFrozen, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    Else
                        Call SetBorder(sprDayTotal_4W, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + UBound(m_VMtrx) - 1, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                        Call SetBorder(sprDayTotal_4W, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)), M_KinmuDataStart_Col, Long.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + UBound(m_VMtrx) - 1, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    End If

                    For w_DataAreaLoop = 1 To UBound(m_4WeekKikan)
                        '4週期間

                        '固定日別集計部（4週用）
                        If sprDayTotal_4W.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                            Call SetBorder(sprDayTotal_4W, 0, m_4WeekKikan(w_DataAreaLoop).KinmuDataStartCol, sprDayTotal_4W.Sheets(0).RowCount - 1, m_4WeekKikan(w_DataAreaLoop).KinmuDataEndCol, 0, 0, 0, 0, 2, Color.Black)
                        End If
                    Next w_DataAreaLoop
                End If
            Next w_TeamLoop

            For w_DataAreaLoop = 0 To Integer.Parse(UBound(m_VMtrx)) - 1
                If w_DataAreaLoop + 1 > m_lngRowFrozen Then
                    sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_DataAreaLoop, M_HideCellHeight_TeamRow)
                    sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_DataAreaLoop, M_HideCellHeight_TeamRow)
                End If
            Next w_DataAreaLoop

            'コピーｴﾘｱの高さ設定
            '2016/04/05 Ishiga upd start--------------------------------------------------------------------------------------------------------------------------------------
            'For w_DataAreaLoop = m_CopyArea.StartRow To m_CopyArea.EndRow
            '    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TempAreaRow)
            '    sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TempAreaRow)
            'Next w_DataAreaLoop
            sprSheet_M.Sheets(0).SetMultipleRowHeights(m_CopyArea.StartRow, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, M_HideCellHeight_TempAreaRow)
            sprSheet_4W.Sheets(0).SetMultipleRowHeights(m_CopyArea.StartRow, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, M_HideCellHeight_TempAreaRow)
            '2016/04/05 Ishiga upd end----------------------------------------------------------------------------------------------------------------------------------------

            'Undoｴﾘｱの高さ設定
            '2016/04/05 Ishiga upd start--------------------------------------------------------------------------------------------------------------------------------------
            'For w_DataAreaLoop = m_UndoArea.StartRow To m_UndoArea.EndRow
            '    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TempAreaRow)
            '    sprSheet_4W.Sheets(0).SetRowHeight(w_DataAreaLoop, M_HideCellHeight_TempAreaRow)
            'Next w_DataAreaLoop
            sprSheet_M.Sheets(0).SetMultipleRowHeights(m_UndoArea(1).StartRow, m_UndoArea(m_UndoMaxKensu).EndRow - m_UndoArea(1).StartRow + 1, M_HideCellHeight_TempAreaRow)
            sprSheet_4W.Sheets(0).SetMultipleRowHeights(m_UndoArea(1).StartRow, m_UndoArea(m_UndoMaxKensu).EndRow - m_UndoArea(1).StartRow + 1, M_HideCellHeight_TempAreaRow)
            '2016/04/05 Ishiga upd end----------------------------------------------------------------------------------------------------------------------------------------

            m_intCalcSpr_Flg = m_intCalcSpr_Flg + 1

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_CopyMenu(ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_BlockSel As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Set_CopyMenu"

        Dim w_Int As Integer
        Dim w_Var As Object
        Dim w_blnFLG As Boolean
        Dim w_Spr As FpSpread
        Try
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                'ｾﾙﾌﾟﾛｯｸ選択 の場合
                If p_BlockSel Then
                    '「切り取り」「コピー」「貼り付け」を使用不可にする
                    m_blnPopupFLG = False
                    m_lstmnuPopup(M_PopCut).Enabled = False
                    m_lstmnuEdit(M_MenuCut).Enabled = False
                    m_lstmnuPopup(M_PopCopy).Enabled = False
                    m_lstmnuEdit(M_MenuCopy).Enabled = False
                    m_lstmnuPopup(M_PopPaste).Enabled = False
                    m_lstmnuEdit(M_MenuPaste).Enabled = False

                    '1ｾﾙ選択 の場合
                ElseIf m_StaffRow.StartRow <= p_Row AndAlso p_Row <= m_StaffRow.EndRow Then
                    w_blnFLG = False

                    If m_SelViewKikan = 0 Then
                        If m_KeikakuKikan.KinmuDataStartCol <= p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol Then
                            '1ヶ月用
                            w_Spr = sprSheet_M
                            w_blnFLG = True
                        End If
                    Else
                        For w_Int = 1 To UBound(m_4WeekKikan)
                            If m_4WeekKikan(w_Int).KinmuDataStartCol <= p_Col AndAlso p_Col <= m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                '４週用
                                w_Spr = sprSheet_4W
                                w_blnFLG = True
                            End If
                        Next w_Int
                    End If

                    If w_blnFLG Then
                        If ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData) OrElse ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData) Then
                            '日当直と届出の段が選択されてる時
                            '「切り取り」と「コピー」と「貼り付け」を使用不可にする
                            m_blnPopupFLG = False
                            m_lstmnuPopup(M_PopCut).Enabled = False
                            m_lstmnuEdit(M_MenuCut).Enabled = False
                            m_lstmnuPopup(M_PopCopy).Enabled = False
                            m_lstmnuEdit(M_MenuCopy).Enabled = False
                            m_lstmnuPopup(M_PopPaste).Enabled = False
                            m_lstmnuEdit(M_MenuPaste).Enabled = False
                        Else
                            '勤務の段が選択されてる時
                            If m_blnJissekiUseFlg Then

                                w_Var = w_Spr.Sheets(0).GetText(p_Row, p_Col)

                                '勤務実績の段が表示されてる時
                                If w_Spr.Sheets(0).Cells(p_Row, p_Col).BackColor.Equals(Color.Black) Then
                                    '背景色が黒の時
                                    '「切り取り」と「コピー」と「貼り付け」を使用不可にする
                                    m_blnPopupFLG = False
                                    m_lstmnuPopup(M_PopCut).Enabled = False
                                    m_lstmnuEdit(M_MenuCut).Enabled = False
                                    m_lstmnuPopup(M_PopCopy).Enabled = False
                                    m_lstmnuEdit(M_MenuCopy).Enabled = False
                                    m_lstmnuPopup(M_PopPaste).Enabled = False
                                    m_lstmnuEdit(M_MenuPaste).Enabled = False
                                ElseIf (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                    '勤務予定の段が選択されてる時
                                    '「切り取り」と「貼り付け」を使用不可にする
                                    m_blnPopupFLG = False
                                    m_lstmnuPopup(M_PopCut).Enabled = False
                                    m_lstmnuEdit(M_MenuCut).Enabled = False

                                    w_Var = w_Spr.Sheets(0).GetText(p_Row + 1, p_Col)
                                    If w_Var <> "" Then
                                        m_lstmnuPopup(M_PopCopy).Enabled = False
                                        m_lstmnuEdit(M_MenuCopy).Enabled = False
                                    Else
                                        m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                                        m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                                    End If
                                    m_lstmnuPopup(M_PopPaste).Enabled = False
                                    m_lstmnuEdit(M_MenuPaste).Enabled = False
                                ElseIf w_Var <> "" Then
                                    '勤務実績の段にデータが存在する時
                                    '元に戻す
                                    m_blnPopupFLG = True
                                    m_lstmnuPopup(M_PopCut).Enabled = False
                                    m_lstmnuEdit(M_MenuCut).Enabled = False
                                    m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                                    m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                                    m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopPasteFLG
                                    m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopPasteFLG
                                Else
                                    '勤務実績の段にデータが存在しない時
                                    '「切り取り」と「コピー」を使用不可にする
                                    m_blnPopupFLG = True
                                    m_lstmnuPopup(M_PopCut).Enabled = False
                                    m_lstmnuEdit(M_MenuCut).Enabled = False
                                    m_lstmnuPopup(M_PopCopy).Enabled = False
                                    m_lstmnuEdit(M_MenuCopy).Enabled = False
                                    m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopPasteFLG
                                    m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopPasteFLG
                                End If
                            Else
                                '勤務実績の段が表示されてない時
                                '元に戻す
                                m_blnPopupFLG = True
                                m_lstmnuPopup(M_PopCut).Enabled = False
                                m_lstmnuEdit(M_MenuCut).Enabled = False
                                m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                                m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                                m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopPasteFLG
                                m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopPasteFLG
                            End If
                        End If
                    End If
                End If
            Else
                If m_StaffRow.StartRow <= p_Row AndAlso p_Row <= m_StaffRow.EndRow Then
                    w_blnFLG = False

                    If m_SelViewKikan = 0 Then
                        '2014/05/28 Shibata add start P-06983 ---------------------------------------
                        If p_Col < m_KeikakuKikan.KinmuDataStartCol Then
                            If ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData) OrElse ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData) Then
                                m_lstmnuEdit(M_MenuCut).Enabled = False
                                m_lstmnuPopup(M_PopCut).Enabled = False
                                m_lstmnuEdit(M_MenuPaste).Enabled = False
                                m_lstmnuPopup(M_PopPaste).Enabled = False
                                m_lstmnuEdit(M_MenuCopy).Enabled = False
                                m_lstmnuPopup(M_PopCopy).Enabled = False
                            Else
                                m_lstmnuEdit(M_MenuCut).Enabled = False
                                m_lstmnuPopup(M_PopCut).Enabled = False
                                m_lstmnuEdit(M_MenuPaste).Enabled = False
                                m_lstmnuPopup(M_PopPaste).Enabled = False
                                m_lstmnuEdit(M_MenuCopy).Enabled = True
                                m_lstmnuPopup(M_PopCopy).Enabled = True
                            End If

                            Exit Sub
                        End If
                        '2014/05/28 Shibata add end P-06983 ---------------------------------------
                        If m_KeikakuKikan.KinmuDataStartCol <= p_Col AndAlso p_Col <= m_KeikakuKikan.KinmuDataEndCol Then
                            '1ヶ月用
                            w_Spr = sprSheet_M
                            w_blnFLG = True
                        End If
                    Else
                        '2014/05/28 Shibata add start P-06983 ---------------------------------------
                        Dim w_KikanStartCol As Integer
                        Dim w_KikanEndCol As Integer
                        If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                            '勤務ﾃﾞｰﾀ開始列格納
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                                w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                            End If
                        Else
                            '勤務ﾃﾞｰﾀ開始列格納
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                        If m_KeikakuKikan.EndDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                            '勤務ﾃﾞｰﾀ開始列格納
                            If Get_Col_4W(m_KeikakuKikan.EndDate, w_KikanEndCol) = False Then
                                w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                            End If
                        Else
                            '勤務ﾃﾞｰﾀ開始列格納
                            w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                        End If

                        If Not ((w_KikanStartCol <= p_Col) AndAlso (p_Col <= w_KikanEndCol)) Then
                            If ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData) OrElse ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData) Then
                                m_lstmnuEdit(M_MenuCut).Enabled = False
                                m_lstmnuPopup(M_PopCut).Enabled = False
                                m_lstmnuEdit(M_MenuPaste).Enabled = False
                                m_lstmnuPopup(M_PopPaste).Enabled = False
                                m_lstmnuEdit(M_MenuCopy).Enabled = False
                                m_lstmnuPopup(M_PopCopy).Enabled = False
                            Else
                                m_lstmnuEdit(M_MenuCut).Enabled = False
                                m_lstmnuPopup(M_PopCut).Enabled = False
                                m_lstmnuEdit(M_MenuPaste).Enabled = False
                                m_lstmnuPopup(M_PopPaste).Enabled = False
                                m_lstmnuEdit(M_MenuCopy).Enabled = True
                                m_lstmnuPopup(M_PopCopy).Enabled = True
                            End If

                            Exit Sub
                        End If
                        '2014/05/28 Shibata add end P-06983 ---------------------------------------
                        For w_Int = 1 To UBound(m_4WeekKikan)
                            If m_4WeekKikan(w_Int).KinmuDataStartCol <= p_Col AndAlso p_Col <= m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                '４週用
                                w_Spr = sprSheet_4W
                                w_blnFLG = True
                            End If
                        Next w_Int
                    End If

                    If w_blnFLG Then
                        If ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData) OrElse ((p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData) Then
                            '日当直と届出の段が選択されてる時
                            '「切り取り」と「コピー」と「貼り付け」を使用不可にする
                            m_blnPopupFLG = False
                            m_lstmnuPopup(M_PopCut).Enabled = False
                            m_lstmnuEdit(M_MenuCut).Enabled = False
                            m_lstmnuPopup(M_PopCopy).Enabled = False
                            m_lstmnuEdit(M_MenuCopy).Enabled = False
                            m_lstmnuPopup(M_PopPaste).Enabled = False
                            m_lstmnuEdit(M_MenuPaste).Enabled = False
                        Else
                            '勤務の段が選択されてる時
                            '元に戻す
                            m_blnPopupFLG = True
                            m_lstmnuPopup(M_PopCut).Enabled = m_blnPopCutFLG
                            m_lstmnuEdit(M_MenuCut).Enabled = m_blnPopCutFLG
                            m_lstmnuPopup(M_PopCopy).Enabled = m_blnPopCopyFLG
                            m_lstmnuEdit(M_MenuCopy).Enabled = m_blnPopCopyFLG
                            m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopPasteFLG
                            m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopPasteFLG
                        End If
                    End If
                End If
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_ComboBoxCtrl()

        Const W_SUBNAME As String = "NSK0000HA Set_ComboBoxCtrl"

        Dim w_i As Integer
        Dim w_WeekCnt As Integer
        Dim w_str As String
        Dim w_Date As Date
        Dim w_ComboLeft As Single
        Dim w_ComboWidth As Single
        Dim w_ToolBarHeight As Single
        Dim w_TeamVisible As Boolean
        Dim w_KikanVisible As Boolean
        Dim w_strSql As String
        Dim w_lngCnt As Short
        Dim w_HyoujijunMeiVisible As Boolean
        Dim w_HyoujijunMei As ADODB.Recordset
        Dim w_表示順名_F As ADODB.Field
        Dim w_HﾏｽﾀｰCD_F As ADODB.Field

        Dim w_TeamCnt As Integer
        Dim w_CmbCnt As Integer
        Try
            'もし応援勤務者がいない場合
            If m_OuenTeam <= 0 Then
                w_TeamCnt = m_TeamCnt
            Else
                w_TeamCnt = m_OuenTeam
            End If

            'チームｺﾝﾎﾞﾎﾞｯｸｽ設定
            cmbTeam.Items.Clear()
            If w_TeamCnt >= 2 Then
                'チーム分けありの場合（Indexがそのままチーム番号に）
                cmbTeam.Items.Add("すべて")
                For w_i = 1 To w_TeamCnt
                    If w_i = m_OuenTeam Then
                        cmbTeam.Items.Add(Space(1) & "応援者")
                    Else
                        cmbTeam.Items.Add(Space(1) & Convert.ToString(StrConv(Convert.ToString(w_i), VbStrConv.Wide)))
                    End If
                Next w_i
                cmbTeam.Enabled = True
                fraTeam.Visible = True
                w_TeamVisible = True
            Else
                'チーム分けがない場合
                cmbTeam.Enabled = False
                fraTeam.Visible = False
                w_TeamVisible = False
                m_lstmnuData(M_MenuTeamSelect).Available = False
            End If

            '期間指定ｺﾝﾎﾞﾎﾞｯｸｽ設定
            cmbKikan.Items.Clear()
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '４週／１ヶ月の場合のみ
                If IsDate(Format(m_KeikakuKikan.StartDate, "0000/00/00")) = True Then
                    w_Date = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))
                    w_str = Space(1) & Convert.ToString(StrConv(Format(w_Date, "yyyy"), VbStrConv.Wide)) & "年"
                    w_str = w_str & StrConv(String.Format("{0, 2}", Month(w_Date)), VbStrConv.Wide) & "月"
                Else
                    w_str = General.paLeft(Format(m_KeikakuKikan.StartDate, "0000/00/00"), 7)
                End If
                cmbKikan.Items.Add(w_str)
                SetItemData(cmbKikan, 0, 0)
                '４週期間設定（計画対象期間に重なっている部分のみ）
                w_WeekCnt = UBound(m_4WeekKikan)
                For w_i = 1 To w_WeekCnt
                    If m_4WeekKikan(w_i).StartDate <= m_KeikakuKikan.EndDate AndAlso m_KeikakuKikan.StartDate <= m_4WeekKikan(w_i).EndDate Then
                        w_str = Space(1) & Format(m_4WeekKikan(w_i).StartDate, "0000/00/00")
                        w_str = w_str & "～" & Format(m_4WeekKikan(w_i).EndDate, "0000/00/00")
                        cmbKikan.Items.Add(w_str)
                        w_CmbCnt = w_CmbCnt + 1
                        SetItemData(cmbKikan, w_CmbCnt, w_i)
                    End If
                Next w_i
                cmbKikan.Enabled = True
                fraKikanSelect.Visible = True
                w_KikanVisible = True
            Else
                '４週／１ヶ月以外は非表示
                cmbKikan.Enabled = False
                fraKikanSelect.Visible = False
                w_KikanVisible = False
                m_lstmnuData(M_MenuKikanSelect).Available = False
            End If

            '-------------------------------
            '　　表示順名、マスターCD取得
            '-------------------------------
            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_strSql = "SELECT MASTERCD, NAME "
            w_strSql = w_strSql & "FROM NS_HANYOU_M "
            w_strSql = w_strSql & "WHERE HospitalCD = '" & General.g_strHospitalCD & "' "
            w_strSql = w_strSql & "AND MASTERID = 'K002' "
            w_strSql = w_strSql & "ORDER BY DISPNO "
            w_HyoujijunMei = General.paDBRecordSetOpen(w_strSql)

            'ﾚｺｰﾄﾞ件数を知るため最終行に移動する
            If w_HyoujijunMei.RecordCount <= 0 Then
                w_HyoujijunMei.Close()
                Exit Sub
            Else
                'ﾚｺｰﾄﾞ件数格納
                w_HyoujijunMei.MoveLast()
                w_lngCnt = w_HyoujijunMei.RecordCount
                w_HyoujijunMei.MoveFirst()
                'ﾌｨｰﾙﾄﾞ定義
                w_表示順名_F = w_HyoujijunMei.Fields("NAME")
                w_HﾏｽﾀｰCD_F = w_HyoujijunMei.Fields("MASTERCD")
            End If

            '配列に格納
            ReDim m_HyoujijunMeiDate(w_lngCnt)
            For w_i = 1 To w_lngCnt
                m_HyoujijunMeiDate(w_i).HName = General.paGetDbFieldVal(w_表示順名_F, "")
                m_HyoujijunMeiDate(w_i).HMasterCD = General.paGetDbFieldVal(w_HﾏｽﾀｰCD_F, "")
                w_HyoujijunMei.MoveNext()
            Next w_i
            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_HyoujijunMei.Close()

            '表示順ｺﾝﾎﾞﾎﾞｯｸｽ設定()
            cmbHyoujijunMei.Items.Clear()

            '表示順名称格納
            For w_i = 1 To UBound(m_HyoujijunMeiDate)
                m_strHyoujijunMei = m_HyoujijunMeiDate(w_i).HName
                cmbHyoujijunMei.Items.Add(m_strHyoujijunMei)
            Next w_i
            '初期表示
            cmbHyoujijunMei.Text = cmbHyoujijunMei.GetItemText(cmbHyoujijunMei.Items(0))

            cmbHyoujijunMei.Enabled = True
            fraHyoujijunMei.Visible = True
            w_HyoujijunMeiVisible = True

            '変更前
            'If w_TeamVisible = False AndAlso w_KikanVisible = False Then
            If w_TeamVisible = False AndAlso w_KikanVisible = False AndAlso w_HyoujijunMeiVisible = False Then
                Panel1.Visible = False
            End If

            'ﾂｰﾙﾊﾞｰの高さを取得する
            w_ToolBarHeight = tbrMain.Height

            If w_TeamVisible = True Then
                'チーム選択ｺﾝﾎﾞﾎﾞｯｸｽの位置設定
                w_ComboWidth = fraTeam.Width
                '2014/06/20 Y.Doi P-06980 UPD STRAT----------------------
                'w_ComboLeft = tbrMain.Width + tbrMain.Items.Item(tbrMain.Items.Count - 1).Width * 0.5
                w_ComboLeft = tbrMain.Width + 0.5
                '2014/06/20 Y.Doi P-06980 UPD END------------------------
                fraTeam.SetBounds(0, 0, w_ComboWidth, w_ToolBarHeight)
                fraTeam.BringToFront()
                Panel1.SetBounds(w_ComboLeft, tbrMain.Top, w_ComboWidth, w_ToolBarHeight)
                Panel1.BringToFront()
                lblTeam.SetBounds(0, (w_ToolBarHeight - lblTeam.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                cmbTeam.SetBounds(lblTeam.Width, (w_ToolBarHeight - cmbTeam.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
            End If

            If w_KikanVisible = True Then
                '計画期間選択ｺﾝﾎﾞﾎﾞｯｸｽの位置設定
                If w_TeamVisible = True Then
                    fraKikanSelect.SetBounds(w_ComboWidth, 0, fraKikanSelect.Width, w_ToolBarHeight)
                Else
                    fraKikanSelect.SetBounds(0, 0, fraKikanSelect.Width, w_ToolBarHeight)
                    w_ComboLeft = tbrMain.Width + tbrMain.Items.Item(tbrMain.Items.Count - 1).Width * 0.5
                End If
                w_ComboWidth = fraKikanSelect.Left + fraKikanSelect.Width
                fraKikanSelect.BringToFront()
                Panel1.SetBounds(w_ComboLeft, tbrMain.Top, w_ComboWidth, w_ToolBarHeight)
                Panel1.BringToFront()
                lblKikan.SetBounds(0, (w_ToolBarHeight - lblKikan.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                cmbKikan.SetBounds(lblKikan.Width, (w_ToolBarHeight - cmbKikan.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
            End If

            If w_HyoujijunMeiVisible = True Then
                '表示順選択ｺﾝﾎﾞﾎﾞｯｸｽの位置設定
                If w_KikanVisible = True Then
                    fraHyoujijunMei.SetBounds(w_ComboWidth, 0, fraHyoujijunMei.Width, w_ToolBarHeight)
                Else
                    '2013/02/14 Ishiga upd start----------------------------------------------------------------
                    'fraHyoujijunMei.SetBounds(0, 0, fraHyoujijunMei.Width, w_ToolBarHeight)
                    'w_ComboLeft = tbrMain.Width + tbrMain.Items.Item(tbrMain.Items.Count - 1).Width * 0.5
                    If w_TeamVisible = True Then
                        fraHyoujijunMei.SetBounds(w_ComboWidth, 0, fraHyoujijunMei.Width, w_ToolBarHeight)
                    Else
                        fraHyoujijunMei.SetBounds(0, 0, fraHyoujijunMei.Width, w_ToolBarHeight)
                        w_ComboLeft = tbrMain.Width + tbrMain.Items.Item(tbrMain.Items.Count - 1).Width * 0.5
                    End If
                    '2013/02/14 Ishiga upd start----------------------------------------------------------------
                End If
                w_ComboWidth = fraHyoujijunMei.Left + fraHyoujijunMei.Width
                fraHyoujijunMei.BringToFront()
                Panel1.SetBounds(w_ComboLeft, tbrMain.Top, w_ComboWidth, w_ToolBarHeight)
                Panel1.BringToFront()
                lblHyoujijunMei.SetBounds(0, (w_ToolBarHeight - lblHyoujijunMei.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                cmbHyoujijunMei.SetBounds(lblHyoujijunMei.Width, (w_ToolBarHeight - cmbHyoujijunMei.Height) / 2, 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｽﾌﾟﾚｯﾄﾞｼｰﾄ ﾃﾞﾌｫﾙﾄ設定
    Private Function Set_SprSheet() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Set_SprSheet"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_Cnt As Integer
        Dim w_MaxCnt As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_ColorFlg As Boolean
        Dim w_Var As Object
        Dim w_Var_From As Object
        Dim w_Var_To As Object
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_Saturday_Fore As Integer
        Dim w_Saturday_Back As Integer
        Dim w_Sunday_Fore As Integer
        Dim w_Sunday_Back As Integer
        Dim w_Holiday_Fore As Integer
        Dim w_Holiday_Back As Integer
        Dim w_MsgRc As Integer
        Dim w_CalcCol As Integer
        Dim w_CalcRow As Integer
        Dim w_FromCol As Integer
        Dim w_TempDate As Integer
        Dim w_DateMonth As Integer
        Dim w_BoolStart As Boolean
        Dim w_BoolEnd As Boolean
        Dim w_GetBool As Boolean
        '処理経過表示ﾌｫｰﾑ
        Dim w_ProcessForm As Object
        Dim w_TeamCnt As Integer
        Dim w_strMsg() As String
        Dim w_Style As New StyleInfo()
        Dim w_ColLoop As Integer
        Dim w_TextCellType As New CellType.TextCellType
        Dim w_NumCellType As New CellType.NumberCellType
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                ReDim m_Spread(1)
                'ｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                m_Spread(1) = sprSheet_M
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                ReDim m_Spread(2)
                'ｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                m_Spread(1) = sprSheet_M
                m_Spread(2) = sprSheet_4W
            End If

            '全ｽﾌﾟﾚｯﾄﾞの全セルをラベル形に設定する
            sprSheet_M.Sheets(0).RowCount = 1000
            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            w_Style.HorizontalAlignment = CellHorizontalAlignment.Left
            w_Style.VerticalAlignment = CellVerticalAlignment.Center
            w_Style.BackColor = Color.White
            sprSheet_M.Sheets(0).Models.Style.SetDirectInfo(-1, -1, w_Style)

            sprSheet_4W.Sheets(0).RowCount = 1000
            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            w_Style.HorizontalAlignment = CellHorizontalAlignment.Left
            w_Style.VerticalAlignment = CellVerticalAlignment.Center
            w_Style.BackColor = Color.White
            sprSheet_4W.Sheets(0).Models.Style.SetDirectInfo(-1, -1, w_Style)

            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            w_Style.HorizontalAlignment = CellHorizontalAlignment.Right
            w_Style.VerticalAlignment = CellVerticalAlignment.Center
            w_Style.BackColor = Color.White
            sprDayTotal_M.Sheets(0).Models.Style.SetDirectInfo(-1, -1, w_Style)

            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            w_Style.HorizontalAlignment = CellHorizontalAlignment.Right
            w_Style.VerticalAlignment = CellVerticalAlignment.Center
            w_Style.BackColor = Color.White
            sprDayTotal_4W.Sheets(0).Models.Style.SetDirectInfo(-1, -1, w_Style)

            sprPTotal.Sheets(0).RowCount = 1000
            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            w_Style.HorizontalAlignment = CellHorizontalAlignment.Left
            w_Style.VerticalAlignment = CellVerticalAlignment.Center
            w_Style.BackColor = Color.White
            sprPTotal.Sheets(0).Models.Style.SetDirectInfo(-1, -1, w_Style)

            'ｽﾌﾟﾚｯﾄﾞのﾏｳｽﾎﾟｲﾝﾀｰ設定
            sprSheet_M.SetCursor(CursorType.LockedCell, Cursors.Arrow)
            sprSheet_4W.SetCursor(CursorType.LockedCell, Cursors.Arrow)
            sprDayTotal_M.SetCursor(CursorType.LockedCell, Cursors.Arrow)
            sprDayTotal_4W.SetCursor(CursorType.LockedCell, Cursors.Arrow)
            sprPTotal.SetCursor(CursorType.LockedCell, Cursors.Arrow)
            sprScroll.SetCursor(CursorType.LockedCell, Cursors.Arrow)

            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int).Sheets(0)

                    '表示No(整数)
                    Call SubSetStyle(m_Spread(w_Int), -1, M_HyojiNo_Col, -1, M_HyojiNo_Col, 0, 0, , , CellHorizontalAlignment.Right)

                    'ｽﾌﾟﾚｯﾄﾞのｾﾙ属性の設定(初期状態は全て文字ｾﾙ)
                    '行ﾀｲﾄﾙ(ﾗﾍﾞﾙ)
                    Call SubSetStyle(m_Spread(w_Int), 0, -1, M_YYYYMMDDLabel_Row, -1, 1, 0, , SystemColors.Control, CellHorizontalAlignment.Left, CellVerticalAlignment.Center)

                    'ﾀｲﾄﾙ設定
                    w_Var = DirectCast("計画期間", Object)
                    .SetText(M_MonthLabel_Row, M_StaffName_Col, w_Var)
                    w_Var = DirectCast("日 付", Object)
                    .SetText(M_DayLabel_Row, M_StaffName_Col, w_Var)
                    w_Var = DirectCast("曜 日", Object)
                    .SetText(M_WeekLabel_Row, M_StaffName_Col, w_Var)

                    'ﾀｲﾄﾙを中央に
                    Call SubSetStyle(m_Spread(w_Int), 0, M_StaffName_Col, M_WeekLabel_Row, M_StaffName_Col, 0, 0, , , CellHorizontalAlignment.Center)

                    '計画期間行を中央表示に
                    Call SubSetStyle(m_Spread(w_Int), M_MonthLabel_Row, -1, M_MonthLabel_Row, -1, 0, 0, , , CellHorizontalAlignment.Center)
                End With
            Next w_Int

            '-- 自動割当ｴﾝｼﾞﾝ用変数の値 取得/計算 --------
            If Set_AutoAssign() = False Then
                '異常終了
                ReDim w_strMsg(1)
                w_strMsg(1) = "自動割当機能に必要な情報"
                Call Set_MsgZOrder("NS0031", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If

            '-- 文字色/背景色 取得 ------------------
            'ﾚｼﾞｽﾄﾘ格納ﾌｫﾙﾀﾞ文字列の編集
            Const w_RegStr As String = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1 & "\" & "Current"

            '土曜日 文字/背景色
            w_Saturday_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Saturday_Fore", Convert.ToString(General.G_BLUE)))
            w_Saturday_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Saturday_Back", Convert.ToString(General.G_GRAY)))
            '日曜日 文字/背景色
            w_Sunday_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Sunday_Fore", Convert.ToString(General.G_PINK)))
            w_Sunday_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Sunday_Back", Convert.ToString(General.G_GRAY)))
            '祝日 文字/背景色
            w_Holiday_Fore = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Holiday_Fore", Convert.ToString(General.G_RED)))
            w_Holiday_Back = Integer.Parse(General.paGetSetting(w_RegStr, "Color", "Holiday_Back", Convert.ToString(General.G_GRAY)))

            '夜間看護加算情報取得
            If m_YakanKangoDispFlg = 0 Then
                Call Get_YakanKangoM()
            End If

            '-- 勤務記号 配列 作成 ----------
            Call Get_KinmuName()
            '-- 休み分類記号 配列 作成
            Call Get_HolidayBunruiName()
            '-- キーボード対応勤務取得
            Call Get_KeyBoardKinmu()
            '集計項目名称／対象勤務の取得
            Call Get_Matrix()
            'ｴﾗｰﾁｪｯｸ用集計項目名称／対象勤務の取得
            Call Get_ErrorCheckMatrix()

            '-- 休日ﾏｽﾀ 取得 ---------------
            Call Get_Holiday()

            '最初のセルを決定
            w_Row = M_DayLabel_Row
            w_Col = M_KinmuDataStart_Col

            With m_Spread(1).Sheets(0)
                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                    '==============================
                    '   日 / 曜日 設定
                    '==============================
                    '--------------------------------------------------
                    '割当に必要な実績期間 & 表示に必要な実績期間の曜日設定
                    '--------------------------------------------------
                    '実績取込開始日を開始日とする
                    w_Var_From = Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00"))
                    '実績期間ﾃﾞｰﾀ　開始 列番号 格納
                    m_JissekiKikan.KinmuDataStartCol = w_Col

                    '実績期間 終了日 日付型変換
                    w_Var_To = Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00"))

                    '日数計算
                    w_MaxCnt = DateDiff(DateInterval.Day, Date.Parse(w_Var_From), Date.Parse(w_Var_To)) + 1

                    '作業変数 初期化
                    w_Int = 0

                    '日数 繰り返す(実績期間)
                    For w_Cnt = 1 To w_MaxCnt

                        '計画期間設定
                        If m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            If w_Cnt = 1 OrElse w_DateMonth <> Month(w_Var_From) Then

                                .SetText(M_MonthLabel_Row, w_Col, DirectCast(String.Format("{0, 2}", Convert.ToString(Month(w_Var_From))), Object))
                                If w_Cnt < w_MaxCnt Then
                                    .SetText(M_MonthLabel_Row, w_Col + 1, DirectCast("月", Object))
                                End If

                                w_DateMonth = Month(w_Var_From)
                            End If
                        ElseIf m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week Then
                            '表示期間が４週の場合
                            If w_Cnt = 1 Then
                                '計画期間を設定する
                                .SetText(M_MonthLabel_Row, w_Col, DirectCast(String.Format("{0, 2}", m_JissekiKikan.TarmNo), Object))
                                .SetText(M_MonthLabel_Row, w_Col + 1, DirectCast("Ｔ", Object))
                                .SetText(M_MonthLabel_Row, w_Col + 2, DirectCast("（", Object))
                                .SetText(M_MonthLabel_Row, w_Col + 3, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00")))), Object))
                                .SetText(M_MonthLabel_Row, w_Col + 4, DirectCast("/", Object))
                                .SetText(M_MonthLabel_Row, w_Col + 5, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00")).Day), Object))
                                .SetText(M_MonthLabel_Row, w_Col + 6, DirectCast("～", Object))
                                .SetText(M_MonthLabel_Row, w_Col + 7, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))), Object))
                                .SetText(M_MonthLabel_Row, w_Col + 8, DirectCast("/", Object))
                                .SetText(M_MonthLabel_Row, w_Col + 9, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")).Day), Object))
                                .SetText(M_MonthLabel_Row, w_Col + 10, DirectCast("）", Object))
                            End If
                        End If

                        '日 文字列 設定
                        w_Var = Convert.ToString(DatePart(DateInterval.Day, Date.Parse(w_Var_From)))
                        .SetText(M_DayLabel_Row, w_Col, w_Var)
                        Call SubSetStyle(m_Spread(1), M_DayLabel_Row, w_Col, M_DayLabel_Row, w_Col, 0, 0, , , CellHorizontalAlignment.Center)

                        '曜日 文字列作成
                        If InStr(m_HolDateStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                            w_Var = "祝"
                            '休日表示
                            If InStr(m_OffDayStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                                w_Var = "休"
                            End If
                            '色 設定
                            w_BackColor = ColorTranslator.FromOle(w_Holiday_Back)
                            w_ForeColor = ColorTranslator.FromOle(w_Holiday_Fore)
                        Else
                            w_Var = Weekday(w_Var_From)
                            If w_Var = FirstDayOfWeek.Sunday Then
                                w_Var = "日"
                                '色 設定
                                w_BackColor = ColorTranslator.FromOle(w_Sunday_Back)
                                w_ForeColor = ColorTranslator.FromOle(w_Sunday_Fore)
                            ElseIf w_Var = FirstDayOfWeek.Monday Then
                                w_Var = "月"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Tuesday Then
                                w_Var = "火"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Wednesday Then
                                w_Var = "水"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Thursday Then
                                w_Var = "木"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Friday Then
                                w_Var = "金"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Saturday Then
                                w_Var = "土"
                                '色 設定
                                w_BackColor = ColorTranslator.FromOle(w_Saturday_Back)
                                w_ForeColor = ColorTranslator.FromOle(w_Saturday_Fore)
                            Else
                                w_Var = "　"
                            End If
                        End If

                        '曜日 文字列 設定
                        .SetText(M_WeekLabel_Row, w_Col, w_Var)
                        Call SubSetStyle(m_Spread(1), M_WeekLabel_Row, w_Col, M_WeekLabel_Row, w_Col, 0, 0, , , CellHorizontalAlignment.Center)
                        Call SubSetStyle(m_Spread(1), M_DayLabel_Row, w_Col, M_WeekLabel_Row, w_Col, 0, 0, w_ForeColor, w_BackColor)

                        '年月日 文字列 設定
                        w_Var = DirectCast(Format(w_Var_From, "yyyyMMdd"), Object)
                        .SetText(M_YYYYMMDDLabel_Row, w_Col, w_Var)

                        '次の列番号 設定
                        w_Col = w_Col + 1

                        '1日 加算
                        w_Var_From = DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From))
                    Next w_Cnt

                    '実績期間ﾃﾞｰﾀ 終了 列番号 格納
                    m_JissekiKikan.KinmuDataEndCol = w_Col - 1

                    '--------------------------------------------------
                    '   実績期間の個人別集計列 設定
                    '--------------------------------------------------
                    '個人別集計項目が存在するか?
                    If UBound(m_HMtrx) > 0 Then
                        '存在する場合

                        '実績期間 個人別集計 開始 列番号 格納
                        m_JissekiKikan.PersonalStartCol = w_Col

                        '合計ﾀｲﾄﾙ等 退避
                        For w_Int2 = 1 To UBound(m_HMtrx)

                            '合計ﾀｲﾄﾙ 文字列 １段目 設定
                            w_Var = General.paLeft(m_HMtrx(w_Int2).MtrxName, 1)
                            .SetText(M_DayLabel_Row, w_Col, w_Var)

                            '合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            w_Var = General.paRight(m_HMtrx(w_Int2).MtrxName, 1)
                            .SetText(M_WeekLabel_Row, w_Col, w_Var)

                            '次の列番号 設定
                            w_Col = w_Col + 1
                        Next w_Int2

                        '実績期間 個人別集計 終了 列番号 格納
                        m_JissekiKikan.PersonalEndCol = w_Col - 1
                    Else
                        '存在しない場合

                        '実績期間 個人別集計 終了 列番号 格納
                        m_JissekiKikan.PersonalStartCol = 0
                        m_JissekiKikan.PersonalEndCol = -1
                    End If
                Else
                    '新規作成、計画変更以外は実績期間なし
                    m_JissekiKikan.KinmuDataStartCol = 0
                    m_JissekiKikan.KinmuDataEndCol = -1
                    m_JissekiKikan.PersonalStartCol = 0
                    m_JissekiKikan.PersonalEndCol = -1
                End If
            End With

            '--------------------------------------------------
            '   計画期間 の曜日設定
            '--------------------------------------------------
            With m_Spread(1).Sheets(0)

                '計画ﾃﾞｰﾀ 開始 列番号 格納
                m_KeikakuKikan.KinmuDataStartCol = w_Col

                '表示期間 開始/終了日 日付型変換
                w_Var_From = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))

                '計画期間終了日を終了日とする
                w_Var_To = Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))

                '日数計算
                w_MaxCnt = DateDiff(DateInterval.Day, Date.Parse(w_Var_From), Date.Parse(w_Var_To)) + 1

                '日数 繰り返す
                For w_Cnt = 1 To w_MaxCnt
                    '計画期間設定
                    If m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        If w_Cnt = 1 OrElse w_DateMonth <> Month(w_Var_From) Then
                            .SetText(M_MonthLabel_Row, w_Col, DirectCast(String.Format("{0, 2}", Month(w_Var_From)), Object))
                            If w_Cnt < w_MaxCnt Then
                                .SetText(M_MonthLabel_Row, w_Col + 1, DirectCast("月", Object))
                            End If
                            w_DateMonth = Month(w_Var_From)
                        End If
                    ElseIf m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week Then
                        '表示期間が４週の場合
                        If w_Cnt = 1 Then
                            '計画期間を設定する
                            .SetText(M_MonthLabel_Row, w_Col, DirectCast(String.Format("{0, 2}", m_KeikakuKikan.TarmNo), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 1, DirectCast("Ｔ", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 2, DirectCast("（", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 3, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")))), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 4, DirectCast("/", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 5, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).Day), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 6, DirectCast("～", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 7, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00")))), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 8, DirectCast("/", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 9, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00")).Day), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 10, DirectCast("）", Object))
                        End If
                    End If

                    '日 文字列 設定
                    w_Var = Convert.ToString(DatePart(DateInterval.Day, w_Var_From))
                    .SetText(M_DayLabel_Row, w_Col, w_Var)
                    Call SubSetStyle(m_Spread(1), M_DayLabel_Row, w_Col, M_DayLabel_Row, w_Col, 0, 0, , , CellHorizontalAlignment.Center)

                    '曜日 文字列作成
                    If InStr(m_HolDateStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                        w_Var = "祝"
                        '休日表示
                        If InStr(m_OffDayStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                            w_Var = "休"
                        End If
                        '色 設定
                        w_BackColor = ColorTranslator.FromOle(w_Holiday_Back)
                        w_ForeColor = ColorTranslator.FromOle(w_Holiday_Fore)
                    Else
                        w_Var = Weekday(w_Var_From)
                        If w_Var = FirstDayOfWeek.Sunday Then
                            w_Var = "日"
                            '色 設定
                            w_BackColor = ColorTranslator.FromOle(w_Sunday_Back)
                            w_ForeColor = ColorTranslator.FromOle(w_Sunday_Fore)
                        ElseIf w_Var = FirstDayOfWeek.Monday Then
                            w_Var = "月"
                            w_BackColor = SystemColors.Control
                            w_ForeColor = Color.Black
                        ElseIf w_Var = FirstDayOfWeek.Tuesday Then
                            w_Var = "火"
                            w_BackColor = SystemColors.Control
                            w_ForeColor = Color.Black
                        ElseIf w_Var = FirstDayOfWeek.Wednesday Then
                            w_Var = "水"
                            w_BackColor = SystemColors.Control
                            w_ForeColor = Color.Black
                        ElseIf w_Var = FirstDayOfWeek.Thursday Then
                            w_Var = "木"
                            w_BackColor = SystemColors.Control
                            w_ForeColor = Color.Black
                        ElseIf w_Var = FirstDayOfWeek.Friday Then
                            w_Var = "金"
                            w_BackColor = SystemColors.Control
                            w_ForeColor = Color.Black
                        ElseIf w_Var = FirstDayOfWeek.Saturday Then
                            w_Var = "土"
                            '色 設定
                            w_BackColor = ColorTranslator.FromOle(w_Saturday_Back)
                            w_ForeColor = ColorTranslator.FromOle(w_Saturday_Fore)
                        Else
                            w_Var = "　"
                        End If
                    End If

                    '曜日 文字列 設定
                    .SetText(M_WeekLabel_Row, w_Col, w_Var)
                    Call SubSetStyle(m_Spread(1), M_WeekLabel_Row, w_Col, M_WeekLabel_Row, w_Col, 0, 0, , , CellHorizontalAlignment.Center)
                    Call SubSetStyle(m_Spread(1), M_DayLabel_Row, w_Col, M_WeekLabel_Row, w_Col, 0, 0, w_ForeColor, w_BackColor)

                    '年月日 文字列 設定
                    w_Var = DirectCast(Format(w_Var_From, "yyyyMMdd"), Object)
                    .SetText(M_YYYYMMDDLabel_Row, w_Col, w_Var)

                    '次の列番号 設定
                    w_Col = w_Col + 1

                    '1日 加算
                    w_Var_From = DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From))
                Next w_Cnt

                '計画ﾃﾞｰﾀ 終了 列番号 格納
                m_KeikakuKikan.KinmuDataEndCol = w_Col - 1

                '--------------------------------------------------
                '   計画期間の個人別集計列 設定
                '--------------------------------------------------
                '個人別集計項目が存在するか?
                If UBound(m_HMtrx) > 0 Then
                    '存在する場合

                    '計画ﾃﾞｰﾀ 個人別集計 開始 列番号 格納
                    m_KeikakuKikan.PersonalStartCol = w_Col

                    '計画期間 固定個人別集計開始列設定
                    w_Col2 = 0

                    '計画ﾃﾞｰﾀ 固定個人別集計 開始 列番号 格納
                    m_KeikakuKikan.KoteiStartCol = w_Col2

                    '合計ﾀｲﾄﾙ等 退避
                    For w_Int = 1 To UBound(m_HMtrx)

                        If UBound(m_HMtrx) >= w_Int Then
                            '合計ﾀｲﾄﾙ 文字列 １段目 設定
                            w_Var = General.paLeft(m_HMtrx(w_Int).MtrxName, 1)
                            .SetText(M_DayLabel_Row, w_Col, w_Var)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 １段目 設定
                            sprPTotal.Sheets(0).SetText(M_DayLabel_Row, w_Col2, w_Var)

                            '合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            w_Var = General.paRight(m_HMtrx(w_Int).MtrxName, 1)
                            .SetText(M_WeekLabel_Row, w_Col, w_Var)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            sprPTotal.Sheets(0).SetText(M_WeekLabel_Row, w_Col2, w_Var)
                        End If
                        '次の列番号 設定
                        w_Col = w_Col + 1
                        w_Col2 = w_Col2 + 1
                    Next w_Int

                    '計画ﾃﾞｰﾀ 個人別集計 終了 列番号 格納
                    m_KeikakuKikan.PersonalEndCol = w_Col - 1

                    '計画ﾃﾞｰﾀ 固定個人別集計 終了 列番号 格納
                    m_KeikakuKikan.KoteiEndCol = w_Col2 - 1
                Else
                    '集計項目がない場合

                    '計画期間 個人別集計 終了 列番号 格納
                    m_KeikakuKikan.PersonalStartCol = 0
                    m_KeikakuKikan.PersonalEndCol = -1
                    '計画期間 固定個人別集計 終了 列番号 格納
                    m_KeikakuKikan.KoteiStartCol = -1
                    m_KeikakuKikan.KoteiEndCol = -1
                End If
            End With

            '------------------------------
            ' 計画期間のｿｰﾄﾃﾞｰﾀ格納ｾﾙ設定
            '------------------------------
            For w_Int = 1 To UBound(m_StaffZokusei)
                m_StaffZokusei(w_Int).SetCol_M = w_Col
                w_Col = w_Col + 1
            Next w_Int

            With m_Spread(1).Sheets(0)
                '職員管理番号(ﾗﾍﾞﾙ型)
                Call SubSetStyle(m_Spread(1), -1, m_StaffZokusei(M_StaffID).SetCol_M, -1, m_StaffZokusei(M_StaffID).SetCol_M, 1, 0)

                '採用年月日/職種表示No/役職表示No/技量表示No/表示NO/ﾁｰﾑ/ﾃﾞｰﾀ格納番号(整数)
                Call SubSetStyle(m_Spread(1), -1, m_StaffZokusei(M_SaiyoYMD).SetCol_M, -1, m_StaffZokusei(M_HairetuNo).SetCol_M, 0, 1)
            End With

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then

                '4週/1ｹ月の場合
                With m_Spread(2).Sheets(0)
                    '==============================
                    '   日 / 曜日 設定
                    '==============================
                    '最初のセルを決定
                    w_Row = M_DayLabel_Row
                    w_Col = M_KinmuDataStart_Col

                    '--------------------------------------------------
                    '割当に必要な実績期間 & 表示に必要な実績期間の曜日設定
                    '--------------------------------------------------
                    '4週期間開始日を開始日とする
                    w_Var_From = Date.Parse(Format(m_4WeekKikan(1).StartDate, "0000/00/00"))
                    '4週期間実績ﾃﾞｰﾀ  開始 列番号 格納
                    m_4WeekKikan(1).KinmuDataStartCol = w_Col

                    '実績期間 終了日 日付型変換
                    w_Var_To = Date.Parse(Format(m_4WeekKikan(UBound(m_4WeekKikan)).EndDate, "0000/00/00"))

                    '日数計算
                    w_MaxCnt = DateDiff(DateInterval.Day, Date.Parse(w_Var_From), Date.Parse(w_Var_To)) + 1

                    '作業変数 初期化
                    w_Int = 0

                    '日数 繰り返す(実績期間)
                    For w_Cnt = 1 To w_MaxCnt
                        For w_Int = 1 To UBound(m_4WeekKikan)
                            If Integer.Parse(Format(w_Var_From, "yyyyMMdd")) = m_4WeekKikan(w_Int).StartDate Then
                                Exit For
                            End If
                        Next w_Int
                        If w_Int <= UBound(m_4WeekKikan) Then
                            '計画期間を設定する
                            .SetText(M_MonthLabel_Row, w_Col, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_4WeekKikan(w_Int).StartDate, "0000/00/00")))), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 1, DirectCast("/", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 2, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_4WeekKikan(w_Int).StartDate, "0000/00/00")).Day), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 3, DirectCast("～", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 4, DirectCast(String.Format("{0, 2}", Month(Date.Parse(Format(m_4WeekKikan(w_Int).EndDate, "0000/00/00")))), Object))
                            .SetText(M_MonthLabel_Row, w_Col + 5, DirectCast("/", Object))
                            .SetText(M_MonthLabel_Row, w_Col + 6, DirectCast(String.Format("{0, 2}", Date.Parse(Format(m_4WeekKikan(w_Int).EndDate, "0000/00/00")).Day), Object))
                        End If

                        '日 文字列 設定
                        w_Style.Reset()
                        w_Style.BackColor = Color.White
                        w_Style.HorizontalAlignment = CellHorizontalAlignment.Center
                        .Models.Style.SetDirectInfo(M_DayLabel_Row, w_Col, w_Style)

                        w_Var = Convert.ToString(DatePart(DateInterval.Day, w_Var_From))
                        .SetText(M_DayLabel_Row, w_Col, w_Var)

                        '曜日 文字列作成
                        If InStr(m_HolDateStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                            w_Var = "祝"
                            '休日表示
                            If InStr(m_OffDayStr, Format(w_Var_From, "yyyyMMdd")) > 0 Then
                                w_Var = "休"
                            End If
                            '色 設定
                            w_BackColor = ColorTranslator.FromOle(w_Holiday_Back)
                            w_ForeColor = ColorTranslator.FromOle(w_Holiday_Fore)
                        Else
                            w_Var = Weekday(w_Var_From)
                            If w_Var = FirstDayOfWeek.Sunday Then
                                w_Var = "日"
                                '色 設定
                                w_BackColor = ColorTranslator.FromOle(w_Sunday_Back)
                                w_ForeColor = ColorTranslator.FromOle(w_Sunday_Fore)
                            ElseIf w_Var = FirstDayOfWeek.Monday Then
                                w_Var = "月"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Tuesday Then
                                w_Var = "火"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Wednesday Then
                                w_Var = "水"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Thursday Then
                                w_Var = "木"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Friday Then
                                w_Var = "金"
                                w_BackColor = SystemColors.Control
                                w_ForeColor = Color.Black
                            ElseIf w_Var = FirstDayOfWeek.Saturday Then
                                w_Var = "土"
                                '色 設定
                                w_BackColor = ColorTranslator.FromOle(w_Saturday_Back)
                                w_ForeColor = ColorTranslator.FromOle(w_Saturday_Fore)
                            Else
                                w_Var = "　"
                            End If
                        End If

                        '曜日 文字列 設定
                        w_Style.Reset()
                        w_Style.BackColor = Color.White
                        w_Style.HorizontalAlignment = CellHorizontalAlignment.Center
                        .Models.Style.SetDirectInfo(M_WeekLabel_Row, w_Col, w_Style)

                        .SetText(M_WeekLabel_Row, w_Col, w_Var)
                        .Cells(M_DayLabel_Row, w_Col, M_WeekLabel_Row, w_Col).BackColor = w_BackColor
                        .Cells(M_DayLabel_Row, w_Col, M_WeekLabel_Row, w_Col).ForeColor = w_ForeColor

                        '年月日 文字列 設定
                        w_Var = DirectCast(Format(w_Var_From, "yyyyMMdd"), Object)
                        .SetText(M_YYYYMMDDLabel_Row, w_Col, w_Var)

                        w_TempDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))

                        '次の列番号 設定
                        w_Col = w_Col + 1

                        For w_Int = 1 To UBound(m_4WeekKikan)
                            If w_TempDate = m_4WeekKikan(w_Int).StartDate Then
                                '4週期間実績ﾃﾞｰﾀ  開始 列番号 格納
                                m_4WeekKikan(w_Int).KinmuDataStartCol = w_Col - 1
                            End If

                            If w_TempDate = m_4WeekKikan(w_Int).EndDate Then

                                '4週期間実績ﾃﾞｰﾀ  終了 列番号 格納
                                m_4WeekKikan(w_Int).KinmuDataEndCol = w_Col - 1

                                '--------------------------------------------------
                                '   4週期間用実績期間の個人別集計列 設定
                                '--------------------------------------------------
                                '個人別集計項目が存在するか?
                                If UBound(m_HMtrx_4Week) > 0 Then
                                    '存在する場合

                                    '4週期間 個人別集計 開始 列番号 格納
                                    m_4WeekKikan(w_Int).PersonalStartCol = w_Col

                                    If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                        '固定Spread4週期間 個人別集計 開始 列番号 格納
                                        m_4WeekKikan(w_Int).KoteiStartCol = w_Col2
                                    Else
                                        m_4WeekKikan(w_Int).KoteiStartCol = -1
                                    End If

                                    '合計ﾀｲﾄﾙ等 退避
                                    For w_Int2 = 1 To UBound(m_HMtrx_4Week)

                                        '合計ﾀｲﾄﾙ 文字列 １段目 設定
                                        w_Var = General.paLeft(m_HMtrx_4Week(w_Int2).MtrxName, 1)
                                        .SetText(M_DayLabel_Row, w_Col, w_Var)
                                        If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                            '固定Spread合計ﾀｲﾄﾙ 文字列 １段目 設定
                                            sprPTotal.Sheets(0).SetText(M_DayLabel_Row, w_Col2, w_Var)
                                        End If

                                        '合計ﾀｲﾄﾙ 文字列 ２段目 設定
                                        w_Var = General.paRight(m_HMtrx_4Week(w_Int2).MtrxName, 1)
                                        .SetText(M_WeekLabel_Row, w_Col, w_Var)
                                        If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                            '固定Spread合計ﾀｲﾄﾙ 文字列 ２段目 設定
                                            sprPTotal.Sheets(0).SetText(M_WeekLabel_Row, w_Col2, w_Var)
                                            w_Col2 = w_Col2 + 1
                                        End If

                                        '次の列番号 設定
                                        w_Col = w_Col + 1
                                    Next w_Int2

                                    '4週期間 個人別集計 終了 列番号 格納
                                    m_4WeekKikan(w_Int).PersonalEndCol = w_Col - 1

                                    If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                        '固定Spread4週期間 個人別集計 開始 列番号 格納
                                        m_4WeekKikan(w_Int).KoteiEndCol = w_Col2 - 1
                                    Else
                                        m_4WeekKikan(w_Int).KoteiEndCol = -1
                                    End If
                                Else
                                    '存在しない場合

                                    '4週期間 個人別集計 終了 列番号 格納
                                    m_4WeekKikan(w_Int).PersonalStartCol = 0
                                    m_4WeekKikan(w_Int).PersonalEndCol = -1
                                    '4週期間 固定個人別集計 終了 列番号 格納
                                    m_4WeekKikan(w_Int).KoteiStartCol = -1
                                    m_4WeekKikan(w_Int).KoteiEndCol = -1
                                End If
                            End If
                        Next w_Int

                        '1日 加算
                        w_Var_From = DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From))
                    Next w_Cnt

                    '------------------------------
                    ' 4週期間のｿｰﾄﾃﾞｰﾀ格納ｾﾙ設定
                    '------------------------------
                    For w_Int = 1 To UBound(m_StaffZokusei)
                        m_StaffZokusei(w_Int).SetCol_4W = w_Col
                        w_Col = w_Col + 1
                    Next w_Int

                    '職員管理番号(ﾗﾍﾞﾙ型)
                    w_Style.Reset()
                    w_Style.BackColor = Color.White
                    w_Style.CellType = w_TextCellType
                    .Models.Style.SetDirectInfo(-1, m_StaffZokusei(M_StaffID).SetCol_4W, w_Style)

                    '採用年月日/職種表示No/役職表示No/技量表示No/表示NO/ﾁｰﾑ/ﾃﾞｰﾀ格納番号(整数)
                    w_NumCellType.MaximumValue = 99999999999.0#
                    w_NumCellType.MinimumValue = -99999999999.0#
                    w_NumCellType.DecimalPlaces = 0
                    w_NumCellType.EnableSubEditor = False

                    w_Style.Reset()
                    w_Style.BackColor = Color.White
                    w_Style.CellType = w_NumCellType
                    For w_ColLoop = m_StaffZokusei(M_SaiyoYMD).SetCol_4W To m_StaffZokusei(M_HairetuNo).SetCol_4W
                        .Models.Style.SetDirectInfo(-1, w_ColLoop, w_Style)
                    Next
                End With
            End If

            '------------------------------
            '個人別集計のｿｰﾄﾃﾞｰﾀ格納ｾﾙ設定
            '------------------------------
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                If m_KeikakuKikan.KoteiStartCol = -1 OrElse m_KeikakuKikan.KoteiEndCol = -1 Then
                    '個人別集計がないとき
                    w_Col = 1
                Else
                    w_Col = m_KeikakuKikan.KoteiEndCol + 1
                End If
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                If m_4WeekKikan(UBound(m_4WeekKikan)).KoteiStartCol = -1 OrElse m_4WeekKikan(UBound(m_4WeekKikan)).KoteiEndCol = -1 Then
                    '4週の個人別集計がないとき
                    If m_KeikakuKikan.KoteiStartCol = -1 OrElse m_KeikakuKikan.KoteiEndCol = -1 Then
                        '計画の個人別集計がないとき
                        w_Col = 1
                    Else
                        w_Col = m_KeikakuKikan.KoteiEndCol + 1
                    End If
                Else
                    w_Col = m_4WeekKikan(UBound(m_4WeekKikan)).KoteiEndCol + 1
                End If
            End If

            For w_Int = 1 To UBound(m_StaffZokusei)
                m_StaffZokusei(w_Int).SetCol_PTotal = w_Col
                w_Col = w_Col + 1
            Next w_Int

            With sprPTotal.Sheets(0)
                '職員管理番号(ﾗﾍﾞﾙ型)
                Call SubSetStyle(sprPTotal, -1, m_StaffZokusei(M_StaffID).SetCol_PTotal, -1, m_StaffZokusei(M_StaffID).SetCol_PTotal, 1, 0)

                '採用年月日/職種表示No/役職表示No/技量表示No/表示NO/ﾁｰﾑ/ﾃﾞｰﾀ格納番号(整数)
                'Call SubSetStyle(sprPTotal, -1, m_StaffZokusei(M_SaiyoYMD).SetCol_PTotal, -1, m_StaffZokusei(M_HairetuNo).SetCol_PTotal, 1, 0)
                Call SubSetStyle(sprPTotal, -1, m_StaffZokusei(M_SaiyoYMD).SetCol_PTotal, -1, m_StaffZokusei(M_HairetuNo).SetCol_PTotal, 0, 1)  '2011/09/07 Y.I Add
            End With

            '4週期間の日付検索用文字列取得
            Call Get_DayStr()

            '処理経過ﾌｫｰﾑ表示
            w_ProcessForm = New frmNSK0000HM
            w_ProcessForm.Show()
            w_ProcessForm.Refresh()

            '-- 列ﾀｲﾄﾙ(職員情報)の設定 ----------------------
            If Get_StaffData(w_ProcessForm) = False Then
                '異常終了
                w_ProcessForm.Close() '処理経過ﾌｫｰﾑUnload
                w_ProcessForm = Nothing
                Exit Function
            End If

            '代休データ整合性チェック
            If General.g_lngDaikyuMng = 0 Then
                Call Adjust_Daikyu(0)
            End If

            'ﾙｰﾙﾃﾞｰﾀ取得
            Call Get_RuleData()

            '--------------------------------------------------
            '   日別集計列 設定
            '--------------------------------------------------
            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int).Sheets(0)

                    '日別集計項目が存在するか ?
                    If UBound(m_VMtrx) > 0 Then
                        '存在する場合

                        '日別集計 情報用 配列再定義
                        If m_OuenTeam <= 0 Then
                            w_TeamCnt = m_TeamCnt
                        Else
                            w_TeamCnt = m_OuenTeam
                        End If

                        ReDim m_DayDataRow(w_TeamCnt)

                        '合計行 開始位置 設定
                        w_Row = m_StaffRow.EndRow + 1
                        w_Col = M_StaffName_Col

                        '固定Spread開始位置設定
                        w_Row2 = 0

                        '日別集計ｴﾘｱ開始行 格納
                        m_DayAreaRow.StartRow = w_Row

                        '--- ﾁｰﾑ別集計項目 設定 ---

                        'ﾁｰﾑ数分 繰り返す
                        For w_Int2 = 1 To w_TeamCnt

                            'ﾁｰﾑ別 日別合計行 開始行番号 格納
                            m_DayDataRow(w_Int2).StartRow = w_Row

                            '固定Spread開始行番号 格納
                            m_DayDataRow(w_Int2).KoteiStartRow = w_Row2

                            '合計ﾀｲﾄﾙ等 設定
                            For w_Int3 = 1 To UBound(m_VMtrx)

                                '合計ﾀｲﾄﾙ 文字列 設定
                                w_Var = DirectCast(m_VMtrx(w_Int3).MtrxName & " " & G_TEAM_STR & "計", Object)
                                .SetText(w_Row, w_Col, w_Var)

                                '合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(m_Spread(w_Int), w_Row, w_Col, w_Row, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 設定
                                sprDayTotal_M.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                                '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(sprDayTotal_M, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '4週固定Spread合計ﾀｲﾄﾙ 文字列 設定
                                sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                                '4週固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(sprDayTotal_4W, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '次の行番号 設定
                                w_Row = w_Row + 1
                                w_Row2 = w_Row2 + 1
                            Next w_Int3

                            'ﾁｰﾑ別 日別合計行 終了行番号 格納
                            m_DayDataRow(w_Int2).EndRow = w_Row - 1

                            '固定Spread終了行番号 格納
                            m_DayDataRow(w_Int2).KoteiEndRow = w_Row2 - 1
                        Next w_Int2

                        '--- 総合計集計項目 設定 ---
                        '総合計行 開始行番号 格納
                        m_DayDataRow(0).StartRow = w_Row

                        '固定Spread総合計行 開始行番号 格納
                        m_DayDataRow(0).KoteiStartRow = w_Row2

                        '合計ﾀｲﾄﾙ 取得
                        For w_Int2 = 1 To UBound(m_VMtrx)
                            '合計ﾀｲﾄﾙ 文字列 設定
                            w_Var = m_VMtrx(w_Int2).MtrxName & " 総合計"
                            .SetText(w_Row, w_Col, w_Var)

                            '合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                            Call SubSetStyle(m_Spread(w_Int), w_Row, w_Col, w_Row, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                            '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 設定
                            sprDayTotal_M.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                            '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                            Call SubSetStyle(sprDayTotal_M, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                            '4週固定Spread合計ﾀｲﾄﾙ 文字列 設定
                            sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                            '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                            Call SubSetStyle(sprDayTotal_4W, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                            '次の行番号 設定
                            w_Row = w_Row + 1
                            w_Row2 = w_Row2 + 1
                        Next w_Int2

                        '総合計行 終了行番号 退避
                        m_DayDataRow(0).EndRow = w_Row - 1

                        '固定Spread終了行番号 格納
                        m_DayDataRow(0).KoteiEndRow = w_Row2 - 1

                        '日別集計ｴﾘｱ終了行 格納
                        m_DayAreaRow.EndRow = m_DayDataRow(0).EndRow
                    Else
                        '存在しない場合
                        'ﾁｰﾑ別 合計行 情報用 配列再定義
                        ReDim m_DayDataRow(0)
                    End If
                End With
            Next w_Int

            'ｺﾋﾟｰ用ﾃﾞｰﾀ退避の開始列 設定
            If m_DayAreaRow.EndRow = 0 Then
                '合計行ない場合
                m_CopyArea.StartRow = m_StaffRow.EndRow + 1
            Else
                '合計行ある場合
                m_CopyArea.StartRow = m_DayAreaRow.EndRow + 1
            End If
            'ｺﾋﾟｰ用ﾃﾞｰﾀ退避の終了列 設定
            m_CopyArea.EndRow = m_CopyArea.StartRow + m_StaffRow.EndRow - m_StaffRow.StartRow

            '2016/04/05 Ishiga upd start--------------------------------------------------------------------
            ''Undo用ﾃﾞｰﾀ退避の開始列 設定
            'm_UndoArea.StartRow = m_CopyArea.EndRow + 1
            ''Undo用ﾃﾞｰﾀ退避の終了列 設定
            'm_UndoArea.EndRow = m_UndoArea.StartRow + m_StaffRow.EndRow - m_StaffRow.StartRow

            'Undo用ﾃﾞｰﾀ退避の開始列 設定
            m_UndoArea(1).StartRow = m_CopyArea.EndRow + 1
            'Undo用ﾃﾞｰﾀ退避の終了列 設定
            m_UndoArea(1).EndRow = m_UndoArea(1).StartRow + m_StaffRow.EndRow - m_StaffRow.StartRow
            For i As Integer = 2 To m_UndoMaxKensu
                m_UndoArea(i).StartRow = m_UndoArea(i - 1).EndRow + 1
                m_UndoArea(i).EndRow = m_UndoArea(i).StartRow + m_StaffRow.EndRow - m_StaffRow.StartRow
            Next
            '2016/04/05 Ishiga upd end----------------------------------------------------------------------

            '--------------------------------------------------
            '   勤務ﾃﾞｰﾀ 取得
            '--------------------------------------------------
            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then

                '勤務実績Ｆ ﾃﾞｰﾀ取得/画面表示
                Call Get_JissekiData(w_ProcessForm)

                '勤務計画Ｆ ﾃﾞｰﾀ取得/画面表示
                If Get_PlanData(w_ProcessForm) = False Then
                    w_ProcessForm.Close() '処理経過ﾌｫｰﾑUnload
                    w_ProcessForm = Nothing
                    Exit Function
                End If

                If g_SaikeiFlg = True Then
                    '勤務計画Ｆ ﾃﾞｰﾀ取得/画面表示
                    Call Get_PlanJisseki(w_ProcessForm)
                End If

                '勤務計画/実績Ｆ 計画期間外の４週部分ﾃﾞｰﾀ取得/画面表示
                Call Get_PlanData_4W(w_ProcessForm)

                '再掲ﾃﾞｰﾀ取得
                Call Get_SaikeiData(w_ProcessForm)
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                '勤務計画Ｆ ﾃﾞｰﾀ取得/画面表示
                If Get_PlanData(w_ProcessForm) = False Then
                    w_ProcessForm.Close() '処理経過ﾌｫｰﾑUnload
                    w_ProcessForm = Nothing
                    Exit Function
                End If

                '勤務計画/実績Ｆ 計画期間外の４週部分ﾃﾞｰﾀ取得/画面表示
                Call Get_PlanData_4W(w_ProcessForm)

                '勤務変更時 勤務予定ﾃﾞｰﾀ 取得(勤務実績ﾃﾞｰﾀと比較する)
                Call Get_PlanPersonalData(w_ProcessForm)

                '勤務予定ﾃﾞｰﾀ 取得(計画期間の最後４週部分)[勤務変更時 勤務実績ﾃﾞｰﾀと比較する]
                Call Get_PlanPersonalData_4W(w_ProcessForm)

                '[勤務変更時 勤務予定ﾃﾞｰﾀと勤務実績ﾃﾞｰﾀを比較し、異なっていたら色表示]
                Call Disp_CompResultData(w_ProcessForm)

                '再掲ﾃﾞｰﾀ取得
                Call Get_SaikeiData(w_ProcessForm)
            End If

            '--------------------------------------------------
            '   日当直ﾃﾞｰﾀ 取得
            '--------------------------------------------------
            If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                Call Get_DutyData(w_ProcessForm)
            End If

            '--------------------------------------------------
            '   届出ﾃﾞｰﾀ 取得
            '--------------------------------------------------
            If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                Call Get_AppliData(w_ProcessForm)
            End If

            ReDim m_YakinData(UBound(m_StaffData))

            '**********************************************************
            '   集計を行う
            '**********************************************************
            '計画期間内の個人別集計

            '実働時間減算対象控除
            m_JitsudouGensanTaishouKoujo = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "WORKTIMECALCKOJYOBUNRUICD", "", General.g_strHospitalCD)
            m_ArrayJitsudouGensanTaishouKoujo = General.paSplit(m_JitsudouGensanTaishouKoujo, ",")

            '実働時間減算対象時間休
            m_JitsudouGensanTaishouJikanKyu = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "WORKTIMECALCHOLIDAYBUNRUICD", "", General.g_strHospitalCD)
            m_ArrayJitsudouGensanTaishouJikanKyu = General.paSplit(m_JitsudouGensanTaishouJikanKyu, ",")

            If m_KeikakuKikan.PersonalStartCol <> 0 AndAlso m_KeikakuKikan.PersonalEndCol <> -1 Then
                For w_CalcRow = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_CalcRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_CalcRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        Call RunReCalc_PUser(w_CalcRow)
                    End If
                Next w_CalcRow
            End If
            '計画期間内の日別集計
            If m_DayAreaRow.StartRow <> 0 AndAlso m_DayAreaRow.EndRow <> 0 Then
                For w_CalcCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    Call RunReCalc_PDay(w_CalcCol)
                Next w_CalcCol
            End If
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週期間の個人別集計
                If m_4WeekKikan(UBound(m_4WeekKikan)).PersonalStartCol <> 0 AndAlso m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol <> -1 Then
                    For w_CalcRow = m_StaffRow.StartRow To m_StaffRow.EndRow
                        '4週期間の個人別集計
                        If ((w_CalcRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_CalcRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計
                            Call RunReCalc_User_4W(w_CalcRow)
                            Call RunReCalc_PUser_Jisseki(w_CalcRow)
                        End If
                    Next w_CalcRow
                End If
                '4週期間の日別集計
                If m_DayAreaRow.StartRow <> 0 AndAlso m_DayAreaRow.EndRow <> 0 Then
                    If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_FromCol) = True Then
                        For w_CalcCol = w_FromCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                            '計画期間の最後の4週部分の日別集計
                            Call RunReCalc_PDay_4W(w_CalcCol)
                        Next w_CalcCol
                    End If
                End If
            End If

            '-- ﾃﾞｰﾀ部の最大列数 設定 -------------
            m_Spread(1).Sheets(0).ColumnCount = m_StaffZokusei(M_HairetuNo).SetCol_M + 1
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                '-- 最大列数 設定 -------------
                m_Spread(2).Sheets(0).ColumnCount = m_StaffZokusei(M_HairetuNo).SetCol_4W + 1
            End If
            '-- ﾃﾞｰﾀ部の最大行数 設定 -----------
            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int)
                    '-- 最大行数 設定 -------------
                    '2016/04/05 Ishiga upd start---------------------------------
                    '.Sheets(0).RowCount = m_UndoArea.EndRow + 1
                    .Sheets(0).RowCount = m_UndoArea(m_UndoMaxKensu).EndRow + 1
                    '2016/04/05 Ishiga upd end-----------------------------------
                End With
            Next w_Int

            '-- 固定個人別集計部の最大列数 設定 ------------
            sprPTotal.Sheets(0).ColumnCount = m_StaffZokusei(M_HairetuNo).SetCol_PTotal + 1

            '-- 固定個人別集計部の最大行数 設定 ------------
            sprPTotal.Sheets(0).RowCount = m_StaffRow.EndRow + 1

            '-- 固定日別集計部の最大列数 設定 ------------
            sprDayTotal_M.Sheets(0).ColumnCount = m_KeikakuKikan.KinmuDataEndCol + 1
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                sprDayTotal_4W.Sheets(0).ColumnCount = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
            End If
            '-- 固定日別集計部の最大行数 設定 ------------
            sprDayTotal_M.Sheets(0).RowCount = m_DayDataRow(0).KoteiEndRow + 1
            sprDayTotal_4W.Sheets(0).RowCount = m_DayDataRow(0).KoteiEndRow + 1

            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int).Sheets(0)
                    '-- 罫線 設定 ---------------------------------
                    '最終行 位置 計算
                    If m_DayAreaRow.EndRow = 0 Then
                        '合計行がない場合
                        w_Row = m_StaffRow.EndRow
                    Else
                        '合計行がある場合
                        w_Row = m_DayAreaRow.EndRow
                    End If

                    'No.上列ﾀｲﾄﾙ
                    Call SetBorder(m_Spread(w_Int), M_Interval_Row, M_HyojiNo_Col, M_EVENTLABEL_ROW, M_HyojiNo_Col, 2, 2, 2, 0, 0, Color.Black)

                    'No.欄
                    If m_MaxShowLine > 1 Then
                        For w_Row2 = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                Call SetBorder(m_Spread(w_Int), w_Row2, M_HyojiNo_Col, w_Row2 + m_MaxShowLine - 1, M_HyojiNo_Col, 0, 0, 0, 0, 2, Color.Black)
                            End If
                        Next w_Row2
                    Else
                        Call SetBorder(m_Spread(w_Int), m_StaffRow.StartRow, M_HyojiNo_Col, m_StaffRow.EndRow, M_HyojiNo_Col, 2, 2, 2, 2, 0, Color.Black)
                    End If

                    'No.下 集計行
                    Call SetBorder(m_Spread(w_Int), m_DayAreaRow.StartRow, M_HyojiNo_Col, m_DayAreaRow.EndRow + 1, M_HyojiNo_Col, 2, 2, 2, 0, 0, Color.Black)
                    .Cells(m_DayAreaRow.StartRow, M_HyojiNo_Col, m_DayAreaRow.EndRow + 1, M_HyojiNo_Col).BackColor = SystemColors.Control

                    If m_MaxShowLine > 1 Then
                        '列ﾀｲﾄﾙ(氏名)上列ﾀｲﾄﾙ
                        Call SetBorder(m_Spread(w_Int), M_Interval_Row, M_StaffName_Col, M_EVENTLABEL_ROW, M_StaffName_Col, 2, 2, 0, 2, 0, Color.Black)

                        '列ﾀｲﾄﾙ(氏名)欄
                        For w_Row2 = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                Call SetBorder(m_Spread(w_Int), w_Row2, M_StaffName_Col, w_Row2 + m_MaxShowLine - 1, M_StaffName_Col, 0, 0, 0, 0, 2, Color.Black)
                            End If
                        Next w_Row2

                        '列ﾀｲﾄﾙ(氏名)下 集計行
                        Call SetBorder(m_Spread(w_Int), m_DayAreaRow.StartRow, M_StaffName_Col, m_DayAreaRow.EndRow + 1, M_StaffName_Col, 2, 2, 0, 2, 0, Color.Black)

                        '採用条件等
                        Call SetBorder(m_Spread(w_Int), M_Interval_Row, M_EmpShrtNghtData_Col, M_EVENTLABEL_ROW, M_EmpShrtNghtData_Col, 2, 2, 0, 2, 0, Color.Black)

                        For w_Row2 = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                Call SetBorder(m_Spread(w_Int), w_Row2, M_EmpShrtNghtData_Col, w_Row2 + m_MaxShowLine - 1, M_EmpShrtNghtData_Col, 0, 0, 0, 0, 2, Color.Black)
                            End If
                        Next w_Row2
                        Call SetBorder(m_Spread(w_Int), m_DayAreaRow.StartRow, M_EmpShrtNghtData_Col, m_DayAreaRow.EndRow + 1, M_EmpShrtNghtData_Col, 2, 2, 0, 2, 0, Color.Black)
                    Else
                        '列ﾀｲﾄﾙ(氏名)欄
                        Call SetBorder(m_Spread(w_Int), -1, M_StaffName_Col, -1, M_StaffName_Col, 2, 2, 0, 2, 0, Color.Black)
                    End If

                    '固定日別集計行
                    If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                        '№下列
                        Call SetBorder(sprDayTotal_M, -1, M_HyojiNo_Col, -1, M_HyojiNo_Col, 2, 2, 2, 0, 0, Color.Black)
                        sprDayTotal_M.Sheets(0).Columns(M_HyojiNo_Col).BackColor = SystemColors.Control

                        '集計項目列
                        Call SetBorder(sprDayTotal_M, -1, M_StaffName_Col, -1, M_StaffName_Col, 2, 2, 0, 2, 0, Color.Black)
                        sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).BackColor = SystemColors.Control

                        '採用項目列
                        sprDayTotal_M.Sheets(0).Columns(M_EmpShrtNghtData_Col).BackColor = Color.Silver
                    End If

                    If sprDayTotal_4W.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                        '№下列
                        Call SetBorder(sprDayTotal_4W, -1, M_HyojiNo_Col, -1, M_HyojiNo_Col, 2, 2, 2, 0, 0, Color.Black)
                        sprDayTotal_4W.Sheets(0).Columns(M_HyojiNo_Col).BackColor = SystemColors.Control

                        '集計項目列
                        Call SetBorder(sprDayTotal_4W, -1, M_StaffName_Col, -1, M_StaffName_Col, 2, 2, 0, 2, 0, Color.Black)
                        sprDayTotal_4W.Sheets(0).Columns(M_StaffName_Col).BackColor = SystemColors.Control

                        '採用項目列
                        sprDayTotal_4W.Sheets(0).Columns(M_EmpShrtNghtData_Col).BackColor = Color.Silver
                    End If

                    '行事と人の境界
                    If w_Int = 1 Then
                        Call SetBorder(m_Spread(w_Int), m_StaffRow.StartRow - 1, M_EmpShrtNghtData_Col, m_StaffRow.StartRow - 1, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                    Else
                        Call SetBorder(m_Spread(w_Int), m_StaffRow.StartRow - 1, M_EmpShrtNghtData_Col, m_StaffRow.StartRow - 1, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                    End If

                    '人の境界は実線にする
                    If m_MaxShowLine > 1 Then
                        For w_Row2 = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                                '--------------------
                                '背景色を元に戻す
                                '--------------------
                                '明細の背景色を元に戻す
                                If w_Int = 1 Then
                                    Call SetBorder(m_Spread(w_Int), w_Row2, M_EmpShrtNghtData_Col, w_Row2, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                                Else
                                    Call SetBorder(m_Spread(w_Int), w_Row2, M_EmpShrtNghtData_Col, w_Row2, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                                End If
                            End If
                        Next w_Row2
                    End If
                End With
            Next w_Int

            With m_Spread(1).Sheets(0)
                If m_JissekiKikan.KinmuDataStartCol <> 0 AndAlso m_JissekiKikan.KinmuDataEndCol <> -1 Then
                    '行ﾀｲﾄﾙ欄～ﾃﾞｰﾀ欄

                    '実績期間
                    Call SetBorder(m_Spread(1), M_Interval_Row, m_JissekiKikan.KinmuDataStartCol, w_Row + 1, m_JissekiKikan.KinmuDataEndCol, 0, 0, 0, 0, 2, Color.Black)

                    '固定日別集計部（1ヶ月用）
                    If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                        Call SetBorder(sprDayTotal_M, -1, m_JissekiKikan.KinmuDataEndCol, -1, m_JissekiKikan.KinmuDataEndCol, 0, 0, 0, 2, 0, Color.Black)
                    End If

                    '実績期間(集計列含む) 行ﾀｲﾄﾙ 背景色 設定
                    .Cells(M_Interval_Row, m_JissekiKikan.KinmuDataStartCol, M_YYYYMMDDLabel_Row, m_KeikakuKikan.KinmuDataStartCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)

                    '実績期間(集計列含む) ﾃﾞｰﾀ領域 文字色/背景色 設定
                    .Cells(M_EVENTLABEL_ROW, m_JissekiKikan.KinmuDataStartCol, w_Row, m_KeikakuKikan.KinmuDataStartCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    .Cells(M_EVENTLABEL_ROW, m_JissekiKikan.KinmuDataStartCol, w_Row, m_KeikakuKikan.KinmuDataStartCol - 1).ForeColor = ColorTranslator.FromOle(m_MonthBefore_Fore)

                    '固定日別集計部（1ヶ月用）
                    If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                        sprDayTotal_M.Sheets(0).Columns(m_JissekiKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataStartCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    End If

                    '実績期間 個人別集計範囲
                    If m_JissekiKikan.PersonalStartCol <> 0 AndAlso m_JissekiKikan.PersonalEndCol <> -1 Then
                        Call SetBorder(m_Spread(1), M_Interval_Row, m_JissekiKikan.PersonalStartCol, w_Row, m_JissekiKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                        '固定日別集計部（1ヶ月用）
                        If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                            Call SetBorder(sprDayTotal_M, -1, m_JissekiKikan.PersonalEndCol, -1, m_JissekiKikan.PersonalEndCol, 0, 0, 0, 2, 0, Color.Black)
                        End If

                        '実績期間 個人別集計ﾀｲﾄﾙ範囲 表示位置 設定
                        .Cells(M_Interval_Row, m_JissekiKikan.PersonalStartCol, M_YYYYMMDDLabel_Row, m_JissekiKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Center

                        '実績期間 個人別集計範囲 表示位置 設定
                        .Cells(M_KinmuDataStart_Row, m_JissekiKikan.PersonalStartCol, w_Row, m_JissekiKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Right

                        '固定日別集計部（1ヶ月用）
                        If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                            .Columns(m_JissekiKikan.PersonalStartCol, m_JissekiKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Right
                        End If
                    End If
                End If

                '計画ﾃﾞｰﾀ部の日別集計
                If sprDayTotal_M.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                    sprDayTotal_M.Sheets(0).Columns(m_KeikakuKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataEndCol).HorizontalAlignment = CellHorizontalAlignment.Right
                    sprDayTotal_M.Sheets(0).Columns(m_KeikakuKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataEndCol).BackColor = SystemColors.Control
                    sprDayTotal_M.Sheets(0).Columns(m_KeikakuKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataEndCol).ForeColor = Color.Black
                End If

                If m_KeikakuKikan.PersonalStartCol <> 0 AndAlso m_KeikakuKikan.PersonalEndCol <> -1 Then
                    '計画期間 個人別集計範囲
                    Call SetBorder(m_Spread(1), M_Interval_Row, m_KeikakuKikan.PersonalStartCol, w_Row, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                    '計画期間 個人別集計ﾀｲﾄﾙ範囲 文字色/背景色 設定
                    .Cells(M_Interval_Row, m_KeikakuKikan.PersonalStartCol, M_YYYYMMDDLabel_Row, m_KeikakuKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Center
                    .Cells(M_Interval_Row, m_KeikakuKikan.PersonalStartCol, M_YYYYMMDDLabel_Row, m_KeikakuKikan.PersonalEndCol).BackColor = SystemColors.Control
                    .Cells(M_Interval_Row, m_KeikakuKikan.PersonalStartCol, M_YYYYMMDDLabel_Row, m_KeikakuKikan.PersonalEndCol).ForeColor = Color.Black

                    Call SubSetStyle(sprPTotal, M_Interval_Row, m_KeikakuKikan.KoteiStartCol, M_YYYYMMDDLabel_Row, m_KeikakuKikan.KoteiEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Center)
                    Call SubSetStyle(sprPTotal, M_EVENTLABEL_ROW, m_KeikakuKikan.KoteiStartCol, M_EVENTLABEL_ROW, m_KeikakuKikan.KoteiEndCol, 0, 0, Color.Black, Color.Silver, CellHorizontalAlignment.Center)

                    '計画期間 個人別集計ﾃﾞｰﾀ範囲 文字色/背景色 設定
                    .Cells(M_KinmuDataStart_Row, m_KeikakuKikan.PersonalStartCol, w_Row, m_KeikakuKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Right
                    .Cells(M_KinmuDataStart_Row, m_KeikakuKikan.PersonalStartCol, w_Row, m_KeikakuKikan.PersonalEndCol).BackColor = SystemColors.Control
                    .Cells(M_KinmuDataStart_Row, m_KeikakuKikan.PersonalStartCol, w_Row, m_KeikakuKikan.PersonalEndCol).ForeColor = Color.Black

                    Call SubSetStyle(sprPTotal, M_KinmuDataStart_Row, m_KeikakuKikan.KoteiStartCol, m_StaffRow.EndRow, m_KeikakuKikan.KoteiEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Right)
                End If

                '合計行 ?
                If m_DayAreaRow.EndRow > 0 Then
                    '合計行がある場合
                    'ﾃﾞｰﾀ範囲の下に
                    Call SetBorder(m_Spread(1), m_StaffRow.EndRow + 1, M_KinmuDataStart_Col, m_StaffRow.EndRow + 1, m_KeikakuKikan.PersonalEndCol, 2, 0, 0, 0, 0, Color.Black)

                    '日付別 ﾁｰﾑ別 集計範囲
                    For w_Int = 1 To UBound(m_DayDataRow)
                        Call SetBorder(m_Spread(1), m_DayDataRow(w_Int).StartRow, M_EmpShrtNghtData_Col, m_DayDataRow(w_Int).EndRow, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    Next w_Int

                    '日付別 ﾁｰﾑ別 集計範囲 表示位置 設定(右) 設定
                    .Cells(m_DayDataRow(1).StartRow, M_KinmuDataStart_Col, m_DayDataRow(UBound(m_DayDataRow)).EndRow, m_KeikakuKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Right

                    '日付別 ﾁｰﾑ別 集計範囲(計画) 文字色/背景色 設定
                    .Cells(m_DayDataRow(1).StartRow, m_KeikakuKikan.KinmuDataStartCol, m_DayDataRow(UBound(m_DayDataRow)).EndRow, m_KeikakuKikan.PersonalEndCol).BackColor = SystemColors.Control
                    .Cells(m_DayDataRow(1).StartRow, m_KeikakuKikan.KinmuDataStartCol, m_DayDataRow(UBound(m_DayDataRow)).EndRow, m_KeikakuKikan.PersonalEndCol).ForeColor = Color.Black

                    '日付別 ﾁｰﾑ別 集計範囲(計画) 文字色/背景色 設定
                    sprDayTotal_M.Sheets(0).Columns(m_KeikakuKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataEndCol).BackColor = SystemColors.Control
                    sprDayTotal_M.Sheets(0).Columns(m_KeikakuKikan.KinmuDataStartCol, m_KeikakuKikan.KinmuDataEndCol).ForeColor = Color.Black

                    '日付別 全集計範囲
                    Call SetBorder(m_Spread(1), m_DayDataRow(0).StartRow, M_KinmuDataStart_Col, m_DayDataRow(0).EndRow, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                    '日付別 全集計範囲 表示位置 設定(右) 設定
                    .Cells(m_DayDataRow(0).StartRow, M_KinmuDataStart_Col, m_DayDataRow(0).EndRow, m_KeikakuKikan.PersonalEndCol).HorizontalAlignment = CellHorizontalAlignment.Right

                    '日付別 全集計範囲(計画) 文字色/背景色 設定
                    .Cells(m_DayDataRow(0).StartRow, m_KeikakuKikan.KinmuDataStartCol, m_DayDataRow(0).EndRow, m_KeikakuKikan.PersonalEndCol).BackColor = SystemColors.Control
                    .Cells(m_DayDataRow(0).StartRow, m_KeikakuKikan.KinmuDataStartCol, m_DayDataRow(0).EndRow, m_KeikakuKikan.PersonalEndCol).ForeColor = Color.Black

                    '日付別 ﾁｰﾑ別 集計範囲
                    For w_Int = 0 To UBound(m_DayDataRow)
                        Call SetBorder(sprDayTotal_M, m_DayDataRow(w_Int).KoteiStartRow, M_EmpShrtNghtData_Col, m_DayDataRow(w_Int).KoteiEndRow, M_EmpShrtNghtData_Col, 0, 0, 0, 0, 2, Color.Black)
                        Call SetBorder(sprDayTotal_M, m_DayDataRow(w_Int).KoteiStartRow, M_KinmuDataStart_Col, m_DayDataRow(w_Int).KoteiEndRow, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    Next w_Int

                    '日付別 ﾁｰﾑ別 集計範囲
                    For w_Int = 0 To UBound(m_DayDataRow)
                        Call SetBorder(sprDayTotal_M, m_DayDataRow(w_Int).KoteiStartRow, m_KeikakuKikan.KinmuDataStartCol, m_DayDataRow(w_Int).KoteiEndRow, m_KeikakuKikan.KinmuDataStartCol, 0, 0, 2, 0, 0, Color.Black)
                    Next w_Int

                    If m_JissekiKikan.KinmuDataStartCol <> 0 OrElse m_JissekiKikan.KinmuDataEndCol <> -1 Then
                        For w_Int = 0 To UBound(m_DayDataRow)
                            Call SetBorder(sprDayTotal_M, m_DayDataRow(w_Int).KoteiStartRow, m_JissekiKikan.KinmuDataEndCol, m_DayDataRow(w_Int).KoteiEndRow, m_JissekiKikan.KinmuDataEndCol, 0, 0, 0, 2, 0, Color.Black)
                        Next w_Int
                    End If
                End If
            End With

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                With m_Spread(2)
                    '行ﾀｲﾄﾙ欄～ﾃﾞｰﾀ欄

                    '4週期間 個人別集計範囲
                    If m_4WeekKikan(UBound(m_4WeekKikan)).PersonalStartCol <> 0 AndAlso m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol <> -1 Then
                        For w_Int = 1 To UBound(m_4WeekKikan)

                            Call SetBorder(m_Spread(2), M_Interval_Row, m_4WeekKikan(w_Int).PersonalStartCol, w_Row, m_4WeekKikan(w_Int).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                            '4週期間 個人別集計ﾀｲﾄﾙ範囲 表示位置 設定
                            Call SubSetStyle(m_Spread(2), M_Interval_Row, m_4WeekKikan(w_Int).PersonalStartCol, M_EVENTLABEL_ROW, m_4WeekKikan(w_Int).PersonalEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Center)

                            If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                '4週期間 固定個人別集計ﾀｲﾄﾙ範囲 表示位置 設定
                                Call SubSetStyle(sprPTotal, M_Interval_Row, m_4WeekKikan(w_Int).KoteiStartCol, M_EVENTLABEL_ROW, m_4WeekKikan(w_Int).KoteiEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Center)
                            End If

                            '4週期間 個人別集計範囲 表示位置 設定
                            Call SubSetStyle(m_Spread(2), M_KinmuDataStart_Row, m_4WeekKikan(w_Int).PersonalStartCol, w_Row, m_4WeekKikan(w_Int).PersonalEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Right)

                            If m_4WeekKikan(w_Int).EndDate >= m_KeikakuKikan.StartDate Then
                                '固定個人別集計部
                                '4週期間 個人別集計範囲 表示位置 設定
                                Call SubSetStyle(sprPTotal, M_KinmuDataStart_Row, m_4WeekKikan(w_Int).KoteiStartCol, m_StaffRow.EndRow, m_4WeekKikan(w_Int).KoteiEndCol, 0, 0, Color.Black, SystemColors.Control, CellHorizontalAlignment.Right)
                            End If

                        Next w_Int
                    End If

                    '年月日から格納ｾﾙの列 取得
                    w_GetBool = Get_Col_4W(m_JissekiKikan.EndDate, w_Col)

                    '採用列罫線
                    Call SetBorder(sprDayTotal_4W, 0, M_EmpShrtNghtData_Col, sprDayTotal_4W.Sheets(0).RowCount - 1, M_EmpShrtNghtData_Col, 0, 0, 0, 0, 2, Color.Black)
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        '4週期間
                        '固定日別集計部（4週用）
                        If sprDayTotal_4W.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                            Call SetBorder(sprDayTotal_4W, 0, m_4WeekKikan(w_Int).KinmuDataStartCol, sprDayTotal_4W.Sheets(0).RowCount - 1, m_4WeekKikan(w_Int).KinmuDataEndCol, 0, 0, 0, 0, 2, Color.Black)
                        End If
                    Next w_Int

                    If w_GetBool = True Then
                        '4週期間(集計列含む) 行ﾀｲﾄﾙ 背景色 設定
                        Call SubSetStyle(m_Spread(2), M_Interval_Row, m_4WeekKikan(1).KinmuDataStartCol, M_EVENTLABEL_ROW, w_Col, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                        Call SubSetStyle(m_Spread(2), M_Interval_Row, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays + 1, M_EVENTLABEL_ROW, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))

                        '4週期間(集計列含む) ﾃﾞｰﾀ領域 文字色/背景色 設定
                        Call SubSetStyle(m_Spread(2), M_KinmuDataStart_Row, m_4WeekKikan(1).KinmuDataStartCol, w_Row, w_Col, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))
                        Call SubSetStyle(m_Spread(2), M_KinmuDataStart_Row, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays + 1, w_Row, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))

                        If sprDayTotal_4W.Sheets(0).RowCount > 0 Then
                            '4週期間(集計列含む) ﾃﾞｰﾀ領域 文字色/背景色 設定
                            Call SubSetStyle(sprDayTotal_4W, -1, m_4WeekKikan(1).KinmuDataStartCol, -1, w_Col, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))
                            Call SubSetStyle(sprDayTotal_4W, -1, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays + 1, -1, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))
                        End If
                    End If

                    '合計行 ?
                    If m_DayAreaRow.EndRow > 0 Then
                        '合計行がある場合
                        'ﾃﾞｰﾀ範囲の下に
                        Call SetBorder(m_Spread(2), m_StaffRow.EndRow + 1, M_KinmuDataStart_Col, m_StaffRow.EndRow + 1, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 2, 0, 0, 0, 0, Color.Black)

                        '日付別 ﾁｰﾑ別 集計範囲
                        For w_Int = 1 To UBound(m_DayDataRow)
                            Call SetBorder(m_Spread(2), m_DayDataRow(w_Int).StartRow, M_KinmuDataStart_Col, m_DayDataRow(w_Int).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                        Next w_Int

                        '日付別 ﾁｰﾑ別 集計範囲
                        For w_Int = 0 To UBound(m_DayDataRow)
                            Call SetBorder(sprDayTotal_4W, m_DayDataRow(w_Int).KoteiStartRow, M_EmpShrtNghtData_Col, m_DayDataRow(w_Int).KoteiEndRow, M_EmpShrtNghtData_Col, 0, 0, 0, 0, 2, Color.Black)
                            Call SetBorder(sprDayTotal_4W, m_DayDataRow(w_Int).KoteiStartRow, M_KinmuDataStart_Col, m_DayDataRow(w_Int).KoteiEndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                        Next w_Int

                        '日付別 ﾁｰﾑ別 集計範囲 表示位置 設定(右) 設定
                        Call SubSetStyle(m_Spread(2), m_DayDataRow(1).StartRow, M_KinmuDataStart_Col, m_DayDataRow(UBound(m_DayDataRow)).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, , , CellHorizontalAlignment.Right)

                        '年月日から格納ｾﾙの列 取得
                        w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_Col)

                        If w_GetBool = True Then
                            '日付別 ﾁｰﾑ別 集計範囲(計画) 文字色/背景色 設定
                            Call SubSetStyle(m_Spread(2), m_DayDataRow(1).StartRow, w_Col, m_DayDataRow(UBound(m_DayDataRow)).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, Color.Black, SystemColors.Control)

                            '日付別 ﾁｰﾑ別 集計範囲(計画) 文字色/背景色 設定
                            Call SubSetStyle(sprDayTotal_4W, -1, w_Col, -1, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays, 0, 0, Color.Black, SystemColors.Control)

                            '日付別 全集計範囲
                            Call SetBorder(m_Spread(2), m_DayDataRow(0).StartRow, M_KinmuDataStart_Col, m_DayDataRow(0).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                            '日付別 全集計範囲 表示位置 設定(右) 設定
                            Call SubSetStyle(m_Spread(2), m_DayDataRow(0).StartRow, M_KinmuDataStart_Col, m_DayDataRow(0).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, , , CellHorizontalAlignment.Right)

                            '日付別 全集計範囲(計画) 文字色/背景色 設定
                            Call SubSetStyle(m_Spread(2), m_DayDataRow(0).StartRow, w_Col, m_DayDataRow(0).EndRow, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, Color.Black, SystemColors.Control)
                        End If
                    End If

                    '二段表示してる時の計画期間外の上段を黒く塗りつぶす
                    Call Disp_BackColor(True, 0, 0, 0, 0)
                End With
            End If

            '---------------------------------------------
            '   計画立案期間毎に色を変更
            '---------------------------------------------
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                With m_Spread(1).Sheets(0)
                    '1ｹ月/1ｹ月
                    '4週/4週
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        .Cells(M_Interval_Row, m_KeikakuKikan.KinmuDataStartCol, M_Interval_Row, m_KeikakuKikan.KinmuDataEndCol).BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                    Else
                        .Cells(M_Interval_Row, m_JissekiKikan.KinmuDataStartCol, M_Interval_Row, m_JissekiKikan.KinmuDataEndCol).BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                        .Cells(M_Interval_Row, m_KeikakuKikan.KinmuDataStartCol, M_Interval_Row, m_KeikakuKikan.KinmuDataEndCol).BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                    End If
                End With
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                With m_Spread(1).Sheets(0)
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        If w_Int = 1 Then
                            w_StartCol = M_KinmuDataStart_Col
                            w_BoolStart = True
                        Else
                            w_BoolStart = Get_Col_M(DirectCast(m_4WeekKikan(w_Int).StartDate, Object), w_StartCol)
                        End If

                        If w_Int = UBound(m_4WeekKikan) Then
                            w_EndCol = m_KeikakuKikan.KinmuDataEndCol
                            w_BoolEnd = True
                        Else
                            w_BoolEnd = Get_Col_M(DirectCast(m_4WeekKikan(w_Int).EndDate, Object), w_EndCol)
                        End If

                        If w_BoolStart = True AndAlso w_BoolEnd = True Then
                            If w_ColorFlg = False Then
                                w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                                w_ColorFlg = True
                            Else
                                w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                                w_ColorFlg = False
                            End If

                            For w_Col = w_StartCol To w_EndCol
                                If (m_JissekiKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_JissekiKikan.KinmuDataEndCol) OrElse (m_KeikakuKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_KeikakuKikan.KinmuDataEndCol) Then
                                    .Cells(M_Interval_Row, w_Col).BackColor = w_BackColor
                                End If
                            Next w_Col
                        End If
                    Next w_Int
                End With

                With m_Spread(2).Sheets(0)
                    w_ColorFlg = False
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        If w_ColorFlg = False Then
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                            w_ColorFlg = True
                        Else
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                            w_ColorFlg = False
                        End If

                        .Cells(M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataStartCol, M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataEndCol).BackColor = w_BackColor
                    Next w_Int
                End With
            End If

            '処理経過ﾌｫｰﾑUnload
            w_ProcessForm.Close()

            w_ProcessForm = Nothing

            '正常終了
            Set_SprSheet = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務変更時 勤務予定ﾃﾞｰﾀ 取得(勤務実績ﾃﾞｰﾀと比較する)
    Private Sub Get_PlanPersonalData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_PlanPersonalData"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_EndCol As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_RiyuKBN As String
        Dim w_KinmuCD As String
        Dim w_HyojiFlg As Boolean
        Dim w_Time As String
        Dim w_Flg As String
        Dim w_StartCol As Integer
        Dim w_HairetuCnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_lngDate As Integer
        Dim w_KangoCD As String
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add


        Try
            '------------------------------
            '   勤務予定情報 取得
            '------------------------------
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Magenta)
            pProcessForm.pSyoriText = "勤務予定データ取得中..."
            '計画開始日取得
            w_StartDate = m_KeikakuKikan.StartDate
            w_StartCol = m_KeikakuKikan.KinmuDataStartCol

            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate
            '計画期間ﾃﾞｰﾀの終了列
            w_EndCol = m_KeikakuKikan.KinmuDataEndCol

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                w_HairetuCnt = m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol + 1
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                    w_HairetuCnt = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - w_KeikakuCol + 1
                Else
                    w_KeikakuCol = 0
                    w_HairetuCnt = 0
                End If
            End If

            With m_Spread(1).Sheets(0)

                '処理経過ﾌｫｰﾑ初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '該当行の職員のﾃﾞｰﾀ格納配列番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 職員管理番号取得
                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ退避
                            w_StaffIdx = Integer.Parse(w_Var)

                            '勤務ﾃﾞｰﾀ格納用配列定義
                            ReDim Preserve m_StaffData(w_StaffIdx).CompKinmuData(w_HairetuCnt)

                            '2017/11/17 Angelo add st----------------------------------------------
                            '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                            If m_intSelSaveNo > 0 Then
                                '一時保存からデータの取得
                                General.g_objGetData.p取得区分 = 1
                                General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                            Else
                                '予定勤務からデータの取得
                                General.g_objGetData.p取得区分 = 0
                            End If
                            '2017/11/17 Angelo add en----------------------------------------------

                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                            '勤務取得区分(予定)
                            General.g_objGetData.p勤務取得区分 = 0

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '時間年休取得
                                Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                                '控除データ取得
                                Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p予定年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f予定年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                            '4週/1ヶ月
                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If
                                        Else
                                            '1ｹ月/1ｹ月,4週/4週の場合
                                            If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If
                                        End If

                                        '勤務ｺｰﾄﾞ取得
                                        w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f予定理由区分
                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '応援先看護単位CD
                                        w_KangoCD = General.g_objGetData.f予定応援看護単位CD

                                        w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                        w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務予定登録者ID

                                        '2015/04/10 Bando Add Start ==================================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            w_Comment = General.g_objGetData.f予定希望コメント
                                        End If
                                        '2015/04/10 Bando Add End   ==================================

                                        '配属中？
                                        w_HyojiFlg = False
                                        For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                            If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                '配属している期間のとき
                                                w_HyojiFlg = True
                                                Exit For
                                            End If
                                        Next w_Int2

                                        '応援勤務者は配属期間外とする
                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                            w_HyojiFlg = False
                                        End If

                                        If w_HyojiFlg = True Then
                                            '配属している場合
                                            w_Flg = M_GAITOBUSHO
                                        Else
                                            '配属期間以外の場合
                                            w_Flg = M_TABUSHO
                                        End If '---> 配属中？

                                        If w_Col > 0 AndAlso w_KeikakuCol > 0 Then
                                            'ﾃﾞｰﾀ取得
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).DataFlg = M_PLANDATA
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If
                        End If

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Disp_CompResultData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Disp_CompResultData"

        Dim w_Row As Integer
        Dim w_StaffIdx As Integer
        Dim w_Var As Object
        Dim w_VarPlan As Object
        Dim w_VarResult As Object
        Dim w_From As Integer
        Dim w_To As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_KinmuCD As String
        Dim w_Riyu As String
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_Col As Integer
        Dim w_DataCol As Integer
        Dim w_BaseCol As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_IdoLoop As Integer
        Dim w_Idocnt As Integer
        Dim w_intCount As Integer
        Dim w_Time As String
        Dim w_KangoCD As String
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Red)
            pProcessForm.pSyoriText = "実績データ比較中..."
            '処理経過ﾌｫｰﾑ初期化
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

            w_intCount = 0

            '職員数Loop
            '応援勤務者も処理する
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                    '職員管理番号取得
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    '職員情報格納配列取得OK？
                    If IsNumeric(w_Var) = True Then

                        '職員ﾃﾞｰﾀ格納配列番号取得
                        w_StaffIdx = Integer.Parse(w_Var)

                        'PlanPeriodFrom
                        w_From = m_KeikakuKikan.StartDate
                        'PlanPeriodTo
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月の場合は最終の4週期間終了日
                            w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                            If Get_Col_4W(DirectCast(m_KeikakuKikan.StartDate, Object), w_BaseCol) = False Then
                                Exit For
                            End If
                            w_DataCnt = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - w_BaseCol + 1
                        Else
                            '4週/4週，1ヶ月/1ヶ月の場合は計画立案期間終了日
                            w_To = m_KeikakuKikan.EndDate
                            w_BaseCol = m_KeikakuKikan.KinmuDataStartCol
                            w_DataCnt = m_KeikakuKikan.KinmuDataEndCol - w_BaseCol + 1
                        End If

                        'ﾃﾞｰﾀ件数Loop
                        For w_DataLoop = 1 To UBound(m_StaffData(w_StaffIdx).KinmuData)

                            '日付取得
                            w_YYYYMMDD = m_StaffData(w_StaffIdx).KinmuData(w_DataLoop).Date_Renamed

                            '計画期間内のみ
                            If m_KeikakuKikan.StartDate <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_KeikakuKikan.EndDate Then

                                '在職期間を対象とする
                                If w_YYYYMMDD <= m_StaffData(w_StaffIdx).TentaiYMD OrElse m_StaffData(w_StaffIdx).TentaiYMD = 0 Then

                                    '勤務ｺｰﾄﾞ・理由区分取得
                                    w_KinmuCD = m_StaffData(w_StaffIdx).KinmuData(w_DataLoop).KinmuCD
                                    w_Riyu = m_StaffData(w_StaffIdx).KinmuData(w_DataLoop).RiyuKBN
                                    w_KangoCD = m_StaffData(w_StaffIdx).KinmuData(w_DataLoop).OuenKangoCD

                                    '勤務ﾃﾞｰﾀ格納相対位置取得（配列番号）
                                    If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                        w_Col = 0
                                    End If
                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ヶ月の場合
                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_DataCol) = False Then
                                            w_DataCol = 0
                                        End If
                                    Else
                                        '4週/4週，1ヶ月/1ヶ月の場合
                                        w_DataCol = w_Col
                                    End If
                                    If w_DataCol > 0 Then
                                        w_DataCol = w_DataCol - w_BaseCol + 1
                                    End If

                                    '配属しているの？
                                    w_Idocnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                    w_HaizokuFlg = False
                                    For w_IdoLoop = 1 To w_Idocnt
                                        If m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_IdoLoop).SyuryoYMD Then
                                            w_HaizokuFlg = True
                                            Exit For
                                        End If
                                    Next w_IdoLoop

                                    If Trim(w_KinmuCD) <> "" Then

                                        If m_StaffData(w_StaffIdx).KinmuData(w_DataCol).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀの場合
                                            '予定ﾃﾞｰﾀと比較する
                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_DataCol).KinmuCD Then
                                                '実績ﾃﾞｰﾀと予定ﾃﾞｰﾀが異なっていた場合

                                                If w_HaizokuFlg = True Then
                                                    '配属期間内
                                                    '勤務記号をｾﾙに設定する
                                                    w_Time = m_StaffData(w_StaffIdx).KinmuData(w_DataCol).Time
                                                    '2015/04/10 Bando Upd Start =========================================
                                                    w_Comment = m_StaffData(w_StaffIdx).KinmuData(w_DataCol).Comment
                                                    'w_VarResult = Set_KinmuMark(w_KinmuCD, w_Riyu, M_GAITOBUSHO, w_KangoCD, w_Time)
                                                    w_VarResult = Set_KinmuMark(w_KinmuCD, w_Riyu, M_GAITOBUSHO, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd Start =========================================

                                                    If w_Col > 0 Then
                                                        m_Spread(1).Sheets(0).SetText(w_Row, w_Col, w_VarResult)
                                                    End If

                                                    If w_Col > 0 Then
                                                        '勤務変更 色設定
                                                        m_Spread(1).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                    End If

                                                    '予定側
                                                    '勤務ｺｰﾄﾞ・理由区分取得
                                                    w_KinmuCD = m_StaffData(w_StaffIdx).CompKinmuData(w_DataCol).KinmuCD
                                                    w_Riyu = m_StaffData(w_StaffIdx).CompKinmuData(w_DataCol).RiyuKBN
                                                    w_KangoCD = m_StaffData(w_StaffIdx).CompKinmuData(w_DataCol).OuenKangoCD
                                                    '2015/04/10 Bando Upd Start =========================================
                                                    w_Comment = m_StaffData(w_StaffIdx).CompKinmuData(w_DataCol).Comment
                                                    'w_VarPlan = Set_KinmuMark(w_KinmuCD, w_Riyu, M_GAITOBUSHO, w_KangoCD, w_Time)
                                                    w_VarPlan = Set_KinmuMark(w_KinmuCD, w_Riyu, M_GAITOBUSHO, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   =========================================

                                                    If w_Col > 0 Then
                                                        m_Spread(1).Sheets(0).SetText(w_Row + 1, w_Col, w_VarPlan)

                                                        If m_StaffData(w_StaffIdx).OuenStaffFlg <> 1 Then
                                                            '色設定
                                                            '応援勤務の場合
                                                            If w_Riyu = "6" Then
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                            Else
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = Color.White
                                                            End If
                                                            '代休発生勤務 文字/背景色
                                                            If General.g_lngDaikyuMng = 0 Then
                                                                w_Var = m_Spread(1).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var <> "" Then
                                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var), w_StaffIdx) = True Then
                                                                        w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                    End If
                                                                End If
                                                            End If

                                                            '2015/07/22 Bando Add Start ===========================
                                                            '控除があるか判断し　背景色変更
                                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                w_Var = m_Spread(1).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var <> "" Then
                                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                        If w_Var = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_Riyu = "6" Then
                                                                                Exit For
                                                                            End If
                                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                            Exit For
                                                                        End If
                                                                    Next
                                                                End If
                                                            End If
                                                            '2015/07/22 Bando Add End   ===========================

                                                            If w_Time <> "" Then
                                                                '勤務時間が登録されている場合
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                            End If

                                                            m_Spread(1).Sheets(0).Cells(w_Row + 1, w_Col).BackColor = w_BackColor
                                                            m_Spread(1).Sheets(0).Cells(w_Row + 1, w_Col).ForeColor = w_ForeColor
                                                        End If
                                                    End If

                                                    '4週/1ヶ月の場合のみ
                                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                        '勤務記号をｾﾙに設定する(4週用）
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_VarResult)

                                                            '勤務変更 色設定
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)

                                                            '予定側
                                                            m_Spread(2).Sheets(0).SetText(w_Row + 1, w_Col, w_VarPlan)

                                                            If m_StaffData(w_StaffIdx).OuenStaffFlg <> 1 Then
                                                                '色設定
                                                                '応援勤務の場合
                                                                If w_Riyu = "6" Then
                                                                    w_ForeColor = Color.Black
                                                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                                Else
                                                                    w_ForeColor = Color.Black
                                                                    w_BackColor = Color.White
                                                                End If
                                                                '代休発生勤務 文字/背景色
                                                                If General.g_lngDaikyuMng = 0 Then
                                                                    w_Var = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                    If w_Var <> "" Then
                                                                        If Check_DaikyuBackColor(Integer.Parse(w_Var), w_StaffIdx) = True Then
                                                                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                        End If
                                                                    End If
                                                                End If

                                                                '2015/07/22 Bando Add Start ===========================
                                                                '控除があるか判断し　背景色変更
                                                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                    w_Var = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                    If w_Var <> "" Then
                                                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                            If w_Var = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_Riyu = "6" Then
                                                                                    Exit For
                                                                                End If
                                                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                                Exit For
                                                                            End If
                                                                        Next
                                                                    End If
                                                                End If
                                                                '2015/07/22 Bando Add End   ===========================

                                                                If w_Time <> "" Then
                                                                    '勤務時間が登録されている場合
                                                                    w_ForeColor = Color.Black
                                                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                                End If
                                                                m_Spread(2).Sheets(0).Cells(w_Row + 1, w_Col).BackColor = w_BackColor
                                                                m_Spread(2).Sheets(0).Cells(w_Row + 1, w_Col).ForeColor = w_ForeColor
                                                            End If
                                                        End If
                                                    End If
                                                End If '---> 配属期間内？
                                            End If '---> 起動モードチェック
                                        End If '---> 取得勤務ﾃﾞｰﾀは 計画 Or 実績
                                    End If '---> 再掲ﾃﾞｰﾀの勤務ｺｰﾄﾞ設定OK？
                                End If '---> 在職中？（退職日チェック）
                            End If '---> '計画期間内のみ
                        Next w_DataLoop
                    End If '---> 職員情報格納配列取得OK？

                    '処理経過ｶｳﾝﾄ
                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount

                End If
            Next w_Row

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '勤務予定ﾃﾞｰﾀ 取得(計画期間の最後４週部分)[勤務変更時 勤務実績ﾃﾞｰﾀと比較する]
    Private Sub Get_PlanPersonalData_4W(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_PlanPersonalData_4W"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_RiyuKBN As String
        Dim w_KinmuCD As String
        Dim w_HyojiFlg As Boolean
        Dim w_Time As String
        Dim w_Flg As String = String.Empty
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_Bool As Boolean
        Dim w_lngDate As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String
        Dim w_Comment As String '2015/04/10 Bando Add
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Sub
            End If

            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Cyan)
            pProcessForm.pSyoriText = "計画期間データ取得中..."

            '------------------------------
            '   計画期間外の最後４週部分 取得
            '------------------------------
            '計画開始日取得
            w_StartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))

            '計画終了日取得
            w_EndDate = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate

            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = False Then
                w_KeikakuCol = 0
            End If

            With m_Spread(2).Sheets(0)

                '処理経過ﾌｫｰﾑの初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)

                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = Integer.Parse(w_Var)

                            '==============================================================================
                            '   予定ﾃﾞｰﾀ取得
                            '==============================================================================
                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                            '勤務取得区分(予定)
                            General.g_objGetData.p勤務取得区分 = 0

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '時間年休取得
                                Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                                '控除データ取得
                                Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p予定年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f予定年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        w_Bool = Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col)

                                        '勤務ｺｰﾄﾞの取得
                                        w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f予定理由区分

                                        w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                        w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務予定登録者ID

                                        '2015/04/10 Bando Add Start ===========================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            w_Comment = General.g_objGetData.f予定希望コメント
                                        End If
                                        '2015/04/10 Bando Add End   ===========================

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        If w_Bool = True Then
                                            '配属しているか？
                                            w_HyojiFlg = False
                                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                    '配属している期間のとき
                                                    w_HyojiFlg = True
                                                    Exit For
                                                End If
                                            Next w_Int2

                                            '応援勤務者は配属期間外とする
                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                                w_HyojiFlg = False
                                            End If

                                            If w_HyojiFlg = True Then
                                                '配属期間内の場合
                                                '確定部署ﾌﾗｸﾞを該当部署で設定
                                                w_Flg = M_GAITOBUSHO
                                            Else
                                                '配属期間外の場合
                                                '確定部署ﾌﾗｸﾞを他部署で設定
                                                w_Flg = M_TABUSHO
                                            End If
                                        End If '4週用列番号取得

                                        If w_KeikakuCol > 0 AndAlso w_Bool = True Then
                                            '変数に格納する
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).DataFlg = M_PLANDATA
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).CompKinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If

                                        '１日加算
                                        w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                    End If
                                Next w_Int '---> ﾃﾞｰﾀ件数分Loop
                            End If '---> ﾃﾞｰﾀ存在？
                        End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得OK？

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Disp_BackColor(ByVal p_AllFLG As Boolean, ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_Col2 As Integer, ByVal p_Row2 As Integer)

        Const W_SUBNAME As String = "NSK0000HA Disp_BackColor"

        Dim w_Int As Integer
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_RowLoop As Integer
        Dim w_StartDate(1) As Integer
        Dim w_EndDate(1) As Integer
        Dim w_blnFLG As Boolean
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Sub
            End If

            If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                '実績変更・計画変更以外の場合
                '実績変更以外の場合
                Exit Sub
            End If

            '------------------------------
            '   計画期間外の最初４週部分 取得
            '------------------------------
            '開始日取得
            w_StartDate(0) = m_4WeekKikan(1).StartDate
            '終了日取得
            w_EndDate(0) = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))

            '------------------------------
            '   計画期間外の最後４週部分 取得
            '------------------------------
            '開始日取得
            w_StartDate(1) = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
            '終了日取得
            w_EndDate(1) = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate

            If p_AllFLG Then
                w_Row = m_StaffRow.StartRow
                w_Row2 = m_StaffRow.EndRow
            Else
                w_Row = p_Row
                w_Row2 = p_Row2
            End If

            '職員数 繰り返し処理
            For w_RowLoop = w_Row To w_Row2
                w_blnFLG = False
                If m_blnJissekiUseFlg Then
                    If (w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        w_blnFLG = True
                    End If
                Else
                    If (w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                        w_blnFLG = True
                    End If
                End If

                If w_blnFLG Then
                    'ﾃﾞｰﾀ件数Loop
                    For w_Int = 0 To 1
                        '勤務記号をｾﾙに設定する(4週用）
                        If Get_Col_4W(DirectCast(w_StartDate(w_Int), Object), w_Col) = True AndAlso Get_Col_4W(DirectCast(w_EndDate(w_Int), Object), w_Col2) = True Then
                            If p_AllFLG = False Then
                                If w_Col < p_Col Then
                                    w_Col = p_Col
                                End If
                                If w_Col2 > p_Col2 Then
                                    w_Col2 = p_Col2
                                End If
                            End If

                            '計画期間外
                            If w_Col <= w_Col2 Then
                                '色設定
                                Call SubSetStyle(m_Spread(2), w_RowLoop, w_Col, w_RowLoop, w_Col2, 0, 0, Color.Black, Color.Black)
                            End If
                        End If
                    Next w_Int
                End If
            Next w_RowLoop

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｽﾌﾟﾚｯﾄﾞｼｰﾄ ﾃﾞﾌｫﾙﾄ設定
    Private Function Set_PersonalForm_ChgJisseki(ByVal p_SprSheet As FpSpread, ByVal p_SprKeikaku As FpSpread, ByRef pDataFlg As Object, ByRef pKakuteiFlg As Object, ByRef pDataHideFlg As Object, ByRef pKakuteiHideFlg As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Set_PersonalForm_ChgJisseki"

        Dim w_Col As Integer
        Dim w_Cnt As Integer
        Dim w_Var As Object
        Dim w_FonSize As Integer
        Dim w_StartCol As Integer
        Dim w_HyojiFlg As Boolean
        Dim w_MsgRc As Integer
        Dim w_DataFlg As Object
        Dim w_KakuteiFlg As Object
        Dim w_DataHideFlg As Object
        Dim w_KakuteiHideFlg As Object
        Dim w_Index As Integer
        Dim w_Var2 As Object
        Dim w_StaffIdx As Integer
        Dim w_KeikakuCol As Integer
        Dim w_DataIdx As Integer
        Dim w_GetCol As Integer
        Dim w_Bool As Boolean
        Dim w_OutPutFlg As Boolean
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_KinmuPlanCD As String
        Dim w_KangoCD As String = String.Empty
        Dim w_KangoPlanCD As String
        Dim w_RiyuPlanKbn As String
        Dim w_PlanTime As String
        Dim w_NowDaikyuFlg As Boolean
        Dim w_LoadDaikyuFlg As Boolean
        Dim w_DaikyuFlg As Boolean
        Dim w_Int As Integer
        Dim w_ActiveRow As Integer
        Dim w_ActiveRow2 As Integer
        Dim w_strMsg() As String
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_sngWidth As Single
        Dim w_sngHeight As Single
        Dim w_Style As New StyleInfo
        Dim w_BackColor As Color
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add

        Set_PersonalForm_ChgJisseki = False
        Try
            '*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 開始 ***
            With p_SprSheet
                If m_SelViewKikan = 0 Then
                    '1ｹ月画面表示のとき
                    w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                Else
                    '4週画面表示のとき
                    w_StartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                End If

                w_ActiveRow = m_ActiveRow - ((m_ActiveRow - m_StaffRow.StartRow) Mod m_MaxShowLine)

                '勤務 設定
                w_FonSize = p_SprKeikaku.Font.SizeInPoints

                'ﾌｫﾝﾄｻｲｽﾞ 変更
                .Font = New Font("ＭＳ ゴシック", w_FonSize)

                'ｾﾙのｻｲｽﾞ設定
                .Sheets(0).SetColumnWidth(-1, m_CellWidth)
                .Sheets(0).SetRowHeight(-1, m_CellHeight)

                '日付表示行の高さ0
                .Sheets(0).SetRowHeight(M_KinmuData_Row - 1, 0)

                '行個数 設定
                .Sheets(0).RowCount = M_KinmuData_Row + 3

                '列個数 設定
                .Sheets(0).ColumnCount = m_KeikakuD_EndCol + 1

                '行ﾀｲﾄﾙ 固定行数 設定
                .Sheets(0).FrozenRowCount = (M_KinmuData_Row - 1)

                '列ﾀｲﾄﾙ 固定列数 設定
                .Sheets(0).FrozenColumnCount = (M_KinmuData_Col - 1)

                '全体(ﾗﾍﾞﾙ型)
                Call SubSetStyle(p_SprSheet, -1, -1, -1, -1, 1, 0)

                'ｽﾌﾟﾚｯﾄﾞのｾﾙ属性の設定(初期状態は全て文字ｾﾙ)
                '行ﾀｲﾄﾙ(ﾗﾍﾞﾙ)
                Call SubSetStyle(p_SprSheet, M_RowTitle_Row, -1, M_KinmuData_Row - 1, -1, 1, 0, , ColorTranslator.FromOle(12632256), CellHorizontalAlignment.Left, CellVerticalAlignment.Center)

                'ﾀｲﾄﾙ設定
                w_Var = "日 付"
                .Sheets(0).SetText(M_RowTitle_Row, M_ColTitle_Col, w_Var)
                w_Var = "曜 日"
                .Sheets(0).SetText(M_RowTitle_Row + 1, M_ColTitle_Col, w_Var)

                'ﾀｲﾄﾙを中央に
                Call SubSetStyle(p_SprSheet, M_RowTitle_Row, M_ColTitle_Col, M_KinmuData_Row - 1, M_KinmuData_Col - 1, 0, 0, , , CellHorizontalAlignment.Center)

                'セルの選択位置(上下左右)に罫線を表示
                Call SetBorder(p_SprSheet, -1, M_ColTitle_Col, -1, M_ColTitle_Col, 2, 2, 2, 2, 0, Color.Black)

                '隠しｾﾙ行の高さ0(勤務変更画面表示ﾃﾞｰﾀ格納)
                .Sheets(0).SetRowHeight(M_KinmuData_Row + 2, 0)
            End With
            '*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 終了 ***

            '日付・曜日・色設定
            'ｶｳﾝﾀｰ初期化
            w_Cnt = 0

            '*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 開始 ***
            With p_SprSheet.Sheets(0)
                For w_Col = m_KeikakuD_StartCol To m_KeikakuD_EndCol

                    '日付設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 1, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row, w_Col, w_Var)

                    '曜日設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 2, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row + 1, w_Col, w_Var)

                    '隠しｾﾙの日付設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 3, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row + 2, w_Col, w_Var)

                    '日付設定（色）
                    w_Style.Reset()
                    w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(M_MonthLabel_Row + 1, w_StartCol + w_Cnt, w_Style)
                    Call SubSetStyle(p_SprSheet, M_RowTitle_Row, w_Col, M_RowTitle_Row, w_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                    '曜日設定（色）
                    w_Style.Reset()
                    w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(M_MonthLabel_Row + 2, w_StartCol + w_Cnt, w_Style)
                    Call SubSetStyle(p_SprSheet, M_RowTitle_Row + 1, w_Col, M_RowTitle_Row + 1, w_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                    'ｶﾗﾑｶｳﾝﾀｰｱｯﾌﾟ
                    w_Cnt = w_Cnt + 1

                Next w_Col

                '-- 列ﾀｲﾄﾙ(職員情報)の設定 ----------------------
                w_Var = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, M_StaffName_Col)
                .SetText(M_ColTitle_Row, M_ColTitle_Col, w_Var)

                w_Var = p_SprKeikaku.Sheets(0).GetStyleInfo(w_ActiveRow, M_StaffName_Col + 1)
                .SetStyleInfo(M_ColTitle_Row, M_ColTitle_Col + 1, w_Var)

                w_Style.Reset()
                w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(w_ActiveRow, M_StaffName_Col, w_Style)
                Call SubSetStyle(p_SprSheet, M_ColTitle_Row, M_ColTitle_Col, M_ColTitle_Row, M_ColTitle_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                '既存勤務ﾃﾞｰﾀ 設定

                'ｶｳﾝﾀ初期化
                w_Cnt = 0

                '表示ﾌﾗｸﾞ初期化
                w_HyojiFlg = False

                w_Index = m_KeikakuD_EndCol - m_KeikakuD_StartCol + 1
                ReDim w_DataFlg(w_Index)
                ReDim w_KakuteiFlg(w_Index)
                ReDim w_DataHideFlg(w_Index)
                ReDim w_KakuteiHideFlg(w_Index)

                w_Index = 1

                '該当職員の配列ｲﾝﾃﾞｯｸｽを取得
                If m_SelViewKikan = 0 Then
                    '1ｹ月画面表示のとき
                    w_Var2 = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                Else
                    '4週画面表示のとき
                    w_Var2 = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                End If

                If IsNumeric(w_Var2) = True Then

                    '職員配列ｲﾝﾃﾞｯｸｽ取得
                    w_StaffIdx = Integer.Parse(w_Var2)

                    For w_Col = m_KeikakuD_StartCol To m_KeikakuD_EndCol

                        '変数初期化(変更可能スプレッドに表示する勤務判定)
                        w_OutPutFlg = False
                        '比較用勤務予定CD格納 変数
                        w_KinmuPlanCD = ""
                        w_KangoPlanCD = ""
                        w_RiyuPlanKbn = ""
                        w_PlanTime = ""

                        If m_blnJissekiUseFlg Then
                            '勤務実績の段を表示してる時
                            w_Var2 = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow + m_KinmuJisseki, w_StartCol + w_Cnt)
                            If w_Var2 <> "" OrElse p_SprKeikaku.Sheets(0).Cells(w_ActiveRow + m_KinmuPlan, w_StartCol + w_Cnt).BackColor.Equals(Color.Black) Then
                                '勤務実績の段にデータが存在する時 または 勤務予定の段の背景色が黒の時、勤務実績の段のデータを取得
                                w_ActiveRow2 = w_ActiveRow + m_KinmuJisseki
                            Else
                                w_ActiveRow2 = w_ActiveRow + m_KinmuPlan
                            End If
                        Else
                            w_ActiveRow2 = w_ActiveRow + m_KinmuPlan
                        End If

                        w_Var2 = p_SprKeikaku.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_Cnt)
                        If IsDate(Format(Integer.Parse(w_Var2), "0000/00/00")) = True Then
                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ヶ月
                                w_Bool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                If w_Bool = True Then
                                    w_Bool = Get_Col_4W(w_Var2, w_GetCol)
                                End If
                            Else
                                '1ヶ月/1ヶ月，4週/4週
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Bool = Get_Col_M(w_Var2, w_GetCol)
                            End If
                            If w_Bool = True Then
                                w_DataIdx = w_GetCol - w_KeikakuCol + 1
                                If w_DataIdx > 0 Then
                                    w_DataFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).DataFlg 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).KakuteiFlg '確定ﾌﾗｸﾞ

                                    w_DataHideFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).DataFlg 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiHideFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).KakuteiFlg '確定ﾌﾗｸﾞ

                                    '勤務変更画面に表示されている勤務CD 取得
                                    '2015/04/10 Bando Upd Start ====================
                                    'Call Get_KinmuMark(p_SprKeikaku.Sheets(0).GetText(w_ActiveRow2, w_StartCol + w_Cnt), w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(p_SprKeikaku.Sheets(0).GetText(w_ActiveRow2, w_StartCol + w_Cnt), w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   ====================

                                    '勤務変更画面に表示されている勤務CD と比較する勤務予定CD 取得
                                    w_KinmuPlanCD = m_StaffData(w_StaffIdx).CompKinmuData(w_DataIdx).KinmuCD
                                    w_KangoPlanCD = m_StaffData(w_StaffIdx).CompKinmuData(w_DataIdx).OuenKangoCD
                                    w_RiyuPlanKbn = m_StaffData(w_StaffIdx).CompKinmuData(w_DataIdx).RiyuKBN
                                    w_PlanTime = m_StaffData(w_StaffIdx).CompKinmuData(w_DataIdx).Time

                                    '背景色取得
                                    w_Var = ColorTranslator.ToOle(p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor)

                                    w_NowDaikyuFlg = False
                                    w_LoadDaikyuFlg = False
                                    w_DaikyuFlg = False

                                    If General.g_lngDaikyuMng = 0 Then
                                        For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int).HolDate = Integer.Parse(w_Var2) Then
                                                w_NowDaikyuFlg = True
                                            End If
                                        Next w_Int

                                        For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).LoadDaikyu)
                                            If m_StaffData(w_StaffIdx).LoadDaikyu(w_Int).HolDate = Integer.Parse(w_Var2) Then
                                                w_LoadDaikyuFlg = True
                                            End If
                                        Next w_Int

                                        If w_LoadDaikyuFlg <> w_NowDaikyuFlg Then
                                            w_DaikyuFlg = True
                                        End If
                                    End If

                                    If w_KakuteiFlg(w_Index) = "0" Then
                                        If Trim(w_KinmuCD) <> Trim(w_KinmuPlanCD) OrElse w_Var = m_MonthBefore_Back OrElse w_Var2 > m_KeikakuKikan.EndDate OrElse w_RiyuKBN <> w_RiyuPlanKbn OrElse w_KangoCD <> w_KangoPlanCD OrElse w_Time <> w_PlanTime OrElse w_DaikyuFlg = True Then '理由区分と応援看護単位CDを追加
                                            '勤務実績CDが勤務予定CDと異なる場合
                                            '勤務入力不可能(部署異動)セルの場合
                                            '勤務入力不可能(計画期間外の4週部分)セルの場合
                                            '勤務入力可能(計画期間外の4週部分)セル(予定ﾃﾞｰﾀ)の場合
                                            w_OutPutFlg = True
                                        End If
                                    Else
                                        w_OutPutFlg = True
                                    End If
                                Else
                                    w_DataFlg(w_Index) = "" 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiFlg(w_Index) = "" '確定ﾌﾗｸﾞ

                                    w_DataHideFlg(w_Index) = "" 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiHideFlg(w_Index) = "" '確定ﾌﾗｸﾞ

                                    '背景色取得
                                    w_Var = ColorTranslator.ToOle(p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor)
                                    If w_Var = m_MonthBefore_Back Then
                                        '勤務入力不可能（前月実績）セルの場合
                                        w_OutPutFlg = True
                                    End If
                                End If
                            End If
                            w_Index = w_Index + 1
                        End If

                        '勤務 設定
                        If w_Var2 >= m_KeikakuKikan.StartDate AndAlso w_Var2 <= m_KeikakuKikan.EndDate Then

                            'ｽﾌﾟﾚｯﾄﾞに貼り付ける勤務記号を取得(勤務予定CD)
                            '2015/04/10 Bando Upd Start =========================
                            'w_Var = Set_KinmuMark(w_KinmuPlanCD, w_RiyuPlanKbn, "", w_KangoPlanCD, w_PlanTime)
                            w_Var = Set_KinmuMark(w_KinmuPlanCD, w_RiyuPlanKbn, "", w_KangoPlanCD, w_PlanTime, w_Comment)
                            '2015/04/10 Bando Upd End   =========================

                            If w_RiyuPlanKbn = "6" Then
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            ElseIf w_PlanTime <> "" Then
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            ElseIf w_LoadDaikyuFlg = True Then
                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                            Else
                                If m_blnJissekiUseFlg Then
                                    w_BackColor = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow + m_KinmuPlan, w_StartCol + w_Cnt).BackColor
                                Else
                                    w_BackColor = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow + m_KinmuJisseki, w_StartCol + w_Cnt).BackColor
                                End If
                            End If

                            If w_KakuteiFlg(w_Index - 1) = "0" AndAlso p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor.Equals(Color.White) Then
                            ElseIf w_HyojiFlg = False AndAlso ColorTranslator.ToOle(p_SprKeikaku.BackColor) = m_MonthBefore_Back Then
                                '他部署確定の勤務データは出さない
                            ElseIf w_KakuteiFlg(w_Index - 1) = "1" Then
                                w_Var = ""
                                '希望・などの背景が色付きの場合は勤務を表示する
                            ElseIf Not p_SprKeikaku.BackColor.Equals(Color.White) Then
                            Else
                                w_Var = ""
                            End If

                            .SetText(M_KinmuData_Row, w_Col, w_Var)
                            Call SubSetStyle(p_SprSheet, M_KinmuData_Row, w_Col, M_KinmuData_Row, w_Col, 0, 0, Color.Black, w_BackColor)
                        Else
                            '計画期間外
                            Call SubSetStyle(p_SprSheet, M_KinmuData_Row, w_Col, M_KinmuData_Row, w_Col, 0, 0, Color.Black, Color.Black)
                        End If

                        '下段表示対象？
                        If w_OutPutFlg = True Then
                            w_Var = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow2, w_StartCol + w_Cnt)

                            If ColorTranslator.ToOle(p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor) <> m_MonthBefore_Back Then
                                .SetText(M_KinmuData_Row + 1, w_Col, w_Var)
                            End If

                            '勤務 設定（色）
                            w_Var = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).ForeColor
                            If w_RiyuKBN = "6" Then
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            ElseIf w_PlanTime <> "" Then
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                w_BackColor = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor
                            End If

                            Call SubSetStyle(p_SprSheet, M_KinmuData_Row + 1, w_Col, M_KinmuData_Row + 1, w_Col, 0, 0, w_Var, w_BackColor)
                        End If

                        '実績変更画面ﾃﾞｰﾀ[そのまんま](隠しｾﾙﾃﾞｰﾀ)
                        w_Var = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow2, w_StartCol + w_Cnt)
                        .SetText(M_KinmuData_Row + 2, w_Col, w_Var)
                        '勤務 設定（色）

                        w_Var = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).ForeColor
                        w_BackColor = p_SprKeikaku.Sheets(0).Cells(w_ActiveRow2, w_StartCol + w_Cnt).BackColor
                        Call SubSetStyle(p_SprSheet, M_KinmuData_Row + 2, w_Col, M_KinmuData_Row + 2, w_Col, 0, 0, w_Var, w_BackColor)
                        w_Var = ColorTranslator.ToOle(w_BackColor)

                        '"選択期間内すべてが他部署所属の職員のため個人別勤務登録できません。"の確認
                        If w_Var <> m_MonthBefore_Back AndAlso w_Var <> m_Jisseki4W_Back Then
                            w_HyojiFlg = True
                        End If

                        'ｶﾗﾑｶｳﾝﾀｱｯﾌﾟ
                        w_Cnt = w_Cnt + 1
                    Next w_Col
                End If

                If w_HyojiFlg = False Then
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "選択期間内すべてが他部署所属の職員のため~n"
                    Call Set_MsgZOrder("NS0095", w_strMsg, w_MsgRc, 0)
                    Exit Function
                End If

                '氏名欄の幅を調整する。
                .SetColumnWidth(M_ColTitle_Col, .GetPreferredColumnWidth(M_ColTitle_Col))

                '-- ｽﾌﾟﾚｯﾄﾞｼｰﾄ 開始ｾﾙ位置 設定 -------------------
                .SetActiveCell(M_KinmuData_Row + 1, M_KinmuData_Col)

                w_sngWidth = 0
                w_sngHeight = 0

                For w_RowLoop = 0 To .RowCount - 1
                    w_sngHeight = w_sngHeight + .GetRowHeight(w_RowLoop)
                Next w_RowLoop

                For w_ColLoop = 0 To .ColumnCount - 1
                    w_sngWidth = w_sngWidth + .GetColumnWidth(w_ColLoop)
                Next w_ColLoop

                p_SprSheet.Height = w_sngHeight + 2
                p_SprSheet.Width = w_sngWidth + 2

                m_PersonalSpreadSize = p_SprSheet.Width
            End With
            '*** ｽﾌﾟﾚｯﾄﾞ Withｽﾃｰﾄﾒﾝﾄ 終了 ***

            'ﾃﾞｰﾀﾌﾗｸﾞ、確定ﾌﾗｸﾞ
            pDataFlg = w_DataFlg
            pKakuteiFlg = w_KakuteiFlg
            'ﾃﾞｰﾀﾌﾗｸﾞ、確定ﾌﾗｸﾞ(隠しｾﾙﾃﾞｰﾀ)
            pDataHideFlg = w_DataHideFlg
            pKakuteiHideFlg = w_KakuteiHideFlg

            Set_PersonalForm_ChgJisseki = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '実績期間の実績データ取得
    Private Sub Get_JissekiData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_JissekiData"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_Int As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Var As Object
        Dim w_RiyuKBN As String
        Dim w_Seq As Integer
        Dim w_Index As Integer
        Dim w_KinmuCD As String
        Dim w_PersonalGoukei() As Single '実績期間個人別集計
        Dim w_Time As String
        Dim w_Flg As String
        Dim w_EndCol As Integer
        Dim w_intCount As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_lngDate As Integer
        Dim w_KangoCD As String
        Dim w_OuenFlg As Boolean
        Dim w_Var2 As Object
        Dim w_StaffIdx As Integer
        Dim w_Hour1 As Integer
        Dim w_Min1 As Integer
        Dim w_Time1 As Integer
        Dim w_Time2 As Integer
        Dim w_KinmuTime As Integer
        Dim w_str As String
        Dim w_DaikyuLoop As Integer
        Dim w_DaikyuPossibleCnt As Double '代休取得可能日数
        Dim w_dblWorkNum As Double
        Dim w_Comment As String '2015/04/10 Bando Add
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Magenta)
            pProcessForm.pSyoriText = "勤務実績データ取得中..."

            '--- 実績ﾃﾞｰﾀ取得開始日 取得 ---
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                '実績取込開始日を開始日とする
                w_StartDate = m_JissekiKikan.StartDate
            ElseIf (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                '4週/1ｹ月の場合
                '4週期間開始日を開始日とする
                w_StartDate = m_4WeekKikan(1).StartDate
            End If
            w_StartDate = Integer.Parse(Date.Parse(w_StartDate.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")) '2016/08/30 Yamanishi Add
            w_EndDate = m_JissekiKikan.EndDate

            With m_Spread(1).Sheets(0)

                '処理経過設定画面初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '個人別集計 配列 定義(集計項目数)
                        ReDim w_PersonalGoukei(UBound(m_HMtrx))

                        '該当行の職員のﾃﾞｰﾀ格納配列番号取得
                        w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                        w_StaffIdx = Integer.Parse(w_Var2)

                        '********************************
                        '     代休取得可能日数の取得
                        '********************************
                        w_DaikyuPossibleCnt = 0
                        '該当職員の代休情報件数分ループする
                        For w_DaikyuLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                            '代休集計期間かどうか？
                            If m_lngDaikyuStartDate_Cnt <= m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop).HolDate <= m_lngDaikyuEndDate_Cnt Then

                                '代休発生量を判断
                                Select Case m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop).GetKbn
                                    Case "0"
                                        w_dblWorkNum = 1
                                    Case "1"
                                        w_dblWorkNum = 1.5
                                End Select

                                '代休集計期間
                                If m_KeikakuKikan.StartDate <= m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop).HolDate <= m_KeikakuKikan.EndDate Then
                                    '代休未使用分を加算
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                Else
                                    '代休未使用分を加算
                                    With m_StaffData(w_StaffIdx).Daikyu(w_DaikyuLoop)
                                        If Double.Parse(.OutPutList) = 1 AndAlso UBound(.DaikyuDetail) = 0 Then
                                        Else
                                            w_dblWorkNum = .RemainderHol
                                            For w_Seq = 1 To UBound(.DaikyuDetail)
                                                If m_KeikakuKikan.StartDate <= .DaikyuDetail(w_Seq).DaikyuDate AndAlso .DaikyuDetail(w_Seq).DaikyuDate <= m_KeikakuKikan.EndDate Then
                                                    Select Case .DaikyuDetail(w_Seq).GetFlg
                                                        Case "0"
                                                            '１日
                                                            w_dblWorkNum = w_dblWorkNum + 1
                                                        Case "1"
                                                            '半日
                                                            w_dblWorkNum = w_dblWorkNum + 0.5
                                                    End Select
                                                End If
                                            Next w_Seq
                                        End If
                                    End With
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                End If
                            End If
                        Next w_DaikyuLoop

                        '代休区分の集計配列に代休取得可能日数を格納する
                        For w_Seq = 1 To UBound(m_HMtrx)
                            If m_HMtrx(w_Seq).CntKbn = "6" Then
                                w_PersonalGoukei(w_Seq) = w_DaikyuPossibleCnt
                            End If
                        Next w_Seq

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 職員管理番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                        If w_Var <> "" Then
                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = w_Var

                            '勤務取得区分(実績)
                            General.g_objGetData.p勤務取得区分 = 1

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '時間年休取得
                                Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                                '控除データ取得
                                Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p実績年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f実績年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '勤務記号取得
                                        w_KinmuCD = General.g_objGetData.f実績勤務CD

                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f実績理由区分

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        w_KangoCD = General.g_objGetData.f実績応援看護単位CD

                                        w_OuenFlg = False
                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                            w_OuenFlg = True
                                        Else
                                            '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                            'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                            '    w_OuenFlg = True
                                            'Else
                                            '    w_OuenFlg = False
                                            'End If

                                            w_OuenFlg = False

                                            If w_RiyuKBN = "6" Then
                                                For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                    If m_StaffData(w_StaffIdx).IdoData(i).IdoYMD = w_lngDate Then
                                                        w_OuenFlg = True
                                                        Exit For
                                                    End If
                                                Next i
                                            End If
                                            '--------------------------------------------------------------------------------------
                                        End If

                                        '2015/04/10 Bando Add Start ========================================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            w_Comment = General.g_objGetData.f実績希望コメント
                                        End If
                                        '2015/04/10 Bando Add End   ========================================
                                        '2016/06/15 Yamanishi Add --------------------------------------------------------------------
                                        ReDim Preserve m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData) + 1)
                                        With m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData))
                                            .Date_Renamed = w_YYYYMMDD
                                            .KinmuCD = w_KinmuCD
                                            .OuenKangoCD = w_KangoCD
                                            .RiyuKBN = w_RiyuKBN
                                            .Time = w_Time
                                        End With
                                        '---------------------------------------------------------------------------------------------
                                        If IsDBNull(w_KinmuCD) Then
                                        ElseIf Trim(w_KinmuCD) = "" Then
                                        Else

                                            If w_OuenFlg = True Then
                                                '年月日から格納ｾﾙの列番号 取得
                                                If Get_Col_M(w_YYYYMMDD, w_Col) = True Then
                                                    '実績期間の個人別集計　計算
                                                    If m_JissekiKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_JissekiKikan.KinmuDataEndCol Then
                                                        '列番号が実績期間の範囲内の時
                                                        '個人別集計項目数分 繰り返し
                                                        For w_Seq = 1 To UBound(m_HMtrx)
                                                            '集計対象勤務？
                                                            If InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 Then
                                                                '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                                w_Index = InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1

                                                                If m_HMtrx(w_Seq).CntKbn <> "6" Then
                                                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_HMtrx(w_Seq).Ratio(w_Index)
                                                                Else
                                                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) - m_HMtrx(w_Seq).Ratio(w_Index)
                                                                End If
                                                            End If

                                                            '労働時間（応援勤務者を除く）
                                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = Double.Parse("0") Then
                                                                If m_HMtrx(w_Seq).CntKbn = "2" Then
                                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                                        w_KinmuTime = Get_TimeM(w_StaffIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                                        w_Hour1 = w_KinmuTime \ 100
                                                                        w_Min1 = w_KinmuTime Mod 100

                                                                        w_Time1 = (w_Hour1 * 60) + w_Min1
                                                                        w_Time2 = w_PersonalGoukei(w_Seq)

                                                                        w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                                                    End If
                                                                    '累計時間
                                                                ElseIf m_HMtrx(w_Seq).CntKbn = "3" Then
                                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                                        w_KinmuTime = Get_TimeM(w_StaffIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                                        w_Hour1 = w_KinmuTime \ 100
                                                                        w_Min1 = w_KinmuTime Mod 100

                                                                        w_Time1 = (w_Hour1 * 60) + w_Min1
                                                                        w_Time2 = w_PersonalGoukei(w_Seq)

                                                                        w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                                                    End If
                                                                    '日勤時間
                                                                ElseIf m_HMtrx(w_Seq).CntKbn = "4" Then
                                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                                        w_KinmuTime = Get_TimeM(w_StaffIdx, w_KinmuCD, w_YYYYMMDD, 1)
                                                                        w_Time1 = w_KinmuTime
                                                                        w_Time2 = w_PersonalGoukei(w_Seq)

                                                                        w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                                                    End If
                                                                    '夜勤時間
                                                                ElseIf m_HMtrx(w_Seq).CntKbn = "5" Then
                                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                                        w_KinmuTime = Get_TimeM(w_StaffIdx, w_KinmuCD, w_YYYYMMDD, 2)
                                                                        w_Time1 = w_KinmuTime
                                                                        w_Time2 = w_PersonalGoukei(w_Seq)

                                                                        w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                                                    End If
                                                                End If
                                                            End If
                                                        Next w_Seq
                                                    End If

                                                    w_Flg = "0"
                                                    '2015/04/10 Bando Upd Start =================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   =================
                                                    '勤務記号をｾﾙに表示
                                                    .SetText(w_Row, w_Col, w_Var)
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ｹ月の場合
                                                    '年月日から格納ｾﾙの列番号 取得
                                                    w_Flg = "0"
                                                    '2015/04/10 Bando Upd Start =================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   =================
                                                    If Get_Col_4W(w_YYYYMMDD, w_Col) = True Then
                                                        '勤務記号を4週のｽﾌﾟﾚｯﾄﾞに表示
                                                        m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If
                        End If

                        '---------------------------
                        '   個人別集計表示
                        '---------------------------
                        If m_JissekiKikan.PersonalStartCol <> 0 AndAlso m_JissekiKikan.PersonalEndCol <> -1 Then
                            '各合計値 設定
                            w_Seq = 1
                            For w_Col = m_JissekiKikan.PersonalStartCol To m_JissekiKikan.PersonalEndCol
                                If UBound(m_HMtrx) >= w_Seq Then
                                    If m_HMtrx(w_Seq).CntKbn = "1" OrElse
                                            m_HMtrx(w_Seq).CntKbn = "6" OrElse
                                            m_HMtrx(w_Seq).CntKbn = "8" Then
                                        '集計欄の表示形式により分岐
                                        If m_PersonalTotalSet = 0 Then
                                            w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                                        Else
                                            w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                                        End If
                                    Else
                                        '累計時間を加算
                                        If m_HMtrx(w_Seq).CntKbn = "3" Then
                                            m_StaffData(w_StaffIdx).RuikeiTime_Jisseki = w_PersonalGoukei(w_Seq)
                                            w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_StaffData(w_StaffIdx).RuikeiTime
                                        End If
                                        w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & (w_PersonalGoukei(w_Seq) Mod 60)
                                        w_Var = Format(Single.Parse(w_str), "#0.00")
                                    End If

                                    '合計値 設定
                                    m_Spread(1).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                End If
                                '次の配列へ
                                w_Seq = w_Seq + 1
                            Next w_Col

                            '固定Spread個人別集計表示
                            w_Seq = 1
                            For w_Col = m_JissekiKikan.KoteiStartCol To m_JissekiKikan.KoteiEndCol
                                If UBound(m_HMtrx) >= w_Seq Then
                                    If m_HMtrx(w_Seq).CntKbn = "1" OrElse
                                            m_HMtrx(w_Seq).CntKbn = "6" OrElse
                                            m_HMtrx(w_Seq).CntKbn = "8" Then
                                        '集計欄の表示形式により分岐
                                        If m_PersonalTotalSet = 0 Then
                                            w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                                        Else
                                            w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                                        End If
                                    Else
                                        w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & (w_PersonalGoukei(w_Seq) Mod 60)
                                        w_Var = Format(Single.Parse(w_str), "#0.00")
                                    End If

                                    '合計値 設定
                                    sprPTotal.Sheets(0).SetText(w_Row, w_Col, w_Var)
                                End If
                                '次の配列へ
                                w_Seq = w_Seq + 1
                            Next w_Col
                        End If

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

            If m_DayAreaRow.StartRow <> 0 AndAlso m_DayAreaRow.EndRow <> 0 Then
                For w_Col = m_JissekiKikan.KinmuDataStartCol To m_JissekiKikan.KinmuDataEndCol
                    '実績期間の日別集計
                    Call RunReCalc_JDay(w_Col)
                Next w_Col
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                If m_4WeekKikan(UBound(m_4WeekKikan)).PersonalStartCol <> 0 AndAlso m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol <> -1 Then
                    w_EndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))
                    If Get_Col_4W(w_EndDate, w_EndCol) = True Then
                        For w_Col = M_KinmuDataStart_Col To w_EndCol
                            '計画期間の最初の4週部分の日別集計
                            Call RunReCalc_JDay_4W(w_Col)
                        Next w_Col
                    End If
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '***********************************
    '   ｽﾌﾟﾚｯﾄﾞｻｲｽﾞを計算する
    '   Create  S.Ooeki 2000/07/31
    '***********************************
    Private Sub Calc_SprSize()
        Const W_SUBNAME As String = "NSK0000HA Calc_SprSize"

        Dim w_FontLoop As Integer
        Dim w_ShowLineLoop As Integer
        Dim w_DataAreaLoop As Integer
        Dim w_VisibleCellCnt As Integer
        Dim w_WeekLoop As Integer
        Dim w_WeekCount As Integer
        Dim w_HeightMax As Integer
        Dim w_i As Integer
        Dim w_Var As Object
        Dim w_Team As Integer
        Dim w_CalcLoop As Integer
        Dim w_TeamCnt As Integer
        Dim w_ColCnt As Integer
        Dim w_VisibleCol_St As Integer
        Dim w_VisibleCol_Ed As Integer
        Dim w_sngWidth As Single
        Dim w_ColLoop As Integer
        Dim w_VisibleRow_St As Integer
        Dim w_VisibleRow_Ed As Integer
        Dim w_sngHeight As Single
        Dim w_RowLoop As Integer
        Try

            sprSheet_M.SuspendLayout()
            sprSheet_4W.SuspendLayout()
            sprPTotal.SuspendLayout()
            sprDayTotal_M.SuspendLayout()

            'ﾌｫｰﾑの大きさを最大化にする
            Me.SetBounds(0, 0, Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height)
            picBase.SetBounds(0, 0, Me.ClientRectangle.Width, Me.ClientRectangle.Height)
            picHide.SetBounds(0, 0, Me.ClientRectangle.Width, Me.ClientRectangle.Height)

            '各ｽﾌﾟﾚｯﾄﾞの位置を左上に設定する（Left=0，Top=0）
            sprSheet_M.Top = 0
            sprSheet_M.Left = 0
            sprSheet_4W.Top = 0
            sprSheet_4W.Left = 0
            sprPTotal.Top = 0
            sprPTotal.Left = 0
            sprDayTotal_M.Top = 0
            sprDayTotal_M.Left = 0
            sprDayTotal_4W.Top = 0
            sprDayTotal_4W.Left = 0

            '固定列、固定行が設定されている場合は解除する
            sprSheet_M.Sheets(0).FrozenColumnCount = 0
            sprSheet_M.Sheets(0).FrozenRowCount = 0
            sprSheet_4W.Sheets(0).FrozenColumnCount = 0
            sprSheet_4W.Sheets(0).FrozenRowCount = 0
            sprPTotal.Sheets(0).FrozenColumnCount = 0
            sprPTotal.Sheets(0).FrozenRowCount = 0
            sprDayTotal_M.Sheets(0).FrozenColumnCount = 0
            sprDayTotal_M.Sheets(0).FrozenRowCount = 0
            sprDayTotal_4W.Sheets(0).FrozenColumnCount = 0
            sprDayTotal_4W.Sheets(0).FrozenRowCount = 0

            'このLoopはﾌｫﾝﾄ変更ﾒﾆｭｰのIndex番号とする
            For w_FontLoop = 0 To UBound(m_CtrlSize)

                'フォントサイズ設定
                Call ChangeFontSize(w_FontLoop)

                '固定列（№、氏名）の幅設定
                If sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth > m_CellWidth Then
                    sprSheet_M.Sheets(0).SetColumnWidth(M_HyojiNo_Col, sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth)
                Else
                    sprSheet_M.Sheets(0).SetColumnWidth(M_HyojiNo_Col, m_CellWidth)
                End If
                If sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth > sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth Then
                    sprSheet_M.Sheets(0).SetColumnWidth(M_StaffName_Col, sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth)
                Else
                    sprSheet_M.Sheets(0).SetColumnWidth(M_StaffName_Col, sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth)
                End If

                '通常表示時の最大幅取得
                'セルの幅を設定する
                w_VisibleCellCnt = 2
                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                    '開始列は固定
                    w_VisibleCol_St = 0

                    '実績ﾃﾞｰﾀｴﾘｱ
                    For w_DataAreaLoop = m_JissekiKikan.KinmuDataStartCol To m_JissekiKikan.KinmuDataEndCol
                        w_VisibleCellCnt = w_VisibleCellCnt + 1
                    Next w_DataAreaLoop
                    '実績集計ｴﾘｱ
                    w_ColCnt = 0
                    For w_DataAreaLoop = m_JissekiKikan.PersonalStartCol To m_JissekiKikan.PersonalEndCol
                        w_ColCnt = w_ColCnt + 1
                        If w_ColCnt <= UBound(m_HMtrx) Then
                            If m_HMtrx(w_ColCnt).CntKbn = "1" AndAlso m_intLastSumDispFlg = 1 Then
                                sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                            Else
                                sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            End If
                            w_VisibleCellCnt = w_VisibleCellCnt + 1
                        End If
                    Next w_DataAreaLoop
                End If

                '終了列は固定
                w_VisibleCol_Ed = m_KeikakuKikan.PersonalEndCol

                '対象期間ｴﾘｱ
                For w_DataAreaLoop = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    w_VisibleCellCnt = w_VisibleCellCnt + 1
                Next w_DataAreaLoop

                '対象期間集計ｴﾘｱ
                If m_KeikakuKikan.PersonalStartCol <> -1 OrElse m_KeikakuKikan.PersonalEndCol <> -1 Then
                    For w_DataAreaLoop = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                        sprSheet_M.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                    Next w_DataAreaLoop
                End If

                w_sngWidth = 0
                For w_ColLoop = w_VisibleCol_St To w_VisibleCol_Ed
                    w_sngWidth = w_sngWidth + sprSheet_M.Sheets(0).Columns(w_ColLoop).Width
                Next
                sprSheet_M.Width = w_sngWidth
                m_CtrlSize(w_FontLoop).NormalModeMaxWidth = w_sngWidth

                '４週表示時の最大幅取得
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ヶ月

                    '固定列（№、氏名）の幅設定
                    If sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth > m_CellWidth Then
                        sprSheet_4W.Sheets(0).SetColumnWidth(M_HyojiNo_Col, sprSheet_M.Sheets(0).Columns(M_HyojiNo_Col).GetPreferredWidth)
                    Else
                        sprSheet_4W.Sheets(0).SetColumnWidth(M_HyojiNo_Col, m_CellWidth)
                    End If
                    If sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth > sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth Then
                        sprSheet_4W.Sheets(0).SetColumnWidth(M_StaffName_Col, sprSheet_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth)
                    Else
                        sprSheet_4W.Sheets(0).SetColumnWidth(M_StaffName_Col, sprDayTotal_M.Sheets(0).Columns(M_StaffName_Col).GetPreferredWidth)
                    End If
                    w_VisibleCellCnt = 2

                    w_VisibleCol_Ed = 0

                    w_WeekCount = 0
                    For w_WeekLoop = 1 To UBound(m_4WeekKikan)

                        '４週期間カウント
                        w_WeekCount = w_WeekCount + 1

                        If w_WeekCount > 2 OrElse (w_WeekCount > 1 AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN)) Then
                            For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KinmuDataStartCol To m_4WeekKikan(w_WeekLoop).KinmuDataEndCol
                                sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            Next w_DataAreaLoop
                            For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                                sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                            Next w_DataAreaLoop
                        Else
                            'セルの幅を設定する
                            For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).KinmuDataStartCol To m_4WeekKikan(w_WeekLoop).KinmuDataEndCol
                                w_VisibleCellCnt = w_VisibleCellCnt + 1
                                If w_VisibleCol_Ed < w_DataAreaLoop Then
                                    w_VisibleCol_Ed = w_DataAreaLoop
                                End If
                            Next w_DataAreaLoop

                            If w_WeekCount = 1 AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                '1回目のLoopの場合のみ集計分を表示する
                                w_ColCnt = 0
                                For w_DataAreaLoop = m_4WeekKikan(w_WeekLoop).PersonalStartCol To m_4WeekKikan(w_WeekLoop).PersonalEndCol
                                    w_ColCnt = w_ColCnt + 1
                                    If w_ColCnt <= UBound(m_HMtrx_4Week) Then
                                        If m_HMtrx_4Week(w_ColCnt).CntKbn = "1" AndAlso m_intLastSumDispFlg = 1 Then
                                            sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, m_TotalWidth)
                                        Else
                                            sprSheet_4W.Sheets(0).SetColumnWidth(w_DataAreaLoop, M_HideCellWidth_KinmuDataCol)
                                        End If
                                        w_VisibleCellCnt = w_VisibleCellCnt + 1
                                        If w_VisibleCol_Ed < w_DataAreaLoop Then
                                            w_VisibleCol_Ed = w_DataAreaLoop
                                        End If
                                    End If
                                Next w_DataAreaLoop
                            End If
                        End If

                    Next w_WeekLoop

                    w_VisibleCol_St = 0

                    For w_ColLoop = w_VisibleCol_St To w_VisibleCol_Ed
                        w_sngWidth = w_sngWidth + sprSheet_4W.Sheets(0).Columns(w_ColLoop).Width
                    Next

                    sprSheet_4W.Width = w_sngWidth
                    m_CtrlSize(w_FontLoop).WeekModeMaxWidth = w_sngWidth
                End If


                'すべてのセルの高さを一旦 0 にする
                sprSheet_M.Sheets(0).SetRowHeight(-1, 0)

                '固定行設定（日付表示行は隠しのため未設定）
                sprSheet_M.Sheets(0).SetRowHeight(M_Interval_Row, m_CellHeight / 3) '計画期間の期間色表示行
                sprSheet_M.Sheets(0).SetRowHeight(M_MonthLabel_Row, m_CellHeight) '計画月/ﾀｰﾑ表示行
                sprSheet_M.Sheets(0).SetRowHeight(M_DayLabel_Row, m_CellHeight) '日付表示行
                sprSheet_M.Sheets(0).SetRowHeight(M_WeekLabel_Row, m_CellHeight) '曜日表示行

                'ﾁｰﾑ数によって配列を確保する
                If m_OuenTeam <= 0 Then
                    w_TeamCnt = m_TeamCnt
                Else
                    w_TeamCnt = m_OuenTeam
                End If

                If w_TeamCnt <= 1 Then
                    'ﾁｰﾑ分け無し
                    ReDim m_CtrlSize(w_FontLoop).DataAreaMaxHeight(0, m_MaxShowLine)
                    w_HeightMax = 0
                Else
                    'ﾁｰﾑ分けあり
                    ReDim m_CtrlSize(w_FontLoop).DataAreaMaxHeight(w_TeamCnt, m_MaxShowLine)
                    w_HeightMax = w_TeamCnt
                End If

                '各チーム毎の最大高さ取得
                For w_i = 0 To w_HeightMax
                    w_VisibleCellCnt = 4
                    For w_ShowLineLoop = 1 To m_MaxShowLine

                        w_VisibleRow_St = 0
                        w_VisibleRow_Ed = m_StaffRow.EndRow

                        '表示行数毎に処理
                        For w_DataAreaLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_DataAreaLoop - m_StaffRow.StartRow) Mod m_MaxShowLine < w_ShowLineLoop Then
                                '表示する行
                                If w_i = 0 Then
                                    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, m_CellHeight)
                                    w_VisibleCellCnt = w_VisibleCellCnt + 1
                                Else
                                    w_Var = sprSheet_M.Sheets(0).GetText(w_DataAreaLoop, m_StaffZokusei(M_Team).SetCol_M)
                                    If w_Var <> "" Then
                                        If IsNumeric(w_Var) = False Then
                                            sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                        Else
                                            w_Team = Integer.Parse(w_Var)
                                            If w_i = w_Team Then
                                                sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, m_CellHeight)
                                                w_VisibleCellCnt = w_VisibleCellCnt + 1
                                            Else
                                                sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                            End If
                                        End If
                                    Else
                                        w_Team = 0
                                        sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                    End If
                                End If
                            Else
                                '表示しない行はすべて幅「０」
                                sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                            End If
                        Next w_DataAreaLoop

                        w_sngHeight = 0
                        For w_RowLoop = w_VisibleRow_St To w_VisibleRow_Ed
                            If w_RowLoop <> M_YYYYMMDDLabel_Row Then
                                w_sngHeight = w_sngHeight + sprSheet_M.Sheets(0).Rows(w_RowLoop).Height
                            End If
                        Next

                        sprSheet_M.Height = w_sngHeight
                        m_CtrlSize(w_FontLoop).DataAreaMaxHeight(w_i, w_ShowLineLoop) = w_sngHeight
                    Next w_ShowLineLoop
                Next w_i

                '**** 固定集計の大きさを設定する ****
                '個人別集計
                sprPTotal.Sheets(0).SetColumnWidth(-1, 0)

                '通常表示時の固定集計の幅
                For w_CalcLoop = 0 To UBound(m_HMtrx) - 1
                    '集計欄の表示形式により分岐
                    '労働時間・累計時間対応
                    If m_HMtrx(w_CalcLoop + 1).CntKbn = "1" OrElse
                            m_HMtrx(w_CalcLoop + 1).CntKbn = "6" OrElse
                            m_HMtrx(w_CalcLoop + 1).CntKbn = "8" Then
                        '集計欄の表示形式により分岐
                        If m_PersonalTotalSet = 0 Then
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_CellWidth)
                        Else
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth)
                        End If
                    Else
                        '集計欄の表示形式により分岐
                        If m_PersonalTotalSet = 0 Then
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth_Kotei)
                        Else
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth_Kotei)
                        End If
                    End If
                Next w_CalcLoop

                w_sngWidth = 0
                '全体表示時の固定集計の高さ
                For w_CalcLoop = 0 To UBound(m_HMtrx) - 1
                    If w_CalcLoop = m_lngColFrozen Then Exit For
                    w_sngWidth = w_sngWidth + sprPTotal.Sheets(0).GetColumnWidth(w_CalcLoop)
                Next w_CalcLoop

                sprPTotal.Width = w_sngWidth + 18
                m_CtrlSize(w_FontLoop).NormalModePersonalTotalWidth = w_sngWidth + 18

                '４週集計表示時
                sprPTotal.Sheets(0).SetColumnWidth(-1, 0)

                For w_CalcLoop = 0 To UBound(m_HMtrx_4Week) - 1
                    If w_CalcLoop + 1 <= UBound(m_HMtrx_4Week) Then
                        If m_HMtrx_4Week(w_CalcLoop + 1).CntKbn = "1" OrElse
                                m_HMtrx_4Week(w_CalcLoop + 1).CntKbn = "8" Then
                            '集計欄の表示形式により分岐
                            If m_PersonalTotalSet = 0 Then
                                sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_CellWidth)
                            Else
                                sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth)
                            End If
                        Else
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth_Kotei)
                        End If
                    Else
                        '集計欄の表示形式により分岐
                        If m_PersonalTotalSet = 0 Then
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_CellWidth)
                        Else
                            sprPTotal.Sheets(0).SetColumnWidth(w_CalcLoop, m_TotalWidth)
                        End If
                    End If
                Next w_CalcLoop

                m_CtrlSize(w_FontLoop).WeekModePersonalTotalWidth = sprPTotal.Width

                '日別集計
                sprDayTotal_M.Sheets(0).SetRowHeight(-1, 0)
                w_sngHeight = 0
                '全体表示時の固定集計の高さ
                For w_CalcLoop = 0 To UBound(m_VMtrx) - 1
                    If w_CalcLoop = m_lngRowFrozen Then Exit For
                    sprDayTotal_M.Sheets(0).SetRowHeight(w_CalcLoop, m_CellHeight)
                    w_sngHeight = w_sngHeight + m_CellHeight
                Next w_CalcLoop

                sprDayTotal_M.Height = w_sngHeight + 18
                m_CtrlSize(w_FontLoop).NormalModeDayTotalHeight = w_sngHeight + 18

                If w_TeamCnt > 1 Then
                    'ﾁｰﾑ毎表示時の固定集計の高さ
                    For w_CalcLoop = UBound(m_VMtrx) To UBound(m_VMtrx) * 2 - 1
                        sprDayTotal_M.Sheets(0).SetRowHeight(w_CalcLoop, m_CellHeight)
                    Next w_CalcLoop

                    m_CtrlSize(w_FontLoop).TeamModeDayTotalHeight = sprDayTotal_M.Height
                End If
            Next w_FontLoop

            m_intCalcSpr_Flg = m_intCalcSpr_Flg + 1

            sprSheet_M.ResumeLayout()
            sprSheet_4W.ResumeLayout()
            sprPTotal.ResumeLayout()
            sprDayTotal_M.ResumeLayout()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Calc_ScrollSpread()

        Const W_SUBNAME As String = "NSK0000HA Calc_ScrollSpread"

        Dim w_CalcLoop As Integer
        Dim w_lngCnt As Integer
        Try
            sprScroll.Sheets(0).SetColumnWidth(-1, 0)
            sprScroll.Sheets(0).ColumnCount = 500
            sprScroll.Sheets(0).RowCount = 500
            sprScroll.Sheets(0).SetRowHeight(-1, 0)

            w_lngCnt = 0

            '通常表示時の固定集計の幅
            For w_CalcLoop = 0 To sprPTotal.Sheets(0).ColumnCount - 1
                If sprPTotal.Sheets(0).GetColumnWidth(w_CalcLoop) > 0 Then
                    sprScroll.Sheets(0).SetColumnWidth(w_lngCnt, sprPTotal.Sheets(0).GetColumnWidth(w_CalcLoop))
                    w_lngCnt = w_lngCnt + 1
                End If
            Next w_CalcLoop

            sprScroll.Sheets(0).ColumnCount = w_lngCnt

            w_lngCnt = 0
            '通常表示時の固定集計の幅
            For w_CalcLoop = 1 To UBound(m_VMtrx)
                If m_SelTeamNo <> 0 Then
                    sprScroll.Sheets(0).SetRowHeight(w_lngCnt, m_CellHeight * 2)
                Else
                    sprScroll.Sheets(0).SetRowHeight(w_lngCnt, m_CellHeight)
                End If
                w_lngCnt = w_lngCnt + 1
            Next w_CalcLoop

            Call SubSetStyle(sprScroll, -1, -1, -1, -1, 0, 0, , ColorTranslator.FromOle(12632256))

            sprScroll.Sheets(0).RowCount = w_lngCnt

            sprScroll.SetBounds(sprPTotal.Left, sprDayTotal_M.Top, sprPTotal.Width, sprDayTotal_M.Height)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾌｫｰﾑを解放する
    Private Sub FormUnload()

        Const W_SUBNAME As String = "NSK0000HA FormUnload"
        Try
            'ﾊﾟﾚｯﾄﾌｫｰﾑを解放する
            m_PaletteForm.Close()
            m_PaletteForm = Nothing
            '検索画面を解放する
            m_KensakuForm.Close()
            m_KensakuForm = Nothing
            '置換画面を解放する
            m_ChikanForm.Close()
            m_ChikanForm = Nothing
            '並び替え画面を解放する
            m_SortForm.Close()
            m_SortForm = Nothing
            '行事一覧画面を解放する
            m_EventForm.Close()
            m_EventForm = Nothing
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '4週期間の日付検索用文字列取得
    Private Sub Get_DayStr()

        Const W_SUBNAME As String = "NSK0000HA Get_DayStr"

        Dim w_Col As Integer
        Dim w_Int As Integer
        Dim w_Var As Object
        Try
            w_Col = M_KinmuDataStart_Col
            '隠しｾﾙの日付から日付を取得する
            For w_Int = M_KinmuDataStart_Col To m_KeikakuKikan.KinmuDataEndCol
                w_Var = m_Spread(1).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                If w_Var = "" Then
                    w_Var = "00000000"
                Else
                    If IsDBNull(w_Var) = True Then
                        w_Var = "00000000"
                    ElseIf w_Var = "" Then
                        w_Var = "00000000"
                    End If
                End If
                m_DayStr = m_DayStr & String.Format("{0, 8}", w_Var) & ","
                w_Col = w_Col + 1
            Next w_Int

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/4週の場合
                '4週期間の日付検索用文字列取得
                w_Col = M_KinmuDataStart_Col
                '4週のｽﾌﾟﾚｯﾄﾞから隠しｾﾙの日付を取得する
                For w_Int = M_KinmuDataStart_Col To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                    w_Var = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var = "" Then
                        w_Var = "00000000"
                    Else
                        If IsDBNull(w_Var) = True Then
                            w_Var = "00000000"
                        ElseIf w_Var = "" Then
                            w_Var = "00000000"
                        End If
                    End If
                    m_DayStr2 = m_DayStr2 & String.Format("{0, 8}", w_Var) & ","
                    w_Col = w_Col + 1
                Next w_Int
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '勤務予定ﾃﾞｰﾀ 取得(勤務変更時 勤務実績ﾃﾞｰﾀ 取得)
    Private Function Get_PlanData(ByVal pProcessForm As Object) As Object

        Const W_SUBNAME As String = "NSK0000HA Get_PlanData"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_EndCol As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_RiyuKBN As String = String.Empty
        Dim w_KinmuCD As String = String.Empty
        Dim w_BushoCD As String
        Dim w_HyojiFlg As Boolean
        Dim w_Time As String
        Dim w_Flg As String = String.Empty
        Dim w_StartCol As Integer
        Dim w_HairetuCnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_lngDate As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_OuenFlg As Boolean
        Dim w_Int4 As Integer
        Dim w_lng5 As Integer
        Dim w_DaikyuFlg As Boolean
        Dim w_strMsg() As String
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String = String.Empty
        Dim w_strDaikyuFlg As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_lngWorkLoop As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Dim w_KojoFlg As Boolean = False '2015/07/22 Bando Add

        Get_PlanData = False
        Try
            '------------------------------
            '   勤務予定情報 取得
            '------------------------------
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '処理経過ﾌｫｰﾑ設定
                pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Magenta)
                pProcessForm.pSyoriText = "勤務実績データ取得中..."
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    '4週期間開始日
                    w_StartDate = m_4WeekKikan(1).StartDate
                    w_StartCol = m_4WeekKikan(1).KinmuDataStartCol
                Else
                    '1ｹ月/1ｹ月,4週/4週の場合
                    '計画開始日取得
                    w_StartDate = m_KeikakuKikan.StartDate
                    w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                End If
                w_StartDate = Integer.Parse(Date.Parse(w_StartDate.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")) '2016/08/30 Yamanishi Add
            Else
                '計画開始日取得
                '処理経過ﾌｫｰﾑ設定
                pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Blue)
                pProcessForm.pSyoriText = "勤務予定データ取得中..."
                w_StartDate = m_KeikakuKikan.StartDate
                w_StartCol = m_KeikakuKikan.KinmuDataStartCol
            End If

            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate
            '計画期間ﾃﾞｰﾀの終了列
            w_EndCol = m_KeikakuKikan.KinmuDataEndCol

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                w_HairetuCnt = m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol + 1
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                    w_HairetuCnt = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - w_KeikakuCol + 1
                Else
                    w_KeikakuCol = 0
                    w_HairetuCnt = 0
                End If
            End If

            With m_Spread(1).Sheets(0)

                '処理経過ﾌｫｰﾑ初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '該当行の職員のﾃﾞｰﾀ格納配列番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 職員管理番号取得
                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ退避
                            w_StaffIdx = Integer.Parse(w_Var)

                            '勤務ﾃﾞｰﾀ格納用配列定義
                            ReDim Preserve m_StaffData(w_StaffIdx).KinmuData(w_HairetuCnt)
                            '2016/06/15 Yamanishi Del --------------------------------------------------------------------
                            ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------
                            'If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                            '    ReDim m_StaffData(w_StaffIdx).BeforeKinmuData(0)
                            'End If
                            ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------
                            '---------------------------------------------------------------------------------------------
                            '2017/11/16 Angelo add st----------------------------------------------
                            '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                            If m_intSelSaveNo > 0 Then
                                '一時保存からデータの取得
                                General.g_objGetData.p取得区分 = 1
                                General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                            Else
                                '予定勤務からデータの取得
                                General.g_objGetData.p取得区分 = 0
                            End If
                            '2017/11/16 Angelo add en----------------------------------------------
                            General.g_objGetData.p病院CD = General.g_strHospitalCD '施設コード
                            General.g_objGetData.p職員区分 = 0 '職員区分
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID '職員管理番号

                            '勤務取得区分
                            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                General.g_objGetData.p勤務取得区分 = 0 '予定
                            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                General.g_objGetData.p勤務取得区分 = 1 '実績
                            End If

                            General.g_objGetData.p日付区分 = 1 '日付区分
                            General.g_objGetData.p開始年月日 = w_StartDate '開始年月日
                            General.g_objGetData.p終了年月日 = w_EndDate '終了年月日

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                    '-- 実績ﾃﾞｰﾀが存在しない場合 --
                                    w_Cnt = w_Cnt + 1
                                    If w_Cnt = UBound(m_StaffData) AndAlso g_SaikeiFlg = False Then
                                        '---------------------------
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "実績データ"
                                        Call Set_MsgZOrder("NS0031", w_strMsg, w_MsgRc, 0)
                                        Exit Function
                                    End If
                                End If
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '時間年休取得
                                Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                                '控除データ取得
                                Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                        General.g_objGetData.p予定年月日 = w_lngDate
                                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        General.g_objGetData.p実績年月日 = w_lngDate
                                    End If

                                    '年月日取得
                                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                        w_YYYYMMDD = General.g_objGetData.f予定年月日
                                    Else
                                        w_YYYYMMDD = General.g_objGetData.f実績年月日
                                    End If

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                            w_Col = 0
                                        End If

                                        '勤務ｺｰﾄﾞ取得
                                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                            w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_KinmuCD = General.g_objGetData.f実績勤務CD
                                        End If

                                        '理由区分の取得
                                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                            w_RiyuKBN = General.g_objGetData.f予定理由区分
                                        ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_RiyuKBN = General.g_objGetData.f実績理由区分
                                        End If

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '応援先勤務部署CD
                                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                            w_KangoCD = General.g_objGetData.f予定応援看護単位CD
                                        ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_KangoCD = General.g_objGetData.f実績応援看護単位CD
                                        End If

                                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                            w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                            w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                            w_RegistID = General.g_objGetData.f勤務予定登録者ID
                                        ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_FDate = General.g_objGetData.f勤務実績初回登録日時
                                            w_LDate = General.g_objGetData.f勤務実績最終更新日時
                                            w_RegistID = General.g_objGetData.f勤務実績登録者ID
                                        End If
                                        '2016/06/15 Yamanishi Del --------------------------------------------------------------------
                                        ''2016/06/15 Yamanishi Upd --------------------------------------------------------------------
                                        ''2016/06/15 Yamanishi Upd --------------------------------------------------------------------
                                        ' ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ' ''勤務記号 配列変数 より 勤務記号 取得
                                        ''If Not String.IsNullOrEmpty(w_KinmuCD) Then
                                        ''    '勤務ｺｰﾄﾞが設定されている場合
                                        ''    With m_StaffData(w_StaffIdx)
                                        ''        ReDim Preserve .BeforeKinmuData(UBound(.BeforeKinmuData) + 1)
                                        ''        .BeforeKinmuData(UBound(.BeforeKinmuData)).KinmuCD = w_KinmuCD
                                        ''        .BeforeKinmuData(UBound(.BeforeKinmuData)).Date_Renamed = w_YYYYMMDD
                                        ''        .BeforeKinmuData(UBound(.BeforeKinmuData)).RiyuKBN = w_RiyuKBN
                                        ''        .BeforeKinmuData(UBound(.BeforeKinmuData)).OuenKangoCD = w_KangoCD
                                        ''    End With
                                        ''End If
                                        ' ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        'ReDim Preserve m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData) + 1)
                                        'With m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData))
                                        '    .Date_Renamed = w_YYYYMMDD
                                        '    .KinmuCD = w_KinmuCD
                                        '    .OuenKangoCD = w_KangoCD
                                        '    .RiyuKBN = w_RiyuKBN
                                        '    .Time = w_Time
                                        'End With
                                        ''---------------------------------------------------------------------------------------------
                                        '---------------------------------------------------------------------------------------------
                                        '配属中？
                                        w_HyojiFlg = False
                                        For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                            If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                '配属している期間のとき
                                                w_HyojiFlg = True
                                                Exit For
                                            End If
                                        Next w_Int2

                                        w_OuenFlg = False
                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                            w_OuenFlg = True
                                        Else
                                            '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                            'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                            '    w_OuenFlg = True
                                            '    w_HyojiFlg = False
                                            'Else
                                            '    w_OuenFlg = False
                                            'End If

                                            w_OuenFlg = False

                                            If w_RiyuKBN = "6" Then
                                                For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                    If m_StaffData(w_StaffIdx).IdoData(i).IdoYMD = w_lngDate Then
                                                        w_OuenFlg = True
                                                        w_HyojiFlg = False
                                                        Exit For
                                                    End If
                                                Next i
                                            End If
                                            '--------------------------------------------------------------------------------------
                                        End If

                                        '2015/04/10 Bando Start =================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                                w_Comment = General.g_objGetData.f予定希望コメント
                                            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                w_Comment = General.g_objGetData.f実績希望コメント
                                            End If
                                        End If
                                        '2015/04/10 Bando End   =================
                                        '2016/06/15 Yamanishi Upd --------------------------------------------------------------------
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ''勤務記号 配列変数 より 勤務記号 取得
                                        'If Not String.IsNullOrEmpty(w_KinmuCD) Then
                                        '    '勤務ｺｰﾄﾞが設定されている場合
                                        '    With m_StaffData(w_StaffIdx)
                                        '        ReDim Preserve .BeforeKinmuData(UBound(.BeforeKinmuData) + 1)
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).KinmuCD = w_KinmuCD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).Date_Renamed = w_YYYYMMDD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).RiyuKBN = w_RiyuKBN
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).OuenKangoCD = w_KangoCD
                                        '    End With
                                        'End If
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ReDim Preserve m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData) + 1)
                                        With m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData))
                                            .Date_Renamed = w_YYYYMMDD
                                            .KinmuCD = w_KinmuCD
                                            .OuenKangoCD = w_KangoCD
                                            .RiyuKBN = w_RiyuKBN
                                            .Time = w_Time
                                        End With
                                        '---------------------------------------------------------------------------------------------
                                        '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
                                        If m_DaikyuMsgFlg = 1 Then

                                            '代休発生する勤務かチェック
                                            For w_lngWorkLoop = 1 To UBound(g_KinmuM)
                                                If w_KinmuCD = g_KinmuM(w_lngWorkLoop).CD Then
                                                    w_strDaikyuFlg = g_KinmuM(w_lngWorkLoop).DaikyuFlg
                                                    Exit For
                                                End If
                                            Next w_lngWorkLoop

                                            '代休取得可能日AND可能勤務かどうか
                                            If InStr(m_HolDateStr, Convert.ToString(w_YYYYMMDD)) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 7) Then
                                                If w_strDaikyuFlg = "1" Then
                                                    '初期化
                                                    w_blnFLG = False
                                                    If UBound(m_StaffData(w_StaffIdx).Daikyu) > 0 Then '代休情報がある場合
                                                        For w_lngWorkLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                            If m_StaffData(w_StaffIdx).Daikyu(w_lngWorkLoop).HolDate = w_YYYYMMDD Then
                                                                w_blnFLG = True
                                                                Exit For
                                                            End If
                                                        Next w_lngWorkLoop
                                                        If w_blnFLG = False Then '同じ代休情報が無ければ配列に格納
                                                            ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu) + 1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                            '取得区分
                                                            'とりあえず１日としてセット
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                            '代休1.5日分発生対象勤務かチェック
                                                            For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                        End If
                                                    Else '代休情報がない場合
                                                        ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(1)
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                        '取得区分
                                                        'とりあえず１日としてセット
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                        '代休1.5日分発生対象勤務かチェック
                                                        For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                            If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                Exit For
                                                            End If
                                                        Next w_lngWorkLoop
                                                        ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                    End If
                                                End If
                                            End If
                                        End If

                                        '代休データをソート
                                        Call SortDaikyu(w_StaffIdx)

                                        '勤務記号 配列変数 より 勤務記号 取得
                                        If Trim(w_KinmuCD) = "" Then
                                            '勤務ｺｰﾄﾞが設定されていない場合

                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then

                                                w_Flg = M_GAITOBUSHO
                                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                    w_BushoCD = General.g_objGetData.f確定部署CD
                                                    If w_BushoCD = General.g_strSelKinmuDeptCD Then
                                                        w_Flg = M_GAITOBUSHO
                                                    Else
                                                        w_Flg = M_TABUSHO
                                                    End If
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If
                                                End If

                                                If w_Col > 0 AndAlso w_KeikakuCol > 0 Then
                                                    w_Col = w_Col - w_KeikakuCol + 1
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_PLANDATA
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Delete
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                End If
                                            End If
                                        Else
                                            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                                '計画新規モード

                                                If w_HyojiFlg = True Then
                                                    '配属している場合

                                                    w_Flg = M_GAITOBUSHO
                                                    '2015/04/10 Bando Upd Start ===============
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   ===============

                                                    If w_Col > 0 Then

                                                        '勤務記号をｾﾙに表示
                                                        .SetText(w_Row, w_Col, w_Var)

                                                        '理由区分による色設定(文字色/背景色)
                                                        If w_RiyuKBN = "1" Then
                                                            '通常
                                                            w_ForeColor = Color.Black
                                                            w_BackColor = Color.White
                                                        ElseIf w_RiyuKBN = "2" Then
                                                            '要請勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                        ElseIf w_RiyuKBN = "3" Then
                                                            '希望勤務 文字/背景色
                                                            '2015/07/21 Bando Upd Start ==================
                                                            If w_Comment = "" Then
                                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                                            Else
                                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                                            End If
                                                            '2015/07/21 Bando Upd End   ==================
                                                        ElseIf w_RiyuKBN = "4" Then
                                                            '再掲勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                        ElseIf w_RiyuKBN = "5" Then
                                                            '委員会勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                        ElseIf w_RiyuKBN = "6" Then
                                                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                        End If

                                                        '代休発生勤務 文字/背景色
                                                        If General.g_lngDaikyuMng = 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                    w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                End If
                                                            End If
                                                        End If

                                                        '2015/07/22 Bando Add Start ===========================
                                                        '控除があるか判断し　背景色変更
                                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                            Exit For
                                                                        End If
                                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                        Exit For
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                        '2015/07/22 Bando Add End   ===========================

                                                        If w_Time <> "" Then
                                                            '勤務時間が登録されている場合
                                                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                        End If

                                                        If General.g_lngDaikyuMng = 0 Then
                                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                    w_DaikyuFlg = False
                                                                    For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                        For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                                w_DaikyuFlg = True
                                                                                Exit For
                                                                            End If
                                                                        Next w_lng5
                                                                        'フラグがたっている場合ループを抜ける
                                                                        If w_DaikyuFlg = True Then
                                                                            Exit For
                                                                        End If
                                                                    Next w_Int4
                                                                    If w_DaikyuFlg = False Then
                                                                        w_ForeColor = ColorTranslator.FromOle(M_AJUSTDAIKYUCOLOR)
                                                                        w_BackColor = Color.White
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                        .Cells(w_Row, w_Col).BackColor = w_BackColor
                                                        .Cells(w_Row, w_Col).ForeColor = w_ForeColor
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ヶ月

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then

                                                            '勤務記号をｾﾙに表示
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)

                                                            '理由区分による色設定(文字色/背景色)
                                                            If w_RiyuKBN = "1" Then
                                                                '通常
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = Color.White
                                                            ElseIf w_RiyuKBN = "2" Then
                                                                '要請勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                            ElseIf w_RiyuKBN = "3" Then
                                                                '希望勤務 文字/背景色
                                                                '2015/07/21 Bando Upd Start ==================
                                                                If w_Comment = "" Then
                                                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                    w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                                                Else
                                                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                    w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                                                End If
                                                                '2015/07/21 Bando Upd End   ==================
                                                            ElseIf w_RiyuKBN = "4" Then
                                                                '再掲勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                            ElseIf w_RiyuKBN = "5" Then
                                                                '委員会勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                            ElseIf w_RiyuKBN = "6" Then
                                                                w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                            End If

                                                            '代休発生勤務 文字/背景色
                                                            If General.g_lngDaikyuMng = 0 Then
                                                                w_Var2 = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var2 <> "" Then
                                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                        w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                    End If
                                                                End If
                                                            End If

                                                            '2015/07/22 Bando Add Start ===========================
                                                            '控除があるか判断し　背景色変更
                                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var2 <> "" Then
                                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                        If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                                Exit For
                                                                            End If
                                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                            Exit For
                                                                        End If
                                                                    Next
                                                                End If
                                                            End If
                                                            '2015/07/22 Bando Add End   ===========================

                                                            If w_Time <> "" Then
                                                                '勤務時間が登録されている場合
                                                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                            End If
                                                            If General.g_lngDaikyuMng = 0 Then
                                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                                    If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                        w_DaikyuFlg = False
                                                                        For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                            For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                                If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                                    w_DaikyuFlg = True
                                                                                    Exit For
                                                                                End If
                                                                            Next w_lng5
                                                                            'フラグがたっている場合ループを抜ける
                                                                            If w_DaikyuFlg = True Then
                                                                                Exit For
                                                                            End If
                                                                        Next w_Int4
                                                                        If w_DaikyuFlg = False Then
                                                                            w_ForeColor = ColorTranslator.FromOle(M_AJUSTDAIKYUCOLOR)
                                                                            w_BackColor = Color.White
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).BackColor = w_BackColor
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = w_ForeColor
                                                        End If
                                                    End If
                                                Else
                                                    '配属期間以外の場合

                                                    If w_OuenFlg = True Then

                                                        w_Flg = M_GAITOBUSHO

                                                        '勤務記号をｾﾙに表示
                                                        '2015/04/10 Bando Upd Start ==================
                                                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                        '2015/04/10 Bando Upd End   ==================

                                                        If w_Col > 0 Then
                                                            .SetText(w_Row, w_Col, w_Var)
                                                        End If

                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                            '4週/1ヶ月

                                                            '年月日から格納ｾﾙの列番号 取得
                                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                                w_Col = 0
                                                            End If
                                                            '勤務記号をｾﾙに表示
                                                            If w_Col > 0 Then
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                            End If
                                                        End If
                                                    End If
                                                End If '---> 配属中？

                                                If w_Col > 0 AndAlso w_KeikakuCol > 0 AndAlso w_OuenFlg = True Then
                                                    'ﾃﾞｰﾀ取得
                                                    w_Col = w_Col - w_KeikakuCol + 1
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_PLANDATA
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Update
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                End If
                                            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                '勤務変更モード

                                                w_BushoCD = General.g_objGetData.f確定部署CD

                                                If General.g_strSelKinmuDeptCD = w_BushoCD Then
                                                    '該当部署のとき
                                                    w_Flg = M_GAITOBUSHO
                                                    '2015/04/10 Bando Upd Start ==================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   ==================

                                                    '配属している場合又は実績期間の場合 ｾﾙ設定
                                                    If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                        '配属している場合
                                                        .SetText(w_Row, w_Col, w_Var)

                                                        '配属している場合 色設定
                                                        If w_RiyuKBN = "1" Then
                                                            '通常
                                                            w_ForeColor = Color.Black
                                                            w_BackColor = Color.White
                                                        ElseIf w_RiyuKBN = "2" Then
                                                            '要請勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                        ElseIf w_RiyuKBN = "3" Then
                                                            '希望勤務 文字/背景色
                                                            '2015/07/21 Bando Upd Start ==================
                                                            If w_Comment = "" Then
                                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                                            Else
                                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                                            End If
                                                            '2015/07/21 Bando Upd End   ==================
                                                        ElseIf w_RiyuKBN = "4" Then
                                                            '再掲勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                        ElseIf w_RiyuKBN = "5" Then
                                                            '委員会勤務 文字/背景色
                                                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                        ElseIf w_RiyuKBN = "6" Then
                                                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                        End If

                                                        '代休発生勤務 文字/背景色
                                                        If General.g_lngDaikyuMng = 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                    w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                End If
                                                            End If
                                                        End If

                                                        '2015/07/22 Bando Add Start ===========================
                                                        '控除があるか判断し　背景色変更
                                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                            Exit For
                                                                        End If
                                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                        Exit For
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                        '2015/07/22 Bando Add End   ===========================

                                                        If w_Time <> "" Then
                                                            '勤務時間が登録されている場合
                                                            w_ForeColor = Color.Black
                                                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                        End If

                                                        If General.g_lngDaikyuMng = 0 Then
                                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                    w_DaikyuFlg = False
                                                                    For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                        For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                                w_DaikyuFlg = True
                                                                                Exit For
                                                                            End If
                                                                        Next w_lng5
                                                                        'フラグがたっている場合ループを抜ける
                                                                        If w_DaikyuFlg = True Then
                                                                            Exit For
                                                                        End If
                                                                    Next w_Int4

                                                                    If w_DaikyuFlg = False Then
                                                                        w_ForeColor = ColorTranslator.FromOle(M_AJUSTDAIKYUCOLOR)
                                                                        w_BackColor = Color.White
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                        .Cells(w_Row, w_Col).BackColor = w_BackColor
                                                        .Cells(w_Row, w_Col).ForeColor = w_ForeColor
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ヶ月

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                            w_Col = 0
                                                        End If

                                                        If w_HyojiFlg = True OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                            '配属している場合又は実績期間の場合 ｾﾙ設定
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                        End If
                                                        If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                            '配属している場合 色設定
                                                            If w_RiyuKBN = "1" Then
                                                                '通常
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = Color.White
                                                            ElseIf w_RiyuKBN = "2" Then
                                                                '要請勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                            ElseIf w_RiyuKBN = "3" Then
                                                                '希望勤務 文字/背景色
                                                                '2015/07/21 Bando Upd Start ==================
                                                                If w_Comment = "" Then
                                                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                    w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                                                Else
                                                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                    w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                                                End If
                                                                '2015/07/21 Bando Upd End   ==================
                                                            ElseIf w_RiyuKBN = "4" Then
                                                                '再掲勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                            ElseIf w_RiyuKBN = "5" Then
                                                                '委員会勤務 文字/背景色
                                                                w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                            ElseIf w_RiyuKBN = "6" Then
                                                                w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                            End If

                                                            '代休発生勤務 文字/背景色
                                                            If General.g_lngDaikyuMng = 0 Then
                                                                w_Var2 = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var2 <> "" Then
                                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                        w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                    End If
                                                                End If
                                                            End If

                                                            '2015/07/22 Bando Add Start ===========================
                                                            '控除があるか判断し　背景色変更
                                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                w_Var2 = m_Spread(2).Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var2 <> "" Then
                                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                        If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                                Exit For
                                                                            End If
                                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                            Exit For
                                                                        End If
                                                                    Next
                                                                End If
                                                            End If
                                                            '2015/07/22 Bando Add End   ===========================

                                                            If w_Time <> "" Then
                                                                '勤務時間が登録されている場合
                                                                w_ForeColor = Color.Black
                                                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                            End If

                                                            If General.g_lngDaikyuMng = 0 Then
                                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                                    If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                        w_DaikyuFlg = False
                                                                        For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                            For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                                If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                                    w_DaikyuFlg = True
                                                                                    Exit For
                                                                                End If
                                                                            Next w_lng5
                                                                            'フラグがたっている場合ループを抜ける
                                                                            If w_DaikyuFlg = True Then
                                                                                Exit For
                                                                            End If
                                                                        Next w_Int4
                                                                        If w_DaikyuFlg = False Then
                                                                            w_ForeColor = ColorTranslator.FromOle(M_AJUSTDAIKYUCOLOR)
                                                                            w_BackColor = Color.White
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).BackColor = w_BackColor
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = w_ForeColor
                                                        End If

                                                        If m_KeikakuKikan.StartDate <= w_YYYYMMDD AndAlso w_KeikakuCol > 0 AndAlso w_Col > 0 Then
                                                            '計画期間内のﾃﾞｰﾀの場合 変数に取得する
                                                            w_Col = w_Col - w_KeikakuCol + 1
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Update
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                        End If
                                                    Else
                                                        '4週/4週，1ヶ月/1ヶ月
                                                        If w_Col > 0 AndAlso w_KeikakuCol > 0 Then
                                                            '年月日から格納ｾﾙの列番号 取得
                                                            w_Col = w_Col - w_KeikakuCol + 1
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Update
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                        End If
                                                    End If
                                                Else
                                                    '他部署確定ﾃﾞｰﾀのときは画面には表示しないがﾃﾞｰﾀは取得しておく（再掲ﾃﾞｰﾀや更新時の判断に使用するため）
                                                    '但し、該当年月日が未配属の場合（月中異動等で別部署所属の場合）は表示する
                                                    '応援勤務者で対象の勤務以外は処理を抜ける
                                                    If w_OuenFlg = True Then

                                                        w_Flg = M_TABUSHO
                                                        '2015/04/10 Bando Upd Start ==========================
                                                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                        '2015/04/10 Bando Upd End   ==========================

                                                        '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                        If w_HyojiFlg = False AndAlso w_Col > 0 Then
                                                            '未配属日の場合
                                                            .SetText(w_Row, w_Col, w_Var)
                                                        End If

                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                            '4週/1ヶ月

                                                            '年月日から格納ｾﾙの列番号 取得
                                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                                w_Col = 0
                                                            End If

                                                            If w_HyojiFlg <> True OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                                '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                            End If

                                                            If m_KeikakuKikan.StartDate <= w_YYYYMMDD AndAlso w_KeikakuCol > 0 AndAlso w_Col > 0 Then
                                                                '計画期間内のﾃﾞｰﾀの場合 変数に取得する
                                                                w_Col = w_Col - w_KeikakuCol + 1
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Update
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                            End If
                                                        Else
                                                            '4週/4週，1ヶ月/1ヶ月
                                                            If w_Col > 0 AndAlso w_KeikakuCol > 0 AndAlso w_OuenFlg = True Then
                                                                '列番号からﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                                                w_Col = w_Col - w_KeikakuCol + 1
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = M_DataFlg_Update
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                                                m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                                            End If
                                                        End If
                                                    End If
                                                End If '---> 確定部署は該当部署？
                                            End If '---> 起動モードは？（新規 Or 勤務変更）
                                        End If '---> 勤務ｺｰﾄﾞ設定OK？
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If
                        End If

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '4週/1ヶ月で かつ 勤務変更モードの場合
                If m_DayAreaRow.StartRow <> 0 AndAlso m_DayAreaRow.EndRow <> 0 Then
                    w_EndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))
                    If Get_Col_4W(w_EndDate, w_EndCol) = True Then
                        For w_Col = w_StartCol To w_EndCol
                            '実績期間の日別集計
                            Call RunReCalc_JDay_4W(w_Col)
                        Next w_Col
                    End If
                End If
            End If

            Get_PlanData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function
    '2016/08/31 Yamanishi Upd Start -----------------------------------------------------------
    ''勤務予定ﾃﾞｰﾀ 取得(勤務変更時 勤務実績ﾃﾞｰﾀ 取得)
    'Private Sub Get_PreKinmuCD(ByRef p_KinmuCD As String, ByVal p_Date As Integer, ByVal p_Idx As Integer, ByVal p_Row As Integer, ByRef p_Time As String)

    '    Const W_SUBNAME As String = "NSK0000HA Get_PreKinmuCD"

    '    Dim w_Int As Integer
    '    Dim w_RecCnt As Integer
    '    Dim w_Var As Object
    '    Dim w_YYYYMMDD As Integer
    '    Dim w_Index As Integer
    '    Dim w_str As String
    '    Dim w_CD As String
    '    Dim w_StartTime As String
    '    Dim w_EndTime As String
    '    Dim w_NenkyuTime As String
    '    Dim w_HolSubFlg As String
    '    Dim w_DayTime As String
    '    Dim w_NightTime As String
    '    Dim w_NextNightTime As String
    '    Dim w_DeptCD As String
    '    Dim w_getFlg As Boolean '#001
    '    Try
    '        w_DeptCD = ""
    '        '変更可能な日の場合スプレッドからデータを取得
    '        If p_Date >= m_KeikakuKikan.StartDate Then
    '            For w_Int = 1 To UBound(m_4WeekKikan)
    '                If m_4WeekKikan(w_Int).EndDate = p_Date Then
    '                    w_Var = m_Spread(2).Sheets(0).GetText(p_Row, m_4WeekKikan(w_Int).KinmuDataEndCol)
    '                    '2015/04/10 Bando Upd Start ====================
    '                    'Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", w_DeptCD, p_Time)
    '                    Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", w_DeptCD, p_Time, "")
    '                    '----2016/6/10 Iida add Start
    '                    '//４週８休(後半)表示の場合、勤務記号が正しくとれてこない不具合修正
    '                    If p_KinmuCD = "" Then
    '                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
    '                            '2016/06/16 Yamanishi Upd ---------------------------------------------------------------------
    '                            'w_Var = m_Spread(2).Sheets(0).GetText(p_Row - 1, m_4WeekKikan(w_Int).KinmuDataEndCol)
    '                            'Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", w_DeptCD, p_Time, "")
    '                            If p_Row > 0 Then
    '                                w_Var = m_Spread(2).Sheets(0).GetText(p_Row - 1, m_4WeekKikan(w_Int).KinmuDataEndCol)
    '                                Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", w_DeptCD, p_Time, "")
    '                            End If
    '                            '----------------------------------------------------------------------------------------------
    '                        End If
    '                    End If
    '                    '----2016/6/10 Iida add End
    '                    '2015/04/10 Bando Upd End   ====================
    '                    Exit For
    '                End If
    '            Next w_Int
    '        Else
    '            '実績を取得する
    '            p_KinmuCD = ""

    '            General.g_objGetData.p病院CD = General.g_strHospitalCD '施設コード
    '            General.g_objGetData.p職員区分 = 0 '職員区分
    '            General.g_objGetData.p職員番号 = m_StaffData(p_Idx).ID '職員管理番号
    '            General.g_objGetData.p勤務取得区分 = 1 '実績
    '            General.g_objGetData.p日付区分 = 0 '日付区分
    '            General.g_objGetData.p開始年月日 = p_Date '開始年月日
    '            General.g_objGetData.p終了年月日 = p_Date '終了年月日
    '            General.g_objGetData.p確定部署CD = ""

    '            If General.g_objGetData.mGetkinmu = False Then
    '            Else
    '                General.g_objGetData.p実績年月日 = p_Date
    '                w_YYYYMMDD = General.g_objGetData.f実績年月日
    '                p_KinmuCD = General.g_objGetData.f実績勤務CD
    '                w_DeptCD = General.g_objGetData.f実績応援看護単位CD
    '            End If

    '            With General.g_objGetData
    '                .p病院CD = General.g_strHospitalCD
    '                .p職員区分 = 0 '職員管理番号
    '                .p職員番号 = m_StaffData(p_Idx).ID
    '                .p日付区分 = 0 '単一日
    '                .p開始年月日 = p_Date
    '                .p終了年月日 = p_Date
    '                .p年休承認区分 = 0
    '                .p削除区分 = 0
    '                .p年休UNIQUESEQNO = ""
    '                .p休暇分類CD = ""

    '                If .mGetNenkyu = True Then
    '                    w_Index = 0
    '                    .p年休年月日 = p_Date

    '                    w_RecCnt = .f年休日別件数

    '                    '初期化
    '                    w_str = ""

    '                    For w_Int = 1 To w_RecCnt
    '                        .p年休日別索引 = w_Int
    '                        '#001-----St
    '                        '時間年休のみ取得する
    '                        w_getFlg = False
    '                        If .f年休取得内容区分 = "4" Then
    '                            w_getFlg = True
    '                        End If
    '                        '届出を仕様する場合は再度確認
    '                        If w_getFlg = True AndAlso (m_PackageFLG = 2 OrElse m_PackageFLG = 3) Then
    '                            w_getFlg = False
    '                            '削除されているデータは取得しない
    '                            If .f年休削除FLG <> "1" Then
    '                                w_getFlg = True
    '                            End If
    '                        End If
    '                        '取得対象なら
    '                        If w_getFlg Then
    '                            '#001-----Ed
    '                            'HolidayBunruiCD(ﾊﾞｲﾄ数２)
    '                            w_CD = .f年休休み分類CD
    '                            If w_CD = "" Then
    '                                w_str = w_str & Space(2)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 2}", w_CD)
    '                            End If
    '                            'FromTime(ﾊﾞｲﾄ数４)
    '                            w_StartTime = Convert.ToString(.f年休開始時間)
    '                            If w_StartTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_StartTime)
    '                            End If
    '                            'ToTime(ﾊﾞｲﾄ数４)
    '                            w_EndTime = Convert.ToString(.f年休終了時間)
    '                            If w_EndTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_EndTime)
    '                            End If
    '                            'DateKbn(ﾊﾞｲﾄ数１)
    '                            w_str = w_str & .f年休年月日区分
    '                            '時間年休
    '                            w_NenkyuTime = Convert.ToString(.f取得時間)
    '                            If w_NenkyuTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_NenkyuTime)
    '                            End If

    '                            '休憩減算フラグ
    '                            w_HolSubFlg = .f休憩減算フラグ
    '                            w_str = w_str & w_HolSubFlg

    '                            '日勤時間
    '                            w_DayTime = Convert.ToString(.f年休日勤時間)
    '                            If w_DayTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_DayTime)
    '                            End If

    '                            '夜勤時間
    '                            w_NightTime = Convert.ToString(.f年休夜勤時間)
    '                            If w_NightTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_NightTime)
    '                            End If

    '                            '翌日夜勤時間
    '                            w_NextNightTime = Convert.ToString(.f年休翌日夜勤時間)
    '                            If w_NextNightTime = "" Then
    '                                w_str = w_str & Space(4)
    '                            Else
    '                                w_str = w_str & String.Format("{0, 4}", w_NextNightTime)
    '                            End If
    '                        End If
    '                    Next w_Int
    '                    p_Time = w_str
    '                End If
    '            End With
    '        End If

    '        If Not String.IsNullOrEmpty(w_DeptCD) AndAlso Not w_DeptCD.Equals(General.g_strSelKinmuDeptCD) Then
    '            p_KinmuCD = ""
    '            p_Time = ""
    '        End If

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
    '        End
    '    End Try
    'End Sub
    '勤務予定ﾃﾞｰﾀ 取得(勤務変更時 勤務実績ﾃﾞｰﾀ 取得)
    Private Sub Get_PreKinmuCD(ByRef p_KinmuCD As String, ByVal p_Date As Integer, ByVal p_Idx As Integer,
            ByVal p_Row As Integer, ByRef p_Time As String, ByRef p_OuenDeptCD As String)
        Const W_SUBNAME As String = "NSK0000HA Get_PreKinmuCD"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Var As Object
        Try
            p_OuenDeptCD = ""
            For w_Int = 1 To UBound(m_4WeekKikan)
                If m_4WeekKikan(w_Int).EndDate = p_Date Then
                    w_Var = m_Spread(2).Sheets(0).GetText(p_Row, m_4WeekKikan(w_Int).KinmuDataEndCol)
                    Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", p_OuenDeptCD, p_Time, "")
                    '//４週８休(後半)表示の場合、勤務記号が正しくとれてこない不具合修正
                    If p_KinmuCD = "" Then
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            If p_Row > 0 Then
                                w_Var = m_Spread(2).Sheets(0).GetText(p_Row - 1, m_4WeekKikan(w_Int).KinmuDataEndCol)
                                Call Get_KinmuMark(w_Var, p_KinmuCD, "", "", p_OuenDeptCD, p_Time, "")
                            End If
                        End If
                    End If
                    Exit For
                End If
            Next w_Int
            '変更不可能な日の場合
            If p_KinmuCD = "" Then
                For w_Int = 1 To UBound(m_StaffData(p_Idx).IdoHistory)
                    If m_StaffData(p_Idx).IdoHistory(w_Int).IdoYMD <= p_Date AndAlso p_Date <= m_StaffData(p_Idx).IdoHistory(w_Int).SyuryoYMD Then
                        If p_Date < m_KeikakuKikan.StartDate OrElse m_StaffData(p_Idx).IdoHistory(w_Int).CD <> General.g_strSelKinmuDeptCD Then
                            For w_Int2 = 1 To UBound(m_StaffData(p_Idx).BeforeKinmuData)
                                If m_StaffData(p_Idx).BeforeKinmuData(w_Int2).Date_Renamed = p_Date Then
                                    p_KinmuCD = m_StaffData(p_Idx).BeforeKinmuData(w_Int2).KinmuCD
                                    p_Time = m_StaffData(p_Idx).BeforeKinmuData(w_Int2).Time
                                    p_OuenDeptCD = m_StaffData(p_Idx).BeforeKinmuData(w_Int2).OuenKangoCD
                                    Exit For
                                End If
                            Next w_Int2
                            Exit For
                        End If
                    End If
                Next w_Int
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2016/08/31 Yamanishi Upd End -------------------------------------------------------------
    '勤務予定ﾃﾞｰﾀ 取得(計画期間の最後４週部分)
    Private Sub Get_PlanData_4W(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_PlanData_4W"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_RiyuKBN As String
        Dim w_KinmuCD As String
        Dim w_BushoCD As String
        Dim w_HyojiFlg As Boolean
        Dim w_Time As String
        Dim w_Flg As String = String.Empty
        Dim w_DataFlg As String = String.Empty
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_Bool As Boolean
        Dim w_lngDate As Integer
        Dim w_KangoCD As String
        Dim w_OuenFlg As Boolean
        Dim w_Var2 As Object
        Dim w_DaikyuFlg As Boolean
        Dim w_Int4 As Integer
        Dim w_lng5 As Integer
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String
        Dim w_strDaikyuFlg As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_lngWorkLoop As Integer
        Dim w_Comment As String '2015/04/10 Bando Add
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Sub
            End If

            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Cyan)
            pProcessForm.pSyoriText = "計画期間データ取得中..."

            '------------------------------
            '   計画期間外の最後４週部分 取得
            '------------------------------
            '計画開始日取得
            w_StartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))

            '計画終了日取得
            w_EndDate = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate

            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = False Then
                w_KeikakuCol = 0
            End If

            With m_Spread(2).Sheets(0)

                '処理経過ﾌｫｰﾑの初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)

                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = Integer.Parse(w_Var)

                            '時間年休取得
                            Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                            '控除データ取得
                            Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                            '==============================================================================
                            '   予定ﾃﾞｰﾀ取得（先に予定ﾃﾞｰﾀを格納設定し、その上から実績ﾃﾞｰﾀをかぶせる）
                            '==============================================================================

                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                            '勤務取得区分(予定)
                            General.g_objGetData.p勤務取得区分 = 0

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p予定年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f予定年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        w_Bool = Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col)

                                        '勤務ｺｰﾄﾞの取得
                                        w_KinmuCD = General.g_objGetData.f予定勤務CD

                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f予定理由区分

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '確定部署ﾌﾗｸﾞを該当部署で設定
                                        w_Flg = M_GAITOBUSHO

                                        w_KangoCD = General.g_objGetData.f予定応援看護単位CD

                                        w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                        w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務予定登録者ID

                                        w_OuenFlg = False
                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                w_OuenFlg = False
                                            Else
                                                w_OuenFlg = True
                                            End If
                                        Else
                                            '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                            'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                            '    w_OuenFlg = True
                                            'Else
                                            '    w_OuenFlg = False
                                            'End If

                                            w_OuenFlg = False

                                            If w_RiyuKBN = "6" Then
                                                If w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                    w_OuenFlg = True
                                                ElseIf General.g_UseMultiOuenFlg Then
                                                    For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                        If m_StaffData(w_StaffIdx).Kojyo(i).lngDate = w_lngDate Then
                                                            For j As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo(i).Seq)
                                                                If m_StaffData(w_StaffIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                    w_OuenFlg = True
                                                                    Exit For
                                                                End If
                                                            Next j
                                                        End If
                                                        If w_OuenFlg Then Exit For
                                                    Next i
                                                End If
                                            End If
                                            '--------------------------------------------------------------------------------------
                                        End If
                                        '2015/04/10 Bando Add Start =====================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            w_Comment = General.g_objGetData.f予定希望コメント
                                        End If
                                        '2015/04/10 Bando Add End   =====================

                                        '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
                                        If m_DaikyuMsgFlg = 1 Then
                                            '代休発生する勤務かチェック
                                            For w_lngWorkLoop = 1 To UBound(g_KinmuM)
                                                If w_KinmuCD = g_KinmuM(w_lngWorkLoop).CD Then
                                                    w_strDaikyuFlg = g_KinmuM(w_lngWorkLoop).DaikyuFlg
                                                    Exit For
                                                End If
                                            Next w_lngWorkLoop

                                            '代休取得可能日AND可能勤務かどうか
                                            If InStr(m_HolDateStr, Convert.ToString(w_YYYYMMDD)) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 7) Then
                                                If w_strDaikyuFlg = "1" Then
                                                    '初期化
                                                    w_blnFLG = False
                                                    If UBound(m_StaffData(w_StaffIdx).Daikyu) > 0 Then '代休情報がある場合
                                                        For w_lngWorkLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                            If m_StaffData(w_StaffIdx).Daikyu(w_lngWorkLoop).HolDate = w_YYYYMMDD Then
                                                                w_blnFLG = True
                                                                Exit For
                                                            End If
                                                        Next w_lngWorkLoop
                                                        If w_blnFLG = False Then '同じ代休情報が無ければ配列に格納
                                                            ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu) + 1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                            '取得区分
                                                            'とりあえず１日としてセット
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                            '代休1.5日分発生対象勤務かチェック
                                                            For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                        End If
                                                    Else '代休情報がない場合
                                                        ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(1)
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                        '取得区分
                                                        'とりあえず１日としてセット
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                        '代休1.5日分発生対象勤務かチェック
                                                        For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                            If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                Exit For
                                                            End If
                                                        Next w_lngWorkLoop
                                                        ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                    End If
                                                End If
                                            End If
                                        End If

                                        '代休データをソート
                                        Call SortDaikyu(w_StaffIdx)

                                        '勤務ｺｰﾄﾞが設定されている場合
                                        If Trim(w_KinmuCD) <> "" Then
                                            If w_Bool = True Then
                                                '配属しているか？
                                                w_HyojiFlg = False
                                                For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                    If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                        '配属している期間のとき
                                                        w_HyojiFlg = True
                                                        Exit For
                                                    End If
                                                Next w_Int2

                                                '応援勤務者は配属期間外とする
                                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                                    w_HyojiFlg = False
                                                End If

                                                'ｾﾙ表示勤務記号取得
                                                '2015/04/10 Bando Upd Start ========================
                                                'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                '2015/04/10 Bando Upd End   ========================

                                                If w_HyojiFlg = True Then
                                                    '配属期間内の場合

                                                    '勤務記号をｾﾙに表示
                                                    .SetText(w_Row, w_Col, w_Var)

                                                    '理由区分による色設定(文字色/背景色)
                                                    If w_RiyuKBN = "1" Then
                                                        '通常
                                                        w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                                    ElseIf w_RiyuKBN = "2" Then
                                                        '要請勤務 文字/背景色
                                                        w_ForeColor = m_Yousei_Fore
                                                        w_BackColor = m_Yousei_Back
                                                    ElseIf w_RiyuKBN = "3" Then
                                                        '希望勤務 文字/背景色
                                                        '2015/07/21 Bando Upd Start ====================
                                                        If w_Comment = "" Then
                                                            w_ForeColor = m_Kibou_Fore
                                                            w_BackColor = m_Kibou_Back
                                                        Else
                                                            w_ForeColor = m_KibouCom_Fore
                                                            w_BackColor = m_KibouCom_Back
                                                        End If
                                                        '2015/07/21 Bando Upd End   ====================
                                                    ElseIf w_RiyuKBN = "4" Then
                                                        '再掲勤務 文字/背景色
                                                        w_ForeColor = m_Saikei_Fore
                                                        w_BackColor = m_Saikei_Back
                                                    ElseIf w_RiyuKBN = "5" Then
                                                        '委員会勤務 文字/背景色
                                                        w_ForeColor = m_Iin_Fore
                                                        w_BackColor = m_Iin_Back
                                                    ElseIf w_RiyuKBN = "6" Then
                                                        '応援勤務 文字/背景色
                                                        w_ForeColor = m_Ouen_Fore
                                                        w_BackColor = m_Ouen_Back
                                                    Else
                                                        '理由区分が妥当でない場合
                                                        w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                                    End If
                                                    '代休発生勤務 文字/背景色
                                                    If General.g_lngDaikyuMng = 0 Then
                                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var2 <> "" Then
                                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                w_ForeColor = m_Daikyu_Fore
                                                                w_BackColor = m_Daikyu_Back
                                                            End If
                                                        End If
                                                    End If

                                                    '2015/07/22 Bando Add Start ===========================
                                                    '控除があるか判断し　背景色変更
                                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var2 <> "" Then
                                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                        Exit For
                                                                    End If
                                                                    w_BackColor = m_Kojo_Back
                                                                    Exit For
                                                                End If
                                                            Next
                                                        End If
                                                    End If
                                                    '2015/07/22 Bando Add End   ===========================

                                                    If w_Time <> "" Then
                                                        '勤務時間が登録されている場合
                                                        w_BackColor = m_KinmuTime_Back
                                                    End If

                                                    If General.g_lngDaikyuMng = 0 Then
                                                        If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                w_DaikyuFlg = False
                                                                For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                    For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                        If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                            w_DaikyuFlg = True
                                                                            Exit For
                                                                        End If
                                                                    Next w_lng5
                                                                    'フラグがたっている場合ループを抜ける
                                                                    If w_DaikyuFlg = True Then
                                                                        Exit For
                                                                    End If
                                                                Next w_Int4
                                                                If w_DaikyuFlg = False Then
                                                                    w_ForeColor = M_AJUSTDAIKYUCOLOR
                                                                    w_BackColor = ColorTranslator.ToOle(Color.White)
                                                                End If
                                                            End If
                                                        End If
                                                    End If

                                                    .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                    .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                Else
                                                    '配属期間外の場合
                                                    If w_OuenFlg = True Then
                                                        '勤務記号をｾﾙに表示
                                                        .SetText(w_Row, w_Col, w_Var)
                                                    End If
                                                End If
                                            End If '4週用列番号取得

                                            'ﾃﾞｰﾀあり
                                            w_DataFlg = M_DataFlg_Update
                                        Else
                                            'ﾃﾞｰﾀなし（勤務ｺｰﾄﾞが設定されていないのでなしとみなし削除対象とする）
                                            w_DataFlg = M_DataFlg_Delete
                                        End If '---> 勤務ｺｰﾄﾞ設定？

                                        If w_KeikakuCol > 0 AndAlso w_Bool = True AndAlso w_OuenFlg = True Then
                                            '変数に格納する
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_PLANDATA
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = w_DataFlg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int '---> ﾃﾞｰﾀ件数分Loop
                            End If '---> ﾃﾞｰﾀ存在？

                            '==============================================================================
                            '   実績ﾃﾞｰﾀ取得（予定ﾃﾞｰﾀを上書きする）
                            '==============================================================================
                            '勤務取得区分(実績)
                            General.g_objGetData.p勤務取得区分 = 1

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                'ﾃﾞｰﾀ件数Loop
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p実績年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f実績年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        w_Bool = Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col)

                                        '勤務ｺｰﾄﾞの取得
                                        w_KinmuCD = General.g_objGetData.f実績勤務CD

                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f実績理由区分

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '確定部署ｺｰﾄﾞの取得
                                        w_BushoCD = General.g_objGetData.f確定部署CD

                                        w_KangoCD = General.g_objGetData.f実績応援看護単位CD

                                        w_FDate = General.g_objGetData.f勤務実績初回登録日時
                                        w_LDate = General.g_objGetData.f勤務実績最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務実績登録者ID

                                        w_OuenFlg = False
                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                w_OuenFlg = False
                                            Else
                                                w_OuenFlg = True
                                            End If
                                        Else
                                            '応援勤務者の場合　予定ﾃﾞｰﾀがあるかもしれないのでからをセット
                                            w_Var2 = ""
                                            .SetText(w_Row, w_Col, w_Var2)

                                            '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                            'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                            '    w_OuenFlg = True
                                            'Else
                                            '    w_OuenFlg = False
                                            'End If

                                            w_OuenFlg = False

                                            If w_RiyuKBN = "6" Then
                                                If w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                    w_OuenFlg = True
                                                ElseIf General.g_UseMultiOuenFlg Then
                                                    For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                        If m_StaffData(w_StaffIdx).Kojyo(i).lngDate = w_lngDate Then
                                                            For j As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo(i).Seq)
                                                                If m_StaffData(w_StaffIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                    w_OuenFlg = True
                                                                    Exit For
                                                                End If
                                                            Next j
                                                        End If
                                                        If w_OuenFlg Then Exit For
                                                    Next i
                                                End If
                                            End If
                                            '--------------------------------------------------------------------------------------
                                        End If

                                        '2015/04/10 Bando Add Start ====================
                                        w_Comment = ""
                                        If w_RiyuKBN = "3" Then
                                            w_Comment = General.g_objGetData.f実績希望コメント
                                        End If
                                        '2015/04/10 Bando Add End   ====================
                                        '2016/06/15 Yamanishi Upd --------------------------------------------------------------------
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ''勤務記号 配列変数 より 勤務記号 取得
                                        'If Not String.IsNullOrEmpty(w_KinmuCD) Then
                                        '    '勤務ｺｰﾄﾞが設定されている場合
                                        '    With m_StaffData(w_StaffIdx)
                                        '        ReDim Preserve .BeforeKinmuData(UBound(.BeforeKinmuData) + 1)
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).KinmuCD = w_KinmuCD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).Date_Renamed = w_YYYYMMDD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).RiyuKBN = w_RiyuKBN
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).OuenKangoCD = w_KangoCD
                                        '    End With
                                        'End If
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ReDim Preserve m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData) + 1)
                                        With m_StaffData(w_StaffIdx).BeforeKinmuData(UBound(m_StaffData(w_StaffIdx).BeforeKinmuData))
                                            .Date_Renamed = w_YYYYMMDD
                                            .KinmuCD = w_KinmuCD
                                            .OuenKangoCD = w_KangoCD
                                            .RiyuKBN = w_RiyuKBN
                                            .Time = w_Time
                                        End With
                                        '---------------------------------------------------------------------------------------------
                                        If Trim(w_KinmuCD) <> "" Then
                                            If w_Bool = True Then
                                                'ｾﾙ表示勤務記号取得
                                                '2015/04/10 Bando Upd Start =================
                                                'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                '2015/04/10 Bando Upd End   =================

                                                '配属しているか？
                                                w_HyojiFlg = False
                                                For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                    If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                        '配属している期間のとき
                                                        w_HyojiFlg = True
                                                        Exit For
                                                    End If
                                                Next w_Int2

                                                '応援勤務者は配属期間外とする
                                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                                    w_HyojiFlg = False
                                                End If

                                                If w_HyojiFlg = True Then
                                                    '配属期間内の場合

                                                    '勤務記号をｾﾙに表示
                                                    .SetText(w_Row, w_Col, w_Var)

                                                    '4週実績用の色設定
                                                    .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(m_Jisseki4W_Back)

                                                    If w_BushoCD <> General.g_strSelKinmuDeptCD Then
                                                        '他部署確定ﾃﾞｰﾀの場合
                                                        .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Tabusho_Fore)
                                                    End If
                                                Else
                                                    '配属期間外の場合
                                                    If w_OuenFlg = True Then
                                                        If w_BushoCD <> General.g_strSelKinmuDeptCD Then
                                                            '他部署確定ﾃﾞｰﾀの場合
                                                            '勤務記号をｾﾙに表示
                                                            .SetText(w_Row, w_Col, w_Var)
                                                        End If
                                                    End If
                                                End If

                                                'ﾃﾞｰﾀあり
                                                w_DataFlg = M_DataFlg_Update
                                            End If '---> 4週用列番号取得ＯＫ？
                                        Else
                                            'ﾃﾞｰﾀなし（勤務ｺｰﾄﾞが設定されていないのでなしとみなし削除対象とする）
                                            w_DataFlg = M_DataFlg_Delete
                                        End If '---> 勤務ｺｰﾄﾞ設定？

                                        If w_KeikakuCol > 0 AndAlso w_Bool = True AndAlso w_OuenFlg = True Then
                                            '変数に格納する
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = w_DataFlg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If

                                        '実績ﾃﾞｰﾀが代休発生する勤務かチェック
                                        For w_lngWorkLoop = 1 To UBound(g_KinmuM)
                                            If w_KinmuCD = g_KinmuM(w_lngWorkLoop).CD Then
                                                w_strDaikyuFlg = g_KinmuM(w_lngWorkLoop).DaikyuFlg
                                                Exit For
                                            End If
                                        Next w_lngWorkLoop

                                        If w_strDaikyuFlg = "2" Then
                                            For w_lngWorkLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                If m_StaffData(w_StaffIdx).Daikyu(w_lngWorkLoop).HolDate = w_YYYYMMDD Then
                                                    Call UpDate_DaikyuData(w_YYYYMMDD, w_StaffIdx, 1, w_KinmuCD)
                                                    Exit For
                                                End If
                                            Next w_lngWorkLoop
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int '---> ﾃﾞｰﾀ件数Loop
                            End If '---> ﾃﾞｰﾀあるの？
                        End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得OK？

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '計画期間の実績取得 実績ﾃﾞｰﾀがないとき予定Ｆから取得
    Private Sub Get_PlanJisseki(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_PlanJisseki"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_RecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_RiyuKBN As String
        Dim w_KinmuCD As String
        Dim w_BushoCD As String
        Dim w_HyojiFlg As Boolean
        Dim w_Time As String
        Dim w_Flg As String = String.Empty
        Dim w_DataFlg As String
        Dim w_HairetuCnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_JissekiFlg As Boolean '実績ﾃﾞｰﾀ存在ﾌﾗｸﾞ（配属期間内のﾃﾞｰﾀのみで判断する）
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_lngDate As Integer
        Dim w_KangoCD As String
        Dim w_OuenFlg As Boolean
        Dim w_Var2 As Object
        Dim w_DaikyuFlg As Boolean
        Dim w_Int4 As Integer
        Dim w_FDate As Double
        Dim w_LDate As Double
        Dim w_RegistID As String
        Dim w_lng5 As Integer
        Dim w_strDaikyuFlg As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_lngWorkLoop As Integer
        Dim w_Comment As String '2015/04/10 Bando Add
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Blue)
            pProcessForm.pSyoriText = "勤務データ取得中..."

            '------------------------------
            '   勤務予定情報 取得
            '------------------------------
            '計画開始日取得
            w_StartDate = m_KeikakuKikan.StartDate

            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                    w_HairetuCnt = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - w_KeikakuCol + 1
                Else
                    w_KeikakuCol = 0
                    w_HairetuCnt = 0
                End If
            Else
                '1ｹ月/1ｹ月,4週/4週の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                w_HairetuCnt = m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol + 1
            End If

            With m_Spread(1).Sheets(0)

                '処理経過画面初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 配列番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = Integer.Parse(w_Var)

                            '時間年休取得
                            Call Get_JikanNenkyu(w_StartDate, w_EndDate, w_StaffIdx)

                            '控除データ取得
                            Call Get_KojyoData(w_StartDate, w_EndDate, w_StaffIdx)

                            '勤務ﾃﾞｰﾀ格納用配列定義
                            ReDim Preserve m_StaffData(w_StaffIdx).KinmuData(w_HairetuCnt)

                            '==============================================================================
                            '   予定ﾃﾞｰﾀ取得（先に予定ﾃﾞｰﾀを格納設定し、その上から実績ﾃﾞｰﾀをかぶせる）
                            '==============================================================================
                            '2017/11/17 Angelo add st----------------------------------------------
                            '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                            If m_intSelSaveNo > 0 Then
                                '一時保存からデータの取得
                                General.g_objGetData.p取得区分 = 1
                                General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                            Else
                                '予定勤務からデータの取得
                                General.g_objGetData.p取得区分 = 0
                            End If
                            '2017/11/17 Angelo add en----------------------------------------------
                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                            '勤務取得区分(予定)
                            General.g_objGetData.p勤務取得区分 = 0

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                'ﾃﾞｰﾀ件数分Loop
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p予定年月日 = w_lngDate

                                    w_YYYYMMDD = General.g_objGetData.f予定年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                            w_Col = 0
                                        End If

                                        '勤務ｺｰﾄﾞ
                                        w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f予定理由区分

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        w_KangoCD = General.g_objGetData.f予定応援看護単位CD

                                        w_FDate = General.g_objGetData.f勤務予定初回登録日時
                                        w_LDate = General.g_objGetData.f勤務予定最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務予定登録者ID

                                        '予定ﾃﾞｰﾀなので該当部署とする
                                        w_Flg = M_GAITOBUSHO
                                        '2016/06/15 Yamanishi Del --------------------------------------------------------------------
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        ''勤務記号 配列変数 より 勤務記号 取得
                                        'If Not String.IsNullOrEmpty(w_KinmuCD) Then
                                        '    '勤務ｺｰﾄﾞが設定されている場合
                                        '    With m_StaffData(w_StaffIdx)
                                        '        ReDim Preserve .BeforeKinmuData(UBound(.BeforeKinmuData) + 1)
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).KinmuCD = w_KinmuCD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).Date_Renamed = w_YYYYMMDD
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).RiyuKBN = w_RiyuKBN
                                        '        .BeforeKinmuData(UBound(.BeforeKinmuData)).OuenKangoCD = w_KangoCD
                                        '    End With
                                        'End If
                                        ''追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        '---------------------------------------------------------------------------------------------
                                        If Trim(w_KinmuCD) = "" Then
                                            '勤務ｺｰﾄﾞが設定されていない場合

                                            'ﾃﾞｰﾀのみの取得
                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                '4週/1ヶ月の場合
                                                If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                            End If

                                            'ﾃﾞｰﾀなし（勤務ｺｰﾄﾞが設定されていないのでなしとみなし削除対象とする）
                                            w_DataFlg = M_DataFlg_Delete

                                        Else
                                            '勤務ｺｰﾄﾞが設定されている場合

                                            '配属期間？
                                            w_HyojiFlg = False
                                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                    w_HyojiFlg = True
                                                    Exit For
                                                End If
                                            Next w_Int2

                                            '応援勤務者は配属期間外とする
                                            w_OuenFlg = False
                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                    w_OuenFlg = False
                                                Else
                                                    w_OuenFlg = True
                                                End If
                                            Else
                                                '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                                'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                '    w_OuenFlg = True
                                                '    w_HyojiFlg = False
                                                'Else
                                                '    w_OuenFlg = False
                                                'End If

                                                w_OuenFlg = False

                                                If w_RiyuKBN = "6" Then
                                                    If w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                        w_OuenFlg = True
                                                        w_HyojiFlg = False
                                                    ElseIf General.g_UseMultiOuenFlg Then
                                                        For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                            If m_StaffData(w_StaffIdx).Kojyo(i).lngDate = w_lngDate Then
                                                                For j As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo(i).Seq)
                                                                    If m_StaffData(w_StaffIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                        w_OuenFlg = True
                                                                        w_HyojiFlg = False
                                                                        Exit For
                                                                    End If
                                                                Next j
                                                            End If
                                                            If w_OuenFlg Then Exit For
                                                        Next i
                                                    End If
                                                End If
                                                '--------------------------------------------------------------------------------------
                                            End If

                                            '2015/04/10 Bando Add Start ==================
                                            w_Comment = ""
                                            If w_RiyuKBN = "3" Then
                                                w_Comment = General.g_objGetData.f予定希望コメント
                                            End If
                                            '2015/04/10 Bando Add End   ==================

                                            '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
                                            If m_DaikyuMsgFlg = 1 Then
                                                '代休発生する勤務かチェック
                                                For w_lngWorkLoop = 1 To UBound(g_KinmuM)
                                                    If w_KinmuCD = g_KinmuM(w_lngWorkLoop).CD Then
                                                        w_strDaikyuFlg = g_KinmuM(w_lngWorkLoop).DaikyuFlg
                                                        Exit For
                                                    End If
                                                Next w_lngWorkLoop

                                                '代休取得可能日AND可能勤務かどうか
                                                If InStr(m_HolDateStr, Convert.ToString(w_YYYYMMDD)) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 7) Then
                                                    If w_strDaikyuFlg = "1" Then
                                                        '初期化
                                                        w_blnFLG = False
                                                        If UBound(m_StaffData(w_StaffIdx).Daikyu) > 0 Then '代休情報がある場合
                                                            For w_lngWorkLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                If m_StaffData(w_StaffIdx).Daikyu(w_lngWorkLoop).HolDate = w_YYYYMMDD Then
                                                                    w_blnFLG = True
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            If w_blnFLG = False Then '同じ代休情報が無ければ配列に格納
                                                                ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu) + 1)
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                                '取得区分
                                                                'とりあえず１日としてセット
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                                '代休1.5日分発生対象勤務かチェック
                                                                For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                    If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                        Exit For
                                                                    End If
                                                                Next w_lngWorkLoop
                                                                ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                            End If
                                                        Else '代休情報がない場合
                                                            ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                            '取得区分
                                                            'とりあえず１日としてセット
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                            '代休1.5日分発生対象勤務かチェック
                                                            For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                        End If
                                                    End If
                                                End If
                                            End If
                                            '代休データをソート
                                            Call SortDaikyu(w_StaffIdx)

                                            If w_HyojiFlg = False Then
                                                '配属期間外ﾃﾞｰﾀ
                                                If w_OuenFlg = True Then
                                                    '勤務記号をｾﾙに表示
                                                    '2015/04/10 Bando Upd Start ===================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   ===================

                                                    If w_Col > 0 Then
                                                        .SetText(w_Row, w_Col, w_Var)
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ヶ月の場合
                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(w_YYYYMMDD, w_Col) = True Then
                                                            '勤務記号をｾﾙに表示
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                        Else
                                                            w_Col = 0
                                                        End If
                                                    End If
                                                End If
                                            Else
                                                '配属期間内ﾃﾞｰﾀ

                                                'ｾﾙに表示する文字列取得
                                                '2015/04/10 Bando Upd Start =================
                                                'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                '2015/04/10 Bando Upd End   =================

                                                If w_Col > 0 Then

                                                    '勤務記号をｾﾙに表示
                                                    .SetText(w_Row, w_Col, w_Var)

                                                    '理由区分による色設定(文字色/背景色)
                                                    If w_RiyuKBN = "1" Then
                                                        '通常
                                                        w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                                    ElseIf w_RiyuKBN = "2" Then
                                                        '要請勤務 文字/背景色
                                                        w_ForeColor = m_Yousei_Fore
                                                        w_BackColor = m_Yousei_Back
                                                    ElseIf w_RiyuKBN = "3" Then
                                                        '希望勤務 文字/背景色
                                                        '2015/07/21 Bando Upd Start ====================
                                                        If w_Comment = "" Then
                                                            w_ForeColor = m_Kibou_Fore
                                                            w_BackColor = m_Kibou_Back
                                                        Else
                                                            w_ForeColor = m_KibouCom_Fore
                                                            w_BackColor = m_KibouCom_Back
                                                        End If
                                                        '2015/07/21 Bando Upd End   ====================
                                                    ElseIf w_RiyuKBN = "4" Then
                                                        '再掲勤務 文字/背景色
                                                        w_ForeColor = m_Saikei_Fore
                                                        w_BackColor = m_Saikei_Back
                                                    ElseIf w_RiyuKBN = "5" Then
                                                        '委員会勤務 文字/背景色
                                                        w_ForeColor = m_Iin_Fore
                                                        w_BackColor = m_Iin_Back
                                                    ElseIf w_RiyuKBN = "6" Then
                                                        '応援勤務　文字/背景色
                                                        w_ForeColor = m_Ouen_Fore
                                                        w_BackColor = m_Ouen_Back
                                                    Else
                                                        '理由区分が妥当でない場合
                                                        w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                                    End If
                                                    '代休発生勤務 文字/背景色
                                                    If General.g_lngDaikyuMng = 0 Then
                                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var2 <> "" Then
                                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                w_ForeColor = m_Daikyu_Fore
                                                                w_BackColor = m_Daikyu_Back
                                                            End If
                                                        End If
                                                    End If

                                                    '2015/07/22 Bando Add Start ===========================
                                                    '控除があるか判断し　背景色変更
                                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var2 <> "" Then
                                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                        Exit For
                                                                    End If
                                                                    w_BackColor = m_Kojo_Back
                                                                    Exit For
                                                                End If
                                                            Next
                                                        End If
                                                    End If
                                                    '2015/07/22 Bando Add End   ===========================

                                                    If w_Time <> "" Then
                                                        '勤務時間が登録されている場合
                                                        w_BackColor = m_KinmuTime_Back
                                                    End If

                                                    If General.g_lngDaikyuMng = 0 Then
                                                        If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                w_DaikyuFlg = False
                                                                For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                    For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                        If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                            w_DaikyuFlg = True
                                                                            Exit For
                                                                        End If
                                                                    Next w_lng5
                                                                    If w_DaikyuFlg = True Then
                                                                        Exit For
                                                                    End If
                                                                Next w_Int4
                                                                If w_DaikyuFlg = False Then
                                                                    w_ForeColor = M_AJUSTDAIKYUCOLOR
                                                                    w_BackColor = ColorTranslator.ToOle(Color.White)
                                                                End If
                                                            End If
                                                        End If
                                                    End If

                                                    .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                    .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ヶ月の場合

                                                    '年月日から格納ｾﾙの列番号 取得
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then
                                                        '勤務記号をｾﾙに表示
                                                        m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                        '理由区分による色設定(文字色/背景色)
                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    Else
                                                        w_Col = 0
                                                    End If
                                                End If
                                            End If

                                            'ﾃﾞｰﾀあり
                                            w_DataFlg = M_DataFlg_Update
                                        End If '---> 勤務ｺｰﾄﾞあるの

                                        If w_Col > 0 AndAlso w_KeikakuCol > 0 AndAlso w_OuenFlg = True Then
                                            'ﾃﾞｰﾀを変数に退避
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_PLANDATA
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = w_DataFlg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If '---> 予定ﾃﾞｰﾀあるの

                            '==============================================================================
                            '   実績ﾃﾞｰﾀ取得（予定ﾃﾞｰﾀを上書きする）
                            '==============================================================================

                            '実績存在ﾁｪｯｸﾌﾗｸﾞ初期化
                            w_JissekiFlg = False


                            '勤務取得区分(実績)
                            General.g_objGetData.p勤務取得区分 = 1

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetkinmu = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p実績年月日 = w_lngDate

                                    '年月日を退避
                                    w_YYYYMMDD = General.g_objGetData.f実績年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '年月日から格納ｾﾙの列 取得
                                        If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                            w_Col = 0
                                        End If

                                        '勤務ｺｰﾄﾞの取得
                                        w_KinmuCD = General.g_objGetData.f実績勤務CD
                                        '理由区分の取得
                                        w_RiyuKBN = General.g_objGetData.f実績理由区分

                                        w_Time = ""
                                        For w_Int3 = 1 To UBound(m_JikanNenkyu)
                                            If m_JikanNenkyu(w_Int3).Date_Renamed = w_YYYYMMDD Then
                                                w_Time = m_JikanNenkyu(w_Int3).StrData
                                                Exit For
                                            End If
                                        Next w_Int3

                                        '確定部署ｺｰﾄﾞの取得
                                        w_BushoCD = General.g_objGetData.f確定部署CD

                                        w_KangoCD = General.g_objGetData.f実績応援看護単位CD

                                        w_FDate = General.g_objGetData.f勤務実績初回登録日時
                                        w_LDate = General.g_objGetData.f勤務実績最終更新日時
                                        w_RegistID = General.g_objGetData.f勤務実績登録者ID

                                        '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                                        '勤務記号 配列変数 より 勤務記号 取得
                                        If Not String.IsNullOrEmpty(w_KinmuCD) Then
                                            '勤務ｺｰﾄﾞが設定されている場合
                                            With m_StaffData(w_StaffIdx)
                                                ReDim Preserve .BeforeKinmuData(UBound(.BeforeKinmuData) + 1)
                                                .BeforeKinmuData(UBound(.BeforeKinmuData)).KinmuCD = w_KinmuCD
                                                .BeforeKinmuData(UBound(.BeforeKinmuData)).Date_Renamed = w_YYYYMMDD
                                                .BeforeKinmuData(UBound(.BeforeKinmuData)).RiyuKBN = w_RiyuKBN
                                                .BeforeKinmuData(UBound(.BeforeKinmuData)).OuenKangoCD = w_KangoCD
                                            End With
                                        End If
                                        '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------

                                        If Trim(w_KinmuCD) = "" Then
                                            '勤務ｺｰﾄﾞが設定されていない場合 ﾃﾞｰﾀのみの取得
                                            If w_BushoCD = General.g_strSelKinmuDeptCD Then
                                                '該当部署確定ﾃﾞｰﾀ
                                                w_Flg = M_GAITOBUSHO
                                            Else
                                                '他部署確定ﾃﾞｰﾀ
                                                w_Flg = M_TABUSHO
                                            End If
                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                '4週/1ヶ月の場合
                                                If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If
                                            End If

                                            'ﾃﾞｰﾀなし（勤務ｺｰﾄﾞが設定されていないのでなしとみなし削除対象とする）
                                            w_DataFlg = M_DataFlg_Delete
                                        Else
                                            '勤務ｺｰﾄﾞが設定されている場合

                                            '配属期間？
                                            w_HyojiFlg = False
                                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                    w_HyojiFlg = True
                                                    Exit For
                                                End If
                                            Next w_Int2

                                            '応援勤務者は配属期間外とする
                                            w_OuenFlg = False
                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                w_OuenFlg = True
                                            Else
                                                '2018/02/27 Yamanishi Upd -------------------------------------------------------------
                                                'If w_RiyuKBN = "6" AndAlso w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                '    w_OuenFlg = True
                                                '    w_HyojiFlg = False
                                                'Else
                                                '    w_OuenFlg = False
                                                'End If

                                                w_OuenFlg = False

                                                If w_RiyuKBN = "6" Then
                                                    If w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                        w_OuenFlg = True
                                                        w_HyojiFlg = False
                                                    ElseIf General.g_UseMultiOuenFlg Then
                                                        For i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                            If m_StaffData(w_StaffIdx).Kojyo(i).lngDate = w_lngDate Then
                                                                For j As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo(i).Seq)
                                                                    If m_StaffData(w_StaffIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                        w_OuenFlg = True
                                                                        w_HyojiFlg = False
                                                                        Exit For
                                                                    End If
                                                                Next j
                                                            End If
                                                            If w_OuenFlg Then Exit For
                                                        Next i
                                                    End If
                                                End If
                                                '--------------------------------------------------------------------------------------
                                            End If

                                            '2015/04/10 Bando Add Start =====================
                                            w_Comment = ""
                                            If w_RiyuKBN = "3" Then
                                                w_Comment = General.g_objGetData.f実績希望コメント
                                            End If
                                            '2015/04/10 Bando Add End   =====================

                                            '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
                                            If m_DaikyuMsgFlg = 1 Then
                                                '代休発生する勤務かチェック
                                                For w_lngWorkLoop = 1 To UBound(g_KinmuM)
                                                    If w_KinmuCD = g_KinmuM(w_lngWorkLoop).CD Then
                                                        w_strDaikyuFlg = g_KinmuM(w_lngWorkLoop).DaikyuFlg
                                                        Exit For
                                                    End If
                                                Next w_lngWorkLoop

                                                '代休取得可能日AND可能勤務かどうか
                                                If InStr(m_HolDateStr, Convert.ToString(w_YYYYMMDD)) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))) = 7) Then
                                                    If w_strDaikyuFlg = "1" Then
                                                        '初期化
                                                        w_blnFLG = False
                                                        If UBound(m_StaffData(w_StaffIdx).Daikyu) > 0 Then '代休情報がある場合
                                                            For w_lngWorkLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                If m_StaffData(w_StaffIdx).Daikyu(w_lngWorkLoop).HolDate = w_YYYYMMDD Then
                                                                    w_blnFLG = True
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            If w_blnFLG = False Then '同じ代休情報が無ければ配列に格納
                                                                ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu) + 1)
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                                '取得区分
                                                                'とりあえず１日としてセット
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                                '代休1.5日分発生対象勤務かチェック
                                                                For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                    If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                        m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                        Exit For
                                                                    End If
                                                                Next w_lngWorkLoop
                                                                ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                                m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                            End If
                                                        Else '代休情報がない場合
                                                            ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolDate = w_YYYYMMDD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).HolKinmuCD = w_KinmuCD
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).OutPutList = "1"

                                                            '取得区分
                                                            'とりあえず１日としてセット
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "0"
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1
                                                            '代休1.5日分発生対象勤務かチェック
                                                            For w_lngWorkLoop = 1 To UBound(m_Daikyu15KinmuCD)
                                                                If w_KinmuCD = m_Daikyu15KinmuCD(w_lngWorkLoop) Then
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).GetKbn = "1"
                                                                    m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).RemainderHol = 1.5
                                                                    Exit For
                                                                End If
                                                            Next w_lngWorkLoop
                                                            ReDim m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1)
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuDate = 0
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).DaikyuKinmuCD = ""
                                                            m_StaffData(w_StaffIdx).Daikyu(UBound(m_StaffData(w_StaffIdx).Daikyu)).DaikyuDetail(1).GetFlg = ""
                                                        End If
                                                    End If
                                                End If
                                            End If
                                            '代休データをソート
                                            Call SortDaikyu(w_StaffIdx)

                                            If w_HyojiFlg = False Then
                                                '配属期間外
                                                If w_OuenFlg = True Then
                                                    If w_BushoCD = General.g_strSelKinmuDeptCD Then
                                                        '該当部署ｺｰﾄﾞの場合は変数への取得のみ
                                                        w_Flg = M_GAITOBUSHO
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                            '4週/1ヶ月の場合
                                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                                w_Col = 0
                                                            End If
                                                        End If
                                                    Else
                                                        '他部署の場合
                                                        w_Flg = M_TABUSHO

                                                        '勤務記号をｾﾙに表示
                                                        '2015/04/10 Bando Upd Start =========================
                                                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                        '2015/04/10 Bando Upd End   =========================

                                                        If w_Col > 0 Then
                                                            .SetText(w_Row, w_Col, w_Var)
                                                        End If

                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                            '4週/1ヶ月の場合
                                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                            Else
                                                                w_Col = 0
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            Else
                                                '配属期間内

                                                If w_BushoCD = General.g_strSelKinmuDeptCD Then
                                                    '該当部署ｺｰﾄﾞの場合
                                                    w_Flg = M_GAITOBUSHO

                                                    '配属期間内で該当部署確定の実績ﾃﾞｰﾀがある場合
                                                    w_JissekiFlg = True

                                                    'ｾﾙに表示する文字列取得
                                                    '2015/04/10 Bando Upd Start =======================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   =======================

                                                    If w_Col > 0 Then

                                                        '勤務記号をｾﾙに表示
                                                        .SetText(w_Row, w_Col, w_Var)

                                                        '理由区分による色設定(文字色/背景色)
                                                        If w_RiyuKBN = "1" Then
                                                            '通常
                                                            w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                            w_BackColor = ColorTranslator.ToOle(Color.White)
                                                        ElseIf w_RiyuKBN = "2" Then
                                                            '要請勤務 文字/背景色
                                                            w_ForeColor = m_Yousei_Fore
                                                            w_BackColor = m_Yousei_Back
                                                        ElseIf w_RiyuKBN = "3" Then
                                                            '希望勤務 文字/背景色
                                                            '2015/07/21 Bando Upd Start ====================
                                                            If w_Comment = "" Then
                                                                w_ForeColor = m_Kibou_Fore
                                                                w_BackColor = m_Kibou_Back
                                                            Else
                                                                w_ForeColor = m_KibouCom_Fore
                                                                w_BackColor = m_KibouCom_Back
                                                            End If
                                                            '2015/07/21 Bando Upd End   ====================
                                                        ElseIf w_RiyuKBN = "4" Then
                                                            '再掲勤務 文字/背景色
                                                            w_ForeColor = m_Saikei_Fore
                                                            w_BackColor = m_Saikei_Back
                                                        ElseIf w_RiyuKBN = "5" Then
                                                            '委員会勤務 文字/背景色
                                                            w_ForeColor = m_Iin_Fore
                                                            w_BackColor = m_Iin_Back
                                                        ElseIf w_RiyuKBN = "6" Then
                                                            '応援勤務　文字/背景色
                                                            w_ForeColor = m_Ouen_Fore
                                                            w_BackColor = m_Ouen_Back
                                                        Else
                                                            '理由区分がどれにも該当しない場合
                                                            w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                                            w_BackColor = ColorTranslator.ToOle(Color.White)
                                                        End If

                                                        '代休発生勤務 文字/背景色
                                                        If General.g_lngDaikyuMng = 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                    w_ForeColor = m_Daikyu_Fore
                                                                    w_BackColor = m_Daikyu_Back
                                                                End If
                                                            End If
                                                        End If

                                                        '2015/07/22 Bando Add Start ===========================
                                                        '控除があるか判断し　背景色変更
                                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                            Exit For
                                                                        End If
                                                                        w_BackColor = m_Kojo_Back
                                                                        Exit For
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                        '2015/07/22 Bando Add End   ===========================

                                                        If w_Time <> "" Then
                                                            '勤務時間が登録されている場合
                                                            w_BackColor = m_KinmuTime_Back
                                                        End If

                                                        If General.g_lngDaikyuMng = 0 Then
                                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                                    w_DaikyuFlg = False
                                                                    For w_Int4 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                        For w_lng5 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail)
                                                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int4).DaikyuDetail(w_lng5).DaikyuDate = w_YYYYMMDD Then
                                                                                w_DaikyuFlg = True
                                                                                Exit For
                                                                            End If
                                                                        Next w_lng5
                                                                        If w_DaikyuFlg = True Then
                                                                            Exit For
                                                                        End If
                                                                    Next w_Int4
                                                                    If w_DaikyuFlg = False Then
                                                                        w_ForeColor = M_AJUSTDAIKYUCOLOR
                                                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                                                    End If
                                                                End If
                                                            End If
                                                        End If

                                                        .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                        .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ｹ月の場合

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then
                                                            '勤務記号を4週のｽﾌﾟﾚｯﾄﾞに表示
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                            '理由区分による色設定(文字色/背景色)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                        Else
                                                            w_Col = 0
                                                        End If
                                                    End If
                                                Else
                                                    '他部署の場合 （文字色を変更する）
                                                    w_Flg = M_TABUSHO

                                                    'ｾﾙに表示する文字列取得
                                                    '2015/04/10 Bando Upd Start ===========================
                                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End  . ===========================

                                                    If w_Col > 0 Then

                                                        '勤務記号をｾﾙに表示
                                                        .SetText(w_Row, w_Col, w_Var)

                                                        '理由区分による色設定(文字色/背景色)
                                                        If w_RiyuKBN = "1" Then
                                                            '通常
                                                            w_BackColor = ColorTranslator.ToOle(Color.White)
                                                        ElseIf w_RiyuKBN = "2" Then
                                                            '要請勤務 文字/背景色
                                                            w_BackColor = m_Yousei_Back
                                                        ElseIf w_RiyuKBN = "3" Then
                                                            '希望勤務 文字/背景色
                                                            '2015/07/21 Bando Upd Start ================
                                                            If w_Comment = "" Then
                                                                w_BackColor = m_Kibou_Back
                                                            Else
                                                                w_BackColor = m_KibouCom_Back
                                                            End If
                                                            '2015/07/21 Bando Upd End   ================
                                                        ElseIf w_RiyuKBN = "4" Then
                                                            '再掲勤務 文字/背景色
                                                            w_BackColor = m_Saikei_Back
                                                        ElseIf w_RiyuKBN = "5" Then
                                                            '委員会勤務 文字/背景色
                                                            w_BackColor = m_Iin_Back
                                                        ElseIf w_RiyuKBN = "6" Then
                                                            '応援勤務 文字/背景色
                                                            w_BackColor = m_Ouen_Back
                                                        Else
                                                            '理由区分がどれにも該当しない場合
                                                            w_BackColor = ColorTranslator.ToOle(Color.White)
                                                        End If
                                                        '代休発生勤務 背景色
                                                        If General.g_lngDaikyuMng = 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                                    w_BackColor = m_Daikyu_Back
                                                                End If
                                                            End If
                                                        End If

                                                        '2015/07/22 Bando Add Start ===========================
                                                        '控除があるか判断し　背景色変更
                                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var2 <> "" Then
                                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                            Exit For
                                                                        End If
                                                                        w_BackColor = m_Kojo_Back
                                                                        Exit For
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                        '2015/07/22 Bando Add End   ===========================

                                                        If w_Time <> "" Then
                                                            '勤務時間が登録されている場合
                                                            w_BackColor = m_KinmuTime_Back
                                                        End If

                                                        w_ForeColor = m_Tabusho_Fore

                                                        .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                        .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ｹ月の場合

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = True Then
                                                            '勤務記号を4週のｽﾌﾟﾚｯﾄﾞに表示
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                            '理由区分による色設定(文字色/背景色)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                        Else
                                                            w_Col = 0
                                                        End If
                                                    End If
                                                End If '---> 該当部署確定実績ﾃﾞｰﾀ？
                                            End If '---> 配属期間内？

                                            'ﾃﾞｰﾀあり
                                            w_DataFlg = M_DataFlg_Update
                                        End If '---> 勤務ｺｰﾄﾞ存在するの

                                        If w_Col > 0 AndAlso w_KeikakuCol > 0 AndAlso w_OuenFlg = True Then
                                            'ﾃﾞｰﾀを変数に退避
                                            w_Col = w_Col - w_KeikakuCol + 1
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Date_Renamed = w_YYYYMMDD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Time = w_Time
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg = w_Flg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataFlg = M_JISSEKIDATA
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).DataChk = w_DataFlg
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).FirstRegistTimeDate = w_FDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).LastUpdTimeDate = w_LDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).RegistID = w_RegistID
                                            m_StaffData(w_StaffIdx).KinmuData(w_Col).Comment = w_Comment '2015/04/10 Bando Add
                                        End If
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If '---> ﾃﾞｰﾀ存在するの

                            If w_JissekiFlg = True AndAlso g_SaikeiFlg = False Then
                                '配属期間内で該当部署確定実績データありの場合（予定表示データの文字色を他部署確定色に）
                                '但し、再掲部署の場合はそのままとする

                                w_RecCnt = UBound(m_StaffData(w_StaffIdx).KinmuData)
                                For w_Int = 1 To w_RecCnt '勤務ﾃﾞｰﾀ分Loop
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Int).DataFlg = M_PLANDATA AndAlso Trim(m_StaffData(w_StaffIdx).KinmuData(w_Int).KinmuCD) <> "" Then
                                        '予定ﾃﾞｰﾀの場合で勤務ｺｰﾄﾞが設定されている場合

                                        'ｽﾌﾟﾚｯﾄﾞの列番号取得
                                        w_Col = w_KeikakuCol + w_Int - 1
                                        'ｽﾌﾟﾚｯﾄﾞより日付取得
                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        Else
                                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        End If

                                        '日付取得OK？
                                        If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                            '配属期間内ﾁｪｯｸ
                                            w_HyojiFlg = False
                                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                                If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                    w_HyojiFlg = True
                                                    Exit For
                                                End If
                                            Next w_Int2

                                            '応援勤務者は配属期間外とする
                                            If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                                w_HyojiFlg = False
                                            End If

                                            If w_HyojiFlg = True Then
                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    m_Spread(2).Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Tabusho_Fore)
                                                    '*/*/*/*/*/*/*/*/*/*/*/
                                                    If Get_Col_M(w_Var, w_Col) = False Then
                                                        w_Col = 0
                                                    End If
                                                End If
                                                If w_Col > 0 Then
                                                    .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Tabusho_Fore)
                                                End If
                                            End If
                                        End If
                                    End If '---> 予定ﾃﾞｰﾀで勤務ｺｰﾄﾞ設定？
                                Next w_Int
                            End If '---> 配属期間内で該当部署確定ﾃﾞｰﾀあり？
                        End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得OK？

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '日当直ﾃﾞｰﾀ 取得
    Private Sub Get_DutyData(ByVal pProcessForm As Object)

        Const W_SUBNAME As String = "NSK0000HA Get_DutyData"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_IntDutyDay As Integer
        Dim w_RecCnt As Integer
        Dim w_DutyDayRecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_GroupCD() As Object
        Dim w_KinmuCD() As String
        Dim w_HyojiFlg As Boolean
        Dim w_Flg As String = String.Empty
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_lngDate As Integer
        Try
            '------------------------------
            '   日当直情報 取得
            '------------------------------
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Blue)
            pProcessForm.pSyoriText = "日当直データ取得中..."

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                '4週期間開始日
                w_StartDate = m_4WeekKikan(1).StartDate
                '4週期間終了日
                w_EndDate = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
            Else
                '1ｹ月/1ｹ月,4週/4週の場合
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '計画開始日取得
                    w_StartDate = m_KeikakuKikan.StartDate
                Else
                    '実績取込開始日を開始日とする
                    w_StartDate = m_JissekiKikan.StartDate
                End If
                '計画終了日取得
                w_EndDate = m_KeikakuKikan.EndDate
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                Else
                    w_KeikakuCol = 0
                End If
            End If

            With m_Spread(1).Sheets(0)

                '処理経過ﾌｫｰﾑ初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then

                        '該当行の職員のﾃﾞｰﾀ格納配列番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 職員管理番号取得
                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ退避
                            w_StaffIdx = Integer.Parse(w_Var)

                            '職員区分
                            General.g_objGetData.p職員区分 = 0

                            '職員番号
                            General.g_objGetData.p職員番号 = m_StaffData(w_StaffIdx).ID

                            '日付区分
                            General.g_objGetData.p日付区分 = 1

                            '開始年月日
                            General.g_objGetData.p開始年月日 = w_StartDate

                            '終了年月日
                            General.g_objGetData.p終了年月日 = w_EndDate

                            'ﾃﾞｰﾀ取得実行
                            If General.g_objGetData.mGetDuty = False Then
                            Else
                                'ﾃﾞｰﾀ件数取得
                                w_RecCnt = General.g_objGetData.f期間日数

                                w_lngDate = w_StartDate

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_Int = 1 To w_RecCnt

                                    '日付を渡す
                                    General.g_objGetData.p日当直年月日 = w_lngDate

                                    '年月日取得
                                    w_YYYYMMDD = General.g_objGetData.f日当直年月日

                                    If w_YYYYMMDD <> 0 Then

                                        '日別件数(１日に２件あり)
                                        w_DutyDayRecCnt = General.g_objGetData.f日当直日別件数

                                        '配列インデックス
                                        ReDim w_KinmuCD(w_DutyDayRecCnt)
                                        ReDim w_GroupCD(w_DutyDayRecCnt)

                                        For w_IntDutyDay = 1 To w_DutyDayRecCnt
                                            General.g_objGetData.p日当直日別索引 = w_IntDutyDay

                                            '日当直勤務ｺｰﾄﾞ取得
                                            w_KinmuCD(w_IntDutyDay) = General.g_objGetData.f日当直勤務CD
                                            '日当直勤務グループｺｰﾄﾞの取得
                                            w_GroupCD(w_IntDutyDay) = General.g_objGetData.f日当直勤務グループCD
                                        Next w_IntDutyDay

                                        '配属中？
                                        w_HyojiFlg = False
                                        For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                            If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                                '配属している期間のとき
                                                w_HyojiFlg = True
                                                Exit For
                                            End If
                                        Next w_Int2

                                        '勤務記号 配列変数 より 勤務記号 取得
                                        If UBound(w_KinmuCD) = 0 Then
                                            '勤務ｺｰﾄﾞが設定されていない場合

                                            '年月日から格納ｾﾙの列 取得
                                            If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If

                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                '4週/1ヶ月

                                                '年月日から格納ｾﾙの列番号 取得
                                                If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If
                                            End If
                                        Else
                                            w_Var = Set_DutyMark(w_KinmuCD, w_GroupCD)

                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                '勤務変更モード
                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ヶ月

                                                    '年月日から格納ｾﾙの列番号 取得
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If

                                                    If m_KeikakuKikan.StartDate <= w_YYYYMMDD AndAlso w_KeikakuCol > 0 AndAlso w_Col > 0 Then
                                                        w_Col = w_Col - w_KeikakuCol + 1
                                                        w_Flg = m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg
                                                        w_Flg = m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg
                                                    End If
                                                Else
                                                    '4週/4週，1ヶ月/1ヶ月

                                                    '年月日から格納ｾﾙの列 取得
                                                    If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If

                                                    If w_Col > 0 AndAlso w_KeikakuCol > 0 Then
                                                        w_Col = w_Col - w_KeikakuCol + 1
                                                        w_Flg = m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg
                                                        w_Flg = m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg
                                                    End If
                                                End If

                                                '年月日から格納ｾﾙの列 取得
                                                If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                                If w_Flg = M_GAITOBUSHO Then
                                                    '該当部署のとき

                                                    '配属している場合又は実績期間の場合 ｾﾙ設定
                                                    If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                        '配属している場合
                                                        .SetText(w_Row, w_Col, w_Var)
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ヶ月

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                            w_Col = 0
                                                        End If

                                                        If w_HyojiFlg = True OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                            '配属している場合又は実績期間の場合 ｾﾙ設定
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                        End If
                                                    End If
                                                Else
                                                    '他部署確定ﾃﾞｰﾀのときは画面には表示しないがﾃﾞｰﾀは取得しておく（再掲ﾃﾞｰﾀや更新時の判断に使用するため）
                                                    '但し、該当年月日が未配属の場合（月中異動等で別部署所属の場合）は表示する

                                                    '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                    If w_HyojiFlg = False AndAlso w_Col > 0 Then
                                                        '未配属日の場合
                                                        .SetText(w_Row, w_Col, w_Var)
                                                    End If

                                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                        '4週/1ヶ月

                                                        '年月日から格納ｾﾙの列番号 取得
                                                        If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                            w_Col = 0
                                                        End If

                                                        If w_HyojiFlg = False OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                            '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                        End If
                                                    End If
                                                End If '---> 確定部署は該当部署？
                                            Else
                                                '計画新規、計画変更モード

                                                '年月日から格納ｾﾙの列 取得
                                                If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                                If w_Col > 0 Then
                                                    '勤務記号をｾﾙに表示
                                                    .SetText(w_Row, w_Col, w_Var)
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ヶ月

                                                    '年月日から格納ｾﾙの列番号 取得
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If

                                                    If w_Col > 0 Then
                                                        '勤務記号をｾﾙに表示
                                                        m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                    End If
                                                End If
                                            End If '---> 起動モードは？（新規 Or 勤務変更）
                                        End If '---> 勤務ｺｰﾄﾞ設定OK？
                                    End If

                                    '１日加算
                                    w_lngDate = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Int, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))
                                Next w_Int
                            End If
                        End If

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '届出ﾃﾞｰﾀ 取得
    Private Sub Get_AppliData(ByVal pProcessForm As Object)
        Const W_SUBNAME As String = "NSK0000HA Get_AppliData"

        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Int2 As Integer
        Dim w_IntAppliDay As Integer
        Dim w_AppliDayRecCnt As Integer
        Dim w_NenkyuRecCnt As Integer
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_intSeq As Integer
        Dim w_UniqueSeqNO As String '届出UniqueSeqNO
        Dim w_AppliCD As String '届出CD
        Dim w_HolBunruiCD As String = String.Empty '休み分類CD
        Dim w_GetContentsKBN As String = String.Empty '取得内容区分(1:全日、2:前半、3:後半、4:時間年休)
        Dim w_intTimeFrom As Integer '時間FROM
        Dim w_intTimeTo As Integer '時間TO
        Dim w_strNextDayFlg As String '翌日FLG
        Dim w_strApproveFlg As String '承認済FLG
        Dim w_strDelFlg As String '削除FLG
        Dim w_HyojiFlg As Boolean
        Dim w_Flg As String = String.Empty
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_lngDateFrom As Integer
        Dim w_lngDateTo As Integer
        Dim w_FDate As Double
        Dim w_RegistID As String
        Dim w_DateF_F As ADODB.Field
        Dim w_SEQ_F As ADODB.Field
        Dim w_GetContentsKBN_F As ADODB.Field
        Dim w_Bunrui_F As ADODB.Field
        Dim w_FromTime_F As ADODB.Field
        Dim w_ToTime_F As ADODB.Field
        Dim w_NextDayFLG_F As ADODB.Field
        Dim w_UniqueSeqNo_F As ADODB.Field
        Dim w_ApproveFLG_F As ADODB.Field
        Dim w_DelFLG_F As ADODB.Field
        Dim w_REGISTFIRSTTIMEDATE_F As ADODB.Field
        Dim w_FlastDate_F As ADODB.Field
        Dim w_RegistRantID_F As ADODB.Field
        Dim w_AppliCD_F As ADODB.Field
        Dim w_FromDate_F As ADODB.Field
        Dim w_ToDate_F As ADODB.Field
        Dim w_ScreenKbn_F As ADODB.Field
        Dim w_lngSelectDataCnt As Integer
        '#001-----St
        Dim w_YYYYMMDD_tmp As Integer
        Dim w_DateF_F_tmp As Integer
        '#001-----Ed
        Try
            '------------------------------
            '   届出情報 取得
            '------------------------------
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Blue)
            pProcessForm.pSyoriText = "届出データ取得中..."

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                '4週期間開始日
                w_StartDate = m_4WeekKikan(1).StartDate
                '4週期間終了日
                w_EndDate = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
            Else
                '1ｹ月/1ｹ月,4週/4週の場合
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '計画開始日取得
                    w_StartDate = m_KeikakuKikan.StartDate
                Else
                    '実績開始日取得
                    w_StartDate = m_JissekiKikan.StartDate
                End If
                '計画終了日取得
                w_EndDate = m_KeikakuKikan.EndDate
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                'ﾃﾞｰﾀを格納する配列の数を計算
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                Else
                    w_KeikakuCol = 0
                End If
            End If

            With m_Spread(1).Sheets(0)

                '処理経過ﾌｫｰﾑ初期化
                pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine
                w_intCount = 0

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow

                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then

                        '該当行の職員のﾃﾞｰﾀ格納配列番号取得
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 職員管理番号取得
                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ退避
                            w_StaffIdx = Integer.Parse(w_Var)

                            w_strSql = "SELECT A.DATEF , A.SEQ , A.GETCONTENTSKBN , A.HOLIDAYBUNRUICD "
                            w_strSql = w_strSql & ", A.FROMTIME , A.TOTIME , A.NEXTDAYFLG "
                            w_strSql = w_strSql & ", A.UNIQUESEQNO , A.APPROVEFLG , A.DELFLG "
                            w_strSql = w_strSql & ", A.REGISTFIRSTTIMEDATE , A.LASTUPDTIMEDATE , A.REGISTRANTID "
                            w_strSql = w_strSql & ", B.APPLICD , B.PERIODFROMDATE , B.PERIODTODATE "
                            w_strSql = w_strSql & ", C.SCREENCTRLKBN "
                            w_strSql = w_strSql & " FROM NS_NENKYU_F A "
                            w_strSql = w_strSql & " ,    NS_APPLI_F B "
                            w_strSql = w_strSql & " ,    NS_APPLICATION_M C "
                            w_strSql = w_strSql & " WHERE A.HOSPITALCD = '" & General.g_strHospitalCD & "' "
                            w_strSql = w_strSql & " AND A.STAFFMNGID = '" & m_StaffData(w_StaffIdx).ID & "' "
                            w_strSql = w_strSql & " AND A.DATEF >= " & w_StartDate & " "
                            w_strSql = w_strSql & " AND A.DATEF <= " & w_EndDate & " "
                            w_strSql = w_strSql & " AND B.HOSPITALCD = A.HOSPITALCD "
                            w_strSql = w_strSql & " AND B.UNIQUESEQNO = A.UNIQUESEQNO "
                            w_strSql = w_strSql & " AND C.HOSPITALCD = B.HOSPITALCD "
                            w_strSql = w_strSql & " AND C.APPLICD = B.APPLICD "
                            w_strSql = w_strSql & " AND C.SCREENCTRLKBN <> '2'"
                            w_strSql = w_strSql & " ORDER BY A.DATEF, A.SEQ "

                            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ 生成
                            w_Rs = General.paDBRecordSetOpen(w_strSql)

                            w_lngSelectDataCnt = 0

                            With w_Rs
                                'ﾚｺｰﾄﾞ件数の取得
                                If .RecordCount <= 0 Then
                                    'ﾃﾞｰﾀがないとき
                                    w_NenkyuRecCnt = 0
                                Else
                                    'ﾚｺｰﾄﾞ件数格納
                                    .MoveLast()
                                    w_NenkyuRecCnt = .RecordCount
                                End If

                                w_DateF_F = .Fields("DATEF")
                                w_SEQ_F = .Fields("SEQ")
                                w_GetContentsKBN_F = .Fields("GETCONTENTSKBN")
                                w_Bunrui_F = .Fields("HOLIDAYBUNRUICD")
                                w_FromTime_F = .Fields("FROMTIME")
                                w_ToTime_F = .Fields("TOTIME")
                                w_NextDayFLG_F = .Fields("NEXTDAYFLG")
                                w_UniqueSeqNo_F = .Fields("UNIQUESEQNO")
                                w_ApproveFLG_F = .Fields("APPROVEFLG")
                                w_DelFLG_F = .Fields("DELFLG")
                                w_REGISTFIRSTTIMEDATE_F = .Fields("REGISTFIRSTTIMEDATE")
                                w_FlastDate_F = .Fields("LASTUPDTIMEDATE")
                                w_RegistRantID_F = .Fields("REGISTRANTID")
                                w_AppliCD_F = .Fields("APPLICD")
                                w_FromDate_F = .Fields("PERIODFROMDATE")
                                w_ToDate_F = .Fields("PERIODTODATE")
                                w_ScreenKbn_F = .Fields("SCREENCTRLKBN")
                            End With

                            '時間外は届出状況に表示させない（画面制御区分で判断）
                            If w_NenkyuRecCnt <> 0 Then

                                w_Rs.MoveLast()

                                w_lngDateTo = Integer.Parse(IIf(IsDBNull(w_ToDate_F.Value), 0, w_ToDate_F.Value)) '日付TO

                                w_Rs.MoveFirst()

                                'データ取得
                                w_UniqueSeqNO = w_UniqueSeqNo_F.Value & "" 'UNIQUESEQNO
                                w_AppliCD = w_AppliCD_F.Value & "" '届出CD
                                w_lngDateFrom = Integer.Parse(IIf(IsDBNull(w_FromDate_F.Value), 0, w_FromDate_F.Value)) '日付FROM
                                w_intTimeFrom = Integer.Parse(IIf(IsDBNull(w_FromTime_F.Value), 0, w_FromTime_F.Value)) '時間FROM
                                w_intTimeTo = Integer.Parse(IIf(IsDBNull(w_ToTime_F.Value), 0, w_ToTime_F.Value)) '時間TO
                                w_strNextDayFlg = w_NextDayFLG_F.Value & "" '翌日FLG

                                'ﾃﾞｰﾀ件数取得
                                w_AppliDayRecCnt = DateDiff(DateInterval.Day, Date.Parse(Format(w_lngDateFrom, "0000/00/00")), Date.Parse(Format(w_lngDateTo, "0000/00/00"))) + 1

                                w_YYYYMMDD = w_lngDateFrom

                                '取得ﾃﾞｰﾀ件数 繰り返し
                                For w_IntAppliDay = 1 To w_AppliDayRecCnt

                                    '削除Flg 初期化(削除)
                                    w_strDelFlg = "1"

                                    '日付で同じデータかどうか判断
                                    If w_YYYYMMDD = w_DateF_F.Value Then
                                        'データ取得
                                        w_intSeq = w_SEQ_F.Value
                                        w_HolBunruiCD = w_Bunrui_F.Value & "" '休み分類CD
                                        w_GetContentsKBN = w_GetContentsKBN_F.Value & "" '取得内容区分

                                        w_strApproveFlg = w_ApproveFLG_F.Value & "" '承認済FLG
                                        w_strDelFlg = w_DelFLG_F.Value & "" '削除FLG
                                        w_FDate = IIf(IsDBNull(w_REGISTFIRSTTIMEDATE_F.Value), 0, w_REGISTFIRSTTIMEDATE_F.Value)

                                        w_RegistID = w_RegistRantID_F.Value & ""

                                        '#001-----St
                                        'その届出のデータが必要のはず
                                        w_UniqueSeqNO = w_UniqueSeqNo_F.Value & "" 'UNIQUESEQNO
                                        w_AppliCD = w_AppliCD_F.Value & "" '届出CD
                                        w_intTimeFrom = Integer.Parse(IIf(IsDBNull(w_FromTime_F.Value), 0, w_FromTime_F.Value)) '時間FROM
                                        w_intTimeTo = Integer.Parse(IIf(IsDBNull(w_ToTime_F.Value), 0, w_ToTime_F.Value)) '時間TO
                                        w_strNextDayFlg = w_NextDayFLG_F.Value & "" '翌日FLG
                                        w_DateF_F_tmp = w_DateF_F.Value
                                        '#001-----Ed

                                        w_lngSelectDataCnt = w_lngSelectDataCnt + 1

                                        w_Rs.MoveNext()

                                        '#001-----St
                                        'TODO 同一日に届出があると取得できないのでひとまず暫定対応
                                        If Not (w_Rs.EOF = True OrElse w_Rs.BOF = True) AndAlso w_DateF_F_tmp = w_DateF_F.Value OrElse w_strDelFlg = "1" Then
                                            '次の日の届出と同じ日付なら次の日まで処理を進める
                                            w_YYYYMMDD_tmp = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(w_YYYYMMDD, "0000/00/00"))), "yyyyMMdd"))
                                            Do
                                                If (w_Rs.EOF = True OrElse w_Rs.BOF = True) Then
                                                    Exit Do

                                                ElseIf w_strDelFlg = "1" AndAlso w_DateF_F_tmp = w_DateF_F.Value Then
                                                    '削除フラグ＝ON、且つ次のデータの日付が同じときは再取得
                                                    '削除データ以外を取得する
                                                    w_intSeq = w_SEQ_F.Value
                                                    w_HolBunruiCD = w_Bunrui_F.Value & "" '休み分類CD
                                                    w_GetContentsKBN = w_GetContentsKBN_F.Value & "" '取得内容区分
                                                    w_strApproveFlg = w_ApproveFLG_F.Value & "" '承認済FLG
                                                    w_strDelFlg = w_DelFLG_F.Value & "" '削除FLG
                                                    w_FDate = IIf(IsDBNull(w_REGISTFIRSTTIMEDATE_F.Value), 0, w_REGISTFIRSTTIMEDATE_F.Value)
                                                    w_RegistID = w_RegistRantID_F.Value & ""
                                                    w_UniqueSeqNO = w_UniqueSeqNo_F.Value & "" 'UNIQUESEQNO
                                                    w_AppliCD = w_AppliCD_F.Value & "" '届出CD
                                                    w_intTimeFrom = Integer.Parse(IIf(IsDBNull(w_FromTime_F.Value), 0, w_FromTime_F.Value)) '時間FROM
                                                    w_intTimeTo = Integer.Parse(IIf(IsDBNull(w_ToTime_F.Value), 0, w_ToTime_F.Value)) '時間TO
                                                    w_strNextDayFlg = w_NextDayFLG_F.Value & "" '翌日FLG
                                                    w_DateF_F_tmp = w_DateF_F.Value

                                                ElseIf w_YYYYMMDD_tmp <= w_DateF_F.Value Then
                                                    Exit Do

                                                End If
                                                w_Rs.MoveNext()
                                            Loop
                                        End If
                                        '#001-----Ed
                                        Exit For
                                    End If

                                    '配属中？
                                    w_HyojiFlg = False
                                    For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                        If m_StaffData(w_StaffIdx).IdoData(w_Int2).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int2).SyuryoYMD Then
                                            '配属している期間のとき
                                            w_HyojiFlg = True
                                            Exit For
                                        End If
                                    Next w_Int2

                                    '削除Flgが削除でなければ、表示する。
                                    If w_HyojiFlg = True Then
                                        w_HyojiFlg = False
                                        If w_strDelFlg <> "1" Then
                                            w_HyojiFlg = True
                                        End If
                                    End If

                                    '休み分類記号 配列変数 より 休み分類記号 取得
                                    If Trim(w_AppliCD) = "" Then
                                        '休み分類ｺｰﾄﾞが設定されていない場合

                                        '年月日から格納ｾﾙの列 取得
                                        If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                            w_Col = 0
                                        End If

                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                            '4週/1ヶ月

                                            '年月日から格納ｾﾙの列番号 取得
                                            If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If
                                        End If
                                    Else
                                        w_Var = Set_AppliMark(w_UniqueSeqNO, w_AppliCD, w_HolBunruiCD, w_GetContentsKBN, w_intTimeFrom, w_intTimeTo, w_strNextDayFlg)

                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            '勤務変更モード
                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                '4週/1ヶ月

                                                '年月日から格納ｾﾙの列番号 取得
                                                If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                                If m_KeikakuKikan.StartDate <= w_YYYYMMDD AndAlso w_KeikakuCol > 0 AndAlso w_Col > 0 Then
                                                    w_Col = w_Col - w_KeikakuCol + 1
                                                    w_Flg = m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg
                                                    w_Flg = m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg
                                                End If
                                            Else
                                                '4週/4週，1ヶ月/1ヶ月

                                                '年月日から格納ｾﾙの列 取得
                                                If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                                If w_Col > 0 AndAlso w_KeikakuCol > 0 Then
                                                    w_Col = w_Col - w_KeikakuCol + 1
                                                    w_Flg = m_StaffData(w_StaffIdx).CompKinmuData(w_Col).KakuteiFlg
                                                    w_Flg = m_StaffData(w_StaffIdx).KinmuData(w_Col).KakuteiFlg
                                                End If
                                            End If

                                            '年月日から格納ｾﾙの列 取得
                                            If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If

                                            If w_Flg = M_GAITOBUSHO Then
                                                '該当部署のとき

                                                '配属している場合又は実績期間の場合 ｾﾙ設定
                                                If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                    '配属している場合
                                                    .SetText(w_Row, w_Col, w_Var)
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ヶ月

                                                    '年月日から格納ｾﾙの列番号 取得
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If

                                                    If w_HyojiFlg = True OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                        '配属している場合又は実績期間の場合 ｾﾙ設定
                                                        m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                    End If
                                                End If
                                            Else
                                                '他部署確定ﾃﾞｰﾀのときは画面には表示しないがﾃﾞｰﾀは取得しておく（再掲ﾃﾞｰﾀや更新時の判断に使用するため）
                                                '但し、該当年月日が未配属の場合（月中異動等で別部署所属の場合）は表示する

                                                '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                If w_HyojiFlg = False AndAlso w_Col > 0 Then
                                                    '未配属日の場合
                                                    .SetText(w_Row, w_Col, w_Var)
                                                End If

                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ヶ月

                                                    '年月日から格納ｾﾙの列番号 取得
                                                    If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                        w_Col = 0
                                                    End If

                                                    If w_HyojiFlg = False OrElse w_YYYYMMDD < m_KeikakuKikan.StartDate AndAlso w_Col > 0 Then
                                                        '未配属日の場合 又は 実績期間の場合 ｾﾙ設定
                                                        m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                    End If
                                                End If
                                            End If '---> 確定部署は該当部署？
                                        Else
                                            '計画新規、計画変更モード

                                            '年月日から格納ｾﾙの列 取得
                                            If Get_Col_M(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                w_Col = 0
                                            End If

                                            If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                '勤務記号をｾﾙに表示
                                                .SetText(w_Row, w_Col, w_Var)
                                            End If

                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                '4週/1ヶ月

                                                '年月日から格納ｾﾙの列番号 取得
                                                If Get_Col_4W(DirectCast(w_YYYYMMDD, Object), w_Col) = False Then
                                                    w_Col = 0
                                                End If

                                                If w_HyojiFlg = True AndAlso w_Col > 0 Then
                                                    '勤務記号をｾﾙに表示
                                                    m_Spread(2).Sheets(0).SetText(w_Row, w_Col, w_Var)
                                                End If
                                            End If
                                        End If '---> 起動モードは？（新規 Or 勤務変更）
                                    End If '---> 勤務ｺｰﾄﾞ設定OK？

                                    '１日加算
                                    w_YYYYMMDD = Integer.Parse(Format(DateAdd(DateInterval.Day, w_IntAppliDay, Date.Parse(Format(w_lngDateFrom, "0000/00/00"))), "yyyyMMdd"))

                                    If w_NenkyuRecCnt = w_lngSelectDataCnt Then
                                        Exit For
                                    End If

                                    If (w_Rs.EOF = True OrElse w_Rs.BOF = True) Then Exit For
                                Next w_IntAppliDay
                            End If '---> 画面制御区分 時間外以外？

                            'ｵﾌﾞｼﾞｪｸﾄを解放します。
                            w_Rs.Close()

                            w_Rs = Nothing
                        End If

                        '処理経過ｶｳﾝﾄ
                        w_intCount = w_intCount + 1
                        pProcessForm.pCountValue = w_intCount
                    End If
                Next w_Row
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '日付から4週期間の列番号 取得
    '   引き数：pDate 日付（YYYYMMDD）
    '   　　　　pCol  4週期間用ｽﾌﾟﾚｯﾄﾞの日付に対する対象列番号
    '   戻り値：対象日付の列が存在するか（True:存在，False:存在しない）
    Private Function Get_Col_4W(ByVal pDate As Object, ByRef pCol As Integer) As Boolean


        Dim w_lngDate As Integer
        Dim w_Find As Integer
        Try
            '第一引き数の日付ﾁｪｯｸ
            If Not IsNumeric(pDate) Then Return False
            If IsDate(Format(Integer.Parse(pDate), "0000/00/00")) = False Then
                Get_Col_4W = False
                Exit Function
            End If

            '日付を変数に退避（YYYYMMDD）
            w_lngDate = Integer.Parse(pDate)

            '年月日から格納ｾﾙの列番号 取得
            w_Find = InStr(m_DayStr2, String.Format("{0, 8}", pDate))
            If w_Find <= 0 Then
                '日付が見つからない場合
                Get_Col_4W = False
                Exit Function
            End If

            '年月日から格納ｾﾙの列番号 取得
            pCol = (w_Find \ 9) + M_KinmuDataStart_Col

            Get_Col_4W = True

        Catch ex As Exception
            '関数の性質上関数内でｴﾗｰﾄﾗｯﾌﾟは行わず呼び出し元へｴﾗｰ情報を返します
            Throw
        End Try
    End Function

    '日付から実績/計画期間の列番号 取得
    '   引き数：pDate 日付（YYYYMMDD）
    '   　　　　pCol  1ヶ月用ｽﾌﾟﾚｯﾄﾞの日付に対する対象列番号
    '   戻り値：対象日付の列が存在するか（True:存在，False:存在しない）
    Private Function Get_Col_M(ByVal pDate As Object, ByRef pCol As Integer) As Boolean


        Dim w_lngDate As Integer
        Dim w_Find As Integer
        Try
            '第一引き数の日付ﾁｪｯｸ
            If Not IsNumeric(pDate) Then Return False
            If IsDate(Format(Integer.Parse(pDate), "0000/00/00")) = False Then
                Get_Col_M = False
                Exit Function
            End If

            '日付を変数に退避（YYYYMMDD）
            w_lngDate = Integer.Parse(pDate)

            '年月日から格納ｾﾙの列番号 取得
            w_Find = InStr(m_DayStr, String.Format("{0, 8}", pDate))
            If w_Find <= 0 Then
                '日付が見つからない場合
                Get_Col_M = False
                Exit Function
            End If

            pCol = (w_Find \ 9) + M_KinmuDataStart_Col

            Get_Col_M = True

        Catch ex As Exception
            '関数の性質上関数内でｴﾗｰﾄﾗｯﾌﾟは行わず呼び出し元へｴﾗｰ情報を返します
            Throw
        End Try
    End Function

    '４週期間個人別集計 計算実行
    Private Sub RunReCalc_User_4W(ByVal p_Row As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_User_4W"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Seq2 As Integer
        Dim w_Index As Integer
        Dim w_PersonalGoukei(,) As Single
        'Dim w_Row As Integer '2018/03/08 Yamanishi Del
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_KangoCD As String = String.Empty
        Dim w_From_Col() As Integer
        Dim w_To_Col() As Integer
        Dim w_Int2 As Integer
        Dim w_HairetuIdx As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_TotalTime As Double
        Dim w_TotalTime_N As Double
        Dim w_j As Integer
        Dim w_KangoIdx As Integer
        Dim w_YYYYMMDD As Integer
        '----2016/06/13 Iida add Start
        Dim w_GetYYYYMMDD As Integer
        '----2016/06/13 Iida add End
        Dim w_Hour1 As Integer
        Dim w_Min1 As Integer
        Dim w_Time1 As Integer
        Dim w_Time2 As Integer
        Dim w_KinmuTime As Integer
        Dim w_str As String
        Dim w_blnFLG As Boolean
        Dim w_blnFLG2 As Boolean
        Dim w_PlanTwoFlg As Boolean
        Dim w_YakanTimeFlg As Boolean
        Dim w_intLoop As Integer
        Dim w_intWorkCnt As Integer
        Dim w_intWorkLoop As Integer
        Dim w_DaikyuLoop As Integer
        Dim w_DaikyuPossibleCnt As Double '代休取得可能日数
        Dim w_dblWorkNum As Double
        Dim w_Seq1 As Integer
        Dim w_strTime As String
        Dim w_lngJikanNenkyu As Integer
        Dim w_lngYokuJikanNenkyu As Integer
        Dim w_SaiyoCD As String = String.Empty
        'Dim w_lngSaiyoLoop As Integer '2018/03/08 Yamanishi Del
        Dim w_blnOuenFlg As Boolean
        Dim w_lngNikkinCalcTime As Integer
        'Dim w_Time_bk As String '2018/03/08 Yamanishi Del
        Dim w_JikanOuenFlg As Boolean
        Dim w_KojyoBunruiCD() As Calc_CD_Type
        Dim w_HoliDayBunruiCD() As Calc_CD_Type
        Dim w_Var2 As Object
        Dim w_Var3 As Object
        Dim w_blnFinFlg As Boolean
        Dim w_KinmuTime2 As Integer
        Dim w_lngNikkin As Integer
        Dim w_lngYakin As Integer
        Dim w_lngYokuYakin As Integer '2016/11/10 K.I Add
        Dim w_KinmuData As String
        Dim w_KinmuCD2 As String
        Dim w_strTime2 As String
        '2016/04/21 Yamanishi Add ------------------------------------------------------------------
        Dim w_KinmuTime3 As Integer
        Dim w_TotalNightTime As Integer
        Dim w_SumTotalNightTime As Integer
        '-------------------------------------------------------------------------------------------
        '2018/03/08 Yamanishi Add ---------------------
        Dim w_BunruiCD As String = String.Empty
        Dim w_NenkyuTime As Integer
        '----------------------------------------------
        Try
            '実働時間減算対象控除
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "WORKTIMECALCKOJYOBUNRUICD", "", General.g_strHospitalCD)
            w_Var = General.paSplit(w_str, ",")

            ReDim w_KojyoBunruiCD(UBound(w_Var) + 1)

            For w_Int = 0 To UBound(w_Var)
                w_Var2 = General.paSplit(w_Var(w_Int), ";")
                w_str = w_Var2(0)
                w_KojyoBunruiCD(w_Int + 1).strKBN = w_Var2(1)
                w_Var3 = General.paSplit(w_str, "+")
                For w_Int2 = 0 To UBound(w_Var3)
                    w_KojyoBunruiCD(w_Int + 1).strCD = w_KojyoBunruiCD(w_Int + 1).strCD & String.Format("{0, 2}", w_Var3(w_Int2)) & ","
                Next w_Int2
            Next w_Int

            '実働時間減算対象時間休
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "WORKTIMECALCHOLIDAYBUNRUICD", "", General.g_strHospitalCD)
            w_Var = General.paSplit(w_str, ",")

            ReDim w_HoliDayBunruiCD(UBound(w_Var) + 1)

            For w_Int = 0 To UBound(w_Var)
                w_Var2 = General.paSplit(w_Var(w_Int), ";")
                w_str = w_Var2(0)
                w_HoliDayBunruiCD(w_Int + 1).strKBN = w_Var2(1)
                w_Var3 = General.paSplit(w_str, "+")
                For w_Int2 = 0 To UBound(w_Var3)
                    w_HoliDayBunruiCD(w_Int + 1).strCD = w_HoliDayBunruiCD(w_Int + 1).strCD & String.Format("{0, 2}", w_Var3(w_Int2)) & ","
                Next w_Int2
            Next w_Int

            w_blnOuenFlg = False

            '合計行ある ?
            If UBound(m_HMtrx_4Week) <= 0 Then
                '合計行ない場合

                '最終職員の場合
                If (m_StaffRow.EndRow - m_StaffRow.StartRow) \ m_MaxShowLine = (p_Row - m_StaffRow.StartRow) \ m_MaxShowLine Then
                    '4週選択の場合
                    If cmbKikan.SelectedIndex > 0 Then
                        ReDim m_TotalTime_4W(UBound(m_4WeekKikan))
                        ReDim m_YakinJujiCnt_4W(UBound(m_4WeekKikan))
                        Call Set_KangoKasanTotalData()
                    End If
                End If

                Exit Sub
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Sub
            End If

            If (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                w_PlanTwoFlg = True
            ElseIf (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                w_PlanTwoFlg = False
            Else
                Exit Sub
            End If

            If m_SelViewKikan = 0 Then
                Exit Sub
            End If

            If m_StaffRow.StartRow = p_Row - m_KinmuPlan Then
                ReDim m_TotalTime_4W(UBound(m_4WeekKikan))
                ReDim m_YakinJujiCnt_4W(UBound(m_4WeekKikan))

                '初期化
                For w_Int = 1 To UBound(m_4WeekKikan)
                    m_TotalTime_4W(w_Int) = 0
                    m_YakinJujiCnt_4W(w_Int) = 0
                Next w_Int
            End If

            With m_Spread(2).Sheets(0)

                w_Var = .GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    w_HairetuIdx = Integer.Parse(w_Var)
                End If

                ReDim w_From_Col(UBound(m_StaffData(w_HairetuIdx).IdoData))
                ReDim w_To_Col(UBound(m_StaffData(w_HairetuIdx).IdoData))

                For w_Int = 1 To UBound(m_StaffData(w_HairetuIdx).IdoData)
                    '年月日から配属日/転出日の列番号 取得
                    If Get_Col_4W(m_StaffData(w_HairetuIdx).IdoData(w_Int).IdoYMD, w_From_Col(w_Int)) = False Then
                        w_From_Col(w_Int) = M_KinmuData_Col
                    End If
                    If Get_Col_4W(m_StaffData(w_HairetuIdx).IdoData(w_Int).SyuryoYMD, w_To_Col(w_Int)) = False Then
                        w_To_Col(w_Int) = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                    End If
                Next w_Int

                '合計値 配列変数 定義
                ReDim w_PersonalGoukei(UBound(m_4WeekKikan), UBound(m_HMtrx_4Week))

                For w_Int = 1 To UBound(m_4WeekKikan)
                    If w_Int = m_SelViewKikan Then

                        '********************************
                        '     代休取得可能日数の取得
                        '********************************
                        w_DaikyuPossibleCnt = 0
                        '該当職員の代休情報件数分ループする
                        For w_DaikyuLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Daikyu)
                            '代休集計期間かどうか？
                            If m_lngDaikyuStartDate_Cnt <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_lngDaikyuEndDate_Cnt Then
                                w_dblWorkNum = 0
                                '代休発生量を判断
                                Select Case m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).GetKbn
                                    Case "0"
                                        w_dblWorkNum = 1
                                    Case "1"
                                        w_dblWorkNum = 1.5
                                End Select

                                '代休集計期間
                                If m_4WeekKikan(m_SelViewKikan).StartDate <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                    '代休集計期間内かつ、計画期間内の場合・・・
                                    '代休の未使用分を加算
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                Else
                                    '代休集計期間内かつ、計画期間外の場合・・・
                                    '代休の未使用分を加算
                                    With m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop)
                                        If Double.Parse(.OutPutList) = 1 AndAlso UBound(.DaikyuDetail) = 0 Then
                                        Else
                                            w_dblWorkNum = .RemainderHol
                                            For w_Seq1 = 1 To UBound(.DaikyuDetail)
                                                If m_4WeekKikan(m_SelViewKikan).StartDate <= .DaikyuDetail(w_Seq1).DaikyuDate AndAlso .DaikyuDetail(w_Seq1).DaikyuDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                                    Select Case .DaikyuDetail(w_Seq1).GetFlg
                                                        Case "0"
                                                            '１日
                                                            w_dblWorkNum = w_dblWorkNum + 1
                                                        Case "1"
                                                            '半日
                                                            w_dblWorkNum = w_dblWorkNum + 0.5
                                                    End Select
                                                End If
                                            Next w_Seq1
                                        End If
                                    End With
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                End If
                            End If
                        Next w_DaikyuLoop

                        '代休区分の集計配列に代休取得可能日数を格納する
                        For w_Seq1 = 1 To UBound(m_HMtrx_4Week)
                            If m_HMtrx_4Week(w_Seq1).CntKbn = "6" Then
                                w_PersonalGoukei(w_Int, w_Seq1) = w_DaikyuPossibleCnt
                            End If
                        Next w_Seq1
                    End If
                Next w_Int

                '勤務ﾃﾞｰﾀの列数繰り返し
                For w_Col = m_4WeekKikan(1).KinmuDataStartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                    '初期化
                    w_HaizokuFlg = False
                    w_lngJikanNenkyu = 0
                    w_lngYokuJikanNenkyu = 0
                    w_lngNikkinCalcTime = 0

                    For w_Int = 1 To UBound(m_4WeekKikan)
                        'If w_Int = m_SelViewKikan Then '2015/04/08 Yamanishi Del

                        m_intProcessKikan = w_Int

                        If m_4WeekKikan(w_Int).KinmuDataStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_Int).KinmuDataEndCol Then

                            '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                            If w_Int = m_SelViewKikan Then '2016/06/16 hoshiki add
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    w_KangoIdx = w_Int + 1
                                Else
                                    If w_Int <> 1 Then '勤務変更以外の場合w_Intが１の場合は実績期間になるので看護加算対象外
                                        w_KangoIdx = w_Int
                                    Else
                                        w_KangoIdx = 0
                                    End If
                                End If
                                If w_KangoIdx <> 0 Then
                                    '----2016/06/24 Iida add Start
                                    '//夜勤時間計算結果非表示の場合は計算処理を行わないように修正
                                    If m_YakanKangoDispFlg = 0 Then
                                        '----2016/06/24 Iida add End
                                        w_SumTotalNightTime = w_SumTotalNightTime +
                                                Calc_NotZaikinTotalNight(w_HairetuIdx, .GetText(M_YYYYMMDDLabel_Row, w_Col), p_Row,
                                                    m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD,
                                                    m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD,
                                                    w_Col = m_4WeekKikan(w_Int).KinmuDataEndCol)
                                        '----2016/06/24 Iida add Start
                                    End If
                                    '----2016/06/24 Iida add End
                                End If
                            End If '2016/06/16 hoshiki add
                            '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------

                            w_blnFLG2 = True

                            'If .Cells(w_Row, w_Col).BackColor.Equals(Color.Black) Then
                            If .Cells(p_Row, w_Col).BackColor.Equals(Color.Black) Then '2011/09/07 Y.I Mod
                                '背景色が黒の時

                                '勤務変更時 かつ 一段表示してる時の下段
                                If w_PlanTwoFlg Then
                                    If m_blnJissekiUseFlg = False Then
                                        '上段のデータを取得
                                        w_Var = .GetText(p_Row - 1, w_Col)
                                        If w_Var <> "" Then
                                            w_blnFLG = True
                                        Else
                                            w_blnFLG = False
                                        End If
                                        w_blnFLG2 = False
                                    End If

                                    '実績変更時 かつ 二段表示してる時の上段
                                ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                    '下段のデータを取得
                                    w_Var = .GetText(p_Row + 1, w_Col)
                                    If w_Var <> "" Then
                                        w_blnFLG = True
                                    Else
                                        w_blnFLG = False
                                    End If
                                    w_blnFLG2 = False
                                End If
                            End If

                            If w_blnFLG2 Then
                                w_Var = .GetText(p_Row, w_Col)
                                If w_Var <> "" Then
                                    w_blnFLG = True
                                ElseIf w_PlanTwoFlg Then
                                    w_Var = .GetText(p_Row - 1, w_Col)
                                    If w_Var <> "" Then
                                        w_blnFLG = True
                                    Else
                                        w_blnFLG = False
                                    End If
                                Else
                                    w_blnFLG = False
                                End If
                            End If

                            If w_blnFLG Then

                                '2015/04/10 Bando Upd Start ======================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                '2015/04/10 Bando Upd End   ======================

                                If w_Int = m_SelViewKikan Then
                                    If w_RiyuKBN = "6" Then
                                        w_blnOuenFlg = True
                                    End If
                                End If

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_YYYYMMDD = Integer.Parse(w_Var)
                                End If

                                If Trim(w_KinmuCD) = "" Then
                                Else

                                    w_blnFinFlg = False
                                    w_lngNikkin = 0
                                    w_lngYakin = 0
                                    w_lngYokuYakin = 0 '2016/11/10 K.I Add 
                                    w_TotalNightTime = 0 '2016/04/21 Yamanishi Add

                                    '配属チェック
                                    w_HaizokuFlg = False
                                    w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                                    For w_intWorkLoop = 1 To w_intWorkCnt
                                        '2015/04/08 Yamanishi Upd ----------------------------------------------------------
                                        'If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                        If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                            '-------------------------------------------------------------------------------
                                            w_HaizokuFlg = True
                                            Exit For
                                        End If
                                    Next w_intWorkLoop

                                    '個人別集計項目数分 繰り返し
                                    For w_Seq = 1 To UBound(m_HMtrx_4Week)
                                        If m_HMtrx_4Week(w_Seq).CntKbn = "8" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                                Not m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).GetFlg Then
                                                Call GetSumCntData(w_HairetuIdx, w_Seq)
                                            End If
                                            If m_KeikakuKikan.StartDate < m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                For i As Integer = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                                    '----2016/06/13 Iida upd Start
                                                    '夜勤時間取得用の関数に渡す日付が上書きされてしまうバグ修正(ここで同じ名前の変数を使用しているため)
                                                    'w_YYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                    w_GetYYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                    '----2016/06/13 Iida upd End
                                                    '----2016/06/13 Iida upd Start
                                                    'If w_YYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                    If w_GetYYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                        '----2016/06/13 Iida upd End
                                                        Exit For
                                                    End If

                                                    w_blnFLG2 = True

                                                    If sprSheet_M.Sheets(0).Cells(p_Row, i).BackColor.Equals(Color.Black) Then
                                                        '背景色が黒の時
                                                        If w_PlanTwoFlg Then
                                                            If Not m_blnJissekiUseFlg Then
                                                                '勤務変更時 かつ 一段表示してる時の下段
                                                                '上段のデータを取得
                                                                w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                                If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                    w_blnFLG = True
                                                                Else
                                                                    w_blnFLG = False
                                                                End If
                                                                w_blnFLG2 = False
                                                            End If
                                                        ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                            '実績変更時 かつ 二段表示してる時の上段
                                                            '下段のデータを取得
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row + 1, i)
                                                            If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                w_blnFLG = True
                                                            Else
                                                                w_blnFLG = False
                                                            End If
                                                            w_blnFLG2 = False
                                                        End If
                                                    End If

                                                    If w_blnFLG2 Then
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row, i)
                                                        If String.IsNullOrEmpty(w_KinmuData) AndAlso w_PlanTwoFlg Then
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                        End If
                                                    End If

                                                    w_KinmuCD2 = ""
                                                    '2015/04/10 Bando Upd Start ==================
                                                    'Call Get_KinmuMark(w_KinmuData, w_KinmuCD2, "", "", "", "")
                                                    Call Get_KinmuMark(w_KinmuData, w_KinmuCD2, "", "", "", "", "")
                                                    '2015/04/10 Bando Upd End   ==================

                                                    If Not String.IsNullOrEmpty(w_KinmuCD2) AndAlso InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD2) > 0 Then
                                                        '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                        w_Index = InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD2) \ 4 + 1
                                                        w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_HMtrx_4Week(w_Seq).Ratio(w_Index)
                                                    End If
                                                Next
                                            End If
                                            w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).Cnt
                                        End If

                                        '2013/07/09 Ishiga upd start-------------------------------------------------------------
                                        'If m_HMtrx(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                        If m_HMtrx_4Week(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                            '2013/07/09 Ishiga upd end---------------------------------------------------------------
                                            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                                Not m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).GetFlg Then
                                                Call GetSumHolTimeData(w_HairetuIdx, w_Seq)
                                            End If
                                            If m_KeikakuKikan.StartDate < m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                For i As Integer = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                                    '----2016/06/13 Iida upd Start
                                                    '夜勤時間取得用の関数に渡す日付が上書きされてしまうバグ修正(ここで同じ名前の変数を使用しているため)
                                                    'w_YYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                    w_GetYYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                    '----2016/06/13 Iida upd End
                                                    '----2016/06/13 Iida upd Start
                                                    'If w_YYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                    If w_GetYYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                        '----2016/06/13 Iida upd End
                                                        Exit For
                                                    End If

                                                    w_blnFLG2 = True

                                                    If sprSheet_M.Sheets(0).Cells(p_Row, i).BackColor.Equals(Color.Black) Then
                                                        '背景色が黒の時
                                                        If w_PlanTwoFlg Then
                                                            If Not m_blnJissekiUseFlg Then
                                                                '勤務変更時 かつ 一段表示してる時の下段
                                                                '上段のデータを取得
                                                                w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                                If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                    w_blnFLG = True
                                                                Else
                                                                    w_blnFLG = False
                                                                End If
                                                                w_blnFLG2 = False
                                                            End If
                                                        ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                            '実績変更時 かつ 二段表示してる時の上段
                                                            '下段のデータを取得
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row + 1, i)
                                                            If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                w_blnFLG = True
                                                            Else
                                                                w_blnFLG = False
                                                            End If
                                                            w_blnFLG2 = False
                                                        End If
                                                    End If

                                                    If w_blnFLG2 Then
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row, i)
                                                        If String.IsNullOrEmpty(w_KinmuData) AndAlso w_PlanTwoFlg Then
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                        End If
                                                    End If

                                                    w_strTime2 = ""
                                                    '2015/04/10 Bando Upd Start =================
                                                    'Call Get_KinmuMark(w_KinmuData, "", "", "", "", w_strTime2)
                                                    Call Get_KinmuMark(w_KinmuData, "", "", "", "", w_strTime2, "")
                                                    '2015/04/10 Bando Upd End   =================

                                                    w_strTime = w_strTime2
                                                    While w_strTime <> ""
                                                        w_strTime2 = General.paLeft(w_strTime, 28)
                                                        w_strTime = Mid(w_strTime, 29)

                                                        '実働時間減算対象時間休稼動かを判定
                                                        For j As Integer = 1 To UBound(m_SumHolTimeData_4W)
                                                            If m_SumHolTimeData_4W(j).SEQ = w_Seq Then
                                                                If InStr(m_SumHolTimeData_4W(j).CD, Mid(w_strTime2, 1, 2)) > 0 Then
                                                                    w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + Integer.Parse(Mid(w_strTime2, 12, 4))
                                                                End If
                                                                Exit For
                                                            End If
                                                        Next
                                                    End While
                                                Next
                                            End If
                                            w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).Cnt
                                        End If

                                        '集計対象勤務？
                                        If w_HaizokuFlg = True AndAlso InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 Then
                                            '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                            w_Index = InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                            If m_HMtrx_4Week(w_Seq).CntKbn <> "6" Then
                                                w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_HMtrx_4Week(w_Seq).Ratio(w_Index)
                                            Else
                                                w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) - m_HMtrx_4Week(w_Seq).Ratio(w_Index)
                                            End If
                                        End If

                                        '労働時間（応援勤務者を除く）
                                        If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                            If m_HMtrx_4Week(w_Seq).CntKbn = "2" Then
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" AndAlso w_HaizokuFlg = True Then
                                                    w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                    w_Hour1 = w_KinmuTime \ 100
                                                    w_Min1 = w_KinmuTime Mod 100

                                                    w_Time1 = (w_Hour1 * 60) + w_Min1
                                                    w_Time2 = w_PersonalGoukei(w_Int, w_Seq)

                                                    '個人別時間年休を計算する
                                                    w_strTime = w_Time
                                                    'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                                        While w_strTime <> ""
                                                            '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                                            'w_Time = General.paLeft(w_strTime, 28)
                                                            'w_strTime = Mid(w_strTime, 29)

                                                            ''実働時間減算対象時間休稼動かを判定
                                                            'For w_Int2 = 1 To UBound(w_HoliDayBunruiCD)
                                                            '    If InStr(w_HoliDayBunruiCD(w_Int2).strCD, Mid(w_Time, 1, 2)) > 0 Then
                                                            '        w_Time1 = w_Time1 - TimeRound(Integer.Parse(Mid(w_Time, 12, 4)), w_HoliDayBunruiCD(w_Int2).strKBN)
                                                            '    End If
                                                            'Next w_Int2

                                                            w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                                            '実働時間減算対象時間休稼動かを判定
                                                            For i As Integer = 1 To UBound(w_HoliDayBunruiCD)
                                                                If InStr(w_HoliDayBunruiCD(i).strCD, w_BunruiCD) > 0 Then
                                                                    w_Time1 = w_Time1 - TimeRound(w_NenkyuTime, w_HoliDayBunruiCD(i).strKBN)
                                                                End If
                                                            Next i
                                                            '------------------------------------------------------------------------------------------------------
                                                        End While
                                                    End If

                                                    'w_Time = w_Time_bk '2018/03/08 Yamanishi Del

                                                    '控除時間を考慮する
                                                    For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        '現在のセルのデータのみ計算
                                                        If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                            For w_j = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime)
                                                                '実働時間減算対象時間休稼動かを判定
                                                                For w_Int2 = 1 To UBound(w_KojyoBunruiCD)
                                                                    If InStr(w_KojyoBunruiCD(w_Int2).strCD, String.Format("{0, 2}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_j))) > 0 Then
                                                                        w_Time1 = w_Time1 - TimeRound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime(w_j), w_KojyoBunruiCD(w_Int2).strKBN)
                                                                    End If
                                                                Next w_Int2
                                                            Next w_j
                                                        End If
                                                    Next w_intLoop

                                                    If w_Time1 > 0 Then
                                                        w_PersonalGoukei(w_Int, w_Seq) = (w_Time1 + w_Time2)
                                                    End If
                                                End If
                                                '累計時間
                                            ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "3" Then
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                    w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                    w_Hour1 = w_KinmuTime \ 100
                                                    w_Min1 = w_KinmuTime Mod 100

                                                    w_Time1 = (w_Hour1 * 60) + w_Min1
                                                    w_Time2 = w_PersonalGoukei(w_Int, w_Seq)

                                                    '個人別時間年休を計算する
                                                    w_strTime = w_Time
                                                    'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then

                                                        While w_strTime <> ""
                                                            '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                                            'w_Time = General.paLeft(w_strTime, 28)
                                                            'w_strTime = Mid(w_strTime, 29)

                                                            ''実働時間減算対象時間休稼動かを判定
                                                            'For w_Int2 = 1 To UBound(w_HoliDayBunruiCD)
                                                            '    If InStr(w_HoliDayBunruiCD(w_Int2).strCD, Mid(w_Time, 1, 2)) > 0 Then
                                                            '        '当日夜勤時間
                                                            '        w_Time1 = w_Time1 - TimeRound(Integer.Parse(Mid(w_Time, 12, 4)), w_HoliDayBunruiCD(w_Int2).strKBN)
                                                            '    End If
                                                            'Next w_Int2

                                                            w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                                            '実働時間減算対象時間休稼動かを判定
                                                            For i As Integer = 1 To UBound(w_HoliDayBunruiCD)
                                                                If InStr(w_HoliDayBunruiCD(i).strCD, w_BunruiCD) > 0 Then
                                                                    w_Time1 = w_Time1 - TimeRound(w_NenkyuTime, w_HoliDayBunruiCD(i).strKBN)
                                                                End If
                                                            Next i
                                                            '------------------------------------------------------------------------------------------------------
                                                        End While
                                                    End If

                                                    'w_Time = w_Time_bk '2018/03/08 Yamanishi Del

                                                    '控除時間を考慮する
                                                    For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        '現在のセルのデータのみ計算
                                                        If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                            '夜勤時間を合計
                                                            For w_j = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime)
                                                                '実働時間減算対象時間休稼動かを判定
                                                                For w_Int2 = 1 To UBound(w_KojyoBunruiCD)
                                                                    If InStr(w_KojyoBunruiCD(w_Int2).strCD, Format(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_j))) > 0 Then
                                                                        w_Time1 = w_Time1 - TimeRound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime(w_j), w_KojyoBunruiCD(w_Int2).strKBN)
                                                                    End If
                                                                Next w_Int2
                                                            Next w_j
                                                        End If
                                                    Next w_intLoop

                                                    If w_Time1 > 0 Then
                                                        w_PersonalGoukei(w_Int, w_Seq) = (w_Time1 + w_Time2)
                                                    End If
                                                End If
                                            ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "9" Then
                                                '個人別時間年休を計算する
                                                w_strTime = w_Time
                                                'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                                While w_strTime <> ""
                                                    '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                                    'w_Time = General.paLeft(w_strTime, 28)
                                                    'w_strTime = Mid(w_strTime, 29)

                                                    ''実働時間減算対象時間休稼動かを判定
                                                    'For i As Integer = 1 To UBound(m_SumHolTimeData_4W)
                                                    '    If m_SumHolTimeData_4W(i).SEQ = w_Seq Then
                                                    '        If InStr(m_SumHolTimeData_4W(i).CD, Mid(w_Time, 1, 2)) > 0 Then
                                                    '            w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + Integer.Parse(Mid(w_Time, 12, 4))
                                                    '        End If
                                                    '        Exit For
                                                    '    End If
                                                    'Next

                                                    w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                                    '実働時間減算対象時間休稼動かを判定
                                                    For i As Integer = 1 To UBound(m_SumHolTimeData_4W)
                                                        If m_SumHolTimeData_4W(i).SEQ = w_Seq Then
                                                            If InStr(m_SumHolTimeData_4W(i).CD, w_BunruiCD) > 0 Then
                                                                w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + w_NenkyuTime
                                                            End If
                                                            Exit For
                                                        End If
                                                    Next i
                                                    '------------------------------------------------------------------------------------------------------
                                                End While

                                                'w_Time = w_Time_bk '2018/03/08 Yamanishi Del
                                            End If
                                        End If

                                        If w_HaizokuFlg = True Then
                                            If (m_OuenKinmuCalcFlg = 0 AndAlso m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0")) OrElse m_OuenKinmuCalcFlg = 1 Then

                                                w_JikanOuenFlg = False

                                                '応援先が登録されている場合で、控除データが存在するデータは、時間応援データを含む
                                                'If w_KangoCD <> "" Then
                                                If w_RiyuKBN = "6" Then '2018/03/01 Yamanishi Upd
                                                    For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate AndAlso UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime) > 0 Then
                                                            w_JikanOuenFlg = True
                                                        End If
                                                    Next w_intLoop
                                                End If

                                                If m_HMtrx_4Week(w_Seq).CntKbn = "4" OrElse m_HMtrx_4Week(w_Seq).CntKbn = "5" Then
                                                    w_YakanTimeFlg = False
                                                    If m_YakanKangoDispFlg = 0 Then
                                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                            w_KangoIdx = w_Int + 1
                                                        Else
                                                            If w_Int <> 1 Then '勤務変更以外の場合w_Intが１の場合は実績期間になるので看護加算対象外
                                                                w_KangoIdx = w_Int
                                                            Else
                                                                w_KangoIdx = 0
                                                            End If
                                                        End If

                                                        If w_KangoIdx <> 0 Then
                                                            '2013/07/10 Bando Chg Start ==============================================================
                                                            'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                                            If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD, 10)) > 0 _
                                                            AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" _
                                                            OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD, 10)) > 0 _
                                                            AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                                                '2013/07/10 Bando Chg End   ==============================================================
                                                                '対象外役職CD or 対象外職種CDの場合はカウントしない
                                                            Else
                                                                If w_HaizokuFlg = True Then
                                                                    '2018/03/01 Yamanishi Upd Start ---------------------------------------------------------------------------
                                                                    'If w_KangoCD = General.g_strSelKinmuDeptCD OrElse w_KangoCD = "" Then '応援勤務先が他部署の場合はカウント対象にならない
                                                                    '    w_YakanTimeFlg = True
                                                                    '    '2016/05/02 Yamanishi Add ---------------------------------------------------------
                                                                    '    '2016/07/28 Yamanishi Upd -----------------------------------------------------------------------
                                                                    '    '//４週８休時、対象期間外の全日応援の総夜勤時間が取れてしまうのを修正
                                                                    '    'ElseIf w_JikanOuenFlg = False AndAlso w_blnFinFlg = False Then
                                                                    '    '    Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, , w_KinmuTime3)
                                                                    'ElseIf w_JikanOuenFlg = False AndAlso w_blnFinFlg = False AndAlso w_Int = m_SelViewKikan Then
                                                                    '    '//期間開始日が全日応援であると、前日の翌夜勤時間が取れてこないのを修正
                                                                    '    Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3)
                                                                    '    If w_YYYYMMDD = m_4WeekKikan(w_Int).StartDate Then
                                                                    '        If m_HMtrx_4Week(w_Seq).CntKbn = "4" Then
                                                                    '            For w_Seq2 = w_Seq + 1 To UBound(m_HMtrx_4Week)
                                                                    '                If m_HMtrx_4Week(w_Seq2).CntKbn = "5" Then  Exit For
                                                                    '            Next w_Seq2
                                                                    '        Else
                                                                    '            w_Seq2 = w_Seq
                                                                    '        End If
                                                                    '        If w_Seq2 <= UBound(m_HMtrx_4Week) Then
                                                                    '            w_PersonalGoukei(w_Int, w_Seq2) = w_PersonalGoukei(w_Int, w_Seq2) + w_KinmuTime2 _
                                                                    '                - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) _
                                                                    '                - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                                    '        End If
                                                                    '    End If
                                                                    '    '------------------------------------------------------------------------------------------------
                                                                    '    w_TotalNightTime = w_KinmuTime3
                                                                    '    w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                                    '    w_blnFinFlg = True
                                                                    '    '----------------------------------------------------------------------------------
                                                                    'End If

                                                                    If w_RiyuKBN <> "6" OrElse w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                                        w_YakanTimeFlg = True
                                                                    ElseIf General.g_UseMultiOuenFlg Then
                                                                        For i As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                                            If m_StaffData(w_HairetuIdx).Kojyo(i).lngDate = w_YYYYMMDD Then
                                                                                For j As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(i).Seq)
                                                                                    If m_StaffData(w_HairetuIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                                        w_YakanTimeFlg = True
                                                                                        Exit For
                                                                                    End If
                                                                                Next j
                                                                            End If
                                                                            If w_YakanTimeFlg Then Exit For
                                                                        Next i
                                                                    ElseIf w_JikanOuenFlg Then
                                                                        w_YakanTimeFlg = True
                                                                    End If

                                                                    If w_Int = m_SelViewKikan AndAlso Not (w_YakanTimeFlg OrElse w_JikanOuenFlg OrElse w_blnFinFlg) Then
                                                                        Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3)

                                                                        If m_4WeekKikan(w_Int).StartDate = w_YYYYMMDD Then
                                                                            If m_HMtrx_4Week(w_Seq).CntKbn = "4" Then
                                                                                For w_Seq2 = w_Seq + 1 To UBound(m_HMtrx_4Week)
                                                                                    If m_HMtrx_4Week(w_Seq2).CntKbn = "5" Then Exit For
                                                                                Next w_Seq2
                                                                            Else
                                                                                w_Seq2 = w_Seq
                                                                            End If

                                                                            If w_Seq2 <= UBound(m_HMtrx_4Week) Then
                                                                                w_PersonalGoukei(w_Int, w_Seq2) = w_PersonalGoukei(w_Int, w_Seq2) + w_KinmuTime2 _
                                                                                    - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) _
                                                                                    - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                                            End If
                                                                        End If

                                                                        w_TotalNightTime = w_KinmuTime3
                                                                        w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                                        w_blnFinFlg = True
                                                                    End If
                                                                    '2018/03/01 Yamanishi Upd End -----------------------------------------------------------------------------
                                                                    If w_JikanOuenFlg Then
                                                                        w_YakanTimeFlg = True
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                    Else
                                                        w_YakanTimeFlg = True
                                                    End If

                                                    If w_YakanTimeFlg = True Then
                                                        '2018/03/09 Yamanishi Upd Start ------------------------------------------------------------------------------
                                                        'If w_blnFinFlg = False Then

                                                        '    w_blnFinFlg = True
                                                        '    'w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2)
                                                        '    w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3) '2016/04/21 Yamanishi Upd

                                                        '    '個人別時間年休を計算する
                                                        '    w_strTime = w_Time
                                                        '    w_Time_bk = w_Time

                                                        '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                                        '        While w_strTime <> ""
                                                        '            w_Time = General.paLeft(w_strTime, 28)
                                                        '            w_strTime = Mid(w_strTime, 29)

                                                        '            '日勤時間
                                                        '            w_lngNikkinCalcTime = w_lngNikkinCalcTime + (Integer.Parse(Mid(w_Time, 17, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 17, 4)) Mod 100)
                                                        '            '当日夜勤時間
                                                        '            w_lngJikanNenkyu = w_lngJikanNenkyu + (Integer.Parse(Mid(w_Time, 21, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 21, 4)) Mod 100)
                                                        '            '翌日夜勤時間
                                                        '            w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + (Integer.Parse(Mid(w_Time, 25, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 25, 4)) Mod 100)
                                                        '        End While
                                                        '    End If

                                                        '    w_Time = w_Time_bk

                                                        '    If w_Int = m_SelViewKikan Then
                                                        '        '控除時間を考慮する
                                                        '        For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        '            '現在のセルのデータのみ計算
                                                        '            If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                        '                '日勤時間を合計
                                                        '                For w_j = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime)
                                                        '                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_j))) > 0 Then
                                                        '                        w_lngNikkinCalcTime = w_lngNikkinCalcTime + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime(w_j) \ 100) * 60 + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime(w_j) Mod 100)
                                                        '                    End If
                                                        '                Next w_j

                                                        '                '夜勤時間を合計
                                                        '                For w_j = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime)
                                                        '                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_j))) > 0 Then
                                                        '                        w_lngJikanNenkyu = w_lngJikanNenkyu + Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_j)), 2)) + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_j) - Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_j)), 2))) / 100 * 60
                                                        '                    End If
                                                        '                Next w_j

                                                        '                '翌日夜勤時間を合計
                                                        '                For w_j = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime)
                                                        '                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_j))) > 0 Then
                                                        '                        w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_j)), 2)) + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_j) - Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_j)), 2))) / 100 * 60
                                                        '                    End If
                                                        '                Next w_j
                                                        '            End If
                                                        '        Next w_intLoop
                                                        '    End If

                                                        '    '当日夜勤時間・翌日夜勤時間を別々にチェックする必要あり
                                                        '    If w_lngNikkinCalcTime <> 0 OrElse w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                        '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                        '        'For w_lngSaiyoLoop = 1 To UBound(m_StaffData(w_HairetuIdx).SaiyoData)
                                                        '        '    If m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).SaiyoDate <= w_YYYYMMDD AndAlso m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).TentaiDate >= w_YYYYMMDD Then
                                                        '        '        w_SaiyoCD = m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).SaiyoCD
                                                        '        '        If Convert.ToString(m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "A")) = "" Then
                                                        '        '            w_SaiyoCD = "00000"
                                                        '        '        End If
                                                        '        '        Exit For
                                                        '        '    End If
                                                        '        'Next w_lngSaiyoLoop

                                                        '        ''日勤時間
                                                        '        'If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B") > w_lngNikkinCalcTime Then
                                                        '        '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                        '        '        w_lngNikkin = w_lngNikkinCalcTime
                                                        '        '    Else
                                                        '        '        w_lngNikkin = w_KinmuTime - w_lngNikkinCalcTime
                                                        '        '    End If
                                                        '        'Else
                                                        '        '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                        '        '        w_lngNikkin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B")
                                                        '        '    Else
                                                        '        '        w_lngNikkin = w_KinmuTime - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B")
                                                        '        '    End If
                                                        '        'End If

                                                        '        ''夜勤時間
                                                        '        'If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                        '        '    If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C") > w_lngJikanNenkyu Then
                                                        '        '        w_lngYakin = w_lngJikanNenkyu
                                                        '        '    Else
                                                        '        '        w_lngYakin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C")
                                                        '        '    End If

                                                        '        '    If w_Col <> m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                                        '        '        If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D") > w_lngYokuJikanNenkyu Then
                                                        '        '            w_lngYakin = w_lngYokuJikanNenkyu
                                                        '        '        Else
                                                        '        '            w_lngYakin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D")
                                                        '        '        End If
                                                        '        '    End If
                                                        '        'Else
                                                        '        '    w_lngYakin = w_KinmuTime2

                                                        '        '    If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C") > w_lngJikanNenkyu Then
                                                        '        '        w_lngYakin = w_lngYakin - w_lngJikanNenkyu
                                                        '        '    Else
                                                        '        '        w_lngYakin = w_lngYakin - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C")
                                                        '        '    End If

                                                        '        '    If w_Col <> m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                                        '        '        If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D") > w_lngYokuJikanNenkyu Then
                                                        '        '            w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                        '        '        Else
                                                        '        '            w_lngYakin = w_lngYakin - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D")
                                                        '        '        End If
                                                        '        '    End If
                                                        '        'End If

                                                        '        '日勤時間
                                                        '        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime) > w_lngNikkinCalcTime Then
                                                        '            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                        '                w_lngNikkin = w_lngNikkinCalcTime
                                                        '            Else
                                                        '                w_lngNikkin = w_KinmuTime - w_lngNikkinCalcTime
                                                        '            End If
                                                        '        Else
                                                        '            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                        '                w_lngNikkin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime)
                                                        '            Else
                                                        '                w_lngNikkin = w_KinmuTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime)
                                                        '            End If
                                                        '        End If

                                                        '        '夜勤時間
                                                        '        If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                        '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) > w_lngJikanNenkyu Then
                                                        '                w_lngYakin = w_lngJikanNenkyu
                                                        '            Else
                                                        '                w_lngYakin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime)
                                                        '            End If

                                                        '            If w_Col <> m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                                        '                If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                    '----2016/06/28 Iida upd Start
                                                        '                    '//時間応援の当日夜勤時間が夜勤総時間に加算されてないバグ修正
                                                        '                    'w_lngYakin = w_lngYokuJikanNenkyu
                                                        '                    w_lngYakin = w_lngYakin + w_lngYokuJikanNenkyu
                                                        '                    '----2016/06/28 Iida upd End
                                                        '                Else
                                                        '                    '----2016/06/28 Iida upd Start
                                                        '                    '//時間応援の当日夜勤時間が夜勤総時間に加算されてないバグ修正
                                                        '                    'w_lngYakin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '                    w_lngYakin = w_lngYakin + GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '                    '----2016/06/28 Iida upd End
                                                        '                End If
                                                        '                '2016/09/01 Yamanishi Add --------------------------------------------
                                                        '            ElseIf m_4WeekKikan(w_Int).EndDate = w_YYYYMMDD Then
                                                        '                For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                        '                    If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                        '                        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                            w_lngYakin = w_lngYakin + w_lngYokuJikanNenkyu
                                                        '                        Else
                                                        '                            w_lngYakin = w_lngYakin + GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '                        End If
                                                        '                    End If
                                                        '                Next w_intLoop
                                                        '                '---------------------------------------------------------------------
                                                        '            End If
                                                        '            '2016/11/10 K.I Add Start-------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                        '            If m_4WeekKikan(w_Int).StartDate = w_YYYYMMDD Then
                                                        '                w_lngYokuYakin = fncGetBeforeNextNightTime(w_HairetuIdx, Integer.Parse(Date.Parse(w_YYYYMMDD.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")), p_Row, w_lngYokuYakin)
                                                        '                w_lngYakin = w_lngYakin + w_lngYokuYakin
                                                        '            End If
                                                        '            '2016/11/10 K.I Add End---------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                        '        Else
                                                        '            w_lngYakin = w_KinmuTime2
                                                        '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) > w_lngJikanNenkyu Then

                                                        '                w_lngYakin = w_lngYakin - w_lngJikanNenkyu
                                                        '            Else
                                                        '                w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime)
                                                        '            End If

                                                        '            If w_Col <> m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                                        '                If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                    w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                        '                Else
                                                        '                    w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '                End If
                                                        '                '2016/09/01 Yamanishi Add --------------------------------------------
                                                        '            ElseIf m_4WeekKikan(w_Int).EndDate = w_YYYYMMDD Then
                                                        '                For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                        '                    If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                        '                        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                            w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                        '                        Else
                                                        '                            w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '                        End If
                                                        '                    End If
                                                        '                Next w_intLoop
                                                        '                '---------------------------------------------------------------------
                                                        '            End If
                                                        '        End If
                                                        '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

                                                        '    Else
                                                        '        If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse w_JikanOuenFlg = False Then
                                                        '            w_lngNikkin = w_KinmuTime
                                                        '            w_lngYakin = w_KinmuTime2
                                                        '        End If
                                                        '    End If
                                                        '    '2016/04/21 Yamanishi Add ------------------------------------------------------------------------
                                                        '    If w_Int = m_SelViewKikan Then
                                                        '        w_TotalNightTime = w_KinmuTime3

                                                        '        '応援勤務者でない場合
                                                        '        If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 Then
                                                        '            '控除時間を考慮する（応援控除や計算対象外の控除にあたる場合は戻しておく）
                                                        '            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        '                With m_StaffData(w_HairetuIdx).Kojyo(w_intLoop)
                                                        '                    '現在のセルのデータのみ計算
                                                        '                    If w_YYYYMMDD = .lngDate Then
                                                        '                        For w_j = 1 To UBound(.strKinmuDetailCD)
                                                        '                            '必要なデータを元に戻す
                                                        '                            If InStr(m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD, General.paFormatSpace(.strKinmuDetailCD(w_j), 10)) > 0 Then
                                                        '                                '夜勤時間を戻す
                                                        '                                w_lngJikanNenkyu = w_lngJikanNenkyu - ((.lngYakinTime(w_j) \ 100) * 60 + (.lngYakinTime(w_j) Mod 100))
                                                        '                                '翌日夜勤時間を戻す
                                                        '                                w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu - ((.lngYokuYakinTime(w_j) \ 100) * 60 + (.lngYokuYakinTime(w_j) Mod 100))
                                                        '                            End If
                                                        '                        Next w_j
                                                        '                    End If
                                                        '                End With
                                                        '            Next w_intLoop
                                                        '        Else
                                                        '            '応援勤務者である場合

                                                        '            '当日夜勤時間
                                                        '            w_lngJikanNenkyu = 0
                                                        '            '翌日夜勤時間
                                                        '            w_lngYokuJikanNenkyu = 0

                                                        '            If w_JikanOuenFlg Then
                                                        '                '個人別時間年休を計算する
                                                        '                w_strTime = w_Time
                                                        '                w_Time_bk = w_Time

                                                        '                While w_strTime <> ""
                                                        '                    w_Time = General.paLeft(w_strTime, 28)
                                                        '                    w_strTime = Mid(w_strTime, 29)

                                                        '                    '当日夜勤時間
                                                        '                    w_lngJikanNenkyu = w_lngJikanNenkyu + (Integer.Parse(Mid(w_Time, 21, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 21, 4)) Mod 100)
                                                        '                    '翌日夜勤時間
                                                        '                    w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + (Integer.Parse(Mid(w_Time, 25, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 25, 4)) Mod 100)
                                                        '                End While
                                                        '                w_Time = w_Time_bk

                                                        '                '控除時間を考慮する
                                                        '                For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                        '                    With m_StaffData(w_HairetuIdx).Kojyo(w_intLoop)
                                                        '                        '現在のセルのデータのみ計算
                                                        '                        If w_YYYYMMDD = .lngDate Then
                                                        '                            For w_j = 1 To UBound(.strKinmuDetailCD)
                                                        '                                '必要なデータをよりわけ
                                                        '                                If InStr(m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD, General.paFormatSpace(.strKinmuDetailCD(w_j), 10)) = 0 Then
                                                        '                                    '夜勤時間を合計
                                                        '                                    w_lngJikanNenkyu = w_lngJikanNenkyu + ((.lngYakinTime(w_j) \ 100) * 60 + (.lngYakinTime(w_j) Mod 100))
                                                        '                                    '翌日夜勤時間を合計
                                                        '                                    w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + ((.lngYokuYakinTime(w_j) \ 100) * 60 + (.lngYokuYakinTime(w_j) Mod 100))
                                                        '                                End If
                                                        '                            Next w_j
                                                        '                        End If
                                                        '                    End With
                                                        '                Next w_intLoop
                                                        '            End If
                                                        '            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                        '            'If w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                        '            '    For w_lngSaiyoLoop = 1 To UBound(m_StaffData(w_HairetuIdx).SaiyoData)
                                                        '            '        With m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop)
                                                        '            '            If .SaiyoDate <= w_YYYYMMDD AndAlso w_YYYYMMDD <= .TentaiDate Then
                                                        '            '                w_SaiyoCD = .SaiyoCD
                                                        '            '                If Not m_objGetTimeM.ContainsKey(w_SaiyoCD & w_KinmuCD & "A") Then
                                                        '            '                    w_SaiyoCD = "00000"
                                                        '            '                End If
                                                        '            '                Exit For
                                                        '            '            End If
                                                        '            '        End With
                                                        '            '    Next w_lngSaiyoLoop
                                                        '            'End If
                                                        '            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                        '        End If
                                                        '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                        '        'If w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                        '        '    If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G") > w_lngJikanNenkyu Then
                                                        '        '        w_TotalNightTime = w_TotalNightTime - w_lngJikanNenkyu
                                                        '        '    Else
                                                        '        '        w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G")
                                                        '        '    End If
                                                        '        '    If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                        '        '        If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H") > w_lngYokuJikanNenkyu Then
                                                        '        '            w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                        '        '        Else
                                                        '        '            w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H")
                                                        '        '        End If
                                                        '        '    End If
                                                        '        'End If

                                                        '        If w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                        '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.TotalNightTime) > w_lngJikanNenkyu Then
                                                        '                w_TotalNightTime = w_TotalNightTime - w_lngJikanNenkyu
                                                        '            Else
                                                        '                w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.TotalNightTime)
                                                        '            End If
                                                        '            '2016/10/11 K.I Upd Start------------------------------
                                                        '            'If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                        '            If w_Col <> m_4WeekKikan(w_Int).KinmuDataEndCol Then
                                                        '                '2016/10/11 K.I Upd End--------------------------------
                                                        '                If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                    w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                        '                Else
                                                        '                    w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime)
                                                        '                End If
                                                        '            End If
                                                        '            '2016/09/01 Yamanishi Add --------------------------------------------
                                                        '        ElseIf m_4WeekKikan(w_Int).EndDate = w_YYYYMMDD Then
                                                        '            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                        '                If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                        '                    If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime) > w_lngYokuJikanNenkyu Then
                                                        '                        w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                        '                    Else
                                                        '                        w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime)
                                                        '                    End If
                                                        '                End If
                                                        '            Next w_intLoop
                                                        '            '---------------------------------------------------------------------
                                                        '        End If
                                                        '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

                                                        '        w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                        '    End If
                                                        '    '-------------------------------------------------------------------------------------------------
                                                        'End If

                                                        '計算済みかどうか
                                                        If Not w_blnFinFlg Then
                                                            w_blnFinFlg = True

                                                            If w_Int = m_SelViewKikan Then
                                                                Call CalcDayNightTime(m_4WeekKikan(w_Int), w_HairetuIdx, w_YYYYMMDD,
                                                                                      p_Row, w_Col, w_KinmuCD, w_Time, w_JikanOuenFlg,
                                                                                      w_lngNikkin, w_lngYakin, w_TotalNightTime)

                                                                w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                            End If
                                                        End If
                                                        '2018/03/09 Yamanishi Upd End --------------------------------------------------------------------------------

                                                        If m_HMtrx_4Week(w_Seq).CntKbn = "4" Then
                                                            w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + w_lngNikkin
                                                        Else
                                                            w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + w_lngYakin
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    Next w_Seq
                                End If
                                '勤務が貼られていないかつ表示期間初日の場合
                            ElseIf w_Col = m_4WeekKikan(w_Int).KinmuDataStartCol Then

                                w_YYYYMMDD = m_4WeekKikan(w_Int).StartDate

                                For w_Seq = 1 To UBound(m_HMtrx_4Week)
                                    If m_HMtrx_4Week(w_Seq).CntKbn = "5" Then

                                        w_Time = ""

                                        w_HaizokuFlg = False
                                        w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                                        For w_intWorkLoop = 1 To w_intWorkCnt
                                            '2015/04/08 Yamanishi Upd ----------------------------------------------------------
                                            'If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                            If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                                '-------------------------------------------------------------------------------
                                                w_HaizokuFlg = True
                                                Exit For
                                            End If
                                        Next w_intWorkLoop

                                        w_YakanTimeFlg = False

                                        If m_YakanKangoDispFlg = 0 Then
                                            '2013/07/10 Bando Chg Start ==============================================================
                                            'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                            If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD, 10)) > 0 _
                                            AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" _
                                            OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD, 10)) > 0 _
                                            AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                                '2013/07/10 Bando Chg End   ==============================================================
                                                '対象外役職CD or 対象外職種CDの場合はカウントしない
                                            Else
                                                If w_HaizokuFlg = True Then
                                                    '2018/03/01 Yamanishi Upd ---------------------------------------------------------------------------
                                                    'If w_KangoCD = General.g_strSelKinmuDeptCD OrElse w_KangoCD = "" Then '応援勤務先が他部署の場合はカウント対象にならない
                                                    '    w_YakanTimeFlg = True
                                                    '    '2016/05/02 Yamanishi Add ---------------------------------------------------------
                                                    'Else
                                                    '    Call Get_TimeM(w_HairetuIdx, "", w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                                    '    w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                                    '    '----------------------------------------------------------------------------------
                                                    'End If
                                                    ''2016/08/31 Yamanishi Add ---------------------------------------------------------

                                                    If w_RiyuKBN <> "6" OrElse w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                        w_YakanTimeFlg = True
                                                    ElseIf General.g_UseMultiOuenFlg Then
                                                        For i As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                            If m_StaffData(w_HairetuIdx).Kojyo(i).lngDate = w_YYYYMMDD Then
                                                                For j As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(i).Seq)
                                                                    If m_StaffData(w_HairetuIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                        w_YakanTimeFlg = True
                                                                        Exit For
                                                                    End If
                                                                Next j
                                                            End If
                                                            If w_YakanTimeFlg Then Exit For
                                                        Next i
                                                    ElseIf w_JikanOuenFlg Then
                                                        w_YakanTimeFlg = True
                                                    End If
                                                    If Not w_YakanTimeFlg Then
                                                        Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                                        w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                                    End If
                                                    '----------------------------------------------------------------------------------------------------
                                                Else
                                                    w_KinmuTime2 = fncGetBeforeNextNightTime(w_HairetuIdx,
                                                        Integer.Parse(Date.Parse(w_YYYYMMDD.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")),
                                                        p_Row, w_KinmuTime3)
                                                    w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + w_KinmuTime2
                                                    If m_OuenTotalNightFullFlg = 0 Then
                                                        w_TotalNightTime = w_KinmuTime3
                                                        w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                    End If
                                                    '----------------------------------------------------------------------------------
                                                End If
                                            End If
                                        Else
                                            w_YakanTimeFlg = True
                                        End If

                                        If w_YakanTimeFlg Then
                                            '前日の翌日夜勤時間 - 時間年休を取得する
                                            '2016/04/21 Yamanishi Upd ------------------------------------------------------------------
                                            'w_KinmuTime = Get_TimeM(w_HairetuIdx, "", w_YYYYMMDD, 2, p_Row)
                                            w_KinmuTime = Get_TimeM(w_HairetuIdx, "", w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                            w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                            '-------------------------------------------------------------------------------------------
                                            w_Time1 = w_KinmuTime
                                            w_Time2 = w_PersonalGoukei(w_Int, w_Seq)
                                            w_PersonalGoukei(w_Int, w_Seq) = (w_Time1 + w_Time2)
                                        End If
                                    ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "8" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                        If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                Not m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).GetFlg Then
                                            Call GetSumCntData(w_HairetuIdx, w_Seq)
                                        End If
                                        If m_KeikakuKikan.StartDate < m_4WeekKikan(m_SelViewKikan).StartDate Then
                                            For i As Integer = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                                '----2016/06/13 Iida upd Start
                                                '夜勤時間取得用の関数に渡す日付が上書きされてしまうバグ修正(ここで同じ名前の変数を使用しているため)
                                                'w_YYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                w_GetYYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                '----2016/06/13 Iida upd End
                                                '----2016/06/13 Iida upd Start
                                                'If w_YYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                If w_GetYYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                    '----2016/06/13 Iida upd End
                                                    Exit For
                                                End If

                                                w_blnFLG2 = True

                                                If sprSheet_M.Sheets(0).Cells(p_Row, i).BackColor.Equals(Color.Black) Then
                                                    '背景色が黒の時
                                                    If w_PlanTwoFlg Then
                                                        If Not m_blnJissekiUseFlg Then
                                                            '勤務変更時 かつ 一段表示してる時の下段
                                                            '上段のデータを取得
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                            If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                w_blnFLG = True
                                                            Else
                                                                w_blnFLG = False
                                                            End If
                                                            w_blnFLG2 = False
                                                        End If
                                                    ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                        '実績変更時 かつ 二段表示してる時の上段
                                                        '下段のデータを取得
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row + 1, i)
                                                        If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                            w_blnFLG = True
                                                        Else
                                                            w_blnFLG = False
                                                        End If
                                                        w_blnFLG2 = False
                                                    End If
                                                End If

                                                If w_blnFLG2 Then
                                                    w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row, i)
                                                    If String.IsNullOrEmpty(w_KinmuData) AndAlso w_PlanTwoFlg Then
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                    End If
                                                End If

                                                w_KinmuCD2 = ""
                                                '2015/04/10 Bando Upd Start ===========================
                                                'Call Get_KinmuMark(w_KinmuData, w_KinmuCD2, "", "", "", "")
                                                Call Get_KinmuMark(w_KinmuData, w_KinmuCD2, "", "", "", "", "")
                                                '2015/04/10 Bando Upd End   ===========================

                                                If Not String.IsNullOrEmpty(w_KinmuCD2) AndAlso InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD2) > 0 Then
                                                    '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                    w_Index = InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD2) \ 4 + 1
                                                    w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_HMtrx_4Week(w_Seq).Ratio(w_Index)
                                                End If
                                            Next
                                        End If
                                        w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).Cnt
                                        '2013/07/09 Ishiga upd start-------------------------------------------------------------
                                        'ElseIf m_HMtrx(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                    ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Int, w_Seq) = 0 Then
                                        '2013/07/09 Ishiga upd end---------------------------------------------------------------
                                        If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                Not m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).GetFlg Then
                                            Call GetSumHolTimeData(w_HairetuIdx, w_Seq)
                                        End If
                                        If m_KeikakuKikan.StartDate < m_4WeekKikan(m_SelViewKikan).StartDate Then
                                            For i As Integer = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                                '----2016/06/13 Iida upd Start
                                                '夜勤時間取得用の関数に渡す日付が上書きされてしまうバグ修正(ここで同じ名前の変数を使用しているため)
                                                'w_YYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                w_GetYYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, i)
                                                '----2016/06/13 Iida upd End
                                                '----2016/06/13 Iida upd Start
                                                'If w_YYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                If w_GetYYYYMMDD = m_4WeekKikan(m_SelViewKikan).StartDate Then
                                                    '----2016/06/13 Iida upd End
                                                    Exit For
                                                End If

                                                w_blnFLG2 = True

                                                If sprSheet_M.Sheets(0).Cells(p_Row, i).BackColor.Equals(Color.Black) Then
                                                    '背景色が黒の時
                                                    If w_PlanTwoFlg Then
                                                        If Not m_blnJissekiUseFlg Then
                                                            '勤務変更時 かつ 一段表示してる時の下段
                                                            '上段のデータを取得
                                                            w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                            If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                                w_blnFLG = True
                                                            Else
                                                                w_blnFLG = False
                                                            End If
                                                            w_blnFLG2 = False
                                                        End If
                                                    ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                        '実績変更時 かつ 二段表示してる時の上段
                                                        '下段のデータを取得
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row + 1, i)
                                                        If Not String.IsNullOrEmpty(w_KinmuData) Then
                                                            w_blnFLG = True
                                                        Else
                                                            w_blnFLG = False
                                                        End If
                                                        w_blnFLG2 = False
                                                    End If
                                                End If

                                                If w_blnFLG2 Then
                                                    w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row, i)
                                                    If String.IsNullOrEmpty(w_KinmuData) AndAlso w_PlanTwoFlg Then
                                                        w_KinmuData = sprSheet_M.Sheets(0).GetText(p_Row - 1, i)
                                                    End If
                                                End If

                                                w_strTime2 = ""
                                                '2015/04/10 Bando Upd Start ====================
                                                'Call Get_KinmuMark(w_KinmuData, "", "", "", "", w_strTime2)
                                                Call Get_KinmuMark(w_KinmuData, "", "", "", "", w_strTime2, "")
                                                '2015/04/10 Bando Upd End   ====================

                                                w_strTime = w_strTime2
                                                While w_strTime <> ""
                                                    w_strTime2 = General.paLeft(w_strTime, 28)
                                                    w_strTime = Mid(w_strTime, 29)

                                                    '実働時間減算対象時間休稼動かを判定
                                                    For j As Integer = 1 To UBound(m_SumHolTimeData_4W)
                                                        If m_SumHolTimeData_4W(j).SEQ = w_Seq Then
                                                            If InStr(m_SumHolTimeData_4W(j).CD, Mid(w_strTime2, 1, 2)) > 0 Then
                                                                w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + Integer.Parse(Mid(w_strTime2, 12, 4))
                                                            End If
                                                            Exit For
                                                        End If
                                                    Next
                                                End While
                                            Next
                                        End If
                                        w_PersonalGoukei(w_Int, w_Seq) = w_PersonalGoukei(w_Int, w_Seq) + m_StaffData(w_HairetuIdx).SumCntData_4W(m_SelViewKikan).SumSeq(w_Seq).Cnt
                                    End If
                                Next w_Seq
                            End If
                        End If
                        'End If '2015/04/08 Yamanishi Del
                    Next w_Int
                Next w_Col

                '---------------------------
                '   ４週個人別集計表示
                '---------------------------
                For w_Int = 1 To UBound(m_4WeekKikan)
                    'If w_Int = m_SelViewKikan Then '2015/04/08 Yamanishi Del

                    w_TotalTime = 0
                    w_TotalTime_N = 0
                    w_Seq = 1

                    For w_Col = m_4WeekKikan(w_Int).PersonalStartCol To m_4WeekKikan(w_Int).PersonalEndCol
                        If UBound(m_HMtrx_4Week) >= w_Seq Then
                            '集計欄の表示形式により分岐
                            If m_HMtrx_4Week(w_Seq).CntKbn = "1" OrElse
                                    m_HMtrx_4Week(w_Seq).CntKbn = "6" OrElse
                                    m_HMtrx_4Week(w_Seq).CntKbn = "8" Then
                                If m_PersonalTotalSet = 0 Then
                                    w_Var = Convert.ToString(w_PersonalGoukei(w_Int, w_Seq))
                                Else
                                    w_Var = Format(w_PersonalGoukei(w_Int, w_Seq), "#0.0")
                                End If
                            Else

                                w_str = (w_PersonalGoukei(w_Int, w_Seq) \ 60) & "." & Format(w_PersonalGoukei(w_Int, w_Seq) Mod 60, "00")
                                w_Var = Format(Single.Parse(w_str), "#0.00")

                                If m_YakanKangoDispFlg = 0 Then
                                    '夜勤時間
                                    If m_HMtrx_4Week(w_Seq).CntKbn = "5" Then
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_KangoIdx = w_Int + 1
                                        Else
                                            w_KangoIdx = w_Int
                                        End If

                                        'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                        '2013/07/10 Bando Chg Start ==============================================================
                                        If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD, 10)) > 0 _
                                        AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" _
                                       OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD, 10)) > 0 _
                                        AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                            '2013/07/10 Bando Chg End   ==============================================================
                                            '対象外役職CD or 対象外職種CDの場合ｽﾌﾟﾚｯﾄﾞ設定を変更
                                            w_Var = "― "
                                        Else
                                            '総時間加算
                                            If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                                            Else
                                                w_TotalTime = w_TotalTime + Double.Parse(w_Var) '個人別総時間に加算
                                            End If
                                        End If
                                    End If

                                    '日勤時間
                                    If m_HMtrx_4Week(w_Seq).CntKbn = "4" Then
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_KangoIdx = w_Int + 1
                                        Else
                                            w_KangoIdx = w_Int
                                        End If
                                        '2013/07/10 Bando Chg Start ==============================================================
                                        'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                        If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD, 10)) > 0 _
                                        AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).PostCD <> "" _
                                       OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD, 10)) > 0 _
                                        AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(w_KangoIdx).JobCD <> "" Then
                                            '2013/07/10 Bando Chg End   ==============================================================
                                            '対象外役職CD or 対象外職種CDの場合ｽﾌﾟﾚｯﾄﾞ設定を変更
                                            w_Var = "― "
                                        Else
                                            '総時間加算
                                            If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                                            Else
                                                w_TotalTime_N = w_TotalTime_N + Double.Parse(w_Var) '個人別総時間に加算
                                            End If
                                        End If
                                    End If
                                End If
                            End If

                            '合計値 設定
                            .SetText(p_Row, w_Col, w_Var)
                            '次の配列へ
                            w_Seq = w_Seq + 1
                        End If
                    Next w_Col

                    If w_Int = m_SelViewKikan Then '2015/04/08 Yamanishi Del
                        '固定Spread個人別集計表示
                        w_Seq = 1
                        For w_Col = m_4WeekKikan(w_Int).KoteiStartCol To m_4WeekKikan(w_Int).KoteiEndCol
                            If w_Seq <= UBound(m_HMtrx_4Week) Then

                                '集計欄の表示形式により分岐
                                If m_HMtrx_4Week(w_Seq).CntKbn = "1" OrElse
                                        m_HMtrx_4Week(w_Seq).CntKbn = "6" OrElse
                                        m_HMtrx_4Week(w_Seq).CntKbn = "8" Then
                                    If m_PersonalTotalSet = 0 Then
                                        w_Var = Convert.ToString(w_PersonalGoukei(w_Int, w_Seq))
                                    Else
                                        w_Var = Format(w_PersonalGoukei(w_Int, w_Seq), "#0.0")
                                    End If
                                Else
                                    w_str = (w_PersonalGoukei(w_Int, w_Seq) \ 60) & "." & Format(w_PersonalGoukei(w_Int, w_Seq) Mod 60, "00")
                                    w_Var = Format(Single.Parse(w_str), "#0.00")
                                End If

                                '合計値 設定
                                sprPTotal.Sheets(0).SetText(p_Row, w_Col, w_Var)
                                '次の配列へ
                                w_Seq = w_Seq + 1
                            End If
                        Next w_Col

                        '夜間看護加算用
                        'もし４週期間が選択されていたら
                        If cmbKikan.SelectedIndex > 0 Then
                            If w_Int = m_SelViewKikan Then
                                '夜間看護加算結果(画面右下)の計算用変数に格納
                                If m_YakanKangoDispFlg = 0 Then
                                    If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                                    Else
                                        '2016/04/21 Yamanishi Upd -----------------------------------------------------------------------------------
                                        'Call Calc_YakanKango(w_HairetuIdx, w_TotalTime, 1, w_Int, w_TotalTime_N, w_blnOuenFlg)
                                        If m_Youshiki9_H28_Flg = 0 Then
                                            Call Calc_YakanKango(w_HairetuIdx, w_TotalTime, 1, w_Int, w_TotalTime_N, w_blnOuenFlg)
                                        Else
                                            Call Calc_YakanKango2(w_HairetuIdx, w_TotalTime,
                                                Double.Parse((w_SumTotalNightTime \ 60) & "." & Format(w_SumTotalNightTime Mod 60, "00")), 1, w_Int)
                                        End If
                                        '------------------------------------------------------------------------------------------------------------
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next w_Int

                '最終職員の場合、夜間看護加算計算
                If m_YakanKangoDispFlg = 0 Then
                    If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                    ElseIf (m_StaffRow.EndRow - m_StaffRow.StartRow) \ m_MaxShowLine = (p_Row - m_StaffRow.StartRow) \ m_MaxShowLine Then
                        'もし４週期間が選択されていたら
                        If cmbKikan.SelectedIndex > 0 Then
                            Call Set_KangoKasanTotalData()
                        End If
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '計画期間個人別集計 計算実行
    Private Sub RunReCalc_PUser(ByVal p_Row As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_PUser"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Seq2 As Integer
        Dim w_Index As Integer
        Dim w_PersonalGoukei() As Single
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_KangoCD As String = String.Empty
        Dim w_From_Col() As Integer
        Dim w_To_Col() As Integer
        Dim w_Int2 As Integer
        Dim w_HairetuIdx As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_TotalTime As Double '個人別総時間
        Dim w_TotalTime_N As Double
        Dim w_YYYYMMDD As Integer '年月日
        Dim w_Hour1 As Integer
        Dim w_Min1 As Integer
        Dim w_Time1 As Integer
        Dim w_Time2 As Integer
        Dim w_KinmuTime As Integer
        Dim w_str As String
        Dim w_blnFLG As Boolean
        Dim w_PlanTwoFlg As Boolean
        Dim w_YakanTimeFlg As Boolean
        Dim w_intLoop As Integer
        Dim w_lngLoop1 As Integer
        Dim w_DaikyuLoop As Integer
        Dim w_DaikyuPossibleCnt As Double '代休取得可能日数
        Dim w_dblWorkNum As Double
        Dim w_intWorkCnt As Integer
        Dim w_intWorkLoop As Integer
        Dim w_strTime As String
        Dim w_lngJikanNenkyu As Integer
        Dim w_lngYokuJikanNenkyu As Integer
        Dim w_SaiyoCD As String = String.Empty
        'Dim w_lngSaiyoLoop As Integer '2018/03/08 Yamanishi Del
        Dim w_blnOuenFlg As Boolean
        Dim w_lngNikkinCalcTime As Integer
        'Dim w_Time_bk As String '2018/03/08 Yamanishi Del
        Dim w_JikanOuenFlg As Boolean
        Dim w_KojyoBunruiCD() As Calc_CD_Type
        Dim w_HoliDayBunruiCD() As Calc_CD_Type
        Dim w_Var2 As Object
        Dim w_Var3 As Object
        Dim w_blnFinFlg As Boolean
        Dim w_KinmuTime2 As Integer
        Dim w_lngNikkin As Integer
        Dim w_lngYakin As Integer
        Dim w_lngYokuYakin As Integer '2016/11/10 K.I Add
        '2016/04/21 Yamanishi Add ------------------------------------------------------------------
        Dim w_KinmuTime3 As Integer
        Dim w_TotalNightTime As Integer
        Dim w_SumTotalNightTime As Integer
        '-------------------------------------------------------------------------------------------
        '2018/03/08 Yamanishi Add ---------------------
        Dim w_BunruiCD As String = String.Empty
        Dim w_NenkyuTime As Integer
        '----------------------------------------------
        Try
            '実働時間減算対象控除
            w_str = m_JitsudouGensanTaishouKoujo
            w_Var = m_ArrayJitsudouGensanTaishouKoujo

            ReDim w_KojyoBunruiCD(UBound(w_Var) + 1)

            For w_Int = 0 To UBound(w_Var)
                w_Var2 = General.paSplit(w_Var(w_Int), ";")
                w_str = w_Var2(0)
                w_KojyoBunruiCD(w_Int + 1).strKBN = w_Var2(1)
                w_Var3 = General.paSplit(w_str, "+")
                For w_Int2 = 0 To UBound(w_Var3)
                    w_KojyoBunruiCD(w_Int + 1).strCD = w_KojyoBunruiCD(w_Int + 1).strCD & String.Format("{0, 2}", w_Var3(w_Int2)) & ","
                Next w_Int2
            Next w_Int

            '実働時間減算対象時間休
            w_str = m_JitsudouGensanTaishouJikanKyu
            w_Var = m_ArrayJitsudouGensanTaishouJikanKyu

            If w_str = "" Then
                ReDim w_Var(-1)
            End If

            ReDim w_HoliDayBunruiCD(UBound(w_Var) + 1)

            For w_Int = 0 To UBound(w_Var)
                w_Var2 = General.paSplit(w_Var(w_Int), ";")
                w_str = w_Var2(0)
                w_HoliDayBunruiCD(w_Int + 1).strKBN = w_Var2(1)
                w_Var3 = General.paSplit(w_str, "+")
                For w_Int2 = 0 To UBound(w_Var3)
                    w_HoliDayBunruiCD(w_Int + 1).strCD = w_HoliDayBunruiCD(w_Int + 1).strCD & String.Format("{0, 2}", w_Var3(w_Int2)) & ","
                Next w_Int2
            Next w_Int

            w_blnOuenFlg = False

            m_intProcessKikan = 0

            '合計行ある ?
            If UBound(m_HMtrx) <= 0 Then
                '最終職員の場合
                If (m_StaffRow.EndRow - m_StaffRow.StartRow) \ m_MaxShowLine = (p_Row - m_StaffRow.StartRow) \ m_MaxShowLine Then
                    '一ヶ月の場合
                    If cmbKikan.SelectedIndex = 0 Then
                        m_TotalTime = 0
                        m_YakinJujiCnt = 0
                        Call Set_KangoKasanTotalData()
                    End If
                End If

                Exit Sub
            End If

            If (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                w_PlanTwoFlg = True
            ElseIf (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                w_PlanTwoFlg = False
            Else
                Exit Sub
            End If

            If m_SelViewKikan <> 0 Then
                Exit Sub
            End If

            '初期化
            If m_StaffRow.StartRow = p_Row Then
                m_TotalTime = 0
                m_YakinJujiCnt = 0
            End If

            w_TotalTime = 0

            With m_Spread(1).Sheets(0)

                w_Var = .GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    w_HairetuIdx = Integer.Parse(w_Var)
                End If

                ReDim w_From_Col(UBound(m_StaffData(w_HairetuIdx).IdoData))
                ReDim w_To_Col(UBound(m_StaffData(w_HairetuIdx).IdoData))

                For w_Int = 1 To UBound(m_StaffData(w_HairetuIdx).IdoData)
                    '年月日から配属日/転出日の列番号 取得
                    If Get_Col_M(m_StaffData(w_HairetuIdx).IdoData(w_Int).IdoYMD, w_From_Col(w_Int)) = False Then
                        w_From_Col(w_Int) = M_KinmuData_Col
                    End If
                    If Get_Col_M(m_StaffData(w_HairetuIdx).IdoData(w_Int).SyuryoYMD, w_To_Col(w_Int)) = False Then
                        w_To_Col(w_Int) = m_KeikakuKikan.KinmuDataEndCol
                    End If
                Next w_Int

                '合計値 配列変数 定義
                ReDim w_PersonalGoukei(UBound(m_HMtrx))

                '********************************
                '     代休取得可能日数の取得
                '********************************
                w_DaikyuPossibleCnt = 0
                '該当職員の代休情報件数分ループする
                For w_DaikyuLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Daikyu)
                    '代休集計期間かどうか？
                    If m_lngDaikyuStartDate_Cnt <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_lngDaikyuEndDate_Cnt Then
                        w_dblWorkNum = 0
                        '代休発生量を判断
                        Select Case m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).GetKbn
                            Case "0"
                                w_dblWorkNum = 1
                            Case "1"
                                w_dblWorkNum = 1.5
                        End Select

                        '代休集計期間
                        If m_KeikakuKikan.StartDate <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_KeikakuKikan.EndDate Then
                            '代休集計期間内かつ、計画期間内の場合・・・
                            '代休の未使用分を加算
                            w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                        Else
                            '代休集計期間内かつ、計画期間外の場合・・・

                            '代休の未使用分を加算
                            With m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop)
                                If Double.Parse(.OutPutList) = 1 AndAlso UBound(.DaikyuDetail) = 0 Then
                                Else
                                    w_dblWorkNum = .RemainderHol
                                    For w_Seq = 1 To UBound(.DaikyuDetail)
                                        If m_KeikakuKikan.StartDate <= .DaikyuDetail(w_Seq).DaikyuDate AndAlso .DaikyuDetail(w_Seq).DaikyuDate <= m_KeikakuKikan.EndDate Then
                                            Select Case .DaikyuDetail(w_Seq).GetFlg
                                                Case "0"
                                                    '１日
                                                    w_dblWorkNum = w_dblWorkNum + 1
                                                Case "1"
                                                    '半日
                                                    w_dblWorkNum = w_dblWorkNum + 0.5
                                            End Select
                                        End If
                                    Next w_Seq
                                End If
                            End With
                            w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                        End If
                    End If
                Next w_DaikyuLoop

                '代休区分の集計配列に代休取得可能日数を格納する
                For w_Seq = 1 To UBound(m_HMtrx)
                    If m_HMtrx(w_Seq).CntKbn = "6" Then
                        w_PersonalGoukei(w_Seq) = w_DaikyuPossibleCnt
                    End If
                Next w_Seq

                '計画勤務ﾃﾞｰﾀの列数繰り返し
                For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    '初期化
                    w_HaizokuFlg = False
                    w_lngJikanNenkyu = 0
                    w_lngYokuJikanNenkyu = 0

                    w_lngNikkinCalcTime = 0

                    '----2016/06/24 Iida add Start
                    '//夜勤時間計算結果非表示の場合は計算処理を行わないように修正
                    If m_YakanKangoDispFlg = 0 Then
                        '----2016/06/24 Iida add End
                        '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                        w_SumTotalNightTime = w_SumTotalNightTime +
                                Calc_NotZaikinTotalNight(w_HairetuIdx, .GetText(M_YYYYMMDDLabel_Row, w_Col), p_Row,
                                    m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD,
                                    m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD,
                                    w_Col = m_KeikakuKikan.KinmuDataEndCol)
                        '追加仕様：応援者・月中異動者の総夜勤を全部出す-----------------------------------------------
                        '----2016/06/24 Iida add Start
                    End If
                    '----2016/06/24 Iida add End

                    w_Var = .GetText(p_Row, w_Col)
                    If w_Var <> "" Then
                        w_blnFLG = True
                    ElseIf w_PlanTwoFlg Then
                        w_Var = .GetText(p_Row - 1, w_Col)
                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    Else
                        w_blnFLG = False
                    End If

                    If w_blnFLG Then
                        '2015/04/10 Bando Upd Start =============================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                        '2015/04/10 Bando Upd End   =============================

                        If w_RiyuKBN = "6" Then
                            w_blnOuenFlg = True
                        End If

                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                        If w_Var <> "" Then
                            w_YYYYMMDD = Integer.Parse(w_Var)
                        End If

                        If Trim(w_KinmuCD) = "" Then
                        Else

                            w_blnFinFlg = False
                            w_lngNikkin = 0
                            w_lngYakin = 0
                            w_lngYokuYakin = 0 '2016/11/10 K.I Add
                            w_TotalNightTime = 0 '2016/04/21 Yamanishi Add

                            '配属チェック
                            w_HaizokuFlg = False
                            w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                            For w_intWorkLoop = 1 To w_intWorkCnt
                                '2015/04/08 Yamanishi Upd ----------------------------------------------------------
                                'If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                    '-------------------------------------------------------------------------------
                                    w_HaizokuFlg = True
                                    Exit For
                                End If
                            Next w_intWorkLoop

                            '個人別集計項目数分 繰り返し
                            For w_Seq = 1 To UBound(m_HMtrx)
                                If m_HMtrx(w_Seq).CntKbn = "8" AndAlso w_PersonalGoukei(w_Seq) = 0 Then
                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                        Not m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).GetFlg Then
                                        Call GetSumCntData(w_HairetuIdx, w_Seq)
                                    End If
                                    w_PersonalGoukei(w_Seq) = m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).Cnt
                                End If

                                If m_HMtrx(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Seq) = 0 Then
                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                        Not m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).GetFlg Then
                                        Call GetSumHolTimeData(w_HairetuIdx, w_Seq)
                                    End If
                                    w_PersonalGoukei(w_Seq) = m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).Cnt
                                End If

                                '集計対象勤務？
                                If w_HaizokuFlg = True AndAlso InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 Then
                                    '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                    w_Index = InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                    If m_HMtrx(w_Seq).CntKbn <> "6" Then
                                        w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_HMtrx(w_Seq).Ratio(w_Index)
                                    Else
                                        w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) - m_HMtrx(w_Seq).Ratio(w_Index)
                                    End If
                                End If

                                '労働時間（応援勤務者を除く）
                                If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                    If m_HMtrx(w_Seq).CntKbn = "2" Then
                                        If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" AndAlso w_HaizokuFlg = True Then
                                            w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                            w_Hour1 = w_KinmuTime \ 100
                                            w_Min1 = w_KinmuTime Mod 100

                                            w_Time1 = (w_Hour1 * 60) + w_Min1
                                            w_Time2 = w_PersonalGoukei(w_Seq)

                                            '個人別時間年休を計算する
                                            w_strTime = w_Time
                                            'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                            If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                                While w_strTime <> ""
                                                    '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                                    'w_Time = General.paLeft(w_strTime, 28)
                                                    'w_strTime = Mid(w_strTime, 29)

                                                    ''実働時間減算対象時間休稼動かを判定
                                                    'For w_Int2 = 1 To UBound(w_HoliDayBunruiCD)
                                                    '    If InStr(w_HoliDayBunruiCD(w_Int2).strCD, Mid(w_Time, 1, 2)) > 0 Then
                                                    '        w_Time1 = w_Time1 - TimeRound(Integer.Parse(Mid(w_Time, 12, 4)), w_HoliDayBunruiCD(w_Int2).strKBN)
                                                    '    End If
                                                    'Next w_Int2

                                                    w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                                    '実働時間減算対象時間休稼動かを判定
                                                    For i As Integer = 1 To UBound(w_HoliDayBunruiCD)
                                                        If InStr(w_HoliDayBunruiCD(i).strCD, w_BunruiCD) > 0 Then
                                                            w_Time1 = w_Time1 - TimeRound(w_NenkyuTime, w_HoliDayBunruiCD(i).strKBN)
                                                        End If
                                                    Next i
                                                    '------------------------------------------------------------------------------------------------------
                                                End While
                                            End If

                                            'w_Time = w_Time_bk '2018/03/08 Yamanishi Del

                                            '控除時間を考慮する
                                            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                '現在のセルのデータのみ計算
                                                If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                    For w_lngLoop1 = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime)
                                                        '実働時間減算対象時間休稼動かを判定
                                                        For w_Int2 = 1 To UBound(w_KojyoBunruiCD)
                                                            If InStr(w_KojyoBunruiCD(w_Int2).strCD, String.Format("{0, 2}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_lngLoop1))) > 0 Then
                                                                w_Time1 = w_Time1 - TimeRound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime(w_lngLoop1), w_KojyoBunruiCD(w_Int2).strKBN)
                                                            End If
                                                        Next w_Int2
                                                    Next w_lngLoop1
                                                End If
                                            Next w_intLoop

                                            If w_Time1 > 0 Then
                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                        End If
                                        '累計時間
                                    ElseIf m_HMtrx(w_Seq).CntKbn = "3" Then
                                        If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                            w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                            w_Hour1 = w_KinmuTime \ 100
                                            w_Min1 = w_KinmuTime Mod 100

                                            w_Time1 = (w_Hour1 * 60) + w_Min1
                                            w_Time2 = w_PersonalGoukei(w_Seq)

                                            '個人別時間年休を計算する
                                            w_strTime = w_Time
                                            'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                            If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                                While w_strTime <> ""
                                                    '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                                    'w_Time = General.paLeft(w_strTime, 28)
                                                    'w_strTime = Mid(w_strTime, 29)

                                                    ''実働時間減算対象時間休稼動かを判定
                                                    'For w_Int2 = 1 To UBound(w_HoliDayBunruiCD)
                                                    '    If InStr(w_HoliDayBunruiCD(w_Int2).strCD, Mid(w_Time, 1, 2)) > 0 Then
                                                    '        w_Time1 = w_Time1 - TimeRound(Integer.Parse(Mid(w_Time, 12, 4)), w_HoliDayBunruiCD(w_Int2).strKBN)
                                                    '    End If
                                                    'Next w_Int2

                                                    w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                                    '実働時間減算対象時間休稼動かを判定
                                                    For i As Integer = 1 To UBound(w_HoliDayBunruiCD)
                                                        If InStr(w_HoliDayBunruiCD(i).strCD, w_BunruiCD) > 0 Then
                                                            w_Time1 = w_Time1 - TimeRound(w_NenkyuTime, w_HoliDayBunruiCD(i).strKBN)
                                                        End If
                                                    Next i
                                                    '------------------------------------------------------------------------------------------------------
                                                End While
                                            End If

                                            'w_Time = w_Time_bk '2018/03/08 Yamanishi Del

                                            '控除時間を考慮する
                                            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                '現在のセルのデータのみ計算
                                                If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                    '夜勤時間を合計
                                                    For w_lngLoop1 = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime)
                                                        '実働時間減算対象時間休稼動かを判定
                                                        For w_Int2 = 1 To UBound(w_KojyoBunruiCD)
                                                            If InStr(w_KojyoBunruiCD(w_Int2).strCD, String.Format("{0, 2}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_lngLoop1))) > 0 Then
                                                                w_Time1 = w_Time1 - TimeRound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngKinmuDetailTime(w_lngLoop1), w_KojyoBunruiCD(w_Int2).strKBN)
                                                            End If
                                                        Next w_Int2
                                                    Next w_lngLoop1
                                                End If
                                            Next w_intLoop

                                            If w_Time1 > 0 Then
                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                        End If
                                    ElseIf m_HMtrx(w_Seq).CntKbn = "9" Then
                                        '個人別時間年休を計算する
                                        w_strTime = w_Time
                                        'w_Time_bk = w_Time '2018/03/08 Yamanishi Del
                                        While w_strTime <> ""
                                            '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                                            'w_Time = General.paLeft(w_strTime, 28)
                                            'w_strTime = Mid(w_strTime, 29)

                                            ''実働時間減算対象時間休稼動かを判定
                                            'For i As Integer = 1 To UBound(m_SumHolTimeData)
                                            '    If m_SumHolTimeData(i).SEQ = w_Seq Then
                                            '        If InStr(m_SumHolTimeData(i).CD, Mid(w_Time, 1, 2)) > 0 Then
                                            '            w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + Integer.Parse(Mid(w_Time, 12, 4))
                                            '        End If
                                            '        Exit For
                                            '    End If
                                            'Next

                                            w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_NenkyuTime)

                                            '実働時間減算対象時間休稼動かを判定
                                            For i As Integer = 1 To UBound(m_SumHolTimeData)
                                                If m_SumHolTimeData(i).SEQ = w_Seq Then
                                                    If InStr(m_SumHolTimeData(i).CD, w_BunruiCD) > 0 Then
                                                        w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + w_NenkyuTime
                                                    End If
                                                    Exit For
                                                End If
                                            Next i
                                            '------------------------------------------------------------------------------------------------------
                                        End While

                                        'w_Time = w_Time_bk '2018/03/08 Yamanishi Del
                                    End If
                                End If

                                If w_HaizokuFlg = True Then
                                    If (m_OuenKinmuCalcFlg = 0 AndAlso m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0")) OrElse m_OuenKinmuCalcFlg = 1 Then
                                        w_JikanOuenFlg = False

                                        '応援先が登録されている場合で、控除データが存在するデータは、時間応援データを含む
                                        'If w_KangoCD <> "" Then
                                        If w_RiyuKBN = "6" Then '2018/03/01 Yamanishi Upd
                                            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate AndAlso UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime) > 0 Then
                                                    w_JikanOuenFlg = True
                                                End If
                                            Next w_intLoop
                                        End If

                                        '日勤時間・夜勤時間
                                        If m_HMtrx(w_Seq).CntKbn = "4" OrElse m_HMtrx(w_Seq).CntKbn = "5" Then
                                            w_YakanTimeFlg = False
                                            If m_YakanKangoDispFlg = 0 Then
                                                '2013/07/10 Bando Chg Start ==============================================================
                                                'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                                If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD, 10)) > 0 _
                                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" _
                                                OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD, 10)) > 0 _
                                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                                    '2013/07/10 Bando Chg End   ==============================================================
                                                    '対象外役職CD or 対象外職種CDの場合はカウントしない
                                                Else
                                                    If w_HaizokuFlg = True Then
                                                        '2018/03/01 Yamanishi Upd Start ---------------------------------------------------------------------------
                                                        'If w_KangoCD = General.g_strSelKinmuDeptCD OrElse w_KangoCD = "" Then '応援勤務先が他部署の場合はカウント対象にならない
                                                        '    w_YakanTimeFlg = True
                                                        '    '2016/05/02 Yamanishi Add ---------------------------------------------------------
                                                        'ElseIf w_JikanOuenFlg = False AndAlso w_blnFinFlg = False Then
                                                        '    '2016/07/28 Yamanishi Upd -----------------------------------------------------------------------
                                                        '    '//期間開始日が全日応援であると、前日の翌夜勤時間が取れてこないのを修正
                                                        '    'Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, , w_KinmuTime3)
                                                        '    Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3)
                                                        '    If w_YYYYMMDD = m_KeikakuKikan.StartDate Then
                                                        '        If m_HMtrx(w_Seq).CntKbn = "4" Then
                                                        '            For w_Seq2 = w_Seq + 1 To UBound(m_HMtrx)
                                                        '                If m_HMtrx(w_Seq2).CntKbn = "5" Then Exit For
                                                        '            Next w_Seq2
                                                        '        Else
                                                        '            w_Seq2 = w_Seq
                                                        '        End If
                                                        '        If w_Seq2 <= UBound(m_HMtrx) Then
                                                        '            w_PersonalGoukei(w_Seq2) = w_PersonalGoukei(w_Seq2) + w_KinmuTime2 _
                                                        '                - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) _
                                                        '                - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                        '        End If
                                                        '    End If
                                                        '    '------------------------------------------------------------------------------------------------
                                                        '    w_TotalNightTime = w_KinmuTime3
                                                        '    w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                        '    w_blnFinFlg = True
                                                        '    '----------------------------------------------------------------------------------
                                                        'End If

                                                        If w_RiyuKBN <> "6" OrElse w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                            w_YakanTimeFlg = True
                                                        ElseIf General.g_UseMultiOuenFlg Then
                                                            For i As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                                If m_StaffData(w_HairetuIdx).Kojyo(i).lngDate = w_YYYYMMDD Then
                                                                    For j As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(i).Seq)
                                                                        If m_StaffData(w_HairetuIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                            w_YakanTimeFlg = True
                                                                            Exit For
                                                                        End If
                                                                    Next j
                                                                End If
                                                                If w_YakanTimeFlg Then Exit For
                                                            Next i
                                                        ElseIf w_JikanOuenFlg Then
                                                            w_YakanTimeFlg = True
                                                        End If

                                                        If Not (w_YakanTimeFlg OrElse w_JikanOuenFlg OrElse w_blnFinFlg) Then
                                                            Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3)

                                                            If m_KeikakuKikan.StartDate = w_YYYYMMDD Then
                                                                If m_HMtrx(w_Seq).CntKbn = "4" Then
                                                                    For w_Seq2 = w_Seq + 1 To UBound(m_HMtrx)
                                                                        If m_HMtrx(w_Seq2).CntKbn = "5" Then Exit For
                                                                    Next w_Seq2
                                                                Else
                                                                    w_Seq2 = w_Seq
                                                                End If

                                                                If w_Seq2 <= UBound(m_HMtrx) Then
                                                                    w_PersonalGoukei(w_Seq2) = w_PersonalGoukei(w_Seq2) + w_KinmuTime2 _
                                                                        - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) _
                                                                        - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                                End If
                                                            End If

                                                            w_TotalNightTime = w_KinmuTime3
                                                            w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                            w_blnFinFlg = True
                                                        End If
                                                        '2018/03/01 Yamanishi Upd End -----------------------------------------------------------------------------
                                                        '時間応援の場合も計算処理を行う
                                                        If w_JikanOuenFlg Then
                                                            w_YakanTimeFlg = True
                                                        End If
                                                    End If
                                                End If
                                            Else
                                                w_YakanTimeFlg = True
                                            End If

                                            If w_YakanTimeFlg = True Then
                                                '2018/03/09 Yamanishi Upd Start ------------------------------------------------------------------------------
                                                ''計算済みかどうか
                                                'If w_blnFinFlg = False Then

                                                '    w_blnFinFlg = True

                                                '    'w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2)
                                                '    w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 3, p_Row, w_KinmuTime2, w_KinmuTime3) '2016/04/21 Yamanishi Upd

                                                '    '個人別時間年休を計算する
                                                '    w_strTime = w_Time
                                                '    w_Time_bk = w_Time

                                                '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                                '        While w_strTime <> ""
                                                '            w_Time = General.paLeft(w_strTime, 28)
                                                '            w_strTime = Mid(w_strTime, 29)

                                                '            '日勤時間
                                                '            w_lngNikkinCalcTime = w_lngNikkinCalcTime + (Integer.Parse(Mid(w_Time, 17, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 17, 4)) Mod 100)
                                                '            '当日夜勤時間
                                                '            w_lngJikanNenkyu = w_lngJikanNenkyu + (Integer.Parse(Mid(w_Time, 21, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 21, 4)) Mod 100)
                                                '            '翌日夜勤時間
                                                '            w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + (Integer.Parse(Mid(w_Time, 25, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 25, 4)) Mod 100)
                                                '        End While
                                                '    End If

                                                '    w_Time = w_Time_bk

                                                '    '控除時間を考慮する
                                                '    For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                '        '現在のセルのデータのみ計算
                                                '        If w_YYYYMMDD = m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngDate Then
                                                '            '日勤時間を合計
                                                '            For w_lngLoop1 = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime)
                                                '                If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_lngLoop1))) > 0 Then
                                                '                    w_lngNikkinCalcTime = w_lngNikkinCalcTime + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime(w_lngLoop1) \ 100) * 60 + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngNikkinTime(w_lngLoop1) Mod 100)
                                                '                End If
                                                '            Next w_lngLoop1

                                                '            '夜勤時間を合計
                                                '            For w_lngLoop1 = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime)
                                                '                If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_lngLoop1))) > 0 Then
                                                '                    w_lngJikanNenkyu = w_lngJikanNenkyu + Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_lngLoop1)), 2)) + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_lngLoop1) - Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYakinTime(w_lngLoop1)), 2))) / 100 * 60
                                                '                End If
                                                '            Next w_lngLoop1

                                                '            '翌日夜勤時間を合計
                                                '            For w_lngLoop1 = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime)
                                                '                If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).strKinmuDetailCD(w_lngLoop1))) > 0 Then
                                                '                    w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_lngLoop1)), 2)) + (m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_lngLoop1) - Integer.Parse(General.paRight(Convert.ToString(m_StaffData(w_HairetuIdx).Kojyo(w_intLoop).lngYokuYakinTime(w_lngLoop1)), 2))) / 100 * 60
                                                '                End If
                                                '            Next w_lngLoop1
                                                '        End If
                                                '    Next w_intLoop

                                                '    If w_lngNikkinCalcTime <> 0 OrElse w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                '        'For w_lngSaiyoLoop = 1 To UBound(m_StaffData(w_HairetuIdx).SaiyoData)
                                                '        '    If m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).SaiyoDate <= w_YYYYMMDD AndAlso m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).TentaiDate >= w_YYYYMMDD Then

                                                '        '        w_SaiyoCD = m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop).SaiyoCD
                                                '        '        If Convert.ToString(m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "A")) = "" Then
                                                '        '            w_SaiyoCD = "00000"
                                                '        '        End If
                                                '        '        Exit For
                                                '        '    End If
                                                '        'Next w_lngSaiyoLoop

                                                '        ''日勤時間
                                                '        'If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B") > w_lngNikkinCalcTime Then
                                                '        '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                '        '        w_lngNikkin = w_lngNikkinCalcTime
                                                '        '    Else
                                                '        '        w_lngNikkin = w_KinmuTime - w_lngNikkinCalcTime
                                                '        '    End If
                                                '        'Else
                                                '        '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                '        '        w_lngNikkin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B")
                                                '        '    Else
                                                '        '        w_lngNikkin = w_KinmuTime - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "B")
                                                '        '    End If
                                                '        'End If

                                                '        ''夜勤時間
                                                '        'If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("1") AndAlso w_JikanOuenFlg Then
                                                '        '    If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C") > w_lngJikanNenkyu Then
                                                '        '        w_lngYakin = w_lngJikanNenkyu
                                                '        '    Else
                                                '        '        w_lngYakin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C")
                                                '        '    End If

                                                '        '    If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '        '        If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D") > w_lngYokuJikanNenkyu Then
                                                '        '            w_lngYakin = w_lngYokuJikanNenkyu
                                                '        '        Else
                                                '        '            w_lngYakin = m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D")
                                                '        '        End If
                                                '        '    End If
                                                '        'Else
                                                '        '    w_lngYakin = w_KinmuTime2

                                                '        '    If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C") > w_lngJikanNenkyu Then
                                                '        '        w_lngYakin = w_lngYakin - w_lngJikanNenkyu
                                                '        '    Else
                                                '        '        w_lngYakin = w_lngYakin - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "C")
                                                '        '    End If

                                                '        '    If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '        '        If m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D") > w_lngYokuJikanNenkyu Then
                                                '        '            w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                '        '        Else
                                                '        '            w_lngYakin = w_lngYakin - m_objGetTimeM.Item(w_SaiyoCD & w_KinmuCD & "D")
                                                '        '        End If
                                                '        '    End If
                                                '        'End If

                                                '        '日勤時間
                                                '        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime) > w_lngNikkinCalcTime Then
                                                '            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                '                w_lngNikkin = w_lngNikkinCalcTime
                                                '            Else
                                                '                w_lngNikkin = w_KinmuTime - w_lngNikkinCalcTime
                                                '            End If
                                                '        Else
                                                '            If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                '                w_lngNikkin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime)
                                                '            Else
                                                '                w_lngNikkin = w_KinmuTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.DayTime)
                                                '            End If
                                                '        End If

                                                '        '夜勤時間
                                                '        If m_StaffData(w_HairetuIdx).OuenStaffFlg = 1 AndAlso w_JikanOuenFlg Then
                                                '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) > w_lngJikanNenkyu Then
                                                '                w_lngYakin = w_lngJikanNenkyu
                                                '            Else
                                                '                w_lngYakin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime)
                                                '            End If

                                                '            If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '                If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                '                    '----2016/06/28 Iida upd Start
                                                '                    '//時間応援の当日夜勤時間が夜勤総時間に加算されてないバグ修正
                                                '                    'w_lngYakin = w_lngYokuJikanNenkyu
                                                '                    w_lngYakin = w_lngYakin + w_lngYokuJikanNenkyu
                                                '                    '----2016/06/28 Iida upd End
                                                '                Else
                                                '                    '----2016/06/28 Iida upd Start
                                                '                    '//時間応援の当日夜勤時間が夜勤総時間に加算されてないバグ修正
                                                '                    'w_lngYakin = GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                '                    w_lngYakin = w_lngYakin + GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                '                    '----2016/06/28 Iida upd End
                                                '                End If
                                                '                '2016/09/01 Yamanishi Add --------------------------------------------
                                                '            ElseIf m_KeikakuKikan.EndDate = w_YYYYMMDD Then
                                                '                For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                '                    If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                '                        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                '                            w_lngYakin = w_lngYakin + w_lngYokuJikanNenkyu
                                                '                        Else
                                                '                            w_lngYakin = w_lngYakin + GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                '                        End If
                                                '                    End If
                                                '                Next w_intLoop
                                                '                '---------------------------------------------------------------------
                                                '            End If
                                                '            '2016/11/10 K.I Add Start-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                '            If m_KeikakuKikan.StartDate = w_YYYYMMDD Then
                                                '                w_lngYokuYakin = fncGetBeforeNextNightTime(w_HairetuIdx, Integer.Parse(Date.Parse(w_YYYYMMDD.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")), p_Row, w_lngYokuYakin)
                                                '                w_lngYakin = w_lngYakin + w_lngYokuYakin
                                                '            End If
                                                '            '2016/11/10 K.I Add End-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                '        Else
                                                '            w_lngYakin = w_KinmuTime2
                                                '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime) > w_lngJikanNenkyu Then

                                                '                w_lngYakin = w_lngYakin - w_lngJikanNenkyu
                                                '            Else
                                                '                w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NightTime)
                                                '            End If

                                                '            If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '                If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                '                    w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                '                Else
                                                '                    w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                '                End If
                                                '                '2016/09/01 Yamanishi Add --------------------------------------------
                                                '            ElseIf m_KeikakuKikan.EndDate = w_YYYYMMDD Then
                                                '                For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                '                    If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                '                        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime) > w_lngYokuJikanNenkyu Then
                                                '                            w_lngYakin = w_lngYakin - w_lngYokuJikanNenkyu
                                                '                        Else
                                                '                            w_lngYakin = w_lngYakin - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextNightTime)
                                                '                        End If
                                                '                    End If
                                                '                Next w_intLoop
                                                '                '---------------------------------------------------------------------
                                                '            End If
                                                '        End If
                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

                                                '    Else
                                                '        If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") OrElse w_JikanOuenFlg = False Then
                                                '            w_lngNikkin = w_KinmuTime
                                                '            w_lngYakin = w_KinmuTime2
                                                '        End If
                                                '    End If
                                                '    '2016/04/21 Yamanishi Add ------------------------------------------------------------------------
                                                '    w_TotalNightTime = w_KinmuTime3

                                                '    If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 Then
                                                '        '控除時間を考慮する（応援控除や計算対象外の控除にあたる場合は戻しておく）
                                                '        For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                '            With m_StaffData(w_HairetuIdx).Kojyo(w_intLoop)
                                                '                '現在のセルのデータのみ計算
                                                '                If w_YYYYMMDD = .lngDate Then
                                                '                    For w_lngLoop1 = 1 To UBound(.strKinmuDetailCD)
                                                '                        '必要なデータを元に戻す
                                                '                        If InStr(m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD, General.paFormatSpace(.strKinmuDetailCD(w_lngLoop1), 10)) > 0 Then
                                                '                            '夜勤時間を戻す
                                                '                            w_lngJikanNenkyu = w_lngJikanNenkyu - ((.lngYakinTime(w_lngLoop1) \ 100) * 60 + (.lngYakinTime(w_lngLoop1) Mod 100))
                                                '                            '翌日夜勤時間を戻す
                                                '                            w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu - ((.lngYokuYakinTime(w_lngLoop1) \ 100) * 60 + (.lngYokuYakinTime(w_lngLoop1) Mod 100))
                                                '                        End If
                                                '                    Next w_lngLoop1
                                                '                End If
                                                '            End With
                                                '        Next w_intLoop
                                                '    Else
                                                '        '当日夜勤時間
                                                '        w_lngJikanNenkyu = 0
                                                '        '翌日夜勤時間
                                                '        w_lngYokuJikanNenkyu = 0

                                                '        If w_JikanOuenFlg Then
                                                '            '個人別時間年休を計算する
                                                '            w_strTime = w_Time
                                                '            w_Time_bk = w_Time

                                                '            While w_strTime <> ""
                                                '                w_Time = General.paLeft(w_strTime, 28)
                                                '                w_strTime = Mid(w_strTime, 29)

                                                '                '当日夜勤時間
                                                '                w_lngJikanNenkyu = w_lngJikanNenkyu + (Integer.Parse(Mid(w_Time, 21, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 21, 4)) Mod 100)
                                                '                '翌日夜勤時間
                                                '                w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + (Integer.Parse(Mid(w_Time, 25, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 25, 4)) Mod 100)
                                                '            End While
                                                '            w_Time = w_Time_bk

                                                '            '控除時間を考慮する
                                                '            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                '                With m_StaffData(w_HairetuIdx).Kojyo(w_intLoop)
                                                '                    '現在のセルのデータのみ計算
                                                '                    If w_YYYYMMDD = .lngDate Then
                                                '                        For w_lngLoop1 = 1 To UBound(.strKinmuDetailCD)
                                                '                            '必要なデータをよりわけ
                                                '                            If InStr(m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD, General.paFormatSpace(.strKinmuDetailCD(w_lngLoop1), 10)) = 0 Then
                                                '                                '夜勤時間を合計
                                                '                                w_lngJikanNenkyu = w_lngJikanNenkyu + ((.lngYakinTime(w_lngLoop1) \ 100) * 60 + (.lngYakinTime(w_lngLoop1) Mod 100))
                                                '                                '翌日夜勤時間を合計
                                                '                                w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + ((.lngYokuYakinTime(w_lngLoop1) \ 100) * 60 + (.lngYokuYakinTime(w_lngLoop1) Mod 100))
                                                '                            End If
                                                '                        Next w_lngLoop1
                                                '                    End If
                                                '                End With
                                                '            Next w_intLoop
                                                '        End If

                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                '        'If w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                '        '    For w_lngSaiyoLoop = 1 To UBound(m_StaffData(w_HairetuIdx).SaiyoData)
                                                '        '        With m_StaffData(w_HairetuIdx).SaiyoData(w_lngSaiyoLoop)
                                                '        '            If .SaiyoDate <= w_YYYYMMDD AndAlso w_YYYYMMDD <= .TentaiDate Then
                                                '        '                w_SaiyoCD = .SaiyoCD
                                                '        '                If Not m_objGetTimeM.ContainsKey(w_SaiyoCD & w_KinmuCD & "A") Then
                                                '        '                    w_SaiyoCD = "00000"
                                                '        '                End If
                                                '        '                Exit For
                                                '        '            End If
                                                '        '        End With
                                                '        '    Next w_lngSaiyoLoop
                                                '        'End If
                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                '    End If

                                                '    If w_lngJikanNenkyu <> 0 OrElse w_lngYokuJikanNenkyu <> 0 Then
                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                                '        'If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G") > w_lngJikanNenkyu Then
                                                '        '    w_TotalNightTime = w_TotalNightTime - w_lngJikanNenkyu
                                                '        'Else
                                                '        '    w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "G")
                                                '        'End If
                                                '        'If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '        '    If m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H") > w_lngYokuJikanNenkyu Then
                                                '        '        w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                '        '    Else
                                                '        '        w_TotalNightTime = w_TotalNightTime - m_objGetTimeM(w_SaiyoCD & w_KinmuCD & "H")
                                                '        '    End If
                                                '        'End If

                                                '        If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.TotalNightTime) > w_lngJikanNenkyu Then
                                                '            w_TotalNightTime = w_TotalNightTime - w_lngJikanNenkyu
                                                '        Else
                                                '            w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.TotalNightTime)
                                                '        End If
                                                '        If w_Col <> m_KeikakuKikan.KinmuDataEndCol Then
                                                '            If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime) > w_lngYokuJikanNenkyu Then
                                                '                w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                '            Else
                                                '                w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime)
                                                '            End If
                                                '            '2016/09/01 Yamanishi Add --------------------------------------------
                                                '        ElseIf m_KeikakuKikan.EndDate = w_YYYYMMDD Then
                                                '            For w_intLoop = 1 To UBound(m_StaffData(w_HairetuIdx).IdoHistory)
                                                '                If m_StaffData(w_HairetuIdx).IdoHistory(w_intLoop).SyuryoYMD = w_YYYYMMDD Then
                                                '                    If GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime) > w_lngYokuJikanNenkyu Then
                                                '                        w_TotalNightTime = w_TotalNightTime - w_lngYokuJikanNenkyu
                                                '                    Else
                                                '                        w_TotalNightTime = w_TotalNightTime - GetKinmuTime(w_KinmuCD, w_HairetuIdx, w_YYYYMMDD, gKinmuTimeMCol.NextTotalNightTime)
                                                '                    End If
                                                '                End If
                                                '            Next w_intLoop
                                                '            '---------------------------------------------------------------------
                                                '        End If
                                                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

                                                '    End If

                                                '    w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                '    '-------------------------------------------------------------------------------------------------
                                                'End If

                                                '計算済みかどうか
                                                If Not w_blnFinFlg Then
                                                    w_blnFinFlg = True

                                                    Call CalcDayNightTime(m_KeikakuKikan, w_HairetuIdx, w_YYYYMMDD,
                                                                          p_Row, w_Col, w_KinmuCD, w_Time, w_JikanOuenFlg,
                                                                          w_lngNikkin, w_lngYakin, w_TotalNightTime)

                                                    w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                                End If
                                                '2018/03/09 Yamanishi Upd End --------------------------------------------------------------------------------

                                                If m_HMtrx(w_Seq).CntKbn = "4" Then
                                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + w_lngNikkin
                                                Else
                                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + w_lngYakin
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            Next w_Seq
                        End If
                        '勤務が貼られていないかつ初日の場合
                    ElseIf w_Col = m_KeikakuKikan.KinmuDataStartCol Then

                        w_YYYYMMDD = m_KeikakuKikan.StartDate

                        For w_Seq = 1 To UBound(m_HMtrx)
                            If m_HMtrx(w_Seq).CntKbn = "5" Then

                                w_HaizokuFlg = False
                                w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                                For w_intWorkLoop = 1 To w_intWorkCnt
                                    If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= m_KeikakuKikan.StartDate AndAlso m_KeikakuKikan.StartDate <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_intWorkLoop

                                w_YakanTimeFlg = False

                                If m_YakanKangoDispFlg = 0 Then
                                    '2013/07/10 Bando Chg Start ==============================================================
                                    'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                    If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD, 10)) > 0 _
                                    AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" _
                                    OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD, 10)) > 0 _
                                    AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                        '2013/07/10 Bando Chg End   ==============================================================
                                        '対象外役職CD or 対象外職種CDの場合はカウントしない
                                    Else
                                        If w_HaizokuFlg = True Then
                                            '2018/03/01 Yamanishi Upd ---------------------------------------------------------------------------
                                            'If w_KangoCD = General.g_strSelKinmuDeptCD OrElse w_KangoCD = "" Then '応援勤務先が他部署の場合はカウント対象にならない
                                            '    w_YakanTimeFlg = True
                                            '    '2016/05/02 Yamanishi Add ---------------------------------------------------------
                                            'Else
                                            '    Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                            '    w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                            '    '----------------------------------------------------------------------------------
                                            'End If
                                            ''2016/08/31 Yamanishi Add ---------------------------------------------------------

                                            If w_RiyuKBN <> "6" OrElse w_KangoCD = General.g_strSelKinmuDeptCD Then
                                                w_YakanTimeFlg = True
                                            ElseIf General.g_UseMultiOuenFlg Then
                                                For i As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo)
                                                    If m_StaffData(w_HairetuIdx).Kojyo(i).lngDate = w_YYYYMMDD Then
                                                        For j As Integer = 1 To UBound(m_StaffData(w_HairetuIdx).Kojyo(i).Seq)
                                                            If m_StaffData(w_HairetuIdx).Kojyo(i).OuenKinmuDeptCD(j) = General.g_strSelKinmuDeptCD Then
                                                                w_YakanTimeFlg = True
                                                                Exit For
                                                            End If
                                                        Next j
                                                    End If
                                                    If w_YakanTimeFlg Then Exit For
                                                Next i
                                            ElseIf w_JikanOuenFlg Then
                                                w_YakanTimeFlg = True
                                            End If
                                            If Not w_YakanTimeFlg Then
                                                Call Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                                w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                            End If
                                            '----------------------------------------------------------------------------------------------------
                                        Else
                                            w_KinmuTime2 = fncGetBeforeNextNightTime(w_HairetuIdx,
                                                Integer.Parse(Date.Parse(w_YYYYMMDD.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd")),
                                                p_Row, w_KinmuTime3)
                                            w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + w_KinmuTime2
                                            If m_OuenTotalNightFullFlg = 0 Then
                                                w_TotalNightTime = w_KinmuTime3
                                                w_SumTotalNightTime = w_SumTotalNightTime + w_TotalNightTime
                                            End If
                                            '----------------------------------------------------------------------------------
                                        End If
                                    End If
                                Else
                                    w_YakanTimeFlg = True
                                End If

                                If w_YakanTimeFlg Then
                                    '2016/04/21 Yamanishi Upd ------------------------------------------------------------------
                                    'w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2, p_Row)
                                    w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2, p_Row, , w_KinmuTime3)
                                    w_SumTotalNightTime = w_SumTotalNightTime + w_KinmuTime3
                                    '-------------------------------------------------------------------------------------------
                                    w_Time1 = w_KinmuTime
                                    w_Time2 = w_PersonalGoukei(w_Seq)
                                    w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                End If
                            ElseIf m_HMtrx(w_Seq).CntKbn = "8" AndAlso w_PersonalGoukei(w_Seq) = 0 Then
                                If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                    Not m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).GetFlg Then
                                    Call GetSumCntData(w_HairetuIdx, w_Seq)
                                End If
                                w_PersonalGoukei(w_Seq) = m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).Cnt
                            ElseIf m_HMtrx(w_Seq).CntKbn = "9" AndAlso w_PersonalGoukei(w_Seq) = 0 Then
                                If m_StaffData(w_HairetuIdx).OuenStaffFlg = 0 AndAlso
                                                    Not m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).GetFlg Then
                                    Call GetSumHolTimeData(w_HairetuIdx, w_Seq)
                                End If
                                w_PersonalGoukei(w_Seq) = m_StaffData(w_HairetuIdx).SumCntData.SumSeq(w_Seq).Cnt
                            End If
                        Next w_Seq
                    End If
                Next w_Col

                '---------------------------
                '   計画期間個人別集計表示
                '---------------------------
                w_Seq = 1
                For w_Col = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                    If m_HMtrx(w_Seq).CntKbn = "1" OrElse
                            m_HMtrx(w_Seq).CntKbn = "6" OrElse
                            m_HMtrx(w_Seq).CntKbn = "8" Then
                        '集計欄の表示形式により分岐
                        If m_PersonalTotalSet = 0 Then
                            w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                        Else
                            w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                        End If
                    Else
                        If m_HMtrx(w_Seq).CntKbn = "3" Then
                            If m_JissekiRuikeiFlg = False Then
                                w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_StaffData(w_HairetuIdx).RuikeiTime
                            Else
                                w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_StaffData(w_HairetuIdx).RuikeiTime + m_StaffData(w_HairetuIdx).RuikeiTime_Jisseki
                            End If
                        End If

                        w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & Format(w_PersonalGoukei(w_Seq) Mod 60, "00")
                        w_Var = Format(Single.Parse(w_str), "#0.00")

                        If m_YakanKangoDispFlg = 0 Then
                            '夜勤時間
                            If m_HMtrx(w_Seq).CntKbn = "5" Then
                                '2013/07/10 Bando Chg Start ==============================================================
                                'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD, 10)) > 0 _
                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" _
                                OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD, 10)) > 0 _
                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                    '2013/07/10 Bando Chg End   ==============================================================
                                    '対象外役職CD or 対象外職種CDの場合ｽﾌﾟﾚｯﾄﾞ設定を変更
                                    w_Var = "― "
                                Else
                                    '総時間加算
                                    If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                                    Else
                                        w_TotalTime = w_TotalTime + Double.Parse(w_Var) '個人別総時間に加算
                                    End If
                                End If
                            End If

                            '日勤時間
                            If m_HMtrx(w_Seq).CntKbn = "4" Then
                                '2013/07/10 Bando Chg Start ==============================================================
                                'If InStr(m_NotCntPostCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" OrElse InStr(m_NotCntJobCD, m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD) > 0 AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                If InStr(m_NotCntPostCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD, 10)) > 0 _
                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).PostCD <> "" _
                                OrElse InStr(m_NotCntJobCD, General.paFormatSpace(m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD, 10)) > 0 _
                                AndAlso m_StaffData(w_HairetuIdx).KangoKasanData(1).JobCD <> "" Then
                                    '2013/07/10 Bando Chg End   ==============================================================
                                    '対象外役職CD or 対象外職種CDの場合ｽﾌﾟﾚｯﾄﾞ設定を変更
                                    w_Var = "― "
                                Else
                                    '総時間加算
                                    If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                                    Else
                                        w_TotalTime_N = w_TotalTime_N + Double.Parse(w_Var) '個人別総時間に加算
                                    End If
                                End If
                            End If

                        End If
                    End If

                    '合計値 設定
                    .SetText(p_Row, w_Col, w_Var)
                    '次の配列へ
                    w_Seq = w_Seq + 1
                Next w_Col

                '固定Spread個人別集計表示
                w_Seq = 1
                For w_Col = m_KeikakuKikan.KoteiStartCol To m_KeikakuKikan.KoteiEndCol

                    If m_HMtrx(w_Seq).CntKbn = "1" OrElse
                            m_HMtrx(w_Seq).CntKbn = "6" OrElse
                            m_HMtrx(w_Seq).CntKbn = "8" Then
                        '集計欄の表示形式により分岐
                        If m_PersonalTotalSet = 0 Then
                            w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                        Else
                            w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                        End If
                    Else
                        w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & Format(w_PersonalGoukei(w_Seq) Mod 60, "00")
                        w_Var = Format(Single.Parse(w_str), "#0.00")
                    End If

                    '合計値 設定
                    sprPTotal.Sheets(0).SetText(p_Row, w_Col, w_Var)
                    '次の配列へ
                    w_Seq = w_Seq + 1
                Next w_Col

                '固定Spread個人別集計（夜間看護加算）
                '4週/1ヶ月の場合はﾘｽﾄｲﾝﾃﾞｯｸｽが0　もしくは　1ヶ月/1ヶ月 4週/4週の場合
                If cmbKikan.SelectedIndex <= 0 OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then

                    '夜間看護加算結果(画面右下)の計算用変数に格納
                    If m_YakanKangoDispFlg = 0 Then
                        If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                        Else
                            '2016/04/21 Yamanishi Upd -----------------------------------------------------------------------------------
                            'Call Calc_YakanKango(w_HairetuIdx, w_TotalTime, 0, 1, w_TotalTime_N, w_blnOuenFlg)
                            If m_Youshiki9_H28_Flg = 0 Then
                                Call Calc_YakanKango(w_HairetuIdx, w_TotalTime, 0, 1, w_TotalTime_N, w_blnOuenFlg)
                            Else
                                Call Calc_YakanKango2(w_HairetuIdx, w_TotalTime,
                                    Double.Parse((w_SumTotalNightTime \ 60) & "." & Format(w_SumTotalNightTime Mod 60, "00")), 0, 1)
                            End If
                            '------------------------------------------------------------------------------------------------------------
                        End If
                    End If
                End If

                '自動ﾁｪｯｸの場合のみ
                If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                    '================================================
                    '   個人別 ｴﾗｰﾁｪｯｸ
                    '================================================
                    If w_PlanTwoFlg = False Then
                        '勤務変更の上段を計算しているとき
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            Call Check_PersonalCalc(p_Row, True)
                        Else
                            Call Check_PersonalCalc(p_Row, False)
                        End If
                    End If
                End If

                '最終職員の場合、夜間看護加算計算
                If m_YakanKangoDispFlg = 0 Then
                    If m_blnJissekiUseFlg <> w_PlanTwoFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '予定の集計欄((二段表示してる時の上段　または　一段表示してる時の下段) かつ　勤務変更時) は総時間に加算しない
                    ElseIf (m_StaffRow.EndRow - m_StaffRow.StartRow) \ m_MaxShowLine = (p_Row - m_StaffRow.StartRow) \ m_MaxShowLine Then
                        '4週/1ヶ月の場合はﾘｽﾄｲﾝﾃﾞｯｸｽが0　もしくは　1ヶ月/1ヶ月 4週/4週の場合
                        If cmbKikan.SelectedIndex = 0 OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                            Call Set_KangoKasanTotalData()
                        End If
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '累計取得対象期間を取得
    Private Sub Get_TargetNo()

        Const W_SUBNAME As String = "NSK0000HA Get_TargetNo"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Start_F As ADODB.Field
        Dim w_End_F As ADODB.Field
        Dim w_SPlanNo_F As ADODB.Field '年度始めの計画番号
        Dim w_KStartlng As Integer
        Dim w_KEndlng As Integer
        Dim w_KEndDate As Date
        Dim w_YYYY As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_STargetNo As Integer '取得対象計画番号(開始)
        Dim w_ETargetNo As Integer '取得対象計画番号(終了)
        Try
            '計画制御Ｆから計画番号の期間を取得
            'RICHARD UPDATE START
            'w_Sql = "SELECT PLANPERIODFROM, PLANPERIODTO FROM NS_PLANCONTROL_F "
            'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "AND PLANNO = " & m_PlanNo & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANCONTROL_F_01(w_Rs, m_PlanNo) '<19>
            'RICHARD UPDATE END

            If w_Rs.RecordCount <= 0 Then
                '計画制御が取得できない場合(ありえない)
                m_RuikeiStartNo = 0
                m_RuikeiEndNo = 0
                Exit Sub
            Else
                '必ず１件になる
                With w_Rs

                    .MoveFirst()

                    w_Start_F = .Fields("PlanPeriodFrom")
                    w_End_F = .Fields("PlanPeriodTo")

                    w_KStartlng = IIf(IsDBNull(w_Start_F.Value), 0, w_Start_F.Value)
                    w_KEndlng = IIf(IsDBNull(w_End_F.Value), 0, w_End_F.Value)

                    If w_KEndlng <> 0 Then
                        w_KEndDate = Date.Parse(Format(w_KEndlng, "0000/00/00"))
                    End If
                End With
            End If

            w_Rs = Nothing

            '取得した計画期間終了日の日付(MM/DD)が0401より小さい場合は年から１引く(年度のため)
            If IsDate(w_KEndDate) = True Then
                If Integer.Parse(Format(w_KEndDate, "MMdd")) < 401 Then
                    w_YYYY = Integer.Parse(Format(w_KEndDate, "yyyy")) - 1
                Else
                    w_YYYY = Integer.Parse(Format(w_KEndDate, "yyyy"))
                End If
            End If

            '対象年を計算できない場合は処理抜け出し
            If w_YYYY = 0 Then
                Exit Sub
            End If

            '計算された年の４月１日を含む計画番号からを年度始めとする(４週の場合は３月の日も含まれることになる)
            w_YYYYMMDD = Integer.Parse(w_YYYY & "0401")
            'RICHARD UPDATE START
            'w_Sql = "SELECT MIN(PLANNO) AS MIN_PLAN FROM NS_PLANCONTROL_F"
            'w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " AND PLANPERIODFROM <= " & w_KEndlng
            'w_Sql = w_Sql & " AND PLANPERIODTO >= " & w_YYYYMMDD
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANCONTROL_F_02(w_Rs, w_KEndlng, w_YYYYMMDD) '<20>
            'RICHARD UPDATE END

            If w_Rs.RecordCount <= 0 Then
                m_RuikeiStartNo = 0
                m_RuikeiEndNo = 0
                Exit Sub
            Else
                '必ず１件になる
                With w_Rs
                    .MoveFirst()

                    w_SPlanNo_F = .Fields("MIN_PLAN")
                    w_STargetNo = IIf(IsDBNull(w_SPlanNo_F.Value), 0, w_SPlanNo_F.Value)
                End With
            End If

            w_Rs = Nothing

            '取得対象計画番号(終了)
            w_ETargetNo = m_PlanNo - 2

            '実績期間の時間を累計するかどうかのﾌﾗｸﾞ
            If (m_PlanNo - 1) < w_STargetNo Then
                m_JissekiRuikeiFlg = False
            Else
                m_JissekiRuikeiFlg = True
            End If

            'もし対象期間終了番号の方が小さい場合
            If w_ETargetNo < w_STargetNo Then
                m_RuikeiStartNo = 0
                m_RuikeiEndNo = 0
                Exit Sub
            Else
                m_RuikeiStartNo = w_STargetNo
                m_RuikeiEndNo = w_ETargetNo
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '勤務時間を取得(採用条件・看護単位CD・共通の優先順)
    '2016/04/21 Yamanishi Upd ------------------------------------------------------------------------------------------------------------------------------------
    'Private Function Get_TimeM(ByVal p_StaffIdx As Integer, ByVal p_KinmuCD As String, ByVal p_Date As Integer, ByVal p_CountFLG As Integer, Optional ByVal p_Row As Integer = 0, Optional ByRef p_Night As Integer = 0) As Integer
    Private Function Get_TimeM(ByVal p_StaffIdx As Integer, ByVal p_KinmuCD As String,
                               ByVal p_Date As Integer, ByVal p_CountFLG As Integer,
                               Optional ByVal p_Row As Integer = 0,
                               Optional ByRef p_Night As Integer = 0,
                               Optional ByRef p_TotalNight As Integer = 0) As Integer
        '---------------------------------------------------------------------------------------------------------------------------------------------------------
        Const W_SUBNAME As String = "NSK0000HA Get_TimeM"

        Dim w_Int As Integer
        'Dim w_Int2 As Integer '2016/08/30 Yamanishi Del
        Dim w_SaiyoCD As String = String.Empty
        Dim w_intFlg As Integer
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_PreKinmuCD As String
        Dim w_StartDate2 As Integer
        Dim w_PreKinmuTime As Integer
        Dim w_Var As Object
        '2016/08/30 Yamanishi Del ------------------------------------------------------------------
        'Dim w_Time As String = String.Empty
        'Dim w_strTime As String
        'Dim w_lngYokuJikanNenkyu As Integer
        'Dim w_lngSaiyoLoop As Integer
        ''Dim w_CheckSaiyoCD() As String 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
        'Dim w_lngSaiyoCnt As Integer
        '-------------------------------------------------------------------------------------------
        Dim w_lngTentaiDate As Integer
        Dim w_lngIdoDate As Integer
        Dim w_BeforNextNightTime As Integer
        '2016/04/21 Yamanishi Add ------------------------------------------------------------------
        Dim w_BeforNextTotalNightTime As Integer
        w_BeforNextTotalNightTime = 0
        '-------------------------------------------------------------------------------------------

        w_lngTentaiDate = 0
        w_BeforNextNightTime = 0

        Get_TimeM = 0
        Try
            For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).SaiyoData)
                If m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoDate <= p_Date AndAlso m_StaffData(p_StaffIdx).SaiyoData(w_Int).TentaiDate >= p_Date Then

                    w_SaiyoCD = m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoCD
                    Exit For
                End If
            Next w_Int

            '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------
            ''異動した場合の対応
            'For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).IdoData)
            '    If m_StaffData(p_StaffIdx).IdoData(w_Int).IdoYMD <= p_Date AndAlso m_StaffData(p_StaffIdx).IdoData(w_Int).SyuryoYMD >= p_Date Then
            '        w_lngIdoDate = m_StaffData(p_StaffIdx).IdoData(w_Int).SyuryoYMD
            '        Exit For
            '    End If
            'Next w_Int

            For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).IdoHistory)
                If m_StaffData(p_StaffIdx).IdoHistory(w_Int).IdoYMD <= p_Date AndAlso p_Date <= m_StaffData(p_StaffIdx).IdoHistory(w_Int).SyuryoYMD Then
                    w_lngIdoDate = m_StaffData(p_StaffIdx).IdoHistory(w_Int).SyuryoYMD
                    Exit For
                End If
            Next w_Int
            '追加仕様：応援者・月中異動者の総夜勤を全部出す---------------------------------------------------------

            If m_StaffData(p_StaffIdx).blnEndDayChangeFlg = True Then
                w_lngIdoDate = 99999999
            End If

            w_intFlg = 0

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month AndAlso m_intProcessKikan <> 0 Then
                w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, m_4WeekKikan(m_intProcessKikan).KinmuDataStartCol)
                If w_Var <> "" Then
                    w_StartDate = Integer.Parse(w_Var)
                End If

                w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, m_4WeekKikan(m_intProcessKikan).KinmuDataEndCol)
                If w_Var <> "" Then
                    w_EndDate = Integer.Parse(w_Var)
                End If
            Else
                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, m_KeikakuKikan.KinmuDataStartCol)
                If w_Var <> "" Then
                    w_StartDate = Integer.Parse(w_Var)
                End If

                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, m_KeikakuKikan.KinmuDataEndCol)
                If w_Var <> "" Then
                    w_EndDate = Integer.Parse(w_Var)
                End If
            End If

            w_StartDate2 = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(w_StartDate, "0000/00/00"))), "yyyyMMdd"))

            w_intFlg = 0
            w_PreKinmuTime = 0
            w_PreKinmuCD = ""

            If p_Date = w_StartDate Then
                w_intFlg = 1

                w_BeforNextNightTime = fncGetBeforeNextNightTime(p_StaffIdx, w_StartDate2, p_Row, w_BeforNextTotalNightTime) '2016/08/30 Yamanishi Add
                '2016/08/30 Yamanishi Del Start ----------------------------------------------------------------------------
                ''追加仕様：応援者・月中異動者の総夜勤を全部出す----------------------------------------------------
                'If w_PreKinmuCD = "" AndAlso m_OuenTotalNightFullFlg = 1 AndAlso w_SaiyoCD <> "" Then
                '    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).IdoHistory)
                '        If m_StaffData(p_StaffIdx).IdoHistory(w_Int).IdoYMD <= w_StartDate2 AndAlso _
                '           w_StartDate2 <= m_StaffData(p_StaffIdx).IdoHistory(w_Int).SyuryoYMD Then

                '            For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).BeforeKinmuData)
                '                If m_StaffData(p_StaffIdx).BeforeKinmuData(w_Int2).Date_Renamed = w_StartDate2 Then
                '                    w_PreKinmuCD = m_StaffData(p_StaffIdx).BeforeKinmuData(w_Int2).KinmuCD
                '                    '----2016/07/08 Iida add Start
                '                    Exit For
                '                    '----2016/07/08 Iida add End
                '                End If
                '                '----2016/07/08 Iida del Start
                '                'ここにExit Forを入れるとループの１回目で必ず抜けるため上記IF文に移動
                '                'Exit For
                '                '----2016/07/08 Iida del End
                '            Next w_Int2
                '            Exit For
                '        End If
                '    Next w_Int
                'End If
                ''追加仕様：応援者・月中異動者の総夜勤を全部出す----------------------------------------------------

                'If w_PreKinmuCD <> "" Then
                '    'w_BeforNextNightTime = fncGetBeforeNextNightTime(p_StaffIdx, w_PreKinmuCD, w_StartDate2)
                '    w_BeforNextNightTime = fncGetBeforeNextNightTime(p_StaffIdx, w_PreKinmuCD, w_StartDate2, w_BeforNextTotalNightTime) '2016/04/21 Yamanishi Upd

                '    '翌日夜勤時間から時間年休を減算する
                '    w_strTime = w_Time

                '    While w_strTime <> ""
                '        w_Time = General.paLeft(w_strTime, 28)
                '        w_strTime = Mid(w_strTime, 29)

                '        '翌日夜勤時間
                '        w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + (Integer.Parse(Mid(w_Time, 25, 4)) \ 100) * 60 + (Integer.Parse(Mid(w_Time, 25, 4)) Mod 100)
                '    End While

                '    '控除時間を考慮する
                '    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Kojyo)
                '        If w_StartDate2 = m_StaffData(p_StaffIdx).Kojyo(w_Int).lngDate Then
                '            '翌日夜勤時間を合計
                '            For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime)
                '                w_lngYokuJikanNenkyu = w_lngYokuJikanNenkyu + Integer.Parse(General.paRight(Convert.ToString(m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_Int2)), 2)) + (m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_Int2) - Integer.Parse(General.paRight(Convert.ToString(m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_Int2)), 2))) / 100 * 60
                '            Next w_Int2
                '        End If
                '    Next w_Int

                '    If w_lngYokuJikanNenkyu <> 0 Then
                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                '        'For w_lngSaiyoLoop = 1 To UBound(m_StaffData(p_StaffIdx).SaiyoData)
                '        '    If m_StaffData(p_StaffIdx).SaiyoData(w_lngSaiyoLoop).SaiyoDate <= w_StartDate2 AndAlso m_StaffData(p_StaffIdx).SaiyoData(w_lngSaiyoLoop).TentaiDate >= w_StartDate2 Then
                '        '        w_SaiyoCD = m_StaffData(p_StaffIdx).SaiyoData(w_lngSaiyoLoop).SaiyoCD
                '        '        If Convert.ToString(m_objGetTimeM.Item(w_SaiyoCD & w_PreKinmuCD & "A")) = "" Then
                '        '            w_SaiyoCD = "00000"
                '        '        End If
                '        '        Exit For
                '        '    End If
                '        'Next w_lngSaiyoLoop

                '        'If m_objGetTimeM.Item(w_SaiyoCD & w_PreKinmuCD & "D") > w_lngYokuJikanNenkyu Then
                '        '    w_BeforNextNightTime = w_BeforNextNightTime - w_lngYokuJikanNenkyu
                '        'Else
                '        '    w_BeforNextNightTime = w_BeforNextNightTime - m_objGetTimeM.Item(w_SaiyoCD & w_PreKinmuCD & "D")
                '        'End If
                '        ''2016/04/21 Yamanishi Add ------------------------------------------------------------------------------------
                '        'w_Var = w_SaiyoCD & w_PreKinmuCD
                '        'If m_objGetTimeM(w_Var & "H") > w_lngYokuJikanNenkyu Then
                '        '    w_BeforNextTotalNightTime -= w_lngYokuJikanNenkyu
                '        'Else
                '        '    w_BeforNextTotalNightTime -= m_objGetTimeM(w_Var & "D")
                '        'End If
                '        ''-------------------------------------------------------------------------------------------------------------
                '        If GetKinmuTime(w_PreKinmuCD, p_StaffIdx, w_StartDate2, gKinmuTimeMCol.TotalNightTime) > w_lngYokuJikanNenkyu Then
                '            w_BeforNextNightTime = w_BeforNextNightTime - w_lngYokuJikanNenkyu
                '        Else
                '            w_BeforNextNightTime = w_BeforNextNightTime - GetKinmuTime(w_PreKinmuCD, p_StaffIdx, w_StartDate2, gKinmuTimeMCol.TotalNightTime)
                '        End If
                '        If GetKinmuTime(w_PreKinmuCD, p_StaffIdx, w_StartDate2, gKinmuTimeMCol.NextTotalNightTime) > w_lngYokuJikanNenkyu Then
                '            w_BeforNextTotalNightTime = w_BeforNextTotalNightTime - w_lngYokuJikanNenkyu


                '        Else
                '            w_BeforNextTotalNightTime = w_BeforNextTotalNightTime - GetKinmuTime(w_PreKinmuCD, p_StaffIdx, w_StartDate2, gKinmuTimeMCol.NextTotalNightTime)
                '        End If
                '        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                '    End If
                'End If
                '2016/08/30 Yamanishi Del End ------------------------------------------------------------------------------
            ElseIf p_Date = w_lngTentaiDate Then
                '月中に退職した日の場合
                w_intFlg = 0
            ElseIf p_Date = w_lngIdoDate Then
                '月中に異動した日の場合
                w_intFlg = 0
            ElseIf p_Date = w_EndDate Then
                w_intFlg = 2
            End If

            If w_SaiyoCD <> "" Then
                'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                'ReDim w_CheckSaiyoCD(2)
                ''勤務時間取得の優先順位を決定
                ''*** 採用CDを第一優先
                'w_CheckSaiyoCD(1) = w_SaiyoCD
                ''*** 共通を第二優先
                'w_CheckSaiyoCD(2) = "00000"

                'w_lngSaiyoCnt = 0
                'For w_lngSaiyoLoop = 1 To UBound(w_CheckSaiyoCD)
                '    If m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoLoop) & p_KinmuCD & "A") IsNot Nothing Then
                '        If m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoLoop) & p_KinmuCD & "A").ToString <> "" Then
                '            w_lngSaiyoCnt = w_lngSaiyoLoop
                '            Exit For
                '        End If
                '    End If
                'Next w_lngSaiyoLoop
                'If w_lngSaiyoCnt <> 0 Then
                If p_KinmuCD <> "" Then
                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                    Select Case p_CountFLG
                        Case 0
                            '実勤務時間
                            'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "A")
                            Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.WorkTimeNum) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
                        Case 1
                            '日勤時間
                            'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "B")
                            Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.DayTime) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
                        Case 2
                            Select Case w_intFlg
                                Case 0
                                    '夜勤時間+翌日夜勤時間
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                    'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C") + m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "D")
                                    Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime)
                                    Get_TimeM = Get_TimeM + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                Case 1
                                    '夜勤時間+翌日夜勤時間+前月最終日翌日夜勤時間
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                    'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C") + m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "D") + w_BeforNextNightTime
                                    Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime)
                                    Get_TimeM = Get_TimeM + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                                    Get_TimeM = Get_TimeM + w_BeforNextNightTime
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                Case 2
                                    '夜勤時間
                                    'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C")
                                    Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
                            End Select
                        Case 3
                            '日勤時間
                            'Get_TimeM = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "B")
                            Get_TimeM = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.DayTime) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
                            Select Case w_intFlg
                                Case 0
                                    '夜勤時間+翌日夜勤時間
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                    'p_Night = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C") + m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "D")
                                    p_Night = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime)
                                    p_Night = p_Night + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                Case 1
                                    '夜勤時間+翌日夜勤時間+前月最終日翌日夜勤時間
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                    'p_Night = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C") + m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "D") + w_BeforNextNightTime
                                    p_Night = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime)
                                    p_Night = p_Night + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                                    p_Night = p_Night + w_BeforNextNightTime
                                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                                Case 2
                                    '夜勤時間
                                    'p_Night = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "C")
                                    p_Night = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NightTime) 'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正
                            End Select
                    End Select

                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
                    ''2016/04/21 Yamanishi Add ------------------------------------------------------------------------------------
                    'w_Var = w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD
                    'Select Case w_intFlg
                    '    Case 0
                    '        '夜勤時間+翌日夜勤時間
                    '        p_TotalNight = m_objGetTimeM(w_Var & "G") + m_objGetTimeM(w_Var & "H")
                    '    Case 1
                    '        '夜勤時間+翌日夜勤時間+前月最終日翌日夜勤時間
                    '        p_TotalNight = m_objGetTimeM(w_Var & "G") + m_objGetTimeM(w_Var & "H") + w_BeforNextTotalNightTime
                    '    Case 2
                    '        '夜勤時間
                    '        p_TotalNight = m_objGetTimeM(w_Var & "G")
                    'End Select
                    ''-------------------------------------------------------------------------------------------------------------

                    Select Case w_intFlg
                        Case 0
                            '夜勤時間+翌日夜勤時間
                            p_TotalNight = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.TotalNightTime)
                            p_TotalNight = p_TotalNight + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextTotalNightTime)
                        Case 1
                            '夜勤時間+翌日夜勤時間+前月最終日翌日夜勤時間
                            p_TotalNight = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.TotalNightTime)
                            p_TotalNight = p_TotalNight + GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextTotalNightTime)
                            p_TotalNight = p_TotalNight + w_BeforNextTotalNightTime
                        Case 2
                            '夜勤時間
                            p_TotalNight = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.TotalNightTime)
                    End Select
                    'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

                    '勤務がないときのパターン
                ElseIf p_Date = w_StartDate Then
                    Get_TimeM = w_BeforNextNightTime
                    p_TotalNight = w_BeforNextTotalNightTime '2016/04/21 Yamanishi Add
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '実績期間個人別集計 計算実行
    Private Sub RunReCalc_PUser_Jisseki(ByVal p_Row As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_PUser_Jisseki"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Seq1 As Integer
        Dim w_Index As Integer
        Dim w_PersonalGoukei() As Single
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_KangoCD As String = String.Empty
        Dim w_HairetuIdx As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_Hour1 As Integer
        Dim w_Min1 As Integer
        Dim w_Time1 As Integer
        Dim w_Time2 As Integer
        Dim w_KinmuTime As Integer
        Dim w_str As String
        Dim w_ViewIndex As Integer
        Dim w_4wIndex As Integer '４週表示時の前４週のｲﾝﾃﾞｯｸｽ
        Dim w_DaikyuLoop As Integer
        Dim w_DaikyuPossibleCnt As Double '代休取得可能日数
        Dim w_dblWorkNum As Double
        Dim w_HaizokuFlg As Boolean
        Dim w_intWorkCnt As Integer
        Dim w_intWorkLoop As Integer
        Try
            '合計行ある ?
            If UBound(m_HMtrx) <= 0 Then
                '合計行ない場合
                Exit Sub
            End If

            If m_SelViewKikan = 0 Then
                w_ViewIndex = 1
            Else
                w_ViewIndex = 2
            End If

            If w_ViewIndex = 1 Then
                With m_Spread(w_ViewIndex).Sheets(0)

                    '合計値 配列変数 定義
                    ReDim w_PersonalGoukei(UBound(m_HMtrx))

                    '職員配列ｲﾝﾃﾞｯｸｽ取得
                    w_Var = .GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        w_HairetuIdx = Integer.Parse(w_Var)
                    End If

                    '********************************
                    '     代休取得可能日数の取得
                    '********************************
                    w_DaikyuPossibleCnt = 0
                    '該当職員の代休情報件数分ループする
                    For w_DaikyuLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Daikyu)
                        '代休集計期間かどうか？
                        If m_lngDaikyuStartDate_Cnt <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_lngDaikyuEndDate_Cnt Then

                            '代休発生量を判断
                            Select Case m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).GetKbn
                                Case "0"
                                    w_dblWorkNum = 1
                                Case "1"
                                    w_dblWorkNum = 1.5
                            End Select

                            '代休集計期間
                            If m_KeikakuKikan.StartDate <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_KeikakuKikan.EndDate Then
                                '代休集計期間内かつ、計画期間内の場合・・・
                                '代休の未使用分を加算
                                w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                            Else
                                '代休集計期間内かつ、計画期間外の場合・・・
                                '代休の未使用分を加算
                                With m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop)
                                    If Double.Parse(.OutPutList) = 1 AndAlso UBound(.DaikyuDetail) = 0 Then
                                    Else
                                        w_dblWorkNum = .RemainderHol
                                        For w_Seq = 1 To UBound(.DaikyuDetail)
                                            If m_KeikakuKikan.StartDate <= .DaikyuDetail(w_Seq).DaikyuDate AndAlso .DaikyuDetail(w_Seq).DaikyuDate <= m_KeikakuKikan.EndDate Then
                                                Select Case .DaikyuDetail(w_Seq).GetFlg
                                                    Case "0"
                                                        '１日
                                                        w_dblWorkNum = w_dblWorkNum + 1
                                                    Case "1"
                                                        '半日
                                                        w_dblWorkNum = w_dblWorkNum + 0.5
                                                End Select
                                            End If
                                        Next w_Seq
                                    End If
                                End With
                                w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                            End If
                        End If
                    Next w_DaikyuLoop

                    '代休区分の集計配列に代休取得可能日数を格納する
                    For w_Seq = 1 To UBound(m_HMtrx)
                        If m_HMtrx(w_Seq).CntKbn = "6" Then
                            w_PersonalGoukei(w_Seq) = w_DaikyuPossibleCnt
                        End If
                    Next w_Seq

                    '計画勤務ﾃﾞｰﾀの列数繰り返し
                    For w_Col = m_JissekiKikan.KinmuDataStartCol To m_JissekiKikan.KinmuDataEndCol

                        w_Var = .GetText(p_Row, w_Col)
                        If w_Var <> "" Then

                            '2015/04/10 Bando Upd Start =======================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   =======================

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_YYYYMMDD = Integer.Parse(w_Var)
                            End If

                            '配属チェック
                            w_HaizokuFlg = False
                            w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                            For w_intWorkLoop = 1 To w_intWorkCnt
                                '2015/04/08 Yamanishi Upd ----------------------------------------------------------
                                'If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                    '-------------------------------------------------------------------------------
                                    w_HaizokuFlg = True
                                    Exit For
                                End If
                            Next w_intWorkLoop

                            If Trim(w_KinmuCD) = "" Then
                            Else
                                '個人別集計項目数分 繰り返し
                                For w_Seq = 1 To UBound(m_HMtrx)
                                    '集計対象勤務？
                                    If w_HaizokuFlg = True AndAlso InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 Then
                                        '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                        w_Index = InStr(m_HMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                        If m_HMtrx(w_Seq).CntKbn <> "6" Then
                                            w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_HMtrx(w_Seq).Ratio(w_Index)
                                        Else
                                            w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) - m_HMtrx(w_Seq).Ratio(w_Index)
                                        End If
                                    End If

                                    '労働時間（応援勤務者を除く）
                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                        If m_HMtrx(w_Seq).CntKbn = "2" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" AndAlso w_HaizokuFlg = True Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                w_Hour1 = w_KinmuTime \ 100
                                                w_Min1 = w_KinmuTime Mod 100

                                                w_Time1 = (w_Hour1 * 60) + w_Min1
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '累計時間
                                        ElseIf m_HMtrx(w_Seq).CntKbn = "3" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                w_Hour1 = w_KinmuTime \ 100
                                                w_Min1 = w_KinmuTime Mod 100

                                                w_Time1 = (w_Hour1 * 60) + w_Min1
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '日勤時間
                                        ElseIf m_HMtrx(w_Seq).CntKbn = "4" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 1)
                                                w_Time1 = w_KinmuTime
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '夜勤時間
                                        ElseIf m_HMtrx(w_Seq).CntKbn = "5" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2)
                                                w_Time1 = w_KinmuTime
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                        End If
                                    End If
                                Next w_Seq
                            End If
                        End If
                    Next w_Col

                    '---------------------------
                    '   実績期間個人別集計表示
                    '---------------------------
                    w_Seq = 1

                    For w_Col = m_JissekiKikan.PersonalStartCol To m_JissekiKikan.PersonalEndCol
                        '集計名称再設定
                        If w_Seq <= UBound(m_HMtrx) Then
                            '合計ﾀｲﾄﾙ 文字列 １段目 設定
                            w_Var = General.paLeft(m_HMtrx(w_Seq).MtrxName, 1)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 １段目 設定
                            .SetText(M_DayLabel_Row, w_Col, w_Var)

                            '合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            w_Var = General.paRight(m_HMtrx(w_Seq).MtrxName, 1)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            .SetText(M_WeekLabel_Row, w_Col, w_Var)

                            If m_HMtrx(w_Seq).CntKbn = "1" OrElse
                                    m_HMtrx(w_Seq).CntKbn = "6" OrElse
                                    m_HMtrx(w_Seq).CntKbn = "8" Then
                                '集計欄の表示形式により分岐
                                If m_PersonalTotalSet = 0 Then
                                    w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                                Else
                                    w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                                End If
                            Else
                                '累計時間を加算
                                If m_HMtrx(w_Seq).CntKbn = "3" Then
                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_StaffData(w_HairetuIdx).RuikeiTime
                                End If
                                w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & (w_PersonalGoukei(w_Seq) Mod 60)
                                w_Var = Format(Single.Parse(w_str), "#0.00")
                            End If

                            '合計値 設定
                            .SetText(p_Row, w_Col, w_Var)

                            '次の配列へ
                            w_Seq = w_Seq + 1
                        End If
                    Next w_Col
                End With
            Else
                w_4wIndex = m_SelViewKikan - 1

                With m_Spread(w_ViewIndex).Sheets(0)

                    '合計値 配列変数 定義
                    ReDim w_PersonalGoukei(UBound(m_HMtrx_4Week))

                    For w_Int = 1 To UBound(m_4WeekKikan)
                        '********************************
                        '     代休取得可能日数の取得
                        '********************************
                        w_DaikyuPossibleCnt = 0
                        '該当職員の代休情報件数分ループする
                        For w_DaikyuLoop = 1 To UBound(m_StaffData(w_HairetuIdx).Daikyu)
                            '代休集計期間かどうか？
                            If m_lngDaikyuStartDate_Cnt <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_lngDaikyuEndDate_Cnt Then
                                w_dblWorkNum = 0
                                '代休発生量を判断
                                Select Case m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).GetKbn
                                    Case "0"
                                        w_dblWorkNum = 1
                                    Case "1"
                                        w_dblWorkNum = 1.5
                                End Select
                                '代休集計期間
                                If m_4WeekKikan(m_SelViewKikan).StartDate <= m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate AndAlso m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop).HolDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                    '代休集計期間内かつ、計画期間内の場合・・・
                                    '代休の未使用分を加算
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                Else
                                    '代休集計期間内かつ、計画期間外の場合・・・
                                    '代休の未使用分を加算
                                    With m_StaffData(w_HairetuIdx).Daikyu(w_DaikyuLoop)
                                        If Double.Parse(.OutPutList) = 1 AndAlso UBound(.DaikyuDetail) = 0 Then
                                        Else
                                            w_dblWorkNum = .RemainderHol
                                            For w_Seq1 = 1 To UBound(.DaikyuDetail)
                                                If m_4WeekKikan(m_SelViewKikan).StartDate <= .DaikyuDetail(w_Seq1).DaikyuDate AndAlso .DaikyuDetail(w_Seq1).DaikyuDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                                    Select Case .DaikyuDetail(w_Seq1).GetFlg
                                                        Case "0"
                                                            '１日
                                                            w_dblWorkNum = w_dblWorkNum + 1
                                                        Case "1"
                                                            '半日
                                                            w_dblWorkNum = w_dblWorkNum + 0.5
                                                    End Select
                                                End If
                                            Next w_Seq1
                                        End If
                                    End With
                                    w_DaikyuPossibleCnt = w_DaikyuPossibleCnt + w_dblWorkNum
                                End If
                            End If
                        Next w_DaikyuLoop

                        '代休区分の集計配列に代休取得可能日数を格納する
                        For w_Seq1 = 1 To UBound(m_HMtrx_4Week)
                            If m_HMtrx_4Week(w_Seq1).CntKbn = "6" Then
                                w_PersonalGoukei(w_Seq1) = w_DaikyuPossibleCnt
                            End If
                        Next w_Seq1
                    Next w_Int

                    '職員配列ｲﾝﾃﾞｯｸｽ取得
                    w_Var = .GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        w_HairetuIdx = Integer.Parse(w_Var)
                    End If

                    '計画勤務ﾃﾞｰﾀの列数繰り返し
                    For w_Col = m_4WeekKikan(w_4wIndex).KinmuDataStartCol To m_4WeekKikan(w_4wIndex).KinmuDataEndCol

                        w_Var = .GetText(p_Row, w_Col)
                        If w_Var <> "" Then
                            '2015/04/10 Bando Upd Start ===================
                            If m_4WeekKikan(w_4wIndex).PersonalStartCol <= w_Col OrElse w_Col >= m_4WeekKikan(w_4wIndex).PersonalEndCol Then
                                Continue For
                            End If
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   ===================

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_YYYYMMDD = Integer.Parse(w_Var)
                            End If

                            '配属チェック
                            w_HaizokuFlg = False
                            w_intWorkCnt = UBound(m_StaffData(w_HairetuIdx).IdoData)
                            For w_intWorkLoop = 1 To w_intWorkCnt
                                '2015/04/08 Yamanishi Upd ----------------------------------------------------------
                                'If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                If m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_HairetuIdx).IdoData(w_intWorkLoop).SyuryoYMD Then
                                    '-------------------------------------------------------------------------------
                                    w_HaizokuFlg = True
                                    Exit For
                                End If
                            Next w_intWorkLoop

                            If Trim(w_KinmuCD) = "" Then
                            Else
                                '個人別集計項目数分 繰り返し
                                For w_Seq = 1 To UBound(m_HMtrx_4Week)
                                    '集計対象勤務？
                                    If w_HaizokuFlg = True AndAlso InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 Then
                                        '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                        w_Index = InStr(m_HMtrx_4Week(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                        w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_HMtrx_4Week(w_Seq).Ratio(w_Index)
                                    End If

                                    '労働時間（応援勤務者を除く）
                                    If m_StaffData(w_HairetuIdx).OuenStaffFlg = Double.Parse("0") Then
                                        If m_HMtrx_4Week(w_Seq).CntKbn = "2" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" AndAlso w_HaizokuFlg = True Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                w_Hour1 = w_KinmuTime \ 100
                                                w_Min1 = w_KinmuTime Mod 100

                                                w_Time1 = (w_Hour1 * 60) + w_Min1
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '累計時間
                                        ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "3" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 0)
                                                w_Hour1 = w_KinmuTime \ 100
                                                w_Min1 = w_KinmuTime Mod 100

                                                w_Time1 = (w_Hour1 * 60) + w_Min1
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '日勤時間
                                        ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "4" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 1)
                                                w_Time1 = w_KinmuTime
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                            '夜勤時間
                                        ElseIf m_HMtrx_4Week(w_Seq).CntKbn = "5" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).KinmuKBN = "1" Then
                                                w_KinmuTime = Get_TimeM(w_HairetuIdx, w_KinmuCD, w_YYYYMMDD, 2)
                                                w_Time1 = w_KinmuTime
                                                w_Time2 = w_PersonalGoukei(w_Seq)

                                                w_PersonalGoukei(w_Seq) = (w_Time1 + w_Time2)
                                            End If
                                        End If
                                    End If
                                Next w_Seq
                            End If
                        End If
                    Next w_Col

                    '---------------------------
                    '   実績期間個人別集計表示
                    '---------------------------
                    w_Seq = 1

                    For w_Col = m_4WeekKikan(w_4wIndex).PersonalStartCol To m_4WeekKikan(w_4wIndex).PersonalEndCol
                        '集計名称再設定
                        If w_4wIndex <> 0 AndAlso w_Seq <= UBound(m_HMtrx_4Week) Then
                            '合計ﾀｲﾄﾙ 文字列 １段目 設定
                            w_Var = General.paLeft(m_HMtrx_4Week(w_Seq).MtrxName, 1)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 １段目 設定
                            .SetText(M_DayLabel_Row, w_Col, w_Var)

                            '合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            w_Var = General.paRight(m_HMtrx_4Week(w_Seq).MtrxName, 1)

                            '固定Spread合計ﾀｲﾄﾙ 文字列 ２段目 設定
                            .SetText(M_WeekLabel_Row, w_Col, w_Var)

                            If m_HMtrx_4Week(w_Seq).CntKbn = "1" OrElse
                                    m_HMtrx_4Week(w_Seq).CntKbn = "6" OrElse
                                    m_HMtrx_4Week(w_Seq).CntKbn = "8" Then
                                '集計欄の表示形式により分岐
                                If m_PersonalTotalSet = 0 Then
                                    w_Var = Convert.ToString(w_PersonalGoukei(w_Seq))
                                Else
                                    w_Var = Format(w_PersonalGoukei(w_Seq), "#0.0")
                                End If
                            Else
                                '累計時間を加算
                                If m_HMtrx_4Week(w_Seq).CntKbn = "3" Then
                                    w_PersonalGoukei(w_Seq) = w_PersonalGoukei(w_Seq) + m_StaffData(w_HairetuIdx).RuikeiTime
                                End If
                                w_str = (w_PersonalGoukei(w_Seq) \ 60) & "." & (w_PersonalGoukei(w_Seq) Mod 60)
                                w_Var = Format(Single.Parse(w_str), "#0.00")
                            End If

                            '合計値 設定
                            .SetText(p_Row, w_Col, w_Var)

                            '次の配列へ
                            w_Seq = w_Seq + 1
                        End If
                    Next w_Col
                End With
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub


    '計画期間日別集計 計算実行
    Private Sub RunReCalc_PDay(ByVal p_Col As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_PDay"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Index As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_DayGoukei() As DaySEQ_Type '日別集計
        Dim w_KangoCD As String = String.Empty
        Dim w_TeamCnt As Integer
        Dim w_hairetuIdx As Integer
        Dim w_YYYYMMDD As Integer '年月日
        Dim w_haizokuFlg As Boolean
        Try
            '合計行ある ?
            If UBound(m_VMtrx) <= 0 Then
                '合計行ない場合
                Exit Sub
            End If

            '計画期間内以外の場合は処理抜け出し
            If p_Col < m_KeikakuKikan.KinmuDataStartCol OrElse m_KeikakuKikan.KinmuDataEndCol < p_Col Then
                Exit Sub
            End If

            With m_Spread(1).Sheets(0)

                '日別集計 配列 定義(ﾁｰﾑ数,集計項目数,集計範囲の列数)
                If m_OuenTeam <= 0 Then
                    w_TeamCnt = m_TeamCnt
                Else
                    w_TeamCnt = m_OuenTeam
                End If

                ReDim w_DayGoukei(w_TeamCnt)
                For w_Int = 0 To w_TeamCnt
                    ReDim w_DayGoukei(w_Int).Seq(UBound(m_VMtrx))
                Next w_Int

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        w_hairetuIdx = Integer.Parse(w_Var)
                    End If
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                    If w_Var <> "" Then
                        w_YYYYMMDD = Integer.Parse(w_Var)
                    End If
                    w_haizokuFlg = False
                    For i As Integer = 1 To UBound(m_StaffData(w_hairetuIdx).IdoData)
                        If m_StaffData(w_hairetuIdx).IdoData(i).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_hairetuIdx).IdoData(i).SyuryoYMD Then
                            w_haizokuFlg = True
                            Exit For
                        End If
                    Next i
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '二段表示してる時　かつ　勤務変更時
                            w_Var = .GetText(w_Row + 1, p_Col)
                            If w_Var <> "" Then
                                '下段のテキストが入力されている時
                                w_Row2 = w_Row + 1
                            Else
                                w_Row2 = w_Row
                            End If
                        Else
                            w_Row2 = w_Row
                        End If

                        If m_OuenStaffRow.StartRow <= w_Row2 Then
                            '応援勤務者の場合
                            w_Var = .GetText(w_Row2, p_Col)
                            If w_Var <> "" Then
                                '2015/04/10 Bando Upd Start ===========================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                '2015/04/10 Bando Upd End   ===========================

                                If Trim(w_KinmuCD) = "" Then
                                Else
                                    '個人別集計項目数分 繰り返し
                                    'ﾁｰﾑNoが設定されている？
                                    w_Var = .GetText(w_Row2, m_StaffZokusei(M_Team).SetCol_M)
                                    If w_Var <> "" Then
                                        '日別集計　計算
                                        For w_Seq = 1 To UBound(m_VMtrx)
                                            '集計対象勤務、職種、役職かどうか？
                                            If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row2, w_Seq, 1) = True Then
                                                '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                                w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                            End If
                                        Next w_Seq
                                    End If
                                End If
                            End If
                        Else
                            If w_haizokuFlg Then
                                w_Var = .GetText(w_Row2, p_Col)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start =========================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                    '2015/04/10 Bando Upd End   =========================

                                    If Trim(w_KinmuCD) = "" Then
                                    Else
                                        '個人別集計項目数分 繰り返し
                                        'ﾁｰﾑNoが設定されている？
                                        w_Var = .GetText(w_Row2, m_StaffZokusei(M_Team).SetCol_M)
                                        If w_Var <> "" Then
                                            '日別集計　計算
                                            For w_Seq = 1 To UBound(m_VMtrx)
                                                '集計対象勤務かどうか？
                                                '集計対象勤務、職種、役職かどうか？
                                                If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row2, w_Seq, 1) = True Then
                                                    '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                    w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                                    w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                    w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                End If
                                            Next w_Seq
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next w_Row

                '-------------------------
                '   日別集計表示
                '-------------------------
                '日別集計開始行格納
                w_Row = m_DayAreaRow.StartRow
                '固定Spread開始行格納
                w_Row2 = 0

                'ﾁｰﾑ別集計
                'ﾁｰﾑ数分繰り返す
                For w_Int = 1 To w_TeamCnt
                    '集計項目数分繰り返す
                    For w_Seq = 1 To UBound(m_VMtrx)
                        w_Var = Convert.ToString(w_DayGoukei(w_Int).Seq(w_Seq).Goukei)
                        '日別集計出力
                        .SetText(w_Row, p_Col, w_Var)
                        '固定Spreadの日別集計出力
                        sprDayTotal_M.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合
                            'sprSheet_Mから出力する列の日付取得
                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                            '4週期間のときの列番号取得
                            If Get_Col_4W(w_Var2, w_Col) = True Then
                                '4週期間の日別集計出力
                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                                '固定Spreadの日別集計出力
                                sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                            End If
                        End If

                        w_Row = w_Row + 1
                        w_Row2 = w_Row2 + 1
                    Next w_Seq
                Next w_Int

                '全体の集計
                '集計項目数分繰り返す
                For w_Seq = 1 To UBound(m_VMtrx)
                    '列数分繰り返す
                    w_Var = Convert.ToString(w_DayGoukei(0).Seq(w_Seq).Goukei)
                    '日別集計出力
                    .SetText(w_Row, p_Col, w_Var)
                    '固定Spreadの日別集計出力
                    sprDayTotal_M.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合
                        'sprSheet_Mから出力する列の日付取得
                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                        '4週期間のときの列番号取得
                        If Get_Col_4W(w_Var2, w_Col) = True Then
                            '4週期間の日別集計出力
                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                            '固定Spreadの日別集計出力
                            sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                        End If
                    End If

                    w_Row = w_Row + 1
                    w_Row2 = w_Row2 + 1
                Next w_Seq

                '自動ﾁｪｯｸの場合のみ
                If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                    '=========================================================
                    '   必要人数 ｴﾗｰﾁｪｯｸ
                    '=========================================================
                    '計画期間内の列の場合
                    Call Check_DayNeedNumber(p_Col)
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '実績期間日別集計 計算実行
    Private Sub RunReCalc_JDay(ByVal p_Col As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_JDay"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Index As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_DayGoukei() As DaySEQ_Type '日別集計
        Dim w_KangoCD As String = String.Empty
        Dim w_TeamCnt As Integer
        Dim w_hairetuIdx As Integer
        Dim w_YYYYMMDD As Integer '年月日
        Dim w_haizokuFlg As Boolean
        Try
            '合計行ある ?
            If UBound(m_VMtrx) <= 0 Then
                '合計行ない場合
                Exit Sub
            End If

            With m_Spread(1).Sheets(0)

                '日別集計 配列 定義(ﾁｰﾑ数,集計項目数,集計範囲の列数)
                If m_OuenTeam <= 0 Then
                    w_TeamCnt = m_TeamCnt
                Else
                    w_TeamCnt = m_OuenTeam
                End If
                ReDim w_DayGoukei(w_TeamCnt)
                For w_Int = 0 To w_TeamCnt
                    ReDim w_DayGoukei(w_Int).Seq(UBound(m_VMtrx))
                Next w_Int

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        w_hairetuIdx = Integer.Parse(w_Var)
                    End If
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                    If w_Var <> "" Then
                        w_YYYYMMDD = Integer.Parse(w_Var)
                    End If
                    w_haizokuFlg = False
                    For i As Integer = 1 To UBound(m_StaffData(w_hairetuIdx).IdoData)
                        If m_StaffData(w_hairetuIdx).IdoData(i).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_hairetuIdx).IdoData(i).SyuryoYMD Then
                            w_haizokuFlg = True
                            Exit For
                        End If
                    Next i
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso w_haizokuFlg Then
                        w_Var = .GetText(w_Row, p_Col)
                        If w_Var <> "" Then
                            '2015/04/10 Bando Upd Start ===========================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End  ===========================

                            If Trim(w_KinmuCD) = "" Then
                            Else
                                '個人別集計項目数分 繰り返し
                                'ﾁｰﾑNoが設定されている？
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                                If w_Var <> "" Then
                                    '日別集計　計算
                                    For w_Seq = 1 To UBound(m_VMtrx)
                                        '集計対象勤務、職種、役職かどうか？
                                        If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row, w_Seq, 1) = True Then
                                            '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                            w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                            w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                            w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                        End If
                                    Next w_Seq
                                End If
                            End If
                        End If
                    End If
                Next w_Row

                '-------------------------
                '   日別集計表示
                '-------------------------
                '日別集計開始行格納
                w_Row = m_DayAreaRow.StartRow
                '固定Spread開始行格納
                w_Row2 = 0

                'ﾁｰﾑ別集計
                'ﾁｰﾑ数分繰り返す
                For w_Int = 1 To w_TeamCnt
                    '集計項目数分繰り返す
                    For w_Seq = 1 To UBound(m_VMtrx)
                        w_Var = Convert.ToString(w_DayGoukei(w_Int).Seq(w_Seq).Goukei)
                        '日別集計出力
                        .SetText(w_Row, p_Col, w_Var)
                        '固定Spreadの日別集計出力
                        sprDayTotal_M.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合
                            'sprSheet_Mから出力する列の日付取得
                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                            '4週期間のときの列番号取得
                            If Get_Col_4W(w_Var2, w_Col) = True Then
                                '4週期間の日別集計出力
                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                                '固定Spreadの日別集計出力
                                sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                            End If
                        End If

                        w_Row = w_Row + 1
                        w_Row2 = w_Row2 + 1
                    Next w_Seq
                Next w_Int

                '全体の集計
                '集計項目数分繰り返す
                For w_Seq = 1 To UBound(m_VMtrx)
                    '列数分繰り返す
                    w_Var = Convert.ToString(w_DayGoukei(0).Seq(w_Seq).Goukei)
                    '日別集計出力
                    .SetText(w_Row, p_Col, w_Var)
                    '固定Spreadの日別集計出力
                    sprDayTotal_M.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合
                        'sprSheet_Mから出力する列の日付取得
                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                        '4週期間のときの列番号取得
                        If Get_Col_4W(w_Var2, w_Col) = True Then
                            '4週期間の日別集計出力
                            m_Spread(2).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                            '固定Spreadの日別集計出力
                            sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                        End If
                    End If

                    w_Row = w_Row + 1
                    w_Row2 = w_Row2 + 1
                Next w_Seq
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '計画期間の最後４週部分日別集計 計算実行
    Private Sub RunReCalc_PDay_4W(ByVal p_Col As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_PDay_4W"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer

        Dim w_Seq As Integer
        Dim w_Index As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_DayGoukei() As DaySEQ_Type '日別集計
        Dim w_KangoCD As String = String.Empty
        Dim w_TeamCnt As Integer
        Dim w_StartCol As Integer
        Dim w_hairetuIdx As Integer
        Dim w_YYYYMMDD As Integer '年月日
        Dim w_haizokuFlg As Boolean
        Try
            '合計行ある ?
            If UBound(m_VMtrx) <= 0 Then
                '合計行ない場合
                Exit Sub
            End If

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Sub
            End If

            'PlanPeriodFrom/終了日の4週での列番号取得
            If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then Exit Sub
            '計画ﾃﾞｰﾀ列 範囲内か ?
            If Not ((w_StartCol <= p_Col) AndAlso (p_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol)) Then Exit Sub

            With m_Spread(2).Sheets(0)

                '日別集計 配列 定義(ﾁｰﾑ数,集計項目数,集計範囲の列数)
                If m_OuenTeam <= 0 Then
                    w_TeamCnt = m_TeamCnt
                Else
                    w_TeamCnt = m_OuenTeam
                End If
                ReDim w_DayGoukei(w_TeamCnt)
                For w_Int = 0 To w_TeamCnt
                    ReDim w_DayGoukei(w_Int).Seq(UBound(m_VMtrx))
                Next w_Int

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        w_hairetuIdx = Integer.Parse(w_Var)
                    End If
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                    If w_Var <> "" Then
                        w_YYYYMMDD = Integer.Parse(w_Var)
                    End If
                    w_haizokuFlg = False
                    For i As Integer = 1 To UBound(m_StaffData(w_hairetuIdx).IdoData)
                        If m_StaffData(w_hairetuIdx).IdoData(i).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_hairetuIdx).IdoData(i).SyuryoYMD Then
                            w_haizokuFlg = True
                            Exit For
                        End If
                    Next i
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '二段表示してる時　かつ　勤務変更時

                            w_Var = .GetText(w_Row + 1, p_Col)
                            'If w_Var <> "" OrElse .Cells(w_Row, w_Col).BackColor.Equals(Color.Black) Then
                            If w_Var <> "" OrElse .Cells(w_Row, p_Col).BackColor.Equals(Color.Black) Then '2011/06/09
                                '下段のテキストが入力されている時 または 上段の背景色が黒の時
                                w_Row2 = w_Row + 1
                            Else
                                w_Row2 = w_Row
                            End If
                        Else
                            w_Row2 = w_Row
                        End If

                        If m_OuenStaffRow.StartRow <= w_Row2 Then
                            '応援勤務者の場合
                            w_Var = .GetText(w_Row2, p_Col)
                            If w_Var <> "" Then
                                '2015/04/10 Bando Upd Start ====================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                '2015/04/10 Bando Upd End   ====================

                                If Trim(w_KinmuCD) = "" Then
                                Else
                                    '個人別集計項目数分 繰り返し
                                    'ﾁｰﾑNoが設定されている？
                                    w_Var = .GetText(w_Row2, m_StaffZokusei(M_Team).SetCol_4W)
                                    If w_Var <> "" Then
                                        '日別集計　計算
                                        For w_Seq = 1 To UBound(m_VMtrx)
                                            '集計対象勤務、職種、役職かどうか？
                                            If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row2, w_Seq, 2) = True Then
                                                '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                                w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                            End If
                                        Next w_Seq
                                    End If
                                End If
                            End If
                        Else
                            If w_haizokuFlg Then
                                w_Var = .GetText(w_Row2, p_Col)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start =================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                    '2015/04/10 Bando Upd End   =================

                                    If Trim(w_KinmuCD) = "" Then
                                    Else
                                        '個人別集計項目数分 繰り返し
                                        'ﾁｰﾑNoが設定されている？
                                        w_Var = .GetText(w_Row2, m_StaffZokusei(M_Team).SetCol_4W)
                                        If w_Var <> "" Then
                                            '日別集計　計算
                                            For w_Seq = 1 To UBound(m_VMtrx)
                                                '集計対象勤務、職種、役職かどうか？
                                                If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row2, w_Seq, 2) = True Then
                                                    '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                                    w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                                    w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                    w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                                End If
                                            Next w_Seq
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next w_Row

                '-------------------------
                '   日別集計表示
                '-------------------------
                '日別集計開始行格納
                w_Row = m_DayAreaRow.StartRow
                '固定Spread開始行格納
                w_Row2 = 0

                'ﾁｰﾑ別集計
                'ﾁｰﾑ数分繰り返す
                For w_Int = 1 To w_TeamCnt
                    '集計項目数分繰り返す
                    For w_Seq = 1 To UBound(m_VMtrx)
                        w_Var = Convert.ToString(w_DayGoukei(w_Int).Seq(w_Seq).Goukei)
                        '日別集計出力
                        .SetText(w_Row, p_Col, w_Var)
                        '固定Spreadの日別集計出力
                        sprDayTotal_4W.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                        'sprSheet_4Wから出力する列の日付取得
                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)

                        '計画期間のときの列番号取得
                        '*/*/*/*/*/*/*/*/*/*/*/
                        If Get_Col_M(w_Var2, w_Col) = True Then
                            '計画期間の日別集計出力
                            m_Spread(1).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                            '固定Spreadの日別集計出力
                            sprDayTotal_M.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                        End If

                        w_Row = w_Row + 1
                        w_Row2 = w_Row2 + 1
                    Next w_Seq
                Next w_Int

                '全体の集計
                '集計項目数分繰り返す
                For w_Seq = 1 To UBound(m_VMtrx)
                    '列数分繰り返す
                    w_Var = Convert.ToString(w_DayGoukei(0).Seq(w_Seq).Goukei)
                    '日別集計出力
                    .SetText(w_Row, p_Col, w_Var)
                    '固定Spreadの日別集計出力
                    sprDayTotal_4W.Sheets(0).SetText(w_Row2, p_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))

                    'sprSheet_4Wから出力する列の日付取得
                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)

                    '計画期間のときの列番号取得
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_Var2, w_Col) = True Then
                        '計画期間の日別集計出力
                        m_Spread(1).Sheets(0).SetText(w_Row, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                        '固定Spreadの日別集計出力
                        sprDayTotal_M.Sheets(0).SetText(w_Row2, w_Col, Convert.ToString(General.paRoundDown(Decimal.Parse(w_Var), 0)))
                    End If

                    w_Row = w_Row + 1
                    w_Row2 = w_Row2 + 1
                Next w_Seq

                '自動ﾁｪｯｸの場合のみ
                If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                    '=========================================================
                    '   必要人数 ｴﾗｰﾁｪｯｸ
                    '=========================================================
                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                    '1ヶ月用列番号取得
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_Var2, w_Col) = True Then
                        If m_KeikakuKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_KeikakuKikan.KinmuDataEndCol Then
                            '計画期間内の列の場合
                            Call Check_DayNeedNumber(w_Col)
                        End If
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '実績期間の最初の４週部分日別集計 計算実行
    Private Sub RunReCalc_JDay_4W(ByVal p_Col As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunReCalc_JDay_4W"

        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_Int As Integer
        Dim w_Seq As Integer
        Dim w_Index As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_Var As Object
        Dim w_DayGoukei() As DaySEQ_Type '日別集計
        Dim w_KangoCD As String = String.Empty
        Dim w_TeamCnt As Integer
        Dim w_hairetuIdx As Integer
        Dim w_YYYYMMDD As Integer '年月日
        Dim w_haizokuFlg As Boolean
        Try
            '合計行ある ?
            If UBound(m_VMtrx) <= 0 Then
                '合計行ない場合
                Exit Sub
            End If

            With m_Spread(2).Sheets(0)

                '日別集計 配列 定義(ﾁｰﾑ数,集計項目数,集計範囲の列数)
                If m_OuenTeam <= 0 Then
                    w_TeamCnt = m_TeamCnt
                Else
                    w_TeamCnt = m_OuenTeam
                End If
                ReDim w_DayGoukei(w_TeamCnt)
                For w_Int = 0 To w_TeamCnt
                    ReDim w_DayGoukei(w_Int).Seq(UBound(m_VMtrx))
                Next w_Int

                '職員数 繰り返し処理
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        w_hairetuIdx = Integer.Parse(w_Var)
                    End If
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, p_Col)
                    If w_Var <> "" Then
                        w_YYYYMMDD = Integer.Parse(w_Var)
                    End If
                    w_haizokuFlg = False
                    For i As Integer = 1 To UBound(m_StaffData(w_hairetuIdx).IdoData)
                        If m_StaffData(w_hairetuIdx).IdoData(i).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_hairetuIdx).IdoData(i).SyuryoYMD Then
                            w_haizokuFlg = True
                            Exit For
                        End If
                    Next i
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso w_haizokuFlg Then

                        w_Var = .GetText(w_Row, p_Col)
                        If w_Var <> "" Then
                            '2015/04/10 Bando Upd Start ==========================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   ==========================

                            If Trim(w_KinmuCD) = "" Then
                            Else
                                '個人別集計項目数分 繰り返し
                                'ﾁｰﾑNoが設定されている？
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_Team).SetCol_4W)
                                If w_Var <> "" Then
                                    '日別集計　計算
                                    For w_Seq = 1 To UBound(m_VMtrx)
                                        '集計対象勤務、職種、役職かどうか？
                                        If InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Check_OutCalc(w_Row, w_Seq, 2) = True Then
                                            '該当勤務の集計比率の配列ｲﾝﾃﾞｯｸｽを取得
                                            w_Index = InStr(m_VMtrx(w_Seq).CalcKinmuStr, w_KinmuCD) \ 4 + 1
                                            w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei = w_DayGoukei(DirectCast(w_Var, Object)).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                            w_DayGoukei(0).Seq(w_Seq).Goukei = w_DayGoukei(0).Seq(w_Seq).Goukei + m_VMtrx(w_Seq).Ratio(w_Index)
                                        End If
                                    Next w_Seq
                                End If
                            End If
                        End If
                    End If
                Next w_Row

                '-------------------------
                '   日別集計表示
                '-------------------------
                '日別集計開始行格納
                w_Row = m_DayAreaRow.StartRow
                '固定Spread開始行格納
                w_Row2 = 0

                'ﾁｰﾑ別集計
                'ﾁｰﾑ数分繰り返す
                For w_Int = 1 To w_TeamCnt
                    '集計項目数分繰り返す
                    For w_Seq = 1 To UBound(m_VMtrx)
                        w_Var = Convert.ToString(w_DayGoukei(w_Int).Seq(w_Seq).Goukei)
                        '日別集計出力
                        .SetText(w_Row, p_Col, w_Var)
                        '固定Spreadの日別集計出力
                        sprDayTotal_4W.Sheets(0).SetText(w_Row2, p_Col, w_Var)

                        w_Row = w_Row + 1
                        w_Row2 = w_Row2 + 1
                    Next w_Seq
                Next w_Int

                '全体の集計
                '集計項目数分繰り返す
                For w_Seq = 1 To UBound(m_VMtrx)
                    '列数分繰り返す
                    w_Var = Convert.ToString(w_DayGoukei(0).Seq(w_Seq).Goukei)
                    '日別集計出力
                    .SetText(w_Row, p_Col, w_Var)
                    '固定Spreadの日別集計出力
                    sprDayTotal_4W.Sheets(0).SetText(w_Row2, p_Col, w_Var)

                    w_Row = w_Row + 1
                    w_Row2 = w_Row2 + 1
                Next w_Seq
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Get_Holiday()

        Const W_SUBNAME As String = "NSK0000HA Get_Holiday"

        Dim w_Int As Integer
        Dim w_RecCnt As Integer
        Dim w_YYYYMMDD As String
        Dim w_DateFrom As Date
        Dim w_DateTo As Date

        m_OffDayStr = ""
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                w_DateFrom = Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00"))
                w_DateTo = Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                w_DateFrom = Date.Parse(Format(m_4WeekKikan(1).StartDate, "0000/00/00"))
                w_DateTo = Date.Parse(Format(m_4WeekKikan(UBound(m_4WeekKikan)).EndDate, "0000/00/00"))
            End If

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pHM_FromDate = Format(w_DateFrom, "yyyyMMdd") '取得開始日
                .pHM_ToDate = Format(w_DateTo, "yyyyMMdd") '取得終了日

                If .mGetHolidayM = False Then
                Else
                    'レコード件数
                    w_RecCnt = .fHM_DataCount

                    For w_Int = 1 To w_RecCnt
                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .mHM_DataIdx = w_Int

                        '祝祭日をｶﾝﾏ編集
                        w_YYYYMMDD = .fHM_YEARF & Format(.fHM_MONTHDAY, "0000")
                        m_HolDateStr = m_HolDateStr & w_YYYYMMDD & ","
                        '休日の取得
                        If .fHM_HOLIDAYBUNRUICD = "1" Then
                            m_OffDayStr = m_OffDayStr & w_YYYYMMDD & ","
                        End If
                    Next w_Int
                End If
            End With

            'エラーチェック用休日回数取得
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week Then
                '計画期間が4週の場合（4週/1ヶ月，4週/4週）
                '８回固定でチェックする
                m_HolidayCount = 8
            Else
                '計画期間が１ヶ月の場合（1ヶ月/1ヶ月）
                '土日祝の回数
                w_DateFrom = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))
                m_HolidayCount = 0
                Do
                    Select Case Weekday(Date.Parse(Format(w_DateFrom, "yyyy/MM/dd")))
                        Case FirstDayOfWeek.Sunday, FirstDayOfWeek.Saturday
                            m_HolidayCount = m_HolidayCount + 1
                        Case Else
                            If InStr(m_HolDateStr, Format(w_DateFrom, "yyyyMMdd")) > 0 Then
                                '休日
                                m_HolidayCount = m_HolidayCount + 1
                            End If
                    End Select
                    If Integer.Parse(Format(w_DateFrom, "yyyyMMdd")) >= m_KeikakuKikan.EndDate Then
                        Exit Do
                    End If
                    w_DateFrom = DateAdd(DateInterval.Day, 1, w_DateFrom)
                Loop
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '自動割当ｴﾝｼﾞﾝ用変数の値 取得/計算
    Private Function Set_AutoAssign() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Set_AutoAssign"

        Dim w_Int As Integer
        Dim w_Sql As String
        Dim w_Var_From As Object
        Dim w_Var_To As Object
        Dim w_Var As Object
        Dim w_PlanNo As Integer
        Dim w_MsgRc As Integer
        'DAOｵﾌﾞｼﾞｪｸﾄ
        Dim w_Rs As ADODB.Recordset
        '計画制御Ｆﾌｨｰﾙﾄﾞ
        Dim w_開始日_F As ADODB.Field
        Dim w_終了日_F As ADODB.Field
        Dim w_締切日_F As ADODB.Field
        Dim w_Term_F As ADODB.Field
        Dim w_strMsg() As String
        Try
            '--------------------------------------------------
            '表示開始年月日/表示終了年月日 取得 (User計画作成期間)
            '--------------------------------------------------
            'Select文 編集
            'RICHARD UPDATE START
            'w_Sql = "SELECT PLANPERIODFROM, PLANPERIODTO, PLANDUEDATE, TERM "
            'w_Sql = w_Sql & "FROM NS_PLANCONTROL_F "
            'w_Sql = w_Sql & "WHERE PLANNO = " & m_PlanNo & " "
            'w_Sql = w_Sql & "AND HOSPITALCD = '" & General.g_strHospitalCD & "' "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANCONTROL_F_01(w_Rs, m_PlanNo)
            'RICHARD UPDATE END

            'w_Sql = "SELECT PLANPERIODFROM, PLANPERIODTO, PLANDUEDATE, TERM "
            'ﾃﾞｰﾀ存在ﾁｪｯｸ
            If w_Rs.RecordCount <= 0 Then
                '-- 該当の計画番号が存在しない場合 --
                ReDim w_strMsg(1)
                w_strMsg(1) = "計画制御"
                Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                w_Rs.Close()
                Exit Function
            Else
                With w_Rs
                    '-- 該当の計画番号が存在した場合 --
                    'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ生成
                    w_開始日_F = .Fields("PlanPeriodFrom")
                    w_終了日_F = .Fields("PlanPeriodTo")
                    w_締切日_F = .Fields("PlanDueDate")
                    w_Term_F = .Fields("Term")

                    '表示開始/終了年月日 設定
                    m_Display.StartDate = IIf(IsDBNull(w_開始日_F.Value), 0, w_開始日_F.Value)
                    m_Display.EndDate = IIf(IsDBNull(w_終了日_F.Value), 0, w_終了日_F.Value)
                    '締切日
                    m_Simekiribi = IIf(IsDBNull(w_締切日_F.Value), 0, w_締切日_F.Value)
                    If IsDate(Format(m_Simekiribi, "0000/00/00")) = False Then
                        m_Simekiribi = 0
                    End If

                    '----------------------------------------
                    '   計画期間 格納
                    '----------------------------------------
                    m_KeikakuKikan.StartDate = IIf(IsDBNull(w_開始日_F.Value), 0, w_開始日_F.Value)
                    m_KeikakuKikan.EndDate = IIf(IsDBNull(w_終了日_F.Value), 0, w_終了日_F.Value)
                    m_KeikakuKikan.TarmNo = IIf(IsDBNull(w_Term_F.Value), 0, w_Term_F.Value)
                    m_KeikakuKikan.PlanNo = m_PlanNo
                End With
            End If
            w_Rs.Close()

            '----------------------------------------
            '   実績期間 取得
            '----------------------------------------
            '実績ﾃﾞｰﾀ PlanNo 格納
            w_PlanNo = m_PlanNo - 1

            'richard update start
            '-- 表示開始年月日/表示終了年月日 取得 -------------
            'w_Sql = "SELECT PLANPERIODFROM, PLANPERIODTO, TERM "
            'w_Sql = w_Sql & "FROM NS_PLANCONTROL_F "
            'w_Sql = w_Sql & "WHERE PLANNO = " & w_PlanNo & " "
            'w_Sql = w_Sql & "AND HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANCONTROL_F_03(w_Rs, w_PlanNo) '<21>
            'richard update end

            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀなし
                '実績期間 開始/終了年月日 設定
                w_Var_From = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))
                w_Var_To = Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Month Then
                    '1ｹ月/1ｹ月の場合
                    'PlanPeriodFrom/終了日の1ｹ月前
                    m_JissekiKikan.StartDate = Integer.Parse(Format(DateAdd(DateInterval.Month, -1, Date.Parse(w_Var_From)), "yyyyMMdd"))
                    m_JissekiKikan.EndDate = Integer.Parse(Format(DateAdd(DateInterval.Month, -1, Date.Parse(w_Var_To)), "yyyyMMdd"))
                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week Then
                    If m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合
                        m_JissekiKikan.StartDate = Integer.Parse(Format(DateAdd(DateInterval.Month, -1, Date.Parse(w_Var_From)), "yyyyMMdd"))
                        m_JissekiKikan.EndDate = Integer.Parse(Format(DateAdd(DateInterval.Month, -1, Date.Parse(w_Var_To)), "yyyyMMdd"))
                    ElseIf m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week Then
                        '計画単位が4週の場合
                        m_JissekiKikan.StartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -28, Date.Parse(w_Var_From)), "yyyymMMd"))
                        m_JissekiKikan.EndDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -28, Date.Parse(w_Var_To)), "yyyyMMdd"))
                    End If
                    m_JissekiKikan.PlanNo = 0
                End If
            Else
                With w_Rs
                    'ﾃﾞｰﾀが存在した場合
                    'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ生成
                    w_開始日_F = .Fields("PlanPeriodFrom")
                    w_終了日_F = .Fields("PlanPeriodTo")
                    w_Term_F = .Fields("Term")

                    '実績期間 開始/終了年月日 設定
                    m_JissekiKikan.StartDate = IIf(IsDBNull(w_開始日_F.Value), 0, w_開始日_F.Value)
                    m_JissekiKikan.EndDate = IIf(IsDBNull(w_終了日_F.Value), 0, w_終了日_F.Value)
                    m_JissekiKikan.TarmNo = IIf(IsDBNull(w_Term_F.Value), 0, w_Term_F.Value)
                    m_JissekiKikan.PlanNo = w_PlanNo
                End With
            End If
            w_Rs.Close()

            '--------------------------------------------------
            '割当開始日/割当終了日 ...etc 設定
            '--------------------------------------------------
            Select Case m_PlanType
                Case BasNSK0000H.gePlanType.PlanType_Month
                    '--- 計画単位が １ヶ月の場合 ---

                    Select Case m_ViewFromTo
                        Case BasNSK0000H.geViewType.ViewType_Month '計画１ヶ月／表示１ヶ月の場合
                            '表示期間と割当期間は一致する

                            '割当開始/終了日 設定
                            m_Schedule.StartDate = m_Display.StartDate
                            m_Schedule.EndDate = m_Display.EndDate

                            '割当期間ｴﾗｰﾁｪｯｸ 情報 配列定義
                            ReDim m_PcheckD(1)

                            '割当期間のｴﾗｰﾁｪｯｸ開始/終了日の設定
                            m_PcheckD(1).StartDate = m_Schedule.StartDate
                            m_PcheckD(1).EndDate = m_Schedule.EndDate

                            '--- ｶﾚﾝﾀﾞｰ開始日 設定 ---
                            If m_PlanNo = 1 Then
                                'ｶﾚﾝﾀﾞｰ開始 設定
                                m_Calendar.StartDate = m_Display.StartDate
                            Else
                                'ｶﾚﾝﾀﾞｰ開始日 設定
                                m_Calendar.StartDate = m_JissekiKikan.StartDate
                            End If

                            'ｶﾚﾝﾀﾞｰ終了日 設定
                            m_Calendar.EndDate = m_Display.EndDate

                            '4週計画期間 配列定義
                            ReDim m_4WeekKikan(0)

                        Case Else
                            Exit Function
                    End Select

                Case BasNSK0000H.gePlanType.PlanType_Week
                    '--- 計画単位が ４週間の場合 ---

                    Select Case m_ViewFromTo
                        Case BasNSK0000H.geViewType.ViewType_Month '計画４週間／表示１ヶ月の場合

                            '- 割当終了日 計算 & 設定 --------
                            'ｼｽﾃﾑ開始日 日付型変換
                            w_Var_From = Date.Parse(Format(m_SystemStartDay, "0000/00/00"))
                            '表示終了日 日付型変換
                            w_Var_To = Date.Parse(Format(m_Display.EndDate, "0000/00/00"))

                            '割当終了日 計算
                            Do
                                '計画期間最終日と表示終了日を比較
                                If DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From)) >= w_Var_To Then
                                    Exit Do
                                End If
                                '28日 加算(次の割当開始日 算出)
                                w_Var_From = DateAdd(DateInterval.Day, 28, Date.Parse(w_Var_From))
                            Loop

                            '割当終了日 設定
                            w_Var_From = DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From))
                            m_Schedule.EndDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))

                            '- 割当開始日 計算 & 設定 --------
                            '割当終了日 日付型変換
                            w_Var_From = Date.Parse(Format(m_Schedule.EndDate, "0000/00/00"))
                            '表示開始日 日付型変換
                            w_Var_To = Date.Parse(Format(m_Display.StartDate, "0000/00/00"))

                            '割当開始日 計算
                            Do
                                '計画期間開始日と表示開始日を比較
                                If DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From)) <= w_Var_To Then
                                    Exit Do
                                End If
                                '28日 減算
                                w_Var_From = DateAdd(DateInterval.Day, -28, Date.Parse(w_Var_From))
                            Loop

                            '割当開始日 設定
                            w_Var_From = DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From))
                            m_Schedule.StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))

                            '- 割当ﾁｪｯｸ期間 計算 & 設定
                            '計画単位数の初期化
                            w_Int = 1

                            '割当期間ｴﾗｰﾁｪｯｸ 情報 配列定義
                            ReDim m_PcheckD(w_Int)

                            '割当期間のｴﾗｰﾁｪｯｸ開始日の設定
                            m_PcheckD(1).StartDate = m_Schedule.StartDate
                            '割当終了日  日付型変換
                            w_Var_To = Date.Parse(Format(m_Schedule.EndDate, "0000/00/00"))

                            '割当開始日 計算
                            Do
                                '28日 加算
                                w_Var_From = DateAdd(DateInterval.Day, 28, Date.Parse(w_Var_From))
                                '各割当ﾁｪｯｸ開始日と割当ﾁｪｯｸ終了日を比較
                                If DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From)) > w_Var_To Then
                                    Exit Do
                                End If
                                '割当期間(w_PlanCnt-1 期)の終了日 設定
                                w_Var = DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From))
                                m_PcheckD(w_Int).EndDate = Integer.Parse(Format(w_Var, "yyyyMMdd"))
                                '計画単位数のｶｳﾝﾄ
                                w_Int = w_Int + 1
                                ReDim Preserve m_PcheckD(w_Int)
                                '割当期間(w_PlanCnt期)の開始日 設定
                                m_PcheckD(w_Int).StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))
                            Loop

                            '割当ﾁｪｯｸ期間の終了日 設定
                            w_Var = DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From))
                            m_PcheckD(w_Int).EndDate = Integer.Parse(Format(w_Var, "yyyyMMdd"))

                            '- ｶﾚﾝﾀﾞｰ開始日 計算 & 設定 ----------
                            '割当開始日 日付型変換
                            w_Var_From = Date.Parse(Format(m_Schedule.StartDate, "0000/00/00"))
                            '表示開始日 日付型変換
                            w_Var_To = Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00"))

                            Do
                                If DateAdd(DateInterval.Day, 1, Date.Parse(w_Var_From)) <= w_Var_To Then
                                    Exit Do
                                End If
                                'ｶﾚﾝﾀﾞｰ開始日 計算
                                w_Var_From = DateAdd(DateInterval.Day, -28, Date.Parse(w_Var_From))
                            Loop

                            '4週用　配列定義
                            ReDim m_4WeekKikan(1)

                            '計算結果をｼｽﾃﾑ開始日と比較
                            If w_Var_From < Date.Parse(Format(m_SystemStartDay, "0000/00/00")) Then
                                'ｼｽﾃﾑ開始日以前の場合

                                '4週期間開始日設定
                                m_4WeekKikan(1).StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))

                                w_Var_From = Date.Parse(Format(m_SystemStartDay, "0000/00/00"))
                            End If

                            'ｶﾚﾝﾀﾞｰ開始/終了日 設定
                            m_Calendar.StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))
                            m_Calendar.EndDate = m_Schedule.EndDate

                            '- 4週期間 開始日/終了日 計算 & 設定 --------
                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                'ｽｹｼﾞｭｰﾙ開始日 日付型変換
                                w_Var_From = Date.Parse(Format(m_Schedule.StartDate, "0000/00/00"))
                            Else
                                'ｶﾚﾝﾀﾞｰ開始日 日付型変換
                                w_Var_From = Date.Parse(Format(m_Calendar.StartDate, "0000/00/00"))
                            End If

                            'ｶﾚﾝﾀﾞｰ終了日 日付型変換
                            w_Var_To = Date.Parse(Format(m_Calendar.EndDate, "0000/00/00"))

                            '初期化
                            w_Int = 1

                            '4週期間開始日設定
                            m_4WeekKikan(1).StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))

                            Do
                                '28日 加算(次の開始日 算出)
                                w_Var_From = DateAdd(DateInterval.Day, 28, Date.Parse(w_Var_From))
                                '計画期間最終日とｶﾚﾝﾀﾞｰ終了日を比較
                                If DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From)) >= w_Var_To Then
                                    Exit Do
                                End If
                                w_Var = DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From))
                                '4週期間終了日設定
                                m_4WeekKikan(w_Int).EndDate = Integer.Parse(Format(w_Var, "yyyyMMdd"))

                                w_Int = w_Int + 1
                                ReDim Preserve m_4WeekKikan(w_Int)

                                '4週期間開始日設定
                                m_4WeekKikan(w_Int).StartDate = Integer.Parse(Format(w_Var_From, "yyyyMMdd"))
                            Loop

                            '4週期間終了日設定
                            w_Var = DateAdd(DateInterval.Day, -1, Date.Parse(w_Var_From))
                            m_4WeekKikan(w_Int).EndDate = Integer.Parse(Format(w_Var, "yyyyMMdd"))

                        Case BasNSK0000H.geViewType.ViewType_Week
                            '--- 計画４週／表示４週の場合 ---

                            '割当開始/終了日 設定
                            m_Schedule.StartDate = m_Display.StartDate
                            m_Schedule.EndDate = m_Display.EndDate

                            '割当期間ｴﾗｰﾁｪｯｸ 情報 配列定義
                            ReDim m_PcheckD(1)

                            '割当期間のｴﾗｰﾁｪｯｸ開始/終了日の設定
                            m_PcheckD(1).StartDate = m_Schedule.StartDate
                            m_PcheckD(1).EndDate = m_Schedule.EndDate

                            '- ｶﾚﾝﾀﾞｰ開始日 設定 ----------
                            If m_PlanNo = 1 Then
                                'ｶﾚﾝﾀﾞｰ開始日 設定
                                m_Calendar.StartDate = m_Display.StartDate
                            Else
                                'ｶﾚﾝﾀﾞｰ開始日 設定
                                m_Calendar.StartDate = m_JissekiKikan.StartDate
                            End If

                            'ｶﾚﾝﾀﾞｰ終了日 設定
                            m_Calendar.EndDate = m_Display.EndDate

                            '4週計画期間 配列定義
                            ReDim m_4WeekKikan(0)

                        Case Else
                            Exit Function
                    End Select
                Case Else
                    Exit Function
            End Select

            Set_AutoAssign = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務名称ﾏｽﾀのﾃﾞｰﾀ取得
    Private Sub Get_KinmuName()

        Const W_SUBNAME As String = "NSK0000HA Get_KinmuName"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_RecCnt As Integer
        Dim w_str As String
        Dim w_Int3 As Integer
        Try
            '初期化
            ReDim g_KinmuM(0)

            '勤務名称マスタ全件取得
            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pKN_GetKbn = 0 '0:全件 1:指定勤務部署
                .pKN_KinmuDeptCD = "" '空白

                If .mGetKinmuNameM = False Then
                    'ﾃﾞｰﾀがないとき
                Else
                    'マスタ件数
                    w_RecCnt = .fKN_KinmuCount

                    '動的配列設定
                    w_KinmuCDCount = 999
                    ReDim g_KinmuM(w_KinmuCDCount)

                    For w_Int = 1 To w_RecCnt
                        'ｲﾝﾃﾞｯｸｽ引渡し
                        .mKN_KinmuIdx = w_Int

                        'インデックス
                        w_Int2 = Integer.Parse(.fKN_KinmuCD)
                        '●勤務コード
                        g_KinmuM(w_Int2).CD = .fKN_KinmuCD
                        '●勤務名称
                        g_KinmuM(w_Int2).KinmuName = .fKN_Name
                        '●勤務記号
                        g_KinmuM(w_Int2).Mark = .fKN_MarkF
                        '●勤務分類コード
                        g_KinmuM(w_Int2).KBunruiCD = .fKN_KinmuBunruiCD
                        '●勤務割当分類コード
                        g_KinmuM(w_Int2).WBunruiCD = .fKN_AllocBunruiCD
                        '●半日フラグ
                        g_KinmuM(w_Int2).HFlg = .fKN_HalfKinmuFlg
                        '●AM勤務コード
                        g_KinmuM(w_Int2).AMCD = .fKN_AMKinmuCD
                        '●PM勤務コード
                        g_KinmuM(w_Int2).PMCD = .fKN_PMKinmuCD
                        '●時間休暇フラグ
                        g_KinmuM(w_Int2).TimeFlg = .fKN_TimeHolFlg
                        '●説明
                        g_KinmuM(w_Int2).Setumei = .fKN_KinmuExplan
                        '●代休フラグ
                        g_KinmuM(w_Int2).DaikyuFlg = .fKN_GetDaikyuFlg
                        '●休み分類コード
                        g_KinmuM(w_Int2).HolBunruiCD = .fKN_HolidayBunruiCD
                        '●勤務区分
                        g_KinmuM(w_Int2).KinmuKBN = .fKN_KinmuKbn
                        '2015/05/22 Bando Add Start =======================
                        '●有効終了日
                        g_KinmuM(w_Int2).EfftoDate = IIf(.fKN_EffToDate = 0, 99999999, .fKN_EffToDate)
                        '2015/05/22 Bando Add End   =======================

                        '●曜日制限
                        ReDim g_KinmuM(w_Int2).YoubiLimit(0)
                        w_str = General.g_objGetMaster.fKN_YoubiLimit
                        If w_str <> "" Then
                            ReDim g_KinmuM(w_Int2).YoubiLimit(Len(w_str))
                            For w_Int3 = 1 To Len(w_str)
                                g_KinmuM(w_Int2).YoubiLimit(w_Int3) = Mid(w_str, w_Int3, 1)
                            Next w_Int3
                        End If
                    Next w_Int
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '休み分類名称ﾏｽﾀのﾃﾞｰﾀ取得
    Private Sub Get_HolidayBunruiName()

        Const W_SUBNAME As String = "NSK0000HA Get_HolidayBunruiName"

        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Int As Integer
        Dim w_RecCnt As Integer
        Dim w_CD_F As ADODB.Field
        Dim w_Name_F As ADODB.Field
        Dim w_SName_F As ADODB.Field
        Dim w_MarkF_F As ADODB.Field
        Dim w_Explanation_F As ADODB.Field
        Dim w_DivFlg_F As ADODB.Field
        Dim w_From_F As ADODB.Field
        Dim w_To_F As ADODB.Field
        Dim w_AppliCD_F As ADODB.Field
        Try
            '初期化
            ReDim g_HolidayBunruiM(0)

            If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                '休み分類マスタ全件取得
                w_strSql = "Select HolidayBunruiCD , Name , SecName , MarkF , Explanation "
                w_strSql = w_strSql & ", GetDivHolChkFlg , GetPosFromDate , GetPosToDate , AppliCD "
                w_strSql = w_strSql & "From NS_HOLIDAYBUNRUI_M "
                w_strSql = w_strSql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
                w_strSql = w_strSql & "Order By DispNo "

                'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ 生成 
                w_Rs = General.paDBRecordSetOpen(w_strSql)

                With w_Rs
                    If .RecordCount <= 0 Then
                        'ﾃﾞｰﾀがないとき
                    Else
                        'マスタ件数
                        .MoveLast()
                        w_RecCnt = .RecordCount
                        .MoveFirst()

                        '動的配列設定
                        ReDim g_HolidayBunruiM(w_RecCnt)

                        w_CD_F = .Fields("HolidayBunruiCD")
                        w_Name_F = .Fields("Name")
                        w_SName_F = .Fields("SecName")
                        w_MarkF_F = .Fields("MarkF")
                        w_Explanation_F = .Fields("Explanation")
                        w_DivFlg_F = .Fields("GetDivHolChkFlg")
                        w_From_F = .Fields("GetPosFromDate")
                        w_To_F = .Fields("GetPosToDate")
                        w_AppliCD_F = .Fields("AppliCD")

                        For w_Int = 1 To w_RecCnt
                            '●休み分類コード
                            g_HolidayBunruiM(w_Int).CD = w_CD_F.Value
                            '●休み分類名称
                            g_HolidayBunruiM(w_Int).HolidayName = IIf(IsDBNull(w_Name_F.Value), "", w_Name_F.Value)
                            '●休み分類略称
                            g_HolidayBunruiM(w_Int).SecName = IIf(IsDBNull(w_SName_F.Value), "", w_SName_F.Value)
                            '●休み分類記号
                            g_HolidayBunruiM(w_Int).Mark = IIf(IsDBNull(w_MarkF_F.Value), "", w_MarkF_F.Value)
                            '●説明
                            g_HolidayBunruiM(w_Int).Setumei = IIf(IsDBNull(w_Explanation_F.Value), "", w_Explanation_F.Value)
                            '●分割休暇取得フラグ
                            g_HolidayBunruiM(w_Int).DivFlg = IIf(IsDBNull(w_DivFlg_F.Value), "", w_DivFlg_F.Value)
                            '●取得可能日FROM
                            g_HolidayBunruiM(w_Int).GetPosFrom = IIf(IsDBNull(w_From_F.Value), 0, w_From_F.Value)
                            '●取得可能日TO
                            g_HolidayBunruiM(w_Int).GetPosTo = IIf(IsDBNull(w_To_F.Value), 0, w_To_F.Value)
                            '●届出コード
                            g_HolidayBunruiM(w_Int).AppliCD = IIf(IsDBNull(w_AppliCD_F.Value), "", w_AppliCD_F.Value)

                            .MoveNext()
                        Next w_Int
                    End If

                    .Close()
                End With
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '採用CDを取得 (時間年休取得時使用)
    Private Function Get_SaiyoCD(ByVal p_Date As Integer, ByVal p_StaffID As String) As String

        Const W_SUBNAME As String = "NSK0000HA Get_SaiyoCD"


        Dim w_RecCnt As Integer
        Try
            '採用CDを取得
            General.g_objGetData.p病院CD = General.g_strHospitalCD

            General.g_objGetData.p職員番号 = p_StaffID '職員管理番号

            General.g_objGetData.p日付区分 = 0 '日付は単一日を指定

            General.g_objGetData.p開始年月日 = p_Date '開始年月日

            General.g_objGetData.p履歴ソートFLG = 1 '降順

            If General.g_objGetData.mStaffInit = False Then
                Get_SaiyoCD = ""
            Else
                w_RecCnt = General.g_objGetData.f職員管理件数

                '単一日指定なので必ず１件になる
                General.g_objGetData.p職員管理索引 = 1

                Get_SaiyoCD = General.g_objGetData.f採用条件CD
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '応援勤務者の看護単位CDを取得
    Private Sub Get_OuenKangoCD(ByVal p_Date As Integer, ByVal p_Index As Integer, ByRef p_KangoCD As String)

        Const W_SUBNAME As String = "NSK0000HA Get_OuenKangoCD"

        p_KangoCD = ""
        Try
            'HospitalCD
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p職員番号 = m_StaffData(p_Index).ID '職員番号
                .p日付区分 = 0 '日付区分(単一日指定)
                .p開始年月日 = p_Date '開始年月日

                If .mStaffInit = False Then
                    p_KangoCD = ""
                Else
                    'データは必ず１件になる
                    .p勤務地異動索引 = .f勤務地異動件数
                    p_KangoCD = .f看護単位CD1
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '代休チェック
    Private Function Check_Daikyu(ByVal p_Ivent As String, ByVal p_Date As Object, ByVal p_StaffIdx As Integer, ByVal p_KinmuCD As String) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Check_Daikyu"

        Dim w_lngRet As Integer
        Dim w_frmDaikyu As Object
        Dim w_Int As Integer
        Dim w_HolDate As Integer
        Dim w_HolKinmuCD As String
        Dim w_SelDate As Integer
        Dim w_Name As String
        Dim w_strDate As String
        Dim w_strMsg() As String
        Dim w_HalfDaikyuFlg As Boolean '半日代休の場合Ｔｒｕｅ
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_SelDate2 As Integer
        Dim w_intDataCnt As Integer
        Dim w_intDataCnt2 As Integer
        Dim w_indIdx As Integer

        '初期値
        Check_Daikyu = False
        Try
            m_BackColorFlg = False
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''代休データ退避
            'If p_Ivent <> "5" AndAlso p_Ivent <> "6" AndAlso p_Ivent <> "7" AndAlso p_Ivent <> "8" Then
            '    Call Set_UndoDaikyuData(0)
            'End If
            '----------------------------------------------------------------------------------------------------
            '対象職員氏名
            w_Name = m_StaffData(p_StaffIdx).StaffName
            '対象日付
            w_strDate = Format(Integer.Parse(p_Date), "0000年00月00日")

            'ペーストの場合
            If p_Ivent = "1" Then
                '祝日であるかどうか
                If InStr(m_HolDateStr, p_Date) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) = 7) Then
                    'すでにある配列の休日勤務日と選択された日付で同じ日があるか
                    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                        '代休取得済みであるかチェック
                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = Integer.Parse(p_Date) Then
                            For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                                If m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate <> 0 Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "代休取得済みの勤務です。~n"
                                    Call Set_MsgZOrder("NS0110", w_strMsg, w_lngRet, 0)
                                    Exit Function
                                End If
                            Next w_Int2
                        End If
                    Next w_Int

                    Select Case g_KinmuM(Integer.Parse(p_KinmuCD)).DaikyuFlg

                        Case "1"

                            '祝日に勤務分類=勤務の勤務CDを貼り付けた時は代休データを作成する
                            If m_DaikyuMsgFlg = 0 Then
                                ReDim w_strMsg(1)
                                w_strMsg(1) = w_Name & "さんの" & w_strDate & "は"
                                Call Set_MsgZOrder("NS0111", w_strMsg, w_lngRet, 0)
                            Else
                                '非表示の場合、必ず取得
                                w_lngRet = MsgBoxResult.Yes
                            End If
                            If w_lngRet = MsgBoxResult.Yes Then
                                '代休情報更新
                                Call UpDate_DaikyuData(p_Date, p_StaffIdx, 0, p_KinmuCD)

                                m_BackColorFlg = True
                            Else
                                '代休情報更新
                                Call UpDate_DaikyuData(p_Date, p_StaffIdx, 1, "")
                            End If
                        Case "2"
                            If g_KinmuM(Integer.Parse(p_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                '祝日に代休を貼り付けた場合、代休は取得できない
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "この日に代休を"
                                Call Set_MsgZOrder("NS0112", w_strMsg, w_lngRet, 0)
                                Exit Function
                            Else
                                '祝日に勤務分類=休みの勤務CDを貼り付けた時は代休データが存在すれば削除する
                                Call UpDate_DaikyuData(p_Date, p_StaffIdx, 1, "")
                            End If
                    End Select

                    '置換画面で置換後の勤務を未割当にした場合
                    If p_KinmuCD = "000" Then
                        '代休情報更新
                        Call UpDate_DaikyuData(p_Date, p_StaffIdx, 1, "")
                    End If
                Else
                    '祝日でない場合
                    If g_KinmuM(Integer.Parse(p_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                        '休み分類CDが代休である場合画面表示

                        w_frmDaikyu = New frmNSK0000HJ

                        w_frmDaikyu.pSelDate = Integer.Parse(p_Date)
                        w_frmDaikyu.pSelKinmuCD = p_KinmuCD
                        w_frmDaikyu.pSelMngStaffID = m_StaffData(p_StaffIdx).ID
                        '起動元（"0":計画 それ以外:初期画面）
                        w_frmDaikyu.pKeikakuFlg = "0"
                        '代休データを渡す
                        For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                            'リスト対象データであるか
                            If m_StaffData(p_StaffIdx).Daikyu(w_Int).OutPutList = "1" Then
                                If m_DaikyuAdvFlg = 0 Then
                                    '代休有効期限があるか？
                                    If m_lngDaikyuPastPeriod = -1 Then
                                        '代休有効期限なし
                                        '対象日付より過去のデータか？
                                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate < Integer.Parse(p_Date) Then
                                            w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                            w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                            '情報引渡し
                                            '代休の未使用分も渡す
                                            w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                        End If
                                    Else
                                        '代休有効期限あり
                                        '対象日付より過去のデータかつ指定日(ﾃﾞﾌｫﾙﾄ56日)前までであるか
                                        If (m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate < Integer.Parse(p_Date)) AndAlso (DateDiff(DateInterval.Day, Date.Parse(Format(m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate, "0000/00/00")), Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) <= m_lngDaikyuPastPeriod) Then
                                            '対象日付より過去のデータであるか
                                            w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                            w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                            '情報引渡し
                                            '代休の未使用分も渡す
                                            w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                        End If
                                    End If
                                Else
                                    ' 指定日前後であるかどうか
                                    If m_lngDaikyuPastPeriod = -1 Then
                                        If m_DaikyuAdvThisMonthFlg = 0 Then
                                            w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                            w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                            '情報引渡し
                                            '代休の未使用分も渡す
                                            w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                        Else
                                            If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate <= Double.Parse(Format(DateAdd(DateInterval.Day, -1, DateAdd(DateInterval.Month, 1, Date.Parse(Format(Integer.Parse(General.paLeft(p_Date, 6) & "01"), "0000/00/00")))), "yyyyMMdd")) Then
                                                w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                                w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                                '情報引渡し
                                                '代休の未使用分も渡す
                                                w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                            End If
                                        End If
                                    Else
                                        If m_DaikyuAdvThisMonthFlg = 0 Then
                                            If (DateDiff(DateInterval.Day, Date.Parse(Format(m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate, "0000/00/00")), Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) <= m_lngDaikyuPastPeriod) AndAlso (DateDiff(DateInterval.Day, Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00")), Date.Parse(Format(m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate, "0000/00/00"))) <= m_lngDaikyuPastPeriod) Then
                                                w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                                w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                                '情報引渡し
                                                '代休の未使用分も渡す
                                                w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                            End If
                                        Else
                                            If DateDiff(DateInterval.Day, Date.Parse(Format(m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate, "0000/00/00")), Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) <= m_lngDaikyuPastPeriod AndAlso m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate <= Double.Parse(Format(DateAdd(DateInterval.Day, -1, DateAdd(DateInterval.Month, 1, Date.Parse(Format(Integer.Parse(General.paLeft(p_Date, 6) & "01"), "0000/00/00")))), "yyyyMMdd")) AndAlso DateDiff(DateInterval.Day, Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00")), Date.Parse(Format(m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate, "0000/00/00"))) <= m_lngDaikyuPastPeriod Then
                                                w_HolDate = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate
                                                w_HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD
                                                '情報引渡し
                                                '代休の未使用分も渡す
                                                w_frmDaikyu.pDaikyuData(w_HolDate, w_HolKinmuCD) = m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        Next w_Int

                        If w_frmDaikyu.mfncDaikyuDate_Check = False Then
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "この日に代休を"
                            Call Set_MsgZOrder("NS0112", w_strMsg, w_lngRet, 0)
                            Exit Function
                        Else
                            '祝日以外に代休を貼り付けた場合、代休管理Ｆを取得し、取得できる代休の一覧画面を出力する。

                            'ﾊﾟﾚｯﾄが表示されている場合
                            If m_lstmnuView(M_MenuPalette).Checked = True Then
                                m_PaletteForm.Hide()
                            End If

                            '検索画面が表示されている場合
                            If m_KensakuForm.pShowFlg = True Then
                                '検索の表示位置の最上位設定をはずす
                                Call General.paNotTopPos(m_KensakuForm)
                            End If

                            '置換画面が表示されている場合
                            If m_ChikanForm.pShowFlg = True Then
                                '置換の表示位置の最上位設定をはずす
                                Call General.paNotTopPos(m_ChikanForm)
                            End If

                            '並び替え画面が表示されている場合
                            If m_SortForm.pShowFlg = True Then
                                '並び替えの表示位置の最上位設定をはずす
                                Call General.paNotTopPos(m_SortForm)
                            End If

                            '並び替え画面が表示されている場合
                            If m_EventForm.pShowFlg = True Then
                                '並び替えの表示位置の最上位設定をはずす
                                Call General.paNotTopPos(m_EventForm)
                            End If

                            'ﾌｫｰﾑ表示
                            w_frmDaikyu.ShowDialog(Me)

                            'ﾊﾟﾚｯﾄが表示されている場合
                            If m_lstmnuView(M_MenuPalette).Checked = True Then
                                'ﾊﾟﾚｯﾄ画面を最上位に設定する
                                m_PaletteForm.Show()
                            End If

                            '検索画面が表示されている場合
                            If m_KensakuForm.pShowFlg = True Then
                                '検索画面を最上位に設定する
                                Call General.paSetDialogPos(m_KensakuForm)
                            End If

                            '置換画面が表示されている場合
                            If m_ChikanForm.pShowFlg = True Then
                                '置換画面を最上位に設定する
                                Call General.paSetDialogPos(m_ChikanForm)
                            End If

                            '並び替え画面が表示されている場合
                            If m_SortForm.pShowFlg = True Then
                                '並び替え画面を最上位に設定する
                                Call General.paSetDialogPos(m_SortForm)
                            End If

                            '並び替え画面が表示されている場合
                            If m_EventForm.pShowFlg = True Then
                                '並び替えの表示位置の最上位設定をはずす
                                Call General.paSetDialogPos(m_EventForm)
                            End If

                            If w_frmDaikyu.pEndStatus = False Then
                                Exit Function
                            Else
                                'OKﾎﾞﾀﾝ押下時
                                w_SelDate = w_frmDaikyu.pSelDate

                                '半日＋半日代休を取得した場合の２つ目の代休発生元日付を取得
                                w_SelDate2 = w_frmDaikyu.pSelDate2
                                '取得した代休が半日代休か取得
                                w_HalfDaikyuFlg = w_frmDaikyu.pGetDaikyuType

                                '代休の日にさらに代休を貼り付けた場合元の代休データをクリア
                                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                                    w_intDataCnt = UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                                    For w_Int2 = 1 To w_intDataCnt
                                        If w_Int2 > UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail) Then
                                            Exit For
                                        End If

                                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = Integer.Parse(p_Date) Then
                                            'クリアするので代休未使用分に加算
                                            With m_StaffData(p_StaffIdx).Daikyu(w_Int)
                                                '通常の代休か半日代休かチェック
                                                Select Case .DaikyuDetail(w_Int2).GetFlg
                                                    Case "0"
                                                        '１日
                                                        .RemainderHol = .RemainderHol + 1
                                                    Case "1"
                                                        '半日
                                                        .RemainderHol = .RemainderHol + 0.5
                                                End Select
                                                'クリア
                                                .DaikyuDetail(w_Int2).DaikyuDate = 0
                                                .DaikyuDetail(w_Int2).DaikyuKinmuCD = ""
                                                .DaikyuDetail(w_Int2).GetFlg = ""
                                                .OutPutList = "1"

                                                If w_Int2 < UBound(.DaikyuDetail) Then
                                                    w_indIdx = w_Int2
                                                    For w_Int3 = w_Int2 + 1 To UBound(.DaikyuDetail)
                                                        .DaikyuDetail(w_indIdx) = .DaikyuDetail(w_Int3)
                                                        w_indIdx = w_indIdx + 1
                                                    Next w_Int3
                                                    '配列調整
                                                    ReDim Preserve .DaikyuDetail(UBound(.DaikyuDetail) - 1)
                                                End If
                                            End With
                                            Exit For
                                        End If
                                    Next w_Int2
                                Next w_Int

                                '選択された日付のデータに代休CDと日付を格納
                                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                                    With m_StaffData(p_StaffIdx).Daikyu(w_Int)
                                        If .OutPutList = "1" AndAlso (.HolDate = w_SelDate OrElse .HolDate = w_SelDate2) Then
                                            If .DaikyuDetail(1).DaikyuDate = 0 Then
                                                w_Int2 = 1
                                            Else
                                                w_Int2 = UBound(.DaikyuDetail) + 1
                                                ReDim Preserve .DaikyuDetail(w_Int2)
                                            End If

                                            .DaikyuDetail(w_Int2).DaikyuDate = Integer.Parse(p_Date)
                                            .DaikyuDetail(w_Int2).DaikyuKinmuCD = p_KinmuCD

                                            '代休未使用分から差し引く
                                            If w_HalfDaikyuFlg = True OrElse w_SelDate2 <> 0 Then
                                                '半日代休
                                                .RemainderHol = .RemainderHol - 0.5
                                                .DaikyuDetail(w_Int2).GetFlg = "1"
                                            Else
                                                '１日代休
                                                .RemainderHol = .RemainderHol - 1
                                                .DaikyuDetail(w_Int2).GetFlg = "0"
                                            End If
                                            '代休未使用分が０になった場合
                                            If .RemainderHol <= 0 Then
                                                'リスト表示しない
                                                .OutPutList = "0"
                                            End If
                                        End If
                                    End With
                                Next w_Int
                            End If
                        End If
                    Else
                        '祝日以外に代休以外の勤務を貼り付けた場合、その日の元勤務が代休の場合,代休管理Ｆの代休取得年月日をNULLで更新する
                        '代休を取得しているかチェックし、取得していたら配列から代休データを削除
                        For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                            w_intDataCnt = UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                            For w_Int2 = 1 To w_intDataCnt
                                If w_Int2 > UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail) Then
                                    Exit For
                                End If

                                If m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = Integer.Parse(p_Date) Then
                                    'クリアするので代休未使用分に加算
                                    With m_StaffData(p_StaffIdx).Daikyu(w_Int)
                                        '通常の代休か半日代休かチェック
                                        Select Case .DaikyuDetail(w_Int2).GetFlg
                                            Case "0"
                                                '１日
                                                .RemainderHol = .RemainderHol + 1
                                            Case "1"
                                                '半日
                                                .RemainderHol = .RemainderHol + 0.5
                                        End Select
                                        'クリア
                                        .DaikyuDetail(w_Int2).DaikyuDate = 0
                                        .DaikyuDetail(w_Int2).DaikyuKinmuCD = ""
                                        .DaikyuDetail(w_Int2).GetFlg = ""
                                        .OutPutList = "1"

                                        w_intDataCnt = UBound(.DaikyuDetail)
                                        If w_Int2 < w_intDataCnt Then
                                            w_indIdx = w_Int2
                                            For w_Int3 = w_Int2 + 1 To w_intDataCnt
                                                .DaikyuDetail(w_indIdx) = .DaikyuDetail(w_Int3)
                                                w_indIdx = w_indIdx + 1
                                            Next w_Int3
                                            '配列調整
                                            ReDim Preserve .DaikyuDetail(UBound(.DaikyuDetail) - 1)
                                        End If
                                    End With
                                End If
                            Next w_Int2
                        Next w_Int
                    End If
                End If
            ElseIf p_Ivent = "2" OrElse p_Ivent = "3" OrElse p_Ivent = "5" OrElse p_Ivent = "7" OrElse p_Ivent = "8" Then
                '削除の場合
                '祝日であるかどうか
                If InStr(m_HolDateStr, p_Date) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00"))) = 7) Then
                    '代休を取得している勤務でないかチェック
                    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = Integer.Parse(p_Date) Then
                            If m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(1).DaikyuDate <> 0 Then
                                If p_Ivent = "2" Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "代休を取得しているので"
                                    Call Set_MsgZOrder("NS0098", w_strMsg, w_lngRet, 0)
                                ElseIf p_Ivent = "3" Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "代休を取得しているので"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_lngRet, 0)
                                ElseIf p_Ivent = "8" Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "代休取得済みの勤務があります。~n勤務を"
                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_lngRet, 0)
                                End If
                                Exit Function
                            End If
                        End If
                    Next w_Int

                    '代休情報更新
                    Call UpDate_DaikyuData(p_Date, p_StaffIdx, 1, "")
                Else
                    '祝日でない場合
                    '代休を取得しているかチェックし、取得していたら配列から代休データを削除
                    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                        With m_StaffData(p_StaffIdx).Daikyu(w_Int)
                            w_intDataCnt = UBound(.DaikyuDetail)
                            For w_Int2 = 1 To w_intDataCnt
                                If w_Int2 > UBound(.DaikyuDetail) Then
                                    Exit For
                                End If

                                If .DaikyuDetail(w_Int2).DaikyuDate = Integer.Parse(p_Date) Then
                                    'クリアするので代休未使用分に加算
                                    '通常の代休か半日代休かチェック
                                    Select Case .DaikyuDetail(w_Int2).GetFlg
                                        Case "0"
                                            '１日
                                            .RemainderHol = .RemainderHol + 1
                                        Case "1"
                                            '半日
                                            .RemainderHol = .RemainderHol + 0.5
                                    End Select

                                    .DaikyuDetail(w_Int2).DaikyuDate = 0
                                    .DaikyuDetail(w_Int2).DaikyuKinmuCD = ""
                                    .DaikyuDetail(w_Int2).GetFlg = ""
                                    .OutPutList = "1"

                                    w_intDataCnt2 = UBound(.DaikyuDetail)
                                    If w_Int2 < w_intDataCnt2 Then
                                        w_indIdx = w_Int2
                                        For w_Int3 = w_Int2 + 1 To w_intDataCnt2
                                            .DaikyuDetail(w_indIdx) = .DaikyuDetail(w_Int3)
                                            w_indIdx = w_indIdx + 1
                                        Next w_Int3
                                        '配列調整
                                        ReDim Preserve .DaikyuDetail(w_intDataCnt2 - 1)
                                    End If
                                End If
                            Next w_Int2
                        End With
                    Next w_Int
                End If
            ElseIf p_Ivent = "4" OrElse p_Ivent = "6" Then
                '置換の場合
                'すでにある配列の休日勤務日と選択された日付で同じ日があるか
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                    '代休取得済みであるかチェック
                    If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = Integer.Parse(p_Date) Then
                        For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                            If m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate <> 0 Then
                                Exit Function
                            End If
                        Next w_Int2
                    End If
                Next w_Int
            End If

            Check_Daikyu = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '代休整合性チェック     p_Mode ---- (0:Load時の配列調整 1:保存時のチェック)
    Private Function Adjust_Daikyu(ByVal p_Mode As Integer) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Adjust_Daikyu"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_HolDate As String
        Dim w_HolKinmuCD As String
        Dim w_DaikyuDate As String
        Dim w_DaikyuKinmuCD As String
        Dim w_KinmuCD As String = String.Empty
        Dim w_DeleteDate() As Integer
        Dim w_DeleteFlg As Boolean
        Dim w_Index As Integer
        Dim w_CurrentDate As Integer
        Dim w_StartDate As Date '計画開始日
        Dim w_Var As Object
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_IdoLoop As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_Idocnt As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_Day As String
        Dim w_MsgRc As Integer
        Dim w_GetCol As Integer
        Dim w_StaffName As String
        Dim w_DaikyuKinmuFlg As Boolean
        Dim w_DaikyuCheckFlg As Boolean
        Dim w_blnFLG As Boolean
        Dim w_strMsg() As String
        Dim w_lngLoop As Integer
        Dim w_Int3 As Integer
        Dim w_indIdx As Integer
        Dim w_intDataCnt As Integer
        Dim w_lngLoop1 As Integer
        Dim w_strDaikyuFlg As String '代休取得ﾌﾗｸﾞ(1:可能 2:不可)

        Adjust_Daikyu = False
        Try
            If p_Mode = 0 Then
                For w_Int = 1 To UBound(m_StaffData)
                    '応援勤務者ではない職員のみ
                    If m_StaffData(w_Int).OuenStaffFlg = 0 Then

                        ReDim w_DeleteDate(0)

                        '代休データ分ループ
                        For w_Int2 = 1 To UBound(m_StaffData(w_Int).Daikyu)
                            For w_lngLoop = 1 To UBound(m_StaffData(w_Int).Daikyu(w_Int2).DaikyuDetail)

                                w_DeleteFlg = False

                                '休日勤務日
                                w_HolDate = Convert.ToString(m_StaffData(w_Int).Daikyu(w_Int2).HolDate)
                                '休日勤務CD
                                w_HolKinmuCD = m_StaffData(w_Int).Daikyu(w_Int2).HolKinmuCD
                                '代休取得日
                                w_DaikyuDate = Convert.ToString(m_StaffData(w_Int).Daikyu(w_Int2).DaikyuDetail(w_lngLoop).DaikyuDate)
                                '代休勤務CD
                                w_DaikyuKinmuCD = m_StaffData(w_Int).Daikyu(w_Int2).DaikyuDetail(w_lngLoop).DaikyuKinmuCD

                                '新規作成かつ休日出勤日が計画開始日以後の場合
                                If (m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN) AndAlso (Integer.Parse(w_HolDate) >= m_KeikakuKikan.StartDate) Then
                                    '新規作成の場合

                                    '**************************
                                    '予定データを取得(休日出勤日)
                                    '**************************
                                    '2017/11/17 Angelo add st----------------------------------------------
                                    '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                                    If m_intSelSaveNo > 0 Then
                                        '一時保存からデータの取得
                                        General.g_objGetData.p取得区分 = 1
                                        General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                        General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                                    Else
                                        '予定勤務からデータの取得
                                        General.g_objGetData.p取得区分 = 0
                                    End If
                                    '2017/11/17 Angelo add en----------------------------------------------
                                    'HospitalCD
                                    General.g_objGetData.p病院CD = General.g_strHospitalCD
                                    '職員番号
                                    General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID
                                    '実績も取得する
                                    '取得区分(予定・実績)
                                    General.g_objGetData.p勤務取得区分 = 2
                                    '日付区分
                                    General.g_objGetData.p日付区分 = 0
                                    '開始年月日
                                    General.g_objGetData.p開始年月日 = w_HolDate

                                    If General.g_objGetData.mGetkinmu = False Then
                                        'データがない場合は配列から削除
                                        w_Index = UBound(w_DeleteDate) + 1
                                        ReDim Preserve w_DeleteDate(w_Index)
                                        w_DeleteDate(w_Index) = Integer.Parse(w_HolDate)
                                    Else

                                        '計画期間外の場合、実績を取得
                                        w_KinmuCD = ""
                                        If Integer.Parse(w_HolDate) > m_KeikakuKikan.EndDate Then
                                            General.g_objGetData.p実績年月日 = w_HolDate
                                            w_KinmuCD = General.g_objGetData.f実績勤務CD
                                        End If
                                        If w_KinmuCD = "" Then
                                            General.g_objGetData.p予定年月日 = w_HolDate
                                            w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        End If

                                        '休日勤務CDと勤務CDが違う場合は削除
                                        If w_KinmuCD <> w_HolKinmuCD Then

                                            '予定の勤務が代休取得可能勤務の場合、代休を発生させる

                                            '初期化
                                            w_strDaikyuFlg = ""

                                            '既に確定されている期間かチェック
                                            If SearchKakuteiData() = True Then
                                                '確定済みの場合
                                                '代休発生する勤務かチェック
                                                For w_lngLoop1 = 1 To UBound(g_KinmuM)
                                                    If w_KinmuCD = g_KinmuM(w_lngLoop1).CD Then
                                                        w_strDaikyuFlg = g_KinmuM(w_lngLoop1).DaikyuFlg
                                                        Exit For
                                                    End If
                                                Next w_lngLoop1
                                            End If

                                            If w_strDaikyuFlg = "1" Then
                                                '代休発生勤務の場合、休日勤務を変更
                                                m_StaffData(w_Int).Daikyu(w_Int2).HolKinmuCD = w_KinmuCD
                                            Else
                                                w_Index = UBound(w_DeleteDate) + 1
                                                ReDim Preserve w_DeleteDate(w_Index)
                                                w_DeleteDate(w_Index) = Integer.Parse(w_HolDate)
                                            End If
                                        End If
                                    End If

                                    If w_DaikyuDate <> "0" Then
                                        '**************************
                                        '予定データを取得(代休取得日)
                                        '**************************
                                        'HospitalCD
                                        General.g_objGetData.p病院CD = General.g_strHospitalCD
                                        '職員番号
                                        General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID

                                        '実績も取得する
                                        '取得区分(予定・実績)
                                        General.g_objGetData.p勤務取得区分 = 2
                                        '日付区分
                                        General.g_objGetData.p日付区分 = 0
                                        '開始年月日
                                        General.g_objGetData.p開始年月日 = w_DaikyuDate

                                        If General.g_objGetData.mGetkinmu = False Then
                                            '予定データがない場合は配列から削除
                                            With m_StaffData(w_Int).Daikyu(w_Int2)
                                                If .DaikyuDetail(w_lngLoop).DaikyuDate = 0 Then
                                                    'クリアするので代休未使用分に加算
                                                    '１日代休か半日代休かチェック
                                                    Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                        Case "0"
                                                            '１日
                                                            .RemainderHol = .RemainderHol + 1
                                                        Case "1"
                                                            '半日
                                                            .RemainderHol = .RemainderHol + 0.5
                                                    End Select
                                                    'クリア
                                                    .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                    .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                    .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                    .OutPutList = "1"
                                                End If
                                            End With
                                        Else

                                            '計画期間外の場合、実績を取得
                                            w_KinmuCD = ""

                                            If Integer.Parse(w_DaikyuDate) < m_KeikakuKikan.StartDate Then
                                                General.g_objGetData.p実績年月日 = w_DaikyuDate
                                                w_KinmuCD = General.g_objGetData.f実績勤務CD
                                            End If

                                            If w_KinmuCD = "" Then
                                                General.g_objGetData.p予定年月日 = w_DaikyuDate
                                                w_KinmuCD = General.g_objGetData.f予定勤務CD
                                            End If

                                            '休日勤務CDと勤務CDが違う場合は削除
                                            If w_KinmuCD <> w_DaikyuKinmuCD Then
                                                With m_StaffData(w_Int).Daikyu(w_Int2)
                                                    'クリアするので代休未使用分に加算
                                                    '１日代休か半日代休かチェック
                                                    Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                        Case "0"
                                                            '１日
                                                            .RemainderHol = .RemainderHol + 1
                                                        Case "1"
                                                            '半日
                                                            .RemainderHol = .RemainderHol + 0.5
                                                    End Select
                                                    'クリア
                                                    .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                    .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                    .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                    .OutPutList = "1"
                                                End With
                                            End If
                                        End If
                                    Else
                                        If w_DaikyuKinmuCD <> "" Then
                                            With m_StaffData(w_Int).Daikyu(w_Int2)
                                                'クリアするので代休未使用分に加算
                                                '１日代休か半日代休かチェック
                                                Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                    Case "0"
                                                        '１日
                                                        .RemainderHol = .RemainderHol + 1
                                                    Case "1"
                                                        '半日
                                                        .RemainderHol = .RemainderHol + 0.5
                                                End Select
                                                'クリア
                                                .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                .OutPutList = "1"
                                            End With
                                        End If
                                    End If
                                Else

                                    '実績変更 or 計画変更の場合
                                    '**************************
                                    '実績データを取得(休日出勤日)
                                    '**************************
                                    'HospitalCD
                                    General.g_objGetData.p病院CD = General.g_strHospitalCD
                                    '職員番号
                                    General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID
                                    '取得区分(実績)
                                    General.g_objGetData.p勤務取得区分 = 1
                                    '日付区分
                                    General.g_objGetData.p日付区分 = 0
                                    '開始年月日
                                    General.g_objGetData.p開始年月日 = w_HolDate

                                    If General.g_objGetData.mGetkinmu = False Then
                                        '**************************************
                                        '実績データがない場合は予定データを取得
                                        '**************************************
                                        '2017/11/17 Angelo add st----------------------------------------------
                                        '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                                        If m_intSelSaveNo > 0 Then
                                            '一時保存からデータの取得
                                            General.g_objGetData.p取得区分 = 1
                                            General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                            General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                                        Else
                                            '予定勤務からデータの取得
                                            General.g_objGetData.p取得区分 = 0
                                        End If
                                        '2017/11/17 Angelo add en----------------------------------------------
                                        'HospitalCD
                                        General.g_objGetData.p病院CD = General.g_strHospitalCD
                                        '職員番号
                                        General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID
                                        '取得区分(予定)
                                        General.g_objGetData.p勤務取得区分 = 0
                                        '日付区分
                                        General.g_objGetData.p日付区分 = 0
                                        '開始年月日
                                        General.g_objGetData.p開始年月日 = w_HolDate

                                        If General.g_objGetData.mGetkinmu = False Then
                                            '予定データもない場合は配列から削除
                                            w_Index = UBound(w_DeleteDate) + 1
                                            ReDim Preserve w_DeleteDate(w_Index)
                                            w_DeleteDate(w_Index) = Integer.Parse(w_HolDate)
                                            w_DeleteFlg = True
                                        Else
                                            General.g_objGetData.p予定年月日 = w_HolDate
                                            w_KinmuCD = General.g_objGetData.f予定勤務CD
                                        End If
                                    Else
                                        General.g_objGetData.p実績年月日 = w_HolDate
                                        w_KinmuCD = General.g_objGetData.f実績勤務CD
                                    End If

                                    '休日勤務CDと勤務CDが違う場合は削除
                                    If w_KinmuCD <> w_HolKinmuCD Then
                                        If w_DeleteFlg = False Then
                                            w_Index = UBound(w_DeleteDate) + 1
                                            ReDim Preserve w_DeleteDate(w_Index)
                                            w_DeleteDate(w_Index) = Integer.Parse(w_HolDate)
                                        End If
                                    End If

                                    If w_DaikyuDate <> "0" Then
                                        '**************************
                                        '実績データを取得(代休取得日)
                                        '**************************
                                        'HospitalCD
                                        General.g_objGetData.p病院CD = General.g_strHospitalCD
                                        '職員番号
                                        General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID
                                        '取得区分(実績)
                                        General.g_objGetData.p勤務取得区分 = 1
                                        '日付区分
                                        General.g_objGetData.p日付区分 = 0
                                        '開始年月日
                                        General.g_objGetData.p開始年月日 = w_DaikyuDate

                                        If General.g_objGetData.mGetkinmu = False Then
                                            '**************************************
                                            '実績データがない場合は予定データを取得
                                            '**************************************
                                            '2017/11/17 Angelo add st----------------------------------------------
                                            '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                                            If m_intSelSaveNo > 0 Then
                                                '一時保存からデータの取得
                                                General.g_objGetData.p取得区分 = 1
                                                General.g_objGetData.p計画番号 = m_PlanNo '計画番号
                                                General.g_objGetData.p保存番号 = m_intSelSaveNo '保存番号
                                            Else
                                                '予定勤務からデータの取得
                                                General.g_objGetData.p取得区分 = 0
                                            End If
                                            '2017/11/17 Angelo add en----------------------------------------------
                                            'HospitalCD
                                            General.g_objGetData.p病院CD = General.g_strHospitalCD
                                            '職員番号
                                            General.g_objGetData.p職員番号 = m_StaffData(w_Int).ID
                                            '取得区分(予定)
                                            General.g_objGetData.p勤務取得区分 = 0
                                            '日付区分
                                            General.g_objGetData.p日付区分 = 0
                                            '開始年月日
                                            General.g_objGetData.p開始年月日 = w_DaikyuDate

                                            If General.g_objGetData.mGetkinmu = False Then
                                                '予定データもない場合は配列から削除
                                                With m_StaffData(w_Int).Daikyu(w_Int2)
                                                    'クリアするので代休未使用分に加算
                                                    '１日代休か半日代休かチェック
                                                    Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                        Case "0"
                                                            '１日
                                                            .RemainderHol = .RemainderHol + 1
                                                        Case "1"
                                                            '半日
                                                            .RemainderHol = .RemainderHol + 0.5
                                                    End Select
                                                    'クリア
                                                    .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                    .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                    .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                    .OutPutList = "1"
                                                End With
                                            Else
                                                General.g_objGetData.p予定年月日 = w_DaikyuDate
                                                w_KinmuCD = General.g_objGetData.f予定勤務CD
                                            End If
                                        Else
                                            General.g_objGetData.p実績年月日 = w_DaikyuDate
                                            w_KinmuCD = General.g_objGetData.f実績勤務CD
                                        End If

                                        '休日勤務CDと勤務CDが違う場合は削除
                                        If w_KinmuCD <> w_DaikyuKinmuCD Then
                                            With m_StaffData(w_Int).Daikyu(w_Int2)
                                                'クリアするので代休未使用分に加算
                                                '１日代休か半日代休かチェック
                                                Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                    Case "0"
                                                        '１日
                                                        .RemainderHol = .RemainderHol + 1
                                                    Case "1"
                                                        '半日
                                                        .RemainderHol = .RemainderHol + 0.5
                                                End Select
                                                'クリア
                                                .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                .OutPutList = "1"
                                            End With
                                        End If
                                    Else
                                        If w_DaikyuKinmuCD <> "" Then
                                            With m_StaffData(w_Int).Daikyu(w_Int2)
                                                'クリアするので代休未使用分に加算
                                                '１日代休か半日代休かチェック
                                                Select Case .DaikyuDetail(w_lngLoop).GetFlg
                                                    Case "0"
                                                        '１日
                                                        .RemainderHol = .RemainderHol + 1
                                                    Case "1"
                                                        '半日
                                                        .RemainderHol = .RemainderHol + 0.5
                                                End Select
                                                'クリア
                                                .DaikyuDetail(w_lngLoop).DaikyuDate = 0
                                                .DaikyuDetail(w_lngLoop).DaikyuKinmuCD = ""
                                                .DaikyuDetail(w_lngLoop).GetFlg = ""
                                                .OutPutList = "1"
                                            End With
                                        End If
                                    End If
                                End If
                            Next w_lngLoop
                        Next w_Int2

                        '配列に削除対象の日があれば削除
                        If UBound(w_DeleteDate) > 0 Then
                            For w_Int2 = 1 To UBound(w_DeleteDate)
                                Call UpDate_DaikyuData(w_DeleteDate(w_Int2), w_Int, 1, "")
                            Next w_Int2
                        End If

                        '代休詳細が複数件あり、上記処理でデータが削除されていた場合
                        'データを格納しなおす
                        For w_Int2 = 1 To UBound(m_StaffData(w_Int).Daikyu)
                            With m_StaffData(w_Int).Daikyu(w_Int2)
                                w_intDataCnt = UBound(.DaikyuDetail)
                                For w_lngLoop = 1 To w_intDataCnt
                                    If w_lngLoop > UBound(.DaikyuDetail) Then
                                        Exit For
                                    End If
                                    If .DaikyuDetail(w_lngLoop).DaikyuDate = 0 AndAlso w_lngLoop < UBound(.DaikyuDetail) Then
                                        w_indIdx = w_lngLoop
                                        For w_Int3 = w_lngLoop + 1 To UBound(.DaikyuDetail)
                                            .DaikyuDetail(w_indIdx) = .DaikyuDetail(w_Int3)
                                            w_indIdx = w_indIdx + 1
                                        Next w_Int3
                                        '配列調整
                                        ReDim Preserve .DaikyuDetail(UBound(.DaikyuDetail) - 1)
                                    ElseIf .DaikyuDetail(w_lngLoop).DaikyuDate = 0 AndAlso w_lngLoop > 1 AndAlso w_lngLoop = UBound(.DaikyuDetail) Then
                                        '配列調整
                                        ReDim Preserve .DaikyuDetail(UBound(.DaikyuDetail) - 1)
                                    End If
                                Next w_lngLoop
                            End With
                        Next w_Int2
                    End If
                Next w_Int
            ElseIf p_Mode = 1 Then

                '計画開始日付を日付型に変換
                w_StartDate = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))

                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        '配列番号 取得

                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        If IsNumeric(w_Var) = True Then

                            '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽ取得
                            w_Index = Integer.Parse(w_Var)

                            '計画期間日数Loop
                            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                                '該当列の年月日を取得
                                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                Else
                                    w_CurrentDate = 0
                                End If

                                '勤務ﾃﾞｰﾀ退避配列ｲﾝﾃﾞｯｸｽ取得
                                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(DirectCast(w_CurrentDate, Object), w_GetCol) = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                Else
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                End If

                                '配属しているの？
                                w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                                w_HaizokuFlg = False
                                For w_IdoLoop = 1 To w_Idocnt
                                    If m_StaffData(w_Index).IdoData(w_IdoLoop).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_IdoLoop).SyuryoYMD Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_IdoLoop

                                If w_HaizokuFlg = True Then
                                    '配属期間内の勤務ﾃﾞｰﾀなら

                                    w_DaikyuCheckFlg = False
                                    w_DaikyuKinmuFlg = False

                                    If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '二段表示してる時　かつ　勤務変更時
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                        If w_Var <> "" Then
                                            'まず下段を確認する
                                            w_blnFLG = True
                                        Else
                                            '下段にデータが存在しない時は上段を確認する
                                            w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_blnFLG = True
                                            Else
                                                w_blnFLG = False
                                            End If
                                        End If
                                    Else
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_blnFLG = True
                                        Else
                                            w_blnFLG = False
                                        End If
                                    End If

                                    If w_blnFLG Then
                                        '2015/04/10 Bando Upd Start ==============================
                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                        Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                        '2015/04/10 Bando Upd End   ==============================

                                        If IsNumeric(w_KinmuCD) = True Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then

                                                w_DaikyuKinmuFlg = True

                                                For w_Int = 1 To UBound(m_StaffData(w_Index).Daikyu)
                                                    For w_Int2 = 1 To UBound(m_StaffData(w_Index).Daikyu(w_Int).DaikyuDetail)
                                                        If m_StaffData(w_Index).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = w_CurrentDate Then
                                                            w_DaikyuCheckFlg = True
                                                            Exit For
                                                        End If
                                                    Next w_Int2
                                                    If w_DaikyuCheckFlg = True Then
                                                        Exit For
                                                    End If
                                                Next w_Int
                                            End If
                                        End If
                                    End If

                                    If w_DaikyuKinmuFlg = True AndAlso w_DaikyuCheckFlg = False Then
                                        '職員氏名 取得
                                        w_StaffName = m_StaffData(w_Index).StaffName
                                        '日付
                                        w_Day = Format(Date.Parse(Format(w_CurrentDate, "0000/00/00")), "MM月dd日")
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = w_StaffName & " の " & w_Day
                                        Call Set_MsgZOrder("NS0118", w_strMsg, w_MsgRc, 0)

                                        Exit Function
                                    End If
                                End If '---> 配属期間内？
                            Next w_Col
                        End If '---> 職員ﾃﾞｰﾀ変数ｲﾝﾃﾞｯｸｽ　取得できた？
                    End If
                Next w_Row
            End If

            Adjust_Daikyu = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '代休データチェック（背景色）
    Private Function Check_DaikyuBackColor(ByVal p_Date As Integer, ByVal p_StaffIdx As Integer) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Check_DaikyuBackColor"

        Dim w_Int As Integer

        '初期値
        Check_DaikyuBackColor = False
        Try
            '代休データループ
            If m_StaffData(p_StaffIdx).OuenStaffFlg = 0 Then
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                    If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = p_Date Then
                        Check_DaikyuBackColor = True
                        Exit Function
                    End If
                Next w_Int
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '代休データ（自動割当用）
    Private Function Check_DaikyuRunAuto(ByVal p_Date As Integer, ByVal p_StaffIdx As Integer) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Check_DaikyuRunAuto"

        Dim w_Int As Integer
        Dim w_Int2 As Integer

        '初期値
        Check_DaikyuRunAuto = False
        Try
            '代休データループ
            If m_StaffData(p_StaffIdx).OuenStaffFlg = 0 Then
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                    For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = p_Date Then
                            Check_DaikyuRunAuto = True
                            Exit Function
                        ElseIf m_StaffData(p_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = p_Date Then
                            Check_DaikyuRunAuto = True
                            Exit Function
                        End If
                    Next w_Int2
                Next w_Int
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '代休情報更新
    Private Sub UpDate_DaikyuData(ByVal p_Date As Integer, ByVal p_StaffIdx As Integer, ByVal p_Mode As Integer, ByVal p_KinmuCD As String)

        Const W_SUBNAME As String = "NSK0000HA UpDate_DaikyuData"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_DataFlg As Boolean
        Dim w_Index As Integer
        Dim w_WorkTbl As Daikyu_Type
        Dim w_WorkTbl2() As Daikyu_Type
        Try
            'p_Mode = 0は配列に追加or変更
            If p_Mode = 0 Then

                w_DataFlg = False

                '代休データ件数ループ
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                    '休日出勤年月日が今回貼り付けた日付と一致するか
                    If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = p_Date Then

                        w_DataFlg = True

                        '勤務が変更になっていないか
                        If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD = p_KinmuCD Then
                            '代休取得日にしているか
                            If m_StaffData(p_StaffIdx).Daikyu(w_Int).OutPutList = "0" Then
                                m_StaffData(p_StaffIdx).Daikyu(w_Int).OutPutList = "1"
                                Exit For
                            End If
                        Else
                            m_StaffData(p_StaffIdx).Daikyu(w_Int).HolKinmuCD = p_KinmuCD
                            m_StaffData(p_StaffIdx).Daikyu(w_Int).OutPutList = "1"

                            '取得区分
                            'とりあえず１日としてセット
                            m_StaffData(p_StaffIdx).Daikyu(w_Int).GetKbn = "0"
                            m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol = 1
                            '代休1.5日分発生対象勤務かチェック
                            For w_Int2 = 1 To UBound(m_Daikyu15KinmuCD)
                                If p_KinmuCD = m_Daikyu15KinmuCD(w_Int2) Then
                                    m_StaffData(p_StaffIdx).Daikyu(w_Int).GetKbn = "1"
                                    m_StaffData(p_StaffIdx).Daikyu(w_Int).RemainderHol = 1.5
                                    Exit For
                                End If
                            Next w_Int2

                            Exit For
                        End If
                    End If
                Next w_Int

                '一致するデータがない場合は配列に追加
                If w_DataFlg = False Then
                    '配列拡張
                    w_Index = UBound(m_StaffData(p_StaffIdx).Daikyu) + 1
                    ReDim Preserve m_StaffData(p_StaffIdx).Daikyu(w_Index)
                    ReDim m_StaffData(p_StaffIdx).Daikyu(w_Index).DaikyuDetail(1)

                    m_StaffData(p_StaffIdx).Daikyu(w_Index).HolDate = p_Date
                    m_StaffData(p_StaffIdx).Daikyu(w_Index).HolKinmuCD = p_KinmuCD
                    m_StaffData(p_StaffIdx).Daikyu(w_Index).OutPutList = "1"

                    '取得区分
                    'とりあえず１日としてセット
                    m_StaffData(p_StaffIdx).Daikyu(w_Index).GetKbn = "0"
                    m_StaffData(p_StaffIdx).Daikyu(w_Index).RemainderHol = 1
                    '代休1.5日分発生対象勤務かチェック
                    For w_Int = 1 To UBound(m_Daikyu15KinmuCD)
                        If p_KinmuCD = m_Daikyu15KinmuCD(w_Int) Then
                            m_StaffData(p_StaffIdx).Daikyu(w_Index).GetKbn = "1"
                            m_StaffData(p_StaffIdx).Daikyu(w_Index).RemainderHol = 1.5
                            Exit For
                        End If
                    Next w_Int

                    '休日出勤日でソート
                    For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                        For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu) - w_Int
                            If (m_StaffData(p_StaffIdx).Daikyu(w_Int2).HolDate > m_StaffData(p_StaffIdx).Daikyu(w_Int2 + 1).HolDate) Then
                                w_WorkTbl = m_StaffData(p_StaffIdx).Daikyu(w_Int2)
                                m_StaffData(p_StaffIdx).Daikyu(w_Int2) = m_StaffData(p_StaffIdx).Daikyu(w_Int2 + 1)
                                m_StaffData(p_StaffIdx).Daikyu(w_Int2 + 1) = w_WorkTbl
                            End If
                        Next w_Int2
                    Next w_Int
                End If

                'p_Mode = 1は配列から削除
            ElseIf p_Mode = 1 Then
                '代休データ件数ループ
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                    '休日出勤年月日が今回貼り付けた日付と一致するか
                    If m_StaffData(p_StaffIdx).Daikyu(w_Int).HolDate = p_Date Then

                        'ワークテーブルにデータを退避
                        ReDim w_WorkTbl2(UBound(m_StaffData(p_StaffIdx).Daikyu))
                        For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Daikyu)
                            w_WorkTbl2(w_Int2) = m_StaffData(p_StaffIdx).Daikyu(w_Int2)
                        Next w_Int2

                        '代休用配列初期化
                        ReDim m_StaffData(p_StaffIdx).Daikyu(0)

                        'いいえを選択しているので配列から削除
                        For w_Int2 = 1 To UBound(w_WorkTbl2)
                            If w_Int <> w_Int2 Then
                                w_Index = UBound(m_StaffData(p_StaffIdx).Daikyu) + 1
                                ReDim Preserve m_StaffData(p_StaffIdx).Daikyu(w_Index)

                                m_StaffData(p_StaffIdx).Daikyu(w_Index) = w_WorkTbl2(w_Int2)
                            End If
                        Next w_Int2

                        Exit For
                    End If
                Next w_Int
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '時間年休をツールチップに表示用に加工
    Private Function Set_ToolTipJikanNenkyu(ByVal p_Str As String) As String

        Const W_SUBNAME As String = "NSK0000HA Set_ToolTipJikanNenkyu"

        Dim w_str As String
        Dim w_RecCnt As Integer
        Dim w_BunruiCD As String
        Dim w_BunruiName As String
        Dim w_StartTime As String
        Dim w_EndTime As String
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Name_F As ADODB.Field
        Dim w_SetStr As String
        Try
            '時間年休件数を取得
            w_RecCnt = Len(p_Str) / 28

            If w_RecCnt >= 1 Then
                w_RecCnt = w_RecCnt - 1
            End If

            'ツールチップには最初の１件のみ表示
            w_str = General.paLeft(p_Str, 28)

            'HolidayBunruiCD
            w_BunruiCD = General.paLeft(w_str, 2)

            'richard update start
            ''休み分類名称を取得
            'w_Sql = "Select Name From NS_HOLIDAYBUNRUI_M "
            'w_Sql = w_Sql & "Where HolidayBunruiCD = '" & w_BunruiCD & "' "
            'w_Sql = w_Sql & "And HospitalCD = '" & General.g_strHospitalCD & "' "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_HOLIDAYBUNRUI_M_02(w_Rs, w_BunruiCD) '<23>
            'richard update end

            If w_Rs.RecordCount <= 0 Then
                'もし名称がない場合は分類CDをｾｯﾄ
                w_BunruiName = w_BunruiCD
            Else
                '必ず１件になる
                w_Name_F = w_Rs.Fields("Name")

                '休み分類名称
                w_BunruiName = IIf(IsDBNull(w_Name_F.Value), w_BunruiCD, w_Name_F.Value)
            End If
            w_Rs.Close()

            '開始時間
            w_StartTime = Format(Integer.Parse(Mid(w_str, 3, 4)), "00:00")
            '終了時間
            w_EndTime = Format(Integer.Parse(Mid(w_str, 7, 4)), "00:00")

            '時間年休が２件以上ある場合は、"他～件"と出力
            If w_RecCnt >= 1 Then
                w_SetStr = w_BunruiName & Space(1) & w_StartTime & "～" & w_EndTime & Space(1) & "他" & w_RecCnt & "件"
            Else
                w_SetStr = w_BunruiName & Space(1) & w_StartTime & "～" & w_EndTime
            End If

            Set_ToolTipJikanNenkyu = w_SetStr

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '時間年休更新
    Private Function UpDate_JikanNenkyu() As Boolean

        Const W_SUBNAME As String = "NSK0000HA UpDate_JikanNenkyu"

        Dim w_Index As Integer
        Dim w_DateIdx As Integer
        Dim w_SEQIdx As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_Date As Integer '日付
        Dim w_SysDate As String
        Dim w_EndDate As Integer
        Dim w_StartDate As Integer

        UpDate_JikanNenkyu = True
        Try
            If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                '届出を使用していない場合は時間年休使用
            Else
                Exit Function
            End If

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            '計画開始日取得
            w_StartDate = m_KeikakuKikan.StartDate

            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate

            For w_Index = 1 To UBound(m_StaffData)
                '職員管理番号
                w_StaffID = m_StaffData(w_Index).ID
                '2017/11/20 Yamanishi Add -----------------------------------------------------
                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN AndAlso m_intSelSaveNo > 0 Then
                    w_Sql = " Delete From NS_NENKYU_F "
                    w_Sql = w_Sql & " Where HospitalCD = '" & General.g_strHospitalCD & "' "
                    w_Sql = w_Sql & " And DateF Between " & w_StartDate & " And " & w_EndDate
                    w_Sql = w_Sql & " And StaffMngID = '" & w_StaffID & "' "
                    Call General.paDBExecute(w_Sql)
                End If
                '------------------------------------------------------------------------------
                For w_DateIdx = 1 To UBound(m_StaffData(w_Index).NenkyuData)
                    '日付
                    w_Date = m_StaffData(w_Index).NenkyuData(w_DateIdx).Date_Renamed

                    '計画期間内の部分
                    If w_EndDate >= w_Date Then
                        'データ更新するかどうか？
                        If m_StaffData(w_Index).NenkyuData(w_DateIdx).DataFlg = True Then
                            'DBにデータが存在するかどうか？
                            '2017/11/20 Yamanishi Upd -----------------------------------------------------
                            'If m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = True Then
                            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN AndAlso m_intSelSaveNo > 0 Then
                            ElseIf m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk Then
                                '--------------------------------------------------------------------------
                                '年休Ｆ削除

                                'Delete文 編集
                                'richard update start
                                'w_Sql = "Delete From NS_NENKYU_F "
                                'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
                                'w_Sql = w_Sql & "And DateF = " & Convert.ToString(w_Date) & " "
                                'w_Sql = w_Sql & "And StaffMngID = '" & w_StaffID & "' "
                                'Call General.paDBExecute(w_Sql)
                                Call NSK0000H_sql.delete_NS_NENKYU_F_01(w_Date, w_StaffID) '<18>
                                'richard update end


                                m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = False 'DBﾃﾞｰﾀなし
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).FirstRegistTimeDate = 0
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).LastUpdTimeDate = 0
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).RegistID = ""
                            End If

                            For w_SEQIdx = 1 To UBound(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail)
                                '年休Ｆ追加

                                'Insert文 編集
                                'RICHARD UPDATE START
                                'w_Sql = "Insert Into NS_NENKYU_F ("
                                'w_Sql = w_Sql & "HospitalCD,"
                                'w_Sql = w_Sql & "StaffMngID,"
                                'w_Sql = w_Sql & "DateF,"
                                'w_Sql = w_Sql & "SEQ,"
                                'w_Sql = w_Sql & "GETCONTENTSKBN,"
                                'w_Sql = w_Sql & "HolidayBunruiCD,"
                                'w_Sql = w_Sql & "FromTime,"
                                'w_Sql = w_Sql & "ToTime,"
                                'w_Sql = w_Sql & "NEXTDAYFLG,"
                                'w_Sql = w_Sql & "KINMUDATE,"
                                'w_Sql = w_Sql & "DateKbn,"
                                'w_Sql = w_Sql & "UNIQUESEQNO,"
                                'w_Sql = w_Sql & "APPROVEFLG,"
                                'w_Sql = w_Sql & "DELFLG,"
                                'w_Sql = w_Sql & "NENKYUTIME,"
                                'w_Sql = w_Sql & "HOLSUBFLG,"
                                'w_Sql = w_Sql & "DAYTIME,"
                                'w_Sql = w_Sql & "NIGHTTIME,"
                                'w_Sql = w_Sql & "NEXTNIGHTTIME,"
                                'w_Sql = w_Sql & "RegistFirstTimeDate,"
                                'w_Sql = w_Sql & "LastUpdTimeDate,"
                                'w_Sql = w_Sql & "RegistrantID)"
                                'w_Sql = w_Sql & "Values('"
                                'w_Sql = w_Sql & General.g_strHospitalCD & "'," '病院CD
                                'w_Sql = w_Sql & "'" & w_StaffID & "'," '職員管理番号
                                'w_Sql = w_Sql & Convert.ToString(w_Date) & "," '日付
                                'w_Sql = w_Sql & Convert.ToString(w_SEQIdx) & "," 'SEQ
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).GetContentsKbn & "'," '取得内容区分
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).HolidayBunruiCD & "'," '休暇分類CD
                                'w_Sql = w_Sql & Convert.ToString(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).FromTime) & "," '開始時間
                                'w_Sql = w_Sql & Convert.ToString(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).ToTime) & "," '終了時間
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).DateKbn & "'," '翌日FLG
                                'w_Sql = w_Sql & Convert.ToString(w_Date) & "," '勤務年月日
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).DateKbn & "'," '年月日区分
                                'w_Sql = w_Sql & "''," 'UNIQUESEQNO
                                'w_Sql = w_Sql & "'1'," '承認済FLG
                                'w_Sql = w_Sql & "''," '削除FLG
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).NenkyuTime & "'," '時間年休
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).HolSubFlg & "'," '休憩減算フラグ
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).DayTime & "'," '日勤時間
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).NightTime & "'," '夜勤時間
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).NextNightTime & "'," '翌日夜勤時間
                                'w_Sql = w_Sql & w_SysDate & ","
                                'w_Sql = w_Sql & w_SysDate & ","
                                'w_Sql = w_Sql & "'" & General.g_strUserID & "')"
                                'Call General.paDBExecute(w_Sql)
                                Call NSK0000H_sql.insert_NS_NENKYU_F_01(w_StaffID, m_StaffData, w_Date, w_SEQIdx, w_Index, w_DateIdx, w_SysDate) '<17>
                                'RICHARD UPDATE END

                                m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = True 'DBﾃﾞｰﾀあり
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).FirstRegistTimeDate = Double.Parse(w_SysDate)
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).LastUpdTimeDate = Double.Parse(w_SysDate)
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).RegistID = General.g_strUserID
                            Next w_SEQIdx

                            ReDim m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(0)
                            m_StaffData(w_Index).NenkyuData(w_DateIdx).DataFlg = False '更新しない
                        End If
                    End If
                Next w_DateIdx
            Next w_Index

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '時間年休更新(4週のはみ出た部分)
    Private Function UpDate_JikanNenkyu_4W() As Boolean

        Const W_SUBNAME As String = "NSK0000HA UpDate_JikanNenkyu_4W"

        Dim w_Index As Integer
        Dim w_DateIdx As Integer
        Dim w_SEQIdx As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_Date As Integer '日付
        Dim w_SysDate As String
        Dim w_EndDate As Integer
        Dim w_StartDate As Integer

        UpDate_JikanNenkyu_4W = True
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Function
            End If

            If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                '届出を使用していない場合は時間年休使用
            Else
                Exit Function
            End If

            If m_4WeekFLG = False Then
                '計画期間外の最後４週部分で更新がなかった場合
                Exit Function
            End If

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            '計画開始日取得
            w_StartDate = m_KeikakuKikan.StartDate

            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate

            For w_Index = 1 To UBound(m_StaffData)
                '職員管理番号
                w_StaffID = m_StaffData(w_Index).ID

                For w_DateIdx = 1 To UBound(m_StaffData(w_Index).NenkyuData)
                    '日付
                    w_Date = m_StaffData(w_Index).NenkyuData(w_DateIdx).Date_Renamed

                    '計画期間外の最後４週部分
                    If w_EndDate < w_Date Then
                        'データ更新するかどうか？
                        If m_StaffData(w_Index).NenkyuData(w_DateIdx).DataFlg = True Then
                            'DBにデータが存在するかどうか？
                            If m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = True Then
                                '年休Ｆ削除

                                'Delete文 編集
                                'richard update start
                                'w_Sql = "Delete From NS_NENKYU_F "
                                'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
                                'w_Sql = w_Sql & "And DateF = " & Convert.ToString(w_Date) & " "
                                'w_Sql = w_Sql & "And StaffMngID = '" & w_StaffID & "' "
                                'Call General.paDBExecute(w_Sql)
                                Call NSK0000H_sql.delete_NS_NENKYU_F_01(w_Date, w_StaffID)
                                'richard update end

                                m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = False 'DBﾃﾞｰﾀなし
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).FirstRegistTimeDate = 0
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).LastUpdTimeDate = 0
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).RegistID = ""
                            End If

                            For w_SEQIdx = 1 To UBound(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail)
                                '年休Ｆ追加

                                'Insert文 編集
                                'RICHARD UPDATE START
                                'w_Sql = "Insert Into NS_NENKYU_F ("
                                'w_Sql = w_Sql & "HospitalCD,"
                                'w_Sql = w_Sql & "StaffMngID,"
                                'w_Sql = w_Sql & "DateF,"
                                'w_Sql = w_Sql & "SEQ,"
                                'w_Sql = w_Sql & "GETCONTENTSKBN,"
                                'w_Sql = w_Sql & "HolidayBunruiCD,"
                                'w_Sql = w_Sql & "FromTime,"
                                'w_Sql = w_Sql & "ToTime,"
                                'w_Sql = w_Sql & "NEXTDAYFLG,"
                                'w_Sql = w_Sql & "KINMUDATE,"
                                'w_Sql = w_Sql & "DateKbn,"
                                'w_Sql = w_Sql & "UNIQUESEQNO,"
                                'w_Sql = w_Sql & "APPROVEFLG,"
                                'w_Sql = w_Sql & "DELFLG,"
                                'w_Sql = w_Sql & "RegistFirstTimeDate,"
                                'w_Sql = w_Sql & "LastUpdTimeDate,"
                                'w_Sql = w_Sql & "RegistrantID)"
                                'w_Sql = w_Sql & "Values('"
                                'w_Sql = w_Sql & General.g_strHospitalCD & "'," '病院CD
                                'w_Sql = w_Sql & "'" & w_StaffID & "'," '職員管理番号
                                'w_Sql = w_Sql & Convert.ToString(w_Date) & "," '日付
                                'w_Sql = w_Sql & Convert.ToString(w_SEQIdx) & "," 'SEQ
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).GetContentsKbn & "'," '取得内容区分
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).HolidayBunruiCD & "'," '休暇分類CD
                                'w_Sql = w_Sql & Convert.ToString(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).FromTime) & "," '開始時間
                                'w_Sql = w_Sql & Convert.ToString(m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).ToTime) & "," '終了時間
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).DateKbn & "'," '翌日FLG
                                'w_Sql = w_Sql & Convert.ToString(w_Date) & "," '勤務年月日
                                'w_Sql = w_Sql & "'" & m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(w_SEQIdx).DateKbn & "'," '年月日区分
                                'w_Sql = w_Sql & "''," 'UNIQUESEQNO
                                'w_Sql = w_Sql & "'1'," '承認済FLG
                                'w_Sql = w_Sql & "''," '削除FLG
                                'w_Sql = w_Sql & w_SysDate & ","
                                'w_Sql = w_Sql & w_SysDate & ","
                                'w_Sql = w_Sql & "'" & General.g_strUserID & "')"
                                'Call General.paDBExecute(w_Sql)
                                Dim w_objTemp As Object
                                w_objTemp = m_StaffData
                                Call NSK0000H_sql.insert_NS_NENKYU_F_01(w_StaffID, w_objTemp, w_Date, w_SEQIdx, w_Index, w_DateIdx, w_SysDate)
                                'RICHARD UPDATE END

                                m_StaffData(w_Index).NenkyuData(w_DateIdx).DataChk = True 'DBﾃﾞｰﾀあり
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).FirstRegistTimeDate = Double.Parse(w_SysDate)
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).LastUpdTimeDate = Double.Parse(w_SysDate)
                                m_StaffData(w_Index).NenkyuData(w_DateIdx).RegistID = General.g_strUserID
                            Next w_SEQIdx

                            ReDim m_StaffData(w_Index).NenkyuData(w_DateIdx).Detail(0)
                            m_StaffData(w_Index).NenkyuData(w_DateIdx).DataFlg = False '更新しない
                        End If
                    End If
                Next w_DateIdx
            Next w_Index

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '時間年休取得 取得
    Private Sub Get_JikanNenkyu(ByVal p_FromDate As Integer, ByVal p_ToDate As Integer, ByVal p_StaffIdx As Integer)
        Const W_SUBNAME As String = "NSK0000HA Get_JikanNenkyu"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Index As Integer
        Dim w_Index2 As Integer
        Dim w_RecCnt As Integer
        Dim w_CD As String
        Dim w_StartTime As String
        Dim w_EndTime As String
        Dim w_KBN As String
        Dim w_str As String
        Dim w_NenkyuFLG As Boolean
        Dim w_Date As Integer
        Dim w_NenkyuTime As String '時間年休
        Dim w_HolSubFlg As String '休憩減算フラグ
        Dim w_DayTime As String '日勤時間
        Dim w_NightTime As String '夜勤時間
        Dim w_NextNightTime As String '翌日夜勤時間
        Dim w_getFlg As Boolean '#001
        Try
            '-- 時間年休 取得 -------------
            ReDim m_JikanNenkyu(0)

            '届出を使用していない場合は時間年休使用
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p職員区分 = 0 '職員管理番号
                .p職員番号 = m_StaffData(p_StaffIdx).ID
                .p日付区分 = 1 '期間
                .p開始年月日 = p_FromDate
                .p終了年月日 = p_ToDate
                .p年休承認区分 = 0
                .p削除区分 = 0
                .p年休UNIQUESEQNO = ""
                .p休暇分類CD = ""
                '2017/11/16 Angelo add st----------------------------------------------
                '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                If m_intSelSaveNo > 0 Then
                    '時間年休（一時保存）を取得
                    .p取得区分 = 1
                    .p計画番号 = m_PlanNo '計画番号
                    .p保存番号 = m_intSelSaveNo '保存番号
                Else
                    '時間休を取得
                    .p取得区分 = 0
                End If
                '2017/11/16 Angelo add en----------------------------------------------

                If .mGetNenkyu = True Then
                    w_Index = 0
                    .p年休年月日 = p_FromDate

                    For w_Int = 1 To .f年休期間日数

                        w_RecCnt = .f年休日別件数
                        w_Date = .f年休年月日

                        '初期化
                        w_str = ""

                        For w_Int2 = 1 To w_RecCnt

                            .p年休日別索引 = w_Int2
                            '#001-----St
                            '時間年休のみ取得する
                            w_getFlg = False
                            If .f年休取得内容区分 = "4" Then
                                w_getFlg = True
                            End If
                            '届出を仕様する場合は再度確認
                            If w_getFlg = True AndAlso (m_PackageFLG = 2 OrElse m_PackageFLG = 3) Then
                                w_getFlg = False
                                '削除されているデータは取得しない
                                If .f年休削除FLG <> "1" Then
                                    w_getFlg = True
                                End If
                            End If
                            '取得対象なら
                            If w_getFlg Then
                                '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                                ''#001-----Ed
                                ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                                'w_CD = .f年休休み分類CD
                                'If w_CD = "" Then
                                '    w_str = w_str & Space(2)
                                'Else
                                '    w_str = w_str & String.Format("{0, 2}", w_CD)
                                'End If
                                ''FromTime(ﾊﾞｲﾄ数４)
                                'w_StartTime = Convert.ToString(.f年休開始時間)
                                'If w_StartTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_StartTime)
                                'End If
                                ''ToTime(ﾊﾞｲﾄ数４)
                                'w_EndTime = Convert.ToString(.f年休終了時間)
                                'If w_EndTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_EndTime)
                                'End If
                                ''DateKbn(ﾊﾞｲﾄ数１)
                                'w_KBN = .f年休年月日区分
                                'w_str = w_str & w_KBN

                                ''時間年休
                                'w_NenkyuTime = Convert.ToString(.f取得時間)
                                'If w_NenkyuTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_NenkyuTime)
                                'End If

                                ''休憩減算フラグ
                                'w_HolSubFlg = .f休憩減算フラグ
                                'w_str = w_str & w_HolSubFlg

                                ''日勤時間
                                'w_DayTime = Convert.ToString(.f年休日勤時間)
                                'If w_DayTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_DayTime)
                                'End If

                                ''夜勤時間
                                'w_NightTime = Convert.ToString(.f年休夜勤時間)
                                'If w_NightTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_NightTime)
                                'End If

                                ''翌日夜勤時間
                                'w_NextNightTime = Convert.ToString(.f年休翌日夜勤時間)
                                'If w_NextNightTime = "" Then
                                '    w_str = w_str & Space(4)
                                'Else
                                '    w_str = w_str & String.Format("{0, 4}", w_NextNightTime)
                                'End If

                                w_str = w_str & Set_NenkyuTime(.f年休休み分類CD, .f年休開始時間, .f年休終了時間,
                                                               .f年休年月日区分, .f取得時間, .f休憩減算フラグ,
                                                               .f年休日勤時間, .f年休夜勤時間, .f年休翌日夜勤時間)
                                '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                            End If
                        Next w_Int2

                        If w_str <> "" Then
                            '時間年休が存在したら配列ｲﾝﾃﾞｯｸｽを１つ加算
                            w_Index = w_Index + 1
                            ReDim Preserve m_JikanNenkyu(w_Index)

                            'DateF
                            m_JikanNenkyu(w_Index).Date_Renamed = w_Date
                            '文字列取得
                            m_JikanNenkyu(w_Index).StrData = w_str
                        End If

                        If w_RecCnt > 0 AndAlso w_Date > 0 Then
                            w_NenkyuFLG = False
                            For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).NenkyuData)
                                If m_StaffData(p_StaffIdx).NenkyuData(w_Int2).Date_Renamed = w_Date Then
                                    '既にデータが存在する場合
                                    w_NenkyuFLG = True
                                End If
                            Next w_Int2
                            If w_NenkyuFLG = False Then
                                'データが存在しない時のみ配列追加
                                w_Index2 = UBound(m_StaffData(p_StaffIdx).NenkyuData) + 1
                                ReDim Preserve m_StaffData(p_StaffIdx).NenkyuData(w_Index2)
                                ReDim m_StaffData(p_StaffIdx).NenkyuData(w_Index2).Detail(0)
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).Date_Renamed = w_Date
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).DataFlg = False '更新しない
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).DataChk = True 'DBﾃﾞｰﾀあり
                                .p年休日別索引 = 1 '１件目の登録日時を取得(排他制御が正しく動かない為)
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).FirstRegistTimeDate = .f年休初回登録日時
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).LastUpdTimeDate = .f年休最終更新日時
                                m_StaffData(p_StaffIdx).NenkyuData(w_Index2).RegistID = .f年休登録者ID
                            End If
                        End If

                        .m翌日年休()
                    Next w_Int
                End If
            End With
            '2016/06/15 Yamanishi Del --------------------------------------------------------------------
            ''追加仕様：応援者・月中異動者の総夜勤を全部出す--------------------------------------
            'ReDim m_StaffData(p_StaffIdx).BeforeJikanNenkyu(UBound(m_JikanNenkyu))
            'For w_Int = 1 To UBound(m_JikanNenkyu)
            '    m_StaffData(p_StaffIdx).BeforeJikanNenkyu(w_Int) = m_JikanNenkyu(w_Int)
            'Next w_Int
            ''追加仕様：応援者・月中異動者の総夜勤を全部出す--------------------------------------
            '---------------------------------------------------------------------------------------------
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '代休情報取得 取得
    Private Sub Get_Daikyu(ByVal p_StaffIdx As Integer)

        Const W_SUBNAME As String = "NSK0000HA Get_Daikyu"

        Dim w_Int As Integer
        Dim w_RecCnt As Integer
        Dim w_Sql As String
        'DAOｵﾌﾞｼﾞｪｸﾄ
        Dim w_Rs As ADODB.Recordset
        'ﾌｨｰﾙﾄﾞ
        Dim w_WorkHolKinmuDate_F As ADODB.Field
        Dim w_WorkHolKinmuCD_F As ADODB.Field
        Dim w_GETDAIKYUDATE_F As ADODB.Field
        Dim w_GETDAIKYUKINMUCD_F As ADODB.Field
        Dim w_FDate_F As ADODB.Field
        Dim w_LDate_F As ADODB.Field
        Dim w_RID_F As ADODB.Field
        Dim w_GETKBN_F As ADODB.Field
        Dim w_SEQ_F As ADODB.Field
        Dim w_GETFLG_F As ADODB.Field
        Dim w_PreWHKDate As Integer
        Dim w_DataCnt As Integer
        Dim w_DetaiDataCnt As Integer
        '2017/11/22 Yamanishi Add ----------------------------------------
        Dim w_iGetDaikyuDate As Integer
        Dim w_DetailLoadFlg As Boolean
        '-----------------------------------------------------------------
        Try
            '-- 代休 取得 -------------
            'Select文 編集
            'richard delete start
            'w_Sql = ""
            'w_Sql = "SELECT   WORKHOLKINMUDATE "
            'w_Sql = w_Sql & ",WORKHOLKINMUCD "
            'w_Sql = w_Sql & ",GETDAIKYUDATE "
            'w_Sql = w_Sql & ",GETDAIKYUKINMUCD "
            'w_Sql = w_Sql & ",REGISTFIRSTTIMEDATE "
            'w_Sql = w_Sql & ",LASTUPDTIMEDATE "
            'w_Sql = w_Sql & ",REGISTRANTID "
            'w_Sql = w_Sql & "FROM NS_DAIKYUMNG_F "
            'w_Sql = w_Sql & "WHERE WORKHOLKINMUDATE >= " & m_lngDaikyuStartDate & " "
            'w_Sql = w_Sql & "AND   WORKHOLKINMUDATE <= " & m_lngDaikyuEndDate & " "
            'w_Sql = w_Sql & "AND   STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
            'w_Sql = w_Sql & "AND   HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "ORDER BY WORKHOLKINMUDATE "
            'richard delete end

            ''代休管理Ｆ/代休詳細管理Ｆ
            'RICHARD UPDATE START
            'w_Sql = "SELECT   DM.WORKHOLKINMUDATE "
            'w_Sql = w_Sql & ",DM.WORKHOLKINMUCD "
            'w_Sql = w_Sql & ",DM.GETKBN "
            'w_Sql = w_Sql & ",DM.REGISTFIRSTTIMEDATE "
            'w_Sql = w_Sql & ",DM.LASTUPDTIMEDATE "
            'w_Sql = w_Sql & ",DM.REGISTRANTID "
            'w_Sql = w_Sql & ",DD.SEQ "
            'w_Sql = w_Sql & ",DD.GETFLG "
            'w_Sql = w_Sql & ",DD.GETDAIKYUDATE "
            'w_Sql = w_Sql & ",DD.GETDAIKYUKINMUCD "
            'w_Sql = w_Sql & "FROM NS_DAIKYUMNG_F DM "
            'w_Sql = w_Sql & "LEFT OUTER JOIN NS_DAIKYUDETAILMNG_F DD "
            'w_Sql = w_Sql & "ON    DD.WORKHOLKINMUDATE = DM.WORKHOLKINMUDATE "
            'w_Sql = w_Sql & "AND   DD.STAFFMNGID = DM.STAFFMNGID "
            'w_Sql = w_Sql & "AND   DD.HOSPITALCD = DM.HOSPITALCD "
            'w_Sql = w_Sql & "WHERE DM.WORKHOLKINMUDATE >= " & m_lngDaikyuStartDate & " "
            'w_Sql = w_Sql & "AND   DM.WORKHOLKINMUDATE <= " & m_lngDaikyuEndDate & " "
            'w_Sql = w_Sql & "AND   DM.STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
            'w_Sql = w_Sql & "AND   DM.HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "ORDER BY DM.WORKHOLKINMUDATE "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            'Call NSK0000H_sql.select_NS_DAIKYUMNG_F_01(w_Rs, m_lngDaikyuStartDate, m_lngDaikyuEndDate, m_StaffData(p_StaffIdx).ID) '<29>
            ''RICHARD UPDATE END
            Call NSK0000H_sql.select_NS_DAIKYUMNG_F_01(w_Rs, m_lngDaikyuStartDate, m_lngDaikyuEndDate, m_StaffData(p_StaffIdx).ID, m_PlanNo, m_intSelSaveNo) '<29>

            ReDim m_StaffData(p_StaffIdx).Daikyu(0)
            ReDim m_StaffData(p_StaffIdx).LoadDaikyu(0)

            If w_Rs.RecordCount <= 0 Then
                '存在しないとき
            Else
                '存在するとき
                With w_Rs

                    'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ生成
                    .MoveLast()
                    w_RecCnt = w_Rs.RecordCount
                    .MoveFirst()

                    w_WorkHolKinmuDate_F = .Fields("WorkHolKinmuDate")
                    w_WorkHolKinmuCD_F = .Fields("WorkHolKinmuCD")
                    w_GETDAIKYUDATE_F = .Fields("GetDaikyuDate")
                    w_GETDAIKYUKINMUCD_F = .Fields("GetDaikyuKinmuCD")
                    w_FDate_F = .Fields("REGISTFIRSTTIMEDATE")
                    w_LDate_F = .Fields("LASTUPDTIMEDATE")
                    w_RID_F = .Fields("REGISTRANTID")
                    w_GETKBN_F = .Fields("GETKBN")
                    w_SEQ_F = .Fields("SEQ")
                    w_GETDAIKYUDATE_F = .Fields("GETDAIKYUDATE")
                    w_GETDAIKYUKINMUCD_F = .Fields("GETDAIKYUKINMUCD")
                    w_GETFLG_F = .Fields("GETFLG")

                    For w_Int = 1 To w_RecCnt

                        '前回データの代休日と比較
                        If w_PreWHKDate <> IIf(IsDBNull(w_WorkHolKinmuDate_F.Value), 0, w_WorkHolKinmuDate_F.Value) Then
                            '違った場合配列拡張
                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve m_StaffData(p_StaffIdx).Daikyu(w_DataCnt)
                            ReDim Preserve m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt)

                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).GetKbn = IIf(IsDBNull(w_GETKBN_F.Value), "0", w_GETKBN_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).HolDate = IIf(IsDBNull(w_WorkHolKinmuDate_F.Value), 0, w_WorkHolKinmuDate_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).HolKinmuCD = IIf(IsDBNull(w_WorkHolKinmuCD_F.Value), "", w_WorkHolKinmuCD_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).FirstRegistTimeDate = IIf(IsDBNull(w_FDate_F.Value), 0, w_FDate_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).LastUpdTimeDate = IIf(IsDBNull(w_LDate_F.Value), 0, w_LDate_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RegistID = IIf(IsDBNull(w_RID_F.Value), "", w_RID_F.Value)
                            'ﾛｰﾄﾞ時の代休情報格納(勤務変更個人別画面時に使用)
                            m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).GetKbn = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).GetKbn
                            m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).HolDate = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).HolDate
                            m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).HolKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).HolKinmuCD

                            '初期化
                            w_DetaiDataCnt = 0
                            '2017/11/22 Yamanishi Add ------------------------------------------------------------------------------------
                            ReDim m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(1)
                            ReDim m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(1)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(1).DaikyuKinmuCD = ""
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(1).GetFlg = ""
                            '-------------------------------------------------------------------------------------------------------------
                            '代休未使用分のセット
                            Select Case m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).GetKbn
                                Case "0"
                                    '１日
                                    m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol = 1
                                Case "1"
                                    m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol = 1.5
                            End Select
                            m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).RemainderHol = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol
                        End If
                        '2017/11/22 Yamanishi Add ----------------------------------------------------------------------------------------------
                        ''配列確保
                        'w_DetaiDataCnt = w_DetaiDataCnt + 1
                        'ReDim Preserve m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt)
                        'ReDim Preserve m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt)

                        'm_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuDate = IIf(IsDBNull(w_GETDAIKYUDATE_F.Value), 0, w_GETDAIKYUDATE_F.Value)
                        w_DetailLoadFlg = True
                        w_iGetDaikyuDate = General.paGetDbFieldVal(w_GETDAIKYUDATE_F, 0)
                        If m_intSelSaveNo > 0 AndAlso
                           m_StaffData(p_StaffIdx).OuenStaffFlg <> 1 AndAlso
                           m_KeikakuKikan.StartDate <= w_iGetDaikyuDate AndAlso
                           w_iGetDaikyuDate <= m_KeikakuKikan.EndDate Then
                            For i As Integer = 1 To UBound(m_StaffData(p_StaffIdx).IdoData)
                                If m_StaffData(p_StaffIdx).IdoData(i).IdoYMD <= w_iGetDaikyuDate AndAlso
                                   w_iGetDaikyuDate <= m_StaffData(p_StaffIdx).IdoData(i).SyuryoYMD Then
                                    w_DetailLoadFlg = False
                                    Exit For
                                End If
                            Next i
                        End If
                        If w_DetailLoadFlg Then
                            '配列確保
                            w_DetaiDataCnt = w_DetaiDataCnt + 1
                            ReDim Preserve m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt)
                            ReDim Preserve m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuDate = w_iGetDaikyuDate
                            '-------------------------------------------------------------------------------------------------------------------
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuKinmuCD = IIf(IsDBNull(w_GETDAIKYUKINMUCD_F.Value), "", w_GETDAIKYUKINMUCD_F.Value)
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).GetFlg = IIf(IsDBNull(w_GETFLG_F.Value), "", w_GETFLG_F.Value)

                            'もし代休取得年月日が０の場合はリストにあげるためにﾌﾗｸﾞを"1"にする
                            '取得済みの代休を差し引く
                            Select Case m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).GetFlg
                                Case "0"
                                    '１日
                                    m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol - 1
                                Case "1"
                                    '半日
                                    m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol - 0.5
                            End Select
                        End If '2017/11/22 Yamanishi Add

                        '代休未使用分がある場合はリストにあげる
                        If m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).RemainderHol > 0 Then
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).OutPutList = "1"
                        Else
                            m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).OutPutList = "0"
                        End If

                        'ﾛｰﾄﾞ時の代休情報格納(勤務変更個人別画面時に使用)
                        m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuDate = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuDate
                        m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuKinmuCD = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).DaikyuKinmuCD
                        m_StaffData(p_StaffIdx).LoadDaikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).GetFlg = m_StaffData(p_StaffIdx).Daikyu(w_DataCnt).DaikyuDetail(w_DetaiDataCnt).GetFlg

                        w_PreWHKDate = IIf(IsDBNull(w_WorkHolKinmuDate_F.Value), 0, w_WorkHolKinmuDate_F.Value)

                        .MoveNext()
                    Next w_Int
                End With
            End If

            'ﾚｺｰﾄﾞｾｯﾄ ｵﾌﾞｼﾞｪｸﾄ 削除
            w_Rs.Close()
            w_Rs = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '採用履歴情報取得
    Private Sub Get_SaiyoData(ByVal p_StaffIdx As Integer, ByVal p_From As Integer, ByVal p_To As Integer)

        Const W_SUBNAME As String = "NSK0000HA Get_SaiyoData"

        Dim w_Int As Integer
        Dim w_RecCnt As Integer
        Try
            ReDim m_StaffData(p_StaffIdx).SaiyoData(0)

            With General.g_objIdoData
                .pHospitalCD = General.g_strHospitalCD
                .pStaffMngID = m_StaffData(p_StaffIdx).ID
                .pDateFlg = 1
                .pDateFrom = p_From
                .pDateTo = p_To
                .pSortFlg = 0 '昇順

                If Not .mGetSaiyoIdo Then
                Else
                    w_RecCnt = .fSI_SaiyoCount
                    ReDim m_StaffData(p_StaffIdx).SaiyoData(w_RecCnt)

                    For w_Int = 1 To w_RecCnt
                        .mSI_SaiyoIdx = w_Int
                        '採用年月日
                        m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoDate = .fSI_EmpDate
                        '採用条件CD
                        m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoCD = .fSI_EmpCD
                        '転退年月日
                        m_StaffData(p_StaffIdx).SaiyoData(w_Int).TentaiDate = .fSI_RetireDate
                        '採用略称
                        m_StaffData(p_StaffIdx).SaiyoData(w_Int).strSecName = .fSI_EmpSecName
                    Next
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '累計時間取得
    Private Sub Get_RuikeiTime(ByVal p_StaffIdx As Integer)

        Const W_SUBNAME As String = "NSK0000HA Get_RuikeiTime"

        Dim w_Int As Integer
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_RecCnt As Integer
        Dim w_KinmuTime_F As ADODB.Field
        Dim w_KinmuTime As Integer
        Try
            If m_RuikeiStartNo <> 0 AndAlso m_RuikeiEndNo <> 0 Then
                'RICHARD UPDATE START
                'w_Sql = "SELECT KINMUTIME FROM NS_RUIKEITIME_F"
                'w_Sql = w_Sql & " WHERE STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "'"
                'w_Sql = w_Sql & " AND PLANNO >= " & m_RuikeiStartNo
                'w_Sql = w_Sql & " AND PLANNO <= " & m_RuikeiEndNo
                'w_Sql = w_Sql & " AND KINMUKBN = '2'"
                'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
                ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
                'w_Rs = General.paDBRecordSetOpen(w_Sql)
                Call NSK0000H_sql.select_NS_RUIKEITIME_F_01(w_Rs, m_StaffData(p_StaffIdx).ID, m_RuikeiStartNo, m_RuikeiEndNo)
                'RICHARD UPDATE END

                If w_Rs.RecordCount <= 0 Then
                Else
                    With w_Rs

                        .MoveLast()
                        w_RecCnt = .RecordCount
                        .MoveFirst()

                        w_KinmuTime_F = .Fields("KinmuTime")

                        For w_Int = 1 To w_RecCnt
                            w_KinmuTime = w_KinmuTime + IIf(IsDBNull(w_KinmuTime_F.Value), 0, w_KinmuTime_F.Value)
                            .MoveNext()
                        Next w_Int

                        m_StaffData(p_StaffIdx).RuikeiTime = w_KinmuTime
                    End With
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '******************************
    '   ﾂｰﾙﾊﾞｰ、ｽﾃｰﾀｽﾊﾞｰの設定
    '   Craete  S.Ooeki 2000/08/02
    '******************************
    Private Sub Set_ToolStatusBar()

        Const W_SUBNAME As String = "NSK0000HA Set_ToolStatusBar"

        Dim w_Button As ToolStripButton
        Dim w_Sepapator As ToolStripSeparator
        Dim w_Panel As ToolStripStatusLabel
        Dim w_Text As String
        Dim w_ImagePath As String
        Dim w_SystemPath As String
        Try
            'ビットマップイメージ保存パス取得
            w_SystemPath = My.Application.Info.DirectoryPath
            w_ImagePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ImagePath", My.Application.Info.DirectoryPath & "\image")

            With imgToolBar
                'ｲﾒｰｼﾞの大きさ設定
                .ImageSize = New Size(.ImageSize.Width, 40)
                .ImageSize = New Size(40, .ImageSize.Height)
                'ｲﾒｰｼﾞの設定
                '通常終了

                .Images.Add(M_ToolBarKey_NormalEnd, Image.FromFile(w_ImagePath & "閉じる.bmp"))
                '確定終了
                .Images.Add(M_ToolBarKey_KakuteiEnd, Image.FromFile(w_ImagePath & "確定終了.bmp"))
                '保存呼出
                .Images.Add(M_ToolBarKey_SaveCall, Image.FromFile(w_ImagePath & "保存呼出.bmp")) '2017/08/07 Angelo Add 
                '職員情報設定
                .Images.Add(M_ToolBarKey_StaffEdit, Image.FromFile(w_ImagePath & "職員情報設定.bmp"))
                '自動割当
                .Images.Add(M_ToolBarKey_AutoAssign, Image.FromFile(w_ImagePath & "自動割当開始.bmp"))
                'パレット
                .Images.Add(M_ToolBarKey_Palette, Image.FromFile(w_ImagePath & "パレット表示.bmp"))
                '検索
                .Images.Add(M_ToolBarKey_Search, Image.FromFile(w_ImagePath & "検索.bmp"))
                '置換
                .Images.Add(M_ToolBarKey_Tikan, Image.FromFile(w_ImagePath & "置換.bmp"))
                '表示切替
                .Images.Add(M_ToolBarKey_PlanTwo, Image.FromFile(w_ImagePath & "表示切替.bmp"))
                'エラーチェック実行
                If g_LimitedFlg = False Then
                    .Images.Add(M_ToolBarKey_ErrorCheck, Image.FromFile(w_ImagePath & "エラーチェック.bmp"))
                    'エラー一覧
                    .Images.Add(M_ToolBarKey_ErrorList, Image.FromFile(w_ImagePath & "エラー一覧.bmp"))
                End If
                If m_strVerPath = 0 Then '2014/07/01 Ishiga add
                    '行事
                    .Images.Add(M_ToolBarKey_Gyouji, Image.FromFile(w_ImagePath & "行事.bmp"))
                    'タイムテーブル
                    .Images.Add(M_ToolBarKey_TimeTable, Image.FromFile(w_ImagePath & "タイムテーブル.bmp"))
                End If '2014/07/01 Ishiga add
                '2014/06/03 Shimizu add start P-06980----
                ''タイムテーブル
                '.Images.Add(M_ToolBarKey_TimeTable, Image.FromFile(w_ImagePath & "タイムテーブル.bmp"))
                '2014/06/03 Shimizu add end P-06980----
            End With

            'ﾂｰﾙﾊﾞｰのボタン作成
            With tbrMain
                'ﾂｰﾙﾊﾞｰの設定を行う
                .ImageList = imgToolBar
                'ﾎﾞﾀﾝｵﾌﾞｼﾞｪｸﾄ設定
                '[ｽﾍﾟｰｽ１]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space1"
                .Items.Add(w_Sepapator)
                '[通常終了]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_NormalEnd
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_NormalEnd
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "計画画面を終了します"
                '[確定終了]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_KakuteiEnd
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_KakuteiEnd
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "画面上の勤務を確定し終了します"
                '2017/08/07 Angelo Add start---------------------------------------------
                '[保存呼出]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_SaveCall
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_SaveCall
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "保存呼出"
                '2017/08/07 Angelo Add end-----------------------------------------------
                '[ｽﾍﾟｰｽ２]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space2"
                .Items.Add(w_Sepapator)
                '[職員情報設定]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_StaffEdit
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_StaffEdit
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "職員情報の設定を行います"
                '[ｽﾍﾟｰｽ３]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space3"
                .Items.Add(w_Sepapator)
                '[自動割当]
                '2014/07/03 Ishiga upd start---------------------------------------
                ''[自動割当]
                'w_Button = New ToolStripButton()
                'w_Button.ImageKey = M_ToolBarKey_AutoAssign
                'w_Button.Text = ""
                'w_Button.Name = M_ToolBarKey_AutoAssign
                'w_Button.ImageScaling = ToolStripItemImageScaling.None
                '.Items.Add(w_Button)
                'w_Button.ToolTipText = "自動割当を実行します"
                If m_strVerPath = 0 Then
                    '[自動割当]
                    w_Button = New ToolStripButton()
                    w_Button.ImageKey = M_ToolBarKey_AutoAssign
                    w_Button.Text = ""
                    w_Button.Name = M_ToolBarKey_AutoAssign
                    w_Button.ImageScaling = ToolStripItemImageScaling.None
                    .Items.Add(w_Button)
                    w_Button.ToolTipText = "自動割当を実行します"
                End If
                '2014/07/03 Ishiga upd end-----------------------------------------
                '[ｽﾍﾟｰｽ４]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space4"
                .Items.Add(w_Sepapator)
                '[パレット]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_Palette
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_Palette
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "貼り付け勤務選択用のパレットを表示します"
                '[検索]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_Search
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_Search
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "画面上の勤務を検索します"
                '[置換]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_Tikan
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_Tikan
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "画面上の勤務を検索し置換します"
                '[表示切替]
                w_Button = New ToolStripButton()
                w_Button.ImageKey = M_ToolBarKey_PlanTwo
                w_Button.Text = ""
                w_Button.Name = M_ToolBarKey_PlanTwo
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "一段表示／二段(計画)表示を切替します"
                '[ｽﾍﾟｰｽ５]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space5"
                .Items.Add(w_Sepapator)
                '[エラーチェック実行]
                If g_LimitedFlg = False Then
                    w_Button = New ToolStripButton()
                    w_Button.ImageKey = M_ToolBarKey_ErrorCheck
                    w_Button.Text = ""
                    w_Button.Name = M_ToolBarKey_ErrorCheck
                    w_Button.ImageScaling = ToolStripItemImageScaling.None
                    .Items.Add(w_Button)
                    w_Button.ToolTipText = "勤務のエラーチェックを実行します"
                End If
                '[ｽﾍﾟｰｽ６]
                w_Sepapator = New ToolStripSeparator()
                w_Sepapator.Name = "Space6"
                .Items.Add(w_Sepapator)
                If g_LimitedFlg = False Then
                    w_Button = New ToolStripButton()
                    w_Button.ImageKey = M_ToolBarKey_ErrorList
                    w_Button.Text = ""
                    w_Button.Name = M_ToolBarKey_ErrorList
                    w_Button.ImageScaling = ToolStripItemImageScaling.None
                    .Items.Add(w_Button)
                    w_Button.ToolTipText = "エラーチェックのリストを表示します"
                End If
                If m_strVerPath = 0 Then '2014/07/01 Ishiga add
                    '[行事]
                    w_Button = New ToolStripButton()
                    w_Button.ImageKey = M_ToolBarKey_Gyouji
                    w_Button.Text = ""
                    w_Button.Name = M_ToolBarKey_Gyouji
                    w_Button.ImageScaling = ToolStripItemImageScaling.None
                    .Items.Add(w_Button)
                    '[タイムテーブル]
                    w_Button = New ToolStripButton()
                    w_Button.ImageKey = M_ToolBarKey_TimeTable
                    w_Button.Text = ""
                    w_Button.Name = M_ToolBarKey_TimeTable
                    w_Button.ImageScaling = ToolStripItemImageScaling.None
                    .Items.Add(w_Button)
                End If '2014/07/01 Ishiga add
                '2014/06/03 Shimizu add start P-06980----
                ''[タイムテーブル]
                'w_Button = New ToolStripButton()
                'w_Button.ImageKey = M_ToolBarKey_TimeTable
                'w_Button.Text = ""
                'w_Button.Name = M_ToolBarKey_TimeTable
                'w_Button.ImageScaling = ToolStripItemImageScaling.None
                '.Items.Add(w_Button)
                '2014/06/03 Shimizu add end P-06980----
            End With

            'ｽﾃｰﾀｽﾊﾞｰの設定
            With sbrMain

                'ﾊﾟﾈﾙの設定

                '説明テキスト
                w_Panel = New ToolStripStatusLabel
                w_Panel.Text = "設定中..."
                w_Panel.Name = M_StatusBarKey_InformationText
                w_Panel.TextImageRelation = TextImageRelation.ImageBeforeText
                w_Panel.TextAlign = ContentAlignment.MiddleLeft
                w_Panel.Spring = True
                w_Panel.AutoSize = True
                w_Panel.BorderSides = ToolStripStatusLabelBorderSides.All
                w_Panel.BorderStyle = Border3DStyle.SunkenOuter
                w_Panel.Margin = New Padding(0, 2, 1, -1)
                w_Panel.Enabled = True
                .Items.Add(w_Panel)

                '操作者
                w_Panel = New ToolStripStatusLabel
                w_Text = Space(1) & "操作者：" & Convert.ToString(General.g_strUserName) & Space(1)
                w_Panel.Text = w_Text
                w_Panel.Name = M_StatusBarKey_UserName
                w_Panel.TextImageRelation = TextImageRelation.ImageBeforeText
                w_Panel.TextAlign = ContentAlignment.MiddleCenter
                w_Panel.AutoSize = True
                w_Panel.BorderSides = ToolStripStatusLabelBorderSides.All
                w_Panel.BorderStyle = Border3DStyle.SunkenOuter
                w_Panel.Margin = New Padding(0, 2, 1, -1)
                w_Panel.Enabled = True
                .Items.Add(w_Panel)

                '日付
                w_Panel = New ToolStripStatusLabel
                w_Panel.Text = ""
                w_Panel.Name = M_StatusBarKey_NowDate
                w_Panel.TextImageRelation = TextImageRelation.ImageBeforeText
                w_Panel.TextAlign = ContentAlignment.MiddleCenter
                w_Panel.AutoSize = True
                w_Panel.BorderSides = ToolStripStatusLabelBorderSides.All
                w_Panel.BorderStyle = Border3DStyle.SunkenOuter
                w_Panel.Margin = New Padding(0, 2, 1, -1)
                w_Panel.Enabled = True
                .Items.Add(w_Panel)

                '時間
                w_Panel = New ToolStripStatusLabel
                w_Panel.Text = ""
                w_Panel.Name = M_StatusBarKey_NowTime
                w_Panel.TextImageRelation = TextImageRelation.ImageBeforeText
                w_Panel.TextAlign = ContentAlignment.MiddleCenter
                w_Panel.AutoSize = True
                w_Panel.BorderSides = ToolStripStatusLabelBorderSides.All
                w_Panel.BorderStyle = Border3DStyle.SunkenOuter
                w_Panel.Margin = New Padding(0, 2, 0, -1)
                w_Panel.Enabled = True
                .Items.Add(w_Panel)
            End With

            'ﾒﾆｭｰﾊﾞｰ/ﾂｰﾙﾎﾞﾀﾝ設定
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '勤務変更の場合
                Select Case m_PackageFLG
                    Case 3
                    Case 2
                        m_lstmnuKinmuView(3).Available = False
                    Case 1
                        m_lstmnuKinmuView(3).Available = False
                    Case 0
                        m_lstmnuKinmuView(2).Available = False
                        m_lstmnuKinmuView(3).Available = False
                End Select

                'ﾒﾆｭｰﾊﾞｰ
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    m_lstmnuFile(M_MenuKakutei).Available = True '確定終了表示
                    m_lstmnuFile(M_MenuEnd).Available = False '終了非表示
                Else
                    m_lstmnuFile(M_MenuKakutei).Available = False '確定終了非表示
                End If

                m_lstmnuFile(M_MenuSaveCall).Available = False '保存呼出非表示 '2017/08/17 Angelo Add
                m_lstmnuEdit(M_MenuDelete).Enabled = False '消去使用不可
                m_lstmnuEdit(M_MenuAllClear).Enabled = False '全消去使用不可
                m_lstmnuEdit(M_MenuAllClear_Normal).Enabled = False '全消去使用不可 
                m_lstmnuPopup(M_PopDelete).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ消去使用不可
                m_lstmnuPopup(M_PopAllClear).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ全消去使用不可
                m_lstmnuPopup(M_PopAllClear_Normal).Enabled = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ全消去(通常)使用不可
                m_lstmnuMain(M_MenuJidou).Available = False '自動割当非表示
                m_lstmnuEdit(M_MenuChikan).Available = False '置換非表示
                m_lstmnuPopup(M_PopChikan).Available = False 'ﾎﾟｯﾌﾟｱｯﾌﾟ置換非表示

                'ﾂｰﾙﾎﾞﾀﾝ
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    tbrMain.Items.Item(M_ToolBarKey_KakuteiEnd).Visible = True '確定終了表示
                    tbrMain.Items.Item(M_ToolBarKey_NormalEnd).Visible = False '終了非表示
                Else
                    tbrMain.Items.Item(M_ToolBarKey_KakuteiEnd).Visible = False '確定終了非表示
                End If
                tbrMain.Items.Item(M_ToolBarKey_SaveCall).Visible = False '保存呼出非表示 '2017/08/17 Angelo Add
                '2014/07/03 Ishiga upd start-----------------------------------------------------
                'tbrMain.Items.Item(M_ToolBarKey_AutoAssign).Visible = False '自動割当非表示

                If m_strVerPath = 0 Then
                    tbrMain.Items.Item(M_ToolBarKey_AutoAssign).Visible = False '自動割当非表示
                End If
                '2014/07/03 Ishiga upd end-------------------------------------------------------
                tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False '置換非表示
            Else
                '計画新規 or 計画変更の場合
                Select Case m_PackageFLG
                    Case 3
                        m_lstmnuKinmuView(3).Available = False
                    Case 2, 1
                        m_lstmnuKinmuView(2).Available = False
                        m_lstmnuKinmuView(3).Available = False
                    Case 0
                        '勤務表示切替非表示
                        m_lstmnuView(M_MenuPlanTwo).Available = False
                        tbrMain.Items.Item(M_ToolBarKey_PlanTwo).Visible = False
                End Select

                If g_SaikeiFlg = True Then
                    '2017/11/22 Yamanishi Add ----------------------------------
                    '保存呼出非表示
                    m_lstmnuFile(M_MenuSaveCall).Available = False
                    tbrMain.Items.Item(M_ToolBarKey_SaveCall).Visible = False
                    '-----------------------------------------------------------
                    '再掲部署の場合、確定終了非表示
                    m_lstmnuFile(M_MenuKakutei).Available = False
                    tbrMain.Items.Item(M_ToolBarKey_KakuteiEnd).Visible = False
                    '自動割当も非表示
                    m_lstmnuMain(M_MenuJidou).Available = False
                    tbrMain.Items.Item(M_ToolBarKey_AutoAssign).Visible = False
                End If
            End If

            '元に戻す使用不可
            m_lstmnuEdit(M_MenuUndo).Enabled = False

            '2016/04/05 Ishiga add start-----------------
            'やり直し使用不可
            m_lstmnuEdit(M_MenuRedo).Enabled = False
            '2016/04/05 Ishiga add end-------------------

            'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
            m_lstmnuPopup(M_PopUndo).Enabled = False

            '2016/04/05 Ishiga add start-----------------
            'ﾎﾟｯﾌﾟｱｯﾌﾟやり直し使用不可
            m_lstmnuPopup(M_PopRedo).Enabled = False
            '2016/04/05 Ishiga add end-------------------

            '貼り付け使用不可
            m_lstmnuEdit(M_MenuPaste).Enabled = False

            'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
            m_lstmnuPopup(M_PopPaste).Enabled = False

            '貼り付け使用不可
            m_blnPopPasteFLG = False

            '2014/07/04 Shimizui add start P-06980----------------------------------
            If m_strVerPath = 0 Then
                If g_HopeMode = 1 Then
                    tbrMain.Items.Item(M_ToolBarKey_TimeTable).Visible = False 'タイムテーブル非表示
                    m_lstmnuView(M_MenuTimeTable).Enabled = False
                Else
                    tbrMain.Items.Item(M_ToolBarKey_TimeTable).Visible = True 'タイムテーブル表示
                    m_lstmnuView(M_MenuTimeTable).Enabled = True
                End If
            End If
            '2014/07/04 Shimizui add end P-06980----------------------------------

            '代休管理する場合はファイルの書き出し・読み込み使用不可
            If General.g_lngDaikyuMng = 0 Then
                m_lstmnuFile(M_MenuWrite).Enabled = False
                m_lstmnuFile(M_MenuLoad).Enabled = False
            End If
            If Not m_UseOutputFlg Then
                m_lstmnuFile(M_MenuFile_Line1).Available = False
                m_lstmnuFile(M_MenuWrite).Available = False
                m_lstmnuFile(M_MenuLoad).Available = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '印刷指示ﾒﾆｭｰ 表示
    Private Sub RunPrint()

        Const W_SUBNAME As String = "NSK0000HA RunPrint"
        Try
            Dim w_clsObj As Object
            '2011/09/07 Y.I Add St-----
            Dim w_strSelKinmuDeptCD As String
            Dim w_strSelKinmuDeptNm As String
            '2011/09/07 Y.I Add Ed-----

            m_PrintFlg = True

            '画面上のﾃﾞｰﾀを保存します。
            Call RunSaveContinue()

            If m_PrintFlg Then
                '､検索･置換画面が開いている場合は閉じる
                Call HideModelessForm()

                'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成
                w_clsObj = New NsAid_NSC0010H.clsNSC0010H
                '2011/09/07 Y.I Add St-----
                w_strSelKinmuDeptCD = General.g_strSelKinmuDeptCD
                w_strSelKinmuDeptNm = General.g_strSelKinmuDeptNm
                '2011/09/07 Y.I Add Ed-----

                'ﾌﾟﾛﾊﾟﾃｨ設定
                'Inatalltype渡し
                w_clsObj.pInstallType = General.g_InstallType

                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm
                w_clsObj.pKangoTaniInfo(General.g_strUserKinmuDeptCD) = General.g_strUserKinmuDeptNm
                w_clsObj.pUserInfo(General.g_strUserID, General.g_strUserMngID) = General.g_strUserName
                w_clsObj.pUserGroupCD = General.g_strUserGroupCD
                '--- 計画開始日（一括出力が不可能なので特に意味はない）
                w_clsObj.pSelectDate = m_KeikakuKikan.StartDate
                w_clsObj.pAccessModule = g_AppName
                w_clsObj.pGetDataObj = General.g_objGetData
                w_clsObj.pSelectDateObj = General.g_objSelectDate
                w_clsObj.pGetMasterObj = General.g_objGetMaster

                w_clsObj.pSecurityObj = General.g_objSecurity
                w_clsObj.pSelectStaffObj = General.g_objSelectStaff
                w_clsObj.pIdoDataObj = General.g_objIdoData
                w_clsObj.pSelectDeptObj = General.g_objSelectDept
                w_clsObj.pSyouninDataObj = General.g_objSyouninData
                w_clsObj.pComCyokinObj = General.g_objComCyokin
                w_clsObj.pDutyGroupObj = General.g_objDutyGroup
                w_clsObj.pProcessObj = Me
                '共通情報ﾏｽﾀ画面表示
                w_clsObj.mShowWindow()
                '2011/09/07 Y.I Add St-----
                General.g_strSelKinmuDeptCD = w_strSelKinmuDeptCD
                General.g_strSelKinmuDeptNm = w_strSelKinmuDeptNm
                '2011/09/07 Y.I Add Ed-----

                w_clsObj = Nothing
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '*********************************
    '   初期表示時のActiveセル設定
    '*********************************
    Private Sub Set_KeikakuFirstCell()

        Const W_SUBNAME As String = "NSK0000HA Set_KeikakuFirstCell"

        Dim w_ActiveSpr As FpSpread
        Dim w_TargetCell_Col As Integer
        Dim w_RowIdx As Integer
        Try
            '対象ｽﾌﾟﾚｯﾄﾞ
            If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                w_ActiveSpr = sprSheet_M
                w_TargetCell_Col = m_KeikakuKikan.KinmuDataStartCol
            Else
                w_ActiveSpr = sprSheet_4W
                w_TargetCell_Col = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
            End If

            picHide.Visible = True

            With w_ActiveSpr.Sheets(0)
                '最左セル設定
                w_ActiveSpr.SetViewportLeftColumn(0, w_TargetCell_Col)

                '最上セル設定
                w_ActiveSpr.SetViewportTopRow(0, M_KinmuDataStart_Row)
                For w_RowIdx = m_StaffRow.StartRow To m_StaffRow.EndRow
                    '職員が非表示になっているか
                    If .GetRowHeight(w_RowIdx) <> 0 Then
                        Exit For
                    End If
                Next w_RowIdx

                '対象期間の初日のﾃﾞｰﾀ部最上行をActiveにする
                .SetActiveCell(w_RowIdx, w_TargetCell_Col)

                w_ActiveSpr.Focus()

                Call Set_CopyMenu(.ActiveColumn.Index, .ActiveRow.Index, False)
            End With

            'ｽﾌﾟﾚｯﾄﾞｵﾌﾞｼﾞｪｸﾄ変数解放
            w_ActiveSpr = Nothing

            picHide.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '4週切り替え時の実績部分のｾﾙの色制御
    Private Sub Set_JissekiCellColor()

        Const W_SUBNAME As String = "NSK0000HA Set_JissekiCellColor"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_ColorFlg As Boolean
        Dim w_Int As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_HaizokuFlg As Boolean
        Dim w_ShukeiFlg As Boolean
        Dim w_Index As Integer
        Dim w_From_Col() As Integer
        Dim w_To_Col() As Integer
        Dim w_MonthSprLoop As Integer
        Dim w_Col4W As Integer
        Dim w_DataSprRow As Integer
        Dim w_TotalSprRow As Integer
        Dim w_MtrxLoop As Integer
        Dim w_MtrxCnt As Integer
        Dim w_TeamLoop As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_StaffIdx As Integer
        Dim w_DaikyuFlg As Boolean
        Dim w_Int2 As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_lng3 As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add 
        Try
            If m_SelViewKikan = 0 Then
                '1ｹ月表示のとき
                Exit Sub
            End If

            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '勤務変更・計画変更のとき
                '勤務変更のとき
                Exit Sub
            End If

            picHide.Visible = True
            With sprSheet_4W.Sheets(0)

                '--------------------
                '背景色を元に戻す
                '--------------------
                'ﾀｲﾄﾙ部分の背景色を元に戻す
                Call SubSetStyle(sprSheet_4W, M_Interval_Row, m_4WeekKikan(1).KinmuDataStartCol, M_YYYYMMDDLabel_Row, m_4WeekKikan(UBound(m_4WeekKikan) - 1).KinmuDataEndCol, 0, 0, , SystemColors.Control)

                If m_DayAreaRow.EndRow > 0 Then
                    '日別集計部分の背景色を元に戻す
                    Call SubSetStyle(sprSheet_4W, m_DayAreaRow.StartRow, m_4WeekKikan(1).KinmuDataStartCol, m_DayAreaRow.EndRow, m_4WeekKikan(UBound(m_4WeekKikan) - 1).KinmuDataEndCol, 0, 0, , SystemColors.Control)
                End If

                '日別集計部分の背景色を元に戻す
                Call SubSetStyle(sprDayTotal_4W, -1, m_4WeekKikan(1).KinmuDataStartCol, -1, m_4WeekKikan(UBound(m_4WeekKikan) - 1).KinmuDataEndCol, 0, 0, , SystemColors.Control)

                If UBound(m_HMtrx_4Week) > 0 Then
                    '個人別集計の背景色を元に戻す
                    Call SubSetStyle(sprSheet_4W, M_Interval_Row, m_4WeekKikan(1).PersonalStartCol, m_DayAreaRow.EndRow, m_4WeekKikan(UBound(m_4WeekKikan) - 1).PersonalEndCol, 0, 0, , SystemColors.Control)
                End If

                '明細の背景色を元に戻す
                Call SubSetStyle(sprSheet_4W, m_StaffRow.StartRow - 1, m_4WeekKikan(1).KinmuDataStartCol, m_StaffRow.EndRow, m_4WeekKikan(UBound(m_4WeekKikan) - 1).KinmuDataEndCol, 0, 0, , Color.White)

                'For w_Int = 1 To UBound(m_4WeekKikan) - 1
                For w_Int = 1 To UBound(m_4WeekKikan)
                    For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ色制御
                            For w_Col = m_4WeekKikan(w_Int).KinmuDataStartCol To m_4WeekKikan(w_Int).KinmuDataEndCol
                                '部署異動ﾁｪｯｸ（配属期間内）
                                If Not (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        '2015/04/10 Bando Upd Start ======================
                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                        '2015/04/10 Bando Upd End   ======================

                                        '理由区分による色設定(文字色/背景色)
                                        If w_RiyuKBN = "1" Then
                                            '通常
                                            w_ForeColor = Color.Black
                                            w_BackColor = Color.White
                                        ElseIf w_RiyuKBN = "2" Then
                                            '要請勤務 文字/背景色
                                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                        ElseIf w_RiyuKBN = "3" Then
                                            '希望勤務 文字/背景色
                                            '2015/07/22 Bando Upd Start ==========================
                                            If w_Comment = "" Then
                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                            Else
                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                            End If
                                            '2015/07/22 Bando Upd End   ==========================
                                        ElseIf w_RiyuKBN = "4" Then
                                            '再掲勤務 文字/背景色
                                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                        ElseIf w_RiyuKBN = "5" Then
                                            '再掲勤務 文字/背景色
                                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                        ElseIf w_RiyuKBN = "6" Then
                                            '応援勤務　文字/背景色
                                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                        End If
                                        '代休発生勤務 文字/背景色
                                        If General.g_lngDaikyuMng = 0 Then
                                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                            If w_Var <> "" Then
                                                w_StaffIdx = Integer.Parse(w_Var)
                                                w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var2 <> "" Then
                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                        w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                    End If
                                                End If
                                            End If
                                        End If

                                        '2015/07/22 Bando Add Start ===========================
                                        '控除があるか判断し　背景色変更
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If w_Var <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var2 <> "" Then
                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                        If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                Exit For
                                                            End If
                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                            Exit For
                                                        End If
                                                    Next
                                                End If
                                            End If
                                        End If
                                        '2015/07/22 Bando Add End   ===========================

                                        If w_Time <> "" Then
                                            '時間年休入力の場合
                                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                        End If

                                        If General.g_lngDaikyuMng = 0 Then
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                If IsNumeric(w_Var) = True Then

                                                    w_YYYYMMDD = Integer.Parse(w_Var)

                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                        If m_StaffData(w_StaffIdx).OuenStaffFlg = 0 Then
                                                            w_DaikyuFlg = False
                                                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                                                For w_lng3 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail)
                                                                    If m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail(w_lng3).DaikyuDate = w_YYYYMMDD Then
                                                                        w_DaikyuFlg = True
                                                                        Exit For
                                                                    End If
                                                                Next w_lng3
                                                                If w_DaikyuFlg = True Then
                                                                    Exit For
                                                                End If
                                                            Next w_Int2
                                                            If w_DaikyuFlg = False Then

                                                                w_ForeColor = ColorTranslator.FromOle(M_AJUSTDAIKYUCOLOR)
                                                                w_BackColor = Color.White
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If

                                        If w_Flg = M_TABUSHO Then
                                            '他部署確定ﾃﾞｰﾀの場合
                                            w_ForeColor = ColorTranslator.FromOle(m_Tabusho_Fore)
                                        End If

                                        .Cells(w_Row, w_Col).BackColor = w_BackColor
                                        .Cells(w_Row, w_Col).ForeColor = w_ForeColor
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row
                Next w_Int

                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    w_StartCol = M_KinmuData_Col
                End If

                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    '--- 転出日,配属日の取得 ---
                    'ﾃﾞｰﾀ格納配列番号 取得
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        w_Index = Integer.Parse(w_Var)
                    End If

                    ReDim w_From_Col(UBound(m_StaffData(w_Index).IdoData))
                    ReDim w_To_Col(UBound(m_StaffData(w_Index).IdoData))

                    For w_Int = 1 To UBound(m_StaffData(w_Index).IdoData)
                        '年月日から配属日/転出日の列番号 取得
                        If Get_Col_4W(m_StaffData(w_Index).IdoData(w_Int).IdoYMD, w_From_Col(w_Int)) = False Then
                            w_From_Col(w_Int) = M_KinmuData_Col
                        End If
                        If Get_Col_4W(m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD, w_To_Col(w_Int)) = False Then
                            w_To_Col(w_Int) = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        End If
                    Next w_Int

                    '配属期間外表示色設定
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan) - 1).KinmuDataEndCol

                        w_HaizokuFlg = False
                        For w_Int = 1 To UBound(w_From_Col)
                            If w_From_Col(w_Int) <= w_Col AndAlso w_Col <= w_To_Col(w_Int) Then
                                '配属期間内のとき
                                w_HaizokuFlg = True
                                Exit For
                            End If
                        Next w_Int

                        '応援勤務者は配属期間外とする
                        If m_StaffData(w_Index).OuenStaffFlg = 1 Then
                            w_HaizokuFlg = False
                        End If

                        If w_HaizokuFlg = True Then
                            '配属期間内のとき
                        Else
                            '配属期間外の時
                            w_ShukeiFlg = False
                            'For w_Int = 1 To UBound(m_4WeekKikan) - 1
                            For w_Int = 1 To UBound(m_4WeekKikan)
                                If m_4WeekKikan(w_Int).PersonalStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_Int).PersonalEndCol Then
                                    w_ShukeiFlg = True
                                    Exit For
                                End If
                            Next w_Int

                            If w_ShukeiFlg = False Then
                                '４週期間の個人別集計範囲外のとき
                                .Cells(w_Row, w_Col).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_MonthBefore_Fore)
                            Else
                                '４週期間の個人別集計範囲内のとき
                            End If
                        End If
                    Next w_Col
                Next w_Row

                If m_JissekiKikan.KinmuDataStartCol <> 0 AndAlso m_JissekiKikan.KinmuDataEndCol <> -1 Then
                    If Get_Col_4W(m_JissekiKikan.EndDate, w_Col) = True Then

                        '4週期間(集計列含む)  背景色 設定
                        If m_DayAreaRow.EndRow = 0 Then
                            .Cells(M_Interval_Row, m_4WeekKikan(1).KinmuDataStartCol, m_StaffRow.EndRow, w_Col).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                        Else
                            .Cells(M_Interval_Row, m_4WeekKikan(1).KinmuDataStartCol, m_DayAreaRow.EndRow, w_Col).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                        End If

                        '4週期間(固定集計列)  背景色 設定
                        Call SubSetStyle(sprDayTotal_4W, -1, m_4WeekKikan(1).KinmuDataStartCol, -1, w_Col, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                    End If
                End If

                '計画立案期間毎に色を変更
                w_ColorFlg = False
                For w_Int = 1 To UBound(m_4WeekKikan)
                    If w_ColorFlg = False Then
                        w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                        w_ColorFlg = True
                    Else
                        w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                        w_ColorFlg = False
                    End If

                    .Cells(M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataStartCol, M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataEndCol).BackColor = w_BackColor
                Next w_Int

                '-----------------------------------------------
                '表示されている期間の前の期間の背景色を変更する
                '-----------------------------------------------
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    w_StartCol = M_KinmuData_Col
                End If
                w_EndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1

                If w_StartCol < w_EndCol Then
                    '選択4週期間の実績部分（前4週期間）が計画期間にかかっている場合

                    '実績部分の背景色変更
                    If m_DayAreaRow.EndRow = 0 Then
                        .Cells(M_Interval_Row, w_StartCol, m_StaffRow.EndRow, w_EndCol).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    Else
                        .Cells(M_Interval_Row, w_StartCol, m_DayAreaRow.EndRow, w_EndCol).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    End If

                    '計画立案期間毎に色を変更
                    w_ColorFlg = False
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        If w_ColorFlg = False Then
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                            w_ColorFlg = True
                        Else
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                            w_ColorFlg = False
                        End If

                        .Cells(M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataStartCol, M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataEndCol).BackColor = w_BackColor
                    Next w_Int
                Else
                    '実績部分の背景色変更
                    If m_DayAreaRow.EndRow = 0 Then
                        .Cells(M_Interval_Row, M_KinmuDataStart_Col, m_StaffRow.EndRow, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    Else
                        Call SubSetStyle(sprSheet_4W, M_Interval_Row, M_KinmuDataStart_Col, m_DayAreaRow.EndRow, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                    End If

                    '計画立案期間毎に色を変更
                    w_ColorFlg = False
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        If w_ColorFlg = False Then
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color1)
                            w_ColorFlg = True
                        Else
                            w_BackColor = ColorTranslator.FromOle(M_FourWeek_Color2)
                            w_ColorFlg = False
                        End If

                        .Cells(M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataStartCol, M_Interval_Row, m_4WeekKikan(w_Int).KinmuDataEndCol).BackColor = w_BackColor
                    Next w_Int
                End If
            End With

            If w_StartCol < w_EndCol Then
                '選択4週期間の実績部分（前4週期間）が計画期間にかかっている場合

                '実績部分の集計の背景色変更
                Call SubSetStyle(sprDayTotal_4W, -1, w_StartCol, -1, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))
            Else
                With sprDayTotal_4W.Sheets(0)
                    '実績部分の集計の背景色変更
                    Call SubSetStyle(sprDayTotal_4W, -1, M_KinmuDataStart_Col, -1, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1, 0, 0, ColorTranslator.FromOle(m_MonthBefore_Fore), ColorTranslator.FromOle(m_MonthBefore_Back))
                End With
            End If

            '集計項目数取得
            w_MtrxCnt = UBound(m_VMtrx)

            'ｴﾗｰﾁｪｯｸ（1ヶ月用ｽﾌﾟﾚｯﾄﾞより背景色、文字色を取得する）
            For w_MonthSprLoop = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_MonthSprLoop)
                If w_Var <> "" Then

                    If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then

                        '4週用列番号を取得
                        If Get_Col_4W(w_Var, w_Col4W) = True Then

                            '表示対象4週期間か
                            If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= w_Col4W AndAlso w_Col4W <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol Then
                                '表示対象4週期間

                                '計画期間行
                                sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).BackColor = sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, w_MonthSprLoop).BackColor
                                sprSheet_4W.Sheets(0).Cells(M_MonthLabel_Row, w_Col4W).ForeColor = sprSheet_M.Sheets(0).Cells(M_MonthLabel_Row, w_MonthSprLoop).ForeColor

                                '各集計行
                                w_DataSprRow = m_DayAreaRow.StartRow
                                w_TotalSprRow = 0
                                For w_TeamLoop = 1 To m_TeamCnt + 1 '総合計のため＋１
                                    For w_MtrxLoop = 1 To w_MtrxCnt
                                        'ﾃﾞｰﾀｽﾌﾟﾚｯﾄﾞ
                                        sprSheet_4W.Sheets(0).Cells(w_DataSprRow, w_Col4W).BackColor = sprSheet_M.Sheets(0).Cells(w_DataSprRow, w_MonthSprLoop).BackColor
                                        sprSheet_4W.Sheets(0).Cells(w_DataSprRow, w_Col4W).ForeColor = sprSheet_M.Sheets(0).Cells(w_DataSprRow, w_MonthSprLoop).ForeColor

                                        '固定集計ｽﾌﾟﾚｯﾄﾞ
                                        If sprDayTotal_M.Sheets(0).Cells(w_TotalSprRow, w_MonthSprLoop).BackColor.A = 0 Then
                                            sprDayTotal_4W.Sheets(0).Cells(w_TotalSprRow, w_Col4W).BackColor = SystemColors.Control
                                        Else
                                            sprDayTotal_4W.Sheets(0).Cells(w_TotalSprRow, w_Col4W).BackColor = sprDayTotal_M.Sheets(0).Cells(w_TotalSprRow, w_MonthSprLoop).BackColor
                                        End If
                                        sprDayTotal_4W.Sheets(0).Cells(w_TotalSprRow, w_Col4W).ForeColor = sprDayTotal_M.Sheets(0).Cells(w_TotalSprRow, w_MonthSprLoop).ForeColor

                                        '集計行ｶｳﾝﾄｱｯﾌﾟ
                                        w_DataSprRow = w_DataSprRow + 1
                                        w_TotalSprRow = w_TotalSprRow + 1
                                    Next w_MtrxLoop
                                Next w_TeamLoop
                            End If '---> 選択期間内？
                        End If '---> 4週期間列番号取得ＯＫ？
                    End If '---> 取得値ＯＫ
                End If '---> ｽﾌﾟﾚｯﾄﾞﾃｷｽﾄ取得ＯＫ
            Next w_MonthSprLoop

            picHide.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_ToolTipText(ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_Obj As FpSpread, ByVal p_Flg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Set_ToolTipText"

        Static w_Col As Integer
        Static w_Row As Integer
        Dim w_Flg As Boolean
        Dim w_WeekLoop As Integer
        Dim w_WeekCnt As Integer
        Dim w_Var As Object
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_DutyKinmuCD() As Object '日当直勤務CD
        Dim w_GroupCD() As Object '日当直グループCD
        Dim w_UniqueSeqNO As String = String.Empty '届出UniqueSeqNO
        Dim w_AppliCD As String = String.Empty '届出CD
        Dim w_HolBunruiCD As String = String.Empty '休み分類CD
        Dim w_GetContentsKBN As String = String.Empty '取得内容区分(1:全日、2:前半、3:後半、4:時間年休)
        Dim w_intTimeFrom As Integer '時間FROM
        Dim w_intTimeTo As Integer '時間TO
        Dim w_strNextDayFlg As String = String.Empty '翌日FLG
        Dim w_StaffName As String
        Dim w_PointerDate As String
        Dim w_ToolTipText As String
        Dim w_Bool As Boolean
        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_KangoName As String
        Dim w_StaffIdx As Integer
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add 
        Try
            If w_Col = p_Col AndAlso w_Row = p_Row AndAlso p_Flg = False Then
                '前回と同一なら処理を行わない
                Exit Sub
            End If

            '列・行番号退避
            w_Col = p_Col
            w_Row = p_Row

            w_StaffIdx = 0

            '計画実績期間チェック
            w_Flg = False
            If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                '１ヶ月表示の場合
                If m_KeikakuKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_KeikakuKikan.KinmuDataEndCol Then
                    w_Flg = True
                ElseIf m_JissekiKikan.KinmuDataStartCol <= w_Col AndAlso w_Col <= m_JissekiKikan.KinmuDataEndCol Then
                    w_Flg = True
                End If

                '対象職員の職員管理番号を取得
                w_Var = p_Obj.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    w_StaffIdx = Integer.Parse(w_Var)
                End If
            Else
                '４週表示の場合
                w_WeekCnt = UBound(m_4WeekKikan)
                For w_WeekLoop = 1 To w_WeekCnt
                    If m_4WeekKikan(w_WeekLoop).KinmuDataStartCol <= w_Col AndAlso w_Col <= m_4WeekKikan(w_WeekLoop).KinmuDataEndCol Then
                        w_Flg = True
                        Exit For
                    End If
                Next w_WeekLoop

                '対象職員の職員管理番号を取得
                w_Var = p_Obj.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    w_StaffIdx = Integer.Parse(w_Var)
                End If
            End If

            '列が表示対象期間にない場合
            If w_Flg = False Then
                ToolTip1.SetToolTip(p_Obj, "")
                Exit Sub
            End If

            '職員ﾃﾞｰﾀｴﾘｱチェック
            If w_Row < m_StaffRow.StartRow OrElse m_StaffRow.EndRow < w_Row Then
                '行が表示対象ｴﾘｱにない場合
                ToolTip1.SetToolTip(p_Obj, "")
                Exit Sub
            End If

            ReDim w_DutyKinmuCD(0)
            ReDim w_GroupCD(0)

            'ｽﾌﾟﾚｯﾄﾞの設定文字列取得
            w_Var = p_Obj.Sheets(0).GetText(w_Row, w_Col)
            If w_Var <> "" Then
                If IsDBNull(w_Var) = False Then
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then
                        '日当直
                        Call Get_DutyMark(w_Var, w_DutyKinmuCD, w_GroupCD)
                    ElseIf (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                        '届出
                        Call Get_AppliMark(w_Var, w_UniqueSeqNO, w_AppliCD, w_HolBunruiCD, w_GetContentsKBN, w_intTimeFrom, w_intTimeTo, w_strNextDayFlg)
                    Else
                        '勤務
                        '2015/04/10 Bando Upd Start ========================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   ========================
                        If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                            '届出のコンポーネントありの時
                            If m_blnAppliUseFlg = False Then
                                '届出
                                w_Var = p_Obj.Sheets(0).GetText((w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, w_Col)
                                If w_Var <> "" Then
                                    Call Get_AppliMark(w_Var, w_UniqueSeqNO, w_AppliCD, w_HolBunruiCD, w_GetContentsKBN, w_intTimeFrom, w_intTimeTo, w_strNextDayFlg)
                                End If
                            End If
                        End If
                    End If
                End If
            End If

            '職員名称 取得
            w_StaffName = ""
            w_Var = p_Obj.Sheets(0).GetText(w_Row - ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine), M_StaffName_Col)
            If w_Var <> "" Then
                If IsDBNull(w_Var) = False Then
                    w_StaffName = Convert.ToString(w_Var)
                End If
            End If

            '日付 取得
            w_PointerDate = ""
            w_Var = p_Obj.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
            If w_Var <> "" Then
                If IsDBNull(w_Var) = False Then
                    If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                        w_PointerDate = String.Format("{0, 2}", Mid(Convert.ToString(w_Var), 5, 2)) & "/" & String.Format("{0, 2}", General.paRight(Convert.ToString(w_Var), 2))
                    End If
                End If
            End If

            w_ToolTipText = Space(1) & w_PointerDate & Space(1) & w_StaffName

            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_DutyData Then
                w_Bool = False
                '日当直
                For w_Int2 = 1 To UBound(w_DutyKinmuCD)
                    If IsNumeric(w_DutyKinmuCD(w_Int2)) = True Then
                        If w_Bool Then
                            w_ToolTipText = w_ToolTipText & " / "
                        Else
                            w_ToolTipText = w_ToolTipText & Space(3)
                        End If

                        '日当直勤務CDが取得できた場合
                        w_ToolTipText = w_ToolTipText & Get_KinmuTipText(w_DutyKinmuCD(w_Int2)) '勤務CD３桁化

                        '日当直グループCDから名称取得・セット
                        'ﾃﾞﾌｫﾙﾄは日当直グループCD(名称がない場合はCDをセット)
                        w_KangoName = w_GroupCD(w_Int2)
                        For w_Int = 1 To UBound(m_DutyGroupM)
                            If w_GroupCD(w_Int2) = m_DutyGroupM(w_Int).CD Then
                                w_KangoName = m_DutyGroupM(w_Int).Name_Renamed
                                Exit For
                            End If
                        Next w_Int
                        If w_KangoName <> "" Then
                            w_ToolTipText = w_ToolTipText & " (" & w_KangoName & ")"
                        End If

                        w_Bool = True
                    End If
                Next w_Int2
            ElseIf (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_AppliData Then
                '届出
                If IsNumeric(w_HolBunruiCD) = True Then
                    '休み分類CDが取得できた場合

                    '届出CDから名称取得・セット
                    'ﾃﾞﾌｫﾙﾄは届出CD(名称がない場合はCDをセット)
                    w_KangoName = w_AppliCD
                    For w_Int = 1 To UBound(m_AppliCationM)
                        If w_AppliCD = m_AppliCationM(w_Int).CD Then
                            w_KangoName = m_AppliCationM(w_Int).Name_Renamed
                            Exit For
                        End If
                    Next w_Int
                    If w_KangoName <> "" Then
                        w_ToolTipText = w_ToolTipText & Space(3) & w_KangoName
                    End If

                    w_ToolTipText = w_ToolTipText & " / " & Get_AppliTipText(w_HolBunruiCD)

                    Select Case w_GetContentsKBN
                        Case "1"
                            '全日
                            w_ToolTipText = w_ToolTipText & " (全日)"
                        Case "2"
                            '前半
                            w_ToolTipText = w_ToolTipText & " (前半)"
                        Case "3"
                            '後半
                            w_ToolTipText = w_ToolTipText & " (後半)"
                        Case "4"
                            '時間年休
                            w_ToolTipText = w_ToolTipText & " (時間年休 " & Format(w_intTimeFrom, "#0:00") & "～"
                            If w_strNextDayFlg = "1" Then
                                w_ToolTipText = w_ToolTipText & "翌"
                            End If
                            w_ToolTipText = w_ToolTipText & Format(w_intTimeTo, "#0:00") & ")"
                    End Select
                End If
            Else
                '勤務
                If IsNumeric(w_KinmuCD) = True Then
                    '勤務CDが取得できた場合
                    w_ToolTipText = w_ToolTipText & Space(3) & Get_KinmuTipText(w_KinmuCD) '勤務CD３桁化
                    If General.g_lngDaikyuMng = 0 Then
                        '代休の場合は対象の勤務の日付を表示
                        If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                            For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                For w_Int3 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail)
                                    If m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail(w_Int3).DaikyuDate = Integer.Parse(w_Var) Then 'ここでのw_Varは日付がはいっている
                                        w_ToolTipText = w_ToolTipText & "(" & String.Format("{0, 2}", Mid(Convert.ToString(m_StaffData(w_StaffIdx).Daikyu(w_Int2).HolDate), 5, 2)) & "/" & String.Format("{0, 2}", General.paRight(Convert.ToString(m_StaffData(w_StaffIdx).Daikyu(w_Int2).HolDate), 2)) & ")"
                                    End If
                                Next w_Int3
                            Next w_Int2
                        Else
                            '代休以外で祝日であって代休対象勤務であれば、取得済みの代休があれば表示
                            If InStr(m_HolDateStr, Convert.ToString(Integer.Parse(w_Var))) > 0 Then
                                For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                    For w_Int3 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail)
                                        If m_StaffData(w_StaffIdx).Daikyu(w_Int2).HolDate = Integer.Parse(w_Var) Then 'ここでのw_Varは日付がはいっている
                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail(w_Int3).DaikyuDate <> 0 Then
                                                w_ToolTipText = w_ToolTipText & "(" & String.Format("{0, 2}", Mid(Convert.ToString(m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail(w_Int3).DaikyuDate), 5, 2)) & "/" & String.Format("{0, 2}", General.paRight(Convert.ToString(m_StaffData(w_StaffIdx).Daikyu(w_Int2).DaikyuDetail(w_Int3).DaikyuDate), 2)) & ")"
                                            End If
                                        End If
                                    Next w_Int3
                                Next w_Int2
                            End If
                        End If
                    End If

                    '応援勤務者の場合は看護単位CDを自部署にする
                    If m_StaffData(w_StaffIdx).OuenStaffFlg = Double.Parse("1") Then
                        Call Get_OuenKangoCD(Integer.Parse(w_Var), w_StaffIdx, w_KangoCD)
                    End If

                    '応援先看護単位CDから名称取得・セット
                    'ﾃﾞﾌｫﾙﾄは看護単位CD(名称がない場合はCDをセット)
                    w_KangoName = w_KangoCD
                    For w_Int = 1 To UBound(m_KangoM)
                        If w_KangoCD = m_KangoM(w_Int).CD Then
                            w_KangoName = m_KangoM(w_Int).Name_Renamed
                            Exit For
                        End If
                    Next w_Int
                    If w_KangoName <> "" Then
                        w_ToolTipText = w_ToolTipText & Space(2) & w_KangoName
                    End If

                    '2015/04/10 Bando Add Start ===========================
                    '希望コメント
                    If w_Comment <> "" Then
                        w_ToolTipText = w_ToolTipText & Space(2) & w_Comment
                    End If
                    '2015/04/10 Bando Add End   ===========================

                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出のコンポーネントありの時
                        If m_blnAppliUseFlg = False Then
                            '届出
                            If IsNumeric(w_HolBunruiCD) = True Then
                                '休み分類CDが取得できた場合

                                '届出CDから名称取得・セット
                                'ﾃﾞﾌｫﾙﾄは届出CD(名称がない場合はCDをセット)
                                w_KangoName = w_AppliCD
                                For w_Int = 1 To UBound(m_AppliCationM)
                                    If w_AppliCD = m_AppliCationM(w_Int).CD Then
                                        w_KangoName = m_AppliCationM(w_Int).Name_Renamed
                                        Exit For
                                    End If
                                Next w_Int
                                If w_KangoName <> "" Then
                                    w_ToolTipText = w_ToolTipText & Space(3) & w_KangoName
                                End If

                                w_ToolTipText = w_ToolTipText & " / " & Get_AppliTipText(w_HolBunruiCD)

                                Select Case w_GetContentsKBN
                                    Case "1"
                                        '全日
                                        w_ToolTipText = w_ToolTipText & " (全日)"
                                    Case "2"
                                        '前半
                                        w_ToolTipText = w_ToolTipText & " (前半)"
                                    Case "3"
                                        '後半
                                        w_ToolTipText = w_ToolTipText & " (後半)"
                                    Case "4"
                                        '時間年休
                                        w_ToolTipText = w_ToolTipText & " (時間年休 " & Format(w_intTimeFrom, "#0:00") & "～"
                                        If w_strNextDayFlg = "1" Then
                                            w_ToolTipText = w_ToolTipText & "翌"
                                        End If
                                        w_ToolTipText = w_ToolTipText & Format(w_intTimeTo, "#0:00") & ")"
                                End Select
                            End If
                        End If
                    Else
                        If w_Time <> "" Then
                            '時間年休が設定されている場合
                            w_ToolTipText = w_ToolTipText & Space(2) & Set_ToolTipJikanNenkyu(w_Time)
                        End If
                    End If
                End If
            End If

            ToolTip1.SetToolTip(p_Obj, "")
            ToolTip1.SetToolTip(p_Obj, w_ToolTipText)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_KangoKasanTotalData()

        Const W_SUBNAME As String = "NSK0000HA Set_KangoKasanTotalData"

        Dim w_Nissu As Integer
        Dim w_AveYouin As Double
        Dim w_Youin As Double
        Dim w_AveNightTime As Double
        Dim w_SelIndex As Integer
        Dim w_ListIdx As Integer
        Dim w_Answer As Double
        Dim w_str As String = String.Empty
        Dim w_dblWorkTotal As Double
        Dim w_lngLoop As Integer
        Try

            'もし４週期間が選択されていたら
            If cmbKikan.SelectedIndex > 0 Then

                w_ListIdx = cmbKikan.SelectedIndex
                w_SelIndex = GetItemData(cmbKikan, w_ListIdx)

                '計画期間日数
                w_Nissu = m_4WeekKikan(w_SelIndex).KinmuDataEndCol - m_4WeekKikan(w_SelIndex).KinmuDataStartCol + 1

                m_YakinJujiCnt_4W(w_SelIndex) = 0
                For w_lngLoop = 1 To UBound(m_YakinData)
                    w_dblWorkTotal = w_dblWorkTotal + m_YakinData(w_lngLoop).Time
                    m_YakinJujiCnt_4W(w_SelIndex) = m_YakinJujiCnt_4W(w_SelIndex) + m_YakinData(w_lngLoop).JujiCnt
                Next w_lngLoop
                w_dblWorkTotal = w_dblWorkTotal / 60

                '入院患者数　対　看護要員数（(AveInPatientNum / 届出区分)*3）
                If m_TodokedeKbn <> 0 Then
                    w_Youin = General.paRoundUp((m_AveInPatient / m_TodokedeKbn) * 3, 0)
                Else
                    w_Youin = 0
                End If

                '月平均夜勤時間数
                If m_YakinJujiCnt_4W(w_SelIndex) <> 0 Then
                    '小数設定(夜間時間)
                    Call Calc_SyosuSettei(w_dblWorkTotal, 4, w_Answer)

                    w_AveNightTime = w_dblWorkTotal / m_YakinJujiCnt_4W(w_SelIndex)

                    '小数設定(月平均夜勤時間数)
                    Call Calc_SyosuSettei(w_AveNightTime, 3, w_Answer)
                    '計算結果後の値を格納
                    w_AveNightTime = w_Answer
                Else
                    w_AveNightTime = 0
                End If

                '看護加算計算結果貼り付け
                Call Calc_SyosuSettei(w_dblWorkTotal, 4, w_Answer)

                '表示形式に変換(夜間時間総時間)
                Call Calc_Format(w_Answer, 4, w_str)
                lblTotalTime.Text = w_str

                '表示形式に変換(入院患者数対看護要員数)
                Call Calc_Format(w_Youin, 2, w_str)
                lblKangoYouin.Text = w_str

                '表示形式に変換(月平均夜勤時間数)
                Call Calc_Format(w_AveNightTime, 3, w_str)

                If Double.Parse(w_str) <= m_AveNightTime Then
                    lblAveTime.BackColor = SystemColors.Control
                Else
                    lblAveTime.BackColor = Color.Red
                End If

                lblAveTime.Text = w_str

                '4週/1ヶ月の場合はﾘｽﾄｲﾝﾃﾞｯｸｽが0　もしくは　1ヶ月/1ヶ月 4週/4週の場合
            ElseIf cmbKikan.SelectedIndex = 0 OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then

                '計画期間日数
                w_Nissu = m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol + 1

                m_YakinJujiCnt = 0
                For w_lngLoop = 1 To UBound(m_YakinData)
                    w_dblWorkTotal = w_dblWorkTotal + m_YakinData(w_lngLoop).Time
                    m_YakinJujiCnt = m_YakinJujiCnt + m_YakinData(w_lngLoop).JujiCnt
                Next w_lngLoop
                w_dblWorkTotal = w_dblWorkTotal / 60

                '入院患者数　対　看護要員数（(AveInPatientNum / 届出区分)*3）
                If m_TodokedeKbn <> 0 Then
                    w_Youin = General.paRoundUp((m_AveInPatient / m_TodokedeKbn) * 3, 0)
                Else
                    w_Youin = 0
                End If

                '月平均夜勤時間数
                If m_YakinJujiCnt <> 0 Then
                    w_AveNightTime = w_dblWorkTotal / m_YakinJujiCnt

                    '小数設定(月平均夜勤時間数)
                    Call Calc_SyosuSettei(w_AveNightTime, 3, w_Answer)
                    '計算結果後の値を格納
                    w_AveNightTime = w_Answer
                Else
                    w_AveNightTime = 0
                End If

                '看護加算計算結果貼り付け
                Call Calc_SyosuSettei(w_dblWorkTotal, 4, w_Answer)

                '表示形式に変換(夜間時間総時間)
                Call Calc_Format(w_Answer, 4, w_str)
                lblTotalTime.Text = w_str

                '表示形式に変換(入院患者数対看護要員数)
                Call Calc_Format(w_Youin, 2, w_str)
                lblKangoYouin.Text = w_str

                '表示形式に変換(月平均夜勤時間数)
                Call Calc_Format(w_AveNightTime, 3, w_str)

                If Double.Parse(w_str) <= m_AveNightTime Then
                    lblAveTime.BackColor = SystemColors.Control
                Else
                    lblAveTime.BackColor = Color.Red
                End If

                lblAveTime.Text = w_str
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_StaffData(ByVal p_Index As Integer)

        Const W_SUBNAME As String = "NSK0000HA Set_StaffData"

        Dim w_Row As Integer
        Dim w_Idx As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_Var As Object
        Dim w_Int As Integer
        Dim w_ColLoop As Integer
        Dim w_HyojiNo As Integer
        '2014/05/22 Y.Doi add start P-06982----------------------------------
        Dim nsValueSet As Integer
        '2014/05/22 Y.Doi add end P-06982------------------------------------

        '2014/05/22 Y.Doi  add start P-06982----------------------------------
        nsValueSet = General.paGetItemValue("NSKINMU", "KIBOUKINMU", "PERSONALFLG", "0", General.g_strHospitalCD)
        If nsValueSet <> 0 AndAlso nsValueSet <> 1 Then
            nsValueSet = 0
        End If
        '2014/05/22 Y.Doi  add end P-06982------------------------------------

        Try
            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '選択されたｺﾝﾎﾞﾎﾞｯｸｽの期間によって勤務開始列を設定
            If p_Index = 0 Then
                w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                w_EndCol = m_KeikakuKikan.KinmuDataEndCol
            Else
                w_StartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                w_EndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
            End If

            '初期化
            w_HyojiNo = 0

            '職員数分ﾙｰﾌﾟ
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                    '１ヶ月用ｽﾌﾟﾚｯﾄﾞ
                    If p_Index = 0 Then
                        With sprSheet_M.Sheets(0)
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var <> "" Then
                                w_Idx = Integer.Parse(w_Var)
                            End If

                            '初期化
                            w_HaizokuFlg = False
                            For w_ColLoop = w_StartCol To w_EndCol

                                '年月日を取得し、実績・配属？ﾁｪｯｸを行う
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                If w_Var <> "" Then
                                    If IsNumeric(w_Var) = True Then
                                        For w_Int = 1 To UBound(m_StaffData(w_Idx).IdoData)
                                            If m_StaffData(w_Idx).IdoData(w_Int).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Idx).IdoData(w_Int).SyuryoYMD Then
                                                '期間内に配属していた場合
                                                w_HaizokuFlg = True
                                                Exit For
                                            End If
                                        Next w_Int
                                    End If
                                End If

                                If w_HaizokuFlg = True Then
                                    '期間内に１日でも配属していた場合
                                    Exit For
                                End If
                            Next w_ColLoop

                            '期間内に１日も配属していない場合
                            If w_HaizokuFlg = False Then
                                For w_Int = 1 To m_MaxShowLine
                                    .SetRowHeight(w_Row + w_Int - 1, 0)
                                    sprPTotal.Sheets(0).SetRowHeight(w_Row + w_Int - 1, 0)
                                Next
                            Else
                                '配属している場合は表示No用変数をｶｳﾝﾄｱｯﾌﾟ
                                w_HyojiNo = w_HyojiNo + 1
                            End If

                            '表示No. 設定
                            w_Var = Convert.ToString(w_HyojiNo)
                            .SetText(w_Row, M_HyojiNo_Col, w_Var)

                            '2014/05/22 Y.Doi add start P-06982----------------------------------
                            If g_HopeMode = 1 And nsValueSet <> 0 And m_StaffData(w_Idx).ID <> General.g_strUserMngID And General.g_strUserMngID <> "" Then
                                For w_Int = 1 To m_MaxShowLine
                                    .SetRowHeight(w_Row + w_Int - 1, 0)
                                Next
                            End If
                            '2014/05/22 Y.Doi add end P-06982----------------------------------
                        End With
                    Else
                        '４週用ｽﾌﾟﾚｯﾄﾞ
                        With sprSheet_4W.Sheets(0)
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var <> "" Then
                                w_Idx = Integer.Parse(w_Var)
                            End If

                            '初期化
                            w_HaizokuFlg = False
                            For w_ColLoop = w_StartCol To w_EndCol
                                '年月日を取得し、実績・配属？ﾁｪｯｸを行う
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                If w_Var <> "" Then
                                    If IsNumeric(w_Var) = True Then
                                        For w_Int = 1 To UBound(m_StaffData(w_Idx).IdoData)
                                            If m_StaffData(w_Idx).IdoData(w_Int).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Idx).IdoData(w_Int).SyuryoYMD Then
                                                '期間内に配属していた場合
                                                w_HaizokuFlg = True
                                                Exit For
                                            End If
                                        Next w_Int
                                    End If
                                End If

                                If w_HaizokuFlg = True Then
                                    '期間内に１日でも配属していた場合
                                    Exit For
                                End If
                            Next w_ColLoop

                            '期間内に１日も配属していない場合
                            If w_HaizokuFlg = False Then
                                For w_Int = 1 To m_MaxShowLine
                                    .SetRowHeight(w_Row + w_Int - 1, 0)
                                    sprPTotal.Sheets(0).SetRowHeight(w_Row + w_Int - 1, 0)
                                Next
                            Else
                                '配属している場合は表示No用変数をｶｳﾝﾄｱｯﾌﾟ
                                w_HyojiNo = w_HyojiNo + 1
                            End If

                            '表示No. 設定
                            w_Var = Convert.ToString(w_HyojiNo)
                            .SetText(w_Row, M_HyojiNo_Col, w_Var)

                            '2014/05/22 Y.Doi add start P-06982----------------------------------
                            If g_HopeMode = 1 And nsValueSet <> 0 And m_StaffData(w_Idx).ID <> General.g_strUserMngID And General.g_strUserMngID <> "" Then
                                For w_Int = 1 To m_MaxShowLine
                                    .SetRowHeight(w_Row + w_Int - 1, 0)
                                Next
                            End If
                            '2014/05/22 Y.Doi add end P-06982----------------------------------
                        End With
                    End If
                End If
            Next w_Row

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub WindowPosition(ByVal pMode As BasNSK0000H.geWindowPosition)
        Const W_SUBNAME As String = "NSK0000HA WindowPosition"

        Const w_Left As String = "Left"
        Const w_Top As String = "Top"
        Const w_Width As String = "Width"
        Const w_Height As String = "Height"
        Const w_WindowState As String = "WindowState"
        Const W_LeftMarge As String = "16"
        Const W_TopMarge As String = "48"

        Dim w_RegStr As String
        Dim w_LeftValue As Single
        Dim w_TopValue As Single
        Dim w_WidthValue As Single
        Dim w_HeightValue As Single
        Dim w_WindowStateValue As FormWindowState
        Dim w_RegKey As String
        Try
            w_RegKey = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2 & "\" & g_AppName

            If pMode = BasNSK0000H.geWindowPosition.GetSettingValue Then
                'ｳｨﾝﾄﾞｳ位置設定

                'Left
                w_RegStr = General.paGetSetting(w_RegKey, Me.Tag, w_Left, W_LeftMarge)
                If IsNumeric(w_RegStr) = False Then
                    w_RegStr = W_LeftMarge
                End If
                w_LeftValue = Single.Parse(w_RegStr)
                If w_LeftValue < 0 Then
                    w_LeftValue = 0
                ElseIf w_LeftValue > Screen.PrimaryScreen.Bounds.Width Then
                    w_LeftValue = Single.Parse(W_LeftMarge)
                End If

                'Top
                w_RegStr = General.paGetSetting(w_RegKey, Me.Tag, w_Top, W_TopMarge)
                If IsNumeric(w_RegStr) = False Then
                    w_RegStr = W_TopMarge
                End If
                w_TopValue = Single.Parse(w_RegStr)
                If w_TopValue < 0 Then
                    w_TopValue = 0
                ElseIf w_TopValue > Screen.PrimaryScreen.Bounds.Height Then
                    w_TopValue = Single.Parse(W_TopMarge)
                End If

                '2014/06/26 Shimizu upd start P-06979--------------------------------------
                'Width
                'w_RegStr = General.paGetSetting(w_RegKey, Me.Tag, w_Width, "")
                'If IsNumeric(w_RegStr) = False Then
                '    w_WidthValue = Screen.PrimaryScreen.Bounds.Width - (w_LeftValue * 2)
                'Else
                '    w_WidthValue = Single.Parse(w_RegStr)
                'End If
                'If w_WidthValue > Screen.PrimaryScreen.Bounds.Width Then
                '    w_WidthValue = Screen.PrimaryScreen.Bounds.Width
                'ElseIf w_WidthValue <= 0 Then
                '    w_WidthValue = Screen.PrimaryScreen.Bounds.Width - (Single.Parse(W_LeftMarge) * 2)
                '    If w_WidthValue <= 0 Then
                '        w_WidthValue = Screen.PrimaryScreen.Bounds.Width
                '    End If
                'End If

                Dim w_Loop As Single
                Dim w_VisibleSpr As FpSpread
                Dim w_totalWide As Single
                Dim w_sumTotalWide As Single
                Dim w_empColWidht As Single
                Dim w_panelWidth As Single

                w_VisibleSpr = sprSheet_M

                If m_lstmnuView(M_MenuEmpRowDisp).Checked Then
                    w_empColWidht = w_VisibleSpr.Sheets(0).Columns(M_EmpShrtNghtData_Col).Width
                Else
                    w_empColWidht = 0
                End If

                '固定列幅足し合わせ
                w_totalWide = w_VisibleSpr.Sheets(0).GetColumnWidth(M_HyojiNo_Col) + w_VisibleSpr.Sheets(0).GetColumnWidth(M_StaffName_Col) + w_empColWidht

                'カレンダーシートのサイズを取得

                For w_Loop = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    If w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > 0 Then
                        w_totalWide = w_totalWide + w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop)
                    End If
                Next w_Loop

                '集計行サイズ計算
                w_sumTotalWide = 0
                For w_Loop = 0 To m_lngColFrozen - 1
                    w_sumTotalWide = w_sumTotalWide + sprPTotal.Sheets(0).GetColumnWidth(w_Loop)
                Next w_Loop

                w_totalWide = w_totalWide + w_sumTotalWide

                'スクロールバー及び余白の足し合わせ
                w_totalWide = w_totalWide + sprPTotal.VerticalScrollBarWidth + (Single.Parse(W_LeftMarge) * 2)
                'コンボボックスの端が切れないように
                If Panel1.Visible = True Then
                    'ﾂｰﾙﾊﾞｰが表示の場合
                    w_panelWidth = Panel1.Width + Panel1.Left + Single.Parse(W_LeftMarge)

                    If w_panelWidth > w_totalWide Then
                        w_totalWide = w_panelWidth
                    End If
                End If


                '画面に収まるように
                If w_totalWide > Screen.PrimaryScreen.Bounds.Width Then
                    w_WidthValue = Screen.PrimaryScreen.Bounds.Width
                Else
                    w_WidthValue = w_totalWide
                End If

                'スクリーン左右中央に配置されるように設定
                If Screen.PrimaryScreen.Bounds.Width > w_WidthValue Then
                    w_LeftValue = (Screen.PrimaryScreen.Bounds.Width - w_WidthValue) / 2
                Else
                    w_LeftValue = 0
                End If
                '2014/2014/06/26 Shimizu upd end P-06979----------------------------------------

                'Height
                w_RegStr = General.paGetSetting(w_RegKey, Me.Tag, w_Height, "")
                If IsNumeric(w_RegStr) = False Then
                    w_HeightValue = Screen.PrimaryScreen.Bounds.Height - (w_TopValue * 2)
                Else
                    w_HeightValue = Single.Parse(w_RegStr)
                End If
                If w_HeightValue > Screen.PrimaryScreen.Bounds.Height Then
                    w_HeightValue = Screen.PrimaryScreen.Bounds.Height
                ElseIf w_HeightValue <= 0 Then
                    w_HeightValue = Screen.PrimaryScreen.Bounds.Height - (Single.Parse(W_TopMarge) * 2)
                    If w_HeightValue <= 0 Then
                        w_HeightValue = Screen.PrimaryScreen.Bounds.Height
                    End If
                End If

                'WindowState
                w_RegStr = General.paGetSetting(w_RegKey, Me.Tag, w_WindowState, Convert.ToString(vbNormal))
                If IsNumeric(w_RegStr) = False Then
                    w_WindowStateValue = vbNormal
                Else
                    Select Case Integer.Parse(w_RegStr)
                        Case vbNormal, FormWindowState.Minimized, FormWindowState.Maximized
                            w_WindowStateValue = Integer.Parse(w_RegStr)
                        Case Else
                            w_WindowStateValue = vbNormal
                    End Select
                End If

                If w_WindowStateValue = FormWindowState.Maximized Then
                    '最大化されている場合
                    Me.SetBounds(w_LeftValue, w_TopValue, w_WidthValue, w_HeightValue)
                    Me.WindowState = FormWindowState.Maximized
                Else
                    '最大化以外の場合
                    Me.SetBounds(w_LeftValue, w_TopValue, w_WidthValue, w_HeightValue)
                    Me.WindowState = FormWindowState.Normal
                End If

            Else
                'ｳｨﾝﾄﾞｳ位置保存

                'WindowStateを取得する
                w_WindowStateValue = Me.WindowState

                If w_WindowStateValue = vbNormal Then
                    '通常の大きさのときのみ位置大きさ取得

                    'Left
                    w_LeftValue = Me.Left
                    Call General.paSaveSetting(w_RegKey, Me.Tag, w_Left, Convert.ToString(w_LeftValue))
                    'Top
                    w_TopValue = Me.Top
                    Call General.paSaveSetting(w_RegKey, Me.Tag, w_Top, Convert.ToString(w_TopValue))
                    'Width
                    w_WidthValue = Me.Width
                    Call General.paSaveSetting(w_RegKey, Me.Tag, w_Width, Convert.ToString(w_WidthValue))
                    'Height
                    w_HeightValue = Me.Height
                    Call General.paSaveSetting(w_RegKey, Me.Tag, w_Height, Convert.ToString(w_HeightValue))
                    'WindowState
                    Call General.paSaveSetting(w_RegKey, Me.Tag, w_WindowState, Convert.ToString(vbNormal))
                Else
                    '最大化、最小化（通常以外）のときはWindowStateのみ保存
                    If w_WindowStateValue = FormWindowState.Maximized Then
                        '最大化の場合
                        Call General.paSaveSetting(w_RegKey, Me.Tag, w_WindowState, Convert.ToString(FormWindowState.Maximized))
                    Else
                        '最小化の場合は通常の大きさとして保存する
                        Call General.paSaveSetting(w_RegKey, Me.Tag, w_WindowState, Convert.ToString(vbNormal))
                    End If
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub WriteReg_AppState()

        Const W_SUBNAME As String = "NSK0000HA WriteReg_AppState"

        Dim w_Bool As Boolean
        Dim w_Index As Integer
        Try
            'ﾂｰﾙﾊﾞｰの状態を設定
            w_Bool = tbrMain.Visible
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ToolBar", Convert.ToString(fncGetNum(w_Bool)))

            'ｽﾃｰﾀｽﾊﾞｰの状態を設定
            w_Bool = sbrMain.Visible
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "StatusBar", Convert.ToString(fncGetNum(w_Bool)))

            '勤務表示切替の状態を設定
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PackageFLG <> 0 Then
                '勤務変更 又は (計画新規 or 計画変更で届出か日当直を使用してる) 画面の時
                For w_Index = 0 To 3
                    If m_lstmnuKinmuView(w_Index).Available Then
                        If m_lstmnuKinmuView(w_Index).Checked Then
                            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "PlanTwo", Convert.ToString(w_Index))
                        End If
                    End If
                Next w_Index
            End If

            'ﾌｫﾝﾄの大きさ
            If m_lstmnuFont(M_MenuFontBig).Checked = True Then
                w_Index = M_MenuFontBig
            ElseIf m_lstmnuFont(M_MenuFontSmall).Checked = True Then
                w_Index = M_MenuFontSmall
            Else
                w_Index = M_MenuFontMiddle
            End If
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "FontSize", Convert.ToString(w_Index))

            'ｴﾗｰ自動ﾁｪｯｸの有無
            If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ErrChk", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ErrChk", Convert.ToString(fncGetNum(False)))
            End If
            'ﾁｪｯｸ項目の保存
            If m_lstmnuCheck(M_MenuNinzuu).Checked = True Then '必要人数
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem0", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem0", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuGiryoCheck).Checked = True Then '経験区分の組み合わせチェック
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem1", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem1", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuKinmuCount).Checked = True Then '勤務回数ﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem2", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem2", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuKinmuInterval).Checked = True Then '勤務間隔ﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem3", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem3", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuHolCount).Checked = True Then '休み回数ﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem4", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem4", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuHolInterval).Checked = True Then '休み間隔ﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem5", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem5", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuKinmuPattern).Checked = True Then '禁止勤務ﾊﾟﾀｰﾝﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem6", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem6", Convert.ToString(fncGetNum(False)))
            End If
            If m_lstmnuCheck(M_MenuKinsiKinmu).Checked = True Then '禁止勤務ﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem7", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem7", Convert.ToString(fncGetNum(False)))
            End If

            '希望勤務の入力警告
            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "KibouChk", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "KibouChk", Convert.ToString(fncGetNum(False)))
            End If

            '要請勤務の入力警告
            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "YouseiChk", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "YouseiChk", Convert.ToString(fncGetNum(False)))
            End If

            '必須勤務の警告
            If m_lstmnuTool(M_MenuErrorAbsoluteKinmu).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmuChk", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmuChk", Convert.ToString(fncGetNum(False)))
            End If

            '勤務連続チェック
            If m_lstmnuCheck(M_MenuRenzokuKinmuInterval).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "RenzokuKinmuInterval", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "RenzokuKinmuInterval", Convert.ToString(fncGetNum(False)))
            End If

            '必須勤務チェック
            If m_lstmnuCheck(M_MenuAbsoluteKinmu).Checked = True Then
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmu", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "AbsoluteKinmu", Convert.ToString(fncGetNum(False)))
            End If

            If m_lstmnuCheck(M_MenuStaffPattern).Checked = True Then '禁止職員ﾊﾟﾀｰﾝﾁｪｯｸ
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem8", Convert.ToString(fncGetNum(True)))
            Else
                Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "ChkItem8", Convert.ToString(fncGetNum(False)))
            End If

            '行事予定の表示
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "DispEventRowFlg", Convert.ToString(fncGetNum(m_GyoujiFlg)))

            '採用条件列表示
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY2, g_AppName, "DispEmpColFlg", Convert.ToString(fncGetNum(m_lstmnuView(M_MenuEmpRowDisp).Checked)))

            '画面の大きさを保存する
            Call WindowPosition(BasNSK0000H.geWindowPosition.SaveSettingValue)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub cmbKikan_SelectedIndexChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles cmbKikan.SelectedIndexChanged

        Const W_SUBNAME As String = "NSK0000HA  _Click"

        Dim w_Index As Integer
        Dim w_ViewKikan As Integer
        Dim w_TotalLeft As Integer
        Dim w_Int As Integer
        Try
            '選択リスト取得
            w_Index = cmbKikan.SelectedIndex
            If w_Index = -1 Then
                Exit Sub
            End If

            '選択期間取得（0：1ヶ月、1～：4週期間）
            w_ViewKikan = GetItemData(cmbKikan, w_Index)
            If m_SelViewKikan = w_ViewKikan Then
                If m_YakanKangoDispFlg = 0 Then
                    Call Set_KangoKasanTotalData()
                End If

                Exit Sub
            End If

            ReDim m_YakinData(UBound(m_StaffData))

            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            Me.Refresh()

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '個人集計エリア
            Call SetBorder(sprPTotal, M_First_Row, M_First_Col, m_StaffRow.EndRow, m_KeikakuKikan.KinmuDataEndCol, 1, 1, 1, 1, 0, Color.Black)

            '日次集計エリア
            Call SetBorder(sprDayTotal_M, M_First_Row, M_First_Col, m_StaffRow.EndRow, m_BackColorPointerCol_M, 0, 0, 0, 1, 0, Color.Black)

            '4W集計エリア
            With sprDayTotal_4W.Sheets(0)
                Call SetBorder(sprDayTotal_4W, M_First_Row, M_First_Col, m_StaffRow.EndRow, m_BackColorPointerCol_4W, 0, 0, 0, 1, 0, Color.Black)

                For w_Int = 1 To UBound(m_4WeekKikan)
                    Call SetBorder(sprDayTotal_4W, 0, m_4WeekKikan(w_Int).KinmuDataStartCol, .RowCount - 1, m_4WeekKikan(w_Int).KinmuDataEndCol, 0, 0, 0, 0, 2, Color.Black)
                Next w_Int
            End With

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '４週／１ヶ月の場合のみ設定

                m_SelViewKikan = w_ViewKikan

                picBase.Visible = False

                'ｽﾌﾟﾚｯﾄﾞの表示非表示を設定する
                If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                    '１ヶ月表示の場合
                    sprSheet_4W.Visible = False
                    sprDayTotal_4W.Visible = False
                    sprSheet_M.Visible = True
                    sprDayTotal_M.Visible = True
                    'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
                    m_MaxMainWidth = m_CtrlSize(m_FontIndex).NormalModeMaxWidth
                    m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).NormalModePersonalTotalWidth
                    '固定個人別集計の左端列
                    w_TotalLeft = m_KeikakuKikan.KoteiStartCol

                    If General.g_lngDaikyuMng = 0 Then
                        'ﾃｷｽﾄ書き込み使用不可
                        m_lstmnuFile(M_MenuWrite).Enabled = False
                        'ﾃｷｽﾄ読み込み使用不可
                        m_lstmnuFile(M_MenuLoad).Enabled = False
                    Else
                        'ﾃｷｽﾄ書き込み使用可
                        m_lstmnuFile(M_MenuWrite).Enabled = True
                        'ﾃｷｽﾄ読み込み使用可
                        m_lstmnuFile(M_MenuLoad).Enabled = True
                    End If
                    If Not m_UseOutputFlg Then
                        m_lstmnuFile(M_MenuFile_Line1).Available = False
                        m_lstmnuFile(M_MenuWrite).Available = False
                        m_lstmnuFile(M_MenuLoad).Available = False
                    End If
                Else
                    '４週表示
                    sprSheet_M.Visible = False
                    sprDayTotal_M.Visible = False
                    sprSheet_4W.Visible = True
                    sprDayTotal_4W.Visible = True
                    'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
                    m_MaxMainWidth = m_CtrlSize(m_FontIndex).WeekModeMaxWidth
                    m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).WeekModePersonalTotalWidth
                    '固定個人別集計の左端列
                    w_TotalLeft = m_4WeekKikan(m_SelViewKikan).KoteiStartCol

                    'ﾃｷｽﾄ書き込み使用不可
                    m_lstmnuFile(M_MenuWrite).Enabled = False
                    'ﾃｷｽﾄ読み込み使用不可
                    m_lstmnuFile(M_MenuLoad).Enabled = False
                End If

                'ｾﾙの大きさを一旦明細部の大きさにあわせる
                sprSheet_M.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprSheet_M.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprSheet_4W.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprSheet_4W.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprPTotal.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprPTotal.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprDayTotal_M.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprDayTotal_M.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprDayTotal_4W.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprDayTotal_4W.Sheets(0).SetRowHeight(-1, m_CellHeight)

                'ｽﾌﾟﾚｯﾄﾞのセルを設定する
                Call Set_CellSize()

                '固定個人別集計の左端列（LeftCol）設定
                sprPTotal.SetViewportLeftColumn(0, w_TotalLeft)

                Call RunFontSizeChange()

                picBase.Visible = True

                '選択セルとスクロール位置設定
                Call Set_KeikakuFirstCell()

                '実績部分の背景色変更
                Call Set_JissekiCellColor()

                '個人集計 取得/設定
                For w_Index = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        Call RunReCalc_PUser(w_Index)
                        Call RunReCalc_User_4W(w_Index)
                    End If
                Next w_Index

                '実績期間の個人集計を設定
                For w_Index = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        Call RunReCalc_PUser_Jisseki(w_Index)
                    End If
                Next w_Index

                'UndoDataｸﾘｱ
                Call UndoData_Clear()
                'CopyDataｸﾘｱ
                Call CopyData_Clear()
            End If

            Call Calc_ScrollSpread()

            sprScroll.SetViewportLeftColumn(0, 0)
            sprScroll.SetViewportTopRow(0, 0)

            Call subSetCrossPointLength()

            picCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｽﾌﾟﾚｯﾄﾞの再設定に使用
    Private Sub Set_SpreadAdd()

        Const W_SUBNAME As String = "NSK0000HA  Set_SpreadAdd"

        Dim w_TotalLeft As Integer
        Dim w_Int As Integer
        Dim w_Col As Integer
        Dim w_StartCol As Integer
        Dim w_CBS_B As ComplexBorderSide
        Dim w_CBS_L As ComplexBorderSide
        Dim w_CBS_R As ComplexBorderSide
        Dim w_CBS_T As ComplexBorderSide
        Dim w_CB As ComplexBorder
        Try
            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '個人集計エリア
            With sprPTotal.Sheets(0)
                w_CBS_B = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_L = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_R = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_T = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CB = New ComplexBorder(w_CBS_L, w_CBS_T, w_CBS_R, w_CBS_B)
                .Cells(M_First_Row, M_First_Col, m_StaffRow.EndRow, m_StaffZokusei(M_HairetuNo).SetCol_PTotal).Border = w_CB
            End With

            '日次集計エリア
            With sprDayTotal_M.Sheets(0)
                w_CBS_B = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_L = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_R = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_T = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CB = New ComplexBorder(w_CBS_L, w_CBS_T, w_CBS_R, w_CBS_B)
                .Cells(M_First_Row, M_First_Col, m_DayDataRow(0).KoteiEndRow, m_BackColorPointerCol_M).Border = w_CB
            End With

            '4W集計エリア
            With sprDayTotal_4W.Sheets(0)
                w_CBS_B = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_L = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_R = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CBS_T = New ComplexBorderSide(ComplexBorderSideStyle.None)
                w_CB = New ComplexBorder(w_CBS_L, w_CBS_T, w_CBS_R, w_CBS_B)
                .Cells(M_First_Row, M_First_Col, m_DayDataRow(0).KoteiEndRow, m_BackColorPointerCol_4W).Border = w_CB

                For w_Int = 1 To UBound(m_4WeekKikan)
                    w_CBS_B = New ComplexBorderSide(ComplexBorderSideStyle.ThinLine, Color.Black)
                    w_CBS_L = New ComplexBorderSide(ComplexBorderSideStyle.ThinLine, Color.Black)
                    w_CBS_R = New ComplexBorderSide(ComplexBorderSideStyle.ThinLine, Color.Black)
                    w_CBS_T = New ComplexBorderSide(ComplexBorderSideStyle.ThinLine, Color.Black)
                    w_CB = New ComplexBorder(w_CBS_L, w_CBS_T, w_CBS_R, w_CBS_B)
                    .Cells(0, m_4WeekKikan(w_Int).KinmuDataStartCol, m_DayDataRow(0).KoteiEndRow, m_4WeekKikan(w_Int).KinmuDataEndCol).Border = w_CB
                Next w_Int
            End With

            sprDayTotal_M.Sheets(0).SetActiveCell(M_First_Row, M_First_Col)
            sprDayTotal_4W.Sheets(0).SetActiveCell(M_First_Row, M_First_Col)

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '４週／１ヶ月の場合のみ設定

                picBase.Visible = False

                'ｽﾌﾟﾚｯﾄﾞの表示非表示を設定する
                If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                    '１ヶ月表示の場合
                    sprSheet_4W.Visible = False
                    sprDayTotal_4W.Visible = False
                    sprSheet_M.Visible = True
                    sprDayTotal_M.Visible = True
                    'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
                    m_MaxMainWidth = m_CtrlSize(m_FontIndex).NormalModeMaxWidth
                    m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).NormalModePersonalTotalWidth

                    '固定個人別集計の左端列
                    w_TotalLeft = m_KeikakuKikan.KoteiStartCol

                    If General.g_lngDaikyuMng = 0 Then
                        'ﾃｷｽﾄ書き込み使用不可
                        m_lstmnuFile(M_MenuWrite).Enabled = False
                        'ﾃｷｽﾄ読み込み使用不可
                        m_lstmnuFile(M_MenuLoad).Enabled = False
                    Else
                        'ﾃｷｽﾄ書き込み使用可
                        m_lstmnuFile(M_MenuWrite).Enabled = True
                        'ﾃｷｽﾄ読み込み使用可
                        m_lstmnuFile(M_MenuLoad).Enabled = True
                    End If
                    If Not m_UseOutputFlg Then
                        m_lstmnuFile(M_MenuFile_Line1).Available = False
                        m_lstmnuFile(M_MenuWrite).Available = False
                        m_lstmnuFile(M_MenuLoad).Available = False
                    End If
                Else
                    '４週表示
                    sprSheet_M.Visible = False
                    sprDayTotal_M.Visible = False
                    sprSheet_4W.Visible = True
                    sprDayTotal_4W.Visible = True
                    'ｽﾌﾟﾚｯﾄﾞの最大幅、最大高さ、固定集計行の最大幅、最大高さ設定
                    m_MaxMainWidth = m_CtrlSize(m_FontIndex).WeekModeMaxWidth
                    m_PersonalTotalWidth = m_CtrlSize(m_FontIndex).WeekModePersonalTotalWidth

                    '固定個人別集計の左端列
                    w_TotalLeft = m_4WeekKikan(m_SelViewKikan).KoteiStartCol

                    'ﾃｷｽﾄ書き込み使用不可
                    m_lstmnuFile(M_MenuWrite).Enabled = False
                    'ﾃｷｽﾄ読み込み使用不可
                    m_lstmnuFile(M_MenuLoad).Enabled = False
                End If

                'ｾﾙの大きさを一旦明細部の大きさにあわせる
                sprSheet_M.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprSheet_M.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprSheet_4W.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprSheet_4W.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprPTotal.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprPTotal.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprDayTotal_M.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprDayTotal_M.Sheets(0).SetRowHeight(-1, m_CellHeight)
                sprDayTotal_4W.Sheets(0).SetColumnWidth(-1, m_CellWidth)
                sprDayTotal_4W.Sheets(0).SetRowHeight(-1, m_CellHeight)

                'ｽﾌﾟﾚｯﾄﾞのセルを設定する
                Call Set_CellSize()

                '固定個人別集計の左端列（LeftCol）設定
                sprPTotal.SetViewportLeftColumn(0, w_TotalLeft)

                Call RunFontSizeChange()

                picBase.Visible = True

                '選択セルとスクロール位置設定
                Call Set_KeikakuFirstCell()

                '実績部分の背景色変更
                Call Set_JissekiCellColor()

                '夜間看護加算の表示
                If m_YakanKangoDispFlg = 0 Then
                    Call Set_KangoKasanTotalData()
                End If

                '日別ﾁｰﾑ別集計処理
                For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    '計画期間の日別集計
                    Call RunReCalc_PDay(w_Col)
                Next w_Col

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                        For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                            '計画期間の最後の4週部分の日別集計
                            Call RunReCalc_PDay_4W(w_Col)
                        Next w_Col
                    End If
                End If

                'UndoDataｸﾘｱ
                Call UndoData_Clear()
                'CopyDataｸﾘｱ
                Call CopyData_Clear()
            Else
                '夜間看護加算の表示
                If m_YakanKangoDispFlg = 0 Then
                    Call Set_KangoKasanTotalData()
                End If
            End If

            picCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '背景色を元に戻す
    Private Sub BackColorPoint_Undo_M()
        Const W_SUBNAME As String = "NSK0000HA BackColorPoint_Undo_M"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_HaizokuFlg As Boolean
        Dim w_Index As Integer
        Dim w_Int As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_CurrentDate As Integer
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_StaffIdx As Integer
        Dim w_DaikyuBackColorFlg As Boolean
        Dim w_BackColor As Color
        Dim w_Comment As String = String.Empty

        Try
            '********************************************************************************************
            '   ﾏｳｽﾎﾟｲﾝﾀｰの背景色設定
            '********************************************************************************************
            '縦の背景色設定
            With sprSheet_M.Sheets(0)
                '--------------------
                '背景色を元に戻す
                '--------------------
                'ﾀｲﾄﾙ部分の背景色を元に戻す
                .Cells(M_DayLabel_Row, m_BackColorPointerCol_M, M_YYYYMMDDLabel_Row, m_BackColorPointerCol_M).BackColor = SystemColors.Control

                '明細の背景色を元に戻す
                If M_KinmuDataStart_Row <= m_BackColorPointerRow_M Then
                    .Cells(M_KinmuDataStart_Row, m_BackColorPointerCol_M, m_BackColorPointerRow_M, m_BackColorPointerCol_M).BackColor = Color.White
                End If

                For w_RowLoop = m_StaffRow.StartRow To m_BackColorPointerRow_M
                    If ((w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '部署異動ﾁｪｯｸ（配属期間内）
                        w_Var = .GetText(w_RowLoop, m_BackColorPointerCol_M)
                        If w_Var <> "" Then
                            '2015/04/10 Bando Upd Start ================================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                            '2015/04/10 Bando Upd End   ================================

                            '理由区分による色設定(文字色/背景色)
                            If w_RiyuKBN = "1" Then
                                '通常
                                w_BackColor = Color.White
                            ElseIf w_RiyuKBN = "2" Then
                                '要請勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                            ElseIf w_RiyuKBN = "3" Then
                                '希望勤務 文字/背景色
                                '2015/07/21 Bando Upd Start ==================
                                If w_Comment = "" Then
                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                Else
                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                End If
                                '2015/07/21 Bando Upd End   ==================
                            ElseIf w_RiyuKBN = "4" Then
                                '再掲勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                            ElseIf w_RiyuKBN = "5" Then
                                '委員会勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                            ElseIf w_RiyuKBN = "6" Then
                                '応援勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            End If
                            '代休発生勤務 文字/背景色
                            w_DaikyuBackColorFlg = False
                            If General.g_lngDaikyuMng = 0 Then
                                w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_M)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            w_DaikyuBackColorFlg = True
                                        End If
                                    End If
                                End If
                            End If

                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_M)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================

                            If w_Time <> "" Then
                                '時間年休入力の場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            End If

                            If m_KeikakuKikan.KinmuDataEndCol < m_BackColorPointerCol_M Then
                                '計画期間外の4週部分 背景色？
                                w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var <> "" Then
                                    w_Index = Integer.Parse(w_Var)
                                End If
                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = m_BackColorPointerCol_M - w_KeikakuCol + 1
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_M)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                End If
                                If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                    '計画期間外
                                    w_BackColor = ColorTranslator.FromOle(m_Jisseki4W_Back)
                                End If
                            End If

                            .Cells(w_RowLoop, m_BackColorPointerCol_M).BackColor = w_BackColor
                        End If
                    End If
                Next w_RowLoop

                If m_KeikakuKikan.KinmuDataStartCol <= m_BackColorPointerCol_M AndAlso m_BackColorPointerCol_M <= m_KeikakuKikan.KinmuDataEndCol Then
                    '計画期間内の場合
                    For w_RowLoop = m_StaffRow.StartRow To m_BackColorPointerRow_M
                        '--- 転出日,配属日の取得 ---
                        'ﾃﾞｰﾀ格納配列番号 取得
                        w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)
                        If w_Var <> "" Then
                            w_Index = Integer.Parse(w_Var)
                        End If

                        '配属期間外表示色設定
                        w_HaizokuFlg = False
                        '配属期間外表示色設定
                        w_Var = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_M)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then
                                For w_Int = 1 To UBound(m_StaffData(w_Index).IdoData)
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        '期間内に配属していた場合
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If
                        End If

                        '応援勤務者は配属期間外とする
                        If m_StaffData(w_Index).OuenStaffFlg = 1 Then
                            w_HaizokuFlg = False
                        End If

                        If w_HaizokuFlg = True Then
                            '配属期間内のとき
                        Else
                            '配属期間外の時
                            .Cells(w_RowLoop, m_BackColorPointerCol_M).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                        End If
                    Next w_RowLoop
                Else
                    '実績期間内、個人別集計内の場合
                    If M_DayLabel_Row <= m_BackColorPointerRow_M Then
                        .Cells(M_DayLabel_Row, m_BackColorPointerCol_M, m_BackColorPointerRow_M, m_BackColorPointerCol_M).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    End If
                End If
            End With

            With sprSheet_M.Sheets(0)
                '--------------------
                '背景色を元に戻す
                '--------------------
                'ﾃﾞｰﾀ格納配列番号 取得
                w_Var = .GetText(m_BackColorPointerRow_M, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    w_Index = Integer.Parse(w_Var)
                End If

                '-- 氏名 色設定 -------------
                '自動割当対象区分 ?
                If m_StaffData(w_Index).AutoKBN = "1" Then
                    'SkillBunruiCD ?
                    If m_StaffData(w_Index).GiryoBunruiCD = "1" Then
                        'ﾘｰﾀﾞｰ
                        w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "2" Then
                        'ｻﾌﾞﾘｰﾀﾞｰ
                        w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "3" Then
                        'ｽﾀｯﾌ
                        w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "4" Then
                        '新人
                        w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                    Else
                        'ERROR
                        '自動割当対象外 に設定
                        w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                    End If
                ElseIf m_StaffData(w_Index).OuenStaffFlg = 1 Then
                    '何もしない
                Else
                    '非対象の場合
                    w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                End If

                If m_BackColorPointerRow_M <> 0 Then
                    .Cells(m_BackColorPointerRow_M, M_StaffName_Col).BackColor = w_BackColor
                End If

                '明細の背景色を元に戻す
                If M_KinmuDataStart_Col <= m_BackColorPointerCol_M Then
                    .Cells(m_BackColorPointerRow_M, M_KinmuDataStart_Col, m_BackColorPointerRow_M, m_BackColorPointerCol_M).BackColor = Color.White
                End If

                If m_KeikakuKikan.KinmuDataStartCol <= m_BackColorPointerCol_M AndAlso m_BackColorPointerCol_M <= m_KeikakuKikan.KinmuDataEndCol Then
                    If ((m_BackColorPointerRow_M - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((m_BackColorPointerRow_M - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        For w_ColLoop = m_KeikakuKikan.KinmuDataStartCol To m_BackColorPointerCol_M
                            '部署異動ﾁｪｯｸ（配属期間内）
                            w_Var = .GetText(m_BackColorPointerRow_M, w_ColLoop)
                            If w_Var <> "" Then
                                '2015/04/10 Bando Upd Start ===========================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd End   ===========================

                                '理由区分による色設定(文字色/背景色)
                                If w_RiyuKBN = "1" Then
                                    '通常
                                    w_BackColor = Color.White
                                ElseIf w_RiyuKBN = "2" Then
                                    '要請勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                ElseIf w_RiyuKBN = "3" Then
                                    '希望勤務 文字/背景色
                                    '2015/07/21 Bando Upd Start ==================
                                    If w_Comment = "" Then
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Else
                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    End If
                                    '2015/07/21 Bando Upd End   ==================
                                ElseIf w_RiyuKBN = "4" Then
                                    '再掲勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                ElseIf w_RiyuKBN = "5" Then
                                    '委員会勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                ElseIf w_RiyuKBN = "6" Then
                                    '応援勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                End If
                                '代休発生勤務 文字/背景色
                                w_DaikyuBackColorFlg = False
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var = .GetText(m_BackColorPointerRow_M, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                w_DaikyuBackColorFlg = True
                                            End If
                                        End If
                                    End If
                                End If

                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var = .GetText(m_BackColorPointerRow_M, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================

                                If w_Time <> "" Then
                                    '時間年休入力の場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                End If

                                If m_KeikakuKikan.KinmuDataEndCol < w_ColLoop Then
                                    '計画期間外の4週部分 背景色？
                                    w_Var = .GetText(m_BackColorPointerRow_M, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        w_Index = Integer.Parse(w_Var)
                                    End If
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_ColLoop - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                    End If
                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        '計画期間外
                                        w_BackColor = ColorTranslator.FromOle(m_Jisseki4W_Back)
                                    End If
                                End If
                                .Cells(m_BackColorPointerRow_M, w_ColLoop).BackColor = w_BackColor
                            End If
                        Next w_ColLoop
                    End If

                    '--- 転出日,配属日の取得 ---
                    'ﾃﾞｰﾀ格納配列番号 取得
                    w_Var = .GetText(m_BackColorPointerRow_M, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        w_Index = Integer.Parse(w_Var)
                    End If

                    For w_ColLoop = m_KeikakuKikan.KinmuDataStartCol To m_BackColorPointerCol_M
                        w_HaizokuFlg = False
                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then
                                For w_Int = 1 To UBound(m_StaffData(w_Index).IdoData)
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        '期間内に配属していた場合
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If
                        End If

                        '応援勤務者は配属期間外とする
                        If m_StaffData(w_Index).OuenStaffFlg = 1 Then
                            w_HaizokuFlg = False
                        End If

                        If w_HaizokuFlg = True Then
                            '配属期間内のとき
                        Else
                            '配属期間外の時
                            .Cells(m_BackColorPointerRow_M, w_ColLoop).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                        End If
                    Next w_ColLoop

                    '実績の背景色を元に戻す
                    Call SubSetStyle(sprSheet_M, m_BackColorPointerRow_M, M_KinmuDataStart_Col, m_BackColorPointerRow_M, m_KeikakuKikan.KinmuDataStartCol - 1, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                Else
                    '実績の背景色を元に戻す
                    If M_KinmuDataStart_Col <= m_BackColorPointerCol_M Then
                        .Cells(m_BackColorPointerRow_M, M_KinmuDataStart_Col, m_BackColorPointerRow_M, m_BackColorPointerCol_M).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '背景色を元に戻す
    Private Sub BackColorPoint_Undo_4W()
        Const W_SUBNAME As String = "NSK0000HA BackColorPoint_Undo_4W"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_HaizokuFlg As Boolean
        Dim w_ShukeiFlg As Boolean
        Dim w_Index As Integer
        Dim w_Int As Integer
        Dim w_StartCol As Integer
        Dim w_PlanStartCol As Integer
        Dim w_PlanEndCol As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_CurrentDate As Integer
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_StartDate As Integer
        Dim w_StaffIdx As Integer
        Dim w_DaikyuBackColorFlg As Boolean
        Dim w_BackColor As Color
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            'ﾏｳｽﾎﾟｲﾝﾀｰの背景色設定
            If Get_Col_4W(m_KeikakuKikan.StartDate, w_PlanStartCol) = False Then
                w_PlanStartCol = 0
            End If
            If Get_Col_4W(m_KeikakuKikan.EndDate, w_PlanEndCol) = False Then
                w_PlanEndCol = 0
            End If

            With sprSheet_4W.Sheets(0)
                '--------------------
                '背景色を元に戻す
                '--------------------
                'ﾀｲﾄﾙ部分の背景色を元に戻す
                Call SubSetStyle(sprSheet_4W, M_DayLabel_Row, m_BackColorPointerCol_4W, M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W, 0, 0, , SystemColors.Control)
                .Cells(M_DayLabel_Row, m_BackColorPointerCol_4W, M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W).BackColor = SystemColors.Control

                '明細の背景色を元に戻す
                Call SubSetStyle(sprSheet_4W, M_KinmuDataStart_Row, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , Color.White)

                For w_RowLoop = m_StaffRow.StartRow To m_BackColorPointerRow_4W
                    If ((w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_RowLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '部署異動ﾁｪｯｸ（配属期間内）
                        w_Var = .GetText(w_RowLoop, m_BackColorPointerCol_4W)
                        If w_Var <> "" Then
                            '2015/04/10 Bando Upd Start =============================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                            '2015/04/10 Bando Upd End   =============================

                            '理由区分による色設定(文字色/背景色)
                            If w_RiyuKBN = "1" Then
                                '通常
                                w_BackColor = Color.White
                            ElseIf w_RiyuKBN = "2" Then
                                '要請勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                            ElseIf w_RiyuKBN = "3" Then
                                '希望勤務 文字/背景色
                                '2015/07/21 Bando Upd Start ==================
                                If w_Comment = "" Then
                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                Else
                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                End If
                                '2015/07/21 Bando Upd End   ==================
                            ElseIf w_RiyuKBN = "4" Then
                                '再掲勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                            ElseIf w_RiyuKBN = "5" Then
                                '委員会勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                            ElseIf w_RiyuKBN = "6" Then
                                '応援勤務 文字/背景色
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            End If
                            '代休発生勤務 文字/背景色
                            w_DaikyuBackColorFlg = False
                            If General.g_lngDaikyuMng = 0 Then
                                w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            w_DaikyuBackColorFlg = True
                                        End If
                                    End If
                                End If
                            End If

                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================

                            If w_Time <> "" Then
                                '時間年休入力の場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            End If

                            If w_PlanEndCol < m_BackColorPointerCol_4W Then
                                '計画期間外の4週部分 背景色？
                                w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var <> "" Then
                                    w_Index = Integer.Parse(w_Var)
                                End If
                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = m_BackColorPointerCol_4W - w_KeikakuCol + 1
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                End If
                                If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                    '計画期間外
                                    w_BackColor = ColorTranslator.FromOle(m_Jisseki4W_Back)
                                End If
                            End If

                            Call SubSetStyle(sprSheet_4W, w_RowLoop, m_BackColorPointerCol_4W, w_RowLoop, m_BackColorPointerCol_4W, 0, 0, , w_BackColor)
                        End If
                    End If
                Next w_RowLoop

                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    w_StartCol = M_KinmuData_Col
                End If

                If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= m_BackColorPointerCol_4W AndAlso m_BackColorPointerCol_4W <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                    '計画期間内の場合
                    If w_StartCol <= m_BackColorPointerCol_4W Then

                        For w_RowLoop = m_StaffRow.StartRow To m_BackColorPointerRow_4W
                            '--- 転出日,配属日の取得 ---
                            'ﾃﾞｰﾀ格納配列番号 取得
                            w_Var = .GetText(w_RowLoop, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var <> "" Then
                                w_Index = Integer.Parse(w_Var)
                            End If

                            '配属期間外表示色設定
                            w_HaizokuFlg = False

                            '配属期間外表示色設定
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, m_BackColorPointerCol_4W)
                            If w_Var <> "" Then
                                If IsNumeric(w_Var) = True Then
                                    For w_Int = 1 To UBound(m_StaffData(w_Index).IdoData)
                                        If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                            '期間内に配属していた場合
                                            w_HaizokuFlg = True
                                            Exit For
                                        End If
                                    Next w_Int
                                End If
                            End If

                            '応援勤務者は配属期間外とする
                            If m_StaffData(w_Index).OuenStaffFlg = 1 Then
                                w_HaizokuFlg = False
                            End If

                            If w_HaizokuFlg = True Then
                                '配属期間内のとき
                            Else
                                '配属期間外の時
                                w_ShukeiFlg = False
                                If m_4WeekKikan(m_SelViewKikan).PersonalStartCol <= m_BackColorPointerCol_4W AndAlso m_BackColorPointerCol_4W <= m_4WeekKikan(m_SelViewKikan).PersonalEndCol Then
                                    w_ShukeiFlg = True
                                    Exit For
                                End If

                                If w_ShukeiFlg = False AndAlso w_RowLoop >= M_KinmuDataStart_Row Then
                                    '個人別集計範囲外のとき
                                    Call SubSetStyle(sprSheet_4W, w_RowLoop, m_BackColorPointerCol_4W, w_RowLoop, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                                End If
                            End If
                        Next w_RowLoop
                    Else
                        '勤務変更モード
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_GetCol) = True Then
                                If m_BackColorPointerCol_4W < w_GetCol Then
                                    '実績期間内、個人別集計内の場合
                                    Call SubSetStyle(sprSheet_4W, M_DayLabel_Row, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                                End If
                            End If
                        Else
                            '実績期間内、個人別集計内の場合
                            Call SubSetStyle(sprSheet_4W, M_DayLabel_Row, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                        End If
                    End If
                Else
                    '勤務変更モード
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_GetCol) = True Then
                            If m_BackColorPointerCol_4W < w_GetCol Then
                                '実績期間内、個人別集計内の場合
                                Call SubSetStyle(sprSheet_4W, M_DayLabel_Row, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                            End If
                        End If
                    Else
                        '実績期間内、個人別集計内の場合
                        Call SubSetStyle(sprSheet_4W, M_DayLabel_Row, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                    End If
                End If

                '二段表示してる時の計画期間外の上段を黒く塗りつぶす
                Call Disp_BackColor(False, m_BackColorPointerCol_4W, m_StaffRow.StartRow, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W)
            End With

            With sprSheet_4W.Sheets(0)
                '--------------------
                '背景色を元に戻す
                '--------------------
                'ﾃﾞｰﾀ格納配列番号 取得
                w_Var = .GetText(m_BackColorPointerRow_4W, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    w_Index = Integer.Parse(w_Var)
                End If

                '-- 氏名 色設定 -------------
                '自動割当対象区分 ?
                If m_StaffData(w_Index).AutoKBN = "1" Then
                    'SkillBunruiCD ?
                    If m_StaffData(w_Index).GiryoBunruiCD = "1" Then
                        'ﾘｰﾀﾞｰ
                        w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "2" Then
                        'ｻﾌﾞﾘｰﾀﾞｰ
                        w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "3" Then
                        'ｽﾀｯﾌ
                        w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                    ElseIf m_StaffData(w_Index).GiryoBunruiCD = "4" Then
                        '新人
                        w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                    Else
                        'ERROR
                        '自動割当対象外 に設定
                        w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                    End If
                ElseIf m_StaffData(w_Index).OuenStaffFlg = 1 Then
                    '何もしない
                Else
                    '非対象の場合
                    w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                End If

                If m_BackColorPointerRow_4W <> 0 Then
                    Call SubSetStyle(sprSheet_4W, m_BackColorPointerRow_4W, M_StaffName_Col, m_BackColorPointerRow_4W, M_StaffName_Col, 0, 0, , w_BackColor)
                End If

                '明細の背景色を元に戻す
                Call SubSetStyle(sprSheet_4W, m_BackColorPointerRow_4W, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , Color.White)

                If m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= m_BackColorPointerCol_4W AndAlso m_BackColorPointerCol_4W <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                    If ((m_BackColorPointerRow_4W - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((m_BackColorPointerRow_4W - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        For w_ColLoop = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol To m_BackColorPointerCol_4W
                            '部署異動ﾁｪｯｸ（配属期間内）
                            w_Var = .GetText(m_BackColorPointerRow_4W, w_ColLoop)
                            If w_Var <> "" Then
                                '2015/04/10 Bando Upd Start =======================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd End   =======================

                                '理由区分による色設定(文字色/背景色)
                                If w_RiyuKBN = "1" Then
                                    '通常
                                    w_BackColor = Color.White
                                ElseIf w_RiyuKBN = "2" Then
                                    '要請勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                ElseIf w_RiyuKBN = "3" Then
                                    '希望勤務 文字/背景色
                                    '2015/07/21 Bando Upd Start ==================
                                    If w_Comment = "" Then
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Else
                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    End If
                                    '2015/07/21 Bando Upd End   ==================
                                ElseIf w_RiyuKBN = "4" Then
                                    '再掲勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                ElseIf w_RiyuKBN = "5" Then
                                    '委員会勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                ElseIf w_RiyuKBN = "6" Then
                                    '応援勤務 文字/背景色
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                End If
                                '代休発生勤務 文字/背景色
                                w_DaikyuBackColorFlg = False
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var = .GetText(m_BackColorPointerRow_4W, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var)
                                        'w_Var2 = .GetText(w_ColLoop, M_YYYYMMDDLabel_Row)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If

                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var = .GetText(m_BackColorPointerRow_4W, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        'w_Var2 = .GetText(w_ColLoop, M_YYYYMMDDLabel_Row)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================

                                If w_Time <> "" Then
                                    '時間年休入力の場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                End If

                                If w_PlanEndCol < w_ColLoop Then
                                    '計画期間外の4週部分 背景色？
                                    w_Var = .GetText(m_BackColorPointerRow_4W, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var <> "" Then
                                        w_Index = Integer.Parse(w_Var)
                                    End If
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_ColLoop - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                    End If
                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        '計画期間外
                                        w_BackColor = ColorTranslator.FromOle(m_Jisseki4W_Back)
                                    End If
                                End If

                                Call SubSetStyle(sprSheet_4W, m_BackColorPointerRow_4W, w_ColLoop, m_BackColorPointerRow_4W, w_ColLoop, 0, 0, , w_BackColor)
                            End If
                        Next w_ColLoop
                    End If

                    '--- 転出日,配属日の取得 ---
                    'ﾃﾞｰﾀ格納配列番号 取得
                    w_Var = .GetText(m_BackColorPointerRow_4W, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        w_Index = Integer.Parse(w_Var)
                    End If

                    For w_ColLoop = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol To m_BackColorPointerCol_4W
                        w_HaizokuFlg = False
                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColLoop)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then
                                For w_Int = 1 To UBound(m_StaffData(w_Index).IdoData)
                                    '計画開始日より異動日が小さいときは計画開始日を格納
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD < m_KeikakuKikan.StartDate Then
                                        w_StartDate = m_KeikakuKikan.StartDate
                                    Else
                                        w_StartDate = m_StaffData(w_Index).IdoData(w_Int).IdoYMD
                                    End If

                                    If w_StartDate <= Integer.Parse(w_Var) AndAlso Integer.Parse(w_Var) <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        '期間内に配属していた場合
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If
                        End If

                        '応援勤務者は配属期間外とする
                        If m_StaffData(w_Index).OuenStaffFlg = 1 Then
                            w_HaizokuFlg = False
                        End If

                        If w_HaizokuFlg = True Then
                            '配属期間内のとき
                        Else
                            '配属期間外の時
                            w_ShukeiFlg = False
                            If m_4WeekKikan(m_SelViewKikan).PersonalStartCol <= m_BackColorPointerCol_4W AndAlso m_BackColorPointerCol_4W <= m_4WeekKikan(m_SelViewKikan).PersonalEndCol Then
                                w_ShukeiFlg = True
                                Exit For
                            End If

                            If w_ShukeiFlg = False AndAlso m_BackColorPointerRow_4W >= M_KinmuDataStart_Row Then
                                '個人別集計範囲外のとき
                                .Cells(m_BackColorPointerRow_4W, w_ColLoop).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                            End If
                        End If

                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        Else
                            If w_HaizokuFlg = True AndAlso w_ColLoop > m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays Then
                                .Cells(M_MonthLabel_Row, w_ColLoop, m_BackColorPointerRow_4W, w_ColLoop).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                            End If
                        End If
                    Next w_ColLoop

                    '二段表示してる時の計画期間外の上段を黒く塗りつぶす
                    Call Disp_BackColor(False, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, m_BackColorPointerRow_4W)

                    '勤務変更モード
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_BackColorPointerRow_4W >= M_KinmuDataStart_Row Then
                            '実績の背景色を元に戻す
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_GetCol) = True Then
                                .Cells(m_BackColorPointerRow_4W, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, w_GetCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                            End If
                        End If
                    Else
                        '実績の背景色を元に戻す
                        .Cells(m_BackColorPointerRow_4W, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                    End If
                Else
                    '勤務変更モード
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If m_BackColorPointerRow_4W >= M_KinmuDataStart_Row Then
                            '実績の背景色を元に戻す
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_GetCol) = True Then
                                .Cells(m_BackColorPointerRow_4W, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, w_GetCol - 1).BackColor = ColorTranslator.FromOle(m_MonthBefore_Back)
                            End If
                        End If
                    Else
                        '実績の背景色を元に戻す
                        Call SubSetStyle(sprSheet_4W, m_BackColorPointerRow_4W, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, m_BackColorPointerCol_4W, 0, 0, , ColorTranslator.FromOle(m_MonthBefore_Back))
                    End If
                End If

                '二段表示してる時の計画期間外の上段を黒く塗りつぶす
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_GetCol) = True Then
                    w_GetCol = w_GetCol - 1
                Else
                    w_GetCol = M_KinmuDataStart_Col
                End If
                Call Disp_BackColor(False, M_KinmuDataStart_Col, m_BackColorPointerRow_4W, w_GetCol, m_BackColorPointerRow_4W)
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub cmbTeam_SelectedIndexChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles cmbTeam.SelectedIndexChanged

        Const W_SUBNAME As String = "NSK0000HA cmbTeam_Click"

        Dim w_str As String
        Dim w_ViewTeam As Integer
        Dim w_lblCap(3) As String
        Dim w_lblBkColor As String
        Try
            '選択チーム取得
            w_ViewTeam = cmbTeam.SelectedIndex
            If m_SelTeamNo = w_ViewTeam Then
                Exit Sub
            End If

            '夜間時間計算結果の退避
            w_lblCap(1) = lblTotalTime.Text
            w_lblCap(2) = lblAveTime.Text
            w_lblCap(3) = lblKangoYouin.Text
            w_lblBkColor = Convert.ToString(ColorTranslator.ToOle(lblAveTime.BackColor))

            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            Me.Refresh()

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            Me.Cursor = Cursors.WaitCursor

            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text
            sbrMain.Refresh()

            '使用不可
            cmbTeam.Enabled = False

            '選択ﾘｽﾄ 取得
            m_SelTeamNo = cmbTeam.SelectedIndex

            '-- 抽出実行 ------------------
            picBase.Visible = False
            Call PickUpData(m_SelTeamNo)

            'ｾﾙの再設定（更新も）を行う。
            Call Set_SpreadAdd()

            '選択セルとスクロール位置設定
            Call Set_KeikakuFirstCell()

            '夜間時間計算結果を再表示
            lblTotalTime.Text = w_lblCap(1)
            lblAveTime.Text = w_lblCap(2)
            lblKangoYouin.Text = w_lblCap(3)
            lblAveTime.BackColor = ColorTranslator.FromOle(Integer.Parse(w_lblBkColor))

            picBase.Visible = True

            '使用可
            cmbTeam.Enabled = True

            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
            sbrMain.Refresh()

            Me.Cursor = Cursors.Default

            Call Calc_ScrollSpread()

            sprScroll.SetViewportLeftColumn(0, 0)
            sprScroll.SetViewportTopRow(0, 0)

            Call subSetCrossPointLength()

            picCover.Visible = False

        Catch ex As Exception
            Me.Cursor = Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '表示順選択コンボボックス選択イベント

    Private Sub cmbHyoujijunMei_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbHyoujijunMei.SelectedIndexChanged

        Const W_SUBNAME As String = "NSK0000HA cmbHyoujijunMei_Click"

        Dim w_str As String
        Dim w_ViewHyoujijunMei As Integer
        Dim w_lblCap(3) As String
        Dim w_lblBkColor As String

        Try
            '選択表示順取得
            w_ViewHyoujijunMei = cmbHyoujijunMei.SelectedIndex
            If m_SelHyoujijunMei = w_ViewHyoujijunMei Then
                Exit Sub
            End If

            '夜間時間計算結果の退避
            w_lblCap(1) = lblTotalTime.Text
            w_lblCap(2) = lblAveTime.Text
            w_lblCap(3) = lblKangoYouin.Text
            w_lblBkColor = Convert.ToString(ColorTranslator.ToOle(lblAveTime.BackColor))

            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            Me.Refresh()

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            Me.Cursor = Cursors.WaitCursor

            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text
            sbrMain.Refresh()

            '使用不可
            cmbHyoujijunMei.Enabled = False

            '選択ﾘｽﾄ 取得
            m_SelHyoujijunMei = cmbHyoujijunMei.SelectedIndex

            '-- 抽出実行 ------------------
            picBase.Visible = False
            Call HyoujijunMeiPickUpData(m_SelHyoujijunMei)

            'Call m_SortForm_Sort()

            ''ｾﾙの再設定（更新も）を行う。
            'Call Set_SpreadAdd()

            ''選択セルとスクロール位置設定
            'Call Set_KeikakuFirstCell()

            '夜間時間計算結果を再表示
            lblTotalTime.Text = w_lblCap(1)
            lblAveTime.Text = w_lblCap(2)
            lblKangoYouin.Text = w_lblCap(3)
            lblAveTime.BackColor = ColorTranslator.FromOle(Integer.Parse(w_lblBkColor))

            picBase.Visible = True

            '使用可
            cmbHyoujijunMei.Enabled = True

            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
            sbrMain.Refresh()

            Me.Cursor = Cursors.Default

            Call Calc_ScrollSpread()

            sprScroll.SetViewportLeftColumn(0, 0)
            sprScroll.SetViewportTopRow(0, 0)

            Call subSetCrossPointLength()

            picCover.Visible = False

        Catch ex As Exception
            Me.Cursor = Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｺﾋﾟｰ
    Private Sub CopyData()

        Const W_SUBNAME As String = "NSK0000HA CopyData"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_KikanStartCol As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Cnt As Integer
        Dim w_CurrentDate As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_lngKojyoLoop As Integer
        Dim w_CellRange() As Model.CellRange
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            'ｺﾋﾟｰ中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_COPY_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                With sprSheet_M.Sheets(0)

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    '連続したｾﾙﾌﾟﾛｯｸか？
                    If w_CellRange.Length > 1 Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "複数の選択範囲は"
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If
                    '№、氏名列、期間集計列の場合はコピー不可

                    '2014/05/28 Shibata edit start P-06983 ---------------------------------------
                    'If w_EndCol <= M_FrozenCol OrElse m_KeikakuKikan.PersonalStartCol <= w_StartCol Then
                    If w_EndCol < M_FrozenCol OrElse m_KeikakuKikan.PersonalStartCol <= w_StartCol Then
                        '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                        Exit Sub
                    End If


                    '2014/05/28 Shibata del start P-06983 ---------------------------------------
                    ''計画ﾃﾞｰﾀ列 範囲内か ?
                    'If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_EndCol <= m_KeikakuKikan.KinmuDataEndCol)) Then
                    '    'ERROR
                    '    ReDim w_strMsg(1)
                    '    w_strMsg(1) = "計画期間外の勤務は"
                    '    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                    '    Exit Sub
                    'End If
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------

                    '2014/05/28 Shibata add start P-06983 ---------------------------------------
                    For w_Col = w_StartCol To w_EndCol
                        If .Columns(w_Col).Width() = 0 Then
                            'ERROR
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "計画期間を跨いでの"
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    Next w_Col
                    '2014/05/28 Shibata add end P-06983 ---------------------------------------

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックでコピー可能
                        ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみコピー
                            For w_Col = w_StartCol To w_EndCol

                                '2014/05/28 Shibata add start P-06983 ---------------------------------------
                                Dim w_StaffIdx As Integer
                                Dim w_YYYYMMDD As String
                                Dim w_HyojiFlg As Boolean
                                Dim w_Int As Integer

                                '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                                '職員ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)

                                '日付を渡す
                                w_YYYYMMDD = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                                '配属しているか？
                                w_HyojiFlg = False
                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                    If m_StaffData(w_StaffIdx).IdoData(w_Int).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int).SyuryoYMD Then
                                        '配属している期間のとき
                                        w_HyojiFlg = True
                                        Exit For
                                    End If
                                Next w_Int

                                '応援勤務者は配属期間外とする
                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                    w_HyojiFlg = False
                                End If
                                '2014/05/28 Shibata add end P-06983 ---------------------------------------

                                '2014/05/28 Shibata edit start P-06983 ---------------------------------------
                                'If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                If (Not w_HyojiFlg) Then
                                    '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務は"
                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署確定勤務は"
                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start ========================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   ========================
                                    If g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If w_RiyuKBN <> "4" Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "再掲勤務以外は"
                                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    Else
                                        '再掲部署以外
                                        If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            If w_RiyuKBN = "4" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "再掲勤務は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            ElseIf w_RiyuKBN = "5" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "委員会勤務は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    If General.g_lngDaikyuMng = 0 Then
                                        If w_KinmuCD <> "" Then
                                            '代休勤務はコピーさせない
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                        '休日勤務で代休取得対象勤務はコピーさせない
                                        If ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "代休対象勤務は"
                                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                    '#001-----St
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        '届出使用時は届出があればコピー不可
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(Integer.Parse(w_Var)).ID
                                                .mKC_TargetDate = w_CurrentDate

                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "届出申請勤務は"
                                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If
                                    End If
                                    '#001-----Ed
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    '------------------------------------------------------------
                    '   ｺﾋﾟｰ実行
                    '------------------------------------------------------------
                    'ｺﾋﾟｰ先の位置情報 退避
                    m_CopyData.StartCol = M_KinmuDataStart_Col
                    m_CopyData.StartRow = m_CopyArea.StartRow
                    m_CopyData.EndCol = m_CopyData.StartCol + (w_EndCol - w_StartCol)
                    m_CopyData.EndRow = m_CopyData.StartRow + (w_EndRow - w_StartRow)

                    'ｺﾋﾟｰ実行
                    .CopyRange(w_StartRow, w_StartCol, m_CopyData.StartRow, m_CopyData.StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)

                    '2014/05/28 Shibata add end P-06983 ---------------------------------------
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_StartCol + (w_EndCol - w_StartCol) <= m_KeikakuKikan.KinmuDataEndCol)) Then

                        Dim w_copyRow As Integer
                        Dim w_copyCol As Integer
                        Dim w_TextRiyuKbn As String
                        Dim w_BackColor As System.Drawing.Color
                        Dim w_ForeColor As System.Drawing.Color

                        For w_copyRow = m_CopyData.StartRow To m_CopyData.EndRow
                            For w_copyCol = m_CopyData.StartCol To m_CopyData.EndCol
                                Dim w_str As String
                                .Cells(w_copyRow, w_copyCol).BackColor = Color.White
                                If .Cells(w_copyRow, w_copyCol).Value <> "" Then
                                    w_str = .Cells(w_copyRow, w_copyCol).Value

                                    ' 前月データの休暇/届出一覧データをなくす場合 START
                                    .Cells(w_copyRow, w_copyCol).Value = Strings.Left(w_str, w_str.Length - 124) & "10" & Space(122)
                                    ' 前月データの休暇/届出一覧データをなくす場合 END
                                End If
                            Next w_copyCol
                        Next w_copyRow
                    End If
                    '2014/05/28 Shibata add end P-06983 ---------------------------------------

                    '控除データのコピーも行う
                    '初期化
                    ReDim m_KojyoCopyData(0)

                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            ReDim Preserve m_KojyoCopyData(w_Cnt)

                            '対象日付取得
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            End If

                            '配列番号 取得
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If IsNumeric(w_Var) = True Then
                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                    If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                        m_KojyoCopyData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop)
                                        Exit For
                                    End If
                                Next
                                '2014/05/28 Shibata edit start P-06983 ---------------------------------------
                                ' 前月データの休暇/届出一覧データをなくす場合 START
                                If m_KojyoCopyData(w_Cnt).lngDate = 0 OrElse (Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_StartCol + (w_EndCol - w_StartCol) <= m_KeikakuKikan.KinmuDataEndCol))) Then
                                    ' 前月データの休暇/届出一覧データをなくす場合 END
                                    'If m_KojyoCopyData(w_Cnt).lngDate = 0 Then
                                    '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                                    m_KojyoCopyData(w_Cnt).init()
                                End If
                            End If
                        Next w_Col
                    Next w_Row
                End With
            Else
                '4週画面表示中の場合

                With sprSheet_4W.Sheets(0)

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    '連続したｾﾙﾌﾟﾛｯｸか？
                    If w_CellRange.Length > 1 Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "複数の選択範囲は"
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If
                    '2014/05/28 Shibata edit start P-06983 ---------------------------------------
                    '№、氏名列、期間集計列の場合はコピー不可
                    'If w_EndCol <= M_FrozenCol OrElse m_4WeekKikan(m_SelViewKikan).PersonalStartCol <= w_StartCol Then
                    If w_EndCol < M_FrozenCol OrElse m_4WeekKikan(m_SelViewKikan).PersonalStartCol <= w_StartCol Then
                        '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                        Exit Sub
                    End If

                    '2014/05/28 Shibata del end P-06983 ---------------------------------------
                    ''計画ﾃﾞｰﾀ列 範囲内か ?
                    'If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                    '    'ERROR
                    '    ReDim w_strMsg(1)
                    '    w_strMsg(1) = "計画期間外の勤務は"
                    '    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                    '    Exit Sub
                    'End If
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------

                    '2014/05/28 Shibata add start P-06983 ---------------------------------------
                    For w_Col = w_StartCol To w_EndCol
                        If .Columns(w_Col).Width() = 0 Then
                            'ERROR
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "計画期間を跨いでの"
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    Next w_Col
                    '2014/05/28 Shibata add end P-06983 ---------------------------------------

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックでコピー可能
                        ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみコピー
                            For w_Col = w_StartCol To w_EndCol

                                '2014/05/28 Shibata add start P-06983 ---------------------------------------
                                Dim w_StaffIdx As Integer
                                Dim w_YYYYMMDD As String
                                Dim w_HyojiFlg As Boolean
                                Dim w_Int As Integer

                                '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)

                                '職員ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)

                                '日付を渡す
                                w_YYYYMMDD = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                                '配属しているか？
                                w_HyojiFlg = False

                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                    If m_StaffData(w_StaffIdx).IdoData(w_Int).IdoYMD2 <= w_YYYYMMDD AndAlso w_YYYYMMDD <= m_StaffData(w_StaffIdx).IdoData(w_Int).SyuryoYMD Then
                                        '配属している期間のとき
                                        w_HyojiFlg = True
                                        Exit For
                                    End If
                                Next w_Int

                                '応援勤務者は配属期間外とする
                                If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                    w_HyojiFlg = False
                                End If
                                '2014/05/28 Shibata add end P-06983 ---------------------------------------

                                '2014/05/28 Shibata edit start P-06983 ---------------------------------------
                                'If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                If Not w_HyojiFlg Then
                                    '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務は"
                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署確定勤務は"
                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "計画期間外の確定済み勤務は"
                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start ================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   ================================
                                    If g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If w_RiyuKBN <> "4" Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "再掲勤務以外は"
                                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    Else
                                        '再掲部署以外
                                        If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            If w_RiyuKBN = "4" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "再掲勤務は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            ElseIf w_RiyuKBN = "5" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "委員会勤務は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    If General.g_lngDaikyuMng = 0 Then
                                        If w_KinmuCD <> "" Then
                                            '代休勤務はコピーさせない
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休は"
                                                Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                        '休日勤務で代休取得対象勤務はコピーさせない
                                        If ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "代休対象勤務は"
                                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                    '#001-----St
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        '届出使用時は届出があればコピー不可
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If IsNumeric(w_Var) = True Then
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(Integer.Parse(w_Var)).ID
                                                .mKC_TargetDate = w_CurrentDate

                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "届出申請勤務は"
                                                    Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If
                                    End If
                                    '#001-----Ed
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    m_CopyData.StartCol = M_KinmuDataStart_Col
                    m_CopyData.StartRow = m_CopyArea.StartRow
                    m_CopyData.EndCol = m_CopyData.StartCol + (w_EndCol - w_StartCol)
                    m_CopyData.EndRow = m_CopyData.StartRow + (w_EndRow - w_StartRow)

                    'ｺﾋﾟｰ実行
                    .CopyRange(w_StartRow, w_StartCol, m_CopyData.StartRow, m_CopyData.StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)

                    '2014/05/28 Shibata add start P-06983 ---------------------------------------
                    Dim w_KikanEndCol As Integer
                    If m_KeikakuKikan.EndDate <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.EndDate, w_KikanEndCol) = False Then
                            w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    End If

                    If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= w_KikanEndCol)) Then

                        Dim w_copyRow As Integer
                        Dim w_copyCol As Integer
                        Dim w_TextRiyuKbn As String
                        Dim w_BackColor As System.Drawing.Color
                        Dim w_ForeColor As System.Drawing.Color

                        For w_copyRow = m_CopyData.StartRow To m_CopyData.EndRow
                            For w_copyCol = m_CopyData.StartCol To m_CopyData.EndCol
                                Dim w_str As String
                                .Cells(w_copyRow, w_copyCol).BackColor = Color.White
                                If .Cells(w_copyRow, w_copyCol).Value <> "" Then
                                    w_str = .Cells(w_copyRow, w_copyCol).Value

                                    ' 前月データの休暇/届出一覧データをなくす場合 START
                                    .Cells(w_copyRow, w_copyCol).Value = Strings.Left(w_str, w_str.Length - 124) & "10" & Space(122)
                                    ' 前月データの休暇/届出一覧データをなくす場合 END
                                End If
                            Next w_copyCol
                        Next w_copyRow
                    End If
                    '2014/05/28 Shibata add end P-06983 ---------------------------------------

                    '控除データのコピーも行う
                    '初期化
                    ReDim m_KojyoCopyData(0)

                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            ReDim Preserve m_KojyoCopyData(w_Cnt)

                            '対象日付取得
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            End If

                            '配列番号 取得
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If IsNumeric(w_Var) = True Then
                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                    If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                        m_KojyoCopyData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop)
                                        Exit For
                                    End If
                                Next
                                '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                                ' 前月データの休暇/届出一覧データをなくす場合 START
                                If m_KojyoCopyData(w_Cnt).lngDate = 0 OrElse (Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol))) Then
                                    ' 前月データの休暇/届出一覧データをなくす場合 END
                                    'If m_KojyoCopyData(w_Cnt).lngDate = 0 Then
                                    '2014/05/28 Shibata edit end P-06983 ---------------------------------------
                                    m_KojyoCopyData(w_Cnt).init()
                                End If
                            End If
                        Next w_Col
                    Next w_Row
                End With
            End If

            '貼り付け使用可
            m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopupFLG

            'ﾎﾟｯﾌﾟｱｯﾌﾟ貼り付け使用可
            m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopupFLG

            '貼り付け使用可
            m_blnPopPasteFLG = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '切り取り
    Private Sub CutData()

        Const W_SUBNAME As String = "NSK0000HA CutData"

        Dim w_Col As Integer
        Dim w_Col_4W As Integer
        Dim w_Col_M As Integer
        Dim w_Row As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Bool As Boolean
        Dim w_KikanStartCol As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_GetBool As Boolean
        Dim w_GetCol As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Var2 As Object
        Dim w_Time As String = String.Empty
        Dim w_strMsg() As String
        Dim w_lngKojyoLoop As Integer
        Dim w_CellRange() As Model.CellRange
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            '切り取り中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_CUT_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                With sprSheet_M.Sheets(0)

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    '連続したｾﾙﾌﾟﾛｯｸか？
                    If w_CellRange.Length > 1 Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "複数の選択範囲は"
                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    '選択行が職員の一番上の行ではないとき
                    If (w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine <> 0 Then
                        '選択行が職員の勤務を含んでない行のとき
                        If ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine > m_KinmuPlan) AndAlso ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine > m_KinmuJisseki) Then
                            'コピー開始行を次の職員の一番上の行とする
                            w_StartRow = w_StartRow + m_MaxShowLine - ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine)
                        Else
                            'コピー開始行を選択職員の一番上の行とする
                            w_StartRow = w_StartRow - ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine)
                        End If
                    End If

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If
                    '№列、氏名列、計画期間集計列の場合は切り取り不可
                    If w_EndCol <= M_FrozenCol OrElse m_KeikakuKikan.PersonalStartCol <= w_StartCol Then
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_EndCol <= m_KeikakuKikan.KinmuDataEndCol)) Then
                        'ERROR
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "計画期間外の勤務は"
                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ切り取り
                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務は"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署確定勤務は"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                    '#001-----St
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    '#001-----Ed
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                End If

                                '配列番号 取得
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If IsNumeric(w_Var) = True Then
                                    '職員管理番号 取得
                                    If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務は"
                                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    w_Var2 = .GetText(w_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        '2015/04/10 Bando Upd Start =========================================
                                        'Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, "", "", w_Time)
                                        Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, "", "", w_Time, w_Comment)
                                        '2015/04/10 Bando Upd End   =========================================
                                        If g_SaikeiFlg = True Then
                                            '再掲部署の場合
                                            If w_RiyuKBN <> "4" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "再掲勤務以外は"
                                                Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        Else
                                            '再掲部署以外
                                            If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                If w_RiyuKBN = "4" Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "再掲勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                ElseIf w_RiyuKBN = "5" Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "委員会勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                        End If

                                        If General.g_lngDaikyuMng = 0 Then
                                            If w_KinmuCD <> "" Then
                                                '代休は切り取りできないようにする
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "代休は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                            '休日勤務で代休対象勤務は切り取りできないようにする
                                            If ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休対象勤務は"
                                                Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                        '#001-----St
                                        If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                            '届出使用時は届出があれば切り取り不可
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(Integer.Parse(w_Var)).ID
                                                .mKC_TargetDate = w_CurrentDate

                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "届出申請勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If
                                        '#001-----Ed
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    'ｾﾙの初期化
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    '------------------------------------------------------------
                    '   ｺﾋﾟｰ実行
                    '------------------------------------------------------------
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start-----------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end-------------------

                    'ReDim m_KojyoUndoData(0)
                    ''Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del
                    '----------------------------------------------------------------------------------------------------
                    'ｺﾋﾟｰ先の位置情報 退避
                    m_CopyData.StartCol = M_KinmuDataStart_Col
                    m_CopyData.StartRow = m_CopyArea.StartRow
                    m_CopyData.EndCol = m_CopyData.StartCol + (w_EndCol - w_StartCol)
                    m_CopyData.EndRow = m_CopyData.StartRow + (w_EndRow - w_StartRow)

                    'ｺﾋﾟｰ実行
                    .CopyRange(w_StartRow, w_StartCol, m_CopyData.StartRow, m_CopyData.StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)

                    '控除データのコピーも行う
                    '初期化
                    w_Cnt = 0
                    ReDim m_KojyoCopyData(0)
                    'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            ReDim Preserve m_KojyoCopyData(w_Cnt)
                            'ReDim Preserve m_KojyoUndoData(w_Cnt) '2016/04/06 Yamanishi Del

                            '対象日付取得
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            End If

                            '配列番号 取得
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If IsNumeric(w_Var) = True Then
                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                    If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                        m_KojyoCopyData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop)
                                        'm_KojyoUndoData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                        Exit For
                                    End If
                                Next
                                If m_KojyoCopyData(w_Cnt).lngDate = 0 Then
                                    m_KojyoCopyData(w_Cnt).init()
                                End If
                            End If
                        Next w_Col
                    Next w_Row

                    '-- 現在選択中のｾﾙ消去 ---
                    If m_MaxShowLine > 1 Then
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ切り取り
                                .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合

                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ切り取り
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                                    If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                        sprSheet_4W.Sheets(0).ClearRange(w_Row, w_Col_4W, 1, 1, False)
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    End If
                End With
            Else
                '4週画面表示中の場合

                With sprSheet_4W.Sheets(0)

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    '連続したｾﾙﾌﾟﾛｯｸか？
                    If w_CellRange.Length > 1 Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "複数の選択範囲は"
                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    '選択行が職員の一番上の行ではないとき
                    If (w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine <> 0 Then
                        '選択行が職員の勤務を含んでない行のとき
                        If ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine > m_KinmuPlan) AndAlso ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine > m_KinmuJisseki) Then
                            'コピー開始行を次の職員の一番上の行とする
                            w_StartRow = w_StartRow + m_MaxShowLine - ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine)
                        Else
                            'コピー開始行を選択職員の一番上の行とする
                            w_StartRow = w_StartRow - ((w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine)
                        End If
                    End If

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If
                    '№列、氏名列、期間集計列の場合は切り取り不可
                    If w_EndCol <= M_FrozenCol OrElse m_4WeekKikan(m_SelViewKikan).PersonalStartCol <= w_StartCol Then
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                        'ERROR
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "計画期間外の勤務は"
                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ切り取り
                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務は"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署確定勤務は"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "確定済み勤務は"
                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                End If

                                '配列番号 取得
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If IsNumeric(w_Var) = True Then
                                    '職員管理番号 取得
                                    If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務は"
                                        Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    w_Var2 = .GetText(w_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        '2015/04/10 Bando Upd Start =========================================
                                        'Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, "", "", w_Time)
                                        Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, "", "", w_Time, w_Comment)
                                        '2015/04/10 Bando Upd End   =========================================
                                        If g_SaikeiFlg = True Then
                                            '再掲部署の場合
                                            If w_RiyuKBN <> "4" Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "再掲勤務以外は"
                                                Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        Else
                                            '再掲部署以外
                                            If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                If w_RiyuKBN = "4" Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "再掲勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                ElseIf w_RiyuKBN = "5" Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "委員会勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                        End If

                                        If General.g_lngDaikyuMng = 0 Then
                                            If w_KinmuCD <> "" Then
                                                '代休は切り取りできないようにする
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "代休は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                            '休日勤務で代休対象勤務は切り取りできないようにする
                                            If ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休対象勤務は"
                                                Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                        '#001-----St
                                        If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                            '届出使用時は届出があれば切り取り不可
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(Integer.Parse(w_Var)).ID
                                                .mKC_TargetDate = w_CurrentDate

                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "届出申請勤務は"
                                                    Call Set_MsgZOrder("NS0106", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If
                                        '#001-----Ed
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    '------------------------------------------------------------
                    '   ｺﾋﾟｰ実行
                    '------------------------------------------------------------
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start----------------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end------------------------

                    'ReDim m_KojyoUndoData(0)
                    ''Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del
                    '----------------------------------------------------------------------------------------------------
                    'ｺﾋﾟｰ先の位置情報 退避
                    m_CopyData.StartCol = M_KinmuDataStart_Col
                    m_CopyData.StartRow = m_CopyArea.StartRow
                    m_CopyData.EndCol = m_CopyData.StartCol + (w_EndCol - w_StartCol)
                    m_CopyData.EndRow = m_CopyData.StartRow + (w_EndRow - w_StartRow)

                    'ｺﾋﾟｰ実行
                    .CopyRange(w_StartRow, w_StartCol, m_CopyData.StartRow, m_CopyData.StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)

                    '控除データのコピーも行う
                    '初期化
                    w_Cnt = 0
                    ReDim m_KojyoCopyData(0)
                    'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            ReDim Preserve m_KojyoCopyData(w_Cnt)
                            'ReDim Preserve m_KojyoUndoData(w_Cnt) '2016/04/06 Yamanishi Del

                            '対象日付取得
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If w_Var <> "" Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            End If

                            '配列番号 取得
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If IsNumeric(w_Var) = True Then
                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                    If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                        m_KojyoCopyData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop)
                                        'm_KojyoUndoData(w_Cnt) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                        Exit For
                                    End If
                                Next
                                If m_KojyoCopyData(w_Cnt).lngDate = 0 Then
                                    m_KojyoCopyData(w_Cnt).init()
                                End If
                            End If
                        Next w_Col
                    Next w_Row

                    '-- 現在選択中のｾﾙ消去 ---
                    If m_MaxShowLine > 1 Then
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ切り取り
                                .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                    End If

                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ切り取り
                            For w_Col = w_StartCol To w_EndCol

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If
                                '1ヶ月用列番号取得
                                If Get_Col_M(w_Var, w_Col_M) = True Then
                                    sprSheet_M.Sheets(0).ClearRange(w_Row, w_Col_M, 1, 1, False)
                                End If
                            Next w_Col
                        End If
                    Next w_Row
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            '貼り付け使用可
            m_lstmnuEdit(M_MenuPaste).Enabled = m_blnPopupFLG

            'ﾎﾟｯﾌﾟｱｯﾌﾟ貼り付け使用可
            m_lstmnuPopup(M_PopPaste).Enabled = m_blnPopupFLG

            '貼り付け使用可
            m_blnPopPasteFLG = True

            Call Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾁｰﾑ別表示
    Private Sub PickUpData(ByVal p_ListIndex As Integer)

        Const W_SUBNAME As String = "NSK0000HA PickUpData"

        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_StaffZokusei As Object
        Dim w_SortOrder As Object
        Dim w_StartRowFlg As Boolean
        Dim w_Int As Integer
        Dim w_MsgRc As Integer
        Dim w_Spread() As FpSpread
        Dim w_TeamCnt As Integer
        Dim w_Col As Integer
        Dim w_Row2 As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_VisibleCellCnt As Integer
        Dim w_DataAreaLoop As Integer
        Dim w_CalcLoop As Integer
        Dim w_Team As Integer
        Dim w_intSelLine As Integer
        Dim w_Loop As Integer
        Dim w_strMsg() As String
        Dim w_Style As New StyleInfo()
        Dim w_VisibleRow_St As Integer
        Dim w_VisibleRow_Ed As Integer
        Dim w_sngHeight As Single
        Dim w_RowLoop As Integer
        Try
            '抽出中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PICKUP_STR
            sbrMain.Refresh()

            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                ReDim w_Spread(1)
                'ｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                w_Spread(1) = sprDayTotal_M
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                ReDim w_Spread(2)
                'ｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                w_Spread(1) = sprDayTotal_M
                w_Spread(2) = sprDayTotal_4W
            End If

            'チームごとの計を再計算する。
            '--------------------------------------------------
            '   日別集計列 設定
            '--------------------------------------------------
            For w_Int = 1 To UBound(w_Spread)
                With m_Spread(w_Int).Sheets(0)
                    '--- ﾁｰﾑ別集計項目 設定 ---
                    '日別集計項目が存在するか ?
                    If UBound(m_VMtrx) > 0 Then
                        '存在する場合

                        '日別集計 情報用 配列再定義
                        If m_OuenTeam <= 0 Then
                            w_TeamCnt = m_TeamCnt
                        Else
                            w_TeamCnt = m_OuenTeam
                        End If

                        ReDim m_DayDataRow(w_TeamCnt)

                        '合計行 開始位置 設定
                        w_Row = m_StaffRow.EndRow + 1
                        w_Col = M_StaffName_Col

                        '固定Spread開始位置設定
                        w_Row2 = 0

                        '日別集計ｴﾘｱ開始行 格納
                        m_DayAreaRow.StartRow = w_Row

                        'ﾁｰﾑ数分 繰り返す
                        For w_Int2 = 1 To w_TeamCnt

                            'ﾁｰﾑ別 日別合計行 開始行番号 格納
                            m_DayDataRow(w_Int2).StartRow = w_Row

                            '固定Spread開始行番号 格納
                            m_DayDataRow(w_Int2).KoteiStartRow = w_Row2

                            '合計ﾀｲﾄﾙ等 設定
                            For w_Int3 = 1 To UBound(m_VMtrx)

                                '合計ﾀｲﾄﾙ 文字列 設定
                                w_Var = DirectCast(m_VMtrx(w_Int3).MtrxName & " " & G_TEAM_STR & "計", Object)
                                .SetText(w_Row, w_Col, w_Var)

                                '合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(m_Spread(w_Int), w_Row, w_Col, w_Row, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 設定
                                sprDayTotal_M.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                                '1ｹ月固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(sprDayTotal_M, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '4週固定Spread合計ﾀｲﾄﾙ 文字列 設定
                                sprDayTotal_4W.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                                '4週固定Spread合計ﾀｲﾄﾙ 文字列 表示位置/背景色 設定
                                Call SubSetStyle(sprDayTotal_4W, w_Row2, w_Col, w_Row2, w_Col, 0, 0, , SystemColors.Control, CellHorizontalAlignment.Center)

                                '次の行番号 設定
                                w_Row = w_Row + 1
                                w_Row2 = w_Row2 + 1
                            Next w_Int3

                            'ﾁｰﾑ別 日別合計行 終了行番号 格納
                            m_DayDataRow(w_Int2).EndRow = w_Row - 1

                            '固定Spread終了行番号 格納
                            m_DayDataRow(w_Int2).KoteiEndRow = w_Row2 - 1
                        Next w_Int2
                    Else
                        '存在しない場合
                        'ﾁｰﾑ別 合計行 情報用 配列再定義
                        ReDim m_DayDataRow(0)
                    End If
                End With
            Next w_Int

            w_intSelLine = 0
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PackageFLG <> 0 Then
                '勤務変更 又は (計画新規 or 計画変更で届出か日当直を使用してる) 画面の時
                For w_Loop = 0 To 3
                    If m_lstmnuKinmuView(w_Loop).Available Then
                        If m_lstmnuKinmuView(w_Loop).Checked Then
                            w_intSelLine = w_Loop + 1
                        End If
                    End If
                Next w_Loop
            Else
                '計画新規 or 計画変更で届出も日当直も使用していない 画面の時
                w_intSelLine = 1
            End If

            '対象ﾃﾞｰﾀ
            Select Case p_ListIndex
                Case 0
                    '==============================
                    '       すべて 選択時
                    '==============================
                    '全ﾃﾞｰﾀ行数情報 設定
                    m_ViewRow.StartRow = m_StaffRow.StartRow
                    m_ViewRow.EndRow = m_StaffRow.EndRow

                    m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(p_ListIndex, w_intSelLine) + 2
                    If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight
                    m_DayTotalHeight = m_CtrlSize(m_FontIndex).NormalModeDayTotalHeight

                    For w_Int = 1 To UBound(m_Spread)
                        With m_Spread(w_Int).Sheets(0)

                            '職員ﾃﾞｰﾀを全て表示
                            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                If .GetRowHeight(w_Row) = 0 Then
                                    '非表示のとき
                                    .SetRowHeight(w_Row, m_CellHeight)
                                End If
                            Next w_Row

                            '日別集計行
                            If UBound(m_VMtrx) > 0 Then
                                '日別集計があるとき
                                'ﾁｰﾑ合計行 非表示
                                For w_Row = m_DayDataRow(1).StartRow To m_DayDataRow(UBound(m_DayDataRow)).EndRow
                                    If .GetRowHeight(w_Row) > 0 Then
                                        '表示中のとき
                                        .SetRowHeight(w_Row, 0)
                                    End If
                                Next w_Row
                            End If
                        End With
                    Next w_Int

                    For w_Int = 1 To UBound(w_Spread)
                        With w_Spread(w_Int).Sheets(0)
                            If UBound(m_VMtrx) > 0 Then
                                '日別集計があるとき
                                '対象ﾁｰﾑNoの合計行のみ 表示
                                For w_Row = m_DayDataRow(1).KoteiStartRow To m_DayDataRow(UBound(m_DayDataRow)).KoteiEndRow
                                    If .GetRowHeight(w_Row) > 0 Then
                                        '表示中のとき
                                        .SetRowHeight(w_Row, 0)
                                    End If
                                Next w_Row
                            End If
                        End With
                    Next w_Int

                    With sprPTotal.Sheets(0)
                        '職員ﾃﾞｰﾀを全て表示
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If .GetRowHeight(w_Row) = 0 Then                            '非表示のとき
                                .SetRowHeight(w_Row, m_CellHeight)
                            End If
                        Next w_Row
                    End With

                    'ｿｰﾄ実行
                    Call RunSort(True)

                Case Else
                    '==============================
                    '       ﾁｰﾑ 選択時
                    '==============================
                    m_MaxMainHeight = m_CtrlSize(m_FontIndex).DataAreaMaxHeight(p_ListIndex, w_intSelLine) + 2
                    If m_GyoujiFlg Then m_MaxMainHeight += m_gyoujiHeight
                    m_DayTotalHeight = m_CtrlSize(m_FontIndex).TeamModeDayTotalHeight

                    With sprSheet_M.Sheets(0)

                        '１番目のｿｰﾄｷｰ設定
                        ReDim w_StaffZokusei(1)
                        ReDim w_SortOrder(1)
                        w_StaffZokusei(1) = M_Team
                        w_SortOrder(1) = True
                        m_ViewRow.StartRow = m_StaffRow.StartRow
                        m_ViewRow.EndRow = m_StaffRow.EndRow
                        'ｿｰﾄ実行
                        Call RunSort(False, w_StaffZokusei, w_SortOrder)

                        w_StartRowFlg = False
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            'ﾁｰﾑNo取得
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                            If w_Var = "" Then
                                '取得できないとき
                                w_Var = 1
                            End If

                            If p_ListIndex = Integer.Parse(w_Var) Then
                                '選択ﾁｰﾑ番号と取得したﾁｰﾑ番号が同じとき

                                If w_StartRowFlg = False Then
                                    '対象ﾁｰﾑの開始行取得
                                    m_ViewRow.StartRow = w_Row

                                    w_StartRowFlg = True
                                End If

                                '対象ﾁｰﾑの終了行取得
                                m_ViewRow.EndRow = w_Row
                            End If
                        Next w_Row
                    End With

                    If w_StartRowFlg = False Then
                        '--------------------
                        '   存在しない場合
                        '--------------------
                        m_ViewRow.StartRow = 0
                        m_ViewRow.EndRow = -1

                        For w_Int = 1 To UBound(m_Spread)
                            With m_Spread(w_Int).Sheets(0)
                                'データ行をすべて非表示
                                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                    If .GetRowHeight(w_Row) > 0 Then
                                        '表示中のとき
                                        .SetRowHeight(w_Row, 0)
                                    End If
                                Next w_Row

                                If UBound(m_VMtrx) > 0 Then
                                    '日別集計があるとき
                                    '対象ﾁｰﾑNoの合計行のみ 表示
                                    For w_Row = m_DayDataRow(1).StartRow To m_DayDataRow(UBound(m_DayDataRow)).EndRow
                                        If m_DayDataRow(p_ListIndex).StartRow <= w_Row AndAlso w_Row <= m_DayDataRow(p_ListIndex).EndRow Then
                                            '対象ﾁｰﾑNoのとき
                                            If .GetRowHeight(w_Row) = 0 Then
                                                '非表示の場合
                                                .SetRowHeight(w_Row, m_CellHeight)
                                            End If
                                        Else
                                            '対象ﾁｰﾑ以外のとき
                                            If .GetRowHeight(w_Row) > 0 Then
                                                '表示中の場合
                                                .SetRowHeight(w_Row, 0)
                                            End If
                                        End If
                                    Next w_Row
                                End If
                            End With
                        Next w_Int

                        For w_Int = 1 To UBound(w_Spread)
                            With w_Spread(w_Int).Sheets(0)
                                If UBound(m_VMtrx) > 0 Then
                                    '日別集計があるとき
                                    '対象ﾁｰﾑNoの合計行のみ 表示
                                    For w_Row = m_DayDataRow(1).KoteiStartRow To m_DayDataRow(UBound(m_DayDataRow)).KoteiEndRow
                                        If m_DayDataRow(p_ListIndex).KoteiStartRow <= w_Row AndAlso w_Row <= m_DayDataRow(p_ListIndex).KoteiEndRow Then
                                            '対象ﾁｰﾑNoのとき
                                            If .GetRowHeight(w_Row) = 0 Then
                                                '非表示の場合
                                                .SetRowHeight(w_Row, m_CellHeight)
                                            End If
                                        Else
                                            '対象ﾁｰﾑ以外のとき
                                            If .GetRowHeight(w_Row) > 0 Then
                                                '表示中の場合
                                                .SetRowHeight(w_Row, 0)
                                            End If
                                        End If
                                    Next w_Row
                                End If
                            End With
                        Next w_Int

                        With sprPTotal.Sheets(0)
                            'データ行をすべて非表示
                            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                If .GetRowHeight(w_Row) > 0 Then
                                    '表示中のとき
                                    .SetRowHeight(w_Row, 0)
                                End If
                            Next w_Row
                        End With

                        'ﾒｯｾｰｼﾞ表示
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "対象チームに所属する職員データ"
                        Call Set_MsgZOrder("NS0008", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    Else
                        '--------------------
                        '   存在する場合
                        '--------------------
                        For w_Int = 1 To UBound(m_Spread)
                            With m_Spread(w_Int).Sheets(0)
                                '対象ﾁｰﾑNOのﾃﾞｰﾀのみ 表示
                                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                    If m_ViewRow.StartRow <= w_Row AndAlso w_Row <= m_ViewRow.EndRow Then
                                        '対象ﾁｰﾑ行のとき
                                        If .GetRowHeight(w_Row) = 0 Then
                                            '非表示の場合
                                            .SetRowHeight(w_Row, m_CellHeight)
                                        End If
                                    Else
                                        If .GetRowHeight(w_Row) > 0 Then
                                            '表示中の場合
                                            .SetRowHeight(w_Row, 0)
                                        End If
                                    End If
                                Next w_Row

                                If UBound(m_VMtrx) > 0 Then
                                    '日別集計があるとき
                                    '対象ﾁｰﾑNoの合計行のみ 表示
                                    For w_Row = m_DayDataRow(1).StartRow To m_DayDataRow(UBound(m_DayDataRow)).EndRow
                                        If m_DayDataRow(p_ListIndex).StartRow <= w_Row AndAlso w_Row <= m_DayDataRow(p_ListIndex).EndRow Then
                                            '対象ﾁｰﾑNoのとき
                                            If .GetRowHeight(w_Row) = 0 Then
                                                '非表示の場合
                                                .SetRowHeight(w_Row, m_CellHeight)
                                            End If
                                        Else
                                            '対象ﾁｰﾑ以外のとき
                                            If .GetRowHeight(w_Row) > 0 Then
                                                '表示中の場合
                                                .SetRowHeight(w_Row, 0)
                                            End If
                                        End If
                                    Next w_Row
                                End If
                            End With
                        Next w_Int

                        For w_Int = 1 To UBound(w_Spread)
                            With w_Spread(w_Int).Sheets(0)
                                If UBound(m_VMtrx) > 0 Then
                                    '日別集計があるとき
                                    '対象ﾁｰﾑNoの合計行のみ 表示
                                    For w_Row = m_DayDataRow(1).KoteiStartRow To m_DayDataRow(UBound(m_DayDataRow)).KoteiEndRow
                                        If m_DayDataRow(p_ListIndex).KoteiStartRow <= w_Row AndAlso w_Row <= m_DayDataRow(p_ListIndex).KoteiEndRow Then
                                            '対象ﾁｰﾑNoのとき
                                            If .GetRowHeight(w_Row) = 0 Then
                                                '非表示の場合
                                                .SetRowHeight(w_Row, m_CellHeight)
                                            End If
                                        Else
                                            '対象ﾁｰﾑ以外のとき
                                            If .GetRowHeight(w_Row) > 0 Then
                                                '表示中の場合
                                                .SetRowHeight(w_Row, 0)
                                            End If
                                        End If
                                    Next w_Row
                                End If
                            End With
                        Next w_Int

                        With sprPTotal.Sheets(0)
                            '対象ﾁｰﾑNOのﾃﾞｰﾀのみ 表示
                            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                If m_ViewRow.StartRow <= w_Row AndAlso w_Row <= m_ViewRow.EndRow Then
                                    '対象ﾁｰﾑ行のとき
                                    If .GetRowHeight(w_Row) = 0 Then
                                        '非表示の場合
                                        .SetRowHeight(w_Row, m_CellHeight)
                                    End If
                                Else
                                    If .GetRowHeight(w_Row) > 0 Then
                                        '表示中の場合
                                        .SetRowHeight(w_Row, 0)
                                    End If
                                End If
                            Next w_Row
                        End With

                        '選択されているチームの最大高さ取得
                        w_VisibleCellCnt = 4
                        For w_DataAreaLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If p_ListIndex = 0 Then
                                sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, m_CellHeight)
                                w_VisibleCellCnt = w_VisibleCellCnt + 1
                            Else
                                w_Var = sprSheet_M.Sheets(0).GetText(w_DataAreaLoop, m_StaffZokusei(M_Team).SetCol_M)
                                If w_Var <> "" Then
                                    If IsNumeric(w_Var) = False Then
                                        sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                    Else
                                        w_Team = Integer.Parse(w_Var)
                                        If p_ListIndex = w_Team Then
                                            sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, m_CellHeight)
                                            w_VisibleCellCnt = w_VisibleCellCnt + 1
                                        Else
                                            sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                        End If
                                    End If
                                Else
                                    w_Team = 0
                                    sprSheet_M.Sheets(0).SetRowHeight(w_DataAreaLoop, 0)
                                End If
                            End If
                        Next w_DataAreaLoop

                        w_VisibleRow_St = 0
                        w_VisibleRow_Ed = m_StaffRow.EndRow
                        w_sngHeight = 0
                        For w_RowLoop = w_VisibleRow_St To w_VisibleRow_Ed
                            If w_RowLoop <> M_YYYYMMDDLabel_Row Then
                                w_sngHeight = w_sngHeight + sprSheet_M.Sheets(0).GetRowHeight(w_RowLoop)
                            End If
                        Next
                        sprSheet_M.Height = w_sngHeight
                        m_CtrlSize(m_FontIndex).DataAreaMaxHeight(p_ListIndex, w_intSelLine) = w_sngHeight

                        '日別集計
                        sprDayTotal_M.Sheets(0).SetRowHeight(-1, 0)
                        '全体表示時の固定集計の高さ
                        For w_CalcLoop = 0 To UBound(m_VMtrx) - 1
                            sprDayTotal_M.Sheets(0).SetRowHeight(w_CalcLoop, m_CellHeight)
                        Next w_CalcLoop

                        w_VisibleRow_St = 0
                        If UBound(m_VMtrx) > m_lngRowFrozen Then
                            w_VisibleRow_Ed = m_lngRowFrozen - 1
                        Else
                            w_VisibleRow_Ed = UBound(m_VMtrx) - 1
                        End If
                        w_sngHeight = 0
                        For w_RowLoop = w_VisibleRow_St To w_VisibleRow_Ed
                            w_sngHeight = w_sngHeight + sprDayTotal_M.Sheets(0).GetRowHeight(w_RowLoop)
                        Next
                        sprDayTotal_M.Height = w_sngHeight + 18
                        m_CtrlSize(m_FontIndex).NormalModeDayTotalHeight = w_sngHeight + 18

                        If w_TeamCnt > 1 Then
                            'ﾁｰﾑ毎表示時の固定集計の高さ
                            For w_CalcLoop = UBound(m_VMtrx) To UBound(m_VMtrx) * 2 - 1
                                sprDayTotal_M.Sheets(0).SetRowHeight(w_CalcLoop, m_CellHeight)
                            Next w_CalcLoop

                            If UBound(m_VMtrx) > m_lngRowFrozen Then
                                w_VisibleRow_Ed = m_lngRowFrozen * 2 - 1
                            Else
                                w_VisibleRow_Ed = Integer.Parse(UBound(m_VMtrx)) * 2 - 1
                            End If
                            w_sngHeight = 0
                            For w_RowLoop = w_VisibleRow_St To w_VisibleRow_Ed
                                w_sngHeight = w_sngHeight + sprDayTotal_M.Sheets(0).GetRowHeight(w_RowLoop)
                            Next
                            sprDayTotal_M.Height = w_sngHeight + 18
                            m_CtrlSize(m_FontIndex).TeamModeDayTotalHeight = w_sngHeight + 18
                        End If

                        'ﾁｰﾑごとにソート後、現在のソート情報でソートする
                        Call RunSort(True)
                    End If
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '表示順名変更時の職員再表示
    Private Sub HyoujijunMeiPickUpData(ByVal p_ListIndex As Integer)
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_SprLoop As Integer
        Dim w_Var As Object
        Dim w_DataIndex As Integer
        Dim w_StaffID As String
        Dim w_Rs As ADODB.Recordset
        Dim w_objStaffID As Object
        Dim w_objStaffViewNo As Object
        Dim w_objTeam As Object
        Dim w_objAutoKbn As Object
        Dim w_objGiryoLvCD As Object
        Dim w_objGiryoBunruiCD As Object
        Dim w_objGiryoViewNO As Object
        Dim w_objSyokaiYMDHN As Object
        Dim w_objSaisyuYMDHN As Object
        Dim w_objYakinKBN As Object
        Dim w_objPatternCD As Object
        Dim w_Int As Integer
        Dim w_objProcessForm As Object
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        Const W_SUBNAME As String = "NSK0000HA HyoujijunMeiPickUpData"

        Try
            Static w_NotFirstFlg As Boolean

            Dim w_i As Short
            Dim w_Index As Short

            '選択リスト取得
            w_Index = cmbHyoujijunMei.SelectedIndex
            If w_Index = -1 Then
                Exit Sub
            End If

            For w_i = 1 To UBound(m_HyoujijunMeiDate)
                If cmbHyoujijunMei.Text = m_HyoujijunMeiDate(w_i).HName Then
                    Exit For
                End If
            Next w_i

            '前回と同じIndexなら処理を行わない
            If m_HyoujijunMeiIdx = w_Index + 1 AndAlso w_NotFirstFlg = True Then
                Exit Sub
            End If

            '表示名称ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ
            m_HyoujijunMeiIdx = w_Index + 1

            'With w_Rs
            w_objStaffID = m_Staff_ID
            w_DataCnt = UBound(w_objStaffID)

            '表示順名インデックスに対応した表示Noを取得
            If m_HyoujijunMeiIdx >= 1 Then
                Select Case m_HyoujijunMeiIdx
                    Case 1
                        w_objStaffViewNo = m_StaffNo1
                    Case 2
                        w_objStaffViewNo = m_StaffNo2
                    Case 3
                        w_objStaffViewNo = m_StaffNo3
                    Case 4
                        w_objStaffViewNo = m_StaffNo4
                    Case 5
                        w_objStaffViewNo = m_StaffNo5
                End Select
            End If

            'w_StaffViewNo_F = .Fields("職員表示")
            w_objTeam = m_StaffTeam
            w_objYakinKBN = m_StaffYakinKBN
            w_objPatternCD = m_StaffPatternCD
            w_objAutoKbn = m_StaffAutoKBN
            w_objGiryoLvCD = m_StaffGiryoLvCD
            w_objGiryoBunruiCD = m_StaffGiryoBunruiCD
            w_objGiryoViewNO = m_StaffGiryoHyojiNo
            w_objSyokaiYMDHN = m_StaffSyokai
            w_objSaisyuYMDHN = m_StaffSaisyu

            '処理経過画面設定
            w_objProcessForm = New frmNSK0000HM
            w_objProcessForm.pMaxValue = w_DataCnt

            '取得ﾃﾞｰﾀ件数分Loop
            For w_DataLoop = 1 To w_DataCnt

                '職員管理番号取得
                w_StaffID = w_objStaffID(w_DataLoop)

                'ｽﾌﾟﾚｯﾄﾞのﾃﾞｰﾀ行分Loop
                For w_SprLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If (w_SprLoop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                        '配列Indexを取得する
                        w_Var = sprSheet_M.Sheets(0).GetText(w_SprLoop, m_StaffZokusei(M_HairetuNo).SetCol_M)

                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then

                                'ﾃﾞｰﾀIndexを取得する
                                w_DataIndex = Integer.Parse(w_Var)

                                If w_StaffID = m_StaffData(w_DataIndex).ID Then

                                    'ﾃﾞｰﾀ格納配列変数値変更
                                    m_StaffData(w_DataIndex).HyojiNo = IIf(IsDBNull(w_objStaffViewNo(w_DataLoop)), 999, w_objStaffViewNo(w_DataLoop))
                                    m_StaffData(w_DataIndex).Team = IIf(IsDBNull(w_objTeam(w_DataLoop)), 1, w_objTeam(w_DataLoop))
                                    m_StaffData(w_DataIndex).AutoKBN = w_objAutoKbn(w_DataLoop) & ""
                                    m_StaffData(w_DataIndex).GiryoLvCD = w_objGiryoLvCD(w_DataLoop) & ""
                                    m_StaffData(w_DataIndex).GiryoBunruiCD = w_objGiryoBunruiCD(w_DataLoop) & ""
                                    m_StaffData(w_DataIndex).GiryoHyojiNo = IIf(IsDBNull(w_objGiryoViewNO(w_DataLoop)), 1, w_objGiryoViewNO(w_DataLoop))
                                    m_StaffData(w_DataIndex).YakinKBN = IIf(IsDBNull(w_objYakinKBN(w_DataLoop)), "1", w_objYakinKBN(w_DataLoop))
                                    m_StaffData(w_DataIndex).PatternCD = IIf(IsDBNull(w_objPatternCD(w_DataLoop)), "", w_objPatternCD(w_DataLoop))

                                    If m_YakanKangoDispFlg = 0 Then
                                        '職員の看護加算用データ取得
                                        Call Get_YakanKangoData(w_DataIndex)
                                    End If

                                    '*************************************************
                                    '   職員情報設定画面引き渡し用
                                    '*************************************************
                                    For w_Int = 1 To UBound(m_Staff_ID)
                                        If m_Staff_ID(w_Int) = m_StaffData(w_DataIndex).ID Then
                                            '更新後の職員情報の格納
                                            m_StaffTeam(w_Int) = DirectCast(m_StaffData(w_DataIndex).Team, Object) 'Team
                                            m_StaffGiryoLvCD(w_Int) = DirectCast(m_StaffData(w_DataIndex).GiryoLvCD, Object) 'SkillLvlCD
                                            m_StaffAutoKBN(w_Int) = DirectCast(m_StaffData(w_DataIndex).AutoKBN, Object) 'AutoAllocKbn
                                            m_StaffSyokai(w_Int) = IIf(IsDBNull(w_objSyokaiYMDHN(w_DataLoop)), 0, w_objSyokaiYMDHN(w_DataLoop)) 'RegistFirstTimeDate
                                            m_StaffSaisyu(w_Int) = IIf(IsDBNull(w_objSaisyuYMDHN(w_DataLoop)), 0, w_objSaisyuYMDHN(w_DataLoop)) 'LastUpdTimeDate
                                            m_StaffData(w_Int).UpdateFlg = M_DataFlg_GaitoPlanNoData '職員情報格納配列に更新ﾌﾗｸﾞを格納
                                            m_StaffKousinFlg(w_Int) = DirectCast(m_StaffData(w_DataIndex).UpdateFlg, Object) '更新ﾌﾗｸﾞ
                                            m_StaffNo(w_Int) = DirectCast(m_StaffData(w_DataIndex).HyojiNo, Object) 'DispNo
                                            m_StaffYakinKBN(w_Int) = DirectCast(m_StaffData(w_DataIndex).YakinKBN, Object) '夜勤専従者区分
                                            m_StaffPatternCD(w_Int) = DirectCast(m_StaffData(w_DataIndex).PatternCD, Object) 'パターンコード
                                        End If
                                    Next w_Int

                                    'ｽﾌﾟﾚｯﾄﾞの格納ﾃﾞｰﾀ変更（１ヶ月、４週、個人別集計）
                                    For w_Int = 0 To m_MaxShowLine - 1
                                        '表示№
                                        w_Var = m_StaffData(w_DataIndex).HyojiNo

                                        Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_M, w_Var)
                                        Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_4W, w_Var)
                                        Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_StaffHyojiNo).SetCol_PTotal, w_Var)
                                        'Team
                                        Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_M, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                        Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_4W, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                        Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_Team).SetCol_PTotal, DirectCast(m_StaffData(w_DataIndex).Team, Object))
                                        '技量表示№
                                        Call sprSheet_M.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_M, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                        Call sprSheet_4W.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_4W, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                        Call sprPTotal.Sheets(0).SetText(w_SprLoop + w_Int, m_StaffZokusei(M_GiryoHyojiNo).SetCol_PTotal, DirectCast(m_StaffData(w_DataIndex).GiryoHyojiNo, Object))
                                    Next w_Int

                                    '技量、自動割当区分による色分け変更
                                    If m_StaffData(w_DataIndex).AutoKBN = "1" Then
                                        '自動割当対象（経験区分による色分け）
                                        Select Case m_StaffData(w_DataIndex).GiryoBunruiCD
                                            Case "1" 'ﾘｰﾀﾞｰ
                                                w_BackColor = ColorTranslator.FromOle(m_Leader_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_Leader_Fore)
                                            Case "2" 'ｻﾌﾞﾘｰﾀﾞｰ
                                                w_BackColor = ColorTranslator.FromOle(m_SubLeader_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_SubLeader_Fore)
                                            Case "3" 'ｽﾀｯﾌ
                                                w_BackColor = ColorTranslator.FromOle(m_Staff_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_Staff_Fore)
                                            Case "4" '新人
                                                w_BackColor = ColorTranslator.FromOle(m_NewFace_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_NewFace_Fore)
                                            Case Else '設定不備（エラーとする）
                                                w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                                w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                        End Select
                                    Else
                                        '自動割当非対象（カレンダー通りの勤務）
                                        w_BackColor = ColorTranslator.FromOle(m_NoAssign_Back)
                                        w_ForeColor = ColorTranslator.FromOle(m_NoAssign_Fore)
                                    End If

                                    If m_MaxShowLine > 1 Then
                                        sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                                        sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                                        sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).BackColor = w_BackColor
                                        sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col, w_SprLoop + m_MaxShowLine - 1, M_StaffName_Col).ForeColor = w_ForeColor
                                    Else
                                        sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).BackColor = w_BackColor
                                        sprSheet_M.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).ForeColor = w_ForeColor
                                        sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).BackColor = w_BackColor
                                        sprSheet_4W.Sheets(0).Cells(w_SprLoop, M_StaffName_Col).ForeColor = w_ForeColor
                                    End If

                                    Exit For ' ---> w_SprLoop抜け出し
                                End If ' ---> 検索ｽﾀｯﾌ？
                            End If ' ---> 取得ｽﾌﾟﾚｯﾄﾞﾃﾞｰﾀは数値？
                        End If ' ---> 配列Index取得できた？
                    End If
                Next w_SprLoop

                '.MoveNext()

                '処理経過ｶｳﾝﾄ
                w_objProcessForm.pCountValue = w_DataLoop
            Next w_DataLoop ' ---> 取得ﾃﾞｰﾀ件数分Loop

            'ﾁｰﾑ別の更新
            Call PickUpData(m_SelTeamNo)

            '自画面表示
            Me.Show()
            w_objProcessForm.Close()
            w_objProcessForm = Nothing

            'ｾﾙの再設定を行う。
            Call Set_SpreadAdd()

            '選択セルとスクロール位置設定
            Call Set_KeikakuFirstCell()

            '変更ﾃﾞｰﾀで再ソートする
            Call RunSort(True)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub frmNSK0000HA_Load(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Load
        Dim endTime As Date
        Dim startTime As Date
        Dim str As String = Application.StartupPath
        startTime = DateTime.Now
        Const W_SUBNAME As String = "NSK0000HA Form_Load"

        Dim w_Flg As Boolean
        Dim w_MsgRc As Integer
        Dim w_strSubKey As String
        Dim w_str As String
        Dim w_varWork As Object
        Dim w_varWork1 As Object
        Dim w_cnt As Integer
        Dim w_tmpCd As String
        Dim w_idx As Integer
        Dim w_Int As Integer
        Dim w_strMsg() As String = Nothing
        Try
            '2016/04/05 Ishiga add start--------
            '初期化
            m_UndoIdx = 0
            m_UndoIdxHendou = 0
            m_UndoKaisu = 0
            m_RedoCnt = 0
            m_FirstFlg = True
            '2016/04/05 Ishiga add end----------
            g_ImagePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ImagePath", My.Application.Info.DirectoryPath & "\" & "image\")
            Me.Icon = New Icon(g_ImagePath & G_FORM_ICO)

            m_blnLoadErr = False

            g_SaikeiFlg = False '常にFalseです（消すと影響箇所が多いのでとりあえず対応）

            'ﾊﾟﾚｯﾄ画面のｲﾝｽﾀﾝｽ宣言
            m_PaletteForm = New frmNSK0000HB
            '検索画面のｲﾝｽﾀﾝｽ宣言
            m_KensakuForm = New frmNSK0000HD
            '置換画面のｲﾝｽﾀﾝｽ宣言
            m_ChikanForm = New frmNSK0000HD
            '並び替え画面のｲﾝｽﾀﾝｽ宣言
            m_SortForm = New frmNSK0000HG
            '行事一覧画面のｲﾝｽﾀﾝｽ宣言
            m_EventForm = New frmNSK0000HO

            'スプレッドのキーマップ変更
            Call subChgSpreadKeyMap()

            Call subSetCtlList()

            'ﾚｼﾞｽﾄﾘよりｲﾝｽﾄｰﾙﾀｲﾌﾟを取得
            General.g_InstallType = Integer.Parse(General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "InstallType", Convert.ToString(General.gInstall_Enum.AccessType_PassThrough)))

            '2012/11/16 Ishiga del start-----------------------------------------------------------------------------------
            ''Sumiya Add 2012/11/09 Start ---アクセスログ使用フラグを取得する---***********************************
            'm_strUseAccessLog = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "ACCESSLOG", 0)
            ''Sumiya Add 2012/11/09  End  ---*******************************************************************---
            '2012/11/16 Ishiga del end-------------------------------------------------------------------------------------

            '--- 起動元画面からのﾃﾞｰﾀをコマンドで取得する ---
            If Not Command() = "" Then
                'その他での再送の場合
                w_str = Command()

                w_varWork = General.paSplit(w_str, ",")

                For w_Int = 0 To UBound(w_varWork)
                    Select Case w_Int
                        Case 0 '施設CD
                            General.g_strHospitalCD = w_varWork(w_Int)
                        Case 1 '利用者ID
                            General.g_strUserID = w_varWork(w_Int)
                        Case 2 '利用者名称
                            General.g_strUserName = w_varWork(w_Int)
                        Case 3 '利用者職員管理番号
                            General.g_strUserMngID = w_varWork(w_Int)
                        Case 4 '利用者グループコード
                            General.g_strUserGroupCD = w_varWork(w_Int)
                        Case 5 '利用者所属勤務部署コード
                            General.g_strUserKinmuDeptCD = w_varWork(w_Int)
                        Case 6 '選択勤務部署コード
                            General.g_strSelKinmuDeptCD = w_varWork(w_Int)
                        Case 7 '計画番号
                            m_PlanNo = w_varWork(w_Int)
                        Case 8 '起動モード
                            m_PgmFlg = w_varWork(w_Int)
                        Case 9 '呼出元画面
                            m_strAccessModule = w_varWork(w_Int)
                        Case 10
                            g_HopeMode = w_varWork(w_Int)
                            '2017/11/08 Angelo add st----------------------------------------------------------
                        Case 11 '保存番号
                            m_intSelSaveNo = Short.Parse(w_varWork(w_Int))
                            '2017/11/08 Angelo add en----------------------------------------------------------
                    End Select
                Next w_Int
            End If

            'データベース 接続開始
            Call General.paConnect()
            '2012/11/16 Ishiga add start-----------------------------------------------------------------------------------
            '取得処理をデータベース接続する前に取得していてエラーになっていたので場所を変更
            m_strUseAccessLog = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "ACCESSLOG", 0)
            '2012/11/16 Ishiga add end-------------------------------------------------------------------------------------

            '2014/04/23 Saijo add start P-06979------------------------------
            '勤務記号全角２文字対応フラグ(0：対応しない、1:対応する)
            m_strKinmuEmSecondFlg = Get_ItemValue(General.g_strHospitalCD)
            '2014/04/23 Saijo add end P-06979--------------------------------

            m_lngNightStartTime = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "NIGHTSTARTTIME", "1630", General.g_strHospitalCD))
            m_lngNightEndTime = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "NIGHTENDTIME", "830", General.g_strHospitalCD))

            If Trim(General.g_strHospitalCD) = "" OrElse Trim(General.g_strSelKinmuDeptCD) = "" OrElse Trim(m_strAccessModule) = "" Then
                ReDim w_strMsg(0)
                Call Set_MsgZOrder("NS0042", w_strMsg, w_MsgRc, 0)
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If
            If IsNumeric(m_PlanNo) = True Then
                If Integer.Parse(m_PlanNo) > 0 Then
                    w_Flg = True
                End If
            End If
            If w_Flg = False Then
                ReDim w_strMsg(0)
                Call Set_MsgZOrder("NS0042", w_strMsg, w_MsgRc, 0)
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If
            If m_PgmFlg <> General.G_PGMSTARTFLG_NEWPLAN AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                ReDim w_strMsg(0)
                Call Set_MsgZOrder("NS0042", w_strMsg, w_MsgRc, 0)
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '代休管理ﾌﾗｸﾞ（0:管理する 1:管理しない）
            General.g_lngDaikyuMng = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUMNG", "1", General.g_strHospitalCD))
            '代休取得時の確認メッセージを表示するか(0:表示,1:非表示)
            m_DaikyuMsgFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUMSGFLG", Convert.ToString(0), General.g_strHospitalCD))
            '代休取得可能日に日曜日を含めるか(0:含めない,1:含める)
            m_SundayDaikyuFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "SUNDAYDAIKYUFLG", Convert.ToString(0), General.g_strHospitalCD))
            '代休先取りフラグ
            m_DaikyuAdvFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUADVANCEFLG", Convert.ToString(0), General.g_strHospitalCD))

            '1.5日分の代休が発生する勤務ＣＤ
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYU15KINNMUCD", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")
            ReDim m_Daikyu15KinmuCD(UBound(w_varWork) + 1)
            For w_Int = 0 To UBound(w_varWork)
                m_Daikyu15KinmuCD(w_Int + 1) = w_varWork(w_Int)
            Next w_Int

            '代休先取り当月制限フラグ
            m_DaikyuAdvThisMonthFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUADVANCETHISMONTHFLG", Convert.ToString(0), General.g_strHospitalCD))

            '夜勤時間計算結果の表示FLG
            m_YakanKangoDispFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "YAKANKANGODISPFLG", Convert.ToString(1), General.g_strHospitalCD))

            '2016/04/21 Yamanishi Add ----------------------------------------------------------------------------------------------------
            'H28年度版以降様式９使用FLG
            m_Youshiki9_H28_Flg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "YOUSHIKI9H28FLG", "1", General.g_strHospitalCD))
            '初期化
            m_NotCalcTotalNightKojyoCD = ""
            If m_Youshiki9_H28_Flg = 1 Then
                m_DefaltTodokedeKbn = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "DEFALTTODOKEDEKBN", "7", General.g_strHospitalCD))
                m_OuenTotalNightFullFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "OUENTOTALNIGHTFULLFLG", "0", General.g_strHospitalCD))
                '夜勤総時間を減算しない控除ＣＤ
                w_str = General.paGetItemValue(General.G_STRMAINKEY10, General.G_STRSUBKEY1, "NOTCALCTOTALNIGHTKOJYOCD", "", General.g_strHospitalCD)
                w_varWork = General.paSplit(w_str, ",")
                For w_Int = 0 To UBound(w_varWork)
                    m_NotCalcTotalNightKojyoCD = m_NotCalcTotalNightKojyoCD & General.paFormatSpace(w_varWork(w_Int), 10) & ","
                Next w_Int
            Else
                m_DefaltTodokedeKbn = 0
            End If
            '-----------------------------------------------------------------------------------------------------------------------------

            '代休取得可能日に土曜日を含めるか(0:含めない,1:含める)
            m_SaturdayDaikyuFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "SATURDAYDAIKYUFLG", Convert.ToString(0), General.g_strHospitalCD))

            '代休集計基準日（0：月初、1：月末、以外：月初）
            m_DaikyuSumBasiDate = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUSUMBASIDate.Parse", Convert.ToString(0), General.g_strHospitalCD))

            '1:ワーニング　以外:エラー
            g_KibouNumDiaLogFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "KIBOUNUMDIALOGFLG", Convert.ToString(0), General.g_strHospitalCD))

            '起動ﾓｰﾄﾞによりフォームのIDを変更
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                g_AppName = "NSK0001H"
                w_strSubKey = General.G_STRSUBKEY9
            Else
                g_AppName = "NSK0000H"
                w_strSubKey = General.G_STRSUBKEY8
            End If

            '個人別集計の表示形式（既定は小数点）
            m_PersonalTotalSet = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "SUMTYPE", Convert.ToString(1), General.g_strHospitalCD))
            '月平均夜勤時間数の基準時間（基準時間より低い場合はテキストを赤く表示）
            m_AveNightTime = Double.Parse(General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "AVENIGHTTIME", Convert.ToString(0), General.g_strHospitalCD))
            m_lngColFrozen = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "COLFROZEN", Convert.ToString(5), General.g_strHospitalCD))
            m_lngRowFrozen = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "ROWFROZEN", Convert.ToString(5), General.g_strHospitalCD))
            'ソート情報を取得
            m_SortIdx = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "KIJUNDATEFLAG", Convert.ToString(0), General.g_strHospitalCD))
            '集計対象外職種CD取得
            m_NotCntJobCD = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "NOTSUMJOB", "", General.g_strHospitalCD)

            '2013/07/10 Bando Add Start ==============================================================
            w_varWork = General.paSplit(m_NotCntJobCD, ",")
            '一度初期化した後に"@@@"にフォーマットされたデータを再度格納
            m_NotCntJobCD = ""
            For w_Int = 0 To UBound(w_varWork)
                m_NotCntJobCD = m_NotCntJobCD & General.paFormatSpace(w_varWork(w_Int), 10) & ","
            Next w_Int
            '2013/07/10 Bando Add End   ==============================================================

            '集計対象外役職CD取得
            m_NotCntPostCD = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "NOTSUMPOST", "", General.g_strHospitalCD)

            '2013/07/10 Bando Add Start ==============================================================
            w_varWork = General.paSplit(m_NotCntPostCD, ",")
            '一度初期化した後に"@@@"にフォーマットされたデータを再度格納
            m_NotCntPostCD = ""
            For w_Int = 0 To UBound(w_varWork)
                m_NotCntPostCD = m_NotCntPostCD & General.paFormatSpace(w_varWork(w_Int), 10) & ","
            Next w_Int
            '2013/07/10 Bando Add End   ==============================================================

            '小数設定
            For w_Int = 1 To 4
                w_str = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "ROUNDTYPE" & w_Int, "", General.g_strHospitalCD)
                w_varWork = General.paSplit(w_str, ";")
                If UBound(w_varWork) = 1 Then
                    m_KangoSettei(w_Int).Value1 = w_varWork(0)
                    m_KangoSettei(w_Int).Value2 = w_varWork(1)
                End If
            Next w_Int

            '応援勤務者計算FLG
            m_OuenKinmuCalcFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "OUENKINMUCALCFLG", Convert.ToString(0), General.g_strHospitalCD))
            '--- 夜専・短時間判定区分
            m_NightShortJudgeKBN = ""
            m_NightShortJudgeDay = 0
            w_str = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "NIGHTSHORTJUDGEKBN", "0", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ";")
            If w_varWork(0) = "2" Then
                '区分="2"(日数)の場合
                m_NightShortJudgeKBN = w_varWork(0)
                m_NightShortJudgeDay = w_varWork(1)
            Else
                '区分="0"(月初),区分="1"(月末)の場合
                m_NightShortJudgeKBN = w_varWork(0)
            End If
            '--- 育児短時間対象採用コード
            m_ChildShortEmpCD = ""
            w_str = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "CHILDSHORTEMPCD", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")
            For w_Int = 0 To UBound(w_varWork)
                m_ChildShortEmpCD = m_ChildShortEmpCD & General.paFormatSpace(w_varWork(w_Int), 2) & ","
            Next w_Int
            '--- 育児短時間対象短時間理由コード
            m_ChildShortReasonCD = ""
            w_str = General.paGetItemValue(General.G_STRMAINKEY10, w_strSubKey, "CHILDSHORTREASONCD", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")
            For w_Int = 0 To UBound(w_varWork)
                m_ChildShortReasonCD = m_ChildShortReasonCD & General.paFormatSpace(w_varWork(w_Int), 5) & ","
            Next w_Int
            '--- 土日背景色フラグ
            m_WeekEndColorFlg = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "WEEKENDCOLORFLG", "0", General.g_strHospitalCD)
            '--- 祝休日背景色フラグ
            m_HolidayColorFlg = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "HOLIDAYCOLORFLG", "0", General.g_strHospitalCD)
            '--- 累計開始月日
            m_SumStMMdd = General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "SUMSTMMDD", "0401", General.g_strHospitalCD)
            '--- 累計対象休暇
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "SUMHOLTIME", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")
            ReDim m_SumHolTimeData(UBound(w_varWork) + 1)
            For i As Integer = 0 To UBound(w_varWork)
                w_varWork1 = General.paSplit(w_varWork(i), ";")
                m_SumHolTimeData(i + 1).SEQ = w_varWork1(0)
                m_SumHolTimeData(i + 1).CD = w_varWork1(1)
            Next

            '--- 累計対象休暇(４週)
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "SUMHOLTIME_4W", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")
            ReDim m_SumHolTimeData_4W(UBound(w_varWork) + 1)
            For i As Integer = 0 To UBound(w_varWork)
                w_varWork1 = General.paSplit(w_varWork(i), ";")
                m_SumHolTimeData_4W(i + 1).SEQ = w_varWork1(0)
                m_SumHolTimeData_4W(i + 1).CD = w_varWork1(1)
            Next

            If m_WeekEndColorFlg <> "1" AndAlso m_HolidayColorFlg <> "1" Then
                RemoveHandler sprSheet_M.Paint, AddressOf sprSheet_M_Paint
                RemoveHandler sprSheet_4W.Paint, AddressOf sprSheet_4W_Paint
            End If

            '--- 応援控除分類CD取得
            m_strOuenKojyoCD = ""
            m_strOuenKojyoCD = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY7, "OUENKOJYOCD", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(m_strOuenKojyoCD, ",")
            '一度初期化したのちに"@@@@"にフォーマットされたデータを再度格納
            m_strOuenKojyoCD = ""
            For w_Int = 0 To UBound(w_varWork)
                m_strOuenKojyoCD = m_strOuenKojyoCD & General.paFormatSpace(w_varWork(w_Int), 10) & ","
            Next w_Int
            m_intLastSumDispFlg = General.paGetItemValue(General.G_STRMAINKEY2, g_AppName, "LASTSUMDISPFLG", 0, General.g_strHospitalCD)

            '表示対象採用条件取得
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "DISPEMPMARK", "", General.g_strHospitalCD)
            w_varWork = General.paSplit(w_str, ",")

            w_cnt = 0
            ReDim m_DispEmpMark(w_cnt)
            For i As Short = 0 To UBound(w_varWork)
                '分割位置取得
                w_idx = InStr(w_varWork(i), ";")
                If w_idx = 0 Then Continue For

                '配列拡張
                w_cnt += 1
                ReDim Preserve m_DispEmpMark(w_cnt)

                '記号
                m_DispEmpMark(w_cnt).Mark = w_varWork(i).Substring(0, w_idx - 1)
                '採用コード
                w_tmpCd = w_varWork(i).Substring(w_idx)
                w_varWork1 = General.paSplit(w_tmpCd, "+")
                w_tmpCd = ""
                For j As Short = 0 To UBound(w_varWork1)
                    w_tmpCd = w_tmpCd & General.paFormatSpace(w_varWork1(j), 5) & ","
                Next
                m_DispEmpMark(w_cnt).EmpCd = w_tmpCd
            Next

            '表示対象チェック期間
            m_dipsMarkChkKbn = 0
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "CHKTERMPOINT", "", General.g_strHospitalCD)
            If IsNumeric(w_str) Then m_dipsMarkChkKbn = Integer.Parse(w_str)

            '集計まで線を描画するフラグ
            m_sumLineDispFlg = False
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SUMLINEDISPFLG", "", General.g_strHospitalCD)
            If "1".Equals(w_str) Then m_sumLineDispFlg = True

            'スクロールバーの太さ
            m_scrollBerSize = 18
            w_str = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SCROLLBARSIZE", "", General.g_strHospitalCD)
            If IsNumeric(w_str) Then m_scrollBerSize = Short.Parse(w_str)

            '2016/04/05 Ishiga add start--------------------------------------------------------------------------------------------------------------------
            'Undo最大件数(設定されていない場合は"1")設定値より＋１加算する(初期表示時の状態を格納するため)
            m_UndoMaxKensu = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "UNDOMAXKENSU", Short.Parse(1), General.g_strHospitalCD) + 1
            '最大件数で初期化
            ReDim m_UndoArea(m_UndoMaxKensu)
            '2016/04/06 Yamanishi Add --------------------------------------------------
            For i As Integer = 0 To m_UndoMaxKensu
                ReDim m_UndoArea(i).UndoKojyo(0)
                ReDim m_UndoArea(i).UndoDaikyu(0)
            Next i
            '---------------------------------------------------------------------------
            '2016/04/05 Ishiga add end----------------------------------------------------------------------------------------------------------------------

            '職員取得部品(NSC0010C)
            General.g_objGetData = New NsAid_NSC0010C.clsStaffData
            General.g_objGetData.p病院CD = General.g_strHospitalCD

            'マスタ取得部品(NSC0050C)
            General.g_objGetMaster = New NsAid_NSC0050C.clsGetMaster
            General.g_objGetMaster.pHospitalCD = General.g_strHospitalCD

            '異動歴取得部品(NSC0060C)
            General.g_objIdoData = New NsAid_NSC0060C.clsStaffIdo
            General.g_objIdoData.pHospitalCD = General.g_strHospitalCD

            '日付設定ダイアログObject生成
            General.g_objSelectDate = New NsAid_NSC0030C.clsNusDate
            With General.g_objSelectDate
                '初期設定を行う
                .LetMaxDate = 20491231 '表示可能最大日付(YYYYMMDD・省略化)
                .LetMinDate = 19800101 '表示可能最小日付(YYYYMMDD・省略化)
                .letdefaultdate = Integer.Parse(Format(Now, "yyyyMMdd")) '初期表示日付(YYYYMMDD・省略化)
                .LetMondayPosition = 1 '左から２番目が月曜日となるように設定
                .LetHospitalCode = General.g_strHospitalCD '病院CDを設定
                .LetNurseAidFLG(True) = vbNullString 'NurseAIDのNSHOLIDAYMを参照するかどうかの設定
                .LetHolidayDataType = False '祝日をファイルから読み込むかどうか
            End With

            'セキュリティマスタ部品(NSC0000C)
            General.g_objSecurity = New NsAid_NSC0000C.clsGetSecurity
            With General.g_objSecurity
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pUserID = General.g_strUserID '利用者コード
                .pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                .pGroupCD = General.g_strUserGroupCD '利用者グループコード
                .pUserKinmuDeptCD = General.g_strUserKinmuDeptCD '利用者所属部署コード
                .pGetMasterObj = General.g_objGetMaster 'マスタ取得部品

                '所属および兼務している勤務部署コードの勤務部署マスタ情報を取得する
                If .mGetUserKinmuDeptInfo(Format(Now, "yyyyMMdd")) = False Then

                End If
            End With

            '承認関連部品(NSA0000C)
            General.g_objSyouninData = New NsAid_NSA0000C.clsAppliApprove
            With General.g_objSyouninData
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pUserID = General.g_strUserID '利用者コード
                .pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                .pGroupCD = General.g_strUserGroupCD '利用者グループコード
                .pWebFlg = False 'WEBフラグ(C/S：False　WEB:True)
                .pInstallType = General.g_InstallType 'インストールタイプ
                .pSecurityObj = General.g_objSecurity 'セキュリティ部品
                .pGetDataObj = General.g_objGetData '職員取得部品
                .pGetMasterObj = General.g_objGetMaster 'マスタ取得部品
            End With

            '2014/07/03 Ishiga add start----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            'パッケージVersion情報取得
            m_strVerPath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "Package", "")
            'DBｱｸｾｽの種別を取得する
            General.g_InstallType = Integer.Parse(General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "InstallType", Convert.ToString(General.BasGeneral.gInstall_Enum.AccessType_PassThrough)))
            '2014/07/03 Ishiga add end------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            'パッケージ情報取得
            If Get_PackageUseFLG() = False Then
                'パッケージ情報取得異常
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '施設情報取得
            If Get_HospitalData() = False Then
                '病院情報取得異常
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '勤務部署情報取得
            If Get_KinmuDeptData() = False Then
                '勤務部署情報取得異常
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '日当直グループ情報取得
            If Get_DutyGroupData() = False Then
                '日当直グループ情報取得異常
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '届出情報取得
            If Get_AppliCationData() = False Then
                '届出情報取得異常
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            '再掲病棟？
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso g_SaikeiFlg = True Then
                '勤務変更の場合で再掲病棟の場合は処理中止
                Call Set_MsgZOrder("NS0131", w_strMsg, w_MsgRc, 0)
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm()
                m_blnLoadErr = True
                Exit Sub
            End If

            ''勤務時間M取得
            'Call subGetKinmuTimeM() '2018/02/28 Yamanishi Del

            '再掲病棟の場合は計画変更モードとする（締切日も考慮しない）※ Simekiribi_SelectMode()関数にも制御あり
            '再掲病棟では、所属部署ですでに確定されている勤務に対しては再掲勤務を入力できないようにする
            '確定後、再掲勤務を変更した場合、所属病棟で新規で取り込む必要がある。そうすると勤務変更がリセットされてしまうため
            '再掲から実績ﾃﾞｰﾀを更新するのはマズイと思うので、この仕様とします。
            If g_SaikeiFlg = True Then
                m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN

                'パッケージ情報取得
                If Get_PackageUseFLG() = False Then
                    'パッケージ情報取得異常
                    Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                    Call Execute_NextPgm()
                    m_blnLoadErr = True
                    Exit Sub
                End If
            End If

            '色情報取得
            Call Get_Color()

            'Resizeイベントを起こすかどうか
            m_ResizeEventFlg = False

            If Set_SprSheet() = False Then
                Call FormUnload() 'ﾊﾟﾚｯﾄ/検索/置換画面のﾌｫｰﾑ解放
                Call Execute_NextPgm() '次画面呼び出し
                m_blnLoadErr = True
                Exit Sub
            End If

            '2014/07/03 Ishiga upd start----------------------------------
            ''行事関連部品(NSC0080C)
            'General.g_objEventDate = New NsAid_NSC0080C.clsEventData
            ''行事予定
            'Call getEventData()
            'Call setEventData()

            ReDim m_EventData(0)
            If m_strVerPath = 0 Then
                '行事関連部品(NSC0080C)
                General.g_objEventDate = New NsAid_NSC0080C.clsEventData
                '行事予定
                Call getEventData()
                Call setEventData()
            End If
            '2014/07/03 Ishiga upd end------------------------------------

            '2016/04/05 Ishiga add start----------------------------------
            '非活性の制御
            Panel1.Enabled = False
            tbrMain.Enabled = False
            MainMenu1.Enabled = False
            Me.Enabled = False

            '処理経過ﾌｫｰﾑ表示
            m_ProForm = New frmNSK0000HM
            m_ProForm.Show()
            m_ProForm.pForeColor = ColorTranslator.ToOle(Color.Purple)
            m_ProForm.pSyoriText = "表示期間作成中..."
            m_ProForm.pMaxValue = 4
            m_ProForm.pNumberDisp = False

            m_ProForm.pCountValue = 1
            System.Windows.Forms.Application.DoEvents()
            '2016/04/05 Ishiga add end------------------------------------

            '初期化
            m_blnPopupFLG = True
            m_blnPopCutFLG = True
            m_blnPopCopyFLG = True
            m_blnPopPasteFLG = True

            '利用権限の制御
            Call AccountChk()

            'ﾒﾆｭｰﾊﾞｰ、ﾂｰﾙﾊﾞｰ、ｽﾃｰﾀｽﾊﾞｰ設定
            Call Set_ToolStatusBar()

            'ﾁｰﾑ選択、計画期間選択ｺﾝﾎﾞﾎﾞｯｸｽ設定
            Call Set_ComboBoxCtrl()

            '集計固定処理用のｽﾌﾟﾚｯﾄﾞの大きさを取得する
            Call Calc_SprSize()

            '画面の初期設定（計画期間やﾌｫﾝﾄｻｲｽﾞ等のデフォルト設定）
            Call DefaultSet()

            '初期化
            ReDim g_NotStaffPatternError2(0)
            '割当勤務情報取得(禁止職員ﾊﾟﾀｰﾝのｴﾗｰﾁｪｯｸ用)
            Call GetAllocKinmu()

            'ｴﾗｰﾁｪｯｸが自動の場合ｴﾗｰﾁｪｯｸを実施する（Set_SprSheet関数では行われないため）
            If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                Call RunErrorCheck()
            End If

            '2016/04/05 Ishiga add start------------------
            m_ProForm.pCountValue = 3
            System.Windows.Forms.Application.DoEvents()
            '2016/04/05 Ishiga add end--------------------

            m_PaletteForm.pStartDate = m_KeikakuKikan.StartDate
            m_ChikanForm.pStartDate = m_KeikakuKikan.StartDate
            m_KensakuForm.pStartDate = m_KeikakuKikan.StartDate

            'ﾊﾟﾚｯﾄ画面をLoadする
            m_PaletteForm.pPgmFlg = m_PgmFlg
            Call m_PaletteForm.frmNSK0000HB_Load()
            '検索画面をLoadする
            m_KensakuForm.pKenChiFlg = BasNSK0000H.geKenChiFlg.FormType_Kensaku
            m_KensakuForm.pPgmFlg = m_PgmFlg
            m_KensakuForm.frmNSK0000HD_Load()
            '置換画面をLoadする
            m_ChikanForm.pKenChiFlg = BasNSK0000H.geKenChiFlg.FormType_Chikan
            m_ChikanForm.pPgmFlg = m_PgmFlg
            m_ChikanForm.frmNSK0000HD_Load()
            '並び替え画面をLoadする

            Call m_SortForm.frmNSK0000HG_Load()

            '2016/04/05 Ishiga add start------------------
            m_ProForm.pCountValue = 4
            System.Windows.Forms.Application.DoEvents()
            '2016/04/05 Ishiga add end--------------------

            Me.Show()
            '画面ｻｲｽﾞ設定
            Call WindowPosition(BasNSK0000H.geWindowPosition.GetSettingValue)
            '各ｺﾝﾄﾛｰﾙｻｲｽﾞ設定
            Call First_SetControlSize()

            'Resizeイベントを発生させる
            m_ResizeEventFlg = True

            '職員の並び順を初期設定として表示№順とする
            m_SortData(1).SortKeyIndex = M_StaffHyojiNo
            m_SortData(1).SortOrder = True
            m_SortData(2).SortKeyIndex = 0
            m_SortData(3).SortKeyIndex = 0
            Call RunSort(True)

            'Activeセル設定
            Call Set_KeikakuFirstCell()

            Call Calc_ScrollSpread()

            'ｺﾝﾃﾅｺﾝﾄﾛｰﾙ（Picture）の表示、非表示設定
            picHide.Visible = False

            '2015/05/29 Ishiga del start-------------------------------------------------
            'If g_LimitedFlg = True Then
            '    m_lstmnuMain(M_MenuErrorList).Available = False
            'End If
            '2015/05/29 Ishiga del end---------------------------------------------------

            sbrMain.Items.Item(M_StatusBarKey_NowDate).Text = Format(Now, "yyyy/MM/dd")
            sbrMain.Items.Item(M_StatusBarKey_NowTime).Text = Format(Now, "HH:mm")

            Timer1.Interval = 1000
            Timer1.Enabled = True
            endTime = DateTime.Now
            Console.WriteLine(" : " & endTime.Subtract(startTime).TotalMilliseconds.ToString())

            'カーソルラインの設定
            vLine.Visible = True
            hLine.Visible = True

            subSetCrossPointLength()

            '2014/07/03 Ishiga add start-----
            If m_strVerPath = "1" Then
                _mnuMain_3.Visible = False
                _mnuSet_1.Visible = False
                _mnuTool_6.Visible = False
                _mnuCheck_7.Visible = False
                _mnuCheck_8.Visible = False
                _mnuCheck_9.Visible = False
                _mnuCheck_10.Visible = False
                _mnuView_12.Visible = False
                _mnuView_13.Visible = False
            End If
            '2014/07/03 Ishiga add end-------

            '2016/04/05 Ishiga add start---------
            m_ProForm.pNumberDisp = True
            m_ProForm.Close()
            m_ProForm = Nothing

            '活性の制御
            Panel1.Enabled = True
            tbrMain.Enabled = True
            MainMenu1.Enabled = True
            Me.Enabled = True
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            'm_UndoKaisu = m_UndoKaisu + 1
            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            '----------------------------------------------------------------------------------------------------
            Call Set_UndoData()
            '2016/04/05 Ishiga add end-----------

        Catch ex As Exception
            Call General.paTrpMsg(str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'パッケージ情報 ﾃﾞｰﾀ取得
    Private Function Get_PackageUseFLG() As Boolean

        Const W_SUBNAME As String = "NSK0000HA Get_PackageUseFLG"

        Dim w_lngRecCnt As Integer
        Dim w_lngLoop As Integer
        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_CD_F As ADODB.Field
        Dim w_FLG_F As ADODB.Field
        Dim w_strAppliUseFlg As String
        Dim w_strDutyUseFlg As String
        Dim w_strNurseUseFlg As String
        Dim w_DispNo_F As ADODB.Field
        Dim w_strAppliDispNo As Integer
        Dim w_strDutyDispNo As Integer
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Get_PackageUseFLG = False
        Try
            w_strAppliUseFlg = "0"
            w_strDutyUseFlg = "0"
            w_strNurseUseFlg = "0"

            'パッケージMより届出と日当直のUSEFLGを取得
            w_strSql = ""
            w_strSql = "Select PACKAGECD, USEFLG, DISPNO"
            w_strSql = w_strSql & " From NS_PACKAGE_M"
            w_strSql = w_strSql & " Where HospitalCD = '" & General.g_strHospitalCD & "'"

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ 生成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀがないとき
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "パッケージマスタ"
                    Call Set_MsgZOrder("NS0032", w_strMsg, w_MsgRc, 0)
                    .Close()
                    Exit Function
                Else
                    .MoveLast()
                    w_lngRecCnt = .RecordCount
                    .MoveFirst()

                    w_CD_F = .Fields("PACKAGECD")
                    w_FLG_F = .Fields("USEFLG")
                    w_DispNo_F = .Fields("DISPNO")

                    For w_lngLoop = 1 To w_lngRecCnt
                        Select Case w_CD_F.Value
                            Case "A"
                                w_strAppliUseFlg = w_FLG_F.Value & ""
                                w_strAppliDispNo = Integer.Parse(w_DispNo_F.Value & "")
                            Case "D"
                                w_strDutyUseFlg = w_FLG_F.Value & ""
                                w_strDutyDispNo = Integer.Parse(w_DispNo_F.Value & "")
                            Case "N"
                                w_strNurseUseFlg = w_FLG_F.Value & ""
                        End Select

                        .MoveNext()
                    Next w_lngLoop
                End If

                .Close()
            End With

            w_Rs = Nothing

            '判定
            If w_strAppliUseFlg = "0" Then
            Else
                '項目設定
                w_strAppliUseFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "USEAPPLIFLG", "0", General.g_strHospitalCD)
            End If

            'パッケージマスタ(0:届出×日当直×,1:届出×日当直○,2:届出○日当直×,3:届出○日当直○)
            m_PackageFLG = 0
            If w_strAppliUseFlg = "1" Then
                '届出あり
                m_PackageFLG = m_PackageFLG + 2
            End If
            If w_strDutyUseFlg = "1" Then
                '日当直あり
                m_PackageFLG = m_PackageFLG + 1
            End If

            '最大表示段数
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                m_MaxShowLine = 2
            Else
                m_MaxShowLine = 1
            End If
            If w_strAppliUseFlg = "1" Then
                '届出あり
                m_MaxShowLine = m_MaxShowLine + 1
            End If
            If w_strDutyUseFlg = "1" Then
                '日当直あり
                m_MaxShowLine = m_MaxShowLine + 1
            End If

            m_DutyData = -1
            m_KinmuPlan = -1
            m_KinmuJisseki = -1
            m_AppliData = -1

            m_blnJissekiUseFlg = False
            m_blnAppliUseFlg = False

            'パッケージマスタ
            Select Case m_PackageFLG
                Case 0 '0:届出×日当直×
                    m_KinmuPlan = 0
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        m_KinmuJisseki = 1
                    End If
                Case 1 '1:届出×日当直○
                    m_KinmuPlan = 0
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        m_KinmuJisseki = 1
                        m_DutyData = 2
                    Else
                        m_DutyData = 1
                    End If
                Case 2 '2:届出○日当直×
                    m_KinmuPlan = 0
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        m_KinmuJisseki = 1
                        m_AppliData = 2
                    Else
                        m_AppliData = 1
                    End If
                    m_blnAppliUseFlg = True
                Case 3 '3:届出○日当直○
                    m_KinmuPlan = 0
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        m_KinmuJisseki = 1
                        If w_strAppliDispNo <= w_strDutyDispNo Then
                            m_AppliData = 2
                            m_DutyData = 3
                        Else
                            m_AppliData = 3
                            m_DutyData = 2
                        End If
                    Else
                        If w_strAppliDispNo <= w_strDutyDispNo Then
                            m_AppliData = 1
                            m_DutyData = 2
                        Else
                            m_AppliData = 2
                            m_DutyData = 1
                        End If
                    End If
                    m_blnAppliUseFlg = True
            End Select

            If w_strNurseUseFlg = "0" Then
                '夜勤時間計算結果の表示しない
                m_YakanKangoDispFlg = 1
            End If

            '正常終了
            Get_PackageUseFLG = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '利用権限のﾁｪｯｸ
    Private Sub AccountChk()

        Const W_SUBNAME As String = "NSK0000HA AccountChk"

        Const W_RESCD As String = "NSK0000HA01"
        Const W_NOTUSE As String = "-"
        Try
            '権限の取得
            With General.g_objSecurity
                If .mGetResource(W_RESCD) = False Then
                    g_LimitedFlg = True
                Else
                    If .fR_UpdAuthRangeKbn = W_NOTUSE Then
                        g_LimitedFlg = True
                    Else
                        g_LimitedFlg = False
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾒｯｾｰｼﾞ表示の時のﾊﾟﾚｯﾄ/検索等のZorder制御,ﾒｯｾｰｼﾞ表示
    'p_Msg:表示するﾒｯｾｰｼﾞ,p_Bottons:表示されるボタンの種類,p_MsgRc:戻り値
    Private Sub Set_MsgZOrder(ByVal p_MsgNo As String, ByRef p_strMsg() As String, ByRef p_MsgRc As Integer, Optional ByVal p_MsgFlg As Integer = 0)

        Const W_SUBNAME As String = "NSK0000HA Set_MsgZOrder"
        Try
            If p_MsgFlg = 0 Then
                Call General.paNotTopPos(Me)

                'ﾊﾟﾚｯﾄが表示されている場合
                If m_lstmnuView(M_MenuPalette).Checked = True Then
                    'ﾊﾟﾚｯﾄ画面を最上位に設定する
                    Call General.paNotTopPos(m_PaletteForm)
                End If

                '検索画面が表示されている場合
                If m_KensakuForm.pShowFlg = True Then
                    '検索画面を最上位に設定する
                    Call General.paNotTopPos(m_KensakuForm)
                End If

                '置換画面が表示されている場合
                If m_ChikanForm.pShowFlg = True Then
                    '置換画面を最上位に設定する
                    Call General.paNotTopPos(m_ChikanForm)
                End If

                '並び替え画面が表示されている場合
                If m_SortForm.pShowFlg = True Then
                    '並び替え画面を最上位に設定する
                    Call General.paNotTopPos(m_SortForm)
                End If

                '行事一覧画面が表示されている場合
                If m_EventForm.pShowFlg = True Then
                    '並び替え画面を最上位に設定する
                    Call General.paNotTopPos(m_EventForm)
                End If

                p_MsgRc = General.paMsgDsp(p_MsgNo, p_strMsg)
            End If

            'ﾊﾟﾚｯﾄが表示されている場合
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                'ﾊﾟﾚｯﾄ画面を最上位に設定する
                Call General.paSetDialogPos(m_PaletteForm)
            End If

            '検索画面が表示されている場合
            If m_KensakuForm.pShowFlg = True Then
                '検索画面を最上位に設定する
                Call General.paSetDialogPos(m_KensakuForm)
            End If

            '置換画面が表示されている場合
            If m_ChikanForm.pShowFlg = True Then
                '置換画面を最上位に設定する
                Call General.paSetDialogPos(m_ChikanForm)
            End If

            '並び替え画面が表示されている場合
            If m_SortForm.pShowFlg = True Then
                '並び替え画面を最上位に設定する
                Call General.paSetDialogPos(m_SortForm)
            End If

            '行事一覧画面が表示されている場合
            If m_EventForm.pShowFlg = True Then
                '並び替え画面を最上位に設定する
                Call General.paSetDialogPos(m_EventForm)
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Resize_SpreadCtrl()

        Const W_SUBNAME As String = "NSK0000HA Resize_SpreadCtrl"

        Dim w_TotalWidth As Single
        Dim w_TotalHeight As Single
        Dim w_MainWidth As Single
        Dim w_MainHeight As Single
        Dim w_FrameHeight As Single
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_CellCount As Integer
        Dim w_VisibleCol As Integer
        Dim w_VisibleRow As Integer
        Dim w_MaxCol As Integer
        Dim w_MaxRow As Integer
        Dim w_Loop As Integer
        Dim w_LeftCol As Integer
        Dim w_TopRow As Integer
        Dim w_Flg As Boolean
        Dim w_Temp As Integer
        Dim w_VisibleSpr As FpSpread
        Dim w_NotVisibleSpr As FpSpread
        Dim w_Visible As Boolean
        Dim w_SaveActiveCol As Integer
        Dim w_SaveActiveRow As Integer
        Dim w_JissekiDiff As Integer
        Dim w_InsertCount As Integer
        Dim w_ColWidth() As Double
        Dim w_WideWidthCnt1 As Integer
        Dim w_ColCount As Integer
        Dim w_NormalWidthCnt As Integer
        Dim w_VisibleRow_St As Integer
        Dim w_VisibleRow_Ed As Integer
        Dim w_RowLoop As Integer
        Dim w_sngHeight As Single
        Dim w_VisibleCol_St As Integer
        Dim w_VisibleCol_Ed As Integer
        Dim w_ColLoop As Integer
        Dim w_sngWidth As Single
        Dim w_empColWidht As Single
        Try
            '固定個人別集計幅を取得する
            w_TotalWidth = m_PersonalTotalWidth
            '固定日別集計高さを取得する
            w_TotalHeight = m_DayTotalHeight
            If m_lstmnuView(M_MenuEmpRowDisp).Checked Then
                w_empColWidht = sprSheet_M.Sheets(0).Columns(M_KinmuDataStart_Col).Width
            Else
                w_empColWidht = 0
            End If

            'ﾃﾞｰﾀ部ｽﾌﾟﾚｯﾄﾞの幅を設定する
            '2014/06/26 Shimizu upd start P-06979----------------------------------------
            '採用条件列を表示させた場合右側に不自然な空白ができていた問題を修正
            'w_MainWidth = picBase.ClientRectangle.Width - w_TotalWidth - 4 - w_empColWidht
            w_MainWidth = picBase.ClientRectangle.Width - w_TotalWidth - 4
            '2014/06/26 Shimizu upd end P-06979----------------------------------------
            If w_MainWidth < 0 Then
                w_MainWidth = 0
            ElseIf w_MainWidth > m_MaxMainWidth Then
                '2018/08/22 T.K ch st -------------
                'w_MainWidth = m_MaxMainWidth
                w_MainWidth = m_MaxMainWidth + w_empColWidht
                '2018/08/22 T.K ch ed -------------
            End If

            If m_GyoujiFlg Then
                '行事予定表示時
                sprSheet_M.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
                sprSheet_4W.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
                sprPTotal.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, m_gyoujiHeight)
            Else
                '行事予定非表示時
                sprSheet_M.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
                sprSheet_4W.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
                sprPTotal.Sheets(0).SetRowHeight(M_EVENTLABEL_ROW, 0)
            End If

            If m_lstmnuView(M_MenuEmpRowDisp).Checked Then
                '採用列表示時
                sprSheet_M.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, w_empColWidht)
                sprSheet_4W.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, w_empColWidht)
                sprDayTotal_M.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, w_empColWidht)
                sprDayTotal_4W.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, w_empColWidht)
            Else
                '採用列非表示時
                sprSheet_M.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, 0)
                sprSheet_4W.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, 0)
                sprDayTotal_M.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, 0)
                sprDayTotal_4W.Sheets(0).SetColumnWidth(M_EmpShrtNghtData_Col, 0)
            End If

            'ﾃﾞｰﾀ部ｽﾌﾟﾚｯﾄﾞの高さを設定する
            If m_YakanKangoDispFlg = 0 Then
                If picBase.ClientRectangle.Width < General.paTwipsTopixels(13200) Then
                    w_FrameHeight = General.paTwipsTopixels(1080)

                    Label4.SetBounds(General.paTwipsTopixels(120), General.paTwipsTopixels(720), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                    lblKangoYouin.SetBounds(General.paTwipsTopixels(2880), General.paTwipsTopixels(720), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                    Label5.SetBounds(General.paTwipsTopixels(4320), General.paTwipsTopixels(720), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)

                    Label6.SetBounds(General.paTwipsTopixels(3840), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                    lblAveTime.SetBounds(General.paTwipsTopixels(5950), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                    Label7.SetBounds(General.paTwipsTopixels(7320), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                Else
                    w_FrameHeight = General.paTwipsTopixels(720)

                    Label4.SetBounds(General.paTwipsTopixels(3840), General.paTwipsTopixels(360), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                    lblKangoYouin.SetBounds(General.paTwipsTopixels(6600), General.paTwipsTopixels(360), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)
                    Label5.SetBounds(General.paTwipsTopixels(8040), General.paTwipsTopixels(360), 0, 0, Windows.Forms.BoundsSpecified.X Or Windows.Forms.BoundsSpecified.Y)

                    Label6.SetBounds(General.paTwipsTopixels(8760), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                    lblAveTime.SetBounds(General.paTwipsTopixels(10850), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                    Label7.SetBounds(General.paTwipsTopixels(12240), 0, 0, 0, Windows.Forms.BoundsSpecified.X)
                End If
            Else
                w_FrameHeight = 0
            End If

            w_MainHeight = picBase.ClientRectangle.Height - (w_TotalHeight + w_FrameHeight)

            If w_MainHeight < 0 Then
                w_MainHeight = 0
            ElseIf w_MainHeight > m_MaxMainHeight Then
                w_MainHeight = m_MaxMainHeight
            End If

            '表示ｽﾌﾟﾚｯﾄﾞｺﾝﾄﾛｰﾙを設定する
            If m_SelViewKikan = 0 Then
                '1ヶ月用
                w_VisibleSpr = sprSheet_M
                w_NotVisibleSpr = sprSheet_4W

                '現在表示されている最左の列、最上の行を退避する
                w_LeftCol = w_VisibleSpr.GetViewportLeftColumn(0)
                w_TopRow = w_VisibleSpr.GetViewportTopRow(0)

            Else
                '４週用
                w_VisibleSpr = sprSheet_4W
                w_NotVisibleSpr = sprSheet_M
                '現在表示されている最左の列、最上の行を退避する
                w_LeftCol = w_VisibleSpr.GetViewportLeftColumn(0)
                w_TopRow = w_VisibleSpr.GetViewportTopRow(0)

                w_InsertCount = 0
            End If

            '明細スプレッドの仮設定
            w_VisibleSpr.SetBounds(0, 0, w_MainWidth, w_MainHeight)
            w_VisibleSpr.SetViewportLeftColumn(0, M_KinmuDataStart_Col) '最左を１番目のｾﾙに設定する
            w_VisibleSpr.SetViewportTopRow(0, M_KinmuDataStart_Row) '（固定列、固定行を考慮する）
            picHide.BringToFront()
            w_Visible = picBase.Visible
            picBase.Visible = True

            '右下のセルを取得する
            w_Row = w_VisibleSpr.GetViewportBottomRow(0) - 1
            w_Col = w_VisibleSpr.GetViewportRightColumn(0) - 1
            picBase.Visible = w_Visible

            While w_VisibleSpr.Sheets(0).GetRowHeight(w_Row) = 0
                w_Row = w_Row - 1
            End While

            While w_VisibleSpr.Sheets(0).GetColumnWidth(w_Col) = 0
                w_Col = w_Col - 1
            End While

            w_MaxRow = w_Row
            w_MaxCol = w_Col

            '右下のセルが表示しきれているかﾁｪｯｸする
            If w_VisibleSpr.IsCellInView(0, 0, w_Row, w_Col) = False Then
                '表示しきれていない場合、行・列単位で表示しきれているかﾁｪｯｸする
                '行ﾁｪｯｸ
                If w_VisibleSpr.IsCellInView(0, 0, w_Row, 0) = False Then
                    w_MaxRow = w_Row - 1
                End If
                '列ﾁｪｯｸ
                If w_VisibleSpr.IsCellInView(0, 0, 10, 10) = False Then
                    w_MaxCol = w_Col - 1
                End If
            End If

            '表示列数取得（隠しセルも考慮に入れる）
            w_VisibleCol = 0
            w_ColCount = 0
            For w_Loop = M_KinmuDataStart_Col To w_MaxCol
                If w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > 0 Then
                    w_VisibleCol = w_VisibleCol + 1
                    w_VisibleCol_Ed = w_Loop

                    w_ColCount = w_ColCount + 1
                    If w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > m_CellWidth Then
                        w_ColCount = w_ColCount + 1
                    End If
                End If
            Next w_Loop

            '表示行数取得（隠しセルも考慮に入れる）
            w_VisibleRow = 0
            w_VisibleRow_Ed = 3
            For w_Loop = M_KinmuDataStart_Row To w_MaxRow
                If w_VisibleSpr.Sheets(0).GetRowHeight(w_Loop) > 0 Then
                    w_VisibleRow = w_VisibleRow + 1
                    w_VisibleRow_Ed = w_Loop
                End If
            Next w_Loop

            '表示可能領域に表示できるセルの列数を求める
            w_CellCount = 0
            w_WideWidthCnt1 = 0
            w_NormalWidthCnt = 0
            For w_Loop = w_VisibleSpr.Sheets(0).ColumnCount To M_KinmuDataStart_Col Step -1
                If w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > m_CellWidth Then
                    w_WideWidthCnt1 = w_WideWidthCnt1 + 1
                    w_CellCount = w_CellCount + 2

                ElseIf w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > 0 Then
                    w_NormalWidthCnt = w_NormalWidthCnt + 1
                    w_CellCount = w_CellCount + 1

                End If

                If w_ColCount = w_CellCount Then
                    If w_LeftCol > w_Loop Then
                        w_LeftCol = w_Loop
                    End If

                    Exit For
                ElseIf w_ColCount < w_CellCount Then
                    w_WideWidthCnt1 = w_WideWidthCnt1 - 1
                    If w_LeftCol > w_Loop + 1 Then
                        w_LeftCol = w_Loop + 1
                    End If

                    Exit For
                End If
            Next w_Loop

            '表示可能領域に表示できるセルの行数を求める
            w_Flg = False
            w_CellCount = 0
            For w_Loop = w_TopRow To w_VisibleSpr.Sheets(0).RowCount
                If w_VisibleSpr.Sheets(0).GetRowHeight(w_Loop) > 0 Then
                    w_CellCount = w_CellCount + 1
                End If
                If w_VisibleRow <= w_CellCount Then
                    w_Flg = True
                    Exit For
                End If
            Next w_Loop
            If w_Flg = False Then
                w_Temp = w_TopRow - 1
                For w_Loop = w_Temp To M_KinmuDataStart_Row Step -1
                    If w_VisibleSpr.Sheets(0).GetRowHeight(w_Loop) > 0 Then
                        w_CellCount = w_CellCount + 1
                        w_TopRow = w_Loop
                    End If
                    If w_VisibleRow <= w_CellCount Then
                        Exit For
                    End If
                Next w_Loop
            End If

            ReDim w_ColWidth(0)
            If m_SelViewKikan = 0 Then
                If m_JissekiKikan.KinmuDataStartCol = 0 AndAlso m_JissekiKikan.KinmuDataEndCol = -1 Then
                Else
                    w_JissekiDiff = DateDiff(DateInterval.Day, Date.Parse(Format(m_JissekiKikan.StartDate, "0000/00/00")), Date.Parse(Format(m_JissekiKikan.EndDate, "0000/00/00")))
                    w_JissekiDiff = w_JissekiDiff + 1
                    If w_JissekiDiff > w_NormalWidthCnt Then
                        ReDim w_ColWidth(w_JissekiDiff - w_NormalWidthCnt)
                        For w_Loop = 1 To w_JissekiDiff - w_NormalWidthCnt
                            w_ColWidth(w_Loop) = w_VisibleSpr.Sheets(0).GetColumnWidth(m_JissekiKikan.KinmuDataEndCol - (w_Loop - 1))
                            w_VisibleSpr.Sheets(0).SetColumnWidth(m_JissekiKikan.KinmuDataEndCol - (w_Loop - 1), 0)
                        Next w_Loop
                    ElseIf w_JissekiDiff < w_NormalWidthCnt Then
                        ReDim w_ColWidth((w_NormalWidthCnt - w_JissekiDiff) + w_WideWidthCnt1)
                        For w_Loop = 1 To w_NormalWidthCnt - w_JissekiDiff
                            w_ColWidth(w_Loop) = w_VisibleSpr.Sheets(0).GetColumnWidth(m_JissekiKikan.KinmuDataEndCol + w_Loop)
                            w_VisibleSpr.Sheets(0).SetColumnWidth(m_JissekiKikan.KinmuDataEndCol + w_Loop, m_CellWidth)
                        Next w_Loop
                        For w_Loop = 1 To w_WideWidthCnt1
                            w_ColWidth((w_NormalWidthCnt - w_JissekiDiff) + w_Loop) = w_VisibleSpr.Sheets(0).GetColumnWidth(m_JissekiKikan.KinmuDataEndCol + (w_NormalWidthCnt - w_JissekiDiff) + w_Loop)
                            w_VisibleSpr.Sheets(0).SetColumnWidth(m_JissekiKikan.KinmuDataEndCol + (w_NormalWidthCnt - w_JissekiDiff) + w_Loop, m_TotalWidth)
                        Next w_Loop
                    End If
                End If
            End If
            w_VisibleCol = w_NormalWidthCnt + w_WideWidthCnt1

            'Activeｾﾙを一時退避
            w_SaveActiveCol = w_VisibleSpr.Sheets(0).ActiveColumn.Index
            w_SaveActiveRow = w_VisibleSpr.Sheets(0).ActiveRow.Index

            '固定列、行設定を一時中止する
            w_VisibleSpr.Sheets(0).FrozenColumnCount = 0
            w_VisibleSpr.Sheets(0).FrozenRowCount = 0

            w_VisibleRow_St = M_Interval_Row
            w_VisibleCol_St = M_HyojiNo_Col

            w_Col = w_VisibleSpr.GetViewportRightColumn(0) - 1

            While w_VisibleSpr.Sheets(0).GetColumnWidth(w_Col) = 0
                w_Col = w_Col - 1
            End While

            w_MaxCol = w_Col

            For w_Loop = M_KinmuDataStart_Col To w_MaxCol
                If w_VisibleSpr.Sheets(0).GetColumnWidth(w_Loop) > 0 Then
                    w_VisibleCol_Ed = w_Loop
                End If
            Next w_Loop

            For w_RowLoop = w_VisibleRow_St To w_VisibleRow_Ed
                w_sngHeight = w_sngHeight + w_VisibleSpr.Sheets(0).Rows(w_RowLoop).Height
            Next

            For w_ColLoop = w_VisibleCol_St To w_VisibleCol_Ed
                '2014/06/26 Shimizu upd start P-06979----------------------------------------
                'w_sngWidth = w_sngWidth + w_VisibleSpr.Sheets(0).Columns(w_ColLoop).Width
                If w_ColLoop <= M_KinmuDataStart_Col OrElse (w_MainWidth >= w_sngWidth + w_VisibleSpr.Sheets(0).Columns(w_ColLoop).Width) Then
                    w_sngWidth = w_sngWidth + w_VisibleSpr.Sheets(0).Columns(w_ColLoop).Width
                End If
                '2014/06/26 Shimizu upd end P-06979------------------------------------------
            Next

            w_VisibleSpr.Height = w_sngHeight + 2
            w_VisibleSpr.Width = w_sngWidth + 2

            '大きさを取得する
            w_MainWidth = w_VisibleSpr.Width
            w_MainHeight = w_VisibleSpr.Height

            '固定列・行を再設定する
            w_VisibleSpr.Sheets(0).FrozenColumnCount = M_FrozenCol
            w_VisibleSpr.Sheets(0).FrozenRowCount = M_FrozenRow

            If m_SelViewKikan = 0 Then
                If m_JissekiKikan.KinmuDataStartCol = 0 AndAlso m_JissekiKikan.KinmuDataEndCol = -1 Then
                Else
                    If w_JissekiDiff > w_NormalWidthCnt Then
                        For w_Loop = 1 To UBound(w_ColWidth)
                            w_VisibleSpr.Sheets(0).SetColumnWidth(m_JissekiKikan.KinmuDataEndCol - (w_Loop - 1), w_ColWidth(w_Loop))
                        Next w_Loop
                    ElseIf w_JissekiDiff < w_NormalWidthCnt Then
                        For w_Loop = 1 To UBound(w_ColWidth)
                            w_VisibleSpr.Sheets(0).SetColumnWidth(m_JissekiKikan.KinmuDataEndCol + w_Loop, w_ColWidth(w_Loop))
                        Next w_Loop
                    End If
                End If
            End If

            'Activeｾﾙの再設定
            w_VisibleSpr.Sheets(0).SetActiveCell(w_SaveActiveRow, w_SaveActiveCol)

            'TopRowとLeftColを設定する
            If w_TopRow <> w_VisibleSpr.GetViewportTopRow(0) Then
                w_VisibleSpr.SetViewportTopRow(0, w_TopRow)
            End If
            If w_LeftCol <> w_VisibleSpr.GetViewportLeftColumn(0) Then
                w_VisibleSpr.SetViewportLeftColumn(0, w_LeftCol)
            End If

            '非表示のﾒｲﾝｽﾌﾟﾚｯﾄﾞの設定
            w_NotVisibleSpr.SetBounds(0, 0, w_MainWidth, w_MainHeight)

            '個人別集計スプレッドの設定
            sprPTotal.SetBounds(w_MainWidth - 2, 0, w_TotalWidth, w_MainHeight)

            '日別集計スプレッドの高さ
            sprDayTotal_M.SetBounds(0, w_MainHeight - 2, w_MainWidth, w_TotalHeight)
            sprDayTotal_4W.SetBounds(0, w_MainHeight - 2, w_MainWidth, w_TotalHeight)

            sprScroll.SetBounds(w_MainWidth - 2, w_MainHeight - 2, w_TotalWidth, w_TotalHeight)
            If m_YakanKangoDispFlg = 0 Then
                Frame1.Visible = True
                Frame1.SetBounds(0, w_MainHeight + w_TotalHeight - 2, w_MainWidth + w_TotalWidth - 2, w_FrameHeight)
            Else
                Frame1.Visible = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprScroll_LeftChange(ByVal eventSender As System.Object, ByVal eventArgs As LeftChangeEventArgs) Handles sprScroll.LeftChange

        Const W_SUBNAME As String = "NSK0000HA sprScroll_LeftChange"

        Static w_Left As Integer
        Try
            If w_Left <> eventArgs.NewLeft Then
                If m_SelViewKikan > 0 Then
                    If m_4WeekKikan(m_SelViewKikan).KoteiStartCol > 0 Then
                        sprPTotal.SetViewportLeftColumn(0, eventArgs.NewLeft + m_4WeekKikan(m_SelViewKikan).KoteiStartCol - 1)
                        w_Left = eventArgs.NewLeft + m_4WeekKikan(m_SelViewKikan).KoteiStartCol - 1
                    Else
                        sprPTotal.SetViewportLeftColumn(0, eventArgs.NewLeft)
                        w_Left = eventArgs.NewLeft
                    End If
                Else
                    sprPTotal.SetViewportLeftColumn(0, eventArgs.NewLeft)
                    w_Left = eventArgs.NewLeft
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprScroll_TopChange(ByVal eventSender As System.Object, ByVal eventArgs As TopChangeEventArgs) Handles sprScroll.TopChange

        Const W_SUBNAME As String = "NSK0000HA sprScroll_TopChange"

        Static w_Top As Integer
        Dim w_TeamCnt As Integer
        Dim w_HaniStart As Integer
        Dim w_HaniEnd As Integer
        Dim w_i As Integer
        Try
            If w_Top <> eventArgs.NewTop AndAlso sprPTotal.Sheets(0).RowCount < m_lngRowFrozen Then
                Exit Sub
            End If

            w_HaniStart = -1

            If w_Top <> eventArgs.NewTop Then
                'sprPTotal.SetViewportTopRow(0, eventArgs.NewTop)   2011/09/07 Y.I Del
                w_Top = eventArgs.NewTop
                w_TeamCnt = UBound(m_DayDataRow)
                'チーム
                If m_SelTeamNo <> 0 Then
                    For w_i = 0 To UBound(m_VMtrx) - 1
                        If eventArgs.NewTop > w_i Then
                            '--------------------対象チームの対象の集計項目の行を非表示にする----------------------'
                            sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, M_HideCellHeight_TeamRow)
                            sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, M_HideCellHeight_TeamRow)
                        ElseIf (eventArgs.NewTop + m_lngRowFrozen) <= w_i Then
                            '--------------------対象チームの対象の集計項目の行を非表示にする----------------------'
                            sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, M_HideCellHeight_TeamRow)
                            sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, M_HideCellHeight_TeamRow)
                        Else
                            '--------------------対象チームの対象の集計項目の行を表示する--------------------------'
                            sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, m_CellHeight)
                            sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i, m_CellHeight)
                            If w_HaniStart = -1 Then
                                w_HaniStart = Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i
                            End If
                            w_HaniEnd = Integer.Parse(UBound(m_VMtrx) * (m_SelTeamNo - 1)) + w_i
                        End If
                    Next w_i

                    'sprDayTotal_M-----------------------------------------------
                    Call SetBorder(sprDayTotal_M, w_HaniStart, M_KinmuDataStart_Col, w_HaniEnd, m_KeikakuKikan.PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                    Call SetBorder(sprDayTotal_M, w_HaniStart, M_KinmuDataStart_Col, w_HaniEnd, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                    Call SetBorder(sprDayTotal_M, w_HaniStart, m_KeikakuKikan.KinmuDataStartCol, w_HaniEnd, m_KeikakuKikan.PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                    Call SetBorder(sprDayTotal_M, w_HaniStart, m_KeikakuKikan.KinmuDataStartCol, w_HaniEnd, m_KeikakuKikan.PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)
                    'sprDayTotal_M-----------------------------------------------

                    'sprDayTotal_4W----------------------------------------------
                    Call SetBorder(sprDayTotal_4W, w_HaniStart, M_KinmuDataStart_Col, w_HaniEnd, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 1, 1, 1, 1, 0, Color.Black)
                    Call SetBorder(sprDayTotal_4W, w_HaniStart, M_KinmuDataStart_Col, w_HaniEnd, m_4WeekKikan(UBound(m_4WeekKikan)).PersonalEndCol, 0, 0, 0, 0, 2, Color.Black)

                    For w_i = 1 To UBound(m_4WeekKikan)
                        '4週期間

                        '固定日別集計部（4週用）
                        If sprDayTotal_4W.Sheets(0).RowCount > 0 Then '固定日別集計あり？
                            Call SetBorder(sprDayTotal_4W, 0, m_4WeekKikan(w_i).KinmuDataStartCol, sprDayTotal_4W.Sheets(0).RowCount - 1, m_4WeekKikan(w_i).KinmuDataEndCol, 0, 0, 0, 0, 2, Color.Black)
                        End If

                    Next w_i
                    'sprDayTotal_4W----------------------------------------------
                End If

                '総合計
                For w_i = 0 To UBound(m_VMtrx) - 1
                    If eventArgs.NewTop > w_i Then
                        '--------------------対象の集計項目の行を非表示にする----------------------'
                        sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, M_HideCellHeight_TeamRow)
                        sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, M_HideCellHeight_TeamRow)
                    ElseIf (eventArgs.NewTop + m_lngRowFrozen) <= w_i Then
                        '--------------------対象の集計項目の行を非表示にする----------------------'
                        sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, M_HideCellHeight_TeamRow)
                        sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, M_HideCellHeight_TeamRow)
                    Else
                        '--------------------対象の集計項目の行を表示する--------------------------'
                        sprDayTotal_M.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, m_CellHeight)
                        sprDayTotal_4W.Sheets(0).SetRowHeight(Integer.Parse(UBound(m_VMtrx) * (w_TeamCnt)) + w_i, m_CellHeight)
                    End If
                Next w_i

                '表示中の行として１行目を指定する
                sprDayTotal_M.SetViewportTopRow(0, 0)
                sprDayTotal_4W.SetViewportTopRow(0, 0)
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub frmNSK0000HA_FormClosing(ByVal eventSender As System.Object, ByVal eventArgs As FormClosingEventArgs) Handles Me.FormClosing
        Dim UnloadMode As CloseReason = eventArgs.CloseReason
        'Sumiya add 2012/11/12 Start ---出力開始期間取得用SQLのための変数宣言 -------------------------------
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_strDateF As String
        'Sumiya add 2012/11/12 Start ---------------------------------------- -------------------------------
        Const W_SUBNAME As String = "NSK0000HA Form_QueryUnload"
        '2017/11/08 Angelo Add ------------------
        Dim w_strCmdLine As String
        Dim w_varWork As String()
        Dim w_str As String

        Dim w_process As Process
        '----------------------------------------
        Try

            If m_EndFlg = 0 Then
                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                    '新規計画の場合
                    m_EndFlg = M_MenuEnd
                Else
                    '計画変更/勤務変更の場合
                    m_EndFlg = M_MenuKakutei
                End If
            End If

            If m_EndFlg = M_MenuKakutei Then
                '終了処理実行
                If RunSaveKakuteiEnd() = False Then
                    '終了中断
                    eventArgs.Cancel = True
                    m_EndFlg = 0
                    Exit Sub
                End If
            ElseIf m_EndFlg = M_MenuEnd Then
                '2017/11/27 Yamanishi Upd --------------------------------------------------
                ''終了処理実行
                'If RunSaveEnd() = False Then
                '    '終了中断
                '    eventArgs.Cancel = True
                '    m_EndFlg = 0
                '    Exit Sub
                'End If
                ''2017/11/08 Angelo add st----------------------------------------------------------
                'If m_blnSaveCallApplyFLG = True Then
                If Not m_blnSaveCallApplyFLG Then
                    '終了処理実行
                    If RunSaveEnd() = False Then
                        '終了中断
                        eventArgs.Cancel = True
                        m_EndFlg = 0
                        Exit Sub
                    End If
                Else
                    '-----------------------------------------------------------------------
                    '起動元画面からのﾃﾞｰﾀをコマンドで取得する
                    w_str = Command()
                    w_varWork = General.paSplit(w_str, ",")
                    '配列インデックス加算
                    ReDim Preserve w_varWork(UBound(w_varWork) + 2)
                    'コマンドライン引数設定を編集する
                    w_varWork(10) = "0" 'g_HopeMode
                    'w_varWork(11) = m_intSelSaveNo '保存番号
                    w_varWork(11) = m_intNextFormSaveNo '保存番号
                    w_strCmdLine = String.Join(",", w_varWork)

                    '子プロセスを開始する
                    w_process = New Process
                    'Exe起動 (.NET)
                    With w_process
                        .StartInfo.FileName = Application.ExecutablePath '開くﾌｧｲﾙのﾊﾟｽとﾌｧｲﾙ名取得
                        .StartInfo.WindowStyle = ProcessWindowStyle.Normal
                        .StartInfo.Arguments = w_strCmdLine 'ｺﾏﾝﾄﾞﾗｲﾝ
                        .StartInfo.UseShellExecute = True
                        .Start()
                    End With
                End If
                '2017/11/08 Angelo add en----------------------------------------------------------
            End If
            '****************************Sumiya Add 2012/11/05 Start ****************************************************
            'RICHARD UPDATE START
            'w_Sql = "SELECT PLANPERIODFROM"
            'w_Sql = w_Sql & " FROM NS_PLANCONTROL_F"
            'w_Sql = w_Sql & " WHERE PLANNO = " & Convert.ToString(m_PlanNo)
            'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'w_Sql = w_Sql & " "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_PLANCONTROL_F_04(w_Rs, m_PlanNo) '<22>
            'RICHARD UPDATE END

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀ無しの場合は未確定
                Else
                    'ﾃﾞｰﾀありの場合は値取得
                    w_strDateF = General.paGetDbFieldVal(.Fields("PLANPERIODFROM"), 0)
                End If
            End With
            If m_strUseAccessLog <> 0 Then
                w_Rs.Close()
                m_udtAccessLog = New DATABEAN.AccessLog_Type
                'アクセスログを更新する
                m_udtAccessLog.strHospitaLCD = General.g_strHospitalCD                        '施設コード
                m_udtAccessLog.lngEventTime = Long.Parse(Format(Now, "yyyyMMddHHmmss"))       'イベント時刻
                m_udtAccessLog.strUserId = General.g_strUserID                                '利用者ID
                m_udtAccessLog.intOperateDate = Integer.Parse(Format(Now, "yyyyMM"))        '操作対象日
                m_udtAccessLog.strUserStaffId = ""                                            '利用者職員番号
                m_udtAccessLog.strUserStaffMngId = General.g_strUserMngID                     '利用者職員管理番号
                m_udtAccessLog.strTargetStaffMngId = ""                                       '対象者職員管理番号
                m_udtAccessLog.strTargetStaffId = ""                                          '対象者職員番号
                m_udtAccessLog.strTargetKinmuDeptCD = General.g_strSelKinmuDeptCD                                      '対象勤務部署CD
                m_udtAccessLog.strCmpName = Environ("computername")                           '端末名称
                m_udtAccessLog.strRegScreenResourceCD = "NSC0000HA61"
                '確定終了と終了で処理を分ける
                If m_EndFlg = M_MenuKakutei Then
                    '新規計画とそれ以外で処理を分ける
                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        m_udtAccessLog.strEventType = General.G_ACCESSMENU_NEWPLAN                    'イベントタイプ
                        m_udtAccessLog.strMenuKbn = General.G_ACCESS_UPD                              'メニュー区分
                        m_udtAccessLog.strMessege = "勤務を確定終了しました。(" & Format(Integer.Parse(w_strDateF.Remove(6, 2)), "0000年00月") & ")"                        'メッセージ
                        m_udtAccessLog.strHanyouArea = m_PlanNo & "、" & General.G_PGMSTARTFLG_NEWPLAN '汎用エリア
                    Else
                        m_udtAccessLog.strEventType = General.G_ACCESSMENU_RECORDCHANGE                     'イベントタイプ
                        m_udtAccessLog.strMenuKbn = General.G_ACCESS_UPD                              'メニュー区分
                        m_udtAccessLog.strMessege = "勤務を確定終了しました。(" & Format(Integer.Parse(w_strDateF.Remove(6, 2)), "0000年00月") & ")"                        'メッセージ
                        m_udtAccessLog.strHanyouArea = m_PlanNo & "、" & General.G_PGMSTARTFLG_CHANGEPLAN   '汎用エリア
                    End If
                ElseIf m_EndFlg = M_MenuEnd Then
                    m_udtAccessLog.strEventType = General.G_ACCESSMENU_NEWPLAN                    'イベントタイプ
                    m_udtAccessLog.strMenuKbn = General.G_ACCESS_UPD                              'メニュー区分
                    m_udtAccessLog.strMessege = "勤務計画を一時保存しました。(" & Format(Integer.Parse(w_strDateF.Remove(6, 2)), "0000年00月") & ")"                        'メッセージ
                    m_udtAccessLog.strHanyouArea = m_PlanNo
                End If
                m_udtAccessLog.strRegistrantId = General.g_strUserID                          '登録者ID
                'アクセスログの保存
                Call General.paSaveAccessLog(m_udtAccessLog.strHospitaLCD,
                                        m_udtAccessLog.lngEventTime,
                                        m_udtAccessLog.strUserId,
                                        m_udtAccessLog.intOperateDate,
                                        m_udtAccessLog.strUserStaffId,
                                        m_udtAccessLog.strUserStaffMngId,
                                        m_udtAccessLog.strTargetStaffMngId,
                                        m_udtAccessLog.strTargetStaffId,
                                        m_udtAccessLog.strTargetKinmuDeptCD,
                                        m_udtAccessLog.strCmpName,
                                        m_udtAccessLog.strRegScreenResourceCD,
                                        m_udtAccessLog.strEventType,
                                        m_udtAccessLog.strMenuKbn,
                                        m_udtAccessLog.strMessege,
                                        m_udtAccessLog.strHanyouArea,
                                        m_udtAccessLog.strRegistrantId)
            End If
            '****************************Sumiya Add 2012/11/05  End  *****************************************************
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub frmNSK0000HA_Resize(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Resize

        Const W_SUBNAME As String = "NSK0000HA Form_Resize"

        Static w_WindowState As Integer
        Try
            If m_blnLoadErr = True Then
                End
            End If

            If Me.WindowState = FormWindowState.Minimized OrElse w_WindowState = FormWindowState.Minimized Then
                w_WindowState = Me.WindowState
                Exit Sub
            End If

            w_WindowState = Me.WindowState
            If m_ResizeEventFlg = True Then
                Call Resize_ContanarCtrl()
                Call RunFontSizeChange()
            End If

            'カーソルラインの設定
            vLine.Visible = True
            hLine.Visible = True

            subSetCrossPointLength()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub frmNSK0000HA_FormClosed(ByVal eventSender As System.Object, ByVal eventArgs As FormClosedEventArgs) Handles Me.FormClosed

        Const W_SUBNAME As String = "NSK0000HA Form_Unload"
        Try
            'ﾊﾟﾚｯﾄﾌｫｰﾑを解放する
            m_PaletteForm.Close()
            m_PaletteForm.frmNSK0000HB_FormClosed()
            m_PaletteForm = Nothing
            '検索画面を解放する
            m_KensakuForm.Close()
            m_KensakuForm.frmNSK0000HD_FormClosed()
            m_KensakuForm = Nothing
            '置換画面を解放する
            m_ChikanForm.Close()
            m_ChikanForm.frmNSK0000HD_FormClosed()
            m_ChikanForm = Nothing
            '並び替え画面を解放する
            m_SortForm.Close()
            m_SortForm = Nothing
            '行事画面を解放する
            m_EventForm.Close()
            m_EventForm = Nothing

            '画面の状態を保存する
            Call WriteReg_AppState()

            '部品ｵﾌﾞｼﾞｪｸﾄ解放
            General.g_objGetData = Nothing
            General.g_objGetMaster = Nothing
            General.g_objSelectDate = Nothing

            '2017/11/08 Angelo Upd --------------
            'Call Execute_NextPgm()
            If Not m_blnSaveCallApplyFLG Then
                '次画面（初期画面）呼び出し
                Call Execute_NextPgm()
            Else
                Call Thread.Sleep(200)
                m_ProgressForm.pCountValue = 1
                Call Thread.Sleep(300)
                m_ProgressForm.pCountValue = 2
                Call Thread.Sleep(300)
                m_ProgressForm.pCountValue = 3
                Call Thread.Sleep(400)
                Call m_ProgressForm.Dispose()
            End If
            '------------------------------------
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '検索条件のものすべてを置換
    Private Sub m_ChikanForm_ChikanAllKinmu() Handles m_ChikanForm.ChikanAllKinmu

        Const W_SUBNAME As String = "NSK0000HA m_ChikanForm_ChikanAllKinmu"

        Const W_MIWARIATE As Integer = 0 '未割当を検索
        Const w_Kinmu As Integer = 1 '勤務ｺｰﾄﾞのみを検索
        Const W_TAISYO As Integer = 2 '対象のみを検索
        Const W_TAISYOKINMU As Integer = 3 '対象理由かつ勤務ｺｰﾄﾞを検索

        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Bool As Boolean
        Dim w_KensakuOKFlg As Boolean '検索一致ﾌﾗｸﾞ(True:一致,False:一致していない)
        Dim w_KekkaFlg As Boolean '検索結果ﾌﾗｸﾞ(True:検索条件勤務有,False:検索勤務条件無)
        Dim w_Var As Object
        Dim w_KensakuType As Integer 'どういう条件で検索するか
        Dim w_ChikanKinmuCD As String '置換勤務ｺｰﾄﾞ
        Dim w_ChikanRiyuKbn As String '置換理由区分
        Dim w_ChikanVar As Object = Nothing '置換後のｾﾙﾃﾞｰﾀ
        Dim w_NotWariate As Boolean '置換後の勤務が未割当かどうか(True:未割当,False:勤務)
        Dim w_ForeColor As Integer '置換後の文字色
        Dim w_BackColor As Integer '置換後の背景色
        Dim w_MsgFlg As Boolean '置換確認ﾒｯｾｰｼﾞの判定(True:確認済み，False:未確認)
        Dim w_MsgRc As Integer '置換確認ﾒｯｾｰｼﾞの戻り値
        Dim w_GssbText As String 'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞ退避
        Dim w_KikanStartCol As Integer
        Dim w_KikanEndCol As Integer
        Dim w_Int As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_CurrentDate As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_DateLng As Integer
        Dim w_Jisseki4WFlg As Boolean
        Dim w_StartCol As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetBool As Boolean
        Dim w_GetCol As Integer
        Dim w_BlockFlg As Boolean
        Dim w_BlockColS As Integer
        Dim w_Lng As Integer
        Dim w_KensakuFlg As Boolean
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row2 As Integer
        Dim w_strMsg() As String
        Dim w_lngKojyoLoop As Integer
        Dim w_targetTeamFlg As Boolean = False
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        ''2016/04/05 Ishiga upd start---------------------------
        ''ReDim m_UndoData(0)
        'm_UndoKaisu = m_UndoKaisu + 1
        'If m_UndoMaxKensu < m_UndoKaisu Then
        '    m_UndoKaisu = m_UndoMaxKensu
        'End If

        'm_UndoIdx = m_UndoIdx + 1
        'm_UndoIdxHendou = m_UndoIdxHendou + 1
        ''2016/04/05 Ishiga upd end-----------------------------
        'ReDim m_KojyoUndoData(0)
        '----------------------------------------------------------------------------------------------------
        Try
            Me.Refresh()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = Cursors.WaitCursor

            '検索結果ﾌﾗｸﾞ初期化
            w_KekkaFlg = False
            '置換確認ﾒｯｾｰｼﾞの判定ﾌﾗｸﾞ初期化
            w_MsgFlg = False

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '検索条件を設定
            If m_ChikanForm.pKensakuKinmuCD = "000" Then
                '検索勤務が未割当
                If Double.Parse(m_ChikanForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = W_MIWARIATE
                Else
                    If m_ChikanForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_MIWARIATE
                    End If
                End If
            Else
                '検索勤務ｺｰﾄﾞが選択されているとき
                If Double.Parse(m_ChikanForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = w_Kinmu
                Else
                    If m_ChikanForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_TAISYOKINMU
                    End If
                End If
            End If

            '置換後の勤務、理由区分取得
            w_ChikanKinmuCD = m_ChikanForm.pChikanKinmuCD
            w_ChikanRiyuKbn = m_ChikanForm.pRiyuKBN
            '理由区分により色設定
            If w_ChikanRiyuKbn = "2" Then
                '要請
                w_ForeColor = m_Yousei_Fore
                w_BackColor = m_Yousei_Back
            ElseIf w_ChikanRiyuKbn = "3" Then
                '希望
                w_ForeColor = m_Kibou_Fore
                w_BackColor = m_Kibou_Back
            ElseIf w_ChikanRiyuKbn = "4" Then
                '再掲
                w_ForeColor = m_Saikei_Fore
                w_BackColor = m_Saikei_Back
            ElseIf w_ChikanRiyuKbn = "5" Then
                '委員会
                w_ForeColor = m_Iin_Fore
                w_BackColor = m_Iin_Back
            Else
                '通常、その他
                w_ForeColor = ColorTranslator.ToOle(Color.Black)
                w_BackColor = ColorTranslator.ToOle(Color.White)
            End If

            If w_ChikanKinmuCD = "000" Then
                '置換後の勤務が未割当
                w_NotWariate = True
                If m_PgmFlg <> General.G_PGMSTARTFLG_NEWPLAN Then
                    ReDim w_strMsg(0)
                    Call Set_MsgZOrder("NS0114", w_strMsg, w_MsgRc, 0)
                End If
                w_ForeColor = ColorTranslator.ToOle(Color.Black)
                w_BackColor = ColorTranslator.ToOle(Color.White)
            Else
                w_NotWariate = False
                '2015/04/10 Bando Upd Start =========================================
                'w_ChikanVar = Set_KinmuMark(w_ChikanKinmuCD, w_ChikanRiyuKbn, "0", "", "")
                w_ChikanVar = Set_KinmuMark(w_ChikanKinmuCD, w_ChikanRiyuKbn, "0", "", "", "")
                '2015/04/10 Bando Upd End   =========================================
            End If

            '代休データに関してのメッセージ
            If General.g_lngDaikyuMng = 0 Then
                ReDim w_strMsg(0)
                Call Set_MsgZOrder("NS0264", w_strMsg, w_MsgRc, 0)
                If w_MsgRc = MsgBoxResult.Cancel Then
                    'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
                    Me.Cursor = Cursors.Default

                    Exit Sub
                End If
            Else
                ReDim w_strMsg(0)
                Call Set_MsgZOrder("NS0265", w_strMsg, w_MsgRc, 0)
                If w_MsgRc = MsgBoxResult.Cancel Then
                    'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
                    Me.Cursor = Cursors.Default

                    Exit Sub
                End If
            End If

            Me.Refresh()

            'ｽﾃｰﾀｽﾊﾞｰﾒｯｾｰｼﾞ退避
            w_GssbText = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

            '検索中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SEARCH_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_KeikakuKikan.KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_KeikakuKikan.KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 1
            Else
                '4週画面表示中の場合
                If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                    '勤務ﾃﾞｰﾀ開始列格納
                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    End If
                Else
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                End If
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 2
                'PlanPeriodTo+1日
                w_DateLng = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                If Get_Col_4W(w_DateLng, w_StartCol) = False Then
                    w_StartCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataStartCol
                End If
            End If

            With m_Spread(w_Int).Sheets(0)
                '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                ''オール置換前の代休データを退避
                'If General.g_lngDaikyuMng = 0 Then
                '    Call Set_UndoDaikyuData(0)
                'End If
                '----------------------------------------------------------------------------------------------------
                '表示期間の全て
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                    w_targetTeamFlg = False
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) Then
                            If Integer.Parse(w_Var) = m_SelTeamNo OrElse m_SelTeamNo = 0 Then
                                w_targetTeamFlg = True
                            End If
                        End If
                    End If

                    If (((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki)) AndAlso w_targetTeamFlg Then
                        '勤務のみ置換

                        'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                        w_BlockFlg = False

                        For w_Col = w_KikanStartCol To w_KikanEndCol
                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If
                                Else
                                    w_Cnt = 0
                                End If
                            End If

                            '配列番号 取得
                            w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            If IsNumeric(w_Var) = True Then
                                w_StaffIdx = Integer.Parse(w_Var)
                                If g_SaikeiFlg = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                    '再掲部署で実績ﾃﾞｰﾀの場合
                                ElseIf w_NotWariate = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                    '実績ﾃﾞｰﾀを未割当にする置換が行われたとき
                                Else
                                    w_Jisseki4WFlg = False

                                    If w_Jisseki4WFlg = False Then

                                        '部署異動ﾁｪｯｸ（配属期間内）
                                        If Not (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) AndAlso Not (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then

                                            '検索一致ﾌﾗｸﾞ初期化
                                            w_KensakuOKFlg = True

                                            'ｾﾙﾃﾞｰﾀの取得
                                            w_Var = .GetText(w_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_Bool = True
                                            Else
                                                w_Bool = False
                                            End If

                                            '勤務記号文字列を各データ毎に分割
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time)
                                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time, "")
                                            '2015/04/10 Bando Upd End   =========================================

                                            w_KensakuFlg = False
                                            Select Case w_KensakuType
                                                Case W_MIWARIATE
                                                    '未割当を検索
                                                    If w_KinmuCD = "" Then
                                                        w_KensakuFlg = True
                                                    End If
                                                Case w_Kinmu
                                                    '勤務ｺｰﾄﾞで検索
                                                    If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) Then
                                                        w_KensakuFlg = True
                                                    End If
                                                Case W_TAISYO
                                                    '対象(理由区分)で検索
                                                    If w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                        w_KensakuFlg = True
                                                    End If
                                                Case W_TAISYOKINMU
                                                    '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                                    If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                        w_KensakuFlg = True
                                                    End If
                                            End Select

                                            If w_KensakuFlg = True Then
                                                '日付を取得
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_CurrentDate = Integer.Parse(w_Var)

                                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                        '日当直のコンポーネントありの時
                                                        With General.g_objGetData
                                                            .p職員区分 = 0
                                                            .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                            .pチェック基準日 = w_CurrentDate
                                                            .p処理区分 = 0
                                                            .pチェック勤務CD = w_ChikanKinmuCD

                                                            If .mChkKinmuDuty = False Then
                                                                '置換対象外とする
                                                                w_KinmuCD = "1000"
                                                                w_RiyuKBN = ""
                                                            End If
                                                        End With
                                                    End If

                                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                        '届出のコンポーネントありの時
                                                        w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine
                                                        w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                                        If w_Var <> "" Then
                                                            Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                            With General.g_objSyouninData
                                                                .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                                .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                                .mKC_TargetDate = w_CurrentDate

                                                                If .mChkKinmuChange = False Then
                                                                    '置換対象外とする
                                                                    w_KinmuCD = "1000"
                                                                    w_RiyuKBN = ""
                                                                End If
                                                            End With
                                                        End If
                                                    End If

                                                    '代休チェック(代休取得済みの勤務の場合はとばす)
                                                    If General.g_lngDaikyuMng = 0 Then

                                                        '祝日であるか
                                                        If InStr(m_HolDateStr, Convert.ToString(w_CurrentDate)) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_CurrentDate, "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(w_CurrentDate, "0000/00/00"))) = 7) Then
                                                            '祝日である場合はすでに代休が取得済みであるかチェック
                                                            If Check_Daikyu(M_ALL_CHK, w_CurrentDate, w_StaffIdx, "") = False Then
                                                                '置換対象外とする
                                                                w_KinmuCD = "1000"
                                                                w_RiyuKBN = ""
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If

                                            Select Case w_KensakuType
                                                Case W_MIWARIATE
                                                    '未割当を検索
                                                    If w_KinmuCD = "" AndAlso w_BlockFlg = False Then
                                                        w_BlockFlg = True
                                                        w_BlockColS = w_Col
                                                    ElseIf w_KinmuCD <> "" Then
                                                        w_KensakuOKFlg = False
                                                    End If
                                                Case w_Kinmu
                                                    '勤務ｺｰﾄﾞで検索
                                                    If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) AndAlso w_BlockFlg = False Then
                                                        w_BlockFlg = True
                                                        w_BlockColS = w_Col
                                                    ElseIf Trim(w_KinmuCD) <> Trim(m_ChikanForm.pKensakuKinmuCD) Then
                                                        w_KensakuOKFlg = False
                                                    End If
                                                Case W_TAISYO
                                                    '対象(理由区分)で検索
                                                    If w_RiyuKBN = m_ChikanForm.pKensakuTaisyo AndAlso w_BlockFlg = False Then
                                                        w_BlockFlg = True
                                                        w_BlockColS = w_Col
                                                    ElseIf w_RiyuKBN <> m_ChikanForm.pKensakuTaisyo Then
                                                        w_KensakuOKFlg = False
                                                    End If
                                                Case W_TAISYOKINMU
                                                    '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                                    If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_ChikanForm.pKensakuTaisyo AndAlso w_BlockFlg = False Then
                                                        w_BlockFlg = True
                                                        w_BlockColS = w_Col
                                                    ElseIf Trim(w_KinmuCD) <> Trim(m_ChikanForm.pKensakuKinmuCD) OrElse w_RiyuKBN <> m_ChikanForm.pKensakuTaisyo Then
                                                        w_KensakuOKFlg = False
                                                    End If
                                            End Select
                                        Else
                                            w_KensakuOKFlg = False
                                        End If

                                        '検索条件の勤務群を選択状態にする
                                        If w_BlockFlg = True AndAlso w_KensakuOKFlg = False Then

                                            'UndoData格納
                                            'Call Set_UndoData(w_BlockColS, w_Row, w_Col - 1, w_Row) '2016/04/05 Ishiga del

                                            '該当勤務置換
                                            If w_NotWariate = False Then
                                                For w_Lng = w_BlockColS To w_Col - 1
                                                    .SetText(w_Row, w_Lng, w_ChikanVar)
                                                Next w_Lng
                                            Else
                                                For w_Lng = w_BlockColS To w_Col - 1
                                                    .SetText(w_Row, w_Lng, "")
                                                Next w_Lng
                                            End If

                                            '代休データを削除する
                                            If General.g_lngDaikyuMng = 0 Then
                                                For w_Lng = w_BlockColS To w_Col - 1
                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                    If w_Var <> "" Then
                                                        If IsNumeric(w_Var) = True Then
                                                            w_CurrentDate = Integer.Parse(w_Var)
                                                            Call Check_Daikyu(M_ALLCHANGE_DEL, w_CurrentDate, w_StaffIdx, "")
                                                        End If
                                                    End If
                                                Next w_Lng
                                            End If

                                            '控除を取得している場合削除する
                                            For w_Lng = w_BlockColS To w_Col - 1
                                                'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                w_CurrentDate = Integer.Parse(w_Var)
                                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                        'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                                        m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                                        'Exit For
                                                    End If
                                                Next w_lngKojyoLoop
                                            Next w_Lng

                                            '色設定

                                            .Cells(w_Row, w_BlockColS, w_Row, w_Col - 1).BackColor = ColorTranslator.FromOle(w_BackColor)
                                            .Cells(w_Row, w_BlockColS, w_Row, w_Col - 1).ForeColor = ColorTranslator.FromOle(w_ForeColor)

                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                If w_NotWariate = False Then
                                                    For w_Lng = w_BlockColS To w_Col - 1

                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_Lng - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                                w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If
                                                        If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                            '勤務変更の場合
                                                            If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                '勤務CDが予定と異なる場合
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col - 1).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col - 1).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col - 1).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            End If
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Lng, w_Row, w_Col - 1).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                            .Cells(w_Row, w_Lng, w_Row, w_Col - 1).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                        End If
                                                    Next w_Lng
                                                End If
                                            End If

                                            .AddSelection(w_Row, w_BlockColS, 1, w_Col - w_BlockColS)
                                            .SetActiveCell(w_Row, w_BlockColS, False)

                                            'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                                            w_BlockFlg = False

                                            If m_SelViewKikan = 0 Then
                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ｹ月の場合

                                                    For w_Lng = w_BlockColS To w_Col - 1

                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                        If w_Var <> "" Then
                                                            w_Bool = True
                                                        Else
                                                            w_Bool = False
                                                        End If

                                                        If Get_Col_4W(w_Var, w_Col2) = True Then
                                                            '該当勤務置換
                                                            If w_NotWariate = False Then
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col2, w_ChikanVar)
                                                            Else
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col2, "")
                                                            End If

                                                            '色設定
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)

                                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                                '4週/1ｹ月の場合
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                                If w_Var <> "" Then
                                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                    Else
                                                                        w_Cnt = 0
                                                                    End If
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                                If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                                    '勤務変更の場合
                                                                    If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                        '勤務CDが予定と異なる場合
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                                    Else
                                                                        '勤務CDが予定と同じ場合
                                                                        '通常
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                    End If
                                                                Else
                                                                    '勤務CDが予定と同じ場合
                                                                    '通常
                                                                    m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                    m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                End If
                                                            End If
                                                        End If
                                                    Next w_Lng
                                                End If
                                            Else
                                                For w_Lng = w_BlockColS To w_Col - 1

                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                    If w_Var <> "" Then
                                                        w_Bool = True
                                                    Else
                                                        w_Bool = False
                                                    End If

                                                    '1ヶ月用列番号取得
                                                    If Get_Col_M(w_Var, w_Col2) = True Then
                                                        '該当勤務置換
                                                        If w_NotWariate = False Then
                                                            m_Spread(1).Sheets(0).SetText(w_Row, w_Col2, w_ChikanVar)
                                                        Else
                                                            m_Spread(1).Sheets(0).SetText(w_Row, w_Col2, "")
                                                        End If
                                                        '色設定
                                                        m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                        m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)

                                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                                '1ｹ月/1ｹ月,4週/4週の場合
                                                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                                w_Cnt = w_Lng - w_KeikakuCol + 1
                                                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                                '4週/1ｹ月の場合
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                                If w_Var <> "" Then
                                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                    Else
                                                                        w_Cnt = 0
                                                                    End If
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                            End If
                                                            If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                                '勤務変更の場合
                                                                If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                    '勤務CDが予定と異なる場合
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                                Else
                                                                    '勤務CDが予定と同じ場合
                                                                    '通常
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                End If
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            End If
                                                        End If
                                                    End If
                                                Next w_Lng
                                            End If

                                            w_KekkaFlg = True

                                        ElseIf w_BlockFlg = True AndAlso w_Col = w_KikanEndCol Then

                                            'UndoData格納
                                            'Call Set_UndoData(w_BlockColS, w_Row, w_Col, w_Row) '2016/04/05 Ishiga del

                                            '該当勤務置換
                                            If w_NotWariate = False Then
                                                For w_Lng = w_BlockColS To w_Col
                                                    .SetText(w_Row, w_Lng, w_ChikanVar)
                                                Next w_Lng
                                            Else
                                                For w_Lng = w_BlockColS To w_Col
                                                    .SetText(w_Row, w_Lng, "")
                                                Next w_Lng
                                            End If

                                            '代休データを削除する
                                            If General.g_lngDaikyuMng = 0 Then
                                                For w_Lng = w_BlockColS To w_Col - 1
                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                    If w_Var <> "" Then
                                                        If IsNumeric(w_Var) = True Then
                                                            w_CurrentDate = Integer.Parse(w_Var)
                                                            Call Check_Daikyu(M_ALLCHANGE_DEL, w_CurrentDate, w_StaffIdx, "")
                                                        End If
                                                    End If
                                                Next w_Lng
                                            End If

                                            '控除を取得している場合削除する
                                            For w_Lng = w_BlockColS To w_Col - 1
                                                'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                w_CurrentDate = Integer.Parse(w_Var)
                                                For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                        'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                                        m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                                        Exit For
                                                    End If
                                                Next w_lngKojyoLoop
                                            Next w_Lng

                                            '色設定
                                            .Cells(w_Row, w_BlockColS, w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                            .Cells(w_Row, w_BlockColS, w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)

                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                If w_NotWariate = False Then
                                                    For w_Lng = w_BlockColS To w_Col
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_Lng - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                                w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If
                                                        If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                            '勤務変更の場合
                                                            If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                '勤務CDが予定と異なる場合
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                .Cells(w_Row, w_Lng, w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            End If
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Lng, w_Row, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                            .Cells(w_Row, w_Lng, w_Row, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                        End If
                                                    Next w_Lng
                                                End If
                                            End If

                                            .AddSelection(w_Row, w_BlockColS, 1, w_Col - w_BlockColS + 1)
                                            .SetActiveCell(w_Row, w_BlockColS, False)

                                            'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                                            w_BlockFlg = False

                                            If m_SelViewKikan = 0 Then
                                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                                                    '4週/1ｹ月の場合

                                                    For w_Lng = w_BlockColS To w_Col

                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                        If w_Var <> "" Then
                                                            w_Bool = True
                                                        Else
                                                            w_Bool = False
                                                        End If

                                                        If Get_Col_4W(w_Var, w_Col2) = True Then
                                                            '該当勤務置換
                                                            If w_NotWariate = False Then
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col2, w_ChikanVar)
                                                            Else
                                                                m_Spread(2).Sheets(0).SetText(w_Row, w_Col2, "")
                                                            End If
                                                            '色設定
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                            m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)

                                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                                '4週/1ｹ月の場合
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                                If w_Var <> "" Then
                                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                    Else
                                                                        w_Cnt = 0
                                                                    End If
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                                If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                                    '勤務変更の場合
                                                                    If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                        '勤務CDが予定と異なる場合
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                                    Else
                                                                        '勤務CDが予定と同じ場合
                                                                        '通常
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                        m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                    End If
                                                                Else
                                                                    '勤務CDが予定と同じ場合
                                                                    '通常
                                                                    m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                    m_Spread(2).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                End If
                                                            End If
                                                        End If
                                                    Next w_Lng
                                                End If
                                            Else
                                                For w_Lng = w_BlockColS To w_Col

                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                    If w_Var <> "" Then
                                                        w_Bool = True
                                                    Else
                                                        w_Bool = False
                                                    End If

                                                    '1ヶ月用列番号取得

                                                    If Get_Col_M(w_Var, w_Col2) = True Then

                                                        '該当勤務置換
                                                        If w_NotWariate = False Then
                                                            m_Spread(1).Sheets(0).SetText(w_Row, w_Col2, w_ChikanVar)
                                                        Else
                                                            m_Spread(1).Sheets(0).SetText(w_Row, w_Col2, "")
                                                        End If
                                                        '色設定
                                                        m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                        m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)

                                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                                '1ｹ月/1ｹ月,4週/4週の場合
                                                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                                w_Cnt = w_Lng - w_KeikakuCol + 1
                                                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                                '4週/1ｹ月の場合
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Lng)
                                                                If w_Var <> "" Then
                                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                                                    If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                                    Else
                                                                        w_Cnt = 0
                                                                    End If
                                                                Else
                                                                    w_Cnt = 0
                                                                End If
                                                            End If
                                                            If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                                                '勤務変更の場合
                                                                If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                    '勤務CDが予定と異なる場合
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                                Else
                                                                    '勤務CDが予定と同じ場合
                                                                    '通常
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                    m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                                End If
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                                m_Spread(1).Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                            End If
                                                        End If
                                                    End If
                                                Next w_Lng
                                            End If
                                            w_KekkaFlg = True
                                        End If
                                    End If
                                End If
                            End If
                        Next w_Col
                    End If
                Next w_Row
            End With

            If w_KekkaFlg = True Then
                '置換が行われた場合
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        '計画期間の個人別集計
                        Call RunReCalc_PUser(w_Row)

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週期間の個人別集計
                            Call RunReCalc_User_4W(w_Row)
                            Call RunReCalc_PUser_Jisseki(w_Row)
                        End If
                    End If
                Next w_Row

                For w_Col = w_KikanStartCol To w_KikanEndCol
                    '計画期間の日別集計
                    Call RunReCalc_PDay(w_Col)
                Next w_Col

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    If Get_Col_4W(Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd")), w_CurrentDate) = True Then
                        For w_Col = w_CurrentDate To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                            '計画期間の最後の4週部分の日別集計
                            Call RunReCalc_PDay_4W(w_Col)
                        Next w_Col
                    End If
                End If
            Else
                '検索の結果なかった場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "検索条件に当てはまる勤務が"
                Call Set_MsgZOrder("NS0113", w_strMsg, w_MsgRc, 0)
            End If

            Call General.paSetFocus(m_Spread(w_Int))

            'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞを元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
            sbrMain.Refresh()

            'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
            Me.Cursor = Cursors.Default

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
            Me.Cursor = Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ｽﾌﾟﾚｯﾄﾞｼｰﾄ ﾃﾞﾌｫﾙﾄ設定
    Private Function Set_PersonalForm(ByVal p_SprSheet As FpSpread, ByVal p_SprKeikaku As FpSpread, ByRef pDataFlg As Object, ByRef pKakuteiFlg As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Set_PersonalForm"

        Dim w_Col As Integer
        Dim w_Cnt As Integer
        Dim w_Var As Object
        Dim w_FonSize As Integer
        Dim w_StartCol As Integer
        Dim w_HyojiFlg As Boolean
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Dim w_DataFlg As Object
        Dim w_KakuteiFlg As Object
        Dim w_Index As Integer
        Dim w_Var2 As Object
        Dim w_StaffIdx As Integer
        Dim w_KeikakuCol As Integer
        Dim w_DataIdx As Integer
        Dim w_GetCol As Integer
        Dim w_Bool As Boolean
        Dim w_ActiveRow As Integer
        Dim w_Style As New StyleInfo
        Dim w_TextCellType As New CellType.TextCellType
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_sngWidth As Single
        Dim w_sngHeight As Single

        Set_PersonalForm = False
        Try
            ''*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 開始 ***
            With p_SprSheet
                If m_SelViewKikan = 0 Then
                    '1ｹ月画面表示のとき
                    w_StartCol = m_KeikakuKikan.KinmuDataStartCol
                Else
                    '4週画面表示のとき
                    w_StartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                End If

                w_ActiveRow = m_ActiveRow - ((m_ActiveRow - m_StaffRow.StartRow) Mod m_MaxShowLine)

                '勤務 設定
                w_FonSize = p_SprKeikaku.Font.Size

                'ﾌｫﾝﾄｻｲｽﾞ 変更
                .Font = New Font("ＭＳ ゴシック", w_FonSize)

                'ｾﾙのｻｲｽﾞ設定
                .Sheets(0).SetColumnWidth(-1, m_CellWidth)
                .Sheets(0).SetRowHeight(-1, m_CellHeight)

                '日付表示行の高さ0
                .Sheets(0).SetRowHeight(M_KinmuData_Row - 1, 0)

                '行個数 設定
                .Sheets(0).RowCount = M_KinmuData_Row + 1

                '列個数 設定
                .Sheets(0).ColumnCount = m_KeikakuD_EndCol + 1

                '行ﾀｲﾄﾙ 固定列数 設定
                .Sheets(0).FrozenRowCount = (M_KinmuData_Row - 1)

                '列ﾀｲﾄﾙ 固定列数 設定
                .Sheets(0).FrozenColumnCount = (M_KinmuData_Col - 1)

                '全体(ﾗﾍﾞﾙ型)
                Call SubSetStyle(p_SprSheet, -1, -1, -1, -1, 1, 0)

                'ｽﾌﾟﾚｯﾄﾞのｾﾙ属性の設定(初期状態は全て文字ｾﾙ)
                '行ﾀｲﾄﾙ(ﾗﾍﾞﾙ)
                Call SubSetStyle(p_SprSheet, M_RowTitle_Row, -1, M_KinmuData_Row - 1, -1, 1, 0, , ColorTranslator.FromOle(12632256), CellHorizontalAlignment.Left, CellVerticalAlignment.Center)

                'ﾀｲﾄﾙ設定
                w_Var = "日 付"
                .Sheets(0).SetText(M_RowTitle_Row, M_ColTitle_Col, w_Var)
                w_Var = "曜 日"
                .Sheets(0).SetText(M_RowTitle_Row + 1, M_ColTitle_Col, w_Var)

                'ﾀｲﾄﾙを中央に
                Call SubSetStyle(p_SprSheet, M_RowTitle_Row, -1, M_KinmuData_Row - 1, -1, 1, 0, , , CellHorizontalAlignment.Center)

                'セルの選択位置(上下左右)に罫線を表示
                Call SetBorder(p_SprSheet, -1, M_ColTitle_Col, -1, M_ColTitle_Col, 2, 2, 2, 2, 0, Color.Black)
                '*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 終了 ***
            End With


            '日付・曜日・色設定
            'ｶｳﾝﾀｰ初期化
            w_Cnt = 0

            ''*** ｽﾌﾟﾚｯﾄﾞｼｰﾄ With ｽﾃｰﾄﾒﾝﾄ 開始 ***
            With p_SprSheet.Sheets(0)

                For w_Col = m_KeikakuD_StartCol To m_KeikakuD_EndCol

                    '日付設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 1, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row, w_Col, w_Var)

                    '曜日設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 2, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row + 1, w_Col, w_Var)

                    '隠しｾﾙの日付設定
                    w_Var = p_SprKeikaku.Sheets(0).GetText(M_MonthLabel_Row + 3, w_StartCol + w_Cnt)
                    .SetText(M_RowTitle_Row + 2, w_Col, w_Var)

                    '日付設定（色）
                    w_Style.Reset()
                    w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(M_MonthLabel_Row + 1, w_StartCol + w_Cnt, w_Style)
                    Call SubSetStyle(p_SprSheet, M_RowTitle_Row, w_Col, M_RowTitle_Row, w_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                    '曜日設定（色）
                    w_Style.Reset()
                    w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(M_MonthLabel_Row + 2, w_StartCol + w_Cnt, w_Style)
                    Call SubSetStyle(p_SprSheet, M_RowTitle_Row + 1, w_Col, M_RowTitle_Row + 1, w_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                    'ｶﾗﾑｶｳﾝﾀｰｱｯﾌﾟ
                    w_Cnt = w_Cnt + 1

                Next w_Col

                '-- 列ﾀｲﾄﾙ(職員情報)の設定 ----------------------
                w_Var = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, M_StaffName_Col)
                .SetText(M_ColTitle_Row, M_ColTitle_Col, w_Var)

                w_Var = p_SprKeikaku.Sheets(0).GetStyleInfo(w_ActiveRow, M_StaffName_Col + 1)
                .SetStyleInfo(M_ColTitle_Row, M_ColTitle_Col + 1, w_Var)

                w_Style.Reset()
                w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(w_ActiveRow, M_StaffName_Col, w_Style)
                Call SubSetStyle(p_SprSheet, M_ColTitle_Row, M_ColTitle_Col, M_ColTitle_Row, M_ColTitle_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)

                '既存勤務ﾃﾞｰﾀ 設定

                'ｶｳﾝﾀ初期化
                w_Cnt = 0

                '表示ﾌﾗｸﾞ初期化
                w_HyojiFlg = False

                w_Index = m_KeikakuD_EndCol - m_KeikakuD_StartCol + 1
                ReDim w_DataFlg(w_Index)
                ReDim w_KakuteiFlg(w_Index)
                w_Index = 1

                '該当職員の配列ｲﾝﾃﾞｯｸｽを取得
                If m_SelViewKikan = 0 Then
                    '1ｹ月画面表示のとき
                    w_Var2 = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                Else
                    '4週画面表示のとき
                    w_Var2 = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                End If

                If IsNumeric(w_Var2) = True Then

                    '職員配列ｲﾝﾃﾞｯｸｽ取得
                    w_StaffIdx = Integer.Parse(w_Var2)

                    For w_Col = m_KeikakuD_StartCol To m_KeikakuD_EndCol

                        '勤務 設定
                        w_Var = p_SprKeikaku.Sheets(0).GetText(w_ActiveRow + m_KinmuPlan, w_StartCol + w_Cnt)
                        .SetText(M_KinmuData_Row, w_Col, w_Var)

                        '勤務 設定（色）
                        w_Style.Reset()
                        w_Style = p_SprKeikaku.Sheets(0).Models.Style.GetDirectInfo(w_ActiveRow + m_KinmuPlan, w_StartCol + w_Cnt, w_Style)
                        If w_Style.BackColor.A = 0 Then
                            Call SubSetStyle(p_SprSheet, M_KinmuData_Row, w_Col, M_KinmuData_Row, w_Col, 0, 0, w_Style.ForeColor, Color.White)
                            w_Var = Color.White
                        Else
                            Call SubSetStyle(p_SprSheet, M_KinmuData_Row, w_Col, M_KinmuData_Row, w_Col, 0, 0, w_Style.ForeColor, w_Style.BackColor)
                            w_Var = w_Style.BackColor
                        End If

                        'ﾃﾞｰﾀﾌﾗｸﾞ、確定ﾌﾗｸﾞを取得する
                        w_Var2 = p_SprKeikaku.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_Cnt)
                        If IsDate(Format(Integer.Parse(w_Var2), "0000/00/00")) = True Then
                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ヶ月
                                w_Bool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                If w_Bool = True Then
                                    w_Bool = Get_Col_4W(w_Var2, w_GetCol)
                                End If
                            Else
                                '1ヶ月/1ヶ月，4週/4週
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Bool = Get_Col_M(w_Var2, w_GetCol)
                            End If

                            If w_Bool = True Then
                                w_DataIdx = w_GetCol - w_KeikakuCol + 1
                                If w_DataIdx > 0 Then
                                    w_DataFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).DataFlg 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiFlg(w_Index) = m_StaffData(w_StaffIdx).KinmuData(w_DataIdx).KakuteiFlg '確定ﾌﾗｸﾞ
                                Else
                                    w_DataFlg(w_Index) = "" 'ﾃﾞｰﾀﾌﾗｸﾞ
                                    w_KakuteiFlg(w_Index) = "" '確定ﾌﾗｸﾞ
                                End If
                            End If
                            w_Index = w_Index + 1
                        End If

                        If w_Var <> ColorTranslator.FromOle(m_MonthBefore_Back) AndAlso w_Var <> ColorTranslator.FromOle(m_Jisseki4W_Back) Then
                            w_HyojiFlg = True
                        End If

                        'ｶﾗﾑｶｳﾝﾀｱｯﾌﾟ
                        w_Cnt = w_Cnt + 1
                    Next w_Col
                End If

                If w_HyojiFlg = False Then
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "選択期間内すべてが他部署所属の職員のため~n"
                    Call Set_MsgZOrder("NS0095", w_strMsg, w_MsgRc, 0)
                    Exit Function
                End If

                '氏名欄の幅を調整する。
                .SetColumnWidth(M_ColTitle_Col, .GetPreferredColumnWidth(M_ColTitle_Col))

                '-- ｽﾌﾟﾚｯﾄﾞｼｰﾄ 開始ｾﾙ位置 設定 -------------------
                .SetActiveCell(M_KinmuData_Row, M_KinmuData_Col)

                w_sngWidth = 0
                w_sngHeight = 0

                For w_RowLoop = 0 To .RowCount - 1
                    w_sngHeight = w_sngHeight + .GetRowHeight(w_RowLoop)
                Next w_RowLoop

                For w_ColLoop = 0 To .ColumnCount - 1
                    w_sngWidth = w_sngWidth + .GetColumnWidth(w_ColLoop)
                Next w_ColLoop

                p_SprSheet.Height = w_sngHeight + 2
                p_SprSheet.Width = w_sngWidth + 2

                m_PersonalSpreadSize = p_SprSheet.Width

                '*** ｽﾌﾟﾚｯﾄﾞ Withｽﾃｰﾄﾒﾝﾄ 終了 ***
            End With


            'ﾃﾞｰﾀﾌﾗｸﾞ、確定ﾌﾗｸﾞ
            pDataFlg = w_DataFlg
            pKakuteiFlg = w_KakuteiFlg

            Set_PersonalForm = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '１個ずつ置換
    Private Sub m_ChikanForm_ChikanKinmu() Handles m_ChikanForm.ChikanKinmu

        Const W_SUBNAME As String = "NSK0000HA m_ChikanForm_ChikanKinmu"

        Const W_MIWARIATE As Integer = 0 '未割当を検索
        Const w_Kinmu As Integer = 1 '勤務ｺｰﾄﾞのみを検索
        Const W_TAISYO As Integer = 2 '対象のみを検索
        Const W_TAISYOKINMU As Integer = 3 '対象理由かつ勤務ｺｰﾄﾞを検索

        Dim w_ActiveRow As Integer '現在のｱｸﾃｨﾌﾞRow
        Dim w_ActiveCol As Integer '現在のｱｸﾃｨﾌﾞCol
        Dim w_ActionRow As Integer '検索条件に当てはまったRow
        Dim w_ActionCol As Integer '検索条件に当てはまったCol
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_StartCol As Integer
        Dim w_StartCol2 As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_Bool As Boolean 'GetTextの戻り値用
        Dim w_KensakuOKFlg As Boolean '検索結果ﾌﾗｸﾞ(True:見つかった,False:見つかっていない)
        Dim w_Var As Object
        Dim w_KensakuType As Integer 'どういう条件で検索するか
        Dim w_ChikanKinmuCD As String '置換勤務ｺｰﾄﾞ
        Dim w_ChikanRiyuKbn As String '置換理由区分
        Dim w_ChikanVar As Object = Nothing '置換後のｾﾙﾃﾞｰﾀ
        Dim w_NotWariate As Boolean '置換後の勤務が未割当かどうか(True:未割当,False:勤務)
        Dim w_ForeColor As Integer '置換後の文字色
        Dim w_BackColor As Integer '置換後の背景色
        Dim w_MsgRc As Integer '置換確認ﾒｯｾｰｼﾞの戻り値
        Dim w_GssbText As String 'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞ退避
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_KikanStartCol As Integer
        Dim w_KikanEndCol As Integer
        Dim w_Int As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_CurrentDate As Integer
        Dim w_DateLng As Integer
        Dim w_Jisseki4WFlg As Boolean
        Dim w_StaffIdx As Integer
        Dim w_GetBool As Boolean
        Dim w_GetCol As Integer
        Dim w_KensakuFlg As Boolean
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row2 As Integer
        Dim w_Index As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_targetTeamFlg As Boolean = False

        '検索結果ﾌﾗｸﾞの初期化
        w_KensakuOKFlg = False
        Try
            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '検索条件を設定
            If m_ChikanForm.pKensakuKinmuCD = "000" Then
                '検索勤務が未割当
                If Double.Parse(m_ChikanForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = W_MIWARIATE
                Else
                    If m_ChikanForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_MIWARIATE
                    End If
                End If
            Else
                '検索勤務ｺｰﾄﾞが選択されているとき
                If Double.Parse(m_ChikanForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = w_Kinmu
                Else
                    If m_ChikanForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_TAISYOKINMU
                    End If
                End If
            End If

            '置換後の勤務、理由区分取得
            w_ChikanKinmuCD = m_ChikanForm.pChikanKinmuCD
            w_ChikanRiyuKbn = m_ChikanForm.pRiyuKBN
            '理由区分により色設定
            If w_ChikanRiyuKbn = "2" Then
                '要請
                w_ForeColor = m_Yousei_Fore
                w_BackColor = m_Yousei_Back
            ElseIf w_ChikanRiyuKbn = "3" Then
                '希望
                w_ForeColor = m_Kibou_Fore
                w_BackColor = m_Kibou_Back
            ElseIf w_ChikanRiyuKbn = "4" Then
                '再掲
                w_ForeColor = m_Saikei_Fore
                w_BackColor = m_Saikei_Back
            ElseIf w_ChikanRiyuKbn = "5" Then
                '委員会
                w_ForeColor = m_Iin_Fore
                w_BackColor = m_Iin_Back
            Else
                '通常、その他
                w_ForeColor = ColorTranslator.ToOle(Color.Black)
                w_BackColor = ColorTranslator.ToOle(Color.White)
            End If

            If w_ChikanKinmuCD = "000" Then
                '置換後の勤務が未割当
                w_NotWariate = True
                w_ForeColor = ColorTranslator.ToOle(Color.Black)
                w_BackColor = ColorTranslator.ToOle(Color.White)
            Else
                w_NotWariate = False
                '2015/04/10 Bando Upd Start =========================================
                'w_ChikanVar = Set_KinmuMark(w_ChikanKinmuCD, w_ChikanRiyuKbn, "0", "", "")
                w_ChikanVar = Set_KinmuMark(w_ChikanKinmuCD, w_ChikanRiyuKbn, "0", "", "", "")
                '2015/04/10 Bando Upd End   =========================================
            End If

            'ｽﾃｰﾀｽﾊﾞｰﾒｯｾｰｼﾞ退避
            w_GssbText = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

            '検索中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SEARCH_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_KeikakuKikan.KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_KeikakuKikan.KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 1
                w_GetBool = True
            Else
                '4週画面表示中の場合
                If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol)
                Else
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    w_GetBool = True
                End If
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 2
                'PlanPeriodTo+1日
                w_DateLng = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                If Get_Col_4W(w_DateLng, w_StartCol2) = False Then
                    w_StartCol2 = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataStartCol
                End If
            End If

            With m_Spread(w_Int).Sheets(0)
                If w_GetBool = True Then
                    '計画期間開始列が設定できている場合

                    '現在のActiveRow，Col取得
                    w_ActiveRow = .ActiveRow.Index
                    w_ActiveCol = .ActiveColumn.Index

                    'ｱｸﾃｨﾌﾞｾﾙがﾃﾞｰﾀ領域内になければﾃﾞｰﾀ領域内の左上から検索
                    If w_ActiveRow < m_StaffRow.StartRow OrElse w_ActiveRow > m_StaffRow.EndRow Then
                        w_ActiveRow = m_StaffRow.StartRow
                        w_ActiveCol = w_KikanStartCol
                    End If
                    If w_ActiveCol < w_KikanStartCol OrElse w_ActiveCol > w_KikanEndCol Then
                        w_ActiveRow = m_StaffRow.StartRow
                        w_ActiveCol = w_KikanStartCol
                    End If

                    'もしｱｸﾃｨﾌﾞｾﾙの列が最終列ならば1つ下の行から検索開始
                    If w_ActiveCol = w_KikanEndCol Then
                        If w_ActiveRow = m_StaffRow.EndRow Then
                            'ｱｸﾃｨﾌﾞｾﾙの行が最終行ならば先頭行から検索開始
                            w_StartRow = m_StaffRow.StartRow
                        Else
                            w_StartRow = w_ActiveRow + 1
                        End If
                    Else
                        '検索開始行はそのまま
                        w_StartRow = w_ActiveRow
                    End If

                    'ｱｸﾃｨﾌﾞｾﾙの次のｾﾙから検索
                    For w_Row = w_StartRow To m_StaffRow.EndRow
                        w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                        w_targetTeamFlg = False
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) Then
                                If Integer.Parse(w_Var) = m_SelTeamNo OrElse m_SelTeamNo = 0 Then
                                    w_targetTeamFlg = True
                                End If
                            End If
                        End If

                        If (((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki)) AndAlso w_targetTeamFlg Then
                            '勤務のみ置換

                            'w_Row = w_ActiveRowの時はｱｸﾃｨﾌﾞｾﾙの列から、それ以外のときはﾃﾞｰﾀ領域の1番目の列(w_KikanStartCol)から
                            If w_Row > w_StartRow Then
                                w_StartCol = w_KikanStartCol
                            Else
                                If w_ActiveCol = w_KikanEndCol Then
                                    w_StartCol = w_KikanStartCol
                                Else
                                    w_StartCol = w_ActiveCol + 1
                                End If
                            End If

                            For w_Col = w_StartCol To w_KikanEndCol
                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                    'w_CurrentDate使用するため
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                        w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                        If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                    Else
                                        w_Cnt = 0
                                    End If
                                End If

                                '部署異動ﾁｪｯｸ（配属期間内）
                                If Not (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then

                                    '配列番号 取得
                                    w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    If IsNumeric(w_Var) = True AndAlso w_Cnt > 0 Then

                                        w_StaffIdx = Integer.Parse(w_Var)

                                        If g_SaikeiFlg = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '再掲部署で実績ﾃﾞｰﾀの場合
                                        ElseIf w_NotWariate = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀを未割当する置換が行われたとき
                                        Else
                                            w_Jisseki4WFlg = False
                                            If m_SelViewKikan > 0 Then
                                                '4週画面表示中のとき
                                                If w_StartCol2 <= w_Col AndAlso w_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                        '計画期間外の4週部分で実績ﾃﾞｰﾀのとき
                                                        w_Jisseki4WFlg = True
                                                    End If
                                                End If
                                            End If

                                            '代休チェック(代休取得済みの勤務の場合はとばす)
                                            If General.g_lngDaikyuMng = 0 Then
                                                If Check_Daikyu(M_CHANGE, w_CurrentDate, w_StaffIdx, "") = False Then
                                                    '置換対象外とする
                                                    w_Jisseki4WFlg = True
                                                End If
                                            End If

                                            If w_Jisseki4WFlg = False Then
                                                'ｾﾙﾃﾞｰﾀの取得
                                                w_Var = .GetText(w_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_Bool = True
                                                Else
                                                    w_Bool = False
                                                End If

                                                '勤務記号文字列を各データ毎に分割
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time)
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time, "")
                                                '2015/04/10 Bando Upd End   =========================================

                                                Select Case w_KensakuType
                                                    Case W_MIWARIATE
                                                        '未割当を検索
                                                        If w_KinmuCD = "" Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case w_Kinmu
                                                        '勤務ｺｰﾄﾞで検索
                                                        If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case W_TAISYO
                                                        '対象(理由区分)で検索
                                                        If w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case W_TAISYOKINMU
                                                        '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                                        If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                            w_KensakuFlg = True
                                                        End If
                                                End Select

                                                If w_KensakuFlg = True Then
                                                    '検索条件に当てはまった時
                                                    w_KensakuOKFlg = True

                                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                        '日当直のコンポーネントありの時
                                                        With General.g_objGetData
                                                            .p職員区分 = 0
                                                            .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                            .pチェック基準日 = w_CurrentDate
                                                            .p処理区分 = 0
                                                            .pチェック勤務CD = w_ChikanKinmuCD

                                                            If .mChkKinmuDuty = False Then
                                                                '置換対象外とする
                                                                w_KensakuOKFlg = False
                                                            End If
                                                        End With
                                                    End If

                                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                        '届出のコンポーネントありの時
                                                        w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine
                                                        w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                                        If w_Var <> "" Then
                                                            Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                            With General.g_objSyouninData
                                                                .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                                .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                                .mKC_TargetDate = w_CurrentDate

                                                                If .mChkKinmuChange = False Then
                                                                    '置換対象外とする
                                                                    w_KensakuOKFlg = False
                                                                End If
                                                            End With
                                                        End If
                                                    End If

                                                    If w_KensakuOKFlg = True Then
                                                        '検索条件に当てはまったｾﾙ
                                                        w_ActionRow = w_Row
                                                        w_ActionCol = w_Col
                                                        Exit For
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            Next w_Col

                            '検索結果見つかったならば For～Next 抜け出し
                            If w_KensakuOKFlg = True Then
                                Exit For
                            End If
                        End If
                    Next w_Row

                    'すでに検索勤務が見つかっていれば次の検索をしない
                    If w_KensakuOKFlg = False Then

                        w_EndRow = w_ActiveRow

                        For w_Row = m_StaffRow.StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ置換

                                If w_Row = w_EndRow Then
                                    If w_ActiveCol <> w_KikanStartCol Then
                                        '検索開始列の1つ前まで
                                        w_EndCol = w_ActiveCol
                                    Else
                                        '1番目の列から検索開始なので1つ前の行の最後の列まで
                                        w_EndCol = w_KikanEndCol
                                    End If
                                Else
                                    '検索行が途中なので最後の列まで
                                    w_EndCol = w_KikanEndCol
                                End If

                                For w_Col = w_KikanStartCol To w_EndCol
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                            w_GetBool = Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol)
                                            If Get_Col_4W(w_CurrentDate, w_GetCol) = True AndAlso w_GetBool = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                        Else
                                            w_Cnt = 0
                                        End If
                                    End If

                                    '配列番号 取得
                                    w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    If IsNumeric(w_Var) = True AndAlso w_Cnt > 0 Then
                                        w_StaffIdx = Integer.Parse(w_Var)

                                        If g_SaikeiFlg = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '再掲部署で実績ﾃﾞｰﾀの場合
                                        ElseIf w_NotWariate = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀを未割当にする置換が行われたとき
                                        Else
                                            w_Jisseki4WFlg = False
                                            If m_SelViewKikan > 0 Then
                                                '4週画面表示中のとき
                                                If w_StartCol2 <= w_Col AndAlso w_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                        '計画期間外の4週部分で実績ﾃﾞｰﾀのとき
                                                        w_Jisseki4WFlg = True
                                                    End If
                                                End If
                                            End If

                                            '代休チェック(代休取得済みの勤務の場合はとばす)
                                            If General.g_lngDaikyuMng = 0 Then
                                                If Check_Daikyu(M_CHANGE, w_CurrentDate, w_StaffIdx, "") = False Then
                                                    '置換対象外とする
                                                    w_Jisseki4WFlg = True
                                                End If
                                            End If

                                            If w_Jisseki4WFlg = False Then
                                                'ｾﾙﾃﾞｰﾀの取得
                                                w_Var = .GetText(w_Row, w_Col)

                                                '勤務記号文字列を各データ毎に分割
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time)
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, "", w_Time, "")
                                                '2015/04/10 Bando Upd End   =========================================

                                                Select Case w_KensakuType
                                                    Case W_MIWARIATE
                                                        '未割当を検索
                                                        If w_KinmuCD = "" Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case w_Kinmu
                                                        '勤務ｺｰﾄﾞで検索
                                                        If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case W_TAISYO
                                                        '対象(理由区分)で検索
                                                        If w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                            w_KensakuFlg = True
                                                        End If
                                                    Case W_TAISYOKINMU
                                                        '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                                        If Trim(w_KinmuCD) = Trim(m_ChikanForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_ChikanForm.pKensakuTaisyo Then
                                                            w_KensakuFlg = True
                                                        End If
                                                End Select

                                                If w_KensakuFlg = True Then
                                                    '検索条件に当てはまった時
                                                    w_KensakuOKFlg = True

                                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                        '日当直のコンポーネントありの時
                                                        With General.g_objGetData
                                                            .p職員区分 = 0
                                                            .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                            .pチェック基準日 = w_CurrentDate
                                                            .p処理区分 = 0
                                                            .pチェック勤務CD = w_ChikanKinmuCD

                                                            If .mChkKinmuDuty = False Then
                                                                '置換対象外とする
                                                                w_KensakuOKFlg = False
                                                            End If
                                                        End With
                                                    End If

                                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                        '届出のコンポーネントありの時
                                                        w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine
                                                        w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                                        If w_Var <> "" Then
                                                            Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                            With General.g_objSyouninData
                                                                .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                                .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                                .mKC_TargetDate = w_CurrentDate

                                                                If .mChkKinmuChange = False Then
                                                                    '置換対象外とする
                                                                    w_KensakuOKFlg = False
                                                                End If
                                                            End With
                                                        End If
                                                    End If

                                                    If w_KensakuOKFlg = True Then
                                                        '検索条件に当てはまったｾﾙ
                                                        w_ActionRow = w_Row
                                                        w_ActionCol = w_Col
                                                        Exit For
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                Next w_Col

                                '検索結果見つかったならば For～Next 抜け出し
                                If w_KensakuOKFlg = True Then
                                    Exit For
                                End If
                            End If
                        Next w_Row
                    End If
                End If

                'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞを元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
                sbrMain.Refresh()

                If w_KensakuOKFlg = True Then
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start---------------------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end-----------------------------
                    'ReDim m_KojyoUndoData(0)
                    ''Call Set_UndoData(w_ActionCol, w_ActionRow, w_ActionCol, w_ActionRow) '2016/04/05 Ishiga del
                    '----------------------------------------------------------------------------------------------------
                    '代休チェック(代休を置換される場合は配列から削除)
                    If General.g_lngDaikyuMng = 0 Then
                        If g_KinmuM(Integer.Parse(w_ChikanKinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                            Call Check_Daikyu(M_DELETE, w_CurrentDate, w_StaffIdx, "")
                        Else
                            If w_ChikanKinmuCD <> "" Then
                                If Check_Daikyu(M_PASTE, w_CurrentDate, w_StaffIdx, w_ChikanKinmuCD) = True Then
                                    If m_BackColorFlg = True Then
                                        w_ForeColor = m_Daikyu_Fore
                                        w_BackColor = m_Daikyu_Back
                                    End If
                                End If
                            End If
                        End If
                    End If

                    '勤務の曜日制限チェック
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var <> "" Then
                        w_CurrentDate = Integer.Parse(w_Var)
                    End If
                    If IsNumeric(w_Var) = True Then
                        If Check_YoubiLimit(w_CurrentDate, w_ChikanKinmuCD) = False Then
                            Exit Sub
                        End If
                    End If

                    'ReDim m_KojyoUndoData(1) '2016/04/06 Yamanishi Del

                    '控除データを削除
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var <> "" Then
                        w_CurrentDate = Integer.Parse(w_Var)
                    End If
                    If IsNumeric(w_Var) = True Then
                        w_strKojyoData = ""
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                            If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                'm_KojyoUndoData(1) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                Exit For
                            End If
                        Next
                    End If

                    '該当勤務置換
                    If w_NotWariate = False Then
                        .SetText(w_ActionRow, w_ActionCol, w_ChikanVar)
                    Else
                        .SetText(w_ActionRow, w_ActionCol, "")
                    End If
                    '色設定
                    .Cells(w_ActionRow, w_ActionCol).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                    .Cells(w_ActionRow, w_ActionCol).BackColor = ColorTranslator.FromOle(w_BackColor)

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                            '勤務変更の場合
                            If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                '勤務CDが予定と異なる場合
                                .Cells(w_ActionRow, w_ActionCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                            Else
                                '勤務CDが予定と同じ場合
                                '通常
                                .Cells(w_ActionRow, w_ActionCol).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                .Cells(w_ActionRow, w_ActionCol).BackColor = ColorTranslator.FromOle(w_BackColor)
                            End If
                        Else
                            '勤務CDが予定と同じ場合
                            '通常
                            .Cells(w_ActionRow, w_ActionCol).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                            .Cells(w_ActionRow, w_ActionCol).BackColor = ColorTranslator.FromOle(w_BackColor)
                        End If
                    End If

                    .SetActiveCell(w_ActionRow, w_ActionCol)

                    If m_SelViewKikan = 0 Then
                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month) Then
                            '4週/1ｹ月の場合
                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ActionCol)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            If Get_Col_4W(w_Var, w_Col) = True Then
                                '該当勤務置換
                                If w_NotWariate = False Then
                                    m_Spread(2).Sheets(0).SetText(w_ActionRow, w_Col, w_ChikanVar)
                                Else
                                    m_Spread(2).Sheets(0).SetText(w_ActionRow, w_Col, "")
                                End If
                                '色設定
                                m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)

                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                        '勤務変更の場合
                                        If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                            '勤務CDが予定と異なる場合
                                            m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                        Else
                                            '勤務CDが予定と同じ場合
                                            '通常
                                            m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                            m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                        End If
                                    Else
                                        '勤務CDが予定と同じ場合
                                        '通常
                                        m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                        m_Spread(2).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                    End If
                                End If
                            End If
                        End If
                    Else
                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ActionCol)
                        If w_Var <> "" Then
                            w_Bool = True
                        Else
                            w_Bool = False
                        End If

                        '1ヶ月用列番号取得
                        '*/*/*/*/*/*/*/*/*/*/*/
                        If Get_Col_M(w_Var, w_Col) = True Then

                            '該当勤務置換
                            If w_NotWariate = False Then
                                m_Spread(1).Sheets(0).SetText(w_ActionRow, w_Col, w_ChikanVar)
                            Else
                                m_Spread(1).Sheets(0).SetText(w_ActionRow, w_Col, "")
                            End If
                            '色設定
                            m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                            m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)

                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                If w_CurrentDate <= m_KeikakuKikan.EndDate Then
                                    '勤務変更の場合
                                    If w_ChikanKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                        '勤務CDが予定と異なる場合
                                        m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                    Else
                                        '勤務CDが予定と同じ場合
                                        '通常
                                        m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                        m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                    End If
                                Else
                                    '勤務CDが予定と同じ場合
                                    '通常
                                    m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                    m_Spread(1).Sheets(0).Cells(w_ActionRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                                End If
                            End If
                        End If
                    End If

                    For w_Index = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計
                            '個人別集計 計算実行(計画期間)
                            Call RunReCalc_PUser(w_Index)
                            '4週個人別集計 計算実行(計画期間)
                            Call RunReCalc_User_4W(w_Index)
                            Call RunReCalc_PUser_Jisseki(w_Index)
                        End If
                    Next w_Index

                    If m_SelViewKikan > 0 Then
                        '4週日別集計 計算実行(計画期間)
                        Call RunReCalc_PDay_4W(w_ActionCol)
                    Else
                        '日別集計 計算実行(計画期間)
                        Call RunReCalc_PDay(w_ActionCol)
                    End If
                Else
                    '検索の結果なかった場合
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "検索条件に当てはまる勤務が"
                    Call Set_MsgZOrder("NS0113", w_strMsg, w_MsgRc, 0)
                End If
            End With

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub m_ChikanForm_PaletteEnabled() Handles m_ChikanForm.PaletteEnabled

        Const W_SUBNAME As String = "NSK0000HA m_KensakuForm_PaletteEnabled"
        Try
            'ﾊﾟﾚｯﾄ使用可
            m_lstmnuView(M_MenuPalette).Enabled = True
            tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub m_KensakuForm_PaletteEnabled() Handles m_KensakuForm.PaletteEnabled

        Const W_SUBNAME As String = "NSK0000HA m_KensakuForm_PaletteEnabled"
        Try
            'ﾊﾟﾚｯﾄ使用可
            m_lstmnuView(M_MenuPalette).Enabled = True
            tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '検索条件のものすべて選択
    Private Sub m_KensakuForm_SelectAllKinme() Handles m_KensakuForm.SelectAllKinme

        Const W_SUBNAME As String = "NSK0000HA m_KensakuForm_SelectAllKinme"

        Const W_MIWARIATE As Integer = 0 '未割当を検索
        Const w_Kinmu As Integer = 1 '勤務ｺｰﾄﾞのみを検索
        Const W_TAISYO As Integer = 2 '対象のみを検索
        Const W_TAISYOKINMU As Integer = 3 '対象理由かつ勤務ｺｰﾄﾞを検索

        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_BlockColS As Integer
        Dim w_BlockFlg As Boolean
        Dim w_Bool As Boolean
        Dim w_OKNGFlg As Boolean '検索一致ﾌﾗｸﾞ(True:一致,False:一致していない)
        Dim w_KekkaFlg As Boolean '検索結果ﾌﾗｸﾞ(True:検索条件勤務有,False:検索勤務条件無)
        Dim w_Var As Object
        Dim w_KensakuType As Integer 'どういう条件で検索するか
        Dim w_GssbText As String 'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞ退避
        Dim w_FirstSelect As Boolean 'すでにｾﾙﾌﾞﾛｯｸが選択状態にあるかどうか(True:選択状態,False:未選択状態)
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_KikanStartCol As Integer
        Dim w_KikanEndCol As Integer
        Dim w_Int As Integer
        Dim w_MsgRc As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_targetTeamFlg As Boolean = False
        Try
            Me.Refresh()
            '検索結果ﾌﾗｸﾞ初期化
            w_KekkaFlg = False
            '選択状態ﾌﾗｸﾞ初期化
            w_FirstSelect = False

            '検索条件を設定
            If m_KensakuForm.pKensakuKinmuCD = "000" Then
                '検索勤務が未割当
                If Double.Parse(m_KensakuForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = W_MIWARIATE
                Else
                    If m_KensakuForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_MIWARIATE
                    End If
                End If
            Else
                '検索勤務ｺｰﾄﾞが選択されているとき
                If Double.Parse(m_KensakuForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = w_Kinmu
                Else
                    If m_KensakuForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_TAISYOKINMU
                    End If
                End If
            End If

            'ｽﾃｰﾀｽﾊﾞｰﾒｯｾｰｼﾞ退避
            w_GssbText = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

            '検索中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SEARCH_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月表示画面の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_KeikakuKikan.KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_KeikakuKikan.KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 1
            Else
                '4週表示画面の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 2
            End If

            With m_Spread(w_Int).Sheets(0)

                '表示期間の全て
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                    w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                    w_targetTeamFlg = False
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) Then
                            If Integer.Parse(w_Var) = m_SelTeamNo OrElse m_SelTeamNo = 0 Then
                                w_targetTeamFlg = True
                            End If
                        End If
                    End If

                    If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                    ElseIf (((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki)) AndAlso w_targetTeamFlg Then
                        '勤務のみ検索

                        'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                        w_BlockFlg = False

                        For w_Col = w_KikanStartCol To w_KikanEndCol

                            '検索一致ﾌﾗｸﾞ初期化
                            w_OKNGFlg = True

                            'ｾﾙﾃﾞｰﾀの取得
                            w_Var = .GetText(w_Row, w_Col)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            '勤務記号文字列を各データ毎に分割
                            '2015/04/10 Bando Upd Start =========================================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   =========================================

                            Select Case w_KensakuType
                                Case W_MIWARIATE
                                    '未割当を検索
                                    If w_KinmuCD = "" AndAlso w_BlockFlg = False Then
                                        w_BlockFlg = True
                                        w_BlockColS = w_Col
                                    ElseIf w_KinmuCD <> "" Then
                                        w_OKNGFlg = False
                                    End If
                                Case w_Kinmu
                                    '勤務ｺｰﾄﾞで検索
                                    If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) AndAlso w_BlockFlg = False Then
                                        w_BlockFlg = True
                                        w_BlockColS = w_Col
                                    ElseIf Trim(w_KinmuCD) <> Trim(m_KensakuForm.pKensakuKinmuCD) Then
                                        w_OKNGFlg = False
                                    End If
                                Case W_TAISYO
                                    '対象(理由区分)で検索
                                    If w_RiyuKBN = m_KensakuForm.pKensakuTaisyo AndAlso w_BlockFlg = False Then
                                        w_BlockFlg = True
                                        w_BlockColS = w_Col
                                    ElseIf w_RiyuKBN <> m_KensakuForm.pKensakuTaisyo Then
                                        w_OKNGFlg = False
                                    End If
                                Case W_TAISYOKINMU
                                    '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                    If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_KensakuForm.pKensakuTaisyo AndAlso w_BlockFlg = False Then
                                        w_BlockFlg = True
                                        w_BlockColS = w_Col
                                    ElseIf Trim(w_KinmuCD) <> Trim(m_KensakuForm.pKensakuKinmuCD) OrElse w_RiyuKBN <> m_KensakuForm.pKensakuTaisyo Then
                                        w_OKNGFlg = False
                                    End If
                            End Select

                            '検索条件の勤務群を選択状態にする
                            If (w_BlockFlg = True AndAlso w_OKNGFlg = False) Then

                                '検索を始めて1回目の選択の場合
                                If w_FirstSelect = False Then
                                    .ClearSelection()
                                    w_FirstSelect = True
                                End If

                                '複数選択を行う
                                .AddSelection(w_Row, w_BlockColS, 1, w_Col - w_BlockColS)
                                .SetActiveCell(w_Row, w_Col - 1, False)


                                'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                                w_BlockFlg = False
                                w_KekkaFlg = True

                            ElseIf (w_BlockFlg = True AndAlso w_Col = w_KikanEndCol) Then

                                '検索を始めて1回目の選択の場合
                                If w_FirstSelect = False Then
                                    '検索前の選択状態を解除
                                    .ClearSelection()
                                    w_FirstSelect = True
                                End If

                                '複数選択を行う
                                .AddSelection(w_Row, w_BlockColS, 1, w_Col - w_BlockColS + 1)
                                .SetActiveCell(w_Row, w_Col, False)
                                'ﾌﾞﾛｯｸﾌﾗｸﾞを初期化する
                                w_BlockFlg = False
                                w_KekkaFlg = True

                            End If
                        Next w_Col
                    End If
                Next w_Row
            End With

            'ｽﾃｰﾀｽﾊﾞｰﾒｯｾｰｼﾞを元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
            sbrMain.Refresh()

            If w_KekkaFlg = False Then
                '検索の結果なかった場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "検索条件に当てはまる勤務が"
                Call Set_MsgZOrder("NS0113", w_strMsg, w_MsgRc, 0)
            End If

            Call General.paSetFocus(m_Spread(w_Int))

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '１個ずつ検索
    Private Sub m_KensakuForm_SelectKinmu() Handles m_KensakuForm.SelectKinmu

        Const W_SUBNAME As String = "NSK0000HA m_KensakuForm_SelectKinmu"

        Const W_MIWARIATE As Integer = 0 '未割当を検索
        Const w_Kinmu As Integer = 1 '勤務ｺｰﾄﾞのみを検索
        Const W_TAISYO As Integer = 2 '対象のみを検索
        Const W_TAISYOKINMU As Integer = 3 '対象理由かつ勤務ｺｰﾄﾞを検索

        Dim w_ActiveRow As Integer '現在のｱｸﾃｨﾌﾞRow
        Dim w_ActiveCol As Integer '現在のｱｸﾃｨﾌﾞCol
        Dim w_ActionRow As Integer '検索条件に当てはまったRow
        Dim w_ActionCol As Integer '検索条件に当てはまったCol
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_StartRow As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_EndRow As Integer
        Dim w_Bool As Boolean
        Dim w_KensakuOKFlg As Boolean '検索結果ﾌﾗｸﾞ(True:見つかった,False:見つかっていない)
        Dim w_Var As Object
        Dim w_KensakuType As Integer 'どういう条件で検索するか
        Dim w_GssbText As String 'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞ退避
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Static w_StartCell_Flg As Boolean
        Static w_KensakuStartRow As Integer
        Static w_KensakuStartCol As Integer
        Dim w_KikanStartCol As Integer
        Dim w_KikanEndCol As Integer
        Dim w_Int As Integer
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Dim w_KangoCD As String = String.Empty
        Dim w_targetTeamFlg As Boolean = False

        '検索結果ﾌﾗｸﾞの初期化
        w_KensakuOKFlg = False
        Try
            '検索条件を設定
            If m_KensakuForm.pKensakuKinmuCD = "000" Then
                '検索勤務が未割当
                If Double.Parse(m_KensakuForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = W_MIWARIATE
                Else
                    If m_KensakuForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_MIWARIATE
                    End If
                End If
            Else
                '検索勤務ｺｰﾄﾞが選択されているとき
                If Double.Parse(m_KensakuForm.pKensakuTaisyo) = 0 Then
                    '対象が "すべて"
                    w_KensakuType = w_Kinmu
                Else
                    If m_KensakuForm.pTaisyoOnly = 1 Then
                        '対象のみ
                        w_KensakuType = W_TAISYO
                    Else
                        w_KensakuType = W_TAISYOKINMU
                    End If
                End If
            End If

            'ｽﾃｰﾀｽﾊﾞｰﾒｯｾｰｼﾞ退避
            w_GssbText = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

            '検索中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SEARCH_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 OrElse m_SelViewKikan > UBound(m_4WeekKikan) Then
                '1ｹ月表示画面の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_KeikakuKikan.KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_KeikakuKikan.KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 1
            Else
                '4週表示画面の場合
                '勤務ﾃﾞｰﾀ開始列格納
                w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_KikanEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                '表示ｽﾌﾟﾚｯﾄﾞ番号格納
                w_Int = 2
            End If

            With m_Spread(w_Int).Sheets(0)

                '現在のActiveRow，Col取得
                w_ActiveRow = .ActiveRow.Index
                w_ActiveCol = .ActiveColumn.Index

                'ｱｸﾃｨﾌﾞｾﾙがﾃﾞｰﾀ領域内になければﾃﾞｰﾀ領域内の左上から検索
                If w_ActiveRow < m_StaffRow.StartRow OrElse w_ActiveRow > m_StaffRow.EndRow Then
                    w_ActiveRow = m_StaffRow.StartRow
                    w_ActiveCol = w_KikanStartCol
                End If
                If w_ActiveCol < w_KikanStartCol OrElse w_ActiveCol > w_KikanEndCol Then
                    w_ActiveRow = m_StaffRow.StartRow
                    w_ActiveCol = w_KikanStartCol
                End If

                'もしｱｸﾃｨﾌﾞｾﾙの列が最終列ならば1つ下の行から検索開始
                If w_ActiveCol = w_KikanEndCol Then
                    If w_ActiveRow = m_StaffRow.EndRow Then
                        'ｱｸﾃｨﾌﾞｾﾙの行が最終行ならば先頭行から検索開始
                        w_StartRow = m_StaffRow.StartRow
                    Else
                        w_StartRow = w_ActiveRow + 1
                    End If
                Else
                    '検索開始行はそのまま
                    w_StartRow = w_ActiveRow
                End If

                'ｱｸﾃｨﾌﾞｾﾙの次のｾﾙから検索
                For w_Row = w_StartRow To m_StaffRow.EndRow
                    w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                    w_targetTeamFlg = False
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) Then
                            If Integer.Parse(w_Var) = m_SelTeamNo OrElse m_SelTeamNo = 0 Then
                                w_targetTeamFlg = True
                            End If
                        End If
                    End If

                    If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                    ElseIf (((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki)) AndAlso w_targetTeamFlg Then
                        '勤務のみ検索

                        If w_Row > w_StartRow Then
                            w_StartCol = w_KikanStartCol
                        Else
                            If w_ActiveCol = w_KikanEndCol Then
                                w_StartCol = w_KikanStartCol
                            Else
                                w_StartCol = w_ActiveCol + 1
                            End If
                        End If

                        For w_Col = w_StartCol To w_KikanEndCol

                            If w_StartCell_Flg = False Then
                                '検索ｽﾀｰﾄｾﾙを保持する
                                w_KensakuStartRow = w_StartRow
                                w_KensakuStartCol = w_StartCol
                                w_StartCell_Flg = True
                            Else
                                '検索が1周したかどうか
                                If w_Row = w_KensakuStartRow AndAlso w_Col = w_KensakuStartCol Then
                                    'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞを元に戻す
                                    sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
                                    sbrMain.Refresh()
                                    '検索終了メッセージ表示
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "検索"
                                    Call Set_MsgZOrder("NS0094", w_strMsg, w_MsgRc, 0)
                                    w_StartCell_Flg = False
                                    Exit Sub
                                End If
                            End If

                            'ｾﾙﾃﾞｰﾀの取得
                            w_Var = .GetText(w_Row, w_Col)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            '勤務記号文字列を各データ毎に分割
                            '2015/04/10 Bando Upd Start =========================================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   =========================================

                            Select Case w_KensakuType
                                Case W_MIWARIATE
                                    '未割当を検索
                                    If w_KinmuCD = "" Then
                                        '検索条件に当てはまったｾﾙ
                                        w_ActionRow = w_Row
                                        w_ActionCol = w_Col
                                        w_KensakuOKFlg = True
                                        Exit For
                                    End If
                                Case w_Kinmu
                                    '勤務ｺｰﾄﾞで検索
                                    If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) Then
                                        '検索条件に当てはまったｾﾙ
                                        w_ActionRow = w_Row
                                        w_ActionCol = w_Col
                                        w_KensakuOKFlg = True
                                        Exit For
                                    End If
                                Case W_TAISYO
                                    '対象(理由区分)で検索
                                    If w_RiyuKBN = m_KensakuForm.pKensakuTaisyo Then
                                        '検索条件に当てはまったｾﾙ
                                        w_ActionRow = w_Row
                                        w_ActionCol = w_Col
                                        w_KensakuOKFlg = True
                                        Exit For
                                    End If
                                Case W_TAISYOKINMU
                                    '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                    If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_KensakuForm.pKensakuTaisyo Then
                                        '検索条件に当てはまったｾﾙ
                                        w_ActionRow = w_Row
                                        w_ActionCol = w_Col
                                        w_KensakuOKFlg = True
                                        Exit For
                                    End If
                            End Select
                        Next w_Col

                        '検索結果見つかったならば For～Next 抜け出し
                        If w_KensakuOKFlg = True Then
                            Exit For
                        End If
                    End If
                Next w_Row

                'すでに検索勤務が見つかっていれば次の検索をしない
                If w_KensakuOKFlg = False Then

                    '検索開始行まで
                    w_EndRow = w_ActiveRow

                    For w_Row = m_StaffRow.StartRow To w_EndRow
                        w_Var = m_Spread(1).Sheets(0).GetText(w_Row, m_StaffZokusei(M_Team).SetCol_M)
                        w_targetTeamFlg = False
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) Then
                                If Integer.Parse(w_Var) = m_SelTeamNo OrElse m_SelTeamNo = 0 Then
                                    w_targetTeamFlg = True
                                End If
                            End If
                        End If
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        ElseIf (((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki)) AndAlso w_targetTeamFlg Then
                            '勤務のみ検索

                            If w_Row = w_EndRow Then
                                '検索開始列まで
                                w_EndCol = w_ActiveCol
                            Else
                                '検索行が途中なので最後の列まで
                                w_EndCol = w_KikanEndCol
                            End If

                            For w_Col = w_KikanStartCol To w_EndCol
                                If w_StartCell_Flg = False Then
                                    '検索ｽﾀｰﾄｾﾙを保持する
                                    w_KensakuStartRow = w_StartRow
                                    w_KensakuStartCol = w_StartCol
                                    w_StartCell_Flg = True
                                Else
                                    '検索が1周したかどうか
                                    If w_Row = w_KensakuStartRow AndAlso w_Col = w_KensakuStartCol Then
                                        'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞを元に戻す
                                        sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
                                        sbrMain.Refresh()
                                        '検索終了ﾒｯｾｰｼﾞ表示
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "検索"
                                        Call Set_MsgZOrder("NS0094", w_strMsg, w_MsgRc, 0)
                                        w_StartCell_Flg = False
                                        Exit Sub
                                    End If
                                End If

                                'ｾﾙﾃﾞｰﾀの取得
                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                '勤務記号文字列を各データ毎に分割
                                '2015/04/10 Bando Upd Start =========================================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                                '2015/04/10 Bando Upd End   =========================================

                                Select Case w_KensakuType
                                    Case W_MIWARIATE
                                        '未割当を検索
                                        If w_KinmuCD = "" Then
                                            '検索条件に当てはまったｾﾙ
                                            w_ActionRow = w_Row
                                            w_ActionCol = w_Col
                                            w_KensakuOKFlg = True
                                            Exit For
                                        End If
                                    Case w_Kinmu
                                        '勤務ｺｰﾄﾞで検索
                                        If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) Then
                                            '検索条件に当てはまったｾﾙ
                                            w_ActionRow = w_Row
                                            w_ActionCol = w_Col
                                            w_KensakuOKFlg = True
                                            Exit For
                                        End If
                                    Case W_TAISYO
                                        '対象(理由区分)で検索
                                        If w_RiyuKBN = m_KensakuForm.pKensakuTaisyo Then
                                            '検索条件に当てはまったｾﾙ
                                            w_ActionRow = w_Row
                                            w_ActionCol = w_Col
                                            w_KensakuOKFlg = True
                                            Exit For
                                        End If
                                    Case W_TAISYOKINMU
                                        '勤務ｺｰﾄﾞと対象（理由区分）で検索
                                        If Trim(w_KinmuCD) = Trim(m_KensakuForm.pKensakuKinmuCD) AndAlso w_RiyuKBN = m_KensakuForm.pKensakuTaisyo Then
                                            '検索条件に当てはまったｾﾙ
                                            w_ActionRow = w_Row
                                            w_ActionCol = w_Col
                                            w_KensakuOKFlg = True
                                            Exit For
                                        End If
                                End Select
                            Next w_Col

                            '検索結果見つかったならば For～Next 抜け出し
                            If w_KensakuOKFlg = True Then
                                Exit For
                            End If
                        End If
                    Next w_Row

                End If

                'ｽﾃｰﾀｽﾊﾞｰのﾒｯｾｰｼﾞを元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_GssbText
                sbrMain.Refresh()

                If w_KensakuOKFlg = True Then
                    'ｱｸﾃｨﾌﾞｾﾙ設定
                    .SetActiveCell(w_ActionRow, w_ActionCol)

                    m_Spread(w_Int).ShowActiveCell(VerticalPosition.Nearest, HorizontalPosition.Nearest)
                Else
                    '検索の結果なかった場合ﾒｯｾｰｼﾞを表示
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "検索条件に当てはまる勤務"
                    Call Set_MsgZOrder("NS0008", w_strMsg, w_MsgRc, 0)
                    w_StartCell_Flg = False
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub m_KensakuForm_SetEditMenu() Handles m_KensakuForm.SetEditMenu

        Const W_SUBNAME As String = "NSK0000HA m_KensakuForm_SetEditMenu"

        Dim w_Int As Integer
        Dim w_blnFLG As Boolean
        Dim w_CellRange() As Model.CellRange
        Try
            '表示ｽﾌﾟﾚｯﾄﾞ番号格納
            If m_SelViewKikan = 0 Then
                '1ｹ月表示画面の場合
                w_Int = 1
            Else
                '4週表示画面の場合
                w_Int = 2
            End If

            'ｾﾙﾌﾞﾛｯｸが選択されているか
            w_CellRange = m_Spread(w_Int).Sheets(0).GetSelections

            If w_CellRange.Length = 0 OrElse w_CellRange.Length = 1 AndAlso w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1 Then
                w_blnFLG = False
            Else
                w_blnFLG = True
            End If

            Call Set_CopyMenu(m_Spread(w_Int).Sheets(0).ActiveColumn.Index, m_Spread(w_Int).Sheets(0).ActiveRow.Index, w_blnFLG)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub m_PaletteForm_KensakuEnabled() Handles m_PaletteForm.KensakuEnabled

        Const W_SUBNAME As String = "NSK0000HA m_PaletteForm_KensakuEnabled"
        Try
            '[表示]-[パレット]ﾒﾆｭｰ項目の横にﾁｪｯｸﾏｰｸを非表示に切替
            m_lstmnuView(M_MenuPalette).Checked = Not m_lstmnuView(M_MenuPalette).Checked
            '検索/置換画面使用可
            m_lstmnuEdit(M_MenuKensaku).Enabled = True
            m_lstmnuEdit(M_MenuChikan).Enabled = True
            m_lstmnuPopup(M_PopKensaku).Enabled = True
            m_lstmnuPopup(M_PopChikan).Enabled = True
            tbrMain.Items.Item(M_ToolBarKey_Search).Visible = True
            tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = True

            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False
            End If

            If g_LimitedFlg = True Then
                m_lstmnuEdit(M_MenuChikan).Enabled = False
                m_lstmnuPopup(M_PopChikan).Enabled = False
                tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub m_SortForm_MsgBox_Renamed(ByVal pMsgNo As String, ByRef p_strMsg As System.Array) Handles m_SortForm.MsgBox_Renamed

        Dim w_MsgRc As Integer

        Call Set_MsgZOrder(pMsgNo, p_strMsg, w_MsgRc, 0)

    End Sub

    Private Sub m_SortForm_Sort() Handles m_SortForm.Sort

        Const W_SUBNAME As String = "NSK0000HA m_SortForm_Sort"

        Dim w_str As String
        Try
            'ソート情報を設定する
            m_SortData(1).SortKeyIndex = m_SortForm.pSortKey1
            m_SortData(1).SortOrder = m_SortForm.pSortOrder1
            m_SortData(2).SortKeyIndex = m_SortForm.pSortKey2
            m_SortData(2).SortOrder = m_SortForm.pSortOrder2
            m_SortData(3).SortKeyIndex = m_SortForm.pSortKey3
            m_SortData(3).SortOrder = m_SortForm.pSortOrder3

            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text
            sbrMain.Refresh()

            'ﾃﾞｰﾀ並び替え中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SORT_STR
            sbrMain.Refresh()

            Call RunSort(True)

            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
            sbrMain.Refresh()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuCheck_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuCheck_0.Click, _mnuCheck_1.Click, _mnuCheck_2.Click,
                                                                                                                    _mnuCheck_3.Click, _mnuCheck_4.Click, _mnuCheck_5.Click,
                                                                                                                    _mnuCheck_6.Click, _mnuCheck_7.Click, _mnuCheck_8.Click,
                                                                                                                    _mnuCheck_9.Click, _mnuCheck_10.Click
        Dim Index As Integer = m_lstmnuCheck.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuCheck_Click"

        '[ﾂｰﾙ]－[ﾁｪｯｸ項目]のｻﾌﾞﾒﾆｭｰです
        'このﾒﾆｭｰは基本的にｴﾗｰﾁｪｯｸ項目を設定するためのメニューです

        Dim w_Col As Integer
        Dim w_Row As Integer
        Try
            'ﾁｪｯｸﾏｰｸを設定する
            m_lstmnuCheck(Index).Checked = Not m_lstmnuCheck(Index).Checked

            Me.Cursor = Cursors.WaitCursor

            Select Case Index

                Case M_MenuNinzuu
                    '必要人数ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                            Call Check_DayNeedNumber(w_Col)
                        Next w_Col
                    End If

                Case M_MenuGiryoCheck
                    '技量組み合わせ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuKinmuCount
                    '勤務回数ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuKinmuInterval
                    '勤務間隔ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuHolCount
                    '休日回数ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuHolInterval
                    '休日間隔ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuKinmuPattern
                    '禁止勤務ﾊﾟﾀｰﾝﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuKinsiKinmu
                    '禁止勤務ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuRenzokuKinmuInterval
                    '連続勤務ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If
                Case M_MenuAbsoluteKinmu
                    '必須勤務ﾁｪｯｸ
                    If m_lstmnuCheck(Index).Checked = True AndAlso m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = 0 Then
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, True) 'エラー用集計／チェック
                                Else
                                    Call Check_PersonalCalc(w_Row + m_KinmuPlan, False) 'エラー用集計／チェック
                                End If
                            End If
                        Next w_Row
                    End If

                Case M_MenuStaffPattern
                    '処理なし
            End Select

            '自動チェックの際は再チェック
            If m_lstmnuTool(M_MenuJidouCheck).Checked = True Then
                Call RunErrorCheck()
            End If

            Me.Cursor = Cursors.Default

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuData_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuData_0.Click, _mnuData_1.Click,
                                                                                                                    _mnuData_2.Click, _mnuData_3.Click
        Dim Index As Integer = m_lstmnuData.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuData_Click"
        Try
            '[ﾃﾞｰﾀ]のｻﾌﾞﾒﾆｭｰです
            Select Case Index

                Case M_MenuKikanSelect
                    '計画期間指定（ｻﾌﾞﾒﾆｭｰ(m_lstmnuKikan)あり）

                Case M_MenuSort
                    '職員の並び替え

                    'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
                    If m_SelViewKikan = 0 Then
                        Call BackColorPoint_Undo_M()
                    Else
                        Call BackColorPoint_Undo_4W()
                    End If

                    If m_SortForm.pShowFlg = False Then
                        '並び替え画面が表示されていないとき

                        '並び替え画面表示
                        m_SortForm.ShowDialog(Me)

                    Else
                        '並び替え画面が表示されているとき

                        '並び替え画面非表示
                        m_SortForm.Hide()
                        m_SortForm.pShowFlg = False

                    End If

                    'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
                    If m_SelViewKikan = 0 Then
                        Call BackColorPoint_Undo_M()
                    Else
                        Call BackColorPoint_Undo_4W()
                    End If

                Case M_MenuTeamSelect
                    'ﾁｰﾑ抽出（ｻﾌﾞﾒﾆｭｰ(m_lstmnuTeam)あり）

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuEdit_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuEdit_0.Click, _mnuEdit_1.Click, _mnuEdit_2.Click,
                                                                                                                    _mnuEdit_3.Click, _mnuEdit_4.Click, _mnuEdit_5.Click,
                                                                                                                    _mnuEdit_6.Click, _mnuEdit_7.Click, _mnuEdit_8.Click,
                                                                                                                    _mnuEdit_9.Click, _mnuEdit_10.Click, _mnuEdit_11.Click,
                                                                                                                    _mnuEdit_12.Click, _mnuEdit_13.Click, _mnuEdit_14.Click
        Dim Index As Integer = m_lstmnuEdit.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuEdit_Click"

        '[編集]のｻﾌﾞﾒﾆｭｰです

        Dim w_str As String
        Try
            'ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
            Me.Cursor = Cursors.WaitCursor

            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            Select Case Index

                Case M_MenuUndo
                    '元に戻す
                    '2016/04/05 Ishiga upd start---
                    'Call UndoData()
                    Call UndoData(0)
                    '2016/04/05 Ishiga upd end-----

                    '2016/04/05 Ishiga add start---
                Case M_MenuRedo
                    'やり直し
                    Call UndoData(1)
                    '2016/04/05 Ishiga add end-----

                Case M_MenuCut
                    '切り取り
                    Call CutData()

                Case M_MenuCopy
                    'コピー
                    Call CopyData()

                Case M_MenuPaste
                    '貼り付け
                    Call PasteData()

                Case M_MenuDelete
                    '削除
                    Call DeleteData()

                Case M_MenuKensaku
                    '検索
                    If m_KensakuForm.pShowFlg = False Then
                        If m_ChikanForm.pShowFlg = True Then
                            '置換画面が表示されている場合
                            m_ChikanForm.Hide()
                            m_ChikanForm.pShowFlg = False
                        End If
                        If m_EventForm.pShowFlg = True Then
                            '置換画面が表示されている場合
                            m_EventForm.Hide()
                            m_EventForm.pShowFlg = False
                        End If
                        'ﾊﾟﾚｯﾄ使用不可
                        m_lstmnuView(M_MenuPalette).Enabled = False
                        tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = False

                        '検索画面を表示する
                        m_KensakuForm.Show()
                        m_KensakuForm.pShowFlg = True
                    End If

                Case M_MenuChikan
                    '置換
                    If m_ChikanForm.pShowFlg = False Then
                        If m_KensakuForm.pShowFlg = True Then
                            '検索画面が表示されている場合
                            m_KensakuForm.Hide()
                            m_KensakuForm.pShowFlg = False
                        End If
                        If m_EventForm.pShowFlg = True Then
                            '置換画面が表示されている場合
                            m_EventForm.Hide()
                            m_EventForm.pShowFlg = False
                        End If
                        'ﾊﾟﾚｯﾄ使用不可
                        m_lstmnuView(M_MenuPalette).Enabled = False
                        tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = False

                        '置換画面を表示する
                        m_ChikanForm.Show()
                        m_ChikanForm.pShowFlg = True
                    End If

                Case M_MenuAllClear
                    '全消去
                    Call DeleteAllData()

                Case M_MenuAllClear_Normal
                    '全消去（通常のみ）
                    Call DeleteAllDataNormal()

                Case M_InputJikanNenkyu
                    '時間年休
                    Call InputJikanNenkyu()

            End Select

            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
            sbrMain.Refresh()

            'ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
            Me.Cursor = Cursors.Default

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '選択中ｾﾙを削除する
    Private Sub DeleteData_OneSel()

        Const W_SUBNAME As String = "NSK0000HA DeleteData_OneSel"

        Dim w_Col As Integer
        Dim w_Col_4W As Integer
        Dim w_Col_M As Integer
        Dim w_Row As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Bool As Boolean
        Dim w_KikanStartCol As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_Int2 As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_CellRange() As Model.CellRange
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        ''UndoData用配列　定義
        ''2016/04/05 Ishiga upd start---------------------------
        ''ReDim m_UndoData(0)
        'm_UndoKaisu = m_UndoKaisu + 1
        'If m_UndoMaxKensu < m_UndoKaisu Then
        '    m_UndoKaisu = m_UndoMaxKensu
        'End If

        'm_UndoIdx = m_UndoIdx + 1
        'm_UndoIdxHendou = m_UndoIdxHendou + 1
        ''2016/04/05 Ishiga upd end-----------------------------
        'ReDim m_KojyoUndoData(0)
        '----------------------------------------------------------------------------------------------------
        Try
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                With sprSheet_M.Sheets(0)

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    If w_EndRow > m_StaffRow.EndRow Then
                        w_EndRow = m_StaffRow.EndRow
                    End If

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_EndCol <= m_KeikakuKikan.KinmuDataEndCol)) Then
                        'ERROR
                        Exit Sub
                    End If

                    w_Int2 = 0

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ削除

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務を"
                                    Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                '勤務ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得
                                w_Cnt = -1
                                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                    '1ｹ月/1ｹ月,4週/4週の場合
                                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                    '4週/1ｹ月の場合
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                        If Get_Col_4W(w_Var, w_GetCol) = True AndAlso Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        End If
                                    End If
                                End If

                                If w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = True Then
                                    '再掲部署の場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        '実績ﾃﾞｰﾀの場合
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If
                                ElseIf w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = False Then
                                    '再掲部署でない場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If
                                End If
                                '#001-----St
                                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    '届出使用時は届出があれば削除不可
                                    With General.g_objSyouninData
                                        .mKC_UNIQUESEQNO = ""
                                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                        .mKC_TargetDate = w_CurrentDate

                                        If .mChkKinmuChange = False Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "届出申請済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End With
                                End If
                                '#001-----Ed
                                If General.g_lngDaikyuMng = 0 Then
                                    '代休ﾁｪｯｸ
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    w_YYYYMMDD = Integer.Parse(w_Var)
                                    If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                        Exit Sub
                                    End If
                                End If

                                w_Int2 = w_Int2 + 1
                                'ReDim Preserve m_KojyoUndoData(w_Int2) '2016/04/06 Yamanishi Del

                                '控除データを削除
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                End If
                                If IsNumeric(w_Var) = True Then
                                    w_strKojyoData = ""
                                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                            'm_KojyoUndoData(w_Int2) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                            '配列初期化
                                            m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                            Exit For
                                        End If
                                    Next
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    'UndoData格納
                    'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                    '-- 現在選択中のｾﾙ消去 ---
                    If m_MaxShowLine > 1 Then
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ削除
                                .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ削除
                                For w_Col = w_StartCol To w_EndCol
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If
                                    If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                        sprSheet_4W.Sheets(0).ClearRange(w_Row, w_Col_4W, 1, 1, False)
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    End If
                End With
            Else
                '4週画面表示中の場合

                With sprSheet_4W.Sheets(0)

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    '-- ﾃﾞｰﾀを退避領域へｺﾋﾟｰ -------------
                    '選択されているｾﾙﾌﾞﾛｯｸを取得
                    w_CellRange = .GetSelections

                    'ｾﾙﾌﾟﾛｯｸを選択か？
                    If w_CellRange.Length = 0 OrElse (w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                        '1ｾﾙ選択 の場合
                        w_StartCol = .ActiveColumn.Index
                        w_StartRow = .ActiveRow.Index
                        w_EndCol = .ActiveColumn.Index
                        w_EndRow = .ActiveRow.Index
                    Else
                        'ｾﾙﾌﾟﾛｯｸ選択 の場合
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1
                    End If

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                        'ERROR
                        Exit Sub
                    End If

                    w_Int2 = 0

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ削除

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1

                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務を"
                                    Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "確定済み勤務を"
                                    Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                '勤務ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得（4週/1ｹ月）
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                                    w_Cnt = w_Col - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If

                                If w_StaffIdx <> -1 AndAlso g_SaikeiFlg = True Then
                                    '再掲部署の場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        '実績ﾃﾞｰﾀの場合
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If
                                ElseIf w_StaffIdx <> -1 AndAlso g_SaikeiFlg = False Then
                                    '再掲部署以外の場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If
                                End If
                                '#001-----St
                                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    '届出使用時は届出があれば切り取り不可
                                    With General.g_objSyouninData
                                        .mKC_UNIQUESEQNO = ""
                                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                        .mKC_TargetDate = w_CurrentDate

                                        If .mChkKinmuChange = False Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "届出申請済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End With
                                End If
                                '#001-----Ed
                                If General.g_lngDaikyuMng = 0 Then
                                    '代休ﾁｪｯｸ
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    w_YYYYMMDD = Integer.Parse(w_Var)
                                    If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                        Exit Sub
                                    End If

                                    w_Int2 = w_Int2 + 1
                                    'ReDim Preserve m_KojyoUndoData(w_Int2) '2016/04/06 Yamanishi Del

                                    '控除データを削除
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    If IsNumeric(w_Var) = True Then
                                        w_strKojyoData = ""
                                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                'm_KojyoUndoData(w_Int2) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del
                                                '配列初期化
                                                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    'UndoData格納
                    'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                    '-- 現在選択中のｾﾙ消去 ---
                    If m_MaxShowLine > 1 Then
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ削除
                                .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                    End If

                    For w_Row = w_StartRow To w_EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ削除
                            For w_Col = w_StartCol To w_EndCol

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If
                                '1ヶ月用列番号取得
                                If Get_Col_M(w_Var, w_Col_M) = True Then
                                    sprSheet_M.Sheets(0).ClearRange(w_Row, w_Col_M, 1, 1, False)
                                End If
                            Next w_Col
                        End If
                    Next w_Row
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '2017/08/09 Angelo Upd st------------------------------------------------------------------------------------------------------------------------------------------------------
    'Public Sub m_lstmnuFile_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuFile_0.Click, _mnuFile_1.Click, _mnuFile_2.Click, _
    '                                                                                                                _mnuFile_3.Click, _mnuFile_4.Click, _mnuFile_5.Click, _
    '                                                                                                                _mnuFile_6.Click, _mnuFile_7.Click, _mnuFile_8.Click
    Public Sub m_lstmnuFile_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuFile_0.Click, _mnuFile_1.Click, _mnuFile_2.Click,
                                                                                                                    _mnuFile_3.Click, _mnuFile_4.Click, _mnuFile_5.Click,
                                                                                                                    _mnuFile_6.Click, _mnuFile_7.Click, _mnuFile_8.Click,
                                                                                                                    _mnuFile_9.Click
        '2017/08/09 Angelo Upd en------------------------------------------------------------------------------------------------------------------------------------------------------
        Dim Index As Integer = m_lstmnuFile.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuFile_Click"
        Try
            '[ﾌｧｲﾙ]のｻﾌﾞﾒﾆｭｰです

            Select Case Index
                Case M_MenuSave
                    '保存-継続
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        Call RunSaveKakuteiEnd()
                    Else
                        Call RunSaveContinue()
                    End If

                Case M_MenuWrite
                    'ﾃｷｽﾄ形式に書き込み（保存）
                    Call RunSaveStart()

                Case M_MenuLoad
                    'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
                    If m_SelViewKikan = 0 Then
                        Call BackColorPoint_Undo_M()
                    Else
                        Call BackColorPoint_Undo_4W()
                    End If

                    'ﾃｷｽﾄﾃﾞｰﾀ読み込み（開く）
                    Call RunLoadStart()

                Case M_MenuPrint
                    '印刷
                    Call RunPrint()

                '2017/08/09 Angelo Add st--------------------
                Case M_MenuSaveCall
                    '保存呼出
                    Call RunSaveCall()

                    '適用ボタン押下時のみ処理続行
                    If m_blnSaveCallApplyFLG = True Then
                        m_EndFlg = M_MenuSave
                        'ﾌｫｰﾑ ｱﾝﾛｰﾄﾞ
                        Me.Close()
                    End If
                '2017/08/09 Angelo Add en--------------------

                Case M_MenuKakutei
                    '確定保存終了
                    m_EndFlg = M_MenuKakutei
                    'ﾌｫｰﾑ ｱﾝﾛｰﾄﾞ
                    Me.Close()

                Case M_MenuEnd
                    '保存終了
                    m_EndFlg = M_MenuEnd
                    'ﾌｫｰﾑ ｱﾝﾛｰﾄﾞ
                    Me.Close()

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '2017/08/09 Angelo Add st--------------------------------------------------------------------------------
    '保存呼出実行
    Private Sub RunSaveCall()
        Const W_SUBNAME As String = "NSK0000HA RunSaveCall"
        Try
            '新規作成の場合のみ表示
            If m_PgmFlg <> General.G_PGMSTARTFLG_NEWPLAN Then
                Exit Sub
            End If

            'ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
            Cursor.Current = Cursors.WaitCursor

            'ﾊﾟﾚｯﾄ、検索･置換画面が開いている場合は閉じる
            Call HideModelessForm()

            '保存呼出画面のｲﾝｽﾀﾝｽ生成
            Using w_SaveForm As New frmNSK0000HE

                With w_SaveForm
                    .pPlanInfo(m_Display.StartDate, m_Display.EndDate) = m_PlanNo '計画期間情報
                    .pStaffData = m_StaffData '保存終了した場合の職員情報
                    .pDataSorce = sprSheet_M.Sheets(0)
                    .pKinmuDataStCol = m_KeikakuKikan.KinmuDataStartCol
                    .pKinmuDataEdCol = m_KeikakuKikan.KinmuDataEndCol
                    .pStaffRowStRow = m_StaffRow.StartRow
                    .pStaffRowEdRow = m_StaffRow.EndRow
                    .pStaffMngIDCol = m_StaffZokusei(M_StaffID).SetCol_M
                    .pDateLabelRow = M_YYYYMMDDLabel_Row
                    .pOuenStaffCnt = m_OuenStaffCnt
                    .pMaxShowLine = m_MaxShowLine
                    .pKinmuPlan = m_KinmuPlan
                    .pPackageFLG = m_PackageFLG
                    .pProcessObj = Me

                    '保存呼出画面表示
                    .ShowDialog(Me)

                    m_ProgressForm = .pProgressForm
                    m_blnSaveCallApplyFLG = .pTekiyouFlg '適用ボタン終了フラグ（True:適用ボタン押下時）
                    m_intNextFormSaveNo = .pSelSaveNo '選択された保存番号
                End With
            End Using

            Cursor.Current = Cursors.Default
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2017/08/09 Angelo Add en--------------------------------------------------------------------------------

    'ﾃｷｽﾄ保存
    Private Sub RunSaveStart()

        Const W_SUBNAME As String = "NSK0000HA RunSaveStart"

        Dim w_str As String
        Dim w_FilePath As String
        Dim w_DefaultPath As String
        Try
            '保存先取得
            w_DefaultPath = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SAVEPATH", "", General.g_strHospitalCD)

            'ﾌｧｲﾙ保存ﾀﾞｲｱﾛｸﾞﾌﾟﾛﾊﾟﾃｨ設定
            cdlFileOpen.Title = "ファイルの保存"
            cdlFileSave.Title = "ファイルの保存"
            cdlFileOpen.DefaultExt = "KKD"
            cdlFileSave.DefaultExt = "KKD"
            cdlFileOpen.Filter = "計画ﾃﾞｰﾀﾌｧｲﾙ(*.KKD)|*.KKD"
            cdlFileSave.Filter = "計画ﾃﾞｰﾀﾌｧｲﾙ(*.KKD)|*.KKD"
            cdlFileOpen.FilterIndex = 1
            cdlFileSave.FilterIndex = 1
            cdlFileOpen.ShowReadOnly = False
            cdlFileSave.OverwritePrompt = True
            cdlFileOpen.CheckPathExists = True
            cdlFileSave.CheckPathExists = True
            cdlFileOpen.InitialDirectory = w_DefaultPath
            cdlFileSave.InitialDirectory = w_DefaultPath

            'ﾌｧｲﾙ保存ﾀﾞｲｱﾛｸﾞ表示
            Call Set_DialogZOrder(1)
            If cdlFileSave.ShowDialog(Me) = Windows.Forms.DialogResult.OK Then
                cdlFileOpen.FileName = cdlFileSave.FileName
                Call Set_DialogZOrder(0)

                '保存するﾌｧｲﾙﾊﾟｽ取得
                w_FilePath = cdlFileOpen.FileName

                '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                'ﾌｧｲﾙｵｰﾌﾟﾝ時 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_SAVE_STR
                sbrMain.Refresh()

                'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
                Me.Cursor = Cursors.WaitCursor

                'ﾃﾞｰﾀ保存
                Call RunSaveFile_KSave(w_FilePath)

                'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
                Me.Cursor = Cursors.Default

                'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
                sbrMain.Refresh()
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾃｷｽﾄ保存 実行
    Private Sub RunSaveFile_KSave(ByVal p_FilePath As String)

        Const W_SUBNAME As String = "NSK0000HA RunSaveFile_KSave"

        Dim w_FileNo As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_Int As Integer
        Dim w_StrData As String
        Dim w_Hospital As String
        Dim w_Kango As String
        Dim w_No As String
        Dim w_Cnt As Integer
        Dim w_str As String
        Dim w_Var As Object
        Dim w_StaffIdx As Integer
        Try
            '-------------------------
            '   ﾃｷｽﾄﾌｧｲﾙ作成
            '-------------------------
            '使用可能なﾌｧｨﾙNO 取得
            w_FileNo = FreeFile()

            'ﾃｷｽﾄﾌｧｲﾙ OPEN
            FileOpen(w_FileNo, p_FilePath, OpenMode.Output, OpenAccess.Write, OpenShare.LockReadWrite)

            'ﾃｷｽﾄﾃﾞｰﾀ 初期化
            w_StrData = ""
            w_StrData = M_TextFileHeader_NsAidKey
            'ﾃｷｽﾄﾃﾞｰﾀ 追加(ﾚｺｰﾄﾞ更新)
            PrintLine(w_FileNo, w_StrData)

            'ﾃｷｽﾄﾃﾞｰﾀ 初期化
            w_StrData = ""
            '病院ｺｰﾄﾞ
            w_Hospital = Trim(General.g_strHospitalCD)
            w_Hospital = w_Hospital & Space(2 - Len(w_Hospital))
            '看護単位ｺｰﾄﾞ
            w_Kango = Trim(General.g_strSelKinmuDeptCD)
            w_Kango = w_Kango & Space(10 - Len(w_Kango))

            '計画番号
            w_No = Trim(Convert.ToString(m_PlanNo))
            w_No = w_No & Space(4 - Len(w_No))
            'ﾃｷｽﾄﾃﾞｰﾀ作成
            w_StrData = w_Hospital & Space(1) & w_Kango & Space(1) & w_No
            'ﾃｷｽﾄﾃﾞｰﾀ 追加(ﾚｺｰﾄﾞ更新)
            PrintLine(w_FileNo, w_StrData)

            'ﾃｷｽﾄﾌｧｲﾙ 編集
            'ﾃﾞｰﾀ範囲 繰り返し
            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)

                'ﾃｷｽﾄﾃﾞｰﾀ 初期化
                w_StrData = ""

                w_StaffIdx = 0

                '職員管理番号 取得
                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                If w_Var <> "" Then
                    'ﾃｷｽﾄ取得OK
                    w_str = Trim(w_Var)
                    w_str = w_str & Space(10 - Len(w_str))
                    w_StrData = w_str
                End If

                'ｶｳﾝﾄ変数初期化
                w_Cnt = 0

                '計画期間 開始日 ～ 計画期間 終了日 ﾃﾞｰﾀ取得
                For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                    If w_Var <> "" Then
                        'ﾃｷｽﾄ取得OK
                        w_str = General.paRight(w_Var, 127)
                        w_str = w_str & Space(127 - Len(w_str))
                        w_StrData = w_StrData & w_str
                    Else
                        'w_StrData = w_StrData & "00000" & Space(54)
                        w_StrData = w_StrData & "00000" & Space(122)
                    End If

                    'ｶｳﾝﾄｱｯﾌﾟ
                    w_Cnt = w_Cnt + 1
                Next w_Col

                '31日に満たない場合はｽﾍﾟｰｽを挿入
                If w_Cnt < 31 Then
                    For w_Int = w_Cnt + 1 To 31
                        w_StrData = w_StrData & Space(127)
                    Next w_Int
                End If

                'ﾃｷｽﾄﾃﾞｰﾀ 追加(ﾚｺｰﾄﾞ更新)
                PrintLine(w_FileNo, w_StrData)
            Next w_Row

            'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
            FileClose(w_FileNo)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '保存ﾃﾞｰﾀ 開く
    Private Sub RunLoadStart()

        Const W_SUBNAME As String = "NSK0000HA RunSaveStart"

        Dim w_str As String
        Dim w_FilePath As String
        Dim w_FileTitle As String
        Try
            'ﾌｧｲﾙ開くﾀﾞｲｱﾛｸﾞﾌﾟﾛﾊﾟﾃｨ設定
            cdlFileOpen.Title = "ファイルを開く"
            cdlFileSave.Title = "ファイルを開く"
            cdlFileOpen.DefaultExt = "KKD"
            cdlFileSave.DefaultExt = "KKD"
            cdlFileOpen.Filter = "計画ﾃﾞｰﾀﾌｧｲﾙ(*.KKD)|*.KKD"
            cdlFileSave.Filter = "計画ﾃﾞｰﾀﾌｧｲﾙ(*.KKD)|*.KKD"
            cdlFileOpen.FilterIndex = 1
            cdlFileSave.FilterIndex = 1
            cdlFileOpen.CheckFileExists = True
            cdlFileOpen.CheckPathExists = True
            cdlFileSave.CheckPathExists = True
            cdlFileOpen.ShowReadOnly = False
            cdlFileOpen.InitialDirectory = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SAVEPATH", "", General.g_strHospitalCD)
            cdlFileSave.InitialDirectory = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "SAVEPATH", "", General.g_strHospitalCD)

            'ﾌｧｲﾙ開くﾀﾞｲｱﾛｸﾞ表示
            If cdlFileOpen.ShowDialog(Me) = Windows.Forms.DialogResult.OK Then
                cdlFileSave.FileName = cdlFileOpen.FileName

                '開くﾌｧｲﾙのﾊﾟｽとﾌｧｲﾙ名取得
                w_FilePath = cdlFileOpen.FileName
                w_FileTitle = cdlFileOpen.FileName

                '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                'ﾌｧｲﾙｵｰﾌﾟﾝ時 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_LOAD_STR
                sbrMain.Refresh()

                'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
                Me.Cursor = Cursors.WaitCursor

                'ﾃｷｽﾄﾌｧｲﾙ 取得
                Call RunLoadFile_KLoad(w_FilePath, w_FileTitle)

                'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
                Me.Cursor = Cursors.Default

                'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
                sbrMain.Refresh()
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾌｧｲﾙ開く 実行
    Private Sub RunLoadFile_KLoad(ByVal p_FilePath As String, ByVal p_FileTitle As String)

        Const W_SUBNAME As String = "NSK0000HA RunLoadFile_KLoad"

        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_MidIndex As Integer
        Dim w_Var As Object
        Dim w_StrData As String
        Dim w_FileStaffID As String
        Dim w_str As String
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_FileNo As Integer
        Dim w_Flg As Boolean
        Dim w_KeikakuFlg As Boolean
        Dim w_Int As Integer
        Dim w_HospitalCD As String
        Dim w_KangoTCD As String
        Dim w_No As Integer
        Dim w_MsgRc As Integer
        Dim w_Text As Object
        Dim w_Bool As Boolean
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_Col_4W As Integer
        Dim w_Cnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_StartCol As Integer
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_StartRow As Integer
        Try
            '-------------------------
            '   ﾃｷｽﾄﾌｧｲﾙを読み込む
            '-------------------------
            '使用可能なﾌｧｨﾙNO 取得
            w_FileNo = FreeFile()

            'ﾃｷｽﾄﾌｧｲﾙ OPEN
            FileOpen(w_FileNo, p_FilePath, OpenMode.Input, OpenAccess.Read)

            'ﾃｷｽﾄﾌｧｲﾙ READ
            w_StrData = LineInput(w_FileNo)

            '計画ﾃﾞｰﾀﾌｧｲﾙかどうか
            If w_StrData <> M_TextFileHeader_NsAidKey Then
                ReDim w_strMsg(1)
                w_strMsg(1) = p_FileTitle
                Call Set_MsgZOrder("NS0102", w_strMsg, w_MsgRc, 0)
                'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
                FileClose(w_FileNo)
                Exit Sub
            End If

            'ﾃｷｽﾄﾌｧｲﾙ READ
            w_StrData = LineInput(w_FileNo)

            w_HospitalCD = Mid(w_StrData, 1, 2)
            w_KangoTCD = Mid(w_StrData, 4, 10)
            If Trim(w_HospitalCD) <> General.g_strHospitalCD Then
                ReDim w_strMsg(2)
                w_strMsg(1) = p_FileTitle
                w_strMsg(2) = "施設"
                Call Set_MsgZOrder("NS0103", w_strMsg, w_MsgRc, 0)
                'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
                FileClose(w_FileNo)
                Exit Sub
            End If
            If Trim(w_KangoTCD) <> General.g_strSelKinmuDeptCD Then
                ReDim w_strMsg(2)
                w_strMsg(1) = p_FileTitle
                w_strMsg(2) = "勤務部署"
                Call Set_MsgZOrder("NS0103", w_strMsg, w_MsgRc, 0)
                'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
                FileClose(w_FileNo)
                Exit Sub
            End If

            '計画番号ﾁｪｯｸ
            w_No = Integer.Parse(Trim(Mid(w_StrData, 15, 4)))
            If w_No <> m_PlanNo Then
                ReDim w_strMsg(2)
                w_strMsg(1) = "計画番号"
                w_strMsg(2) = "開いても"
                Call Set_MsgZOrder("NS0104", w_strMsg, w_MsgRc, 0)
                If w_MsgRc = MsgBoxResult.No Then
                    'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
                    FileClose(w_FileNo)
                    Exit Sub
                End If
            End If

            With sprSheet_M.Sheets(0)

                '職員管理番号の取得
                Dim w_StaffID(m_StaffRow.EndRow) As String

                'ﾃﾞｰﾀ範囲 繰り返し
                '計画画面複数段対応
                For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                    w_StaffID(Integer.Parse(w_Row)) = Convert.ToString(w_Var)
                Next w_Row

                '初期化
                w_StartRow = m_StaffRow.StartRow

                'ﾃｷｽﾄﾌｧｲﾙ 編集
                'ﾃﾞｰﾀ範囲 繰り返し
                Do Until EOF(w_FileNo)

                    'ﾃｷｽﾄﾌｧｲﾙ READ
                    w_StrData = LineInput(w_FileNo)

                    '職員IDの取得
                    w_FileStaffID = Trim(Mid(w_StrData, 1, 10))

                    'ｽﾌﾟﾚｯﾄﾞに格納されている列を取得
                    w_Flg = False

                    '計画画面複数段対応
                    For w_Row = w_StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                        If w_FileStaffID = Trim(w_StaffID(w_Row)) Then
                            w_Flg = True
                            Exit For
                        End If
                    Next w_Row

                    If w_Flg = True Then

                        '抜き出す位置 変数 初期化
                        w_MidIndex = 11

                        'ｽﾌﾟﾚｯﾄﾞの最初の列設定
                        w_Col = m_KeikakuKikan.KinmuDataStartCol
                        w_KeikakuFlg = True

                        '計画期間 開始日 ～ 計画期間 終了日 ﾃﾞｰﾀ取得
                        For w_Int = 1 To 31
                            '対象文字列 抽出
                            w_str = Trim(Mid(w_StrData, w_MidIndex, 127))

                            '勤務記号の文字列 作成 & 設定
                            '2015/04/10 Bando Upd Start =========================================
                            'Call Get_KinmuMark(w_str, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_str, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   =========================================

                            '計画期間内ならばﾃﾞｰﾀ書込み
                            If w_KeikakuFlg = True Then
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    '他部署の場合
                                ElseIf w_str = "00000" OrElse Trim(w_str) = "" Then
                                    '未割当の場合

                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Cnt = 0
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_Var, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            End If
                                        End If
                                    End If

                                    '配列番号 取得
                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        '職員管理番号 取得
                                        If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績データのとき
                                        Else
                                            w_Var = ""
                                            .SetText(w_Row, w_Col, w_Var)

                                            '理由区分による色設定(文字色/背景色)
                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                        End If
                                    End If
                                Else
                                    '勤務記号取得
                                    '2015/04/10 Bando Upd Start =========================================
                                    'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                    w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                                    '2015/04/10 Bando Upd End   =========================================
                                    .SetText(w_Row, w_Col, w_Var)

                                    '理由区分による色設定(文字色/背景色)
                                    If w_RiyuKBN = "1" Then
                                        '通常
                                        w_ForeColor = ColorTranslator.ToOle(Color.Black)
                                        w_BackColor = ColorTranslator.ToOle(Color.White)
                                    ElseIf w_RiyuKBN = "2" Then
                                        '要請勤務 文字/背景色
                                        w_ForeColor = m_Yousei_Fore
                                        w_BackColor = m_Yousei_Back
                                    ElseIf w_RiyuKBN = "3" Then
                                        '希望勤務 文字/背景色
                                        w_ForeColor = m_Kibou_Fore
                                        w_BackColor = m_Kibou_Back
                                    ElseIf w_RiyuKBN = "4" Then
                                        '再掲勤務 文字/背景色
                                        w_ForeColor = m_Saikei_Fore
                                        w_BackColor = m_Saikei_Back
                                    ElseIf w_RiyuKBN = "5" Then
                                        '委員会勤務 文字/背景色
                                        w_ForeColor = m_Iin_Fore
                                        w_BackColor = m_Iin_Back
                                    ElseIf w_RiyuKBN = "6" Then
                                        '応援勤務　文字/背景色
                                        w_ForeColor = m_Ouen_Fore
                                        w_BackColor = m_Ouen_Back
                                    End If

                                    '時間年休がある場合
                                    If w_Time <> "" Then
                                        w_ForeColor = m_KinmuTime_Fore
                                        w_BackColor = m_KinmuTime_Back
                                    End If

                                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If
                                        w_Text = w_Var

                                        w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                        w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If
                                        If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                            sprSheet_4W.Sheets(0).SetText(w_Row, w_Col_4W, w_Text)
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).BackColor = ColorTranslator.FromOle(w_BackColor)
                                        End If
                                    End If
                                End If
                            End If

                            '計画期間内の最終ならばFlgをFalseに
                            If w_Col = m_KeikakuKikan.KinmuDataEndCol Then
                                w_KeikakuFlg = False
                            End If
                            'ｽﾌﾟﾚｯﾄﾞの列設定 ｶｳﾝﾄｱｯﾌﾟ
                            w_Col = w_Col + 1
                            '抜き出す位置 ｶｳﾝﾄｱｯﾌﾟ
                            w_MidIndex = w_MidIndex + 127
                        Next w_Int

                        '行をカウント
                        w_StartRow = w_StartRow + 1
                    End If
                Loop

                'ﾃｷｽﾄﾌｧｲﾙ ｸﾛｰｽﾞ
                FileClose(w_FileNo)

                '配列の解放
                System.Array.Clear(w_StaffID, 0, w_StaffID.Length)
            End With

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            'UndoDataｸﾘｱ
            Call UndoData_Clear()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾒｯｾｰｼﾞ表示の時のﾊﾟﾚｯﾄ/検索等のZorder制御
    '引数 :     vbBringToFront  0   最前面に移動
    '           vbSendToBack    1   最背面へ移動
    Private Sub Set_DialogZOrder(ByVal p_ZorderFlg As Integer)

        Const W_SUBNAME As String = "NSK0000HA Set_DialogZOrder"
        Try
            '表示されている場合
            If p_ZorderFlg = 1 Then

                'ﾊﾟﾚｯﾄが表示されている場合
                If m_lstmnuView(M_MenuPalette).Checked = True Then
                    'ﾊﾟﾚｯﾄの表示位置の最上位設定をはずす
                    Call General.paNotTopPos(m_PaletteForm)
                End If

                '検索画面が表示されている場合
                If m_KensakuForm.pShowFlg = True Then
                    '検索の表示位置の最上位設定をはずす
                    Call General.paNotTopPos(m_KensakuForm)
                End If

                '置換画面が表示されている場合
                If m_ChikanForm.pShowFlg = True Then
                    '置換の表示位置の最上位設定をはずす
                    Call General.paNotTopPos(m_ChikanForm)
                End If

                '並び替え画面が表示されている場合
                If m_SortForm.pShowFlg = True Then
                    '並び替えの表示位置の最上位設定をはずす
                    Call General.paNotTopPos(m_SortForm)
                End If

                '行事一覧画面が表示されている場合
                If m_EventForm.pShowFlg = True Then
                    '並び替えの表示位置の最上位設定をはずす
                    Call General.paNotTopPos(m_EventForm)
                End If
            Else
                'ﾊﾟﾚｯﾄが表示されている場合
                If m_lstmnuView(M_MenuPalette).Checked = True Then
                    'ﾊﾟﾚｯﾄ画面を最上位に設定する
                    Call General.paSetDialogPos(m_PaletteForm)
                End If

                '検索画面が表示されている場合
                If m_KensakuForm.pShowFlg = True Then
                    '検索画面を最上位に設定する
                    Call General.paSetDialogPos(m_KensakuForm)
                End If

                '置換画面が表示されている場合
                If m_ChikanForm.pShowFlg = True Then
                    '置換画面を最上位に設定する
                    Call General.paSetDialogPos(m_ChikanForm)
                End If

                '並び替え画面が表示されている場合
                If m_SortForm.pShowFlg = True Then
                    '並び替え画面を最上位に設定する
                    Call General.paSetDialogPos(m_SortForm)
                End If

                '行事一覧画面が表示されている場合
                If m_EventForm.pShowFlg = True Then
                    '並び替えの表示位置の最上位設定をはずす
                    Call General.paSetDialogPos(m_EventForm)
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾃﾞｰﾀの保存-継続
    Private Sub RunSaveContinue()

        Const W_SUBNAME As String = "NSK0000HA RunSaveContinue"

        Dim w_MsgAns As Integer
        Dim w_MsgStr As String
        Dim w_ExclusionFlg As Boolean
        Dim w_frmProcess As Form
        Dim w_OrderIF_Data As String
        Dim w_strMsg() As String
        Try
            '編集中のﾃﾞｰﾀ更新確認ﾒｯｾｰｼﾞ表示
            If g_SaikeiFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = "（すでに各部署で勤務データを保存している場合は上書きされます。）"
            Else
                ReDim w_strMsg(0)
            End If
            Call Set_MsgZOrder("NS0119", w_strMsg, w_MsgAns, 0)
            If w_MsgAns = MsgBoxResult.Yes Then
                '--- 「はい」 選択の場合 ---
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                    '実績ﾃﾞｰﾀ必須チェック
                    If ChkJissekiNull(False) = False Then
                        Exit Sub
                    End If
                End If

                '代休データ整合性チェック
                If General.g_lngDaikyuMng = 0 Then
                    If Adjust_Daikyu(1) = False Then
                        Exit Sub
                    End If
                End If

                '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                w_MsgStr = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                '計画ﾃﾞｰﾀ更新中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 表示
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_KEIKAKUSAVE_STR
                sbrMain.Refresh()
                Me.Cursor = Cursors.WaitCursor
                Me.Enabled = False

                w_frmProcess = New frmNSK0000HM
                w_frmProcess.Show()

                'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                Call General.paBeginTrans()

                w_ExclusionFlg = False

                If g_SaikeiFlg = True Then
                    '再掲部署の場合
                    Call Save_SaikeiData(w_frmProcess)
                Else
                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ 更新
                            If Save_PlanData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ(4週) 更新
                            If Save_PlanData_4W(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ 更新
                            If Save_PlanData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務実績Ｆ 更新
                            If Save_JissekiData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務実績Ｆ 更新
                            If Save_JissekiData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '時間年休を保存しにいく
                        If UpDate_JikanNenkyu() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '時間年休(4週)を保存しにいく
                        If UpDate_JikanNenkyu_4W() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '控除を保存しにいく
                        If UpDate_Kojyo() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If

                    '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------------------------------
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        Select Case m_PgmFlg
                            Case General.G_PGMSTARTFLG_NEWPLAN
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Plan, General.g_strSelKinmuDeptCD, m_PlanNo)
                            Case General.G_PGMSTARTFLG_CHANGEPLAN
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Result, General.g_strSelKinmuDeptCD, m_PlanNo)
                            Case General.G_PGMSTARTFLG_CHANGEJISSEKI
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Result, General.g_strSelKinmuDeptCD, m_PlanNo)
                        End Select
                    End If
                    '----------------------------------------------------------------------------------------------------------------------------
                End If

                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    'ｺﾐｯﾄ
                    Call General.paCommit()
                End If

                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '===============================================================
                    '   OrderInterFace 処理
                    '===============================================================
                    If General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY2, "NUSIF", "0", General.g_strHospitalCD) = "1" Then
                        '計画･実績画面からの登録(実績F/職員歴F)
                        w_OrderIF_Data = "0404"
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strHospitalCD & Space(2), 2)
                        w_OrderIF_Data = w_OrderIF_Data & Format(m_PlanNo, "000")
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strSelKinmuDeptCD & Space(10), 10)
                        '職員歴更新
                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                            '計画新規のときのみIF用職員歴更新（削除するため）
                            Call OrderIF_NS019(w_OrderIF_Data, False)
                        End If
                        '電文作成
                        Call General.paOrderInterface_NusIf(w_OrderIF_Data)
                    End If
                End If

                w_frmProcess.Close()
                w_frmProcess = Nothing

                Me.Cursor = Cursors.Default
                Me.Enabled = True

                'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_MsgStr
                sbrMain.Refresh()
            ElseIf w_MsgAns = MsgBoxResult.Cancel Then
                m_PrintFlg = False
            End If

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
            Me.Cursor = Cursors.Default
            Me.Enabled = True
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '-------------------------------------------------
    '   処　理：I/F用職員歴更新
    '   引き数：1. I/Fに引き渡す電文
    '   　　　　2. True:確定終了、False:保存終了・保存
    '   戻り値：なし
    '   作成者：S.O     2000/10/28
    '   更新者：            /  /
    '           （              ）
    '-------------------------------------------------
    Public Sub OrderIF_NS019(ByVal pData As String, ByVal pEndMode As Boolean)

        Const W_SUBNAME As String = "NSK0000HA OrderIF_NS019"

        Dim liPlanNo As Integer
        Dim lsHospitalCD As String
        Dim lsKangoTCD As String
        Dim lsSQL As String
        Dim lsSysDate As String
        Dim llRow As Integer
        Dim liStaffIdx As Integer
        Dim lvVal As Object
        Dim loLocalRS As ADODB.Recordset 'データ取得RecordSet
        Dim llStartDate As Integer 'PlanPeriodFrom
        Dim llEndDate As Integer 'PlanPeriodTo
        Dim llDataCnt As Integer '履歴件数カウント
        Dim llIndex As Integer 'ループIndex
        Dim loSaiyoData() As SaiyoData_Type '個人の採用履歴
        Dim lsPreStaffNo As String '職員番号の履歴
        Dim llPosition As Integer
        Dim llSetFrom As Integer
        Dim llSetTo As Integer
        Dim w_strPreKangoCD As String
        Dim w_intPlanNo As Integer 'PlanNo
        Dim w_lngPreTentaiDate As Integer
        Dim w_blnInsertFLG As Boolean 'I/F職員歴を追加したか否か
        Dim w_TargetDispNo As Integer
        Dim w_DispNo As Integer

        Try
            'ﾌｧｲﾙ区分（1-2）が "04" 以外の場合処理抜け出し
            If Mid(pData, 1, 2) <> "04" Then
                Exit Sub
            End If

            'ｼｽﾃﾑ日付
            lsSysDate = General.paGetDateString(Now, True)

            '-----------------------------------------------------------------
            '   3-4:処理区分 "01"職員情報設定からの登録(職員歴F)
            '　　　　        "02"職員基本情報設定からの登録(職員歴F)
            '       　　　　 "03"職種･役職異動情報設定からの登録(職員歴F)
            '       　　　　 "04"計画･実績画面からの登録(実績F/職員歴F)     **
            '       　　　　 "05"初期画面から実績変更(実績F)
            '-----------------------------------------------------------------
            Select Case Mid(pData, 3, 2)

                Case "04"
                    '連携対象表示順
                    w_TargetDispNo = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY2, "TARGETDISPNO", "1", General.g_strHospitalCD)

                    '--- 職員情報設定からの登録(職員歴F) ---

                    'ﾊﾟﾗﾒｰﾀ 取得(HospitalCD,部署CD,PlanNo)
                    lsHospitalCD = Trim(Mid(pData, 5, 2))
                    liPlanNo = Integer.Parse(Mid(pData, 7, 3))
                    lsKangoTCD = Trim(Mid(pData, 10, 10))

                    '計画番号に対する開始日と終了日を取得
                    lsSQL = ""
                    lsSQL = lsSQL & "SELECT PlanPeriodFrom, PlanPeriodTo "
                    lsSQL = lsSQL & " FROM  NS_PLANCONTROL_F "
                    lsSQL = lsSQL & "WHERE  PlanNo = " & Convert.ToString(liPlanNo) & " "
                    lsSQL = lsSQL & " AND   HospitalCD = '" & lsHospitalCD & "' "

                    loLocalRS = General.paDBRecordSetOpen(lsSQL)

                    If loLocalRS.EOF = False Then
                        '計画期間の開始日と終了日を取得（基本的に１件）
                        loLocalRS.MoveFirst()

                        llStartDate = IIf(IsDBNull(loLocalRS.Fields(0).Value), 0, loLocalRS.Fields(0).Value)
                        llEndDate = IIf(IsDBNull(loLocalRS.Fields(1).Value), 0, loLocalRS.Fields(1).Value)

                        loLocalRS.Close()
                        loLocalRS = Nothing
                    Else
                        'ありえないがこの場合は処理を終了する
                        loLocalRS.Close()
                        loLocalRS = Nothing

                        Exit Sub
                    End If

                    'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                    Call General.paBeginTrans()

                    If pEndMode = True OrElse (pEndMode = False AndAlso m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN) Then
                        '確定終了時、又は、計画新規で保存終了時に削除する（実績ﾃﾞｰﾀ(確定ﾃﾞｰﾀ)を削除するため）

                        '今回の更新する計画番号の職員歴を削除
                        lsSQL = "DELETE FROM IF_NS_STAFFHISTORY_F"
                        lsSQL = lsSQL & " WHERE KINMUDEPTCD = '" & lsKangoTCD & "'"
                        lsSQL = lsSQL & " AND PLANNO = " & Convert.ToString(liPlanNo)
                        lsSQL = lsSQL & " AND HOSPITALCD = '" & lsHospitalCD & "'"
                        Call General.paDBExecute(lsSQL)
                    End If


                    If pEndMode = True Then
                        '確定保存のときのみ更新する
                        '-----------------------------------------------------------
                        '一旦確定されている実績ﾃﾞｰﾀの保存終了時には職員歴更新を行うが、
                        'ﾃﾞｰﾀはLoad時に取得したﾃﾞｰﾀ（確定時の職員歴ﾃﾞｰﾀ）のままなので
                        'I/F用の職員歴の更新は不要とする。仮に確定時から変更があった場
                        '合は、職員情報設定画面か異動情報画面で更新されている...はず。
                        '-----------------------------------------------------------

                        'ﾃﾞｰﾀを更新
                        '計画画面複数段対応
                        For llRow = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                            If (llRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                                '配列番号 取得
                                lvVal = sprSheet_M.Sheets(0).GetText(llRow, m_StaffZokusei(M_HairetuNo).SetCol_M)

                                If IsNumeric(lvVal) = True Then
                                    '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽが取得できる場合

                                    '配列ｲﾝﾃﾞｯｸｽ取得
                                    liStaffIdx = Integer.Parse(lvVal)

                                    '計画期間に対する採用履歴を取得
                                    lsSQL = ""
                                    lsSQL = lsSQL & "SELECT EmpDate, EmpCD, RetireDate, StaffID "
                                    lsSQL = lsSQL & " FROM NS_STAFFMNGHISTORY_F "
                                    lsSQL = lsSQL & "WHERE EmpDate <= " & llEndDate & " "
                                    lsSQL = lsSQL & " AND RetireDate >= " & llStartDate & " "
                                    lsSQL = lsSQL & " AND StaffMngID = '" & m_StaffData(liStaffIdx).ID & "' "
                                    lsSQL = lsSQL & " AND   HospitalCD = '" & lsHospitalCD & "' "
                                    lsSQL = lsSQL & "ORDER BY EmpDate "

                                    loLocalRS = General.paDBRecordSetOpen(lsSQL)

                                    llDataCnt = 0
                                    ReDim loSaiyoData(0)
                                    lsPreStaffNo = ""

                                    If loLocalRS.EOF = False Then
                                        loLocalRS.MoveFirst()

                                        'この計画期間内に発生した職員採用履歴を取得
                                        Do Until loLocalRS.EOF = True
                                            llPosition = InStr(lsPreStaffNo, loLocalRS.Fields(3).Value)
                                            If llPosition = 0 Then
                                                '初めて出てきた職員番号なので配列を拡張
                                                llDataCnt = UBound(loSaiyoData) + 1
                                                ReDim Preserve loSaiyoData(llDataCnt)

                                                loSaiyoData(llDataCnt).SaiyoDate = loLocalRS.Fields(0).Value
                                                loSaiyoData(llDataCnt).SaiyoCD = loLocalRS.Fields(1).Value & ""
                                                loSaiyoData(llDataCnt).TentaiDate = IIf(IsDBNull(loLocalRS.Fields(2).Value), 99999999, loLocalRS.Fields(2).Value)
                                                loSaiyoData(llDataCnt).strStaffNo = loLocalRS.Fields(3).Value

                                                '既存の職員番号編集文字列に追加
                                                lsPreStaffNo = lsPreStaffNo & loLocalRS.Fields(3).Value & ","
                                            Else
                                                '既存の職員番号なので配列Indexを検索して採用条件CDと転退日を更新
                                                llDataCnt = (InStr(lsPreStaffNo, loLocalRS.Fields(3).Value) \ 11) + 1

                                                loSaiyoData(llDataCnt).SaiyoCD = loLocalRS.Fields(1).Value & ""
                                                loSaiyoData(llDataCnt).TentaiDate = IIf(IsDBNull(loLocalRS.Fields(2).Value), 99999999, loLocalRS.Fields(2).Value)
                                            End If

                                            loLocalRS.MoveNext()
                                        Loop
                                    End If

                                    loLocalRS.Close()
                                    loLocalRS = Nothing

                                    w_blnInsertFLG = False

                                    '各採用履歴に対して最適の勤務地を取得
                                    For llIndex = 1 To UBound(loSaiyoData)
                                        '採用日と計画期間開始日を比較して大きい方を検索開始日とする
                                        If loSaiyoData(llIndex).SaiyoDate <= llStartDate Then
                                            llSetFrom = llStartDate
                                        Else
                                            llSetFrom = loSaiyoData(llIndex).SaiyoDate
                                        End If
                                        '転退日と計画期間終了日を比較して小さい方を検索終了日とする
                                        If loSaiyoData(llIndex).TentaiDate >= llEndDate Then
                                            llSetTo = llEndDate
                                        Else
                                            llSetTo = loSaiyoData(llIndex).TentaiDate
                                        End If

                                        '勤務地異動情報をチェック
                                        lsSQL = ""
                                        lsSQL = lsSQL & "SELECT IdoDate, EndDate "
                                        lsSQL = lsSQL & " FROM NS_KINMUIDOINFO_F "
                                        lsSQL = lsSQL & " WHERE IdoDate <= " & llSetTo & " "
                                        lsSQL = lsSQL & "  AND  EndDate >= " & llSetFrom & " "
                                        lsSQL = lsSQL & "  AND  KinmuDeptCD = '" & lsKangoTCD & "' "
                                        lsSQL = lsSQL & "  AND  StaffMngID = '" & m_StaffData(liStaffIdx).ID & "' "
                                        lsSQL = lsSQL & " AND   HospitalCD = '" & lsHospitalCD & "' "
                                        lsSQL = lsSQL & "ORDER BY IdoDate "

                                        loLocalRS = General.paDBRecordSetOpen(lsSQL)

                                        If loLocalRS.EOF = True Then
                                            '異動情報が取得できなければ（通常ありえない）念のため配列の情報を取得
                                            loSaiyoData(llIndex).lngHaizoku = m_StaffData(liStaffIdx).HaizokuIF
                                            'データとして日付は取得するが、以下のｲﾝﾀｰﾌｪｰｽﾃﾞｰﾀ作成処理は行わない
                                            loSaiyoData(llIndex).blnHaizokuFLG = False
                                        Else
                                            loLocalRS.MoveFirst()
                                            '最初のレコードの異動年月日を配属年月日とする
                                            loSaiyoData(llIndex).lngHaizoku = loLocalRS.Fields(0).Value
                                            loSaiyoData(llIndex).blnHaizokuFLG = True

                                            '１名の採用の中に、１回でもｲﾝｻｰﾄ対象ﾃﾞｰﾀがある場合
                                            w_blnInsertFLG = True
                                        End If

                                        loLocalRS.Close()
                                        loLocalRS = Nothing
                                    Next llIndex

                                    If w_blnInsertFLG = True Then
                                        lsPreStaffNo = ""
                                        For llIndex = 1 To UBound(loSaiyoData)
                                            If loSaiyoData(llIndex).blnHaizokuFLG = True Then
                                                'データを登録
                                                '異動が発生した場合、前履歴のﾃﾞｰﾀの転出日を更新する。
                                                lsSQL = "SELECT PlanNo, KinmuDeptCD FROM IF_NS_STAFFHISTORY_F"
                                                lsSQL = lsSQL & " WHERE StaffMngID = '" & loSaiyoData(llIndex).strStaffNo & "'"
                                                lsSQL = lsSQL & " AND RetireDate >= " & loSaiyoData(llIndex).lngHaizoku
                                                lsSQL = lsSQL & " AND HospitalCD = '" & lsHospitalCD & "'"
                                                lsSQL = lsSQL & " ORDER BY PlanNo DESC, WardDate DESC"
                                                loLocalRS = General.paDBRecordSetOpen(lsSQL)
                                                With loLocalRS
                                                    If .RecordCount <= 0 Then
                                                    Else
                                                        w_intPlanNo = Integer.Parse(.Fields("PlanNo").Value)
                                                        w_strPreKangoCD = Convert.ToString(.Fields("KinmuDeptCD").Value & "")
                                                        If w_strPreKangoCD <> lsKangoTCD AndAlso w_intPlanNo < liPlanNo Then
                                                            w_lngPreTentaiDate = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(loSaiyoData(llIndex).lngHaizoku, "0000/00/00"))), "yyyyMMdd"))

                                                            lsSQL = "UPDATE IF_NS_STAFFHISTORY_F SET RetireDate = " & w_lngPreTentaiDate
                                                            lsSQL = lsSQL & " WHERE StaffMngID = '" & loSaiyoData(llIndex).strStaffNo & "'"
                                                            lsSQL = lsSQL & " AND KinmuDeptCD = '" & w_strPreKangoCD & "'"
                                                            lsSQL = lsSQL & " AND PlanNo = " & w_intPlanNo
                                                            lsSQL = lsSQL & " AND HospitalCD = '" & lsHospitalCD & "'"

                                                            Call General.paDBExecute(lsSQL)
                                                        End If
                                                    End If
                                                    .Close()
                                                End With
                                                loLocalRS = Nothing
                                            End If

                                            lsSQL = "Insert Into IF_NS_STAFFHISTORY_F ("
                                            lsSQL = lsSQL & "HospitalCD,PlanNo,KinmuDeptCD,StaffMngID,StaffName"
                                            lsSQL = lsSQL & ",EmpDate,WardDate,RetireDate,JobCD,PostCD,SkillLvlCD"
                                            lsSQL = lsSQL & ",DispNo,AutoAllocKbn,Team,RegistKbn,RegistFirstTimeDate,LastUpdTimeDate,RegistrantID"
                                            lsSQL = lsSQL & ") Values ("
                                            lsSQL = lsSQL & "'" & lsHospitalCD & "'" 'HospitalCD
                                            lsSQL = lsSQL & ", " & Convert.ToString(liPlanNo) 'PlanNo
                                            lsSQL = lsSQL & ", '" & lsKangoTCD & "'" 'KangoTaniCD
                                            lsSQL = lsSQL & ", '" & loSaiyoData(llIndex).strStaffNo & "'" 'StaffMngID
                                            lsSQL = lsSQL & ", '" & m_StaffData(liStaffIdx).StaffName & "'" 'StaffName
                                            lsSQL = lsSQL & ", " & Convert.ToString(loSaiyoData(llIndex).SaiyoDate) 'EmpDate
                                            lsSQL = lsSQL & ", " & Convert.ToString(loSaiyoData(llIndex).lngHaizoku) 'WardDate
                                            lsSQL = lsSQL & ", " & Convert.ToString(loSaiyoData(llIndex).TentaiDate) 'RetireDate
                                            lsSQL = lsSQL & ", '" & m_StaffData(liStaffIdx).JobCode & "'" 'JobCD
                                            lsSQL = lsSQL & ", '" & m_StaffData(liStaffIdx).PostCode & "'" 'PostCD
                                            lsSQL = lsSQL & ", '" & m_StaffData(liStaffIdx).GiryoLvCD & "'" 'SkillLvlCD
                                            Select Case w_TargetDispNo
                                                Case 1
                                                    w_DispNo = m_StaffData(liStaffIdx).HyojiNo1
                                                Case 2
                                                    w_DispNo = m_StaffData(liStaffIdx).HyojiNo2
                                                Case 3
                                                    w_DispNo = m_StaffData(liStaffIdx).HyojiNo3
                                                Case 4
                                                    w_DispNo = m_StaffData(liStaffIdx).HyojiNo4
                                                Case 5
                                                    w_DispNo = m_StaffData(liStaffIdx).HyojiNo5
                                            End Select
                                            If w_DispNo <= 0 Then
                                                w_DispNo = m_StaffData(liStaffIdx).InitialHyojiNo
                                            End If
                                            lsSQL = lsSQL & ", " & w_DispNo
                                            lsSQL = lsSQL & ", '" & m_StaffData(liStaffIdx).AutoKBN & "'" 'AutoAllocKbn
                                            lsSQL = lsSQL & ", " & Convert.ToString(m_StaffData(liStaffIdx).Team) 'Team
                                            lsSQL = lsSQL & ", '1'" 'RegistKbn
                                            lsSQL = lsSQL & ", " & lsSysDate 'RegistFirstTimeDate
                                            lsSQL = lsSQL & ", " & lsSysDate 'LastUpdTimeDate
                                            lsSQL = lsSQL & ", '" & General.g_strUserID & "'" 'RegistrantID
                                            lsSQL = lsSQL & ")"
                                            lsSQL = lsSQL & " "

                                            Call General.paDBExecute(lsSQL)
                                        Next llIndex
                                    End If
                                End If
                            End If
                        Next llRow
                    End If

                    'ｺﾐｯﾄ
                    Call General.paCommit()
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'ﾃﾞｰﾀの保存-終了
    Private Function RunSaveEnd() As Boolean

        Const W_SUBNAME As String = "NSK0000HA RunSaveEnd"

        Dim w_MsgAns As Integer
        Dim w_MsgStr As String
        Dim w_ExclusionFlg As Boolean
        Dim w_frmProcess As Form
        Dim w_OrderIF_Data As String
        Dim w_strMsg() As String
        Dim w_ovRuikeiUpdFlg As String
        Dim w_updFlg As Boolean
        w_ovRuikeiUpdFlg = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY13, "PLANUPDFLG", "0", General.g_strHospitalCD)
        w_updFlg = False
        Try
            '編集中のﾃﾞｰﾀ更新確認ﾒｯｾｰｼﾞ表示
            If g_SaikeiFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = "（すでに各部署で勤務データを保存している場合は上書きされます。）"
            Else
                ReDim w_strMsg(0)
            End If
            Call Set_MsgZOrder("NS0119", w_strMsg, w_MsgAns, 0)
            If w_MsgAns = MsgBoxResult.Yes Then
                '--- 「はい」 選択の場合 ---

                '職員情報がﾃﾞﾌｫﾙﾄ値の職員が存在するとき
                If m_DefStaffFlg = True AndAlso m_SetStaffFlg = False Then
                    ReDim w_strMsg(0)
                    Call Set_MsgZOrder("NS0117", w_strMsg, w_MsgAns, 0)
                    If w_MsgAns <> MsgBoxResult.Yes Then
                        RunSaveEnd = False
                        Exit Function
                    End If
                End If

                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                    '実績ﾃﾞｰﾀ必須チェック
                    If ChkJissekiNull(False) = False Then
                        RunSaveEnd = False
                        Exit Function
                    End If
                End If

                '代休データ整合性チェック
                If General.g_lngDaikyuMng = 0 Then
                    If Adjust_Daikyu(1) = False Then
                        RunSaveEnd = False
                        Exit Function
                    End If
                End If

                '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                w_MsgStr = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                'ﾊﾟﾚｯﾄ、検索･置換画面が開いている場合は閉じる
                Call HideModelessForm()

                '実績ﾃﾞｰﾀ更新中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_KEIKAKUSAVE_STR
                sbrMain.Refresh()
                Me.Cursor = Cursors.WaitCursor
                Me.Enabled = False

                w_frmProcess = New frmNSK0000HM
                w_frmProcess.Show()

                'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                Call General.paBeginTrans()

                w_ExclusionFlg = False
                If g_SaikeiFlg = True Then
                    '再掲部署の場合
                    Call Save_SaikeiData(w_frmProcess)
                Else
                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ 更新
                            If Save_PlanData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ(4週) 更新
                            If Save_PlanData_4W(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        w_updFlg = True
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ 更新
                            If Save_PlanData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ(4週) 更新
                            If Save_PlanData_4W(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務実績Ｆ 更新
                            If Save_JissekiData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI Then
                        w_updFlg = True
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務実績Ｆ 更新
                            If Save_JissekiData(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                        '排他がかかってない時のみ
                        If w_ExclusionFlg = False Then
                            '勤務予定Ｆ(4週) 更新
                            If Save_PlanData_4W(False, w_frmProcess) = False Then
                                w_ExclusionFlg = True
                            End If
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '時間年休を保存しにいく
                        If UpDate_JikanNenkyu() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '時間年休(4週)を保存しにいく
                        If UpDate_JikanNenkyu_4W() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '控除を保存しにいく
                        If UpDate_Kojyo() = False Then
                            w_ExclusionFlg = True
                        End If
                    End If

                    '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------------------------------
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        Select Case m_PgmFlg
                            Case General.G_PGMSTARTFLG_NEWPLAN
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Plan, General.g_strSelKinmuDeptCD, m_PlanNo)
                            Case General.G_PGMSTARTFLG_CHANGEPLAN
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Result, General.g_strSelKinmuDeptCD, m_PlanNo)
                            Case General.G_PGMSTARTFLG_CHANGEJISSEKI
                                w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Result, General.g_strSelKinmuDeptCD, m_PlanNo)
                        End Select
                    End If
                    '----------------------------------------------------------------------------------------------------------------------------
                End If

                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    'ｺﾐｯﾄ
                    Call General.paCommit()
                End If
                If w_updFlg = True And w_ovRuikeiUpdFlg = "1" Then
                    Call updOvKnmApprvRuikei()
                End If
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '===============================================================
                    '   OrderInterFace 処理
                    '===============================================================
                    If General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY2, "NUSIF", "0", General.g_strHospitalCD) = "1" Then
                        '計画･実績画面からの登録(実績F/職員歴F)
                        w_OrderIF_Data = "0404"
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strHospitalCD & Space(2), 2)
                        w_OrderIF_Data = w_OrderIF_Data & Format(m_PlanNo, "000")
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strSelKinmuDeptCD & Space(10), 10)
                        '職員歴更新
                        If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                            '計画新規のときのみIF用職員歴更新（削除するため）
                            Call OrderIF_NS019(w_OrderIF_Data, False)
                        End If
                        '電文作成
                        Call General.paOrderInterface_NusIf(w_OrderIF_Data)
                    End If
                End If

                w_frmProcess.Close()
                w_frmProcess = Nothing

                Me.Cursor = Cursors.Default
                Me.Enabled = True

                'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_MsgStr
                sbrMain.Refresh()
            ElseIf w_MsgAns = MsgBoxResult.No Then
                '「いいえ」 選択の場合
                '未更新 & 終了
                RunSaveEnd = True
                Exit Function
            ElseIf w_MsgAns = MsgBoxResult.Cancel Then
                'ｷｬﾝｾﾙ 選択の場合
                '終了中断
                Exit Function
            Else
                'その他 の場合
                '終了中断
                Exit Function
            End If

            '排他がかかってない時のみ
            If w_ExclusionFlg = False Then
                RunSaveEnd = True
            End If

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
            Me.Cursor = Cursors.Default
            Me.Enabled = True
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    'ﾃﾞｰﾀの確定保存-終了
    Private Function RunSaveKakuteiEnd() As Boolean

        Const W_SUBNAME As String = "NSK0000HA RunSaveKakuteiEnd"

        Dim w_MsgAns As Integer
        Dim w_MsgStr As String
        Dim w_ExclusionFlg As Boolean
        Dim w_frmProcess As Form
        Dim w_OrderIF_Data As String
        Dim w_strMsg() As String
        Dim w_ovRuikeiUpdFlg As String
        Dim w_updFlg As Boolean = False
        Dim w_EfftoDateKinmuCheck As String '2015/05/22 Bando Add

        Try
            w_ovRuikeiUpdFlg = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY13, "PLANUPDFLG", "0", General.g_strHospitalCD)
            '2015/05/22 Bando Add Start ========================
            '有効終了日切れ勤務確定時チェック
            w_EfftoDateKinmuCheck = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "EFFTODATEKINMUCHECK", "0", General.g_strHospitalCD)
            '2015/05/22 Bando Add End   ========================

            '勤務変更 Or 再掲部署 の場合は処理抜け出し
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse g_SaikeiFlg = True Then
                RunSaveKakuteiEnd = False
                Exit Function
            End If

            '確定済みか否かを設定する
            If SearchKakuteiData() = False Then
                '未確定の場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "編集中の"
            Else
                '確定済みの場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "未確定の"
            End If
            '編集中のﾃﾞｰﾀ更新確認ﾒｯｾｰｼﾞ表示
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                Call Set_MsgZOrder("NS0266", w_strMsg, w_MsgAns, 0)
            Else
                Call Set_MsgZOrder("NS0116", w_strMsg, w_MsgAns, 0)
            End If

            If w_MsgAns = MsgBoxResult.Yes Then
                '--- 「はい」 選択の場合 ---

                '職員情報がﾃﾞﾌｫﾙﾄ値の職員が存在するとき
                If m_DefStaffFlg = True AndAlso m_SetStaffFlg = False Then
                    ReDim w_strMsg(0)
                    Call Set_MsgZOrder("NS0117", w_strMsg, w_MsgAns, 0)
                    If w_MsgAns <> MsgBoxResult.Yes Then
                        RunSaveKakuteiEnd = False
                        Exit Function
                    End If
                End If

                '実績ﾃﾞｰﾀ必須チェック
                If ChkJissekiNull(True) = False Then
                    RunSaveKakuteiEnd = False
                    Exit Function
                End If

                '代休データ整合性チェック
                If General.g_lngDaikyuMng = 0 Then
                    If Adjust_Daikyu(1) = False Then
                        RunSaveKakuteiEnd = False
                        Exit Function
                    End If
                End If

                '2015/05/22 Bando Add Start =============================
                '有効終了日勤務ﾃﾞｰﾀチェック
                If w_EfftoDateKinmuCheck = "1" Then
                    If ChkEfftoDate(True) = False Then
                        RunSaveKakuteiEnd = False
                        Exit Function
                    End If
                End If

                '必須勤務ﾃﾞｰﾀチェック
                If m_lstmnuTool(M_MenuErrorAbsoluteKinmu).Checked AndAlso
                        ChkAbsoluteKinmu(True) = False Then
                    RunSaveKakuteiEnd = False
                    Exit Function
                End If
                '2015/05/22 Bando Add End   =============================

                '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                w_MsgStr = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                'ﾊﾟﾚｯﾄ、検索･置換画面が開いている場合は閉じる
                Call HideModelessForm()

                '実績ﾃﾞｰﾀ更新中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_JISSEKISAVE_STR
                sbrMain.Refresh()
                Me.Cursor = Cursors.WaitCursor
                Me.Enabled = False

                w_frmProcess = New frmNSK0000HM
                w_frmProcess.Show()

                w_ExclusionFlg = False

                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                    '計画新規の場合
                    w_updFlg = True
                    'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                    Call General.paBeginTrans()
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '勤務予定Ｆ 更新
                        If Save_PlanData(True, w_frmProcess) = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '勤務予定Ｆ(4週) 更新
                        If Save_PlanData_4W(True, w_frmProcess) = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        'ｺﾐｯﾄ
                        Call General.paCommit()
                    End If
                ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '計画変更の場合
                    w_updFlg = True
                    'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                    Call General.paBeginTrans()
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        '勤務予定Ｆ 更新
                        If Save_PlanData(True, w_frmProcess) = False Then
                            w_ExclusionFlg = True
                        End If
                    End If
                    '排他がかかってない時のみ
                    If w_ExclusionFlg = False Then
                        'ｺﾐｯﾄ
                        Call General.paCommit()
                    End If
                End If

                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                    Call General.paBeginTrans()
                    '勤務実績Ｆ 更新
                    If Save_JissekiData(True, w_frmProcess) = False Then
                        w_ExclusionFlg = True
                    End If
                End If
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '時間年休を保存しにいく
                    If UpDate_JikanNenkyu() = False Then
                        w_ExclusionFlg = True
                    End If
                End If
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '時間年休(4週)を保存しにいく
                    If UpDate_JikanNenkyu_4W() = False Then
                        w_ExclusionFlg = True
                    End If
                End If
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '控除を保存しにいく
                    If UpDate_Kojyo() = False Then
                        w_ExclusionFlg = True
                    End If
                End If
                '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------------------------------
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    w_ExclusionFlg = Not General.paUpdateOuen(General.gKinmuTblKbn.Result, General.g_strSelKinmuDeptCD, m_PlanNo)
                End If
                '----------------------------------------------------------------------------------------------------------------------------
                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    'ｺﾐｯﾄ
                    Call General.paCommit()
                End If

                If w_updFlg = True And w_ovRuikeiUpdFlg = "1" Then
                    Call updOvKnmApprvRuikei()
                End If

                '排他がかかってない時のみ
                If w_ExclusionFlg = False Then
                    '===============================================================
                    '   OrderInterFace 処理
                    '===============================================================
                    If General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY2, "NUSIF", "0", General.g_strHospitalCD) = "1" Then
                        '計画･実績画面からの登録(実績F/職員歴F)
                        w_OrderIF_Data = "0404"
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strHospitalCD & Space(2), 2)
                        w_OrderIF_Data = w_OrderIF_Data & Format(m_PlanNo, "000")
                        w_OrderIF_Data = w_OrderIF_Data & General.paLeft(General.g_strSelKinmuDeptCD & Space(10), 10)
                        '職員歴更新
                        Call OrderIF_NS019(w_OrderIF_Data, True)
                        '電文作成
                        Call General.paOrderInterface_NusIf(w_OrderIF_Data)
                    End If
                End If

                w_frmProcess.Close()
                w_frmProcess = Nothing

                Me.Cursor = Cursors.Default
                Me.Enabled = True

                'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_MsgStr
                sbrMain.Refresh()
            ElseIf w_MsgAns = MsgBoxResult.No Then
                '未更新 & 終了
                '終了処理実行
                RunSaveKakuteiEnd = True
                Exit Function
            ElseIf w_MsgAns = MsgBoxResult.Cancel Then
                'その他（「いいえ」） の場合
                '終了中断
                RunSaveKakuteiEnd = False
                Exit Function
            End If

            '排他がかかってない時のみ
            If w_ExclusionFlg = False Then
                '確定終了処理正常終了
                RunSaveKakuteiEnd = True
            End If

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀをﾃﾞﾌｫﾙﾄに
            Me.Cursor = Cursors.Default
            Me.Enabled = True
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務予定Ｆの更新(p_SavwType:保存のﾀｲﾌﾟ False:保存,True:確定保存)
    Private Function Save_PlanData(ByVal p_SaveType As Boolean, ByVal pProcessForm As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Save_PlanData"

        Dim w_Int As Integer
        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_KinmuCD As String = String.Empty 'KinmuCD
        Dim w_RiyuKBN As String = String.Empty '理由区分
        Dim w_Time As String = String.Empty '時間数
        Dim w_Flg As String = String.Empty '確定部署Flg
        Dim w_SysDate As String '更新日時
        Dim w_Var As Object
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_StaffIdx As Integer
        Dim w_Idocnt As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_NenkyuIdx As Integer
        Dim w_GetContentsKBN As String '取得内容区分(1:全日、2:前半、3:後半、4:時間年休)
        Dim w_GetCol As Integer
        Dim w_SQLOracle As String
        Dim w_KangoCD As String = String.Empty
        Dim w_Rs As ADODB.Recordset
        Dim w_blnGetFlg As Boolean
        Dim w_blnJissekiFlg As Boolean
        Dim w_HolCD As String
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add

        Save_PlanData = True
        Try
            '処理経過ﾌｫｰﾑ設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Blue)
            pProcessForm.pSyoriText = "勤務計画データ保存中..."

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            'トランザクション開始
            Call General.paBeginTrans()

            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '計画確定Ｆ削除
                Call Save_PlanKakutei(True)
            End If

            '処理経過初期化
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

            w_intCount = 0

            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                    '---------------------------

                    '配列番号 取得
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If IsNumeric(w_Var) = True Then
                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽが取得できる場合

                        '配列ｲﾝﾃﾞｯｸｽ取得
                        w_StaffIdx = Integer.Parse(w_Var)
                        '職員管理番号 取得
                        w_StaffID = m_StaffData(w_StaffIdx).ID

                        '職員歴Ｆ更新
                        '希望勤務だった場合更新しない
                        If Not (g_HopeMode = 1) Then
                            Call Save_Shokuinreki(w_StaffIdx)
                        End If

                        '代休管理Ｆ更新
                        If General.g_lngDaikyuMng = 0 Then
                            Call Save_DaikyuData(w_StaffIdx)
                        End If

                        w_SQLOracle = ""
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                            '日付取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If
                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If
                            End If

                            '更新期間の設定(配属日している期間のみ)
                            w_HaizokuFlg = False
                            If w_CurrentDate <> 0 AndAlso w_Cnt > 0 Then
                                w_Idocnt = UBound(m_StaffData(w_StaffIdx).IdoData)
                                For w_Int = 1 To w_Idocnt
                                    If (m_StaffData(w_StaffIdx).IdoData(w_Int).IdoYMD <= w_CurrentDate) AndAlso (w_CurrentDate <= m_StaffData(w_StaffIdx).IdoData(w_Int).SyuryoYMD) AndAlso w_CurrentDate <> 0 Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If

                            '配属期間内？
                            If w_HaizokuFlg = True Then
                                '配属期間内の場合

                                If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                                    '新規作成のとき

                                    '実績Ｆ削除
                                    'Delete文 編集
                                    'RICHARD UPDATE START
                                    'w_Sql = "DELETE FROM NS_KINMURESULT_F "
                                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                    'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                    'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                    'Call General.paDBExecute(w_Sql)
                                    Call NSK0000H_sql.delete_NS_KINMURESULT_F_01(w_CurrentDate, w_StaffID)
                                    'RICHARD UPDATE END

                                    '変更履歴Ｆ削除
                                    'Delete文 編集
                                    'RICHARD UPDATE START
                                    'w_Sql = "DELETE FROM NS_KINMUCHGHISTORY_F "
                                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                    'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                    'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                    'Call General.paDBExecute(w_Sql)
                                    Call NSK0000H_sql.delete_NS_KINMUCHGHISTORY_F_01(w_CurrentDate, w_StaffID) '<42>
                                    'RICHARD UPDATE END
                                    '2017/11/20 Yamanishi Add -----------------------------------------------
                                    If m_intSelSaveNo > 0 Then
                                        Call NSK0000H_sql.delete_NS_KINMUPLAN_F_01(w_StaffID, w_CurrentDate)
                                    End If
                                    '------------------------------------------------------------------------
                                End If

                                '日付ｲﾝﾃﾞｯｸｽ 取得
                                w_NenkyuIdx = 0
                                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).NenkyuData)
                                    If m_StaffData(w_StaffIdx).NenkyuData(w_Int).Date_Renamed = w_CurrentDate Then
                                        w_NenkyuIdx = w_Int
                                        Exit For
                                    End If
                                Next w_Int

                                '勤務ﾃﾞｰﾀ 取得
                                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_blnGetFlg = True
                                Else
                                    w_blnGetFlg = False
                                End If

                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN AndAlso w_Var = "" Then
                                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                    If w_Var <> "" Then
                                        w_blnGetFlg = True
                                    Else
                                        w_blnGetFlg = False
                                    End If
                                End If

                                If w_blnGetFlg = True Then
                                    '勤務ﾃﾞｰﾀ分割
                                    '2015/04/10 Bando Upd Start ==================================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                    '2015/04/10 Bando Upd End   ==================================================
                                    '2017/11/20 Yamanishi Upd --------------------------------------------------------------------------
                                    'If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update Then
                                    If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN AndAlso m_intSelSaveNo > 0 Then
                                        If w_KinmuCD <> "" Then
                                            Call NSK0000H_sql.insert_NS_KINMUPLAN_F_02(w_CurrentDate, w_StaffID, w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate)
                                        End If
                                    ElseIf m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update Then
                                        '-----------------------------------------------------------------------------------------------
                                        '予定/実績Ｆから取得したﾃﾞｰﾀがあるとき

                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_PLANDATA Then
                                            '予定Ｆから取得したﾃﾞｰﾀのとき
                                            If (m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time <> w_Time OrElse
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD <> w_KangoCD OrElse
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment <> w_Comment) AndAlso
                                                w_KinmuCD <> "" Then

                                                'Update文 編集
                                                'RICHARD
                                                'w_Sql = "UPDATE NS_KINMUPLAN_F SET "
                                                'w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "' "
                                                'w_Sql = w_Sql & ",REASONKBN = '" & w_RiyuKBN & "' "
                                                'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                                'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ",LASTUPDTIMEDATE = " & w_SysDate & " "
                                                'w_Sql = w_Sql & ",REGISTRANTID = '" & General.g_strUserID & "' "
                                                'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                                'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                                'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                                'Call General.paDBExecute(w_Sql)
                                                '<37>
                                                Call NSK0000H_sql.update_NS_KINMUPLAN_F_02(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                                'RICHARD UPDATE 

                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time = w_Time
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_PLANDATA
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                                m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                            Else
                                                If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete OrElse w_KinmuCD = "" Then

                                                    '削除対象ﾃﾞｰﾀの場合はDelete（勤務ｺｰﾄﾞが取得できなかった場合）
                                                    'RICHARD UPDATE START
                                                    'w_Sql = "DELETE FROM NS_KINMUPLAN_F"
                                                    'w_Sql = w_Sql & " WHERE STAFFMNGID = '" & w_StaffID & "' "
                                                    'w_Sql = w_Sql & " AND DATEF = " & w_CurrentDate
                                                    'w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
                                                    'w_Sql = w_Sql & " "
                                                    'Call General.paDBExecute(w_Sql)
                                                    '<39>
                                                    Call NSK0000H_sql.delete_NS_KINMUPLAN_F_01(w_StaffID, w_CurrentDate)
                                                    'RICHARD UPDATE END

                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Date_Renamed = 0
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time = Convert.ToString(0)
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD = ""
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment = "" '2015/04/10 Bando Add
                                                End If
                                            End If
                                        ElseIf m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀの場合（勤務変更の場合のみ）
                                            If p_SaveType = True AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_TABUSHO Then
                                                '確定保存で他部署確定ﾃﾞｰﾀのとき
                                                If (m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time <> w_Time OrElse
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD <> w_KangoCD OrElse
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment <> w_Comment) Then

                                                    'Update文 編集
                                                    'richard update start
                                                    'w_Sql = "UPDATE NS_KINMUPLAN_F SET "
                                                    'w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "' "
                                                    'w_Sql = w_Sql & ",REASONKBN = '" & w_RiyuKBN & "' "
                                                    'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                                    'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                    'w_Sql = w_Sql & ",LASTUPDTIMEDATE = " & w_SysDate & " "
                                                    'w_Sql = w_Sql & ",REGISTRANTID = '" & General.g_strUserID & "' "
                                                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                                    'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                                    'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                                    'Call General.paDBExecute(w_Sql)
                                                    Call NSK0000H_sql.update_NS_KINMUPLAN_F_02(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                                    'richard update end

                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time = w_Time
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                                    m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                                End If
                                            End If
                                        End If '---> 予定ﾃﾞｰﾀ？　実績ﾃﾞｰﾀ？
                                    Else
                                        '予定/実績Ｆから取得したﾃﾞｰﾀがないとき
                                        If w_KinmuCD <> "" Then

                                            '月中異動者の予定保存データがある場合は、更新する。
                                            'RICHARD UPDATE START
                                            'w_Sql = "Select LastUpdTimeDate From NS_KINMUPLAN_F "
                                            'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                            'w_Sql = w_Sql & "AND DATEF        =  " & w_CurrentDate & " "
                                            'w_Sql = w_Sql & "AND STAFFMNGID   = '" & w_StaffID & "' "
                                            'w_Rs = General.paDBRecordSetOpen(w_Sql)
                                            Call NSK0000H_sql.select_NS_KINMUPLAN_F_01(w_Rs, w_CurrentDate, w_StaffID) '<33>
                                            'RICHARD UPDATE END

                                            With w_Rs
                                                If .RecordCount > 0 Then
                                                    '更新処理
                                                    'RICHARD UPDATE START
                                                    'w_Sql = "UPDATE NS_KINMUPLAN_F SET "
                                                    'w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "' "
                                                    'w_Sql = w_Sql & ",REASONKBN = '" & w_RiyuKBN & "' "
                                                    'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                                    'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                    'w_Sql = w_Sql & ",LASTUPDTIMEDATE = " & w_SysDate & " "
                                                    'w_Sql = w_Sql & ",REGISTRANTID = '" & General.g_strUserID & "' "                                                    
                                                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                                    'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                                    'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                                    'Call General.paDBExecute(w_Sql)
                                                    Call NSK0000H_sql.update_NS_KINMUPLAN_F_02(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                                    'RICHARD UPDATE END
                                                    .Close()
                                                Else
                                                    'Insert文 編集
                                                    'RICHARD UPDATE START
                                                    'w_Sql = "INSERT INTO NS_KINMUPLAN_F "
                                                    'w_Sql = w_Sql & "(HOSPITALCD,DATEF,STAFFMNGID,KINMUCD,REASONKBN,OUENKINMUDEPTCD,HOPECOMMENT,REGISTFIRSTTIMEDATE,LASTUPDTIMEDATE,REGISTRANTID)"
                                                    'w_Sql = w_Sql & "VALUES('" & General.g_strHospitalCD & "'," & w_CurrentDate & ",'" & w_StaffID & "','" & w_KinmuCD
                                                    'w_Sql = w_Sql & "','" & w_RiyuKBN & "','" & w_KangoCD & "','" & w_Comment & "'," & w_SysDate & "," & w_SysDate & ",'" & General.g_strUserID & "')"
                                                    'Call General.paDBExecute(w_Sql)
                                                    Call NSK0000H_sql.insert_NS_KINMUPLAN_F_02(w_CurrentDate, w_StaffID, w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate)
                                                    'RICHARD UPDATE END
                                                    .Close()
                                                End If
                                            End With

                                            w_Rs = Nothing

                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time = w_Time
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_PLANDATA
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                        End If
                                    End If '---> 予定/実績の該当ﾃﾞｰﾀがＤＢにあるの？

                                    If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                                        '届出を使用していない場合は時間年休使用
                                        w_GetContentsKBN = ""
                                        w_HolCD = ""
                                        '2017/11/21 Yamanishi Upd Start ---------------------------------------------------------------
                                        'If IsNumeric(w_KinmuCD) Then
                                        '    If 0 <= Integer.Parse(w_KinmuCD) AndAlso Integer.Parse(w_KinmuCD) <= UBound(g_KinmuM) Then
                                        '        If g_KinmuM(Integer.Parse(w_KinmuCD)).HFlg = "2" Then
                                        '            '半日勤務ﾌﾗｸﾞ
                                        '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) Then
                                        '                'ＡＭ勤務CD
                                        '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) <= UBound(g_KinmuM) Then
                                        '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD) AndAlso
                                        '                                g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                        '                        '休み分類CD
                                        '                        w_GetContentsKBN = "2"
                                        '                        w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD
                                        '                    End If
                                        '                End If
                                        '            End If
                                        '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) Then
                                        '                'ＰＭ勤務CD
                                        '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) <= UBound(g_KinmuM) Then
                                        '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD) AndAlso
                                        '                                g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                        '                        '休み分類CD
                                        '                        If w_GetContentsKBN = "2" Then
                                        '                            w_GetContentsKBN = "2,3"
                                        '                            w_HolCD = w_HolCD & "," & g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                        '                        Else
                                        '                            w_GetContentsKBN = "3"
                                        '                            w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                        '                        End If
                                        '                    End If
                                        '                End If
                                        '            End If
                                        '        Else
                                        '            If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD) AndAlso
                                        '                        g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                        '                '休み分類CD
                                        '                w_GetContentsKBN = "1"
                                        '                w_HolCD = g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD
                                        '            End If
                                        '        End If
                                        '    End If
                                        'End If
                                        Call GetNenkyuContentsKbnAndHolCD(w_KinmuCD, w_GetContentsKBN, w_HolCD)
                                        '2017/11/21 Yamanishi Upd End -----------------------------------------------------------------
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                            If w_Var <> "" Then
                                                w_blnJissekiFlg = True
                                            Else
                                                w_blnJissekiFlg = False
                                            End If
                                        End If

                                        If w_blnJissekiFlg = False Then

                                            '年休を保存しにいく
                                            If w_NenkyuIdx = 0 Then
                                                If w_Time <> "" OrElse w_GetContentsKBN <> "" Then
                                                    w_NenkyuIdx = UBound(m_StaffData(w_StaffIdx).NenkyuData) + 1
                                                    ReDim Preserve m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx)
                                                    ReDim m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).Detail(0)

                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).Date_Renamed = w_CurrentDate
                                                    Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataChk = False 'DBﾃﾞｰﾀなし
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).FirstRegistTimeDate = 0
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).LastUpdTimeDate = 0
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).RegistID = ""
                                                End If
                                            Else
                                                If m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataFlg = False Then
                                                    Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                                End If
                                            End If
                                        End If
                                    End If
                                Else
                                    'ｽﾌﾟﾚｯﾄﾞに勤務が貼り付いていない場合
                                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_PLANDATA Then
                                        '予定Ｆから取得したﾃﾞｰﾀのとき

                                        'Delete文 編集
                                        'RICHARD UPDATE START
                                        'w_Sql = "DELETE FROM NS_KINMUPLAN_F "
                                        'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                        'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                        'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                        'Call General.paDBExecute(w_Sql)
                                        Call NSK0000H_sql.delete_NS_KINMUPLAN_F_01(w_StaffID, w_CurrentDate)
                                        'RICHARD UPDATE END

                                        If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                                            '届出を使用していない場合は時間年休使用
                                            If w_NenkyuIdx > 0 Then
                                                If m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataFlg = False Then
                                                    ReDim m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).Detail(0)
                                                    m_StaffData(w_StaffIdx).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                                End If
                                            End If
                                        End If

                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KinmuCD = ""
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Date_Renamed = 0
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).RiyuKBN = ""
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Time = Convert.ToString(0)
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = ""
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = ""
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = ""
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                        m_StaffData(w_StaffIdx).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                    End If
                                End If '---> ｽﾌﾟﾚｯﾄﾞから勤務ｺｰﾄﾞ取得できた？
                            End If '---> 配属しているの？
                        Next w_Col
                    End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得可能？

                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount
                End If
            Next w_Row

            'ｺﾐｯﾄ
            Call General.paCommit()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務予定Ｆの更新(4週のはみ出た部分)(p_SaveType:保存のﾀｲﾌﾟ False:保存,True:確定保存)
    Private Function Save_PlanData_4W(ByVal p_SaveType As Boolean, ByVal pProcessForm As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Save_PlanData_4W"

        Dim w_Int As Integer
        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_KinmuCD As String = String.Empty 'KinmuCD
        Dim w_RiyuKBN As String = String.Empty '理由区分
        Dim w_Time As String = String.Empty '時間数
        Dim w_Flg As String = String.Empty '確定部署Flg
        Dim w_SysDate As String '更新日時
        Dim w_StartDate As Integer '計画終了日+1日
        Dim w_StartCol As Integer
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_KeikakuCol As Integer
        Dim w_intCount As Integer
        Dim w_Idocnt As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_NenkyuIdx As Integer
        Dim w_GetContentsKBN As String '取得内容区分(1:全日、2:前半、3:後半、4:時間年休)
        Dim w_EndCol As Integer
        Dim w_GetCol As Integer
        Dim w_SQLOracle As String
        Dim w_KangoCD As String = String.Empty
        Dim w_Rs As ADODB.Recordset
        Dim w_HolCD As String
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add

        Save_PlanData_4W = True
        Try
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                Exit Function
            End If

            '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
            m_4WeekFLG = False

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            '計画終了日+1日
            w_StartDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
            If Get_Col_4W(w_StartDate, w_StartCol) = False Then
                Exit Function
            End If

            '最終4週期間終了日
            w_EndCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol

            'ﾄﾗﾝｻﾞｸｼｮﾝ開始
            Call General.paBeginTrans()

            '処理経過設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Cyan)
            pProcessForm.pSyoriText = "計画期間データ保存中..."
            '処理経過初期化
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

            w_intCount = 0

            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                    '配列番号 取得
                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If IsNumeric(w_Var) = True Then
                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽが取得できる場合

                        '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得
                        w_Index = Integer.Parse(w_Var)
                        '職員管理番号 取得
                        w_StaffID = m_StaffData(w_Index).ID

                        '代休管理Ｆ更新
                        If General.g_lngDaikyuMng = 0 Then
                            Call Save_DaikyuData(w_Index)
                        End If

                        w_Cnt = 0
                        w_SQLOracle = ""
                        For w_Col = w_StartCol To w_EndCol

                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If

                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                            Else
                                w_Cnt = 0
                            End If

                            '更新期間の設定(配属日している期間のみ)
                            w_HaizokuFlg = False
                            If w_CurrentDate <> 0 AndAlso w_Cnt > 0 Then
                                w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                                For w_Int = 1 To w_Idocnt
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If

                            '配属期間内のﾃﾞｰﾀのみを更新する
                            If w_HaizokuFlg = True Then

                                'ｽﾌﾟﾚｯﾄﾞの勤務ﾃﾞｰﾀ取得
                                If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                    '二段表示してる時　かつ　勤務変更時
                                    '下段を確認する（計画終了日+1日～最終4週期間終了日　この期間、上段にはデータない）
                                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row + 1, w_Col)
                                Else
                                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row, w_Col)
                                End If

                                '勤務ﾃﾞｰﾀ分割
                                '2015/04/10 Bando Upd Start =========================================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd End   =========================================

                                If m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update OrElse m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete Then
                                    '予定/実績Ｆから取得したﾃﾞｰﾀがあるとき

                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_PLANDATA Then
                                        '予定Ｆから取得したﾃﾞｰﾀのとき
                                        If (m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse m_StaffData(w_Index).KinmuData(w_Cnt).Time <> w_Time OrElse m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD <> w_KangoCD) AndAlso Trim(w_KinmuCD) <> "" Then
                                            'richard update start
                                            'w_Sql = "Update NS_KINMUPLAN_F set "
                                            'w_Sql = w_Sql & " KinmuCD = '" & w_KinmuCD & "' "
                                            'w_Sql = w_Sql & ",ReasonKbn = '" & w_RiyuKBN & "' "
                                            'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                            'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                            'w_Sql = w_Sql & ",LastUpdTimeDate = " & w_SysDate & " "
                                            'w_Sql = w_Sql & ",RegistrantID = '" & General.g_strUserID & "' "
                                            'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
                                            'w_Sql = w_Sql & "And DateF = " & w_CurrentDate & " "
                                            'w_Sql = w_Sql & "And StaffMngID = '" & w_StaffID & "' "
                                            'Call General.paDBExecute(w_Sql)
                                            Call NSK0000H_sql.update_NS_KINMUPLAN_F_02(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                            'richard update end

                                            '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
                                            m_4WeekFLG = True

                                            m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                            m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                            m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                            m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                        Else
                                            If m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete OrElse Trim(w_KinmuCD) = "" Then
                                                '勤務CDが設定されていない場合
                                                'RICHARD UPDATE START
                                                'w_Sql = "Delete From NS_KINMUPLAN_F"
                                                'w_Sql = w_Sql & " Where StaffMngID = '" & w_StaffID & "'"
                                                'w_Sql = w_Sql & " And DateF = " & w_CurrentDate
                                                'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                'w_Sql = w_Sql & " "
                                                'w_Sql = w_Sql & "And StaffMngID = '" & w_StaffID & "' "
                                                'Call General.paDBExecute(w_Sql)
                                                Call NSK0000H_sql.delete_NS_KINMUPLAN_F_01(w_StaffID, w_CurrentDate)
                                                'RICHARD UPDATE END

                                                '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
                                                m_4WeekFLG = True

                                                m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = 0
                                                m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Time = Convert.ToString(0)
                                                m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = ""
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Comment = "" '2015/04/10 Bando Add
                                            End If
                                        End If '---> 変更対象
                                    End If '---> 予定Ｆのﾃﾞｰﾀ？
                                Else
                                    '予定/実績Ｆから取得したﾃﾞｰﾀがないとき

                                    If Trim(w_KinmuCD) <> "" Then

                                        '月中異動者の予定保存データがある場合は、更新する。
                                        'RICHARD UPDATE END
                                        'w_Sql = "Select LastUpdTimeDate From NS_KINMUPLAN_F "
                                        'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                        'w_Sql = w_Sql & "AND DATEF        =  " & w_CurrentDate & " "
                                        'w_Sql = w_Sql & "AND STAFFMNGID   = '" & w_StaffID & "' "
                                        'w_Rs = General.paDBRecordSetOpen(w_Sql)
                                        Call NSK0000H_sql.select_NS_KINMUPLAN_F_01(w_Rs, w_CurrentDate, w_StaffID)
                                        'RICHARD UPDATE START

                                        With w_Rs
                                            If .RecordCount > 0 Then
                                                '更新処理
                                                'richard update start
                                                'w_Sql = "UPDATE NS_KINMUPLAN_F SET "
                                                'w_Sql = w_Sql & " KINMUCD = '" & w_KinmuCD & "' "
                                                'w_Sql = w_Sql & ",REASONKBN = '" & w_RiyuKBN & "' "
                                                'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                                'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ",LASTUPDTIMEDATE = " & w_SysDate & " "
                                                'w_Sql = w_Sql & ",REGISTRANTID = '" & General.g_strUserID & "' "
                                                'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                                                'w_Sql = w_Sql & "AND DATEF = " & w_CurrentDate & " "
                                                'w_Sql = w_Sql & "AND STAFFMNGID = '" & w_StaffID & "' "
                                                'Call General.paDBExecute(w_Sql)
                                                Call NSK0000H_sql.update_NS_KINMUPLAN_F_02(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                                'richard update end
                                                .Close()
                                            Else
                                                'Insert文 編集
                                                'RICHARD UPDATE START
                                                'w_Sql = "INSERT INTO NS_KINMUPLAN_F "
                                                'w_Sql = w_Sql & "(HOSPITALCD,DATEF,STAFFMNGID,KINMUCD,REASONKBN,OUENKINMUDEPTCD,HOPECOMMENT,REGISTFIRSTTIMEDATE,LASTUPDTIMEDATE,REGISTRANTID)"
                                                'w_Sql = w_Sql & "VALUES('" & General.g_strHospitalCD & "'," & w_CurrentDate & ",'" & w_StaffID & "','" & w_KinmuCD
                                                'w_Sql = w_Sql & "','" & w_RiyuKBN & "','" & w_KangoCD & "','" & w_Comment & "'," & w_SysDate & "," & w_SysDate & ",'" & General.g_strUserID & "')"
                                                'Call General.paDBExecute(w_Sql)
                                                Call NSK0000H_sql.insert_NS_KINMUPLAN_F_02(w_CurrentDate, w_StaffID, w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate)
                                                'RICHARD UPDATE END 
                                                .Close()
                                            End If
                                        End With
                                        w_Rs = Nothing

                                        '計画期間外の最後４週部分の更新ﾌﾗｸﾞ
                                        m_4WeekFLG = True

                                        m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                        m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                        m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_PLANDATA
                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update
                                        m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                    End If
                                End If '---> 予定/実績Ｆﾃﾞｰﾀの存在有無

                                '日付ｲﾝﾃﾞｯｸｽ 取得
                                w_NenkyuIdx = 0
                                For w_Int = 1 To UBound(m_StaffData(w_Index).NenkyuData)
                                    If m_StaffData(w_Index).NenkyuData(w_Int).Date_Renamed = w_CurrentDate Then
                                        w_NenkyuIdx = w_Int
                                        Exit For
                                    End If
                                Next w_Int

                                If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                                    '届出を使用していない場合は時間年休使用
                                    w_GetContentsKBN = ""
                                    w_HolCD = ""
                                    '2017/11/21 Yamanishi Upd Start ---------------------------------------------------------------
                                    'If IsNumeric(w_KinmuCD) Then
                                    '    If 0 <= Integer.Parse(w_KinmuCD) AndAlso Integer.Parse(w_KinmuCD) <= UBound(g_KinmuM) Then
                                    '        If g_KinmuM(Integer.Parse(w_KinmuCD)).HFlg = "2" Then
                                    '            '半日勤務ﾌﾗｸﾞ
                                    '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) Then
                                    '                'ＡＭ勤務CD
                                    '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) <= UBound(g_KinmuM) Then
                                    '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD) AndAlso
                                    '                            g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                        '休み分類CD
                                    '                        w_GetContentsKBN = "2"
                                    '                        w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD
                                    '                    End If
                                    '                End If
                                    '            End If
                                    '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) Then
                                    '                'ＰＭ勤務CD
                                    '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) <= UBound(g_KinmuM) Then
                                    '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD) AndAlso
                                    '                            g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                        '休み分類CD
                                    '                        If w_GetContentsKBN = "2" Then
                                    '                            w_GetContentsKBN = "2,3"
                                    '                            w_HolCD = w_HolCD & "," & g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                    '                        Else
                                    '                            w_GetContentsKBN = "3"
                                    '                            w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                    '                        End If
                                    '                    End If
                                    '                End If
                                    '            End If
                                    '        Else
                                    '            If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD) AndAlso
                                    '                    g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                '休み分類CD
                                    '                w_GetContentsKBN = "1"
                                    '                w_HolCD = g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD
                                    '            End If
                                    '        End If
                                    '    End If
                                    'End If
                                    Call GetNenkyuContentsKbnAndHolCD(w_KinmuCD, w_GetContentsKBN, w_HolCD)
                                    '2017/11/21 Yamanishi Upd End -----------------------------------------------------------------
                                    '年休を保存しにいく
                                    If w_NenkyuIdx = 0 Then
                                        If w_Time <> "" OrElse w_GetContentsKBN <> "" Then
                                            w_NenkyuIdx = UBound(m_StaffData(w_Index).NenkyuData) + 1
                                            ReDim Preserve m_StaffData(w_Index).NenkyuData(w_NenkyuIdx)
                                            ReDim m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail(0)

                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Date_Renamed = w_CurrentDate
                                            Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataChk = False 'DBﾃﾞｰﾀなし
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).FirstRegistTimeDate = 0
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).LastUpdTimeDate = 0
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).RegistID = ""
                                        End If
                                    Else
                                        If m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = False Then
                                            Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                        End If
                                    End If
                                End If
                            End If '---> 配属期間内？
                        Next w_Col
                    End If '---> 職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽ取得可能？

                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount
                End If
            Next w_Row

            'ｺﾐｯﾄ
            Call General.paCommit()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務実績Ｆの更新(p_SavwType:保存のﾀｲﾌﾟ False:保存,True:確定保存)
    Private Function Save_JissekiData(ByVal p_SaveType As Boolean, ByVal pProcessForm As Object) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Save_JissekiData"

        Dim w_Int As Integer
        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_Sql As String
        Dim w_StaffID As String '職員管理番号
        Dim w_KinmuCD As String = String.Empty 'KinmuCD
        Dim w_RiyuKBN As String = String.Empty '理由区分
        Dim w_Time As String = String.Empty '時間数
        Dim w_Flg As String = String.Empty '確定部署Flg
        Dim w_SysDate As String '更新日時
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_KeikakuCol As Integer
        Dim w_JissekiDataFlg As Boolean
        Dim w_intCount As Integer
        Dim w_Idocnt As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_NenkyuIdx As Integer
        Dim w_GetContentsKBN As String '取得内容区分(1:全日、2:前半、3:後半、4:時間年休)
        Dim w_UpdateFlg As Boolean
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_HolCD As String
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add

        Save_JissekiData = True
        Try
            '処理経過設定
            pProcessForm.pForeColor = ColorTranslator.ToOle(Color.Magenta)
            If p_SaveType = True Then
                pProcessForm.pSyoriText = "勤務確定データを保存中..."
            Else
                pProcessForm.pSyoriText = "勤務データを保存中..."
            End If

            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            'ﾄﾗﾝｻﾞｸｼｮﾝ開始
            Call General.paBeginTrans()

            '処理経過初期化
            w_intCount = 0
            pProcessForm.pMaxValue = Integer.Parse(m_StaffRow.EndRow - m_StaffRow.StartRow + 1) \ m_MaxShowLine

            '職員数Loop
            '計画画面複数段対応
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then

                    '配列番号 取得
                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If IsNumeric(w_Var) = True Then
                        '職員ﾃﾞｰﾀ配列ｲﾝﾃﾞｯｸｽが取得できる場合のみ処理を行う

                        '配列ｲﾝﾃﾞｯｸｽ取得
                        w_Index = Integer.Parse(w_Var)
                        '職員管理番号 取得
                        w_StaffID = m_StaffData(w_Index).ID

                        '代休管理Ｆ更新
                        If General.g_lngDaikyuMng = 0 Then
                            Call Save_DaikyuData(w_Index)
                        End If

                        '保存対象期間Loop
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                            '対象日取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If

                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If
                            End If

                            '更新期間の設定(配属日している期間のみ)
                            w_HaizokuFlg = False
                            If w_CurrentDate <> 0 AndAlso w_Cnt > 0 Then
                                w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                                For w_Int = 1 To w_Idocnt
                                    If m_StaffData(w_Index).IdoData(w_Int).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_Int).SyuryoYMD Then
                                        w_HaizokuFlg = True
                                        Exit For
                                    End If
                                Next w_Int
                            End If

                            If w_HaizokuFlg = True Then
                                '配属期間内の場合

                                '勤務ﾃﾞｰﾀ 取得
                                If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                    '二段表示してる時　かつ　勤務変更時
                                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                    If w_Var = "" Then
                                        'まず下段を確認する
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                        '下段にデータが存在しない時は上段を確認する
                                    End If
                                Else
                                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                End If

                                '勤務ﾃﾞｰﾀ分割
                                '2015/04/10 Bando Upd Start ================================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                                '2015/04/10 Bando Upd Start ================================

                                If m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update OrElse m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete Then
                                    '予定/実績Ｆから取得したﾃﾞｰﾀがあるとき

                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                        '実績Ｆから取得したﾃﾞｰﾀのとき

                                        If m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            '該当部署確定ﾃﾞｰﾀの場合

                                            If (m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse m_StaffData(w_Index).KinmuData(w_Cnt).Time <> w_Time OrElse m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD <> w_KangoCD) AndAlso Trim(w_KinmuCD) <> "" Then
                                                '2015/04/10 Bando Add Start ==================
                                                '理由区分が希望じゃない場合コメントを削除
                                                If w_RiyuKBN <> "3" Then
                                                    w_Comment = ""
                                                End If
                                                '2015/04/10 Bando Add End   ==================
                                                'RICHARD UPDATE START
                                                'w_Sql = "Update NS_KINMURESULT_F set "
                                                'w_Sql = w_Sql & " KinmuCD = '" & w_KinmuCD & "' "
                                                'w_Sql = w_Sql & ",ReasonKbn = '" & w_RiyuKBN & "' "
                                                'w_Sql = w_Sql & ",OUENKINMUDEPTCD = '" & w_KangoCD & "' "
                                                'w_Sql = w_Sql & ",HOPECOMMENT = '" & w_Comment & "' " '2015/04/10 Bando Add
                                                'w_Sql = w_Sql & ",LastUpdTimeDate = " & w_SysDate & " "
                                                'w_Sql = w_Sql & ",RegistrantID = '" & General.g_strUserID & "' "
                                                'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
                                                'w_Sql = w_Sql & "And DateF = " & w_CurrentDate & " "
                                                'w_Sql = w_Sql & "And StaffMngID = '" & w_StaffID & "' "
                                                'Call General.paDBExecute(w_Sql)

                                                Call NSK0000H_sql.update_NS_KINMURESULT_F_01(w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate, w_CurrentDate, w_StaffID)
                                                'RICHARD UPDATE END

                                                If m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD Then
                                                    '勤務変更履歴Ｆ更新
                                                    Call Save_Henkourireki(w_CurrentDate, w_StaffID, m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD, w_KinmuCD)
                                                End If
                                                m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                                m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                                m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                                m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                            End If
                                        Else
                                            '他部署確定ﾃﾞｰﾀの場合

                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                '計画変更の場合のみ更新

                                                w_UpdateFlg = False
                                                If p_SaveType = True Then
                                                    '確定保存の場合
                                                    w_UpdateFlg = True
                                                    w_JissekiDataFlg = True
                                                Else
                                                    '保存終了の場合
                                                    If (m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD <> w_KinmuCD OrElse m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN <> w_RiyuKBN OrElse m_StaffData(w_Index).KinmuData(w_Cnt).Time <> w_Time OrElse m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD <> w_KangoCD) AndAlso Trim(w_KinmuCD) <> "" Then
                                                        w_UpdateFlg = True
                                                    End If
                                                End If
                                                If w_UpdateFlg = True Then
                                                    'richard update start
                                                    'w_Sql = "Update NS_KINMURESULT_F Set"
                                                    'w_Sql = w_Sql & " KinmuCD = '" & w_KinmuCD & "'"
                                                    'w_Sql = w_Sql & ", ReasonKbn = '" & w_RiyuKBN & "'"
                                                    'w_Sql = w_Sql & ", OUENKINMUDEPTCD = '" & w_KangoCD & "'"
                                                    'If p_SaveType = True Then
                                                    '    w_Sql = w_Sql & ", DecDeptCD = '" & General.g_strSelKinmuDeptCD & "'"
                                                    'End If
                                                    'w_Sql = w_Sql & ", HOPECOMMENT = '" & w_Comment & "'" '2015/04/10 Bando Add
                                                    'w_Sql = w_Sql & ", LastUpdTimeDate = " & w_SysDate
                                                    'w_Sql = w_Sql & ", RegistrantID = '" & General.g_strUserID & "'"
                                                    'w_Sql = w_Sql & " Where StaffMngID = '" & w_StaffID & "'"
                                                    'w_Sql = w_Sql & " And DateF = " & w_CurrentDate
                                                    'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                    'w_Sql = w_Sql & " "
                                                    'Call General.paDBExecute(w_Sql)

                                                    Call NSK0000H_sql.update_NS_KINMURESULT_F_03(w_KinmuCD, w_RiyuKBN, w_KangoCD, p_SaveType, w_Comment, w_SysDate, w_StaffID, w_CurrentDate)
                                                    'richard update end


                                                    m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                                    m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add

                                                    If p_SaveType = True Then
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                                        '変更履歴Ｆ削除
                                                        'richard update start
                                                        'w_Sql = "Delete From NS_KINMUCHGHISTORY_F"
                                                        'w_Sql = w_Sql & " Where StaffMngID = '" & w_StaffID & "'"
                                                        'w_Sql = w_Sql & " And DateF = " & w_CurrentDate
                                                        'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                        'w_Sql = w_Sql & " "
                                                        'Call General.paDBExecute(w_Sql)
                                                        Call NSK0000H_sql.delete_NS_KINMUCHGHISTORY_F_01(w_CurrentDate, w_StaffID)
                                                        'richard update end
                                                    End If
                                                Else
                                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Delete OrElse Trim(w_KinmuCD) = "" Then

                                                        'ﾃﾞｰﾀ削除
                                                        'RICHARD UPDATE START
                                                        'w_Sql = "Delete From NS_KINMURESULT_F"
                                                        'w_Sql = w_Sql & " Where StaffMngID = '" & w_StaffID & "'"
                                                        'w_Sql = w_Sql & " And DateF = " & w_CurrentDate
                                                        'w_Sql = w_Sql & " And HospitalCD = '" & General.g_strHospitalCD & "'"
                                                        'w_Sql = w_Sql & " "
                                                        'Call General.paDBExecute(w_Sql)

                                                        Call NSK0000H_sql.delete_NS_KINMURESULT_F_01(w_CurrentDate, w_StaffID)
                                                        'RICHARD UPDATE END

                                                        m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = 0
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).Time = Convert.ToString(0)
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = ""
                                                        m_StaffData(w_Index).KinmuData(w_Cnt).Comment = "" '2015/04/10 Bando Add
                                                    End If '---> ﾃﾞｰﾀ削除対象 Or 勤務CDが設定されていない場合
                                                End If '---> 更新？
                                            End If '---> 計画変更の場合
                                        End If '---> 確定部署CD？
                                    ElseIf m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_PLANDATA Then
                                        '予定ﾃﾞｰﾀの場合

                                        '確定保存の場合のみﾃﾞｰﾀ更新
                                        If p_SaveType = True Then

                                            w_JissekiDataFlg = True
                                            'RICHARD UPDATE START
                                            'w_Sql = "Insert Into NS_KINMURESULT_F ("
                                            'w_Sql = w_Sql & " HospitalCD"
                                            'w_Sql = w_Sql & ", DateF"
                                            'w_Sql = w_Sql & ", StaffMngID"
                                            'w_Sql = w_Sql & ", KinmuCD"
                                            'w_Sql = w_Sql & ", ReasonKbn"
                                            'w_Sql = w_Sql & ", OUENKINMUDEPTCD"
                                            'w_Sql = w_Sql & ", DecDeptCD"
                                            'w_Sql = w_Sql & ", HOPECOMMENT" '2015/04/10 Bando Add
                                            'w_Sql = w_Sql & ", RegistFirstTimeDate"
                                            'w_Sql = w_Sql & ", LastUpdTimeDate"
                                            'w_Sql = w_Sql & ", RegistrantID"
                                            'w_Sql = w_Sql & " ) Values ("
                                            'w_Sql = w_Sql & " '" & General.g_strHospitalCD & "'" 'HospitalCD
                                            'w_Sql = w_Sql & ", " & w_CurrentDate '年月日
                                            'w_Sql = w_Sql & ", '" & w_StaffID & "'" '職員管理番号
                                            'w_Sql = w_Sql & ", '" & w_KinmuCD & "'" 'KinmuCD
                                            'w_Sql = w_Sql & ", '" & w_RiyuKBN & "'" '理由区分
                                            'w_Sql = w_Sql & ", '" & w_KangoCD & "'" '応援先看護単位CD
                                            'w_Sql = w_Sql & ", '" & General.g_strSelKinmuDeptCD & "'" '確定部署CD（看護単位CD）
                                            'w_Sql = w_Sql & ", '" & w_Comment & "'" '希望コメント　2015/04/10 Bando Add
                                            'w_Sql = w_Sql & ", " & w_SysDate 'RegistFirstTimeDate
                                            'w_Sql = w_Sql & ", " & w_SysDate 'LastUpdTimeDate
                                            'w_Sql = w_Sql & ", '" & General.g_strUserID & "'" 'RegistrantID
                                            'w_Sql = w_Sql & " ) "
                                            'w_Sql = w_Sql & " "
                                            'Call General.paDBExecute(w_Sql)

                                            Call NSK0000H_sql.insert_NS_KINMURESULT_F_01(w_CurrentDate, w_StaffID, w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate)
                                            'RICHARD UPDATE END

                                            m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                            m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                            m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update
                                            m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA
                                            m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                            m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                            m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                        End If '---> 確定保存？
                                    End If '---> 予定ﾃﾞｰﾀ？　実績ﾃﾞｰﾀ？
                                Else
                                    '予定/実績 Ｆのﾃﾞｰﾀが存在しない場合

                                    '確定保存の場合のみﾃﾞｰﾀ更新
                                    If p_SaveType = True Then

                                        w_JissekiDataFlg = True
                                        'RICHARD UPDATE START
                                        'w_Sql = "Insert Into NS_KINMURESULT_F ("
                                        'w_Sql = w_Sql & " HospitalCD"
                                        'w_Sql = w_Sql & ", DateF"
                                        'w_Sql = w_Sql & ", StaffMngID"
                                        'w_Sql = w_Sql & ", KinmuCD"
                                        'w_Sql = w_Sql & ", ReasonKbn"
                                        'w_Sql = w_Sql & ", OUENKINMUDEPTCD"
                                        'w_Sql = w_Sql & ", DecDeptCD"
                                        'w_Sql = w_Sql & ", HOPECOMMENT" '2015/04/10 Bando Add
                                        'w_Sql = w_Sql & ", RegistFirstTimeDate"
                                        'w_Sql = w_Sql & ", LastUpdTimeDate"
                                        'w_Sql = w_Sql & ", RegistrantID"
                                        'w_Sql = w_Sql & " ) Values ("
                                        'w_Sql = w_Sql & " '" & General.g_strHospitalCD & "'" 'HospitalCD
                                        'w_Sql = w_Sql & ", " & w_CurrentDate '年月日
                                        'w_Sql = w_Sql & ", '" & w_StaffID & "'" '職員管理番号
                                        'w_Sql = w_Sql & ", '" & w_KinmuCD & "'" 'KinmuCD
                                        'w_Sql = w_Sql & ", '" & w_RiyuKBN & "'" '理由区分
                                        'w_Sql = w_Sql & ", '" & w_KangoCD & "'" '応援先看護単位CD
                                        'w_Sql = w_Sql & ", '" & General.g_strSelKinmuDeptCD & "'" '確定部署CD（看護単位CD）
                                        'w_Sql = w_Sql & ", '" & w_Comment & "'" '希望コメント　2015/04/10 Bando Add
                                        'w_Sql = w_Sql & ", " & w_SysDate 'RegistFirstTimeDate
                                        'w_Sql = w_Sql & ", " & w_SysDate 'LastUpdTimeDate
                                        'w_Sql = w_Sql & ", '" & General.g_strUserID & "'" 'RegistrantID
                                        'w_Sql = w_Sql & " ) "
                                        'w_Sql = w_Sql & " "
                                        'Call General.paDBExecute(w_Sql)
                                        Call NSK0000H_sql.insert_NS_KINMURESULT_F_01(w_CurrentDate, w_StaffID, w_KinmuCD, w_RiyuKBN, w_KangoCD, w_Comment, w_SysDate)
                                        'RICHARD UPDATE END

                                        m_StaffData(w_Index).KinmuData(w_Cnt).KinmuCD = w_KinmuCD
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Date_Renamed = w_CurrentDate
                                        m_StaffData(w_Index).KinmuData(w_Cnt).RiyuKBN = w_RiyuKBN
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Time = w_Time
                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataChk = M_DataFlg_Update
                                        m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA
                                        m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO
                                        m_StaffData(w_Index).KinmuData(w_Cnt).OuenKangoCD = w_KangoCD
                                        m_StaffData(w_Index).KinmuData(w_Cnt).Comment = w_Comment '2015/04/10 Bando Add
                                    End If '---> 確定保存？
                                End If '---> 予定/実績Ｆﾃﾞｰﾀの存在有無

                                '日付ｲﾝﾃﾞｯｸｽ 取得
                                w_NenkyuIdx = 0
                                For w_Int = 1 To UBound(m_StaffData(w_Index).NenkyuData)
                                    If m_StaffData(w_Index).NenkyuData(w_Int).Date_Renamed = w_CurrentDate Then
                                        w_NenkyuIdx = w_Int
                                        Exit For
                                    End If
                                Next w_Int

                                If m_PackageFLG = 0 OrElse m_PackageFLG = 1 Then
                                    '届出を使用していない場合は時間年休使用
                                    w_GetContentsKBN = ""
                                    w_HolCD = ""
                                    '2017/11/21 Yamanishi Upd Start ---------------------------------------------------------------
                                    'If IsNumeric(w_KinmuCD) Then
                                    '    If 0 <= Integer.Parse(w_KinmuCD) AndAlso Integer.Parse(w_KinmuCD) <= UBound(g_KinmuM) Then
                                    '        If g_KinmuM(Integer.Parse(w_KinmuCD)).HFlg = "2" Then
                                    '            '半日勤務ﾌﾗｸﾞ
                                    '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) Then
                                    '                'ＡＭ勤務CD
                                    '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD) <= UBound(g_KinmuM) Then
                                    '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD) AndAlso
                                    '                            g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                        '休み分類CD
                                    '                        w_GetContentsKBN = "2"
                                    '                        w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).AMCD)).HolBunruiCD
                                    '                    End If
                                    '                End If
                                    '            End If
                                    '            If IsNumeric(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) Then
                                    '                'ＰＭ勤務CD
                                    '                If 0 <= Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) AndAlso Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD) <= UBound(g_KinmuM) Then
                                    '                    If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD) AndAlso
                                    '                            g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                        '休み分類CD
                                    '                        If w_GetContentsKBN = "2" Then
                                    '                            w_GetContentsKBN = "2,3"
                                    '                            w_HolCD = w_HolCD & "," & g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                    '                        Else
                                    '                            w_GetContentsKBN = "3"
                                    '                            w_HolCD = g_KinmuM(Integer.Parse(g_KinmuM(Integer.Parse(w_KinmuCD)).PMCD)).HolBunruiCD
                                    '                        End If
                                    '                    End If
                                    '                End If
                                    '            End If
                                    '        Else
                                    '            If Not String.IsNullOrEmpty(g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD) AndAlso
                                    '                    g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD <> General.G_STRDAIKYUBUNRUI Then
                                    '                '休み分類CD
                                    '                w_GetContentsKBN = "1"
                                    '                w_HolCD = g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD
                                    '            End If
                                    '        End If
                                    '    End If
                                    'End If
                                    Call GetNenkyuContentsKbnAndHolCD(w_KinmuCD, w_GetContentsKBN, w_HolCD)
                                    '2017/11/21 Yamanishi Upd End -----------------------------------------------------------------
                                    '年休を保存しにいく
                                    If w_NenkyuIdx = 0 Then
                                        If w_Time <> "" OrElse w_GetContentsKBN <> "" Then
                                            w_NenkyuIdx = UBound(m_StaffData(w_Index).NenkyuData) + 1
                                            ReDim Preserve m_StaffData(w_Index).NenkyuData(w_NenkyuIdx)
                                            ReDim m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail(0)

                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Date_Renamed = w_CurrentDate
                                            Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataChk = False 'DBﾃﾞｰﾀなし
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).FirstRegistTimeDate = 0
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).LastUpdTimeDate = 0
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).RegistID = ""
                                        End If
                                    Else
                                        If m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = False Then
                                            Call Get_NenkyuDetail(w_Time, w_GetContentsKBN, m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).Detail, w_HolCD)
                                            m_StaffData(w_Index).NenkyuData(w_NenkyuIdx).DataFlg = True '更新する
                                        End If
                                    End If
                                End If
                            End If '---> 配属期間内？
                        Next w_Col '---> 保存対象期間Loop
                    End If '---> 職員ﾃﾞｰﾀ取得OK？

                    w_intCount = w_intCount + 1
                    pProcessForm.pCountValue = w_intCount
                End If
            Next w_Row '---> 職員数分Loop

            If m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                If p_SaveType = True Then
                    '確定保存のとき
                    '計画確定Ｆ更新
                    Call Save_PlanKakutei(False)
                End If
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                If w_JissekiDataFlg = True Then
                    '実績データがあるとき
                    '計画確定Ｆ更新
                    Call Save_PlanKakutei(False)
                End If
            End If

            'ｺﾐｯﾄ
            Call General.paCommit()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '勤務変更履歴Ｆの更新(p_CurrentDate:対象年月日,p_StaffID:職員管理番号,p_KinmuCD_Old:変更前勤務ｺｰﾄﾞ,p_KinmuCD_New:変更後勤務ｺｰﾄﾞ)
    Private Sub Save_Henkourireki(ByVal p_CurrentDate As Integer, ByVal p_StaffID As String, ByVal p_KinmuCD_Old As String, ByVal p_KinmuCD_New As String)

        Const W_SUBNAME As String = "NSK0000HA Save_Henkourireki"

        Dim w_Sql As String
        Dim w_SysDate As Integer
        Dim w_Seq As Integer
        'DAOｵﾌﾞｼﾞｪｸﾄ
        Dim w_Rs As ADODB.Recordset
        'ﾌｨｰﾙﾄﾞ
        Dim w_SEQ_F As ADODB.Field
        Try
            '更新年月日 取得
            w_SysDate = Integer.Parse(Format(Now, "yyyyMMdd"))

            'Select文 編集
            'richard update start
            'w_Sql = "Select  SEQ "
            'w_Sql = w_Sql & "From NS_KINMUCHGHISTORY_F "
            'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "And DateF = " & p_CurrentDate & " "
            'w_Sql = w_Sql & "And StaffMngID = '" & p_StaffID & "' "
            'w_Sql = w_Sql & "Order By SEQ Desc "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_KINMUCHGHISTORY_F_01(w_Rs, p_CurrentDate, p_StaffID) '<40>
            'richard update end

            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しないとき

                'SEQを1に設定
                w_Seq = 1
            Else
                'ﾃﾞｰﾀが存在するとき

                w_SEQ_F = w_Rs.Fields("SEQ")

                'SEQの最大値を取得(1件目のﾃﾞｰﾀが最大値)
                w_Seq = w_SEQ_F.Value

                w_Seq = w_Seq + 1
            End If
            w_Rs.Close()

            'Insert文 編集
            'RICHARD UPDATE START
            'w_Sql = "Insert Into NS_KINMUCHGHISTORY_F "
            'w_Sql = w_Sql & "(HospitalCD,DateF,StaffMngID,SEQ,ChgBeforeKinmu,ChgAfterKinmu,LastUpdTimeDate,RegistrantID)"
            'w_Sql = w_Sql & "Values('" & General.g_strHospitalCD & "'," & p_CurrentDate & ",'" & p_StaffID & "'," & w_Seq & ",'" & p_KinmuCD_Old
            'w_Sql = w_Sql & "','" & p_KinmuCD_New & "'," & w_SysDate & ",'" & General.g_strUserID & "')"
            'Call General.paDBExecute(w_Sql)
            Call NSK0000H_sql.insert_NS_KINMUCHGHISTORY_F_01(p_CurrentDate, p_StaffID, w_Seq, p_KinmuCD_Old, p_KinmuCD_New, w_SysDate) '<41>
            'RICHARD UPDATE END

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '計画確定Ｆ更新
    Private Sub Save_PlanKakutei(ByVal p_DeleteFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA Save_PlanKakutei"

        Dim w_Sql As String
        Dim w_SysDate As String
        Dim w_KakuteiDate As Integer
        'DAOｵﾌﾞｼﾞｪｸﾄ
        Dim w_Rs As ADODB.Recordset
        'ﾌｨｰﾙﾄﾞ
        Try
            '更新年月日 取得
            w_SysDate = General.paGetDateString(Now, True)
            w_KakuteiDate = Integer.Parse(Format(Now, "yyyyMMdd"))

            If p_DeleteFlg = False Then
                '追加 or 更新の場合
                'Select文 編集
                'richard update start
                'w_Sql = "SELECT  * "
                'w_Sql = w_Sql & "FROM NS_PLANDECISION_F "
                'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                'w_Sql = w_Sql & "AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
                'w_Sql = w_Sql & "AND PLANNO = " & m_PlanNo & " "
                ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
                'w_Rs = General.paDBRecordSetOpen(w_Sql)
                Call NSK0000H_sql.select_NS_PLANDECISION_F_02(w_Rs, m_PlanNo) '<25>
                'richard update end

                If w_Rs.RecordCount <= 0 Then
                    'ﾃﾞｰﾀが存在しないとき

                    '追加する
                    'Insert文 編集
                    'RICHARD UPDATE START
                    'w_Sql = "INSERT INTO NS_PLANDECISION_F "
                    'w_Sql = w_Sql & "(HOSPITALCD,KINMUDEPTCD,PLANNO,DECISIONDATE,LASTUPDTIMEDATE,REGISTRANTID)"
                    'w_Sql = w_Sql & "VALUES('" & General.g_strHospitalCD & "','" & General.g_strSelKinmuDeptCD & "'," & m_PlanNo & "," & w_KakuteiDate
                    'w_Sql = w_Sql & "," & w_SysDate & ",'" & General.g_strUserID & "')"
                    'Call General.paDBExecute(w_Sql)
                    Call NSK0000H_sql.insert_NS_PLANDECISION_F_01(m_PlanNo, w_KakuteiDate, w_SysDate) '<26>
                    'RICHARD UPDATE END
                Else
                    'ﾃﾞｰﾀが存在するとき

                    '更新する
                    'Update文 編集
                    'RICHARD UPDATE START
                    'w_Sql = "UPDATE NS_PLANDECISION_F "
                    'w_Sql = w_Sql & "SET LASTUPDTIMEDATE = " & w_SysDate & ", "
                    'w_Sql = w_Sql & "    REGISTRANTID = '" & General.g_strUserID & "' "
                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                    'w_Sql = w_Sql & "AND   KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
                    'w_Sql = w_Sql & "AND   PLANNO = " & m_PlanNo & " "
                    'Call General.paDBExecute(w_Sql)
                    Call NSK0000H_sql.update_NS_PLANDECISION_F_01(w_SysDate, m_PlanNo) '<27>
                    'RICHARD UPDATE END
                End If
                w_Rs.Close()
            Else
                '削除の場合
                'Delete文 編集
                'RICHARD UPDATE START
                'w_Sql = "DELETE FROM NS_PLANDECISION_F "
                'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                'w_Sql = w_Sql & "AND   KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
                'w_Sql = w_Sql & "AND   PLANNO = " & m_PlanNo & " "
                'Call General.paDBExecute(w_Sql)
                Call NSK0000H_sql.delete_NS_PLANDECISION_F_01(m_PlanNo) '<28>
                'RICHARD UPDATE END
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '職員歴Ｆの更新
    Private Sub Save_Shokuinreki(ByVal p_Index As Integer)

        Const W_SUBNAME As String = "NSK0000HA Save_Shokuinreki"

        Dim w_Sql As String
        Dim w_SysDate As Double
        Dim w_HyojiNo1 As Integer
        Dim w_HyojiNo2 As Integer
        Dim w_HyojiNo3 As Integer
        Dim w_HyojiNo4 As Integer
        Dim w_HyojiNo5 As Integer
        Dim w_Team As Integer
        Dim w_AutoKBN As String
        Dim w_GiryoLvCD As String
        Dim w_YakinKBN As String
        Dim w_PattenCD As String
        Dim w_DispNo1 As Integer
        Dim w_DispNo2 As Integer
        Dim w_DispNo3 As Integer
        Dim w_DispNo4 As Integer
        Dim w_DispNo5 As Integer
        'DAOｵﾌﾞｼﾞｪｸﾄ
        Dim w_Rs As ADODB.Recordset
        Dim w_表示No1_F As ADODB.Field
        Dim w_表示No2_F As ADODB.Field
        Dim w_表示No3_F As ADODB.Field
        Dim w_表示No4_F As ADODB.Field
        Dim w_表示No5_F As ADODB.Field
        Dim w_チーム_F As ADODB.Field
        Dim w_自動割当区分_F As ADODB.Field
        Dim w_SkillLvlCD_F As ADODB.Field
        Dim w_夜勤KBN_F As ADODB.Field
        Dim w_PatternCD_F As ADODB.Field

        Try
            '対象期間内に在職してない場合
            If m_StaffData(p_Index).TargetKikanFlg = False Then
                Exit Sub
            End If

            If m_StaffData(p_Index).HyojiNo1 > 0 Then
                w_DispNo1 = m_StaffData(p_Index).HyojiNo1
            Else
                w_DispNo1 = m_StaffData(p_Index).InitialHyojiNo
            End If
            If m_StaffData(p_Index).HyojiNo2 > 0 Then
                w_DispNo2 = m_StaffData(p_Index).HyojiNo2
            Else
                w_DispNo2 = m_StaffData(p_Index).InitialHyojiNo
            End If
            If m_StaffData(p_Index).HyojiNo3 > 0 Then
                w_DispNo3 = m_StaffData(p_Index).HyojiNo3
            Else
                w_DispNo3 = m_StaffData(p_Index).InitialHyojiNo
            End If
            If m_StaffData(p_Index).HyojiNo4 > 0 Then
                w_DispNo4 = m_StaffData(p_Index).HyojiNo4
            Else
                w_DispNo4 = m_StaffData(p_Index).InitialHyojiNo
            End If
            If m_StaffData(p_Index).HyojiNo5 > 0 Then
                w_DispNo5 = m_StaffData(p_Index).HyojiNo5
            Else
                w_DispNo5 = m_StaffData(p_Index).InitialHyojiNo
            End If

            '更新日時 取得
            w_SysDate = Double.Parse(General.paGetDateString(Now, True))

            ''Select文 編集
            'richard update start
            'w_Sql = "SELECT   SKILLLVLCD "
            'w_Sql = w_Sql & ",DISPNO1 "
            'w_Sql = w_Sql & ",DISPNO2 "
            'w_Sql = w_Sql & ",DISPNO3 "
            'w_Sql = w_Sql & ",DISPNO4 "
            'w_Sql = w_Sql & ",DISPNO5 "
            'w_Sql = w_Sql & ",AUTOALLOCKBN "
            'w_Sql = w_Sql & ",TEAM "
            'w_Sql = w_Sql & ",NIGHTONLYSTAFFKBN "
            'w_Sql = w_Sql & ",PATTERNCD "
            'w_Sql = w_Sql & "FROM NS_STAFFHISTORY_F "
            'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "AND PLANNO = " & m_PlanNo & " "
            'w_Sql = w_Sql & "AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
            'w_Sql = w_Sql & "AND STAFFMNGID = '" & m_StaffData(p_Index).ID & "' "
            ''RecordSet ｵﾌﾞｼﾞｪｸﾄの作成(参照のみ)
            'w_Rs = General.paDBRecordSetOpen(w_Sql)

            Call NSK0000H_sql.select_NS_STAFFHISTORY_F_02(w_Rs, m_PlanNo, m_StaffData(p_Index).ID)
            'richard update end

            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しないとき

                'Insert文 編集
                'richard update start
                'w_Sql = "INSERT INTO NS_STAFFHISTORY_F ( "
                'w_Sql = w_Sql & "HOSPITALCD, "
                'w_Sql = w_Sql & "PLANNO, "
                'w_Sql = w_Sql & "KINMUDEPTCD, "
                'w_Sql = w_Sql & "STAFFMNGID, "
                'w_Sql = w_Sql & "SKILLLVLCD, "
                'w_Sql = w_Sql & "DISPNO, "
                'w_Sql = w_Sql & "DISPNO1, "
                'w_Sql = w_Sql & "DISPNO2, "
                'w_Sql = w_Sql & "DISPNO3, "
                'w_Sql = w_Sql & "DISPNO4, "
                'w_Sql = w_Sql & "DISPNO5, "
                'w_Sql = w_Sql & "AUTOALLOCKBN, "
                'w_Sql = w_Sql & "TEAM, "
                'w_Sql = w_Sql & "NIGHTONLYSTAFFKBN, "
                'w_Sql = w_Sql & "PATTERNCD, "
                'w_Sql = w_Sql & "REGISTFIRSTTIMEDATE, "
                'w_Sql = w_Sql & "LASTUPDTIMEDATE, "
                'w_Sql = w_Sql & "REGISTRANTID "
                'w_Sql = w_Sql & ") VALUES ( "
                'w_Sql = w_Sql & "'" & General.g_strHospitalCD & "', "
                'w_Sql = w_Sql & m_PlanNo & ", "
                'w_Sql = w_Sql & "'" & General.g_strSelKinmuDeptCD & "', "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).ID & "', "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).GiryoLvCD & "', "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).HyojiNo & "', "
                'w_Sql = w_Sql & "'" & w_DispNo1 & "', "
                'w_Sql = w_Sql & "'" & w_DispNo2 & "', "
                'w_Sql = w_Sql & "'" & w_DispNo3 & "', "
                'w_Sql = w_Sql & "'" & w_DispNo4 & "', "
                'w_Sql = w_Sql & "'" & w_DispNo5 & "', "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).AutoKBN & "', "
                'w_Sql = w_Sql & m_StaffData(p_Index).Team & ", "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).YakinKBN & "', "
                'w_Sql = w_Sql & "'" & m_StaffData(p_Index).PatternCD & "', "
                'w_Sql = w_Sql & w_SysDate & ", "
                'w_Sql = w_Sql & w_SysDate & ", "
                'w_Sql = w_Sql & "'" & General.g_strUserID & "' "
                'w_Sql = w_Sql & ") "
                'Call General.paDBExecute(w_Sql)

                Call NSK0000H_sql.insert_NS_STAFFHISTORY_F_01(m_PlanNo,
                                                 m_StaffData,
                                                 p_Index,
                                                 w_DispNo1,
                                                 w_DispNo2,
                                                 w_DispNo3,
                                                 w_DispNo4,
                                                 w_DispNo5,
                                                 w_SysDate)
                'richard update end
            Else
                'ﾃﾞｰﾀが存在するとき

                'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ生成
                w_SkillLvlCD_F = w_Rs.Fields("SkillLvlCD")
                w_表示No1_F = w_Rs.Fields("DispNo1")
                w_表示No2_F = w_Rs.Fields("DispNo2")
                w_表示No3_F = w_Rs.Fields("DispNo3")
                w_表示No4_F = w_Rs.Fields("DispNo4")
                w_表示No5_F = w_Rs.Fields("DispNo5")
                w_自動割当区分_F = w_Rs.Fields("AutoAllocKbn")
                w_チーム_F = w_Rs.Fields("Team")
                w_夜勤KBN_F = w_Rs.Fields("NightOnlyStaffKbn")
                w_PatternCD_F = w_Rs.Fields("PATTERNCD")

                w_GiryoLvCD = IIf(IsDBNull(w_SkillLvlCD_F.Value), "", w_SkillLvlCD_F.Value)
                w_HyojiNo1 = General.paGetDbFieldVal(w_表示No1_F, 0)
                w_HyojiNo2 = General.paGetDbFieldVal(w_表示No2_F, 0)
                w_HyojiNo3 = General.paGetDbFieldVal(w_表示No3_F, 0)
                w_HyojiNo4 = General.paGetDbFieldVal(w_表示No4_F, 0)
                w_HyojiNo5 = General.paGetDbFieldVal(w_表示No5_F, 0)
                w_AutoKBN = IIf(IsDBNull(w_自動割当区分_F.Value), "", w_自動割当区分_F.Value)
                w_Team = IIf(IsDBNull(w_チーム_F.Value), 0, w_チーム_F.Value)
                w_YakinKBN = IIf(IsDBNull(w_夜勤KBN_F.Value), "", w_夜勤KBN_F.Value)
                w_PattenCD = IIf(IsDBNull(w_PatternCD_F.Value), "", w_PatternCD_F.Value)

                If m_StaffData(p_Index).GiryoLvCD <> w_GiryoLvCD OrElse
                        w_DispNo1 <> w_HyojiNo1 OrElse
                        w_DispNo2 <> w_HyojiNo2 OrElse
                        w_DispNo3 <> w_HyojiNo3 OrElse
                        w_DispNo4 <> w_HyojiNo4 OrElse
                        w_DispNo5 <> w_HyojiNo5 OrElse
                        m_StaffData(p_Index).AutoKBN <> w_AutoKBN OrElse
                        m_StaffData(p_Index).Team <> w_Team OrElse
                        m_StaffData(p_Index).YakinKBN <> w_YakinKBN OrElse
                        m_StaffData(p_Index).PatternCD <> w_PattenCD Then
                    'Update文 編集
                    'richard update start
                    'w_Sql = "UPDATE NS_STAFFHISTORY_F SET "
                    'w_Sql = w_Sql & " SKILLLVLCD = '" & m_StaffData(p_Index).GiryoLvCD & "' "
                    'w_Sql = w_Sql & ",DISPNO = '" & m_StaffData(p_Index).HyojiNo & "' "
                    'w_Sql = w_Sql & ",DISPNO1 = '" & w_DispNo1 & "' "
                    'w_Sql = w_Sql & ",DISPNO2 = '" & w_DispNo2 & "' "
                    'w_Sql = w_Sql & ",DISPNO3 = '" & w_DispNo3 & "' "
                    'w_Sql = w_Sql & ",DISPNO4 = '" & w_DispNo4 & "' "
                    'w_Sql = w_Sql & ",DISPNO5 = '" & w_DispNo5 & "' "
                    'w_Sql = w_Sql & ",AUTOALLOCKBN = '" & m_StaffData(p_Index).AutoKBN & "' "
                    'w_Sql = w_Sql & ",TEAM = " & m_StaffData(p_Index).Team & " "
                    'w_Sql = w_Sql & ",NIGHTONLYSTAFFKBN = " & m_StaffData(p_Index).YakinKBN & " "
                    'w_Sql = w_Sql & ",PATTERNCD = '" & m_StaffData(p_Index).PatternCD & "' "
                    'w_Sql = w_Sql & ",LASTUPDTIMEDATE = " & w_SysDate & " "
                    'w_Sql = w_Sql & ",REGISTRANTID = '" & General.g_strUserID & "' "
                    'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                    'w_Sql = w_Sql & "AND PLANNO = " & m_PlanNo & " "
                    'w_Sql = w_Sql & "AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
                    'w_Sql = w_Sql & "AND STAFFMNGID = '" & m_StaffData(p_Index).ID & "' "
                    'Call General.paDBExecute(w_Sql)

                    Call NSK0000H_sql.update_NS_STAFFHISTORY_F_01(m_StaffData, p_Index, w_DispNo1, w_DispNo2, w_DispNo3, w_DispNo4, w_DispNo5, w_SysDate, m_PlanNo)
                    'richard update end

                End If
            End If
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '代休管理Ｆの更新
    Private Sub Save_DaikyuData(ByVal p_Index As Integer)

        Const W_SUBNAME As String = "NSK0000HA Save_DaikyuData"

        Dim w_Int As Integer
        Dim w_Sql As String
        Dim w_SysDate As Double
        Dim w_lngLoop As Integer
        Try
            '更新日時 取得
            w_SysDate = Double.Parse(General.paGetDateString(Now, True))

            'Delete文 編集
            'richard update start
            'w_Sql = "Delete From NS_DAIKYUMNG_F "
            'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "And StaffMngID = '" & m_StaffData(p_Index).ID & "' "
            'w_Sql = w_Sql & "And WorkHolKinmuDate >= " & m_lngDaikyuStartDate & " "
            'w_Sql = w_Sql & "And WorkHolKinmuDate <= " & m_lngDaikyuEndDate
            'Call General.paDBExecute(w_Sql)
            Call NSK0000H_sql.delete_NS_DAIKYUMNG_F_01(m_StaffData, p_Index, m_lngDaikyuStartDate, m_lngDaikyuEndDate) '<31>
            'richard update end

            '代休詳細管理Ｆ
            'richard update start
            'w_Sql = "Delete From NS_DAIKYUDETAILMNG_F "
            'w_Sql = w_Sql & "Where HospitalCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "And StaffMngID = '" & m_StaffData(p_Index).ID & "' "
            'w_Sql = w_Sql & "And WorkHolKinmuDate >= " & m_lngDaikyuStartDate & " "
            'w_Sql = w_Sql & "And WorkHolKinmuDate <= " & m_lngDaikyuEndDate
            'Call General.paDBExecute(w_Sql)
            Call NSK0000H_sql.delete_NS_DAIKYUDETAILMNG_F_01(m_StaffData, p_Index, m_lngDaikyuStartDate, m_lngDaikyuEndDate)
            'richard update end


            'Insert文 編集
            For w_Int = 1 To UBound(m_StaffData(p_Index).Daikyu)

                '代休管理Ｆ
                'richard update start 
                'w_Sql = "Insert Into NS_DAIKYUMNG_F "
                'w_Sql = w_Sql & "(HospitalCD,"
                'w_Sql = w_Sql & " StaffMngID,"
                'w_Sql = w_Sql & " GetKbn,"
                'w_Sql = w_Sql & " WorkHolKinmuDate,"
                'w_Sql = w_Sql & " WorkHolKinmuCD,"
                'w_Sql = w_Sql & " TodokedeNo,"
                'w_Sql = w_Sql & " RegistFirstTimeDate,"
                'w_Sql = w_Sql & " LastUpdTimeDate,"
                'w_Sql = w_Sql & " RegistrantID) "
                'w_Sql = w_Sql & " Values('" & General.g_strHospitalCD & "','"
                'w_Sql = w_Sql & m_StaffData(p_Index).ID & "','"
                'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).GetKbn & "',"
                'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).HolDate & ",'"
                'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).HolKinmuCD & "',"
                'w_Sql = w_Sql & "0,"
                'w_Sql = w_Sql & w_SysDate & ","
                'w_Sql = w_Sql & w_SysDate & ",'"
                'w_Sql = w_Sql & General.g_strUserID & "')"
                'Call General.paDBExecute(w_Sql)
                Call NSK0000H_sql.insert_NS_DAIKYUMNG_F_01(m_StaffData, p_Index, w_Int, w_SysDate) '<30>
                'richard update end

                '代休詳細管理Ｆ
                For w_lngLoop = 1 To UBound(m_StaffData(p_Index).Daikyu(w_Int).DaikyuDetail)
                    If m_StaffData(p_Index).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuDate <> 0 Then
                        'richard update start
                        'w_Sql = "Insert Into NS_DAIKYUDETAILMNG_F "
                        'w_Sql = w_Sql & "(HospitalCD,"
                        'w_Sql = w_Sql & " StaffMngID,"
                        'w_Sql = w_Sql & " WorkHolKinmuDate,"
                        'w_Sql = w_Sql & " SEQ,"
                        'w_Sql = w_Sql & " GetFlg,"
                        'w_Sql = w_Sql & " GetDaikyuDate,"
                        'w_Sql = w_Sql & " GetDaikyuKinmuCD,"
                        'w_Sql = w_Sql & " RegistFirstTimeDate,"
                        'w_Sql = w_Sql & " LastUpdTimeDate,"
                        'w_Sql = w_Sql & " RegistrantID) "
                        'w_Sql = w_Sql & " Values('" & General.g_strHospitalCD & "','"
                        'w_Sql = w_Sql & m_StaffData(p_Index).ID & "',"
                        'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).HolDate & ","
                        'w_Sql = w_Sql & w_lngLoop & ",'"
                        'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).DaikyuDetail(w_lngLoop).GetFlg & "',"
                        'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuDate & ",'"
                        'w_Sql = w_Sql & m_StaffData(p_Index).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuKinmuCD & "',"
                        'w_Sql = w_Sql & w_SysDate & ","
                        'w_Sql = w_Sql & w_SysDate & ",'"
                        'w_Sql = w_Sql & General.g_strUserID & "')"
                        'Call General.paDBExecute(w_Sql)
                        Call NSK0000H_sql.insert_NS_DAIKYUDETAILMNG_F_01(m_StaffData, p_Index, w_Int, w_lngLoop, w_SysDate)
                        'ricahrd update end
                    End If
                Next w_lngLoop
            Next w_Int

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '実績ﾃﾞｰﾀの未設定部分を検索する(p_SavwType:保存のﾀｲﾌﾟ False:保存,True:確定保存)
    Private Function ChkJissekiNull(ByVal p_SaveType As Boolean) As Boolean

        Const W_SUBNAME As String = "NSK0000HA ChkJissekiNull"

        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_StartDate As Date '計画開始日
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_StaffName As String
        Dim w_Day As String
        Dim w_KeikakuCol As Integer
        Dim w_MsgRc As Integer
        Dim w_Idocnt As Integer
        Dim w_IdoLoop As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_ChkFlg As Boolean
        Dim w_KinmuCD As String = String.Empty
        Dim w_Riyu As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String

        '初期化
        ChkJissekiNull = False
        Try
            '計画開始日付を日付型に変換
            w_StartDate = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                    '配列番号 取得

                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                    If IsNumeric(w_Var) = True Then

                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽ取得
                        w_Index = Integer.Parse(w_Var)

                        '計画期間日数Loop
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                            '該当列の年月日を取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If

                            '勤務ﾃﾞｰﾀ退避配列ｲﾝﾃﾞｯｸｽ取得
                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(DirectCast(w_CurrentDate, Object), w_GetCol) = True Then
                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If
                            Else
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            End If

                            '配属しているの？
                            w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                            w_HaizokuFlg = False
                            For w_IdoLoop = 1 To w_Idocnt
                                If m_StaffData(w_Index).IdoData(w_IdoLoop).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_IdoLoop).SyuryoYMD Then
                                    w_HaizokuFlg = True
                                    Exit For
                                End If
                            Next w_IdoLoop

                            If w_HaizokuFlg = True Then
                                '配属期間内の勤務ﾃﾞｰﾀなら

                                w_ChkFlg = False
                                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                If w_Var = "" Then
                                    If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '二段表示してる時　かつ　勤務変更時
                                        '下段も確認する
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                        If w_Var = "" Then
                                            w_ChkFlg = True
                                        End If
                                    Else
                                        w_ChkFlg = True
                                    End If
                                End If

                                If w_ChkFlg = False Then
                                    '2015/04/10 Bando Upd Start =========================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_Riyu, w_Flg, w_KangoCD, w_Time)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_Riyu, w_Flg, w_KangoCD, w_Time, "")
                                    '2015/04/10 Bando Upd End   =========================================
                                    If IsNumeric(w_KinmuCD) = False Then
                                        w_ChkFlg = True
                                    End If
                                End If

                                If p_SaveType = False Then
                                    '保存終了の場合

                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                        '実績ﾃﾞｰﾀで該当部署確定ﾃﾞｰﾀならNullチェック
                                        If w_ChkFlg = True Then
                                            '職員氏名 取得
                                            w_StaffName = m_StaffData(w_Index).StaffName
                                            '日付
                                            w_Day = Format(Date.Parse(Format(w_CurrentDate, "0000/00/00")), "MM月dd日")
                                            'ｴﾗｰﾒｯｾｰｼﾞ表示
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = w_StaffName & " の " & w_Day
                                            Call Set_MsgZOrder("NS0118", w_strMsg, w_MsgRc, 0)

                                            'ｴﾗｰにより処理中止
                                            Exit Function
                                        End If
                                    End If
                                Else
                                    '確定終了時の場合

                                    If w_ChkFlg = True Then
                                        '職員氏名 取得
                                        w_StaffName = m_StaffData(w_Index).StaffName
                                        '日付
                                        w_Day = Format(Date.Parse(Format(w_CurrentDate, "0000/00/00")), "MM月dd日")
                                        'ｴﾗｰﾒｯｾｰｼﾞ表示
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = w_StaffName & " の " & w_Day
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            Call Set_MsgZOrder("NS0267", w_strMsg, w_MsgRc, 0)
                                        Else
                                            Call Set_MsgZOrder("NS0118", w_strMsg, w_MsgRc, 0)
                                        End If

                                        'ｴﾗｰにより処理中止
                                        Exit Function
                                    End If
                                End If
                            End If '---> 配属期間内？
                        Next w_Col
                    End If '---> 職員ﾃﾞｰﾀ変数ｲﾝﾃﾞｯｸｽ　取得できた？
                End If
            Next w_Row

            'ﾁｪｯｸ通過
            ChkJissekiNull = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '2015/05/22 Bando Add Start ===================================================================
    '実績ﾃﾞｰﾀの未設定部分を検索する(p_SavwType:保存のﾀｲﾌﾟ False:保存,True:確定保存)
    Private Function ChkEfftoDate(ByVal p_SaveType As Boolean) As Boolean

        Const W_SUBNAME As String = "NSK0000HA ChkEfftoDate"

        Dim w_Cnt As Integer
        Dim w_Row As Integer
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_StartDate As Date '計画開始日
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_StaffName As String
        Dim w_Day As String
        Dim w_KeikakuCol As Integer
        Dim w_MsgRc As Integer
        Dim w_Idocnt As Integer
        Dim w_IdoLoop As Integer
        Dim w_HaizokuFlg As Boolean
        Dim w_ChkFlg As Boolean
        Dim w_KinmuCD As String = String.Empty
        Dim w_Riyu As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_GetCol As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String

        '初期化
        ChkEfftoDate = False
        Try
            '計画開始日付を日付型に変換
            w_StartDate = Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                    '配列番号 取得

                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)

                    If IsNumeric(w_Var) = True Then

                        '職員ﾃﾞｰﾀ格納変数配列ｲﾝﾃﾞｯｸｽ取得
                        w_Index = Integer.Parse(w_Var)

                        '計画期間日数Loop
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol

                            '該当列の年月日を取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                w_CurrentDate = Integer.Parse(w_Var)
                            Else
                                w_CurrentDate = 0
                            End If

                            '勤務ﾃﾞｰﾀ退避配列ｲﾝﾃﾞｯｸｽ取得
                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(DirectCast(w_CurrentDate, Object), w_GetCol) = True Then
                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                Else
                                    w_Cnt = 0
                                End If
                            Else
                                '1ｹ月/1ｹ月,4週/4週の場合
                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                w_Cnt = w_Col - w_KeikakuCol + 1
                            End If

                            '配属しているの？
                            w_Idocnt = UBound(m_StaffData(w_Index).IdoData)
                            w_HaizokuFlg = False
                            For w_IdoLoop = 1 To w_Idocnt
                                If m_StaffData(w_Index).IdoData(w_IdoLoop).IdoYMD <= w_CurrentDate AndAlso w_CurrentDate <= m_StaffData(w_Index).IdoData(w_IdoLoop).SyuryoYMD Then
                                    w_HaizokuFlg = True
                                    Exit For
                                End If
                            Next w_IdoLoop

                            If w_HaizokuFlg = True Then
                                '配属期間内の勤務ﾃﾞｰﾀなら

                                w_ChkFlg = False
                                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, w_Col)
                                If w_Var = "" Then
                                    If m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                        '二段表示してる時　かつ　勤務変更時
                                        '下段も確認する
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row + 1, w_Col)
                                        If w_Var = "" Then
                                            w_ChkFlg = True
                                        End If
                                    Else
                                        w_ChkFlg = True
                                    End If
                                End If

                                If w_ChkFlg = False Then
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_Riyu, w_Flg, w_KangoCD, w_Time, "")

                                    '勤務日時点で有効終了日が切れているかチェック
                                    For w_i As Integer = 1 To UBound(g_KinmuM)
                                        If w_KinmuCD = g_KinmuM(w_i).CD Then
                                            If w_CurrentDate > g_KinmuM(w_i).EfftoDate Then
                                                w_ChkFlg = True
                                                Exit For
                                            End If
                                        End If
                                    Next
                                End If

                                If p_SaveType = False Then
                                    '保存終了の場合

                                    If m_StaffData(w_Index).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_Index).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                        '実績ﾃﾞｰﾀで該当部署確定ﾃﾞｰﾀならNullチェック
                                        If w_ChkFlg = True Then
                                            '職員氏名 取得
                                            w_StaffName = m_StaffData(w_Index).StaffName
                                            '日付
                                            w_Day = Format(Date.Parse(Format(w_CurrentDate, "0000/00/00")), "MM月dd日")
                                            'ｴﾗｰﾒｯｾｰｼﾞ表示
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = w_StaffName & " の " & w_Day
                                            Call Set_MsgZOrder("NS0408", w_strMsg, w_MsgRc, 0)

                                            'ｴﾗｰにより処理中止
                                            Exit Function
                                        End If
                                    End If
                                Else
                                    '確定終了時の場合

                                    If w_ChkFlg = True Then
                                        '職員氏名 取得
                                        w_StaffName = m_StaffData(w_Index).StaffName
                                        '日付
                                        w_Day = Format(Date.Parse(Format(w_CurrentDate, "0000/00/00")), "MM月dd日")
                                        'ｴﾗｰﾒｯｾｰｼﾞ表示
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = w_StaffName & " の " & w_Day
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            Call Set_MsgZOrder("NS0408", w_strMsg, w_MsgRc, 0)
                                        Else
                                            Call Set_MsgZOrder("NS0408", w_strMsg, w_MsgRc, 0)
                                        End If

                                        'ｴﾗｰにより処理中止
                                        Exit Function
                                    End If
                                End If
                            End If '---> 配属期間内？
                        Next w_Col
                    End If '---> 職員ﾃﾞｰﾀ変数ｲﾝﾃﾞｯｸｽ　取得できた？
                End If
            Next w_Row

            'ﾁｪｯｸ通過
            ChkEfftoDate = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '必須勤務チェック
    Private Function ChkAbsoluteKinmu(ByVal p_SaveType As Boolean) As Boolean

        Const W_SUBNAME As String = "NSK0000HA ChkEfftoDate"

        Dim w_KinmuCD As String = String.Empty
        Dim w_Riyu As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_SprObj As FpSpread = Nothing
        Dim w_lngViewFrom As Integer
        Dim w_lngViewTo As Integer
        Dim w_SelectIndex As Integer
        Dim w_MsgAns As Integer

        '初期化
        ChkAbsoluteKinmu = False
        Try

            '必須対象勤務コード取得
            Call getAbsKinmuData()

            ReDim g_NotAbsKinmuCheckError(0)
            ReDim m_RenzokuCnt(UBound(m_StaffData), UBound(m_strAbsKinmuCD))

            For w_Int = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                Call Check_AbsoluteKinmu(w_Int)
            Next


            For w_Int = m_StaffRow.StartRow To m_StaffRow.EndRow
                '必須勤務の組み合わせチェック
                If w_Int = m_StaffRow.StartRow Then
                    '4週/1ヶ月の場合の計画期間開始日を取得する
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '2015/05/29 Bando Upd Start ================================
                        '4週/1ヶ月の場合
                        'If m_SelViewKikan = 0 Then
                        w_SprObj = sprSheet_M
                        w_lngViewFrom = m_KeikakuKikan.StartDate
                        w_lngViewTo = m_KeikakuKikan.EndDate
                        'Else
                        '    w_SprObj = sprSheet_4W
                        '    w_SelectIndex = Integer.Parse(GetItemData(cmbKikan, cmbKikan.SelectedIndex))
                        '    w_lngViewFrom = m_4WeekKikan(w_SelectIndex).StartDate
                        '    w_lngViewTo = m_4WeekKikan(w_SelectIndex).EndDate
                        'End If
                        '2015/05/29 Bando Upd End   ================================
                    Else
                        w_SprObj = sprSheet_M
                        w_lngViewFrom = m_KeikakuKikan.StartDate
                        w_lngViewTo = m_KeikakuKikan.EndDate
                    End If
                End If

                'エラー表示状況表示
                For w_Int2 = 1 To UBound(g_NotAbsKinmuCheckError)
                    For w_i As Integer = 1 To UBound(g_NotAbsKinmuCheckError(w_Int2).Data)
                        If g_NotAbsKinmuCheckError(w_Int2).Data(w_i).ErrorFlg = True And g_NotAbsKinmuCheckError(w_Int2).Data(w_i).ErrorDate >= w_lngViewFrom And g_NotAbsKinmuCheckError(w_Int2).Data(w_i).ErrorDate <= w_lngViewTo Then

                            'ｴﾗｰﾒｯｾｰｼﾞ表示
                            ReDim w_strMsg(1)
                            Call Set_MsgZOrder("NS0409", w_strMsg, w_MsgAns, 0)

                            If w_MsgAns = MsgBoxResult.Ok Then
                                'ﾁｪｯｸ通過
                                ChkAbsoluteKinmu = True
                                Exit Function
                            Else
                                'キャンセルの場合
                                ChkAbsoluteKinmu = False
                                Exit Function
                            End If
                        End If
                    Next w_i
                Next w_Int2
            Next

            ChkAbsoluteKinmu = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function
    '2015/05/22 Bando Add End   ===================================================================

    Public Sub m_lstmnuFont_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuFont_0.Click, _mnuFont_1.Click, _mnuFont_2.Click
        Dim Index As Integer = m_lstmnuFont.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuFont_Click"
        Try
            '[表示]－[ﾌｫﾝﾄ]のｻﾌﾞﾒﾆｭｰです

            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            Me.Refresh()

            Select Case Index

                Case M_MenuFontBig
                    'ﾌｫﾝﾄ 大
                    m_FontIndex = Index
                    Call RunFontSizeChange()
                    'ﾁｪｯｸﾏｰｸの制御
                    m_lstmnuFont(M_MenuFontBig).Checked = False
                    m_lstmnuFont(M_MenuFontMiddle).Checked = False
                    m_lstmnuFont(M_MenuFontSmall).Checked = False
                    m_lstmnuFont(Index).Checked = True

                Case M_MenuFontMiddle
                    'ﾌｫﾝﾄ 中
                    m_FontIndex = Index
                    Call RunFontSizeChange()
                    'ﾁｪｯｸﾏｰｸの制御
                    m_lstmnuFont(M_MenuFontBig).Checked = False
                    m_lstmnuFont(M_MenuFontMiddle).Checked = False
                    m_lstmnuFont(M_MenuFontSmall).Checked = False
                    m_lstmnuFont(Index).Checked = True

                Case M_MenuFontSmall
                    'ﾌｫﾝﾄ 小
                    m_FontIndex = Index
                    Call RunFontSizeChange()
                    'ﾁｪｯｸﾏｰｸの制御
                    m_lstmnuFont(M_MenuFontBig).Checked = False
                    m_lstmnuFont(M_MenuFontMiddle).Checked = False
                    m_lstmnuFont(M_MenuFontSmall).Checked = False
                    m_lstmnuFont(Index).Checked = True

            End Select

            Call Calc_ScrollSpread()

            picCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuJidou_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuJidou_0.Click
        Dim Index As Integer = m_lstmnuJidou.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuJidou_Click"
        Try
            '[自動割当]のｻﾌﾞﾒﾆｭｰです

            Select Case Index
                Case M_MenuJidouRun
                    '自動割当実行
                    Call RunAutoAssign()

            End Select

            '控除データ全削除
            Call KojyoDeleteAllData()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuKinmuView_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuKinmuView_0.Click, _mnuKinmuView_1.Click,
                                                                                                                        _mnuKinmuView_2.Click, _mnuKinmuView_3.Click
        Dim Index As Integer = m_lstmnuKinmuView.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuKinmuView_Click"

        Dim w_Loop As Integer
        Try
            'ボタン連打対策
            tbrMain.Enabled = False

            '処理のちらつきを隠す
            picCover.Top = picBase.Top
            picCover.Left = picBase.Left
            picCover.Width = picBase.Width
            picCover.Height = picBase.Height
            picCover.Visible = True

            Me.Refresh()

            For w_Loop = 0 To 3
                If m_lstmnuKinmuView(w_Loop).Available Then
                    If w_Loop = Index Then
                        m_lstmnuKinmuView(w_Loop).Checked = True
                    Else
                        m_lstmnuKinmuView(w_Loop).Checked = False
                    End If
                End If
            Next w_Loop

            Call RunOneTwoChange(True, Index)
            Call Calc_ScrollSpread()

            Call subSetCrossPointLength()

            picCover.Visible = False

            tbrMain.Enabled = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuPopup_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuPopup_0.Click, _mnuPopup_1.Click, _mnuPopup_2.Click,
                                                                                                                    _mnuPopup_3.Click, _mnuPopup_4.Click, _mnuPopup_5.Click,
                                                                                                                    _mnuPopup_6.Click, _mnuPopup_7.Click, _mnuPopup_8.Click,
                                                                                                                    _mnuPopup_9.Click, _mnuPopup_10.Click, _mnuPopup_11.Click,
                                                                                                                    _mnuPopup_12.Click, _mnuPopup_13.Click, _mnuPopup_14.Click
        Dim Index As Integer = m_lstmnuPopup.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuPopup_Click"
        Try
            Me.Refresh()

            Select Case Index
                Case M_PopUndo
                    '元に戻す
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuUndo), New System.EventArgs)

                    '2016/04/05 Ishiga add start------------------------------------------------
                Case M_PopRedo
                    'やり直し
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuRedo), New System.EventArgs)
                    '2016/04/05 Ishiga add end--------------------------------------------------

                Case M_PopCut
                    '切り取り
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuCut), New System.EventArgs)

                Case M_PopCopy
                    'コピー
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuCopy), New System.EventArgs)

                Case M_PopPaste
                    '貼り付け
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuPaste), New System.EventArgs)

                Case M_PopDelete
                    '消去
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuDelete), New System.EventArgs)

                Case M_PopKensaku
                    '検索
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuKensaku), New System.EventArgs)

                Case M_PopChikan
                    '置換
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuChikan), New System.EventArgs)

                Case M_PopAllClear
                    '全消去
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuAllClear), New System.EventArgs)

                Case M_PopAllClear_Normal
                    '全消去
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_MenuAllClear_Normal), New System.EventArgs)

                Case M_InputJikanNenkyu
                    '時間年休
                    Call m_lstmnuEdit_Click(m_lstmnuEdit(M_InputJikanNenkyu), New System.EventArgs)
                Case Else
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuSet_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuSet_0.Click, _mnuSet_1.Click, _mnuSet_2.Click
        Dim Index As Integer = m_lstmnuSet.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuSet_Click"

        Try
            '[設定]のｻﾌﾞﾒﾆｭｰです

            Select Case Index

                Case M_MenuStaff
                    '職員情報設定
                    Call Edit_StaffData()
                    Call Calc_ScrollSpread()

                Case M_MenuRule
                    'ルール設定
                    Call Edit_RuleData()

                Case M_MenuSetKinmu
                    'セット勤務
                    Call Edit_SetKinmuData()

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuTool_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuTool_0.Click, _mnuTool_1.Click, _mnuTool_2.Click, _mnuTool_3.Click,
                                                                                                                    _mnuTool_4.Click, _mnuTool_5.Click, _mnuTool_6.Click, _mnuTool_7.Click
        Dim Index As Integer = m_lstmnuTool.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuTool_Click"

        Dim w_ImagePath As String
        Dim w_SystemPath As String
        Try
            w_SystemPath = My.Application.Info.DirectoryPath
            w_ImagePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ImagePath", My.Application.Info.DirectoryPath & "image")

            '[ﾂｰﾙ]のｻﾌﾞﾒﾆｭｰです

            Select Case Index

                Case M_MenuJidouCheck
                    '自動ﾁｪｯｸ

                    m_lstmnuTool(Index).Checked = Not (m_lstmnuTool(Index).Checked)
                    If m_lstmnuTool(Index).Checked = True Then
                        m_lstmnuTool(M_MenuReCheck).Enabled = False
                        tbrMain.Items.Item(M_ToolBarKey_ErrorCheck).Visible = False
                        'ｴﾗｰﾁｪｯｸを行う
                        Call RunErrorCheck()
                    Else
                        m_lstmnuTool(M_MenuReCheck).Enabled = True
                        tbrMain.Items.Item(M_ToolBarKey_ErrorCheck).Visible = True
                    End If

                Case M_MenuReCheck
                    '再ﾁｪｯｸ実行

                    Call RunErrorCheck()

                Case M_MenuKibouChk
                    If m_lstmnuTool(Index).Checked = True Then
                        m_KibouInputChk = False
                        m_lstmnuTool(Index).Checked = False
                    Else
                        m_KibouInputChk = True
                        m_lstmnuTool(Index).Checked = True
                    End If

                Case M_MenuYouseiChk
                    If m_lstmnuTool(Index).Checked = True Then
                        m_YouseiInputChk = False
                        m_lstmnuTool(Index).Checked = False
                    Else
                        m_YouseiInputChk = True
                        m_lstmnuTool(Index).Checked = True
                    End If

                Case M_MenuErrorAbsoluteKinmu
                    If m_lstmnuTool(Index).Checked = True Then
                        m_KinmuChk = False
                        m_lstmnuTool(Index).Checked = False
                    Else
                        m_KinmuChk = True
                        m_lstmnuTool(Index).Checked = True
                    End If

                Case M_MenuCheck

                    'エラーリスト表示
                Case M_MenuErrorList
                    Call Set_ErrorList()

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Sub m_lstmnuView_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles _mnuView_0.Click, _mnuView_1.Click, _mnuView_2.Click,
                                                                                                                    _mnuView_3.Click, _mnuView_4.Click, _mnuView_5.Click,
                                                                                                                    _mnuView_6.Click, _mnuView_7.Click, _mnuView_8.Click,
                                                                                                                    _mnuView_9.Click, _mnuView_10.Click, _mnuView_11.Click,
                                                                                                                    _mnuView_12.Click, _mnuView_13.Click   '2014/06/20 Y.Doi ADD P-06980 
        Dim Index As Integer = m_lstmnuView.IndexOf(eventSender)

        Const W_SUBNAME As String = "NSK0000HA m_lstmnuView_Click"

        '[表示]のｻﾌﾞﾒﾆｭｰです
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Try
            Select Case Index

                Case M_MenuPalette
                    'ﾊﾟﾚｯﾄ

                    '勤務者　かつ　希望回数制限あり　かつ　希望回数0回の場合
                    If g_LimitedFlg = True AndAlso g_HopeNumFlg = "1" AndAlso g_HopeNum = 0 Then
                        '希望回数制限ダイアログ表示
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望回数の設定が0回のため、希望勤務の"
                        '「&1入力できません。」
                        Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    '勤務者　かつ　希望回数(日付別)制限あり　かつ　希望回数(日付別)0回の場合
                    If g_LimitedFlg = True AndAlso g_HopeNumDateFlg = "1" AndAlso g_HopeNumDate = 0 Then
                        '希望回数制限ダイアログ表示
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望回数(日付別)の設定が0回のため、希望勤務の"
                        '「&1入力できません。」
                        Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                    'ﾒﾆｭｰ項目の横にﾁｪｯｸﾏｰｸを表示(非表示)に切替
                    m_lstmnuView(Index).Checked = Not m_lstmnuView(Index).Checked
                    If m_lstmnuView(Index).Checked = False Then
                        'ﾊﾟﾚｯﾄｳｨﾝﾄﾞｳ非表示
                        '検索/置換画面使用可
                        m_lstmnuEdit(M_MenuKensaku).Enabled = True
                        m_lstmnuEdit(M_MenuChikan).Enabled = True
                        m_lstmnuPopup(M_PopKensaku).Enabled = True
                        m_lstmnuPopup(M_PopChikan).Enabled = True
                        tbrMain.Items.Item(M_ToolBarKey_Search).Visible = True
                        tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = True

                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False
                        End If

                        If g_LimitedFlg = True Then
                            m_lstmnuEdit(M_MenuChikan).Enabled = False
                            m_lstmnuPopup(M_PopChikan).Enabled = False
                            tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False
                        End If

                        m_PaletteForm.Hide()
                    Else
                        'ﾊﾟﾚｯﾄｳｨﾝﾄﾞｳ表示
                        '検索/置換画面使用不可
                        m_lstmnuEdit(M_MenuKensaku).Enabled = False
                        m_lstmnuEdit(M_MenuChikan).Enabled = False
                        m_lstmnuPopup(M_PopKensaku).Enabled = False
                        m_lstmnuPopup(M_PopChikan).Enabled = False
                        tbrMain.Items.Item(M_ToolBarKey_Search).Visible = False
                        tbrMain.Items.Item(M_ToolBarKey_Tikan).Visible = False

                        m_PaletteForm.Show()
                    End If

                Case M_MenuToolBar
                    'ﾂｰﾙﾊﾞｰ
                    m_lstmnuView(Index).Checked = Not m_lstmnuView(Index).Checked
                    tbrMain.Visible = Not tbrMain.Visible
                    Panel1.Visible = tbrMain.Visible

                    'ﾒｲﾝのPictureのｻｲｽﾞ設定
                    Call Resize_ContanarCtrl()

                Case M_MenuStatusBar
                    'ｽﾃｰﾀｽﾊﾞｰ

                    m_lstmnuView(Index).Checked = Not m_lstmnuView(Index).Checked
                    sbrMain.Visible = Not sbrMain.Visible
                    'ﾒｲﾝのPictureのｻｲｽﾞ設定
                    Call Resize_ContanarCtrl()

                Case M_MenuPersonalKinmu
                    '現在選択されている行を初期化
                    m_ActiveRow = 0
                    '個人別勤務登録
                    If RunPersonalKinmu() = False Then
                        Exit Sub
                    End If
                Case M_MenuShukei
                    '集計の固定

                Case M_MenuFont
                    'ﾌｫﾝﾄ（ｻﾌﾞﾒﾆｭｰ(m_lstmnuFont)あり）

                Case M_MenuEmpRowDisp
                    '採用条件列表示
                    m_lstmnuView(Index).Checked = Not m_lstmnuView(Index).Checked
                    Call Resize_ContanarCtrl()
                Case M_MenuTimeTable
                    'ﾀｲﾑﾃｰﾌﾞﾙ
                    RunTimeTable()
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '個別勤務計画実行
    Private Function RunPersonalKinmu() As Boolean

        Const W_SUBNAME As String = "NSK0000HA RunPersonalKinmu"

        Dim w_Form As New frmNSK0000HC
        Dim w_Spread As FpSpread
        Dim w_SprKeikaku As FpSpread = Nothing
        Dim w_DataStartCol As Integer
        Dim w_DataEndCol As Integer
        Dim w_CalcCol As Integer
        Dim w_StartCol As Integer
        Dim w_DataFlg As Object = Nothing
        Dim w_KakuteiFlg As Object = Nothing
        Dim w_DataHideFlg As Object = Nothing
        Dim w_KakuteiHideFlg As Object = Nothing
        Dim w_Index As Integer
        Dim w_Var As Object
        Dim w_StaffIdx As Integer
        Dim w_StaffID As String = String.Empty
        Dim w_Int As Integer
        Dim w_HolDate As Integer
        Dim w_HolKinmuCD As String = String.Empty
        Dim w_DaikyuDate As Integer
        Dim w_DaikyuKinmuCD As String = String.Empty
        Dim w_OutPutList As String = String.Empty
        Dim w_Cnt As Integer
        Dim w_FontSize As Integer
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Dim w_lngLoop As Integer
        Dim w_DataCnt As Integer
        Dim w_GetFlg As String = String.Empty
        Dim w_GetKbn As String = String.Empty
        Dim w_RemainderHol As Double
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_KinmuStTime As Integer
        Dim w_KinmuEdTime As Integer
        Dim w_KojyoStTime As Integer
        Dim w_KojyoEdTime As Integer
        Dim w_KojyoCnt As Integer
        Dim w_KojyoData_BK As KojyoData_Type
        Dim w_Col As Integer
        Dim w_KinmuCD As String
        Dim w_KinmuData As String

        Try
            If g_LimitedFlg = True Then
                If m_SelViewKikan = 0 Then
                    '職員ｲﾝﾃﾞｯｸｽ取得

                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_M.Sheets(0).ActiveRow.Index
                    End If

                    w_Var = sprSheet_M.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    w_StaffIdx = Integer.Parse(Convert.ToString(w_Var))
                    w_StaffID = m_StaffData(w_StaffIdx).ID
                Else
                    '職員ｲﾝﾃﾞｯｸｽ取得

                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_4W.Sheets(0).ActiveRow.Index
                    End If

                    w_Var = sprSheet_4W.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    w_StaffIdx = Integer.Parse(Convert.ToString(w_Var))
                    w_StaffID = m_StaffData(w_StaffIdx).ID
                End If

                If General.g_strUserMngID <> w_StaffID Then
                    Exit Function
                End If
            End If

            '勤務者　かつ　希望回数制限あり　かつ　希望回数0回の場合
            If g_LimitedFlg = True AndAlso g_HopeNumFlg = "1" AndAlso g_HopeNum = 0 Then
                '希望回数制限ダイアログ表示
                ReDim w_strMsg(1)
                w_strMsg(1) = "希望回数の設定が0回のため、希望勤務の"
                '「&1入力できません。」
                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If

            '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
            '勤務者　かつ　希望回数(日付別)制限あり　かつ　希望回数(日付別)0回の場合
            If g_LimitedFlg = True AndAlso g_HopeNumDateFlg = "1" AndAlso g_HopeNumDate = 0 Then
                '希望回数制限ダイアログ表示
                ReDim w_strMsg(1)
                w_strMsg(1) = "希望回数(日付別)の設定が0回のため、希望勤務の"
                '「&1入力できません。」
                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If
            '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

            'ﾊﾞｯｸｶﾗｰﾎﾟｲﾝﾀを元に戻す
            If m_SelViewKikan = 0 Then
                Call BackColorPoint_Undo_M()
            Else
                Call BackColorPoint_Undo_4W()
            End If

            '初期化
            RunPersonalKinmu = False

            '=========================================
            '         使用ｽﾌﾟﾚｯﾄﾞｼｰﾄ情報格納
            '=========================================
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                'ｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                w_SprKeikaku = sprSheet_M
                If m_SelViewKikan = 0 Then
                    '1ｹ月表示画面の場合
                    '計画ﾃﾞｰﾀ 開始/終了 列番号情報
                    m_KeikakuD_StartCol = M_KinmuData_Col '勤務記号ﾃﾞｰﾀ 開始ｾﾙ 位置
                    m_KeikakuD_EndCol = (M_KinmuData_Col + m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol)
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_DataStartCol = m_KeikakuKikan.KinmuDataStartCol
                    '勤務ﾃﾞｰﾀ終了列格納
                    w_DataEndCol = m_KeikakuKikan.KinmuDataEndCol
                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_M.Sheets(0).ActiveRow.Index
                    End If
                Else
                    '4週表示画面の場合
                    '計画ﾃﾞｰﾀ 開始/終了 列番号情報
                    m_KeikakuD_StartCol = M_KinmuData_Col '勤務記号ﾃﾞｰﾀ 開始ｾﾙ 位置
                    m_KeikakuD_EndCol = (M_KinmuData_Col + m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol - m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol)
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_DataStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    '勤務ﾃﾞｰﾀ終了列格納
                    w_DataEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_4W.Sheets(0).ActiveRow.Index
                    End If
                End If
                '職員ｲﾝﾃﾞｯｸｽ取得
                w_Var = w_SprKeikaku.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                w_StaffIdx = Integer.Parse(Convert.ToString(w_Var))
                w_StaffID = m_StaffData(w_StaffIdx).ID

            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                '現在表示中のｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                If m_SelViewKikan = 0 Then
                    '1ｹ月表示画面の場合
                    w_SprKeikaku = sprSheet_M
                    '計画ﾃﾞｰﾀ 開始/終了 列番号情報
                    m_KeikakuD_StartCol = M_KinmuData_Col '勤務記号ﾃﾞｰﾀ 開始ｾﾙ 位置
                    m_KeikakuD_EndCol = (M_KinmuData_Col + m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol)
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_DataStartCol = m_KeikakuKikan.KinmuDataStartCol
                    '勤務ﾃﾞｰﾀ終了列格納
                    w_DataEndCol = m_KeikakuKikan.KinmuDataEndCol
                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_M.Sheets(0).ActiveRow.Index
                    End If
                    '職員ｲﾝﾃﾞｯｸｽ取得
                    w_Var = w_SprKeikaku.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    w_StaffIdx = Integer.Parse(Convert.ToString(w_Var))
                    w_StaffID = m_StaffData(w_StaffIdx).ID
                Else
                    '４週表示
                    w_SprKeikaku = sprSheet_4W
                    '計画ﾃﾞｰﾀ 開始/終了 列番号情報
                    m_KeikakuD_StartCol = M_KinmuData_Col '勤務記号ﾃﾞｰﾀ 開始ｾﾙ 位置
                    m_KeikakuD_EndCol = (M_KinmuData_Col + m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol - m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol)
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_DataStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    '勤務ﾃﾞｰﾀ終了列格納
                    w_DataEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    '現在選択されている行を取得
                    If m_ActiveRow = 0 Then
                        m_ActiveRow = sprSheet_4W.Sheets(0).ActiveRow.Index
                    End If
                    '職員ｲﾝﾃﾞｯｸｽ取得
                    w_Var = w_SprKeikaku.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    w_StaffIdx = Integer.Parse(Convert.ToString(w_Var))
                    w_StaffID = m_StaffData(w_StaffIdx).ID
                End If
            End If

            If m_OuenStaffRow.StartRow <= m_ActiveRow Then
                ReDim w_strMsg(1)
                w_strMsg(1) = "応援勤務職員のため"
                Call Set_MsgZOrder("NS0095", w_strMsg, w_MsgRc, 0)
                Exit Function
            End If

            '個人別入力画面 表示
            With w_Form
                'ここに通常のﾌﾟﾛﾊﾟﾃｨ渡しを記述する(渡すﾌﾟﾛﾊﾟﾃｨは↓の状態よりしぼられる。)---
                '画面立ち上げﾓｰﾄﾞ("新規"，"計画変更"，"勤務変更")
                .pMode = m_PgmFlg
                '一段 or 二段表示中？
                .pPlanTwo = m_blnJissekiUseFlg
                '職員ﾃﾞｰﾀ開始行
                .pStaffStartRow = m_StaffRow.StartRow
                '最大表示段数
                .pMaxShowLine(m_DutyData, m_KinmuPlan, m_KinmuJisseki, m_AppliData) = m_MaxShowLine
                '画面立ち上げﾓｰﾄﾞ
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '４週／１ヶ月の場合
                    .pDispKikan = "1"
                Else
                    '４週／１ヶ月以外の場合
                    .pDispKikan = "2"
                End If

                'ﾌﾟﾛﾊﾟﾃｨﾊﾟﾗﾒｰﾀｾｯﾄ（ｽﾌﾟﾚｯﾄﾞｺﾝﾄﾛｰﾙｾｯﾄ）
                .pControl = w_SprKeikaku
                'ﾌﾟﾛﾊﾟﾃｨﾊﾟﾗﾒｰﾀｾｯﾄ（現在選択行）
                .pCUR_ROW = m_ActiveRow
                'ﾌﾟﾛﾊﾟﾃｨﾊﾟﾗﾒｰﾀｾｯﾄ（計画ﾃﾞｰﾀ 開始/終了 列番号情報）
                .pKeikakuD_StartCol = m_KeikakuD_StartCol
                .pKeikakuD_EndCol = m_KeikakuD_EndCol
                'ﾌﾟﾛﾊﾟﾃｨﾊﾟﾗﾒｰﾀｾｯﾄ（勤務ﾃﾞｰﾀ開始/終了 列番号情報）
                .pKeikakuD_KinmuDataStartCol = w_DataStartCol
                .pKeikakuD_KinmuDataEndCol = w_DataEndCol

                '職員管理番号
                .pStaffID = w_StaffID

                '計画開始日
                .pStartDate = m_KeikakuKikan.StartDate
                .pEndDate = m_KeikakuKikan.EndDate

                '採用情報
                .pToolTxt = fncGetTxtEmpData(m_ActiveRow)
                If m_lstmnuView(M_MenuEmpRowDisp).Checked Then
                    .pEmpRowVisible = True
                Else
                    .pEmpRowVisible = False
                End If
                '夜勤専従・短時間者情報
                .pInitNightShortInfo(UBound(m_StaffData(w_StaffIdx).NightWork), UBound(m_StaffData(w_StaffIdx).ShortWork)) = False
                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).NightWork)
                    .pNightWork(m_StaffData(w_StaffIdx).NightWork(w_Int).Date_from, m_StaffData(w_StaffIdx).NightWork(w_Int).Date_to) = False
                Next
                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).ShortWork)
                    .pShortWork(m_StaffData(w_StaffIdx).ShortWork(w_Int).Date_from, m_StaffData(w_StaffIdx).ShortWork(w_Int).Date_to) = False
                Next

                If General.g_lngDaikyuMng = 0 Then
                    '代休データ
                    For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                        w_HolDate = m_StaffData(w_StaffIdx).Daikyu(w_Int).HolDate
                        w_HolKinmuCD = m_StaffData(w_StaffIdx).Daikyu(w_Int).HolKinmuCD
                        w_OutPutList = m_StaffData(w_StaffIdx).Daikyu(w_Int).OutPutList
                        w_GetKbn = m_StaffData(w_StaffIdx).Daikyu(w_Int).GetKbn
                        w_RemainderHol = m_StaffData(w_StaffIdx).Daikyu(w_Int).RemainderHol

                        For w_lngLoop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                            w_DaikyuDate = m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuDate
                            w_DaikyuKinmuCD = m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuKinmuCD
                            w_GetFlg = m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).GetFlg
                            '代休データ引渡し
                            .pDaikyuData(w_HolDate, w_HolKinmuCD, w_GetKbn, w_RemainderHol, w_OutPutList, w_DaikyuDate, w_DaikyuKinmuCD) = w_GetFlg
                        Next w_lngLoop
                    Next w_Int
                End If

                '個別勤務計画作成画面のｽﾌﾟﾚｯﾄﾞに選択職員の情報をｾｯﾄ
                w_Spread = .sprSheet
            End With

            w_FontSize = w_SprKeikaku.Font.SizeInPoints
            w_Form.pFontSize = w_FontSize

            Call w_Form.frmNSK0000HC_Load()

            'ｽﾌﾟﾚｯﾄﾞｼｰﾄ 設定        '[画面立ち上げﾓｰﾄﾞによる場合分け]
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '画面立ち上げﾓｰﾄﾞ("勤務変更")
                If Set_PersonalForm_ChgJisseki(w_Spread, w_SprKeikaku, w_DataFlg, w_KakuteiFlg, w_DataHideFlg, w_KakuteiHideFlg) = False Then
                    Exit Function
                End If
            Else
                '画面立ち上げﾓｰﾄﾞ("新規"，"計画変更")
                If Set_PersonalForm(w_Spread, w_SprKeikaku, w_DataFlg, w_KakuteiFlg) = False Then
                    Exit Function
                End If
            End If

            'ﾃﾞｰﾀﾌﾗｸﾞ、確定ﾌﾗｸﾞ
            w_Form.pDataFlg = w_DataFlg
            w_Form.pKakuteiFlg = w_KakuteiFlg
            w_Form.pDataHideFlg = w_DataHideFlg
            w_Form.pKakuteiHideFlg = w_KakuteiHideFlg
            w_Form.pSpreadSize = m_PersonalSpreadSize

            '休日情報
            w_Form.pHolData(m_HolDateStr) = m_OffDayStr

            'ﾊﾟﾚｯﾄが表示状態の場合、一時的に非表示
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                m_PaletteForm.Hide()
            End If

            '検索画面が表示状態の場合、一時的に非表示
            If m_KensakuForm.pShowFlg = True Then
                m_KensakuForm.Hide()
            End If

            '置換画面が表示状態の場合、一時的に非表示
            If m_ChikanForm.pShowFlg = True Then
                m_ChikanForm.Hide()
            End If

            '行事一覧画面が表示状態の場合、一時的に非表示
            If m_EventForm.pShowFlg = True Then
                m_EventForm.Hide()
            End If

            w_Form.pProcessObj = Me
            'ｳｨﾝﾄﾞｳ表示
            w_Form.ShowWindow()

            '一時的に非表示にしたﾊﾟﾚｯﾄがあれば、表示状態に戻す
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                m_PaletteForm.Show()
            End If

            '一時的に非表示にした検索画面があれば、表示状態に戻す
            If m_KensakuForm.pShowFlg = True Then
                m_KensakuForm.Show()
            End If

            '一時的に非表示にした置換画面があれば、表示状態に戻す
            If m_ChikanForm.pShowFlg = True Then
                m_ChikanForm.Show()
            End If

            '行事一覧画面が表示状態の場合、一時的に非表示
            If m_EventForm.pShowFlg = True Then
                m_EventForm.Show()
            End If

            '終了ｽﾃｰﾀｽ取得
            If w_Form.pKosinFlg Then
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    '戻ってきた変更ﾃﾞｰﾀを個別勤務計画作成画面に渡していないｾﾙにも貼り付け
                    Call KinmuPaste_Spr()
                End If

                If General.g_lngDaikyuMng = 0 Then
                    '時間年休配列を入れなおす
                    w_Cnt = w_Form.pDaikyuCnt
                    ReDim m_StaffData(w_StaffIdx).Daikyu(w_Cnt)

                    For w_Int = 1 To w_Cnt

                        w_HolDate = w_Form.pDaikyuDataGet(w_HolKinmuCD, w_OutPutList, w_GetKbn, w_RemainderHol, w_DataCnt, w_Int)

                        m_StaffData(w_StaffIdx).Daikyu(w_Int).HolDate = w_HolDate
                        m_StaffData(w_StaffIdx).Daikyu(w_Int).HolKinmuCD = w_HolKinmuCD
                        m_StaffData(w_StaffIdx).Daikyu(w_Int).OutPutList = w_OutPutList
                        m_StaffData(w_StaffIdx).Daikyu(w_Int).GetKbn = w_GetKbn
                        m_StaffData(w_StaffIdx).Daikyu(w_Int).RemainderHol = w_RemainderHol
                        '配列確保
                        ReDim m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_DataCnt)
                        For w_lngLoop = 1 To w_DataCnt
                            w_DaikyuDate = w_Form.pDaikyuDetailDataGet(w_DaikyuKinmuCD, w_GetFlg, w_Int, w_lngLoop)

                            m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuDate = w_DaikyuDate
                            m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).DaikyuKinmuCD = w_DaikyuKinmuCD
                            m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_lngLoop).GetFlg = w_GetFlg
                        Next w_lngLoop
                    Next w_Int
                End If
            End If

            '行取得
            If m_blnJissekiUseFlg AndAlso (m_ActiveRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '計画変更モードで上段を選択している場合
                w_StartRow = m_ActiveRow
                w_EndRow = m_ActiveRow + 1
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '新規作成モードの場合
                w_StartRow = m_ActiveRow
                w_EndRow = m_ActiveRow
            Else
                '計画変更モードで下段を選択している場合
                w_StartRow = m_ActiveRow - 1
                w_EndRow = m_ActiveRow
            End If

            '控除を取得している場合削除する
            w_Var = General.paSplit(w_Form.pUpdKojyoDate, ",")
            For w_lngLoop = 0 To UBound(w_Var)
                For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                    If w_Var(w_lngLoop) = Convert.ToString(m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate) Then
                        w_KojyoData_BK = m_StaffData(w_StaffIdx).Kojyo(w_Int)
                        m_StaffData(w_StaffIdx).Kojyo(w_Int).init()

                        '列取得
                        Call Get_Col_M(w_Var(w_lngLoop), w_Col)
                        w_KinmuCD = ""
                        '勤務情報取得(実績)
                        w_KinmuData = sprSheet_M_Sheet1.GetText(w_EndRow, w_Col)
                        If String.IsNullOrEmpty(w_KinmuData) Then
                            '勤務情報取得(予定)
                            w_KinmuData = sprSheet_M_Sheet1.GetText(w_StartRow, w_Col)
                        End If
                        '2015/04/10 Bando Upd Start =========================================
                        'Call Get_KinmuMark(w_KinmuData, w_KinmuCD, "", "", "", "")
                        Call Get_KinmuMark(w_KinmuData, w_KinmuCD, "", "", "", "", "")
                        '2015/04/10 Bando Upd End   =========================================

                        '勤務開始,終了時間取得
                        Call GetKinmuFromToTime(w_StaffIdx, w_KinmuCD, w_Var(w_lngLoop), w_KinmuStTime, w_KinmuEdTime)

                        If w_KinmuStTime <> 0 OrElse w_KinmuEdTime <> 0 Then
                            '日跨りの勤務
                            If w_KinmuStTime > w_KinmuEdTime Then
                                '24時間加算
                                w_KinmuEdTime = w_KinmuEdTime + 2400
                            End If

                            w_KojyoCnt = 0

                            For i As Integer = 1 To UBound(w_KojyoData_BK.lngKinmuDetailDate)
                                '行事の控除データかどうか
                                If Not String.IsNullOrEmpty(w_KojyoData_BK.UniqueseqNo(i)) Then
                                    If w_KojyoData_BK.strNextFlg(i) = "0" Then
                                        '当日
                                        w_KojyoStTime = w_KojyoData_BK.lngTimeFrom(i)
                                        w_KojyoEdTime = w_KojyoData_BK.lngTimeTo(i)
                                    Else
                                        '翌日
                                        w_KojyoStTime = w_KojyoData_BK.lngTimeFrom(i) + 2400
                                        w_KojyoEdTime = w_KojyoData_BK.lngTimeTo(i) + 2400
                                    End If

                                    '日跨りの控除
                                    If w_KojyoStTime > w_KojyoEdTime Then
                                        '24時間加算
                                        w_KojyoEdTime = w_KojyoEdTime + 2400
                                    End If

                                    '勤務時間内の控除かどうか
                                    If w_KinmuStTime <= w_KojyoStTime AndAlso w_KojyoEdTime <= w_KinmuEdTime Then
                                        w_KojyoCnt = w_KojyoCnt + 1

                                        '配列拡張
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngKinmuDetailDate(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngNikkinTime(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).strShinryoKbn(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngTimeFrom(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngTimeTo(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngYakinTime(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).strKinmuDetailCD(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).strNextFlg(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).lngKinmuDetailTime(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).strHolSubFlg(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).UniqueseqNo(w_KojyoCnt)
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int).Seq(w_KojyoCnt)

                                        '再格納
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngKinmuDetailDate(w_KojyoCnt) = w_KojyoData_BK.lngKinmuDetailDate(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngNikkinTime(w_KojyoCnt) = w_KojyoData_BK.lngNikkinTime(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).strShinryoKbn(w_KojyoCnt) = w_KojyoData_BK.strShinryoKbn(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngTimeFrom(w_KojyoCnt) = w_KojyoData_BK.lngTimeFrom(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngTimeTo(w_KojyoCnt) = w_KojyoData_BK.lngTimeTo(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngYakinTime(w_KojyoCnt) = w_KojyoData_BK.lngYakinTime(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_KojyoCnt) = w_KojyoData_BK.lngYokuYakinTime(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).strKinmuDetailCD(w_KojyoCnt) = w_KojyoData_BK.strKinmuDetailCD(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).strNextFlg(w_KojyoCnt) = w_KojyoData_BK.strNextFlg(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).lngKinmuDetailTime(w_KojyoCnt) = w_KojyoData_BK.lngKinmuDetailTime(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).strHolSubFlg(w_KojyoCnt) = w_KojyoData_BK.strHolSubFlg(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).UniqueseqNo(w_KojyoCnt) = w_KojyoData_BK.UniqueseqNo(i)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Int).Seq(w_KojyoCnt) = w_KojyoData_BK.Seq(i)
                                    End If
                                End If
                            Next
                        End If

                        Exit For
                    End If
                Next w_Int
            Next w_lngLoop

            '================================
            '   集計を行う
            '================================
            For w_Index = w_StartRow To w_EndRow
                If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計

                    '個人別集計
                    Call RunReCalc_PUser(w_Index)
                    '4週用個人別集計
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ヶ月の場合
                        Call RunReCalc_User_4W(w_Index)
                        Call RunReCalc_PUser_Jisseki(w_Index)
                    End If
                End If
            Next w_Index

            Call Set_KangoKasanTotalData()

            '日別集計
            For w_CalcCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                Call RunReCalc_PDay(w_CalcCol)
            Next w_CalcCol

            '日別集計で最終の4週期間の計画期間以降の日別集計
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ヶ月の場合
                If m_SelViewKikan = UBound(m_4WeekKikan) Then
                    '最終の4週期間が表示されている場合
                    If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                        For w_CalcCol = w_StartCol To m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                            Call RunReCalc_PDay_4W(w_CalcCol)
                        Next w_CalcCol
                    End If
                End If
            End If

            'ｵﾌﾞｼﾞｪｸﾄ開放
            w_Form = Nothing
            '初期化
            RunPersonalKinmu = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '戻ってきた変更ﾃﾞｰﾀを個別勤務計画作成画面に渡していないｾﾙにも貼り付け
    Private Sub KinmuPaste_Spr()

        Const W_SUBNAME As String = "NSK0000HA KinmuPaste_Spr"

        Dim w_Spread(2) As FpSpread
        Dim w_Cnt As Integer
        Dim w_Kinmu As Object
        Dim w_Color As Integer
        Dim w_Col As Integer
        Dim w_DataStartCol As Integer
        Dim w_DataEndCol As Integer
        Dim w_StartDate As Integer
        Dim w_Date As Date
        Dim w_StartDateLng As Integer
        Dim w_ActiveRow As Integer
        Dim w_Bool As Boolean
        Dim w_Var As Object
        Dim w_Index As Integer
        Dim w_PlanKinmu As Object
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Try
            If m_blnJissekiUseFlg AndAlso (m_ActiveRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '二段表示の上段が選択されてる時
                '選択行を下段に統一する
                w_ActiveRow = m_ActiveRow + 1
            Else
                w_ActiveRow = m_ActiveRow
            End If

            If sprSheet_M.Visible = True Then
                '１ヶ月表示表示
                w_Spread(1) = sprSheet_M '現在表示中のｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                w_Spread(2) = sprSheet_4W '現在表示中でなはいｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                '勤務ﾃﾞｰﾀ開始列格納
                w_DataStartCol = m_KeikakuKikan.KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_DataEndCol = m_KeikakuKikan.KinmuDataEndCol
                '開始日
                w_StartDate = m_KeikakuKikan.StartDate

                w_Var = sprSheet_M.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                If w_Var <> "" Then
                    w_Index = Integer.Parse(w_Var)
                End If
            Else
                '４週表示
                w_Spread(1) = sprSheet_4W '現在表示中のｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                w_Spread(2) = sprSheet_M '現在表示中でなはいｽﾌﾟﾚｯﾄﾞｼｰﾄｵﾌﾞｼﾞｪｸﾄ名格納
                '勤務ﾃﾞｰﾀ開始列格納
                w_DataStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                '勤務ﾃﾞｰﾀ終了列格納
                w_DataEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                '開始日
                w_StartDate = m_4WeekKikan(m_SelViewKikan).StartDate

                w_Var = sprSheet_4W.Sheets(0).GetText(m_ActiveRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                If w_Var <> "" Then
                    w_Index = Integer.Parse(w_Var)
                End If
            End If

            '開始日(日付型)取得
            w_Date = Date.Parse(Format(w_StartDate, "0000/00/00"))

            With w_Spread(2).Sheets(0)
                For w_Cnt = 1 To (w_DataEndCol - w_DataStartCol + 1)
                    '勤務取得

                    w_Kinmu = w_Spread(1).Sheets(0).GetText(w_ActiveRow, w_DataStartCol + w_Cnt - 1)

                    '親画面勤務貼付け
                    w_StartDateLng = Integer.Parse(Format(DateAdd(DateInterval.Day, w_Cnt - 1, w_Date), "yyyyMMdd"))
                    If sprSheet_M.Visible = True Then
                        '１ヶ月表示表示(日付から4週期間の列番号 取得)
                        w_Bool = Get_Col_4W(DirectCast(w_StartDateLng, Object), w_Col)
                    Else
                        '４週表示(日付から実績/計画期間の列番号 取得)
                        w_Bool = Get_Col_M(DirectCast(w_StartDateLng, Object), w_Col)
                    End If

                    If w_Bool = True Then
                        '列番号が取得できた場合
                        If m_blnJissekiUseFlg OrElse m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then

                            .SetText(w_ActiveRow, w_Col, w_Kinmu)

                            '色取得

                            w_Color = ColorTranslator.ToOle(w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).ForeColor)

                            '色貼付け
                            .Cells(w_ActiveRow, w_Col).ForeColor = ColorTranslator.FromOle(w_Color)

                            '色取得
                            If w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).BackColor.A = 0 Then
                                w_Color = ColorTranslator.ToOle(Color.White)
                            Else
                                w_Color = ColorTranslator.ToOle(w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).BackColor)
                            End If

                            '色貼付け
                            .Cells(w_ActiveRow, w_Col).BackColor = ColorTranslator.FromOle(w_Color)
                        Else
                            '現在の予定行のデータを退避

                            w_PlanKinmu = .GetText(w_ActiveRow, w_Col)

                            w_ForeColor = ColorTranslator.ToOle(.Cells(w_ActiveRow, w_Col).ForeColor)
                            If .Cells(w_ActiveRow, w_Col).BackColor.A = 0 Then
                                w_BackColor = ColorTranslator.ToOle(Color.White)
                            Else
                                w_BackColor = ColorTranslator.ToOle(.Cells(w_ActiveRow, w_Col).BackColor)
                            End If

                            '勤務が変更されている場合
                            If w_PlanKinmu <> w_Kinmu Then

                                '予定の未入力のデータの場合は、データを複製する
                                If w_PlanKinmu = "" Then
                                    w_PlanKinmu = w_Kinmu
                                End If

                                '退避用の行へ格納
                                .SetText(w_ActiveRow + 1, w_Col, w_PlanKinmu)
                                .Cells(w_ActiveRow + 1, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                .Cells(w_ActiveRow + 1, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)

                                '入力した実績データの色設定を退避
                                w_ForeColor = ColorTranslator.ToOle(w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).ForeColor)
                                If w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).BackColor.A = 0 Then
                                    w_BackColor = ColorTranslator.ToOle(Color.White)
                                Else
                                    w_BackColor = ColorTranslator.ToOle(w_Spread(1).Sheets(0).Cells(w_ActiveRow, w_DataStartCol + w_Cnt - 1).BackColor)
                                End If

                                '入力した実績データを予定行に格納する
                                .SetText(w_ActiveRow, w_Col, w_Kinmu)
                                .Cells(w_ActiveRow, w_Col).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                .Cells(w_ActiveRow, w_Col).BackColor = ColorTranslator.FromOle(w_BackColor)
                            End If
                        End If
                    End If
                Next w_Cnt
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub picBase_MouseMove(ByVal eventSender As System.Object, ByVal eventArgs As MouseEventArgs) Handles picBase.MouseMove
        Dim Button As Integer = eventArgs.Button \ &H100000
        Dim Shift As Integer = Control.ModifierKeys \ &H10000
        Dim X As Single = General.paTwipsTopixels(eventArgs.X)
        Dim Y As Single = General.paTwipsTopixels(eventArgs.Y)

        Const W_SUBNAME As String = "NSK0000HA picBase_MouseMove"
        Try
            'すでに設定されている記号を削除する
            If m_MousePointerCol_4W <> 0 Then
                '４週用ｽﾌﾟﾚｯﾄﾞに設定されている場合
                sprSheet_4W.Sheets(0).SetText(M_MonthLabel_Row, m_MousePointerCol_4W, DirectCast(m_MouseSelectColText, Object))
                m_MousePointerCol_4W = 0
            End If
            If m_MousePointerCol_M <> 0 Then
                '１ヶ月用ｽﾌﾟﾚｯﾄﾞに設定されている場合
                sprSheet_M.Sheets(0).SetText(M_MonthLabel_Row, m_MousePointerCol_M, DirectCast(m_MouseSelectColText, Object))
                m_MousePointerCol_M = 0
            End If
            If m_MousePointerCol_PTotal <> 0 Then
                '個人別集計ｽﾌﾟﾚｯﾄﾞに設定されている場合
                sprPTotal.Sheets(0).SetText(M_MonthLabel_Row, m_MousePointerCol_PTotal, DirectCast(m_MouseSelectColText, Object))
                m_MousePointerCol_PTotal = 0
            End If

            'すでに設定されている記号の削除
            If m_MousePointerRow_DataArea <> 0 Then
                'ﾃﾞｰﾀ表示ｽﾌﾟﾚｯﾄﾞのﾏｳｽﾎﾟｲﾝﾀｰ記号を削除する
                sprSheet_M.Sheets(0).SetText(m_MousePointerRow_DataArea, M_HyojiNo_Col, DirectCast(m_MouseSelectRowText_M, Object))
                sprSheet_4W.Sheets(0).SetText(m_MousePointerRow_DataArea, M_HyojiNo_Col, DirectCast(m_MouseSelectRowText_4W, Object))
                m_MousePointerRow_DataArea = 0
            End If

            If m_MousePointerRow_DayTotal <> 0 Then
                sprDayTotal_M.Sheets(0).SetText(m_MousePointerRow_DayTotal, M_HyojiNo_Col, DirectCast(m_MouseSelectRowText_M, Object))
                sprDayTotal_4W.Sheets(0).SetText(m_MousePointerRow_DayTotal, M_HyojiNo_Col, DirectCast(m_MouseSelectRowText_4W, Object))
                m_MousePointerRow_DayTotal = 0
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprDayTotal_4W_LeftChange(ByVal eventSender As System.Object, ByVal eventArgs As LeftChangeEventArgs) Handles sprDayTotal_4W.LeftChange

        Const W_SUBNAME As String = "NSK0000HA sprDayTotal_4W_LeftChange"

        Static w_Left As Integer
        Try
            'LeftColの制御
            If w_Left <> eventArgs.NewLeft Then
                sprSheet_4W.SetViewportLeftColumn(0, eventArgs.NewLeft)
                w_Left = eventArgs.NewLeft
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprDayTotal_M_LeftChange(ByVal eventSender As System.Object, ByVal eventArgs As LeftChangeEventArgs) Handles sprDayTotal_M.LeftChange

        Const W_SUBNAME As String = "NSK0000HA sprDayTotal_M_LeftChange"

        Static w_Left As Integer
        Try
            'LeftColの制御
            If w_Left <> eventArgs.NewLeft Then
                sprSheet_M.SetViewportLeftColumn(0, eventArgs.NewLeft)
                w_Left = eventArgs.NewLeft
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprPTotal_TopChange(ByVal eventSender As System.Object, ByVal eventArgs As TopChangeEventArgs) Handles sprPTotal.TopChange

        Const W_SUBNAME As String = "NSK0000HA sprPTotal_TopChange"

        Static w_Top As Integer
        Try
            'TopRowの制御
            If w_Top <> eventArgs.NewTop Then
                sprSheet_M.SetViewportTopRow(0, eventArgs.NewTop)
                sprSheet_4W.SetViewportTopRow(0, eventArgs.NewTop)
                w_Top = eventArgs.NewTop
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_ClickEvent(ByVal eventSender As System.Object, ByVal eventArgs As CellClickEventArgs) Handles sprSheet_4W.CellClick

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_Click"

        Dim w_GetData As Boolean
        Dim w_str As String
        Dim w_KikanStartCol As Integer
        Dim w_Var As Object
        Dim w_MsgRc As Integer
        Dim w_StaffIdx As Integer
        Dim w_strMsg() As String
        Dim w_SetNewActiveFlg As Boolean
        Dim w_CellBlockLoop As Integer
        Dim w_DayVar As Object
        Dim w_JissekiEndCol As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_CellRange() As Model.CellRange
        Dim wkCellType As CellType.ButtonCellType
        Dim w_empRowFlg As Boolean = False
        Dim w_ToolTipText As String = ""
        Try
            '採用列の場合
            '2014/07/09 Y.Doi P-07150 UPD START----------------------
            'If eventArgs.Column = M_EmpShrtNghtData_Col AndAlso eventArgs.Row >= M_EVENTLABEL_ROW Then
            If eventArgs.Column = M_EmpShrtNghtData_Col AndAlso eventArgs.Row > M_EVENTLABEL_ROW Then
                '2014/07/09 Y.Doi P-07150 UPD END------------------------
                wkCellType = sprSheet_4W.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).CellType
                'ボタンを押下時のみ処理を行う
                If wkCellType Is Nothing Then
                    Exit Sub
                Else
                    w_empRowFlg = True
                End If
            End If

            If eventArgs.Button = Windows.Forms.MouseButtons.Left Then
                w_GetData = False
                If m_StaffRow.StartRow <= eventArgs.Row AndAlso eventArgs.Row <= m_StaffRow.EndRow Then
                    '職員行を選択
                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_blnJissekiUseFlg Then
                        '勤務変更 かつ 予定と実績を分けて表示 の時
                        If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                            '勤務実績の段をクリックした時
                            w_GetData = True
                        ElseIf w_empRowFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                            '採用条件表示フラグON and 予定行をクリック
                            If eventArgs.Column = M_EmpShrtNghtData_Col Then
                                w_ToolTipText = fncGetTxtEmpData(eventArgs.Row)
                                ToolTip1.Show(w_ToolTipText, sprSheet_4W)
                            End If
                            Exit Sub
                        End If
                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN AndAlso m_blnJissekiUseFlg Then
                        '勤務変更 かつ 予定と実績を分けて表示 の時
                        If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                            '勤務実績の段をクリックした時
                            '日付を取得
                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)

                            If w_Var <> "" AndAlso w_Var <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                w_GetData = True
                            End If
                        ElseIf w_empRowFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                            '採用条件表示フラグON and 予定行をクリック
                            If eventArgs.Column = M_EmpShrtNghtData_Col Then
                                w_ToolTipText = fncGetTxtEmpData(eventArgs.Row)
                                ToolTip1.Show(w_ToolTipText, sprSheet_4W)
                            End If
                            Exit Sub
                        End If
                    Else
                        If w_empRowFlg Then
                            '採用欄をクリック
                            If eventArgs.Column = M_EmpShrtNghtData_Col Then
                                w_ToolTipText = fncGetTxtEmpData(eventArgs.Row)
                                ToolTip1.Show(w_ToolTipText, sprSheet_4W)
                            End If
                            Exit Sub
                        Else
                            'その他
                            If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                '勤務予定の段をクリックした時
                                w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)

                                If w_Var <> "" AndAlso w_Var <= m_4WeekKikan(m_SelViewKikan).EndDate Then
                                    w_GetData = True
                                End If
                            End If
                        End If
                    End If
                Else
                    '職員行以外
                    If M_EVENTLABEL_ROW = eventArgs.Row AndAlso
                      m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= eventArgs.Column AndAlso
                      m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol >= eventArgs.Column AndAlso
                      UBound(m_EventData) > 0 Then
                        If Not m_EventForm.pShowFlg Then
                            '選択ｾﾙの日付取得
                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then Exit Sub

                            '検索画面を非表示
                            If m_KensakuForm.pShowFlg Then
                                m_KensakuForm.Hide()
                                m_KensakuForm.pShowFlg = False
                                'ﾊﾟﾚｯﾄ使用可
                                m_lstmnuView(M_MenuPalette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True
                            End If

                            '置換画面を非表示
                            If m_ChikanForm.pShowFlg Then
                                m_ChikanForm.Hide()
                                m_ChikanForm.pShowFlg = False
                                'ﾊﾟﾚｯﾄ使用可
                                m_lstmnuView(M_MenuPalette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True
                            End If

                            m_EventForm.pEventData = m_EventData
                            m_EventForm.pSelDate = Integer.Parse(w_Var)

                            m_EventForm.Show()
                            m_EventForm.pShowFlg = True
                        End If
                        Exit Sub
                    Else
                        w_GetData = True
                    End If
                End If

                If w_GetData Then
                    'ﾊﾟﾚｯﾄ画面表示ﾌﾗｸﾞ ?
                    If m_lstmnuView(M_MenuPalette).Checked = True Then
                        If m_PaletteForm.pBtnClickFlg = True Then

                            If g_LimitedFlg = True Then
                                w_Var = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If IsNumeric(w_Var) = True Then
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    If m_StaffData(w_StaffIdx).ID <> General.g_strUserMngID Then
                                        Exit Sub
                                    End If
                                Else
                                    Exit Sub
                                End If
                            End If

                            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
                            Me.Cursor = Cursors.WaitCursor

                            'KinmuCD/理由区分取得
                            m_SelNowKinmuCD = m_PaletteForm.pSelNowKinmuCD
                            m_SelNowRiyuKbn = m_PaletteForm.pSelNowRiyuKbn

                            '勤務が選択されていないときは消去
                            If Trim(m_SelNowKinmuCD) = "" Then
                                '消去
                                Call RunKinmuPaste_4W(eventArgs.Column, eventArgs.Row, True)
                            Else
                                '勤務記号 貼り付け実行
                                If Integer.Parse(m_SelNowKinmuCD) >= 1000 Then
                                    'セット勤務
                                    Call RunKinmuPaste_Set_4W(eventArgs.Column, eventArgs.Row)
                                Else
                                    Call RunKinmuPaste_4W(eventArgs.Column, eventArgs.Row, False)
                                End If
                            End If

                            'ﾂｰﾙﾁｯﾌﾟ設定
                            Call Set_ToolTipText(eventArgs.Column, eventArgs.Row, sprSheet_4W, True)

                            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
                            sbrMain.Refresh()

                            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
                            Me.Cursor = Cursors.Default
                        End If
                    End If
                End If

                If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                    '勤務ﾃﾞｰﾀ開始列格納
                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    End If
                Else
                    '勤務ﾃﾞｰﾀ開始列格納
                    w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                End If

                Select Case eventArgs.Row
                    Case m_StaffRow.StartRow To m_StaffRow.EndRow
                        '移動後の行番号 ?
                        If eventArgs.Column = M_StaffName_Col Then
                            '職員氏名の表示列を選択された場合
                            '現在選択されている行を取得
                            m_ActiveRow = eventArgs.Row
                            '応援勤務者の場合
                            If m_OuenStaffRow.StartRow <= m_ActiveRow Then
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "応援勤務職員のため"
                                Call Set_MsgZOrder("NS0095", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If

                            '個人別勤務登録
                            If RunPersonalKinmu() = False Then
                                Exit Sub
                            End If
                        End If
                    Case Else
                End Select
            ElseIf eventArgs.Button = Windows.Forms.MouseButtons.Right Then

                If (m_StaffRow.StartRow <= eventArgs.Row AndAlso eventArgs.Row <= m_StaffRow.EndRow) AndAlso (m_4WeekKikan(1).KinmuDataStartCol <= eventArgs.Column AndAlso eventArgs.Column <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol) Then

                    'ActiveCellの選択ﾌﾗｸﾞを初期化
                    w_SetNewActiveFlg = True

                    w_CellRange = sprSheet_4W.Sheets(0).GetSelections

                    If w_CellRange.Length = 0 OrElse (w_CellRange.Length = 1 AndAlso w_CellRange(0).ColumnCount = 1 AndAlso w_CellRange(0).RowCount = 1) Then
                    Else
                        w_blnFLG = True

                        For w_CellBlockLoop = 0 To w_CellRange.Length - 1
                            If w_CellRange(w_CellBlockLoop).Column <= eventArgs.Column AndAlso eventArgs.Column <= w_CellRange(w_CellBlockLoop).Column + w_CellRange(w_CellBlockLoop).ColumnCount - 1 AndAlso
                                    w_CellRange(w_CellBlockLoop).Row <= eventArgs.Row AndAlso eventArgs.Row <= w_CellRange(w_CellBlockLoop).Row + w_CellRange(w_CellBlockLoop).RowCount - 1 Then
                                w_SetNewActiveFlg = False
                                Exit For
                            End If
                        Next w_CellBlockLoop
                    End If

                    If w_SetNewActiveFlg = True Then
                        'ActiveCellの移動
                        sprSheet_4W.Sheets(0).SetActiveCell(eventArgs.Row, eventArgs.Column)

                        Call Set_CopyMenu(eventArgs.Column, eventArgs.Row, False)
                    End If

                    '実績最終日の列数を取得する
                    w_DayVar = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, m_KeikakuKikan.KinmuDataStartCol)
                    If w_DayVar <> "" Then
                        If IsDate(Format(Integer.Parse(w_DayVar), "0000/00/00")) = True Then
                            If Get_Col_4W(w_DayVar, w_JissekiEndCol) = False Then
                                w_JissekiEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                            End If
                        Else
                            w_JissekiEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                    Else
                        w_JissekiEndCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    '計画立案期間内のセルの場合はPopUpﾒﾆｭｰを表示する
                    '2014/05/28 Shibata del start P-06983 ---------------------------------------
                    'If (m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol <= eventArgs.Column AndAlso eventArgs.Column <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays) AndAlso w_JissekiEndCol <= eventArgs.Column Then
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------

                    '複数ｾﾙ選択時や勤務がない場合、計画期間外の場合
                    '時間年休入力非対象の勤務の場合はFalseにする
                    m_lstmnuPopup(M_InputJikanNenkyu).Enabled = True
                    '#001-----St
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出使用時は
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    End If
                    '#001-----Ed
                    If w_blnFLG Then
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    Else

                        '部署異動、配属期間内か ?
                        If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).BackColor) = m_MonthBefore_Back) Then
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If
                        If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).ForeColor) = m_Tabusho_Fore) Then
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If

                        '背景色が黒の時も時間年休入力不可
                        If (sprSheet_4W.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).BackColor.Equals(Color.Black)) Then
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If

                        If m_blnJissekiUseFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '二段表示の上段をクリックした時
                            w_Var = sprSheet_4W.Sheets(0).GetText(eventArgs.Row + 1, eventArgs.Column)
                            If w_Var <> "" Then
                                'まず下段を確認する
                                w_blnFLG = True
                            Else
                                '下段にデータが存在しない時は上段を確認する
                                w_Var = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, eventArgs.Column)
                                If w_Var <> "" Then
                                    w_blnFLG = True
                                Else
                                    w_blnFLG = False
                                End If
                            End If
                        Else
                            w_Var = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, eventArgs.Column)
                            If w_Var <> "" Then
                                w_blnFLG = True
                            Else
                                w_blnFLG = False
                            End If
                        End If

                        If w_blnFLG = True Then
                            '2015/04/10 Bando Upd Start =========================================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                            Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                            '2015/04/10 Bando Upd End   =========================================

                            If IsNumeric(w_KinmuCD) = False Then
                                m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                            End If
                        Else
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If
                    End If

                    If g_SaikeiFlg = True Then
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    End If

                    ContextMenuStrip1.Show(sprSheet_M, eventArgs.X, eventArgs.Y)

                    '2014/05/28 Shibata del start P-06983 ---------------------------------------
                    'End If
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------
                End If
            End If


        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_DblClick(ByVal eventSender As System.Object, ByVal eventArgs As CellClickEventArgs) Handles sprSheet_4W.CellDoubleClick

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_DblClick"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_VarPlan As Object = Nothing
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_RiyuKBN2 As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_DutyKinmuCD() As Object '日当直勤務CD
        Dim w_GroupCD() As Object '日当直グループCD
        Dim w_DutyIndex As Integer
        Dim w_Date As String = String.Empty
        Dim w_Loop As Integer
        '2018/03/12 Yamanishi Upd -------------------------------------------
        'Dim w_RecCnt As Integer
        'Dim w_Pos As Integer
        'Dim w_BunruiCD As String 'HolidayBunruiCD
        'Dim w_StartTime As String 'FromTime
        'Dim w_EndTime As String 'ToTime
        'Dim w_KBN As String 'DateKbn
        'Dim w_NenkyuTime As String '時間年休
        'Dim w_HolSubFlg As String '休憩減算フラグ
        'Dim w_DayTime As String '日勤時間
        'Dim w_NightTime As String '夜勤時間
        'Dim w_NextNightTime As String '翌日夜勤時間
        'Dim w_clsObj As Object
        Dim w_strTime As String = String.Empty
        Dim w_BunruiCD As String = String.Empty     'HolidayBunruiCD
        Dim w_StartTime As Integer                  'FromTime
        Dim w_EndTime As Integer                    'ToTime
        Dim w_KBN As String = String.Empty          'DateKbn
        Dim w_NenkyuTime As Integer                 '時間年休
        Dim w_HolSubFlg As String = String.Empty    '休憩減算フラグ
        Dim w_DayTime As Integer                    '日勤時間
        Dim w_NightTime As Integer                  '夜勤時間
        Dim w_NextNightTime As Integer              '翌日夜勤時間
        Dim w_clsObj As NsAid_NSA0050H.clsNSA0050H
        '--------------------------------------------------------------------
        Dim w_Col As Integer
        Dim w_StartCol As Integer
        Dim w_Row As Integer
        Dim w_RowPlan As Integer
        Dim w_blnFLG As Boolean
        Dim w_Int As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_StaffID As String = String.Empty
        Dim w_StaffIdx As Integer
        Dim w_lngKojyoLoop As Integer
        Dim w_strWorkIdx As String '退避
        Dim w_lngWorkLoop As Integer '退避
        Dim w_lngNo As Integer
        Dim w_lngDataCnt As Integer
        Dim w_BackColor As Color
        Dim kojoEvent() As EventList_Type
        '#001-----St
        Dim w_nenkyDispFlg As Boolean
        Dim w_regAppliKbn As String
        Dim w_appliKbn As String = String.Empty
        '#001-----Ed

        w_strWorkIdx = ""
        w_lngWorkLoop = 0
        Try
            With sprSheet_4W.Sheets(0)

                '編集可能ｾﾙ範囲 ﾁｪｯｸ
                'ﾃﾞｰﾀ行 範囲内か ?
                If Not ((m_StaffRow.StartRow <= eventArgs.Row) AndAlso (eventArgs.Row <= m_StaffRow.EndRow)) Then
                    'ERROR
                    Exit Sub
                End If

                'PlanPeriodFrom/終了日の4週での列番号取得
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    Exit Sub
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((w_StartCol <= eventArgs.Column) AndAlso (eventArgs.Column <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol - m_LastMonthDays)) Then
                    'ERROR
                    Exit Sub
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If ((w_StartCol <= eventArgs.Column) AndAlso (eventArgs.Column <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol)) Then
                    For w_Int = 1 To UBound(m_4WeekKikan)
                        If m_4WeekKikan(w_Int).PersonalStartCol <= eventArgs.Column AndAlso eventArgs.Column <= m_4WeekKikan(w_Int).PersonalEndCol Then
                            'ERROR
                            Exit Sub
                        End If
                    Next w_Int
                End If

                '勤務行以外?
                If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan OrElse (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                Else
                    'ERROR
                    Exit Sub
                End If

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(.Cells(eventArgs.Row, eventArgs.Column).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit Sub
                End If

                If g_SaikeiFlg = True Then
                    Exit Sub
                End If

                If m_blnJissekiUseFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                    '二段表示の上段をクリックした時
                    w_Var = .GetText(eventArgs.Row + 1, eventArgs.Column)
                    If w_Var <> "" Then
                        'まず下段を確認する
                        w_Row = eventArgs.Row + 1
                        w_blnFLG = True
                    Else
                        '下段にデータが存在しない時は上段を確認する
                        w_Row = eventArgs.Row
                        w_Var = .GetText(eventArgs.Row, eventArgs.Column)
                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    End If
                Else
                    w_Row = eventArgs.Row
                    w_Var = .GetText(eventArgs.Row, eventArgs.Column)
                    If w_Var <> "" Then
                        w_blnFLG = True
                    Else
                        w_blnFLG = False
                    End If
                End If

                If w_blnFLG = True Then
                    '勤務記号取得

                    'ﾃﾞｰﾀごとに分割
                    '2015/04/10 Bando Upd Start =========================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                    '2015/04/10 Bando Upd End   =========================================

                    If IsNumeric(w_KinmuCD) = False Then
                        Exit Sub
                    End If

                    '--------------------------------------------------
                    '   時間年休入力画面  表示
                    '--------------------------------------------------
                    w_clsObj = New NsAid_NSA0050H.clsNSA0050H

                    'ﾌﾟﾛﾊﾟﾃｨ設定
                    'Inatalltype渡し
                    w_clsObj.pInstallType = General.g_InstallType
                    '部品ｵﾌﾞｼﾞｪｸﾄ渡し
                    w_clsObj.pGetDataObj = General.g_objGetData
                    w_clsObj.pSelectDateObj = General.g_objSelectDate
                    w_clsObj.pGetMasterObj = General.g_objGetMaster
                    w_clsObj.pSecurityObj = General.g_objSecurity
                    '利用者情報
                    w_clsObj.pUserID = General.g_strUserID
                    w_clsObj.pUserName = General.g_strUserName

                    w_clsObj.pDispKbn = "0" '呼出元画面区分(0:計画画面)
                    w_clsObj.pAppliUseFlg = "1" '届出コンポーネント使用FLG(1:未使用)
                    w_clsObj.pGetKbnFlg = "2" '取得内容FLG(2:時間指定のみ)
                    '#001-----St
                    w_nenkyDispFlg = True
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出を仕様するときは時間休を入力させない
                        w_nenkyDispFlg = False
                    End If
                    w_clsObj.pNenkyDispFlg = w_nenkyDispFlg
                    '#001-----Ed
                    If w_KangoCD = "" Then
                        w_clsObj.pOuenFlg = 0
                    Else
                        w_clsObj.pOuenFlg = 1
                    End If

                    '応援先勤務部署CD
                    w_clsObj.pOuenKangoCD = w_KangoCD

                    w_Var = .GetText(eventArgs.Row, M_StaffName_Col)
                    If w_Var <> "" Then
                        w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                    ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '職員名称が取得できず、勤務変更で二段表示をしている場合
                        '一行上(二段表示の上段)の職員名称を取得する
                        w_Var = .GetText(eventArgs.Row - 1, M_StaffName_Col)
                        If w_Var <> "" Then
                            w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                        Else
                            w_clsObj.pAppliStaffName = ""
                        End If
                    Else
                        w_clsObj.pAppliStaffName = ""
                    End If

                    '対象年月日
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                    If w_Var <> "" Then
                        w_Date = Convert.ToString(w_Var)
                        w_clsObj.pTargetDate = w_Date
                    End If

                    'KinmuCD
                    w_clsObj.pKinmuCD = w_KinmuCD

                    '看護単位CD
                    w_clsObj.pSelKinmuDeptCD = General.g_strSelKinmuDeptCD

                    '職員管理番号
                    w_Var = .GetText(eventArgs.Row, m_StaffZokusei(M_StaffID).SetCol_4W)
                    If w_Var <> "" Then
                        w_StaffID = Convert.ToString(w_Var)
                        w_clsObj.pAppliStaffMngID = w_StaffID
                    End If

                    '職員番号
                    w_Var = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_StaffIdx = Integer.Parse(w_Var)
                            w_clsObj.pAppliStaffID = m_StaffData(w_StaffIdx).PreID
                        End If
                    End If

                    w_strWorkIdx = Convert.ToString(w_StaffIdx)
                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_Var).Kojyo)
                        If Double.Parse(w_Date) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate Then
                            w_lngWorkLoop = w_lngKojyoLoop '退避(控除データ位置)
                            Exit For
                        End If
                    Next w_lngKojyoLoop

                    If w_lngWorkLoop <> 0 Then
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate)
                            If InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop))) <= 0 Then
                                '次画面へ
                                w_clsObj.pKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                                   m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                            Else
                                '2018/02/23 Yamanishi Upd --------------------------------------------------------------------------------------------------------------
                                'w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate, _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)

                                w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                                '---------------------------------------------------------------------------------------------------------------------------------------
                            End If
                        Next w_lngKojyoLoop
                    End If

                    '行事データ受渡
                    ReDim kojoEvent(0)
                    chkEventTargetStaff(w_StaffID, w_Date, kojoEvent)
                    For i As Integer = 1 To UBound(kojoEvent)
                        w_clsObj.pEventData(kojoEvent(i).uniqNo, kojoEvent(i).EventName, kojoEvent(i).Time_st, kojoEvent(i).Time_ed) = kojoEvent(i).allFlg
                    Next

                    '採用CD
                    w_clsObj.pAppliStaffSaiyoCD = Get_SaiyoCD(Integer.Parse(w_Date), w_StaffID)

                    'HospitalCD
                    w_clsObj.pHospitalCD = General.g_strHospitalCD

                    If m_PackageFLG = 0 OrElse m_PackageFLG = 2 Then
                        '日当直を使用していない場合
                        w_clsObj.pDutyUseFlg = "1"
                        w_clsObj.pDutyKinmuCD = ""
                        w_clsObj.pDutyKinmuCD2 = ""
                        w_clsObj.pAppliStaffDutyGroupCD = ""
                        w_clsObj.pAppliStaffDutyGroupCD2 = ""
                    Else
                        '日当直を使用する場合
                        w_clsObj.pDutyUseFlg = "0"

                        w_Var = .GetText(eventArgs.Row - ((eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_DutyData, eventArgs.Column)
                        If w_Var <> "" Then
                            '日当直取得
                            ReDim w_DutyKinmuCD(0)
                            ReDim w_GroupCD(0)

                            'ﾃﾞｰﾀごとに分割
                            Call Get_DutyMark(w_Var, w_DutyKinmuCD, w_GroupCD)

                            w_DutyIndex = 0
                            For w_Loop = 1 To UBound(w_DutyKinmuCD)
                                If IsNumeric(w_DutyKinmuCD(w_Loop)) = True Then
                                    If w_DutyIndex = 0 Then
                                        w_clsObj.pDutyKinmuCD = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD = w_GroupCD(w_Loop)
                                        w_DutyIndex = 1
                                    ElseIf w_DutyIndex = 1 Then
                                        w_clsObj.pDutyKinmuCD2 = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD2 = w_GroupCD(w_Loop)
                                        w_DutyIndex = 2
                                    End If
                                End If
                            Next w_Loop

                            If w_DutyIndex = 0 Then
                                w_clsObj.pDutyKinmuCD = ""
                                w_clsObj.pAppliStaffDutyGroupCD = ""
                            End If

                            If w_DutyIndex <= 1 Then
                                w_clsObj.pDutyKinmuCD2 = ""
                                w_clsObj.pAppliStaffDutyGroupCD2 = ""
                            End If
                        Else
                            w_clsObj.pDutyKinmuCD = ""
                            w_clsObj.pDutyKinmuCD2 = ""
                            w_clsObj.pAppliStaffDutyGroupCD = ""
                            w_clsObj.pAppliStaffDutyGroupCD2 = ""
                        End If
                    End If

                    '#001-----St
                    w_regAppliKbn = "0"
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出使用時、届出が登録されているか確認する
                        w_Var = .GetText(eventArgs.Row - ((eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, eventArgs.Column)
                        Get_AppliMark(w_Var, "", "", "", w_appliKbn, 0, 0, "")
                        'ブランクなら届出登録なし
                        If Not w_Var.Equals("") Then
                            w_regAppliKbn = "1"
                            If w_appliKbn.Equals("1") Then
                                w_regAppliKbn = "2"
                            End If
                        End If
                    End If
                    w_clsObj.pRegistAppliKbn = w_regAppliKbn
                    '#001-----Ed

                    '2018/03/12 Yamanishi Upd Start ------------------------------------------------------------------------------------------------
                    ''時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
                    'w_RecCnt = Len(w_Time) / 28

                    'w_Pos = 1

                    'For w_Loop = 1 To w_RecCnt
                    '    'HolidayBunruiCD
                    '    w_BunruiCD = Mid(w_Time, w_Pos, 2)

                    '    w_Pos = w_Pos + 2

                    '    'FromTime
                    '    w_StartTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_StartTime) = False Then
                    '        w_StartTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'ToTime
                    '    w_EndTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_EndTime) = False Then
                    '        w_EndTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'DateKbn
                    '    w_KBN = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '時間年休
                    '    w_NenkyuTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NenkyuTime) = False Then
                    '        w_NenkyuTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '休憩減算フラグ
                    '    w_HolSubFlg = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '日勤時間
                    '    w_DayTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_DayTime) = False Then
                    '        w_DayTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '夜勤時間
                    '    w_NightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NightTime) = False Then
                    '        w_NightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '翌日夜勤時間
                    '    w_NextNightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NextNightTime) = False Then
                    '        w_NextNightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, Integer.Parse(w_StartTime), Integer.Parse(w_EndTime), w_KBN, "", Integer.Parse(w_NenkyuTime), w_HolSubFlg, Integer.Parse(w_DayTime), Integer.Parse(w_NightTime), Integer.Parse(w_NextNightTime)) = ""
                    'Next w_Loop

                    '時間年休件数取得
                    w_strTime = w_Time

                    While w_strTime <> ""
                        w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                   w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime)
                        w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, w_StartTime, w_EndTime, w_KBN, "",
                                               w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime) = ""
                    End While
                    '2018/03/12 Yamanishi Upd End --------------------------------------------------------------------------------------------------

                    Call Set_DialogZOrder(1)
                    w_clsObj.pProcessObj = Me
                    '時間年休入力 表示
                    w_clsObj.mShowWindow()

                    Me.Refresh()

                    Call Set_DialogZOrder(0)

                    '入力された値を取得する
                    If w_clsObj.pOKFlg = True Then
                        '初期化
                        w_Time = ""

                        If w_clsObj.pReasonKBN = 6 OrElse Double.Parse(w_RiyuKBN) = 6 Then
                            w_RiyuKBN = w_clsObj.pReasonKBN
                            w_KangoCD = w_clsObj.pOuenKangoCD
                        End If

                        If w_lngWorkLoop = 0 Then
                            '元データがない場合、配列確保
                            w_clsObj.pIndex = 1

                            If Not (w_clsObj.pAllTimeFrom = 0 AndAlso w_clsObj.pAllTimeTo = 0) Then
                                '戻り値が空でなければ
                                w_lngNo = UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo) + 1
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo)
                                m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).init()

                                w_lngDataCnt = w_clsObj.pAllKojyoDataCount

                                For w_lngKojyoLoop = 1 To w_lngDataCnt
                                    w_clsObj.pIndex = w_lngKojyoLoop
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngNikkinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strShinryoKbn(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeFrom(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeTo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYokuYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strKinmuDetailCD(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strNextFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strHolSubFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).UniqueseqNo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).Seq(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngDate = w_clsObj.pAllKDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                    '画面からデータ取得
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                                Next w_lngKojyoLoop
                            End If
                        Else
                            'データがある場合、上書き
                            w_lngDataCnt = w_clsObj.pAllKojyoDataCount
                            '配列初期化
                            m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).init()

                            For w_lngKojyoLoop = 1 To w_lngDataCnt
                                w_clsObj.pIndex = w_lngKojyoLoop
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strNextFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).Seq(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate = w_clsObj.pAllKDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                '画面からデータ取得
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                            Next w_lngKojyoLoop
                        End If

                        '時間年休文字列(１件は１１ﾊﾞｲﾄ)取得
                        For w_Loop = 1 To w_clsObj.pDataCount
                            w_clsObj.pIndex = w_Loop

                            '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                            ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                            'w_BunruiCD = w_clsObj.pHolBunruiCD
                            'If w_BunruiCD = "" Then
                            '    w_Time = w_Time & Space(2)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 2}", w_BunruiCD)
                            'End If
                            ''FromTime(ﾊﾞｲﾄ数４)
                            'w_StartTime = Convert.ToString(w_clsObj.pFromTime)
                            'If w_StartTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_StartTime)
                            'End If
                            ''ToTime(ﾊﾞｲﾄ数４)
                            'w_EndTime = Convert.ToString(w_clsObj.pToTime)
                            'If w_EndTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_EndTime)
                            'End If
                            ''DateKbn(ﾊﾞｲﾄ数１)
                            'w_KBN = w_clsObj.pNextdayFlg
                            'w_Time = w_Time & w_KBN
                            ''時間年休
                            'w_NenkyuTime = Convert.ToString(w_clsObj.pNenkyuTime)
                            'If w_NenkyuTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NenkyuTime)
                            'End If
                            ''休憩減算フラグ
                            'w_HolSubFlg = w_clsObj.pHolGensanFlg2
                            'w_Time = w_Time & w_HolSubFlg
                            ''日勤時間
                            'w_DayTime = Convert.ToString(w_clsObj.pDayTime)
                            'If w_DayTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_DayTime)
                            'End If
                            ''夜勤時間
                            'w_NightTime = Convert.ToString(w_clsObj.pNightDayTime)
                            'If w_NightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NightTime)
                            'End If
                            ''翌日夜勤時間
                            'w_NextNightTime = Convert.ToString(w_clsObj.pNextNightTime)
                            'If w_NextNightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NextNightTime)
                            'End If

                            w_Time = w_Time & Set_NenkyuTime(w_clsObj.pHolBunruiCD, w_clsObj.pFromTime, w_clsObj.pToTime,
                                                             w_clsObj.pNextdayFlg, w_clsObj.pNenkyuTime, w_clsObj.pHolGensanFlg2,
                                                             w_clsObj.pDayTime, w_clsObj.pNightDayTime, w_clsObj.pNextNightTime)
                            '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                        Next w_Loop

                        '2015/04/10 Bando Upd Start =========================================
                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                        '2015/04/10 Bando Upd End   =========================================

                        '勤務記号貼り付け
                        .SetText(w_Row, eventArgs.Column, w_Var)
                        '色分け（時間入力の判断はw_Time<>0で行う）
                        If w_Time <> "" Then
                            '時間年休をを取得している場合
                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                        Else
                            Select Case w_RiyuKBN
                                Case "1" '通常
                                    w_BackColor = Color.White
                                Case "2" '要請
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                Case "3" '希望
                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                Case "4" '再掲
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                Case "5" '委員会
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                Case "6" '応援
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                Case Else 'その他
                                    w_BackColor = Color.White
                            End Select

                            '代休発生勤務 文字/背景色
                            If General.g_lngDaikyuMng = 0 Then
                                w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)

                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                        End If
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var2 <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var2)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    'w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================
                        End If

                        Call SubSetStyle(sprSheet_4W, w_Row, eventArgs.Column, w_Row, eventArgs.Column, 0, 0, , w_BackColor)

                        '予定と実績が異なる時、予定側の時間年休も更新する
                        w_blnFLG = False
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            w_VarPlan = .GetText(w_Row + 1, eventArgs.Column)
                            If m_blnJissekiUseFlg Then
                                '二段表示の時
                                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                    '下段選択の時

                                    w_VarPlan = .GetText(w_Row - 1, eventArgs.Column)
                                    If w_VarPlan <> "" AndAlso Not .Cells(w_Row - 1, eventArgs.Column).BackColor.Equals(Color.Black) Then
                                        '上段にデータが存在 かつ 上段の背景色が黒の時
                                        w_RowPlan = w_Row - 1
                                        w_blnFLG = True
                                    End If
                                End If
                            ElseIf w_VarPlan <> "" Then
                                '一段表示　かつ　下段にデータが存在する時
                                w_RowPlan = w_Row + 1
                                w_blnFLG = True
                            End If
                        End If

                        If w_blnFLG Then
                            '予定と実績が異なる時
                            '2015/04/10 Bando Upd Start =========================================
                            'Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "")
                            'w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "", "")
                            w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time, "")
                            '2015/04/10 Bando Upd End   =========================================

                            '勤務記号貼り付け
                            .SetText(w_RowPlan, eventArgs.Column, w_VarPlan)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN2
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)

                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        'w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            Call SubSetStyle(sprSheet_4W, w_RowPlan, eventArgs.Column, w_RowPlan, eventArgs.Column, 0, 0, , w_BackColor)

                            '理由区分が違う場合は勤務変更扱い
                            If w_RiyuKBN <> w_RiyuKBN2 Then
                                Call SubSetStyle(sprSheet_4W, w_Row, eventArgs.Column, w_Row, eventArgs.Column, 0, 0, ColorTranslator.FromOle(m_Comp_Fore))
                            End If
                        End If

                        '1ｹ月ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                        If Get_Col_M(w_Date, w_Col) = True Then
                            'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                            sprSheet_M.Sheets(0).SetText(w_Row, w_Col, w_Var)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = sprSheet_M.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)

                                        w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = sprSheet_M.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            Call SubSetStyle(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 0, , w_BackColor)

                            '予定と実績が異なる時、予定側の時間年休も更新する
                            If w_blnFLG Then
                                '勤務記号貼り付け
                                sprSheet_M.Sheets(0).SetText(w_RowPlan, w_Col, w_VarPlan)

                                '色分け（時間入力の判断はw_Time<>0で行う）
                                If w_Time <> "" Then
                                    '時間年休をを取得している場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                Else
                                    Select Case w_RiyuKBN2
                                        Case "1" '通常
                                            w_BackColor = Color.White
                                        Case "2" '要請
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                        Case "3" '希望
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Case "4" '再掲
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                        Case "5" '委員会
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                        Case "6" '応援
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                        Case Else 'その他
                                            w_BackColor = Color.White
                                    End Select

                                    '代休発生勤務 文字/背景色
                                    If General.g_lngDaikyuMng = 0 Then
                                        w_Var2 = sprSheet_M.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If w_Var2 <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var2)

                                            w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                End If
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add Start ===========================
                                    '控除があるか判断し　背景色変更
                                    w_Var2 = sprSheet_M.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                            w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                            Exit For
                                                        End If
                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                        Exit For
                                                    End If
                                                Next
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add End   ===========================
                                End If

                                Call SubSetStyle(sprSheet_M, w_RowPlan, w_Col, w_RowPlan, w_Col, 0, 0, , w_BackColor)

                                '理由区分が違う場合は勤務変更扱い
                                If w_RiyuKBN <> w_RiyuKBN2 Then
                                    Call SubSetStyle(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 0, ColorTranslator.FromOle(m_Comp_Fore))
                                End If
                            End If
                        End If
                        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                        ''2016/04/05 Ishiga add start----
                        'm_UndoKaisu = m_UndoKaisu + 1
                        'm_UndoIdx = m_UndoIdx + 1
                        'm_UndoIdxHendou = m_UndoIdxHendou + 1
                        '----------------------------------------------------------------------------------------------------
                        Call Set_UndoData()
                        '2016/04/05 Ishiga add end------
                    End If

                    w_clsObj = Nothing

                    '処理のちらつきを隠す
                    picCover.Top = picBase.Top
                    picCover.Left = picBase.Left
                    picCover.Width = picBase.Width
                    picCover.Height = picBase.Height
                    picCover.Visible = True

                    For w_Loop = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計

                            '個人別集計 計算実行(計画期間)
                            Call RunReCalc_PUser(w_Loop)
                            '4週個人別集計 計算実行(計画期間)
                            Call RunReCalc_User_4W(w_Loop)
                            Call RunReCalc_PUser_Jisseki(w_Loop)
                        End If
                    Next w_Loop

                    picCover.Visible = False
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_LeaveCell(ByVal eventSender As System.Object, ByVal eventArgs As LeaveCellEventArgs) Handles sprSheet_4W.LeaveCell

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_LeaveCell"
        Try
            If eventArgs.NewRow < m_StaffRow.StartRow OrElse m_StaffRow.EndRow < eventArgs.NewRow Then
                '職員表示行より大きいまたは小さいとき
                eventArgs.Cancel = True
                Exit Sub
            End If

            If eventArgs.NewColumn < m_4WeekKikan(1).KinmuDataStartCol OrElse m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol < eventArgs.NewColumn Then
                '実績開始列より小さいまたは計画終了列より大きいとき
                eventArgs.Cancel = True
                Exit Sub
            End If

            Call Set_CopyMenu(eventArgs.NewColumn, eventArgs.NewRow, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_MouseMoveEvent(ByVal eventSender As System.Object, ByVal eventArgs As MouseEventArgs) Handles sprSheet_4W.MouseMove
        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_MouseMove"

        Try
            'ﾏｳｽ位置列／行取得
            m_CellRange_v = sprSheet_4W.GetCellFromPixel(0, 0, eventArgs.X, eventArgs.Y)

            '処理対象外の位置であれば、処理を抜けます
            If m_CellRange_v.Column = -1 OrElse m_CellRange_v.Row = -1 OrElse (m_CurRow = m_CellRange_v.Row AndAlso m_CurCol = m_CellRange_v.Column) Then
                Exit Sub
            End If

            '別スレッドで使用するので縦線用、横線用に変数を分けます
            m_CellRange_h = m_CellRange_v

            m_CurRow = m_CellRange_v.Row
            m_CurCol = m_CellRange_v.Column

            m_v_yPos = eventArgs.Y
            m_v_xPos = eventArgs.X
            m_h_yPos = m_v_yPos
            m_h_xPos = m_v_xPos
            m_SelSheet = sprSheet_4W

            '縦線の制御（別スレッドで実行）
            Dim vthread As New Thread(New ThreadStart(AddressOf setVLineWorker))
            vthread.Start()

            '横線の制御
            Call hlineMove()

            'ﾂｰﾙﾁｯﾌﾟ設定
            Call Set_ToolTipText(m_CurCol, m_CurRow, sprSheet_4W, False)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'BlockSelectedでは、１行複数列の場合に動作しなかった
    Private Sub sprSheet_4W_SelChange(ByVal eventSender As System.Object, ByVal eventArgs As SelectionChangedEventArgs) Handles sprSheet_4W.SelectionChanged

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_SelChange"

        Try
            If eventArgs.Range.ColumnCount = 1 AndAlso eventArgs.Range.RowCount = 1 Then
                Exit Sub
            End If

            'ブロック選択された時は左上のセル位置を渡す
            Call Set_CopyMenu(eventArgs.Range.Column, eventArgs.Range.Row, True)
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_LeftChange(ByVal eventSender As System.Object, ByVal eventArgs As LeftChangeEventArgs) Handles sprSheet_4W.LeftChange

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_LeftChange"

        Static w_Left As Integer
        Try
            'LeftColの制御
            If w_Left <> eventArgs.NewLeft Then
                sprDayTotal_4W.SetViewportLeftColumn(0, eventArgs.NewLeft)
                w_Left = eventArgs.NewLeft
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_TopChange(ByVal eventSender As System.Object, ByVal eventArgs As TopChangeEventArgs) Handles sprSheet_4W.TopChange

        Const W_SUBNAME As String = "NSK0000HA sprSheet_4W_TopChange"

        Static w_Top As Integer
        Try
            'TopRowの制御
            If w_Top <> eventArgs.NewTop Then
                sprPTotal.SetViewportTopRow(0, eventArgs.NewTop)
                w_Top = eventArgs.NewTop
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_ClickEvent(ByVal eventSender As System.Object, ByVal eventArgs As CellClickEventArgs) Handles sprSheet_M.CellClick
        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_Click"

        Dim w_GetData As Boolean
        Dim w_str As String
        Dim w_Var As Object
        Dim w_MsgRc As Integer
        Dim w_strMsg() As String
        Dim w_StaffIdx As Integer
        Dim w_SetNewActiveFlg As Boolean
        Dim w_CellBlockLoop As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_CellRange() As Model.CellRange
        Dim wkCellType As CellType.ButtonCellType
        Dim w_empRowFlg As Boolean = False
        Dim w_ToolTipText As String = ""
        Try
            '採用列の場合
            '2014/07/09 Y.Doi P-07150 UPD START----------------------
            'If eventArgs.Column = M_EmpShrtNghtData_Col AndAlso eventArgs.Row >= M_EVENTLABEL_ROW Then
            If eventArgs.Column = M_EmpShrtNghtData_Col AndAlso eventArgs.Row > M_EVENTLABEL_ROW Then
                '2014/07/09 Y.Doi P-07150 UPD END------------------------
                wkCellType = sprSheet_M.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).CellType
                'ボタンを押下時のみ処理を行う
                If wkCellType Is Nothing Then
                    Exit Sub
                Else
                    w_empRowFlg = True
                End If
            End If

            'ﾏｳｽの左ﾎﾞﾀﾝが押された場合
            If eventArgs.Button = MouseButtons.Left Then
                w_GetData = False
                If m_StaffRow.StartRow <= eventArgs.Row AndAlso eventArgs.Row <= m_StaffRow.EndRow Then
                    '職員行を選択
                    If (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) AndAlso m_blnJissekiUseFlg Then
                        '勤務変更 かつ 予定と実績を分けて表示 の時
                        If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                            '勤務実績の段をクリックした時
                            w_GetData = True
                        ElseIf w_empRowFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                            '採用条件表示フラグON and 予定行をクリック
                            If eventArgs.Column = M_EmpShrtNghtData_Col Then
                                w_ToolTipText = fncGetTxtEmpData(eventArgs.Row)
                                ToolTip1.Show(w_ToolTipText, sprSheet_M)
                            End If
                            Exit Sub
                        End If
                    Else
                        If w_empRowFlg Then
                            '採用欄をクリック
                            If eventArgs.Column = M_EmpShrtNghtData_Col Then
                                w_ToolTipText = fncGetTxtEmpData(eventArgs.Row)
                                ToolTip1.Show(w_ToolTipText, sprSheet_M)
                            End If
                            Exit Sub
                        Else
                            'その他
                            If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                '勤務予定の段をクリックした時
                                w_GetData = True
                            End If
                        End If
                    End If
                Else
                    '職員行以外
                    If M_EVENTLABEL_ROW = eventArgs.Row AndAlso
                      m_KeikakuKikan.KinmuDataStartCol <= eventArgs.Column AndAlso
                      m_KeikakuKikan.KinmuDataEndCol >= eventArgs.Column AndAlso
                      UBound(m_EventData) > 0 Then
                        If Not m_EventForm.pShowFlg Then
                            '選択ｾﾙの日付取得
                            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then Exit Sub

                            '検索画面を非表示
                            If m_KensakuForm.pShowFlg Then
                                m_KensakuForm.Hide()
                                m_KensakuForm.pShowFlg = False
                                'ﾊﾟﾚｯﾄ使用可
                                m_lstmnuView(M_MenuPalette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True
                            End If

                            '置換画面を非表示
                            If m_ChikanForm.pShowFlg Then
                                m_ChikanForm.Hide()
                                m_ChikanForm.pShowFlg = False
                                'ﾊﾟﾚｯﾄ使用可
                                m_lstmnuView(M_MenuPalette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Enabled = True
                                tbrMain.Items.Item(M_ToolBarKey_Palette).Visible = True
                            End If

                            m_EventForm.pEventData = m_EventData
                            m_EventForm.pSelDate = Integer.Parse(w_Var)

                            m_EventForm.Show()
                            m_EventForm.pShowFlg = True
                        End If
                        Exit Sub
                    Else
                        w_GetData = True
                    End If
                End If

                If w_GetData Then
                    'ﾊﾟﾚｯﾄ画面表示ﾌﾗｸﾞ ?
                    If m_lstmnuView(M_MenuPalette).Checked = True Then
                        If m_PaletteForm.pBtnClickFlg = True Then

                            If g_LimitedFlg = True Then
                                w_Var = sprSheet_M.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If IsNumeric(w_Var) = True Then
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    If m_StaffData(w_StaffIdx).ID <> General.g_strUserMngID Then
                                        Exit Sub
                                    End If
                                Else
                                    Exit Sub
                                End If
                            End If

                            '現在のｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 退避
                            w_str = sbrMain.Items.Item(M_StatusBarKey_InformationText).Text

                            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
                            Me.Cursor = Cursors.WaitCursor

                            'KinmuCD/理由区分取得
                            m_SelNowKinmuCD = m_PaletteForm.pSelNowKinmuCD
                            m_SelNowRiyuKbn = m_PaletteForm.pSelNowRiyuKbn

                            '勤務が選択されていないときは消去
                            If Trim(m_SelNowKinmuCD) = "" Then
                                '消去
                                Call RunKinmuPaste_M(eventArgs.Column, eventArgs.Row, True)
                            Else
                                '勤務記号 貼り付け実行
                                If Integer.Parse(m_SelNowKinmuCD) >= 1000 Then
                                    'セット勤務
                                    Call RunKinmuPaste_Set_M(eventArgs.Column, eventArgs.Row)
                                Else
                                    Call RunKinmuPaste_M(eventArgs.Column, eventArgs.Row, False)
                                End If
                            End If

                            'ﾂｰﾙﾁｯﾌﾟ設定
                            Call Set_ToolTipText(eventArgs.Column, eventArgs.Row, sprSheet_M, True)

                            'ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 元に戻す
                            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = w_str
                            sbrMain.Refresh()

                            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
                            Me.Cursor = Cursors.Default
                        End If
                    End If
                End If

                Select Case eventArgs.Row
                    Case m_StaffRow.StartRow To m_StaffRow.EndRow
                        If eventArgs.Column = M_StaffName_Col Then
                            '職員氏名の欄を選択された場合
                            '現在選択されている行を取得
                            m_ActiveRow = eventArgs.Row
                            '応援勤務者の場合
                            If m_OuenStaffRow.StartRow <= m_ActiveRow Then
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "応援勤務職員のため"
                                Call Set_MsgZOrder("NS0095", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                            '個人別勤務登録
                            If RunPersonalKinmu() = False Then
                                Exit Sub
                            End If
                        End If
                    Case Else
                End Select

                'ﾏｳｽの右ﾎﾞﾀﾝが押された場合
            ElseIf eventArgs.Button = MouseButtons.Right Then

                If (m_StaffRow.StartRow <= eventArgs.Row AndAlso eventArgs.Row <= m_StaffRow.EndRow) AndAlso (m_JissekiKikan.KinmuDataStartCol <= eventArgs.Column AndAlso eventArgs.Column <= m_KeikakuKikan.KinmuDataEndCol) Then

                    'ActiveCellの選択ﾌﾗｸﾞを初期化
                    w_SetNewActiveFlg = True

                    '選択されたｾﾙﾌﾞﾛｯｸを取得する
                    w_CellRange = sprSheet_M.Sheets(0).GetSelections

                    If w_CellRange.Length = 0 OrElse (w_CellRange.Length = 1 AndAlso w_CellRange(0).ColumnCount = 1 AndAlso w_CellRange(0).RowCount = 1) Then
                    Else
                        w_blnFLG = True

                        For w_CellBlockLoop = 0 To w_CellRange.Length - 1
                            If w_CellRange(w_CellBlockLoop).Column <= eventArgs.Column AndAlso eventArgs.Column <= w_CellRange(w_CellBlockLoop).Column + w_CellRange(w_CellBlockLoop).ColumnCount - 1 AndAlso
                                    w_CellRange(w_CellBlockLoop).Row <= eventArgs.Row AndAlso eventArgs.Row <= w_CellRange(w_CellBlockLoop).Row + w_CellRange(w_CellBlockLoop).RowCount - 1 Then
                                w_SetNewActiveFlg = False
                                Exit For
                            End If
                        Next w_CellBlockLoop
                    End If

                    If w_SetNewActiveFlg = True Then
                        'ActiveCellの移動
                        sprSheet_M.Sheets(0).SetActiveCell(eventArgs.Row, eventArgs.Column)

                        Call Set_CopyMenu(eventArgs.Column, eventArgs.Row, False)
                    End If

                    '計画立案期間内のセルの場合はPopUpﾒﾆｭｰを表示する

                    '2014/05/28 Shibata del start P-06983 ---------------------------------------
                    'If m_KeikakuKikan.KinmuDataStartCol <= eventArgs.Column Then
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------

                    '複数ｾﾙ選択時や勤務がない場合、計画期間外の場合
                    '時間年休入力非対象の勤務の場合はFalseにする
                    m_lstmnuPopup(M_InputJikanNenkyu).Enabled = True
                    '#001-----St
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出を仕様するときは時間休を入力させない
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    End If
                    '#001-----Ed
                    If w_blnFLG Then
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    Else

                        '部署異動、配属期間内か ?
                        If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).BackColor) = m_MonthBefore_Back) Then
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If

                        If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(eventArgs.Row, eventArgs.Column).ForeColor) = m_Tabusho_Fore) Then
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If

                        If m_blnJissekiUseFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '二段表示の上段をクリックした時
                            w_Var = sprSheet_M.Sheets(0).GetText(eventArgs.Row + 1, eventArgs.Column)
                            If w_Var <> "" Then
                                'まず下段を確認する
                                w_blnFLG = True
                            Else
                                '下段にデータが存在しない時は上段を確認する
                                w_Var = sprSheet_M.Sheets(0).GetText(eventArgs.Row, eventArgs.Column)
                                If w_Var <> "" Then
                                    w_blnFLG = True
                                Else
                                    w_blnFLG = False
                                End If
                            End If
                        Else
                            w_Var = sprSheet_M.Sheets(0).GetText(eventArgs.Row, eventArgs.Column)
                            If w_Var <> "" Then
                                w_blnFLG = True
                            Else
                                w_blnFLG = False
                            End If
                        End If

                        If w_blnFLG = True Then
                            '2015/04/10 Bando Upd Start ==============================
                            'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                            Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                            '2015/04/10 Bando Upd End   ==============================

                            If IsNumeric(w_KinmuCD) = False Then
                                m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                            End If
                        Else
                            m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                        End If
                    End If

                    If g_SaikeiFlg = True Then
                        m_lstmnuPopup(M_InputJikanNenkyu).Enabled = False
                    End If

                    ContextMenuStrip1.Show(sprSheet_M, eventArgs.X, eventArgs.Y)

                    '2014/05/28 Shibata del start P-06983 ---------------------------------------
                    'End If
                    '2014/05/28 Shibata del end P-06983 ---------------------------------------
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '勤務記号貼り付け/削除実行(1ｹ月ｽﾌﾟﾚｯﾄﾞから4週ｽﾌﾟﾚｯﾄﾞに貼り付け/削除)
    Private Sub RunKinmuPaste_M(ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_DelFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA RunKinmuPaste_M"

        Dim w_Var As Object
        Dim w_YYYYMMDD As Object
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_STS As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_Index As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_VarPlan As Object '上段⇔下段　文字入替
        Dim w_Plan_Fore As Integer '上段⇔下段　文字色入替
        Dim w_Plan_Back As Integer '上段⇔下段　背景色入替
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_IntCol As Integer
        Dim w_KibouCnt As Integer
        Dim w_KibouCol() As Integer
        Dim w_blnColChk As Boolean
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        'Dim w_KinmuStTime As Integer
        'Dim w_KinmuEdTime As Integer
        'Dim w_KojyoStTime As Integer
        'Dim w_KojyoEdTime As Integer
        'Dim w_KojyoCnt As Integer
        '----------------------------------------------------------------------------------------------------
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_KibouCntDate As Integer
        Dim w_KibouColDate() As Integer
        Dim w_IntRow As Integer
        '2014/05/14 Shimpo add end P-06991-----------------------------------------------------------------------
        Dim w_Comment As String = String.Empty  '希望勤務時のコメント 2014/11/26 Add

        Try
            '編集可能ｾﾙ範囲 ﾁｪｯｸ
            'ﾃﾞｰﾀ行 範囲内か ?
            If Not ((m_StaffRow.StartRow <= p_Row) AndAlso (p_Row <= m_StaffRow.EndRow)) Then
                'ERROR
                Exit Sub
            End If

            '計画ﾃﾞｰﾀ列 範囲内か ?
            If Not ((m_KeikakuKikan.KinmuDataStartCol <= p_Col) AndAlso (p_Col <= m_KeikakuKikan.KinmuDataEndCol)) Then
                'ERROR
                Exit Sub
            End If

            '部署異動、配属期間内か ?
            If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, p_Col).BackColor) = m_MonthBefore_Back) Then
                'ERROR
                Exit Sub
            End If

            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            w_Var = sprSheet_M.Sheets(0).GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
            If IsNumeric(w_Var) = True Then
                w_StaffIdx = Integer.Parse(w_Var)
            Else
                Exit Sub
            End If

            '選択ｾﾙの日付取得
            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, p_Col)
            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                Exit Sub
            End If

            w_YYYYMMDD = w_Var

            '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                w_Cnt = p_Col - w_KeikakuCol + 1
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_YYYYMMDD, w_GetCol) = True Then
                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                Else
                    Exit Sub
                End If
            End If

            w_Var = sprSheet_M.Sheets(0).GetText(p_Row, p_Col)
            If w_Var = "" AndAlso m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                'テキストが入力されていない時　かつ　勤務実績行を表示してる時　かつ　勤務変更時
                w_Var = sprSheet_M.Sheets(0).GetText(p_Row - 1, p_Col)
            End If

            '2015/04/10 Bando Upd Start =========================================
            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", w_Comment)
            '2015/04/10 Bando Upd End   =========================================

            If Not String.IsNullOrEmpty(m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg) AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg <> "0" AndAlso w_RiyuKBN <> "3" Then
                w_KinmuCD = ""
                w_RiyuKBN = ""
                '2015/04/10 Bando Upd Start =========================================
                'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", "")
                '2015/04/10 Bando Upd End   =========================================
            End If

            '変更前の状態を保存する
            w_VarPlan = w_Var
            w_Plan_Fore = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, p_Col).ForeColor)
            w_Plan_Back = ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, p_Col).BackColor)

            If p_DelFlg = False Then
                '勤務記号貼り付けのとき

                '勤務変更ﾓｰﾄﾞの場合
                '勤務の曜日制限チェック
                If Check_YoubiLimit(w_YYYYMMDD, m_SelNowKinmuCD) = False Then
                    Exit Sub
                End If

                '超勤データの有無チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    If Check_OverKinmuData(w_YYYYMMDD, m_StaffData(w_StaffIdx).ID) = False Then
                        Exit Sub
                    End If
                End If

                '届出存在チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    With General.g_objSyouninData
                        .mKC_UNIQUESEQNO = ""
                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                        .mKC_TargetDate = w_YYYYMMDD

                        If .mChkKinmuChange = False Then
                            ReDim w_strMsg(1)
                            'w_strMsg(1) = "時間外が既に登録されているため~n"
                            w_strMsg(1) = "届出が既に登録されているため~n" '#001
                            Call General.paMsgDsp("NS0110", w_strMsg)
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                    '日当直のコンポーネントありの時
                    With General.g_objGetData
                        .p職員区分 = 0
                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                        .pチェック基準日 = w_YYYYMMDD
                        .p処理区分 = 0
                        .pチェック勤務CD = m_SelNowKinmuCD

                        If .mChkKinmuDuty = False Then
                            '勤務変更不可
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(1)
                            w_strMsg(1) = ""
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                            '************************************************
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                    '届出のコンポーネントありの時
                    w_Row = p_Row - (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row + m_AppliData, p_Col)
                    If w_Var <> "" Then
                        Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                        With General.g_objSyouninData
                            .mKC_UNIQUESEQNO = w_UniqueSeqNO
                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                            .mKC_TargetDate = w_YYYYMMDD

                            If .mChkKinmuChange = False Then
                                '勤務変更不可
                                '*******ﾒｯｾｰｼﾞ***********************************
                                ReDim w_strMsg(1)
                                w_strMsg(1) = ""
                                Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                '************************************************
                                Exit Sub
                            End If
                        End With
                    End If
                End If

                '再掲部署の場合は確定されている勤務への入力は不可
                If g_SaikeiFlg = True Then
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀがある場合は入力不可とする
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "確定済み勤務"
                        w_strMsg(2) = "再掲勤務"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    If w_RiyuKBN = "2" Then
                        If Me.m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "要請勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        End If
                    End If

                    If w_RiyuKBN = "3" Then
                        If Me.m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        End If
                    End If
                End If

                '警告表示
                If g_SaikeiFlg = False Then
                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "要請勤務"
                                w_strMsg(2) = "編集"
                                Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "編集"
                                Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "4"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "再掲勤務"
                            w_strMsg(2) = "編集"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "5"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "委員会勤務"
                            w_strMsg(2) = "編集"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "6"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "応援勤務"
                            w_strMsg(2) = "編集"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                    End Select
                End If

                '希望回数集計チェック
                If Double.Parse(g_HopeNumFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                    w_KibouCnt = 0
                    ReDim w_KibouCol(0)

                    For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                        '2014/05/27 Shibata edit start P-06991-----------------------------------------------------------------------
                        If w_IntCol <> p_Col Then
                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                w_KibouCnt = w_KibouCnt + 1
                                ReDim Preserve w_KibouCol(w_KibouCnt)
                                w_KibouCol(w_KibouCnt) = w_IntCol
                            End If
                        End If
                        '2014/05/27 Shibata edit end   P-06991-----------------------------------------------------------------------
                    Next w_IntCol

                    '同じ場所に同じ勤務を貼り付けた場合、スルー
                    w_blnColChk = False
                    For w_IntCol = 1 To UBound(w_KibouCol)
                        If p_Col = w_KibouCol(w_IntCol) AndAlso w_KinmuCD = m_SelNowKinmuCD Then
                            w_blnColChk = True
                        End If
                    Next w_IntCol

                    If g_HopeNum <= w_KibouCnt AndAlso w_blnColChk = False Then
                        '希望回数制限オーバーダイアログ表示
                        If g_KibouNumDiaLogFlg = 1 Then
                            'ワーニング
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "設定された希望勤務回数"
                            '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                            Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Else
                            'エラー
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "設定された希望勤務回数を超えているため"
                            '「&1入力できません。」
                            Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                End If
                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                '希望回数集計チェック(日付別)
                If Double.Parse(g_HopeNumDateFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                    w_KibouCntDate = 0
                    ReDim w_KibouColDate(0)

                    '勤務表の各日付の一番上から一番下までのループ
                    For w_IntRow = M_KinmuDataStart_Row To m_StaffRow.EndRow
                        '2014/05/27 Shibata edit start P-06991-----------------------------------------------------------------------
                        If p_Row <> w_IntRow Then
                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, p_Col).BackColor) = m_Kibou_Back Then
                                w_KibouCntDate = w_KibouCntDate + 1
                                ReDim Preserve w_KibouColDate(w_KibouCntDate)
                                w_KibouColDate(w_KibouCntDate) = w_IntRow
                            End If
                        End If
                        '2014/05/27 Shibata edit end   P-06991-----------------------------------------------------------------------
                    Next w_IntRow

                    '同じ場所に同じ勤務を貼り付けた場合、スルー
                    w_blnColChk = False
                    For w_IntRow = 1 To UBound(w_KibouColDate)
                        If p_Col = w_KibouColDate(w_IntRow) AndAlso w_KinmuCD = m_SelNowKinmuCD Then
                            w_blnColChk = True
                        End If
                    Next w_IntRow

                    If g_HopeNumDate <= w_KibouCntDate AndAlso w_blnColChk = False Then
                        '希望回数制限オーバーダイアログ表示
                        If g_KibouNumDiaLogFlg = 1 Then
                            'ワーニング
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "設定された希望勤務回数(日付別)"
                            '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                            Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Else
                            'エラー
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "設定された希望勤務回数(日付別)を超えているため"
                            '「&1入力できません。」
                            Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                End If
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
            ElseIf p_DelFlg = True Then
                '勤務記号削除のとき

                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '勤務変更の場合は削除不可（基本的に消しゴムは使えない）
                    Exit Sub
                End If

                '#001-----St
                '届出存在チェック
                With General.g_objSyouninData
                    .mKC_UNIQUESEQNO = ""
                    .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                    .mKC_TargetDate = w_YYYYMMDD

                    If .mChkKinmuChange = False Then
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "届出が既に登録されているため~n"
                        Call General.paMsgDsp("NS0110", w_strMsg)
                        Exit Sub
                    End If
                End With
                '#001-----Ed

                '実績ﾃﾞｰﾀの場合は削除不可
                If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then

                    ReDim w_strMsg(1)
                    w_strMsg(1) = "確定済み勤務を"
                    Call General.paMsgDsp("NS0098", w_strMsg)

                    Exit Sub
                End If

                '警告表示
                If g_SaikeiFlg = False Then
                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "要請勤務"
                                w_strMsg(2) = "削除"
                                Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "削除"
                                Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "4"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "再掲勤務"
                            w_strMsg(2) = "削除"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "5"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "委員会勤務"
                            w_strMsg(2) = "削除"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "6"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "応援勤務"
                            w_strMsg(2) = "削除"
                            Call Set_MsgZOrder("NS0097", w_strMsg, w_STS, 0)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                    End Select
                End If
            End If

            If p_DelFlg = False Then
                '勤務記号貼り付け

                '勤務記号貼り付け中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PASTE_STR
                sbrMain.Refresh()

                With sprSheet_M.Sheets(0)
                    '2016/04/06 Yamanishi Del -------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start---------------------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end-----------------------------
                    'ReDim m_KojyoUndoData(0) 
                    ''Call Set_UndoData(p_Col, p_Row, p_Col, p_Row) '2016/04/05 Ishiga del
                    '--------------------------------------------------------------------------------
                    If m_SelNowRiyuKbn = "6" Then
                        If Disp_Ouen(w_KangoCD) = False Then
                            Exit Sub
                        End If
                    End If

                    '2015/04/10 Bando Add Start =============================
                    '希望の場合コメント入力画面表示
                    If m_SelNowRiyuKbn = "3" And g_InputHopeCommentFlg = "1" Then
                        If Disp_Comment(w_Comment) = False Then
                            Exit Sub
                        End If
                    Else
                        w_Comment = "" '2015/06/03 Bando Add
                    End If
                    '2015/04/10 Bando Add End   =============================

                    If General.g_lngDaikyuMng = 0 Then
                        '代休ﾁｪｯｸ
                        If m_SelNowKinmuCD <> "" Then
                            If Check_Daikyu(M_PASTE, w_YYYYMMDD, w_StaffIdx, m_SelNowKinmuCD) = False Then
                                Exit Sub
                            End If
                        End If
                    End If

                    'ReDim m_KojyoUndoData(1) '2016/04/06 Yamanishi Del

                    '控除データを削除
                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, p_Col)

                    If w_Var <> "" Then
                        w_CurrentDate = Integer.Parse(w_Var)
                    End If
                    If IsNumeric(w_Var) = True Then
                        w_strKojyoData = ""
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                            If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                'm_KojyoUndoData(1) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                                '配列初期化
                                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()
                                '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                                ''勤務開始,終了時間取得
                                'Call GetKinmuFromToTime(w_StaffIdx, m_SelNowKinmuCD, w_CurrentDate, w_KinmuStTime, w_KinmuEdTime)

                                'If w_KinmuStTime <> 0 OrElse w_KinmuEdTime <> 0 Then
                                '    '日跨りの勤務
                                '    If w_KinmuStTime > w_KinmuEdTime Then
                                '        '24時間加算
                                '        w_KinmuEdTime = w_KinmuEdTime + 2400
                                '    End If

                                '    w_KojyoCnt = 0

                                '    For i As Integer = 1 To UBound(m_KojyoUndoData(1).lngKinmuDetailDate)
                                '        '行事の控除データかどうか
                                '        If Not String.IsNullOrEmpty(m_KojyoUndoData(1).UniqueseqNo(i)) Then
                                '            If m_KojyoUndoData(1).strNextFlg(i) = "0" Then
                                '                '当日
                                '                w_KojyoStTime = m_KojyoUndoData(1).lngTimeFrom(i)
                                '                w_KojyoEdTime = m_KojyoUndoData(1).lngTimeTo(i)
                                '            Else
                                '                '翌日
                                '                w_KojyoStTime = m_KojyoUndoData(1).lngTimeFrom(i) + 2400
                                '                w_KojyoEdTime = m_KojyoUndoData(1).lngTimeTo(i) + 2400
                                '            End If

                                '            '日跨りの控除
                                '            If w_KojyoStTime > w_KojyoEdTime Then
                                '                '24時間加算
                                '                w_KojyoEdTime = w_KojyoEdTime + 2400
                                '            End If

                                '            '勤務時間内の控除かどうか
                                '            If w_KinmuStTime <= w_KojyoStTime AndAlso w_KojyoEdTime <= w_KinmuEdTime Then
                                '                w_KojyoCnt = w_KojyoCnt + 1

                                '                '配列拡張
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt)
                                '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt)

                                '                '再格納
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt) = m_KojyoUndoData(1).lngKinmuDetailDate(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngNikkinTime(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt) = m_KojyoUndoData(1).strShinryoKbn(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt) = m_KojyoUndoData(1).lngTimeFrom(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt) = m_KojyoUndoData(1).lngTimeTo(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngYakinTime(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngYokuYakinTime(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt) = m_KojyoUndoData(1).strKinmuDetailCD(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt) = m_KojyoUndoData(1).strNextFlg(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt) = m_KojyoUndoData(1).lngKinmuDetailTime(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt) = m_KojyoUndoData(1).strHolSubFlg(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt) = m_KojyoUndoData(1).UniqueseqNo(i)
                                '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt) = m_KojyoUndoData(1).Seq(i)
                                '            End If
                                '        End If
                                '    Next
                                'End If
                                '----------------------------------------------------------------------------------------------------
                                Exit For
                            End If
                        Next
                    End If

                    'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定部署Flg 貼り付け
                    '2015/04/10 Bando Upd Start =======================================================
                    'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD)
                    w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", w_Comment)
                    '2015/04/10 Bando Upd End   =======================================================
                    .SetText(p_Row, p_Col, w_Var)

                    '罫線設定
                    Call SetBorder(sprSheet_M, p_Row, p_Col, p_Row, p_Col, 1, 1, 1, 1, 0, Color.Black)

                    '理由区分による色設定
                    If m_SelNowRiyuKbn = "1" Then
                        '通常
                        w_ForeColor = Color.Black
                        w_BackColor = Color.White
                    ElseIf m_SelNowRiyuKbn = "2" Then
                        '要請
                        '要請勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                    ElseIf m_SelNowRiyuKbn = "3" Then
                        '希望
                        '希望勤務 文字/背景色
                        '2015/07/21 Bando Upd Start ==================
                        If w_Comment = "" Then
                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                            w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                        Else
                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                            w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                        End If
                        '2015/07/21 Bando Upd End   ==================
                    ElseIf m_SelNowRiyuKbn = "4" Then
                        '再掲
                        '再掲勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                    ElseIf m_SelNowRiyuKbn = "5" Then
                        '委員会
                        '委員会勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                    ElseIf m_SelNowRiyuKbn = "6" Then
                        '応援勤務　文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                    End If

                    If General.g_lngDaikyuMng = 0 Then
                        If m_BackColorFlg = True Then
                            '代休発生勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                        End If
                    End If

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '勤務変更の場合
                        If m_SelNowKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" OrElse m_SelNowRiyuKbn <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN Then
                            '勤務CDが予定と異なる場合
                            w_ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                            If m_blnJissekiUseFlg = False Then
                                '一段表示の時
                                w_Var = .GetText(p_Row + 1, p_Col)
                                If w_Var = "" Then
                                    '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                    .SetText(p_Row + 1, p_Col, w_VarPlan)

                                    .Cells(p_Row + 1, p_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)
                                    .Cells(p_Row + 1, p_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                End If
                            End If
                        Else
                            '勤務CDが予定と同じ場合
                            '通常
                            w_ForeColor = Color.Black
                        End If
                    End If

                    .Cells(p_Row, p_Col).BackColor = w_BackColor
                    .Cells(p_Row, p_Col).ForeColor = w_ForeColor
                End With

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    With sprSheet_4W.Sheets(0)
                        '4週ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                        If Get_Col_4W(w_YYYYMMDD, w_Col) = True Then

                            'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                            '2015/04/10 Bando Upd Start =============================
                            'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                            w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", w_Comment)
                            '2015/04/10 Bando Upd End   =============================
                            .SetText(p_Row, w_Col, w_Var)

                            '罫線設定
                            Call SetBorder(sprSheet_4W, p_Row, w_Col, p_Row, w_Col, 1, 1, 1, 1, 0, Color.Black)

                            '理由区分による色設定
                            If m_SelNowRiyuKbn = "1" Then
                                '通常
                                w_ForeColor = Color.Black
                                w_BackColor = Color.White
                            ElseIf m_SelNowRiyuKbn = "2" Then
                                '要請
                                '要請勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                            ElseIf m_SelNowRiyuKbn = "3" Then
                                '希望
                                '希望勤務 文字/背景色
                                '2015/07/21 Bando Upd Start ==================
                                If w_Comment = "" Then
                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                Else
                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                                End If
                                '2015/07/21 Bando Upd End   ==================
                            ElseIf m_SelNowRiyuKbn = "4" Then
                                '再掲
                                '再掲勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                            ElseIf m_SelNowRiyuKbn = "5" Then
                                '委員会
                                '委員会勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                            ElseIf m_SelNowRiyuKbn = "6" Then
                                '応援勤務　文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            Else
                                'その他（通常と同じとする）
                                w_ForeColor = Color.Black
                                w_BackColor = Color.White
                            End If

                            If General.g_lngDaikyuMng = 0 Then
                                If m_BackColorFlg = True Then
                                    '代休発生勤務　文字/背景色
                                    w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                End If
                            End If

                            If (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                If m_SelNowKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" OrElse m_SelNowRiyuKbn <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN Then
                                    '勤務CDが予定と異なる場合
                                    w_ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                                    If m_blnJissekiUseFlg = False Then
                                        '一段表示の時
                                        w_Var = .GetText(p_Row + 1, w_Col)
                                        If w_Var = "" Then
                                            '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                            .SetText(p_Row + 1, w_Col, w_VarPlan)

                                            .Cells(p_Row + 1, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                            .Cells(p_Row + 1, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)
                                        End If
                                    End If
                                Else
                                    '勤務CDが予定と同じ場合
                                    '通常
                                    w_ForeColor = Color.Black
                                End If
                            End If

                            .Cells(p_Row, w_Col).BackColor = w_BackColor
                            .Cells(p_Row, w_Col).ForeColor = w_ForeColor
                        End If
                    End With
                End If
            ElseIf p_DelFlg = True Then
                '勤務記号削除

                '消去中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_DELTE_STR
                sbrMain.Refresh()

                With sprSheet_M.Sheets(0)
                    If General.g_lngDaikyuMng = 0 Then
                        '代休ﾁｪｯｸ
                        If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                            Exit Sub
                        End If
                    End If

                    '-- 現在選択中のｾﾙ消去 ---
                    .Cells(p_Row, p_Col).BackColor = Color.White
                    .Cells(p_Row, p_Col).ForeColor = Color.Black
                    .SetText(p_Row, p_Col, "")
                End With

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    With sprSheet_4W.Sheets(0)

                        '4週ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                        If Get_Col_4W(w_YYYYMMDD, w_Col) = True Then
                            '-- 現在選択中のｾﾙ消去 ---
                            .Cells(p_Row, w_Col).BackColor = Color.White
                            .Cells(p_Row, w_Col).ForeColor = Color.Black
                            .SetText(p_Row, w_Col, "")
                        End If
                    End With
                End If
            End If

            If m_blnJissekiUseFlg AndAlso (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '計画変更モードで上段を選択している場合
                w_StartRow = p_Row
                w_EndRow = p_Row + 1
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '新規作成モードの場合
                w_StartRow = p_Row
                w_EndRow = p_Row
            Else
                '計画変更モードで下段を選択している場合
                w_StartRow = p_Row - 1
                w_EndRow = p_Row
            End If

            For w_Index = w_StartRow To w_EndRow
                If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計

                    '個人別集計 計算実行(計画期間)
                    Call RunReCalc_PUser(w_Index)
                    '4週個人別集計 計算実行(計画期間)
                    Call RunReCalc_User_4W(w_Index)
                    Call RunReCalc_PUser_Jisseki(w_Index)
                End If
            Next w_Index

            Call Set_KangoKasanTotalData()

            '日別集計 計算実行(計画期間)
            Call RunReCalc_PDay(p_Col)

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'セット勤務用勤務記号貼り付け(1ｹ月ｽﾌﾟﾚｯﾄﾞから4週ｽﾌﾟﾚｯﾄﾞに貼り付け)
    Private Sub RunKinmuPaste_Set_M(ByVal p_Col As Integer, ByVal p_Row As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunKinmuPaste_Set_M"

        Dim w_Var As Object
        Dim w_YYYYMMDD As Object
        Dim w_Col As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_STS As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_Index As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_SetKinmuIdx As Integer
        Dim w_SetCnt As Integer
        Dim w_Int As Integer
        Dim w_ColCnt As Integer
        Dim w_MsgFlg As Boolean
        Dim w_SetCD As String
        Dim w_EndCol As Integer
        Dim w_EndFlg As Boolean
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row As Integer
        Dim w_blnDaikyuFlg As Boolean
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_IntCol As Integer
        Dim w_KibouCnt As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        'Dim w_KinmuStTime As Integer
        'Dim w_KinmuEdTime As Integer
        'Dim w_KojyoStTime As Integer
        'Dim w_KojyoEdTime As Integer
        'Dim w_KojyoCnt As Integer
        '----------------------------------------------------------------------------------------------------
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_KibouCntDate As Integer
        Dim w_KibouColDate() As Integer
        Dim w_IntRow As Integer
        Dim w_blnColChk As Boolean
        '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

        Try
            '編集可能ｾﾙ範囲 ﾁｪｯｸ
            'ﾃﾞｰﾀ行 範囲内か ?
            If Not ((m_StaffRow.StartRow <= p_Row) AndAlso (p_Row <= m_StaffRow.EndRow)) Then
                'ERROR
                Exit Sub
            End If

            '計画ﾃﾞｰﾀ列 範囲内か ?
            If Not ((m_KeikakuKikan.KinmuDataStartCol <= p_Col) AndAlso (p_Col <= m_KeikakuKikan.KinmuDataEndCol)) Then
                'ERROR
                Exit Sub
            End If

            '2015/04/09 Yamanishi Add ------------------------------------------------------------
            '部署異動、配属期間内か ?
            If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, p_Col).BackColor) = m_MonthBefore_Back) Then
                'ERROR
                Exit Sub
            End If
            '-------------------------------------------------------------------------------------

            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            w_Var = sprSheet_M.Sheets(0).GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
            If IsNumeric(w_Var) = True Then
                w_StaffIdx = Integer.Parse(w_Var)
            Else
                Exit Sub
            End If
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''初期化
            ''2016/04/05 Ishiga upd start------------------------
            ''ReDim m_UndoData(0)
            'm_UndoKaisu = m_UndoKaisu + 1
            'If m_UndoMaxKensu < m_UndoKaisu Then
            '    m_UndoKaisu = m_UndoMaxKensu
            'End If

            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            ''2016/04/05 Ishiga upd end--------------------------

            'ReDim m_KojyoUndoData(0)

            ''代休データを退避
            'If General.g_lngDaikyuMng = 0 Then
            '    Call Set_UndoDaikyuData(0)
            'End If
            '----------------------------------------------------------------------------------------------------
            'パレットから対象のセット勤務のデータを取得
            w_SetKinmuIdx = Integer.Parse(m_SelNowKinmuCD) / 1000

            m_PaletteForm.pSelKinmuIdx = w_SetKinmuIdx
            w_SetCnt = m_PaletteForm.pSetCnt

            w_ColCnt = p_Col

            For w_Int = 1 To w_SetCnt

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_KeikakuKikan.KinmuDataEndCol)) Then
                    'ERROR
                    Exit For
                End If

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_ColCnt).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit For
                End If

                'セット勤務取得
                m_PaletteForm.pSetCDIdx = w_Int
                w_SetCD = m_PaletteForm.pGetSetCD

                '選択ｾﾙの日付取得
                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                w_YYYYMMDD = w_Var

                '勤務の曜日制限チェック
                If Check_YoubiLimit(w_YYYYMMDD, w_SetCD) = False Then
                    Exit Sub
                End If

                '届出存在チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    With General.g_objSyouninData
                        .mKC_UNIQUESEQNO = ""
                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                        .mKC_TargetDate = w_YYYYMMDD

                        If .mChkKinmuChange = False Then
                            ReDim w_strMsg(1)
                            'w_strMsg(1) = "時間外が既に登録されているため~n"
                            w_strMsg(1) = "届出が既に登録されているため~n" '#001
                            Call General.paMsgDsp("NS0110", w_strMsg)
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                    '日当直のコンポーネントありの時
                    With General.g_objGetData
                        .p職員区分 = 0
                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                        .pチェック基準日 = w_YYYYMMDD
                        .p処理区分 = 0
                        .pチェック勤務CD = w_SetCD

                        If .mChkKinmuDuty = False Then
                            '勤務変更不可
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(1)
                            w_strMsg(1) = ""
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                            '************************************************
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                    '届出のコンポーネントありの時
                    w_Row = p_Row - (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                    w_Var = sprSheet_M.Sheets(0).GetText(w_Row + m_AppliData, w_ColCnt)
                    If w_Var <> "" Then
                        Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                        With General.g_objSyouninData
                            .mKC_UNIQUESEQNO = w_UniqueSeqNO
                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                            .mKC_TargetDate = w_YYYYMMDD

                            If .mChkKinmuChange = False Then
                                '勤務変更不可
                                '*******ﾒｯｾｰｼﾞ***********************************
                                ReDim w_strMsg(1)
                                w_strMsg(1) = ""
                                Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                '************************************************
                                Exit Sub
                            End If
                        End With
                    End If
                End If

                w_ColCnt = w_ColCnt + 1
            Next w_Int

            w_ColCnt = p_Col

            '警告表示
            If g_SaikeiFlg = False Then

                w_MsgFlg = False

                For w_Int = 1 To w_SetCnt

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_KeikakuKikan.KinmuDataEndCol)) Then
                        'ERROR
                        Exit For
                    End If

                    w_Var = sprSheet_M.Sheets(0).GetText(p_Row, w_ColCnt)
                    '2015/04/10 Bando Upd Start ==================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", "")
                    '2015/04/10 Bando Upd End   ==================================

                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                w_MsgFlg = True
                                Exit For
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                w_MsgFlg = True
                                Exit For
                            End If
                        Case "4", "5", "6"
                            w_MsgFlg = True
                            Exit For
                    End Select

                    w_ColCnt = w_ColCnt + 1
                Next w_Int

                '編集メッセージ表示
                If w_MsgFlg = True Then
                    ReDim w_strMsg(0)
                    Call Set_MsgZOrder("NS0120", w_strMsg, w_STS, 0)
                    If w_STS = MsgBoxResult.No Then
                        Exit Sub
                    End If
                End If
            End If

            w_ColCnt = p_Col
            w_EndFlg = False

            '希望回数集計チェック
            If Double.Parse(g_HopeNumFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                w_KibouCnt = 0
                For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                        w_KibouCnt = w_KibouCnt + 1
                    End If
                Next w_IntCol

                If g_HopeNum < w_KibouCnt + w_SetCnt Then
                    '希望回数制限オーバーダイアログ表示
                    If g_KibouNumDiaLogFlg = 1 Then
                        'ワーニング
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "希望勤務"
                        w_strMsg(2) = "設定された希望勤務回数"
                        '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                        Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                        If w_MsgRc = MsgBoxResult.No Then
                            Exit Sub
                        End If
                    Else
                        'エラー
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "設定された希望勤務回数を超えているため"
                        '「&1入力できません。」
                        Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If
            End If

            '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
            '希望回数集計チェック(日付別)
            If Double.Parse(g_HopeNumDateFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then

                'セット勤務のすべての日付に対して勤務表の各日付の一番上から一番下までのループ
                For w_IntCol = p_Col To p_Col + w_SetCnt - 1
                    w_KibouCntDate = 0
                    ReDim w_KibouColDate(0)

                    For w_IntRow = M_KinmuDataStart_Row To m_StaffRow.EndRow
                        If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                            w_KibouCntDate = w_KibouCntDate + 1
                            ReDim Preserve w_KibouColDate(w_KibouCntDate)
                            w_KibouColDate(w_KibouCntDate) = w_IntRow
                        End If
                    Next w_IntRow

                    '同じ場所に同じ勤務を貼り付けた場合、スルー
                    w_blnColChk = False
                    For w_IntRow = 1 To UBound(w_KibouColDate)
                        If p_Col = w_KibouColDate(w_IntRow) AndAlso w_KinmuCD = m_SelNowKinmuCD Then
                            w_blnColChk = True
                        End If
                    Next w_IntRow

                    If g_HopeNumDate <= w_KibouCntDate AndAlso w_blnColChk = False Then
                        '希望回数制限オーバーダイアログ表示
                        If g_KibouNumDiaLogFlg = 1 Then
                            'ワーニング
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "設定された希望勤務回数(日付別)"
                            '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                            Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Else
                            'エラー
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "設定された希望勤務回数(日付別)を超えているため"
                            '「&1入力できません。」
                            Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                Next w_IntCol
            End If
            '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

            'ReDim m_KojyoUndoData(w_SetCnt) '2016/04/06 Yamanishi Del

            For w_Int = 1 To w_SetCnt

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_KeikakuKikan.KinmuDataEndCol)) Then
                    'ERROR
                    Exit For
                End If

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_ColCnt).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit For
                End If

                'セット勤務取得
                m_PaletteForm.pSetCDIdx = w_Int
                w_SetCD = m_PaletteForm.pGetSetCD

                '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                    '1ｹ月/1ｹ月,4週/4週の場合
                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                    w_Cnt = w_ColCnt - w_KeikakuCol + 1
                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                    If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                        Exit For
                    End If
                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_Var, w_GetCol) = True Then
                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                    Else
                        Exit For
                    End If
                End If

                '控除データがある場合、削除する
                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)

                If w_Var <> "" Then
                    w_CurrentDate = Integer.Parse(w_Var)
                End If

                w_strKojyoData = ""

                For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                    If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                        'm_KojyoUndoData(w_Int) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                        '配列初期化
                        m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()
                        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                        ''勤務開始,終了時間取得
                        'Call GetKinmuFromToTime(w_StaffIdx, w_SetCD, w_CurrentDate, w_KinmuStTime, w_KinmuEdTime)

                        'If w_KinmuStTime <> 0 OrElse w_KinmuEdTime <> 0 Then
                        '    '日跨りの勤務
                        '    If w_KinmuStTime > w_KinmuEdTime Then
                        '        '24時間加算
                        '        w_KinmuEdTime = w_KinmuEdTime + 2400
                        '    End If

                        '    w_KojyoCnt = 0

                        '    For i As Integer = 1 To UBound(m_KojyoUndoData(w_Int).lngKinmuDetailDate)
                        '        '行事の控除データかどうか
                        '        If Not String.IsNullOrEmpty(m_KojyoUndoData(w_Int).UniqueseqNo(i)) Then
                        '            If m_KojyoUndoData(w_Int).strNextFlg(i) = "0" Then
                        '                '当日
                        '                w_KojyoStTime = m_KojyoUndoData(w_Int).lngTimeFrom(i)
                        '                w_KojyoEdTime = m_KojyoUndoData(w_Int).lngTimeTo(i)
                        '            Else
                        '                '翌日
                        '                w_KojyoStTime = m_KojyoUndoData(w_Int).lngTimeFrom(i) + 2400
                        '                w_KojyoEdTime = m_KojyoUndoData(w_Int).lngTimeTo(i) + 2400
                        '            End If

                        '            '日跨りの控除
                        '            If w_KojyoStTime > w_KojyoEdTime Then
                        '                '24時間加算
                        '                w_KojyoEdTime = w_KojyoEdTime + 2400
                        '            End If

                        '            '勤務時間内の控除かどうか
                        '            If w_KinmuStTime <= w_KojyoStTime AndAlso w_KojyoEdTime <= w_KinmuEdTime Then
                        '                w_KojyoCnt = w_KojyoCnt + 1

                        '                '配列拡張
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt)

                        '                '再格納
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngKinmuDetailDate(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngNikkinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt) = m_KojyoUndoData(w_Int).strShinryoKbn(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngTimeFrom(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngTimeTo(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngYakinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngYokuYakinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt) = m_KojyoUndoData(w_Int).strKinmuDetailCD(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt) = m_KojyoUndoData(w_Int).strNextFlg(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngKinmuDetailTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt) = m_KojyoUndoData(w_Int).strHolSubFlg(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt) = m_KojyoUndoData(w_Int).UniqueseqNo(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt) = m_KojyoUndoData(w_Int).Seq(i)
                        '            End If
                        '        End If
                        '    Next
                        'End If
                        '----------------------------------------------------------------------------------------------------
                        Exit For
                    End If
                Next

                '再掲部署の場合は確定されている勤務への入力は不可
                If g_SaikeiFlg = True Then
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀがある場合は入力不可とする
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "確定されている勤務"
                        w_strMsg(2) = "再掲勤務で"
                        Call Set_MsgZOrder("NS0121", w_strMsg, w_MsgRc, 0)

                        Exit For
                    End If
                End If

                '勤務記号貼り付け中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PASTE_STR
                sbrMain.Refresh()

                With sprSheet_M.Sheets(0)

                    'UndoData格納
                    'Call Set_UndoData(w_ColCnt, p_Row, w_ColCnt, p_Row) '2016/04/05 Ishiga del

                    '選択ｾﾙの日付取得
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                    w_YYYYMMDD = w_Var

                    '代休チェック
                    If General.g_lngDaikyuMng = 0 Then
                        '代休取得済みのデータがない場合は、代休配列更新
                        If Check_Daikyu(M_SET, w_YYYYMMDD, w_StaffIdx, "") = False Then
                            Exit For
                        End If
                    End If

                    'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定部署Flg 貼り付け
                    '2015/04/10 Bando Upd Start =============================
                    'w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                    w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", "")
                    '2015/04/10 Bando Upd End   =============================
                    .SetText(p_Row, w_ColCnt, w_Var)

                    '罫線設定
                    Call SetBorder(sprSheet_M, p_Row, w_ColCnt, p_Row, w_ColCnt, 1, 1, 1, 1, 0, Color.Black)

                    '理由区分による色設定
                    If m_SelNowRiyuKbn = "1" Then
                        '通常
                        w_ForeColor = Color.Black
                        w_BackColor = Color.White
                    ElseIf m_SelNowRiyuKbn = "2" Then
                        '要請
                        '要請勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                    ElseIf m_SelNowRiyuKbn = "3" Then
                        '希望
                        '希望勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                    ElseIf m_SelNowRiyuKbn = "4" Then
                        '再掲
                        '再掲勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                    ElseIf m_SelNowRiyuKbn = "5" Then
                        '委員会
                        '委員会勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                    ElseIf m_SelNowRiyuKbn = "6" Then
                        '応援勤務　文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                    End If

                    '代休チェック
                    If General.g_lngDaikyuMng = 0 Then
                        '代休取得済みのデータがない場合は、代休配列更新
                        If Check_Daikyu(M_PASTE, w_YYYYMMDD, w_StaffIdx, w_SetCD) = False Then
                            Exit For
                        End If
                    End If

                    w_blnDaikyuFlg = False
                    If General.g_lngDaikyuMng = 0 Then
                        If m_BackColorFlg = True Then
                            '代休発生勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)

                            w_blnDaikyuFlg = True
                        End If
                    End If

                    .Cells(p_Row, w_ColCnt).BackColor = w_BackColor
                    .Cells(p_Row, w_ColCnt).ForeColor = w_ForeColor
                End With

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    With sprSheet_4W.Sheets(0)

                        '4週ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                        If Get_Col_4W(w_YYYYMMDD, w_Col) = True Then

                            'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                            '2015/04/10 Bando Upd Start =============================
                            'w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                            w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", "")
                            '2015/04/10 Bando Upd End   =============================
                            .SetText(p_Row, w_Col, w_Var)

                            '罫線設定
                            Call SetBorder(sprSheet_4W, p_Row, w_Col, p_Row, w_Col, 1, 1, 1, 1, 0, Color.Black)

                            '理由区分による色設定
                            If m_SelNowRiyuKbn = "1" Then
                                '通常
                                w_ForeColor = Color.Black
                                w_BackColor = Color.White
                            ElseIf m_SelNowRiyuKbn = "2" Then
                                '要請
                                '要請勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                            ElseIf m_SelNowRiyuKbn = "3" Then
                                '希望
                                '希望勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                            ElseIf m_SelNowRiyuKbn = "4" Then
                                '再掲
                                '再掲勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                            ElseIf m_SelNowRiyuKbn = "5" Then
                                '委員会
                                '委員会勤務 文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                            ElseIf m_SelNowRiyuKbn = "6" Then
                                '応援勤務　文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                            End If

                            If General.g_lngDaikyuMng = 0 Then
                                If w_blnDaikyuFlg = True Then
                                    '代休発生勤務　文字/背景色
                                    w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                End If
                            End If

                            .Cells(p_Row, w_Col).BackColor = w_BackColor
                            .Cells(p_Row, w_Col).ForeColor = w_ForeColor
                        End If
                    End With
                End If

                If w_Int = w_SetCnt Then
                    w_EndFlg = True
                Else
                    w_ColCnt = w_ColCnt + 1
                End If
            Next w_Int

            'セットの最後の勤務まで貼り付いたか
            If w_EndFlg = True Then
                w_EndCol = w_ColCnt
            Else
                w_EndCol = w_ColCnt - 1
            End If

            sprSheet_M.Sheets(0).ClearSelection()
            sprSheet_M.Sheets(0).AddSelection(p_Row, p_Col, 1, w_EndCol - p_Col + 1)

            If m_blnJissekiUseFlg AndAlso (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '計画変更モードで上段を選択している場合
                w_StartRow = p_Row
                w_EndRow = p_Row + 1
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '新規作成モードの場合
                w_StartRow = p_Row
                w_EndRow = p_Row
            Else
                '計画変更モードで下段を選択している場合
                w_StartRow = p_Row - 1
                w_EndRow = p_Row
            End If

            For w_Index = w_StartRow To w_EndRow
                If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計

                    '個人別集計 計算実行(計画期間)
                    Call RunReCalc_PUser(w_Index)
                    '4週個人別集計 計算実行(計画期間)
                    Call RunReCalc_User_4W(w_Index)
                    Call RunReCalc_PUser_Jisseki(w_Index)
                End If
            Next w_Index

            Call Set_KangoKasanTotalData()

            '日別集計 計算実行(計画期間)
            w_ColCnt = p_Col
            For w_Int = 1 To w_SetCnt
                Call RunReCalc_PDay(w_ColCnt)
                w_ColCnt = w_ColCnt + 1
            Next w_Int

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Function Disp_Ouen(ByRef p_CD As String) As Boolean

        Const W_SUBNAME As String = "NSK0000HA  Disp_Ouen"

        Dim w_Form As Object
        Dim w_strMsg() As String

        '初期化
        Disp_Ouen = False
        Try
            w_Form = New frmNSK0000HK

            w_Form.frmNSK0000HK_Load()

            If w_Form.pKangoCDFlg = True Then

                'ﾊﾟﾚｯﾄが表示状態の場合、一時的に非表示
                If m_lstmnuView(M_MenuPalette).Checked = True Then
                    m_PaletteForm.Hide()
                End If

                '表示
                w_Form.ShowDialog(Me)

                'OK押下ﾎﾞﾀﾝ時のみ処理続行
                If w_Form.pOKFlg = True Then
                    p_CD = w_Form.pSelKangoTCD
                    Disp_Ouen = True
                End If

                'パレットを表示
                If m_lstmnuView(M_MenuPalette).Checked = True Then
                    m_PaletteForm.Show()
                End If
            Else
                '勤務部署マスタ取得失敗
                ReDim w_strMsg(1)
                w_strMsg(1) = "勤務部署情報"
                Call General.paMsgDsp("NS0031", w_strMsg)
            End If

            '解放
            w_Form = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '2015/04/10 Bando Add Start =======================================================
    Private Function Disp_Comment(ByRef p_com As String) As Boolean

        Const W_SUBNAME As String = "NSK0000HA  Disp_Comment"

        Dim w_Form As Object

        '初期化
        Disp_Comment = False
        Try
            w_Form = New frmNSK0000HP
            w_Form.pRiyuKbn = m_SelNowRiyuKbn
            'コメントが既に存在する場合はプロパティで受け渡す
            If p_com <> "" Then
                w_Form.p_com = p_com
            End If

            w_Form.frmNSK0000HP_Load()


            'ﾊﾟﾚｯﾄが表示状態の場合、一時的に非表示
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                m_PaletteForm.Hide()
            End If

            '表示
            w_Form.ShowDialog(Me)

            'OK押下ﾎﾞﾀﾝ時のみ処理続行
            If w_Form.pOKFlg = True Then
                p_com = w_Form.pComment
                Disp_Comment = True
            End If

            'パレットを表示
            If m_lstmnuView(M_MenuPalette).Checked = True Then
                m_PaletteForm.Show()
            End If

            '解放
            w_Form = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function
    '2015/04/10 Bando Add End   =======================================================

    '勤務記号貼り付け実行(4週ｽﾌﾟﾚｯﾄﾞから1ｹ月ｽﾌﾟﾚｯﾄﾞに貼り付け)
    Private Sub RunKinmuPaste_4W(ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_DelFlg As Boolean)

        Const W_SUBNAME As String = "NSK0000HA RunKinmuPaste_4W"

        Dim w_Var As Object
        Dim w_YYYYMMDD As Object
        Dim w_Col As Integer
        Dim w_StartCol As Integer
        Dim w_Int As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_STS As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_Index As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_VarPlan As Object '上段⇔下段　文字入替
        Dim w_Plan_Fore As Integer '上段⇔下段　文字色入替
        Dim w_Plan_Back As Integer '上段⇔下段　背景色入替
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_IntCol As Integer
        Dim w_KibouCnt As Integer
        Dim w_KibouCol() As Integer
        Dim w_blnColChk As Boolean
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        'Dim w_KinmuStTime As Integer
        'Dim w_KinmuEdTime As Integer
        'Dim w_KojyoStTime As Integer
        'Dim w_KojyoEdTime As Integer
        'Dim w_KojyoCnt As Integer
        '----------------------------------------------------------------------------------------------------
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_KibouCntDate As Integer
        Dim w_KibouColDate() As Integer
        '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
        Dim w_Comment As String = "" '希望勤務時のコメント 2015/04/10 Bando Add

        Try
            '編集可能ｾﾙ範囲 ﾁｪｯｸ
            'ﾃﾞｰﾀ行 範囲内か ?
            If Not ((m_StaffRow.StartRow <= p_Row) AndAlso (p_Row <= m_StaffRow.EndRow)) Then
                'ERROR
                Exit Sub
            End If

            'PlanPeriodFrom/終了日の4週での列番号取得
            If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                Exit Sub
            End If

            '計画ﾃﾞｰﾀ列 範囲内か ?
            If Not ((w_StartCol <= p_Col) AndAlso (p_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol)) Then
                'ERROR
                Exit Sub
            End If

            '計画ﾃﾞｰﾀ列 範囲内か ?
            For w_Int = 1 To UBound(m_4WeekKikan)
                If m_4WeekKikan(w_Int).PersonalStartCol <= p_Col AndAlso p_Col <= m_4WeekKikan(w_Int).PersonalEndCol Then
                    'ERROR
                    Exit Sub
                End If
            Next w_Int

            '部署異動、配属期間内か ?
            If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, p_Col).BackColor) = m_MonthBefore_Back) Then
                'ERROR
                Exit Sub
            End If

            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
            If IsNumeric(w_Var) = True Then
                w_StaffIdx = Integer.Parse(w_Var)
            Else
                Exit Sub
            End If

            '選択ｾﾙの日付取得
            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, p_Col)
            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                Exit Sub
            End If
            w_YYYYMMDD = w_Var

            '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '1ｹ月/1ｹ月,4週/4週の場合（4週/1ヶ月のﾊﾟﾀｰﾝしかこの関数は使用しない？？？）
                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                '*/*/*/*/*/*/*/*/*/*/*/
                If Get_Col_M(w_YYYYMMDD, w_GetCol) = False Then
                    Exit Sub
                End If
                w_Cnt = w_GetCol - w_KeikakuCol + 1
            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週/1ｹ月の場合
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = False Then
                    Exit Sub
                End If
                w_Cnt = p_Col - w_KeikakuCol + 1
            End If

            'ReDim m_KojyoUndoData(1) '2016/04/06 Yamanishi Del

            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, sprSheet_4W.Sheets(0).ActiveColumn.Index)
            If w_Var <> "" Then
                w_CurrentDate = Integer.Parse(w_Var)
            End If

            w_strKojyoData = ""

            For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                    'm_KojyoUndoData(1) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                    '配列初期化
                    m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''勤務開始,終了時間取得
                    'Call GetKinmuFromToTime(w_StaffIdx, m_SelNowKinmuCD, w_CurrentDate, w_KinmuStTime, w_KinmuEdTime)

                    'If w_KinmuStTime <> 0 OrElse w_KinmuEdTime <> 0 Then
                    '    '日跨りの勤務
                    '    If w_KinmuStTime > w_KinmuEdTime Then
                    '        '24時間加算
                    '        w_KinmuEdTime = w_KinmuEdTime + 2400
                    '    End If

                    '    w_KojyoCnt = 0

                    '    For i As Integer = 1 To UBound(m_KojyoUndoData(1).lngKinmuDetailDate)
                    '        '行事の控除データかどうか
                    '        If Not String.IsNullOrEmpty(m_KojyoUndoData(1).UniqueseqNo(i)) Then
                    '            If m_KojyoUndoData(1).strNextFlg(i) = "0" Then
                    '                '当日
                    '                w_KojyoStTime = m_KojyoUndoData(1).lngTimeFrom(i)
                    '                w_KojyoEdTime = m_KojyoUndoData(1).lngTimeTo(i)
                    '            Else
                    '                '翌日
                    '                w_KojyoStTime = m_KojyoUndoData(1).lngTimeFrom(i) + 2400
                    '                w_KojyoEdTime = m_KojyoUndoData(1).lngTimeTo(i) + 2400
                    '            End If

                    '            '日跨りの控除
                    '            If w_KojyoStTime > w_KojyoEdTime Then
                    '                '24時間加算
                    '                w_KojyoEdTime = w_KojyoEdTime + 2400
                    '            End If

                    '            '勤務時間内の控除かどうか
                    '            If w_KinmuStTime <= w_KojyoStTime AndAlso w_KojyoEdTime <= w_KinmuEdTime Then
                    '                w_KojyoCnt = w_KojyoCnt + 1

                    '                '配列拡張
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt)
                    '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt)

                    '                '再格納
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt) = m_KojyoUndoData(1).lngKinmuDetailDate(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngNikkinTime(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt) = m_KojyoUndoData(1).strShinryoKbn(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt) = m_KojyoUndoData(1).lngTimeFrom(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt) = m_KojyoUndoData(1).lngTimeTo(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngYakinTime(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt) = m_KojyoUndoData(1).lngYokuYakinTime(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt) = m_KojyoUndoData(1).strKinmuDetailCD(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt) = m_KojyoUndoData(1).strNextFlg(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt) = m_KojyoUndoData(1).lngKinmuDetailTime(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt) = m_KojyoUndoData(1).strHolSubFlg(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt) = m_KojyoUndoData(1).UniqueseqNo(i)
                    '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt) = m_KojyoUndoData(1).Seq(i)
                    '            End If
                    '        End If
                    '    Next
                    'End If
                    '----------------------------------------------------------------------------------------------------
                    Exit For
                End If
            Next

            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, p_Col)
                If w_Var <> "" Then
                    w_blnFLG = True
                ElseIf m_blnJissekiUseFlg Then
                    'テキストが入力されていない時　かつ　二段表示してる時　かつ　勤務変更時
                    If sprSheet_4W.Sheets(0).Cells(p_Row - 1, p_Col).BackColor.Equals(Color.Black) Then
                        w_blnFLG = False
                    Else
                        w_Var = sprSheet_4W.Sheets(0).GetText(p_Row - 1, p_Col)
                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    End If
                Else
                    w_blnFLG = False
                End If
            Else
                w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, p_Col)
            End If

            '2015/04/10 Bando Upd Start =========================================
            'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
            Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", w_Comment)
            '2015/04/10 Bando Upd End   =========================================

            If Not String.IsNullOrEmpty(m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg) AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg <> "0" AndAlso w_RiyuKBN <> "3" Then
                w_KinmuCD = ""
                w_RiyuKBN = ""
                '2015/04/10 Bando Upd Start =========================================
                'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", w_Comment)
                '2015/04/10 Bando Upd End   =========================================
            End If

            '変更前の状態を保存する
            w_VarPlan = w_Var
            w_Plan_Fore = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, p_Col).ForeColor)
            w_Plan_Back = ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, p_Col).BackColor)

            If p_DelFlg = False Then
                '勤務記号貼り付けのとき

                w_CurrentDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                If Get_Col_4W(w_CurrentDate, w_StartCol) = False Then
                    w_StartCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
                End If

                If w_StartCol <= p_Col AndAlso p_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                    '計画期間外の4週部分のとき
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀのとき
                        If g_SaikeiFlg = False Then
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "計画対象期間外の実績"
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                        Else
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "確定されている勤務"
                            w_strMsg(2) = "再掲勤務で"
                            Call Set_MsgZOrder("NS0121", w_strMsg, w_MsgRc, 0)
                        End If
                        Exit Sub
                    End If
                End If

                '勤務の曜日制限チェック
                If Check_YoubiLimit(w_YYYYMMDD, m_SelNowKinmuCD) = False Then
                    Exit Sub
                End If

                '超勤データの有無チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    If Check_OverKinmuData(w_YYYYMMDD, m_StaffData(w_StaffIdx).ID) = False Then
                        Exit Sub
                    End If
                End If

                '届出存在チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    With General.g_objSyouninData
                        .mKC_UNIQUESEQNO = ""
                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                        .mKC_TargetDate = w_YYYYMMDD
                        If .mChkKinmuChange = False Then
                            ReDim w_strMsg(1)
                            'w_strMsg(1) = "時間外が既に登録されているため~n"
                            w_strMsg(1) = "届出が既に登録されているため~n" '#001
                            Call General.paMsgDsp("NS0110", w_strMsg)
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                    '日当直のコンポーネントありの時
                    With General.g_objGetData
                        .p職員区分 = 0
                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                        .pチェック基準日 = w_YYYYMMDD
                        .p処理区分 = 0
                        .pチェック勤務CD = m_SelNowKinmuCD

                        If .mChkKinmuDuty = False Then
                            '勤務変更不可
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(1)
                            w_strMsg(1) = ""
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                            '************************************************
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                    '届出のコンポーネントありの時
                    w_Row = p_Row - (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row + m_AppliData, p_Col)
                    If w_Var <> "" Then
                        Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                        With General.g_objSyouninData
                            .mKC_UNIQUESEQNO = w_UniqueSeqNO
                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                            .mKC_TargetDate = w_YYYYMMDD

                            If .mChkKinmuChange = False Then
                                '勤務変更不可
                                '*******ﾒｯｾｰｼﾞ***********************************
                                ReDim w_strMsg(1)
                                w_strMsg(1) = ""
                                Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                '************************************************
                                Exit Sub
                            End If
                        End With
                    End If
                End If

                '再掲部署の場合は確定されている勤務への入力は不可
                If g_SaikeiFlg = True Then
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀがある場合は入力不可とする
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "確定されている勤務"
                        w_strMsg(2) = "再掲勤務で"
                        Call Set_MsgZOrder("NS0121", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    If w_RiyuKBN = "2" Then
                        If Me.m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "要請勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        End If
                    End If

                    If w_RiyuKBN = "3" Then
                        If Me.m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        End If
                    End If
                End If

                '警告表示
                If g_SaikeiFlg = False Then
                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "要請勤務"
                                w_strMsg(2) = "編集"
                                w_STS = General.paMsgDsp("NS0097", w_strMsg)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "編集"
                                w_STS = General.paMsgDsp("NS0097", w_strMsg)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "4"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "再掲勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "5"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "委員会勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "6"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "応援勤務"
                            w_strMsg(2) = "編集"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                    End Select
                End If

                '希望回数集計チェック
                If Double.Parse(g_HopeNumFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                    w_KibouCnt = 0
                    ReDim w_KibouCol(0)
                    For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                        '2014/05/27 Shibata edit start P-06991-----------------------------------------------------------------------
                        If p_Col <> w_IntCol Then
                            If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                'If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                w_KibouCnt = w_KibouCnt + 1
                                ReDim Preserve w_KibouCol(w_KibouCnt)
                                w_KibouCol(w_KibouCnt) = w_IntCol
                            End If
                        End If
                        '2014/05/27 Shibata add end   P-06991-----------------------------------------------------------------------
                    Next w_IntCol

                    '同じ場所に同じ勤務を貼り付けた場合、スルー
                    w_blnColChk = False
                    For w_IntCol = 1 To UBound(w_KibouCol)
                        If p_Col = w_KibouCol(w_IntCol) AndAlso w_KinmuCD = m_SelNowKinmuCD Then
                            w_blnColChk = True
                        End If
                    Next w_IntCol

                    If g_HopeNum <= w_KibouCnt AndAlso w_blnColChk = False Then
                        '希望回数制限オーバーダイアログ表示
                        If g_KibouNumDiaLogFlg = 1 Then
                            'ワーニング
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "設定された希望勤務回数"
                            '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                            Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Else
                            'エラー
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "設定された希望勤務回数を超えているため"
                            '「&1入力できません。」
                            Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                End If
                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                '希望回数集計チェック(日付別)
                If Double.Parse(g_HopeNumDateFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                    w_KibouCntDate = 0
                    ReDim w_KibouColDate(0)

                    '勤務表の各日付の一番上から一番下までのループ
                    For w_Row = M_KinmuDataStart_Row To m_StaffRow.EndRow
                        '2014/05/27 Shibata edit start P-06991-----------------------------------------------------------------------
                        If w_Row <> p_Row Then
                            If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, p_Col).BackColor) = m_Kibou_Back Then
                                w_KibouCntDate = w_KibouCntDate + 1
                                ReDim Preserve w_KibouColDate(w_KibouCntDate)
                                w_KibouColDate(w_KibouCntDate) = w_Row
                            End If
                        End If
                        '2014/05/27 Shibata edit end P-06991-----------------------------------------------------------------------
                    Next w_Row

                    '同じ場所に同じ勤務を貼り付けた場合、スルー
                    w_blnColChk = False
                    For w_Row = 1 To UBound(w_KibouColDate)
                        If p_Col = w_KibouColDate(w_Row) AndAlso w_KinmuCD = m_SelNowKinmuCD Then
                            w_blnColChk = True
                        End If
                    Next w_Row

                    If g_HopeNumDate <= w_KibouCntDate AndAlso w_blnColChk = False Then
                        '希望回数制限オーバーダイアログ表示
                        If g_KibouNumDiaLogFlg = 1 Then
                            'ワーニング
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "希望勤務"
                            w_strMsg(2) = "設定された希望勤務回数(日付別)"
                            '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                            Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Else
                            'エラー
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "設定された希望勤務回数(日付別)を超えているため"
                            '「&1入力できません。」
                            Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                End If
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
            ElseIf p_DelFlg = True Then

                '実績ﾃﾞｰﾀの場合は削除不可
                If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "実績データを"
                    Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                    Exit Sub
                End If

                '警告表示
                If g_SaikeiFlg = False Then
                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "要請勤務"
                                w_strMsg(2) = "削除"
                                w_STS = General.paMsgDsp("NS0097", w_strMsg)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "削除"
                                w_STS = General.paMsgDsp("NS0097", w_strMsg)
                                If w_STS = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            End If
                        Case "4"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "再掲勤務"
                            w_strMsg(2) = "削除"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "5"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "委員会勤務"
                            w_strMsg(2) = "削除"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                        Case "6"
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "応援勤務"
                            w_strMsg(2) = "削除"
                            w_STS = General.paMsgDsp("NS0097", w_strMsg)
                            If w_STS = MsgBoxResult.No Then
                                Exit Sub
                            End If
                    End Select
                End If
            End If

            If p_DelFlg = False Then
                '勤務記号貼り付け

                '勤務記号貼り付け中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PASTE_STR
                sbrMain.Refresh()

                With sprSheet_4W.Sheets(0)
                    '2016/04/06 Yamanishi Del -------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start-----------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end-------------------
                    ''Call Set_UndoData(p_Col, p_Row, p_Col, p_Row) '2016/04/05 Ishiga del
                    '--------------------------------------------------------------------------------
                    If m_SelNowRiyuKbn = "6" Then
                        If Disp_Ouen(w_KangoCD) = False Then
                            Exit Sub
                        End If
                    End If

                    '2015/04/10 Bando Add Start =============================
                    '希望の場合コメント入力画面表示
                    If m_SelNowRiyuKbn = "3" And g_InputHopeCommentFlg = "1" Then
                        If Disp_Comment(w_Comment) = False Then
                            Exit Sub
                        End If
                    Else
                        w_Comment = "" '2015/06/03 Bando Add
                    End If
                    '2015/04/10 Bando Add End   =============================

                    If General.g_lngDaikyuMng = 0 Then
                        '代休ﾁｪｯｸ
                        If m_SelNowKinmuCD <> "" Then
                            If Check_Daikyu(M_PASTE, w_YYYYMMDD, w_StaffIdx, m_SelNowKinmuCD) = False Then
                                Exit Sub
                            End If
                        End If
                    End If

                    'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定部署Flg 貼り付け
                    '2015/04/10 Bando Upd Start =========================================
                    'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                    w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", w_Comment)
                    '2015/04/10 Bando Upd End   =========================================
                    .SetText(p_Row, p_Col, w_Var)

                    Call SetBorder(sprDayTotal_4W, p_Row, p_Col, p_Row, p_Col, 1, 1, 1, 1, 0, Color.Black)

                    '理由区分による色設定
                    If m_SelNowRiyuKbn = "1" Then
                        '通常
                        w_ForeColor = Color.Black
                        w_BackColor = Color.White
                    ElseIf m_SelNowRiyuKbn = "2" Then
                        '要請
                        '要請勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                    ElseIf m_SelNowRiyuKbn = "3" Then
                        '希望
                        '希望勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                    ElseIf m_SelNowRiyuKbn = "4" Then
                        '再掲
                        '再掲勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                    ElseIf m_SelNowRiyuKbn = "5" Then
                        '委員会
                        '委員会勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                    ElseIf m_SelNowRiyuKbn = "6" Then
                        '応援勤務　文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                    End If

                    If General.g_lngDaikyuMng = 0 Then
                        If m_BackColorFlg = True Then
                            '代休発生勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                        End If
                    End If

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '勤務変更の場合
                        If m_SelNowKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" OrElse m_SelNowRiyuKbn <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN Then
                            '勤務CDが予定と異なる場合
                            w_ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                            If m_blnJissekiUseFlg = False Then
                                '一段表示の時
                                w_Var = .GetText(p_Row + 1, p_Col)
                                If w_Var = "" Then
                                    '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                    .SetText(p_Row + 1, p_Col, w_VarPlan)
                                    .Cells(p_Row + 1, p_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                    .Cells(p_Row + 1, p_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)
                                End If
                            End If
                        Else
                            '勤務CDが予定と同じ場合
                            '通常
                            w_ForeColor = Color.Black
                        End If
                    End If

                    .Cells(p_Row, p_Col).BackColor = w_BackColor
                    .Cells(p_Row, p_Col).ForeColor = w_ForeColor
                End With

                With sprSheet_M.Sheets(0)

                    '1ｹ月ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_YYYYMMDD, w_Col) = True Then


                        'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                        '2015/04/10 Bando Upd Start =========================================
                        'w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                        w_Var = Set_KinmuMark(m_SelNowKinmuCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", w_Comment)
                        '2015/04/10 Bando Upd End   =========================================
                        .SetText(p_Row, w_Col, w_Var)

                        Call SetBorder(sprSheet_M, p_Row, w_Col, p_Row, w_Col, 1, 1, 1, 1, 0, Color.Black)

                        '理由区分による色設定
                        If m_SelNowRiyuKbn = "1" Then
                            '通常
                            w_ForeColor = Color.Black
                            w_BackColor = Color.White
                        ElseIf m_SelNowRiyuKbn = "2" Then
                            '要請
                            '要請勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                        ElseIf m_SelNowRiyuKbn = "3" Then
                            '希望
                            '希望勤務 文字/背景色
                            '2015/07/21 Bando Upd Start ==================
                            If w_Comment = "" Then
                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                            Else
                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                w_ForeColor = ColorTranslator.FromOle(m_KibouCom_Fore)
                            End If
                            '2015/07/21 Bando Upd End   ==================
                        ElseIf m_SelNowRiyuKbn = "4" Then
                            '再掲
                            '再掲勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                        ElseIf m_SelNowRiyuKbn = "5" Then
                            '委員会
                            '委員会勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                        ElseIf m_SelNowRiyuKbn = "6" Then
                            '応援勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                        End If

                        If General.g_lngDaikyuMng = 0 Then
                            If m_BackColorFlg = True Then
                                '代休発生勤務　文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                            End If
                        End If

                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            '勤務変更の場合
                            If m_SelNowKinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = "1" OrElse m_SelNowRiyuKbn <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN Then
                                '勤務CDが予定と異なる場合
                                w_ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                                If m_blnJissekiUseFlg = False Then
                                    '一段表示の時
                                    w_Var = .GetText(p_Row + 1, w_Col)
                                    If w_Var = "" Then
                                        '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                        .SetText(p_Row + 1, w_Col, w_VarPlan)
                                        .Cells(p_Row + 1, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore)
                                        .Cells(p_Row + 1, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back)
                                    End If
                                End If
                            Else
                                '勤務CDが予定と同じ場合
                                '通常
                                w_ForeColor = Color.Black
                            End If
                        End If

                        .Cells(p_Row, w_Col).BackColor = w_BackColor
                        .Cells(p_Row, w_Col).ForeColor = w_ForeColor
                    End If
                End With
            ElseIf p_DelFlg = True Then
                '勤務記号削除

                '消去中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_DELTE_STR
                sbrMain.Refresh()

                With sprSheet_4W.Sheets(0)
                    If General.g_lngDaikyuMng = 0 Then
                        '代休ﾁｪｯｸ
                        If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                            Exit Sub
                        End If
                    End If

                    '-- 現在選択中のｾﾙ消去 ---
                    .Cells(p_Row, p_Col).BackColor = Color.White
                    .SetText(p_Row, p_Col, "")
                End With

                With sprSheet_M.Sheets(0)
                    '1ｹ月ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_YYYYMMDD, w_Col) = True Then
                        '-- 現在選択中のｾﾙ消去 ---
                        .Cells(p_Row, w_Col).BackColor = Color.White
                        .SetText(p_Row, w_Col, "")
                    End If
                End With
            End If

            If m_blnJissekiUseFlg AndAlso (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '計画変更モードで上段を選択している場合
                w_StartRow = p_Row
                w_EndRow = p_Row + 1
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '新規作成モードの場合
                w_StartRow = p_Row
                w_EndRow = p_Row
            Else
                '計画変更モードで下段を選択している場合
                w_StartRow = p_Row - 1
                w_EndRow = p_Row
            End If

            For w_Index = w_StartRow To w_EndRow
                If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '4週個人別集計 計算実行(計画期間)
                    Call RunReCalc_User_4W(w_Index)
                    '個人別集計 計算実行(計画期間)
                    Call RunReCalc_PUser(w_Index)
                    Call RunReCalc_PUser_Jisseki(w_Index)
                End If
            Next w_Index

            Call Set_KangoKasanTotalData()

            '4週日別集計 計算実行(計画期間)
            Call RunReCalc_PDay_4W(p_Col)

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'セット貼り付け実行(4週ｽﾌﾟﾚｯﾄﾞから1ｹ月ｽﾌﾟﾚｯﾄﾞに貼り付け)
    Private Sub RunKinmuPaste_Set_4W(ByVal p_Col As Integer, ByVal p_Row As Integer)

        Const W_SUBNAME As String = "NSK0000HA RunKinmuPaste_Set_4W"

        Dim w_Var As Object
        Dim w_YYYYMMDD As Object
        Dim w_Col As Integer
        Dim w_StartCol As Integer
        Dim w_Int2 As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_STS As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_Index As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_SetKinmuIdx As Integer
        Dim w_SetCnt As Integer
        Dim w_Int As Integer
        Dim w_ColCnt As Integer
        Dim w_MsgFlg As Boolean
        Dim w_SetCD As String
        Dim w_EndCol As Integer
        Dim w_EndFlg As Boolean
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row As Integer
        Dim w_blnDaikyuFlg As Boolean
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_IntCol As Integer
        Dim w_KibouCnt As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_BackColor As Color
        Dim w_ForeColor As Color
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        'Dim w_KinmuStTime As Integer
        'Dim w_KinmuEdTime As Integer
        'Dim w_KojyoStTime As Integer
        'Dim w_KojyoEdTime As Integer
        'Dim w_KojyoCnt As Integer
        '----------------------------------------------------------------------------------------------------
        Try
            '編集可能ｾﾙ範囲 ﾁｪｯｸ
            'ﾃﾞｰﾀ行 範囲内か ?
            If Not ((m_StaffRow.StartRow <= p_Row) AndAlso (p_Row <= m_StaffRow.EndRow)) Then
                'ERROR
                Exit Sub
            End If

            'PlanPeriodFrom/終了日の4週での列番号取得
            If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                Exit Sub
            End If

            '計画ﾃﾞｰﾀ列 範囲内か ?
            If Not ((w_StartCol <= p_Col) AndAlso (p_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol)) Then
                'ERROR
                Exit Sub
            End If

            '部署異動、配属期間内か ?
            If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, p_Col).BackColor) = m_MonthBefore_Back) Then
                'ERROR
                Exit Sub
            End If

            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
            w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
            If IsNumeric(w_Var) = True Then
                w_StaffIdx = Integer.Parse(w_Var)
            Else
                Exit Sub
            End If
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''初期化
            ''2016/04/05 Ishiga upd start-------------------
            ''ReDim m_UndoData(0)
            'm_UndoKaisu = m_UndoKaisu + 1
            'If m_UndoMaxKensu < m_UndoKaisu Then
            '    m_UndoKaisu = m_UndoMaxKensu
            'End If

            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            ''2016/04/05 Ishiga upd end---------------------

            'ReDim m_KojyoUndoData(0)

            ''代休データを退避
            'If General.g_lngDaikyuMng = 0 Then
            '    Call Set_UndoDaikyuData(0)
            'End If
            '----------------------------------------------------------------------------------------------------
            'パレットから対象のセット勤務のデータを取得
            w_SetKinmuIdx = Integer.Parse(m_SelNowKinmuCD) / 1000

            m_PaletteForm.pSelKinmuIdx = w_SetKinmuIdx
            w_SetCnt = m_PaletteForm.pSetCnt

            w_ColCnt = p_Col

            For w_Int = 1 To w_SetCnt

                'PlanPeriodFrom/終了日の4週での列番号取得
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    Exit For
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((w_StartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                    'ERROR
                    Exit For
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                For w_Int2 = 1 To UBound(m_4WeekKikan)
                    If m_4WeekKikan(w_Int2).PersonalStartCol <= w_ColCnt AndAlso w_ColCnt <= m_4WeekKikan(w_Int2).PersonalEndCol Then
                        'ERROR
                        Exit For
                    End If
                Next w_Int2

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, w_ColCnt).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit For
                End If

                'セット勤務取得
                m_PaletteForm.pSetCDIdx = w_Int
                w_SetCD = m_PaletteForm.pGetSetCD

                '選択ｾﾙの日付取得
                w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                w_YYYYMMDD = w_Var

                '勤務の曜日制限チェック
                If Check_YoubiLimit(w_YYYYMMDD, w_SetCD) = False Then
                    Exit Sub
                End If

                '届出存在チェック
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    With General.g_objSyouninData
                        .mKC_UNIQUESEQNO = ""
                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                        .mKC_TargetDate = w_YYYYMMDD

                        If .mChkKinmuChange = False Then
                            ReDim w_strMsg(1)
                            'w_strMsg(1) = "時間外が既に登録されているため~n"
                            w_strMsg(1) = "届出が既に登録されているため~n" '#001
                            Call General.paMsgDsp("NS0110", w_strMsg)
                            Exit Sub
                        End If
                    End With
                End If

                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                    '日当直のコンポーネントありの時
                    With General.g_objGetData
                        .p職員区分 = 0
                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                        .pチェック基準日 = w_YYYYMMDD
                        .p処理区分 = 0
                        .pチェック勤務CD = w_SetCD

                        If .mChkKinmuDuty = False Then
                            '勤務変更不可
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(1)
                            w_strMsg(1) = ""
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                            '************************************************
                            Exit Sub
                        Else
                        End If
                    End With
                End If

                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                    '届出のコンポーネントありの時
                    w_Row = p_Row - (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                    w_Var = sprSheet_4W.Sheets(0).GetText(w_Row + m_AppliData, w_ColCnt)
                    If w_Var <> "" Then
                        Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                        With General.g_objSyouninData
                            .mKC_UNIQUESEQNO = w_UniqueSeqNO
                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                            .mKC_TargetDate = w_YYYYMMDD

                            If .mChkKinmuChange = False Then
                                '勤務変更不可
                                '*******ﾒｯｾｰｼﾞ***********************************
                                ReDim w_strMsg(1)
                                w_strMsg(1) = ""
                                Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                '************************************************
                                Exit Sub
                            End If
                        End With
                    End If
                End If

                w_ColCnt = w_ColCnt + 1
            Next w_Int

            w_ColCnt = p_Col

            '警告表示
            If g_SaikeiFlg = False Then

                w_MsgFlg = False

                For w_Int = 1 To w_SetCnt
                    'PlanPeriodFrom/終了日の4週での列番号取得
                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                        Exit For
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((w_StartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                        'ERROR
                        Exit For
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    For w_Int2 = 1 To UBound(m_4WeekKikan)
                        If m_4WeekKikan(w_Int2).PersonalStartCol <= w_ColCnt AndAlso w_ColCnt <= m_4WeekKikan(w_Int2).PersonalEndCol Then
                            'ERROR
                            Exit For
                        End If
                    Next w_Int2

                    w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, w_ColCnt)
                    '2015/04/10 Bando Upd Start =========================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", "")
                    '2015/04/10 Bando Upd End   =========================================

                    Select Case w_RiyuKBN
                        Case "2"
                            If m_lstmnuTool(M_MenuYouseiChk).Checked = True Then
                                w_MsgFlg = True
                                Exit For
                            End If
                        Case "3"
                            If m_lstmnuTool(M_MenuKibouChk).Checked = True Then
                                w_MsgFlg = True
                                Exit For
                            End If
                        Case "4", "5", "6"
                            w_MsgFlg = True
                            Exit For
                    End Select

                    w_ColCnt = w_ColCnt + 1
                Next w_Int

                '編集メッセージ表示
                If w_MsgFlg = True Then
                    ReDim w_strMsg(0)
                    Call Set_MsgZOrder("NS0120", w_strMsg, w_STS, 0)
                    If w_STS = MsgBoxResult.No Then
                        Exit Sub
                    End If

                    '編集する場合は配列の理由区分を書き換える
                    w_ColCnt = p_Col
                    For w_Int = 1 To w_SetCnt
                        w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, w_ColCnt)
                        '2015/04/10 Bando Upd Start =========================================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", "")
                        '2015/04/10 Bando Upd End   =========================================

                        '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                            '1ｹ月/1ｹ月,4週/4週の場合（4週/1ヶ月のﾊﾟﾀｰﾝしかこの関数は使用しない？？？）
                            w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                                Exit Sub
                            End If
                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                            If Get_Col_M(w_Var, w_GetCol) = False Then
                                Exit Sub
                            End If
                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = False Then
                                Exit Sub
                            End If
                            w_Cnt = w_ColCnt - w_KeikakuCol + 1
                        End If

                        w_ColCnt = w_ColCnt + 1
                    Next w_Int
                End If
            End If

            w_ColCnt = p_Col
            w_EndFlg = False

            '希望回数集計チェック
            If Double.Parse(g_HopeNumFlg) = 1 AndAlso m_SelNowRiyuKbn = "3" Then
                w_KibouCnt = 0
                For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(p_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                        w_KibouCnt = w_KibouCnt + 1
                    End If
                Next w_IntCol

                If g_HopeNum < w_KibouCnt + w_SetCnt Then
                    '希望回数制限オーバーダイアログ表示
                    If g_KibouNumDiaLogFlg = 1 Then
                        'ワーニング
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "希望勤務"
                        w_strMsg(2) = "設定された希望勤務回数"
                        '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                        Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                        If w_MsgRc = MsgBoxResult.No Then
                            Exit Sub
                        End If
                    Else
                        'エラー
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "設定された希望勤務回数を超えているため"
                        '「&1入力できません。」
                        Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If
            End If

            'ReDim m_KojyoUndoData(w_SetCnt) '2016/04/06 Yamanishi Del

            For w_Int = 1 To w_SetCnt

                'PlanPeriodFrom/終了日の4週での列番号取得
                If Get_Col_4W(m_KeikakuKikan.StartDate, w_StartCol) = False Then
                    Exit For
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((w_StartCol <= w_ColCnt) AndAlso (w_ColCnt <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                    'ERROR
                    Exit For
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                For w_Int2 = 1 To UBound(m_4WeekKikan)
                    If m_4WeekKikan(w_Int2).PersonalStartCol <= w_ColCnt AndAlso w_ColCnt <= m_4WeekKikan(w_Int2).PersonalEndCol Then
                        'ERROR
                        Exit For
                    End If
                Next w_Int2

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(p_Row, w_ColCnt).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit For
                End If

                'セット勤務取得
                m_PaletteForm.pSetCDIdx = w_Int
                w_SetCD = m_PaletteForm.pGetSetCD

                '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                    '1ｹ月/1ｹ月,4週/4週の場合（4週/1ヶ月のﾊﾟﾀｰﾝしかこの関数は使用しない？？？）
                    w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                    If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                        Exit For
                    End If
                    w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_Var, w_GetCol) = False Then
                        Exit For
                    End If
                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ｹ月の場合
                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = False Then
                        Exit For
                    End If
                    w_Cnt = w_ColCnt - w_KeikakuCol + 1
                End If

                '控除データがある場合、削除する
                w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_ColCnt)

                If w_Var <> "" Then
                    w_CurrentDate = Integer.Parse(w_Var)
                End If

                w_strKojyoData = ""

                For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                    If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                        'm_KojyoUndoData(w_Int) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                        '配列初期化
                        m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()
                        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                        ''勤務開始,終了時間取得
                        'Call GetKinmuFromToTime(w_StaffIdx, w_SetCD, w_CurrentDate, w_KinmuStTime, w_KinmuEdTime)

                        'If w_KinmuStTime <> 0 OrElse w_KinmuEdTime <> 0 Then
                        '    '日跨りの勤務
                        '    If w_KinmuStTime > w_KinmuEdTime Then
                        '        '24時間加算
                        '        w_KinmuEdTime = w_KinmuEdTime + 2400
                        '    End If

                        '    w_KojyoCnt = 0

                        '    For i As Integer = 1 To UBound(m_KojyoUndoData(w_Int).lngKinmuDetailDate)
                        '        '行事の控除データかどうか
                        '        If Not String.IsNullOrEmpty(m_KojyoUndoData(w_Int).UniqueseqNo(i)) Then
                        '            If m_KojyoUndoData(w_Int).strNextFlg(i) = "0" Then
                        '                '当日
                        '                w_KojyoStTime = m_KojyoUndoData(w_Int).lngTimeFrom(i)
                        '                w_KojyoEdTime = m_KojyoUndoData(w_Int).lngTimeTo(i)
                        '            Else
                        '                '翌日
                        '                w_KojyoStTime = m_KojyoUndoData(w_Int).lngTimeFrom(i) + 2400
                        '                w_KojyoEdTime = m_KojyoUndoData(w_Int).lngTimeTo(i) + 2400
                        '            End If

                        '            '日跨りの控除
                        '            If w_KojyoStTime > w_KojyoEdTime Then
                        '                '24時間加算
                        '                w_KojyoEdTime = w_KojyoEdTime + 2400
                        '            End If

                        '            '勤務時間内の控除かどうか
                        '            If w_KinmuStTime <= w_KojyoStTime AndAlso w_KojyoEdTime <= w_KinmuEdTime Then
                        '                w_KojyoCnt = w_KojyoCnt + 1

                        '                '配列拡張
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt)
                        '                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt)

                        '                '再格納
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailDate(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngKinmuDetailDate(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngNikkinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngNikkinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strShinryoKbn(w_KojyoCnt) = m_KojyoUndoData(w_Int).strShinryoKbn(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeFrom(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngTimeFrom(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngTimeTo(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngTimeTo(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYakinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngYakinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngYokuYakinTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngYokuYakinTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strKinmuDetailCD(w_KojyoCnt) = m_KojyoUndoData(w_Int).strKinmuDetailCD(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strNextFlg(w_KojyoCnt) = m_KojyoUndoData(w_Int).strNextFlg(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngKinmuDetailTime(w_KojyoCnt) = m_KojyoUndoData(w_Int).lngKinmuDetailTime(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).strHolSubFlg(w_KojyoCnt) = m_KojyoUndoData(w_Int).strHolSubFlg(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).UniqueseqNo(w_KojyoCnt) = m_KojyoUndoData(w_Int).UniqueseqNo(i)
                        '                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).Seq(w_KojyoCnt) = m_KojyoUndoData(w_Int).Seq(i)
                        '            End If
                        '        End If
                        '    Next
                        'End If
                        '----------------------------------------------------------------------------------------------------
                        Exit For
                    End If
                Next

                w_Var = sprSheet_4W.Sheets(0).GetText(p_Row, w_ColCnt)
                '2015/04/10 Bando Upd Start =========================================
                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "")
                Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, "", "", "", "")
                '2015/04/10 Bando Upd End   =========================================

                w_CurrentDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                If Get_Col_4W(w_CurrentDate, w_StartCol) = False Then
                    w_StartCol = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
                End If

                If w_StartCol <= w_ColCnt AndAlso w_ColCnt <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                    '計画期間外の4週部分のとき
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀのとき
                        If g_SaikeiFlg = False Then
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "計画対象期間外の実績"
                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                        Else
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "確定されている勤務"
                            w_strMsg(2) = "再掲勤務で"
                            Call Set_MsgZOrder("NS0121", w_strMsg, w_MsgRc, 0)
                        End If
                        Exit For
                    End If
                End If

                '再掲部署の場合は確定されている勤務への入力は不可
                If g_SaikeiFlg = True Then
                    If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataChk = M_DataFlg_Update AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                        '実績ﾃﾞｰﾀがある場合は入力不可とする
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "確定されている勤務"
                        w_strMsg(2) = "再掲勤務で"
                        Call Set_MsgZOrder("NS0121", w_strMsg, w_MsgRc, 0)
                        Exit For
                    End If
                End If

                '勤務記号貼り付け中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PASTE_STR
                sbrMain.Refresh()

                With sprSheet_4W.Sheets(0)

                    'UndoData格納
                    'Call Set_UndoData(w_ColCnt, p_Row, w_ColCnt, p_Row) '2016/04/05 Ishiga del

                    '選択ｾﾙの日付取得
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_ColCnt)
                    w_YYYYMMDD = w_Var

                    '代休チェック
                    If General.g_lngDaikyuMng = 0 Then
                        '代休取得済みのデータがない場合は、代休配列更新
                        If Check_Daikyu(M_SET, w_YYYYMMDD, w_StaffIdx, "") = False Then
                            Exit For
                        End If
                    End If

                    'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定部署Flg 貼り付け
                    '2015/04/10 Bando Upd Start =========================================
                    'w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                    w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", "")
                    '2015/04/10 Bando Upd End   =========================================
                    .SetText(p_Row, w_ColCnt, w_Var)

                    '罫線設定
                    Call SetBorder(sprSheet_4W, p_Row, w_ColCnt, p_Row, w_ColCnt, 1, 1, 1, 1, 0, Color.Black)

                    '理由区分による色設定
                    If m_SelNowRiyuKbn = "1" Then
                        '通常
                        w_ForeColor = Color.Black
                        w_BackColor = Color.White
                    ElseIf m_SelNowRiyuKbn = "2" Then
                        '要請
                        '要請勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                    ElseIf m_SelNowRiyuKbn = "3" Then
                        '希望
                        '希望勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                    ElseIf m_SelNowRiyuKbn = "4" Then
                        '再掲
                        '再掲勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                    ElseIf m_SelNowRiyuKbn = "5" Then
                        '委員会
                        '委員会勤務 文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                    ElseIf m_SelNowRiyuKbn = "6" Then
                        '応援勤務　文字/背景色
                        w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                    End If

                    '代休チェック
                    If General.g_lngDaikyuMng = 0 Then
                        '代休取得済みのデータがない場合は、代休配列更新
                        If Check_Daikyu(M_PASTE, w_YYYYMMDD, w_StaffIdx, w_SetCD) = False Then
                            Exit For
                        End If
                    End If

                    w_blnDaikyuFlg = False
                    If General.g_lngDaikyuMng = 0 Then
                        If m_BackColorFlg = True Then
                            '代休発生勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)

                            w_blnDaikyuFlg = True
                        End If
                    End If

                    .Cells(p_Row, w_ColCnt).BackColor = w_BackColor
                    .Cells(p_Row, w_ColCnt).ForeColor = w_ForeColor
                End With

                With sprSheet_M.Sheets(0)

                    '1ｹ月ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                    '*/*/*/*/*/*/*/*/*/*/*/
                    If Get_Col_M(w_YYYYMMDD, w_Col) = True Then

                        'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                        '2015/04/10 Bando Upd Start =========================================
                        'w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "")
                        w_Var = Set_KinmuMark(w_SetCD, m_SelNowRiyuKbn, "0", w_KangoCD, "", "")
                        '2015/04/10 Bando Upd End   =========================================
                        .SetText(p_Row, w_Col, w_Var)

                        '罫線設定
                        Call SetBorder(sprSheet_M, p_Row, w_Col, p_Row, w_Col, 1, 1, 1, 1, 0, Color.Black)

                        '理由区分による色設定
                        If m_SelNowRiyuKbn = "1" Then
                            '通常
                            w_ForeColor = Color.Black
                            w_BackColor = Color.White
                        ElseIf m_SelNowRiyuKbn = "2" Then
                            '要請
                            '要請勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Yousei_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                        ElseIf m_SelNowRiyuKbn = "3" Then
                            '希望
                            '希望勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Kibou_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                        ElseIf m_SelNowRiyuKbn = "4" Then
                            '再掲
                            '再掲勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Saikei_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                        ElseIf m_SelNowRiyuKbn = "5" Then
                            '委員会
                            '委員会勤務 文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Iin_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                        ElseIf m_SelNowRiyuKbn = "6" Then
                            '応援勤務　文字/背景色
                            w_ForeColor = ColorTranslator.FromOle(m_Ouen_Fore)
                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                        End If

                        If General.g_lngDaikyuMng = 0 Then
                            If w_blnDaikyuFlg = True Then
                                '代休発生勤務　文字/背景色
                                w_ForeColor = ColorTranslator.FromOle(m_Daikyu_Fore)
                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                            End If
                        End If

                        .Cells(p_Row, w_Col).BackColor = w_BackColor
                        .Cells(p_Row, w_Col).ForeColor = w_ForeColor
                    End If
                End With

                If w_Int = w_SetCnt Then
                    w_EndFlg = True
                Else
                    w_ColCnt = w_ColCnt + 1
                End If
            Next w_Int

            'セットの最後の勤務まで貼り付いたか
            If w_EndFlg = True Then
                w_EndCol = w_ColCnt
            Else
                w_EndCol = w_ColCnt - 1
            End If

            sprSheet_4W.Sheets(0).AddSelection(p_Row, p_Col, 1, w_EndCol - p_Col + 1)

            If m_blnJissekiUseFlg AndAlso (p_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                '計画変更モードで上段を選択している場合
                w_StartRow = p_Row
                w_EndRow = p_Row + 1
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '新規作成モードの場合
                w_StartRow = p_Row
                w_EndRow = p_Row
            Else
                '計画変更モードで下段を選択している場合
                w_StartRow = p_Row - 1
                w_EndRow = p_Row
            End If

            For w_Index = w_StartRow To w_EndRow
                If ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Index - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計

                    '4週個人別集計 計算実行(計画期間)
                    Call RunReCalc_User_4W(w_Index)
                    Call RunReCalc_PUser_Jisseki(w_Index)
                    '個人別集計 計算実行(計画期間)
                    Call RunReCalc_PUser(w_Index)
                End If
            Next w_Index

            Call Set_KangoKasanTotalData()

            '4週日別集計 計算実行(計画期間)
            w_ColCnt = p_Col
            For w_Int = 1 To w_SetCnt
                Call RunReCalc_PDay_4W(w_ColCnt)
                w_ColCnt = w_ColCnt + 1
            Next w_Int

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_DblClick(ByVal eventSender As System.Object, ByVal eventArgs As CellClickEventArgs) Handles sprSheet_M.CellDoubleClick

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_DblClick"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_VarPlan As Object = Nothing
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_RiyuKBN2 As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_DutyKinmuCD() As Object '日当直勤務CD
        Dim w_GroupCD() As Object '日当直グループCD
        Dim w_DutyIndex As Integer
        Dim w_Date As String = String.Empty
        Dim w_Loop As Integer
        '2018/03/12 Yamanishi Upd -------------------------------------------
        'Dim w_RecCnt As Integer
        'Dim w_Pos As Integer
        'Dim w_BunruiCD As String 'HolidayBunruiCD
        'Dim w_StartTime As String 'FromTime
        'Dim w_EndTime As String 'ToTime
        'Dim w_KBN As String 'DateKbn
        'Dim w_NenkyuTime As String '時間年休
        'Dim w_HolSubFlg As String '休憩減算フラグ
        'Dim w_DayTime As String '日勤時間
        'Dim w_NightTime As String '夜勤時間
        'Dim w_NextNightTime As String '翌日夜勤時間
        'Dim w_clsObj As Object
        Dim w_strTime As String = String.Empty
        Dim w_BunruiCD As String = String.Empty     'HolidayBunruiCD
        Dim w_StartTime As Integer                  'FromTime
        Dim w_EndTime As Integer                    'ToTime
        Dim w_KBN As String = String.Empty          'DateKbn
        Dim w_NenkyuTime As Integer                 '時間年休
        Dim w_HolSubFlg As String = String.Empty    '休憩減算フラグ
        Dim w_DayTime As Integer                    '日勤時間
        Dim w_NightTime As Integer                  '夜勤時間
        Dim w_NextNightTime As Integer              '翌日夜勤時間
        Dim w_clsObj As NsAid_NSA0050H.clsNSA0050H
        '--------------------------------------------------------------------
        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_RowPlan As Integer
        Dim w_blnFLG As Boolean
        Dim w_KangoCD As String = String.Empty
        Dim w_StaffID As String = String.Empty
        Dim w_StaffIdx As Integer
        Dim w_lngKojyoLoop As Integer
        Dim w_strWorkIdx As String '退避
        Dim w_lngWorkLoop As Integer '退避
        Dim w_lngNo As Integer
        Dim w_lngDataCnt As Integer
        Dim w_BackColor As Color
        Dim kojoEvent() As EventList_Type
        '#001-----St
        Dim w_nenkyDispFlg As Boolean
        Dim w_regAppliKbn As String
        Dim w_appliKbn As String = String.Empty
        '#001-----Ed
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add

        w_strWorkIdx = ""
        w_lngWorkLoop = 0
        Try
            With sprSheet_M.Sheets(0)

                '編集可能ｾﾙ範囲 ﾁｪｯｸ
                'ﾃﾞｰﾀ行 範囲内か ?
                If Not ((m_StaffRow.StartRow <= eventArgs.Row) AndAlso (eventArgs.Row <= m_StaffRow.EndRow)) Then
                    'ERROR
                    Exit Sub
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If Not ((m_KeikakuKikan.KinmuDataStartCol <= eventArgs.Column) AndAlso (eventArgs.Column <= m_KeikakuKikan.KinmuDataEndCol)) Then
                    'ERROR
                    Exit Sub
                End If

                '勤務行以外?
                If (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan OrElse (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                Else
                    'ERROR
                    Exit Sub
                End If

                '部署異動、配属期間内か ?
                If (ColorTranslator.ToOle(.Cells(eventArgs.Row, eventArgs.Column).BackColor) = m_MonthBefore_Back) Then
                    'ERROR
                    Exit Sub
                End If

                If g_SaikeiFlg = True Then
                    Exit Sub
                End If

                If m_blnJissekiUseFlg AndAlso (eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                    '二段表示の上段をクリックした時
                    w_Var = .GetText(eventArgs.Row + 1, eventArgs.Column)

                    If w_Var <> "" Then
                        'まず下段を確認する
                        w_Row = eventArgs.Row + 1
                        w_blnFLG = True
                    Else
                        '下段にデータが存在しない時は上段を確認する
                        w_Row = eventArgs.Row
                        w_Var = .GetText(eventArgs.Row, eventArgs.Column)

                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    End If
                Else
                    w_Row = eventArgs.Row
                    w_Var = .GetText(eventArgs.Row, eventArgs.Column)

                    If w_Var <> "" Then
                        w_blnFLG = True
                    Else
                        w_blnFLG = False
                    End If
                End If

                If w_blnFLG Then
                    '勤務記号取得

                    'ﾃﾞｰﾀごとに分割
                    '2015/04/10 Bando Upd Start ==========================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                    '2015/04/10 Bando Upd End   ==========================================

                    If IsNumeric(w_KinmuCD) = False Then
                        Exit Sub
                    End If

                    '--------------------------------------------------
                    '   時間年休入力画面  表示
                    '--------------------------------------------------
                    w_clsObj = New NsAid_NSA0050H.clsNSA0050H

                    'ﾌﾟﾛﾊﾟﾃｨ設定
                    'Inatalltype渡し
                    w_clsObj.pInstallType = General.g_InstallType
                    '部品ｵﾌﾞｼﾞｪｸﾄ渡し
                    w_clsObj.pGetDataObj = General.g_objGetData
                    w_clsObj.pSelectDateObj = General.g_objSelectDate
                    w_clsObj.pGetMasterObj = General.g_objGetMaster
                    w_clsObj.pSecurityObj = General.g_objSecurity
                    '利用者情報
                    w_clsObj.pUserID = General.g_strUserID
                    w_clsObj.pUserName = General.g_strUserName
                    w_clsObj.pDispKbn = "0" '呼出元画面区分(0:計画画面)
                    w_clsObj.pAppliUseFlg = "1" '届出コンポーネント使用FLG(1:未使用)
                    w_clsObj.pGetKbnFlg = "2" '取得内容FLG(2:時間指定のみ)
                    '#001-----St
                    w_nenkyDispFlg = True
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出を仕様するときは時間休を入力させない
                        w_nenkyDispFlg = False
                    End If
                    w_clsObj.pNenkyDispFlg = w_nenkyDispFlg
                    '#001-----Ed
                    If w_KangoCD = "" Then
                        w_clsObj.pOuenFlg = 0
                    Else
                        w_clsObj.pOuenFlg = 1
                    End If

                    '応援先勤務部署CD
                    w_clsObj.pOuenKangoCD = w_KangoCD

                    w_Var = .GetText(eventArgs.Row, M_StaffName_Col)
                    If w_Var <> "" Then
                        w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                    ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '職員名称が取得できず、勤務変更で二段表示をしている場合
                        '一行上(二段表示の上段)の職員名称を取得する
                        w_Var = .GetText(eventArgs.Row - 1, M_StaffName_Col)
                        If w_Var <> "" Then
                            w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                        Else
                            w_clsObj.pAppliStaffName = ""
                        End If
                    Else
                        w_clsObj.pAppliStaffName = ""
                    End If

                    '対象年月日
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                    If w_Var <> "" Then
                        w_Date = Convert.ToString(w_Var)
                        w_clsObj.pTargetDate = w_Date
                    End If

                    'KinmuCD
                    w_clsObj.pKinmuCD = w_KinmuCD

                    '看護単位CD
                    w_clsObj.pSelKinmuDeptCD = General.g_strSelKinmuDeptCD

                    '職員管理番号
                    w_Var = .GetText(eventArgs.Row, m_StaffZokusei(M_StaffID).SetCol_M)
                    If w_Var <> "" Then
                        w_StaffID = Convert.ToString(w_Var)
                        w_clsObj.pAppliStaffMngID = w_StaffID
                    End If

                    '職員番号
                    w_Var = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_StaffIdx = Integer.Parse(w_Var)
                            w_clsObj.pAppliStaffID = m_StaffData(w_StaffIdx).PreID
                        End If
                    End If

                    w_strWorkIdx = Convert.ToString(w_StaffIdx)
                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_Var).Kojyo)
                        If Double.Parse(w_Date) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate Then
                            w_lngWorkLoop = w_lngKojyoLoop '退避(控除データ位置)
                            Exit For
                        End If
                    Next w_lngKojyoLoop

                    If w_lngWorkLoop <> 0 Then
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate)
                            If InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop))) <= 0 Then
                                '次画面へ
                                w_clsObj.pKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                            Else
                                '2018/02/23 Yamanishi Upd ---------------------------------------------------------------------------------------------------------
                                'w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate, _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)

                                w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                                '----------------------------------------------------------------------------------------------------------------------------------
                            End If
                        Next w_lngKojyoLoop
                    End If

                    '行事データ受渡
                    ReDim kojoEvent(0)
                    chkEventTargetStaff(w_StaffID, w_Date, kojoEvent)
                    For i As Integer = 1 To UBound(kojoEvent)
                        w_clsObj.pEventData(kojoEvent(i).uniqNo, kojoEvent(i).EventName, kojoEvent(i).Time_st, kojoEvent(i).Time_ed) = kojoEvent(i).allFlg
                    Next

                    '採用CD
                    w_clsObj.pAppliStaffSaiyoCD = Get_SaiyoCD(Integer.Parse(w_Date), w_StaffID)

                    'HospitalCD
                    w_clsObj.pHospitalCD = General.g_strHospitalCD

                    If m_PackageFLG = 0 OrElse m_PackageFLG = 2 Then
                        '日当直を使用していない場合
                        w_clsObj.pDutyUseFlg = "1"
                        w_clsObj.pDutyKinmuCD = ""
                        w_clsObj.pDutyKinmuCD2 = ""
                        w_clsObj.pAppliStaffDutyGroupCD = ""
                        w_clsObj.pAppliStaffDutyGroupCD2 = ""
                    Else
                        '日当直を使用する場合
                        w_clsObj.pDutyUseFlg = "0"

                        w_Var = .GetText(eventArgs.Row - ((eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_DutyData, eventArgs.Column)
                        If w_Var <> "" Then
                            '日当直取得
                            ReDim w_DutyKinmuCD(0)
                            ReDim w_GroupCD(0)

                            'ﾃﾞｰﾀごとに分割
                            Call Get_DutyMark(w_Var, w_DutyKinmuCD, w_GroupCD)

                            w_DutyIndex = 0
                            For w_Loop = 1 To UBound(w_DutyKinmuCD)
                                If IsNumeric(w_DutyKinmuCD(w_Loop)) = True Then
                                    If w_DutyIndex = 0 Then
                                        w_clsObj.pDutyKinmuCD = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD = w_GroupCD(w_Loop)
                                        w_DutyIndex = 1
                                    ElseIf w_DutyIndex = 1 Then
                                        w_clsObj.pDutyKinmuCD2 = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD2 = w_GroupCD(w_Loop)
                                        w_DutyIndex = 2
                                    End If
                                End If
                            Next w_Loop

                            If w_DutyIndex = 0 Then
                                w_clsObj.pDutyKinmuCD = ""
                                w_clsObj.pAppliStaffDutyGroupCD = ""
                            End If
                            If w_DutyIndex <= 1 Then
                                w_clsObj.pDutyKinmuCD2 = ""
                                w_clsObj.pAppliStaffDutyGroupCD2 = ""
                            End If
                        Else
                            w_clsObj.pDutyKinmuCD = ""
                            w_clsObj.pDutyKinmuCD2 = ""
                            w_clsObj.pAppliStaffDutyGroupCD = ""
                            w_clsObj.pAppliStaffDutyGroupCD2 = ""
                        End If
                    End If

                    '#001-----St
                    w_regAppliKbn = "0"
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出使用時、届出が登録されているか確認する
                        w_Var = .GetText(eventArgs.Row - ((eventArgs.Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, eventArgs.Column)
                        Get_AppliMark(w_Var, "", "", "", w_appliKbn, 0, 0, "")
                        'ブランクなら届出登録なし
                        If Not w_Var.Equals("") Then
                            w_regAppliKbn = "1"
                            If w_appliKbn.Equals("1") Then
                                w_regAppliKbn = "2"
                            End If
                        End If
                    End If
                    w_clsObj.pRegistAppliKbn = w_regAppliKbn
                    '#001-----Ed

                    '2018/03/12 Yamanishi Upd Start ------------------------------------------------------------------------------------------------
                    ''時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
                    'w_RecCnt = Len(w_Time) / 28

                    'w_Pos = 1

                    'For w_Loop = 1 To w_RecCnt
                    '    'HolidayBunruiCD
                    '    w_BunruiCD = Mid(w_Time, w_Pos, 2)

                    '    w_Pos = w_Pos + 2

                    '    'FromTime
                    '    w_StartTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_StartTime) = False Then
                    '        w_StartTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'ToTime
                    '    w_EndTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_EndTime) = False Then
                    '        w_EndTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'DateKbn
                    '    w_KBN = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '時間年休
                    '    w_NenkyuTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NenkyuTime) = False Then
                    '        w_NenkyuTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '休憩減算フラグ
                    '    w_HolSubFlg = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '日勤時間
                    '    w_DayTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_DayTime) = False Then
                    '        w_DayTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '夜勤時間
                    '    w_NightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NightTime) = False Then
                    '        w_NightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '翌日夜勤時間
                    '    w_NextNightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NextNightTime) = False Then
                    '        w_NextNightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, Integer.Parse(w_StartTime), Integer.Parse(w_EndTime), w_KBN, "", Integer.Parse(w_NenkyuTime), w_HolSubFlg, Integer.Parse(w_DayTime), Integer.Parse(w_NightTime), Integer.Parse(w_NextNightTime)) = ""
                    'Next w_Loop

                    '時間年休件数取得
                    w_strTime = w_Time

                    While w_strTime <> ""
                        w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                   w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime)
                        w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, w_StartTime, w_EndTime, w_KBN, "",
                                               w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime) = ""
                    End While
                    '2018/03/12 Yamanishi Upd End --------------------------------------------------------------------------------------------------

                    Call Set_DialogZOrder(1)
                    w_clsObj.pProcessObj = Me
                    '時間年休入力 表示
                    w_clsObj.mShowWindow()

                    Me.Refresh()

                    Call Set_DialogZOrder(0)

                    '入力された値を取得する
                    If w_clsObj.pOKFlg = True Then
                        '初期化
                        w_Time = ""
                        If w_clsObj.pReasonKBN = 6 OrElse Double.Parse(w_RiyuKBN) = 6 Then
                            w_RiyuKBN = w_clsObj.pReasonKBN
                            w_KangoCD = w_clsObj.pOuenKangoCD
                        End If

                        If w_lngWorkLoop = 0 Then
                            '元データがない場合、配列確保
                            w_clsObj.pindex = 1
                            If Not (w_clsObj.pAllTimeFrom = 0 AndAlso w_clsObj.pAllTimeTo = 0) Then
                                '戻り値が空でなければ
                                w_lngNo = UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo) + 1
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo)
                                m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).init()

                                w_lngDataCnt = w_clsObj.pAllKojyoDataCount
                                For w_lngKojyoLoop = 1 To w_lngDataCnt
                                    w_clsObj.pindex = w_lngKojyoLoop
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngNikkinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strShinryoKbn(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeFrom(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeTo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYokuYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strKinmuDetailCD(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strNextFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strHolSubFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).UniqueseqNo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).Seq(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngDate = w_clsObj.pAllKDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                    '控除データ取得処理変更
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                                Next w_lngKojyoLoop
                            End If
                        Else
                            'データがある場合、上書き
                            w_lngDataCnt = w_clsObj.pAllKojyoDataCount
                            '配列初期化
                            m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).init()
                            For w_lngKojyoLoop = 1 To w_lngDataCnt
                                w_clsObj.pindex = w_lngKojyoLoop
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strNextFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).Seq(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate = w_clsObj.pAllKDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                '控除データ取得処理変更
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                            Next w_lngKojyoLoop
                        End If

                        '時間年休文字列(１件は１１ﾊﾞｲﾄ)取得
                        For w_Loop = 1 To w_clsObj.pDataCount
                            w_clsObj.pindex = w_Loop

                            '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                            ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                            'w_BunruiCD = w_clsObj.pHolBunruiCD
                            'If w_BunruiCD = "" Then
                            '    w_Time = w_Time & Space(2)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 2}", w_BunruiCD)
                            'End If
                            ''FromTime(ﾊﾞｲﾄ数４)
                            'w_StartTime = Convert.ToString(w_clsObj.pFromTime)
                            'If w_StartTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_StartTime)
                            'End If
                            ''ToTime(ﾊﾞｲﾄ数４)
                            'w_EndTime = Convert.ToString(w_clsObj.pToTime)
                            'If w_EndTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_EndTime)
                            'End If
                            ''DateKbn(ﾊﾞｲﾄ数１)
                            'w_KBN = w_clsObj.pNextdayFlg
                            'w_Time = w_Time & w_KBN
                            ''時間年休
                            'w_NenkyuTime = Convert.ToString(w_clsObj.pNenkyuTime)
                            'If w_NenkyuTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NenkyuTime)
                            'End If
                            ''休憩減算フラグ
                            'w_HolSubFlg = w_clsObj.pHolGensanFlg2
                            'w_Time = w_Time & w_HolSubFlg
                            ''日勤時間
                            'w_DayTime = Convert.ToString(w_clsObj.pDayTime)
                            'If w_DayTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_DayTime)
                            'End If
                            ''夜勤時間
                            'w_NightTime = Convert.ToString(w_clsObj.pNightDayTime)
                            'If w_NightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NightTime)
                            'End If
                            ''翌日夜勤時間
                            'w_NextNightTime = Convert.ToString(w_clsObj.pNextNightTime)
                            'If w_NextNightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NextNightTime)
                            'End If

                            w_Time = w_Time & Set_NenkyuTime(w_clsObj.pHolBunruiCD, w_clsObj.pFromTime, w_clsObj.pToTime,
                                                             w_clsObj.pNextDayFlg, w_clsObj.pNenkyuTime, w_clsObj.pHolGensanFlg2,
                                                             w_clsObj.pDayTime, w_clsObj.pNightDayTime, w_clsObj.pNextNightTime)
                            '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                        Next w_Loop

                        '2015/04/10 Bando Upd Start ======================================
                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   ======================================

                        '勤務記号貼り付け
                        .SetText(w_Row, eventArgs.Column, w_Var)

                        '色分け（時間入力の判断はw_Time<>0で行う）
                        If w_Time <> "" Then
                            '時間年休をを取得している場合
                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                        Else
                            Select Case w_RiyuKBN
                                Case "1" '通常
                                    w_BackColor = Color.White
                                Case "2" '要請
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                Case "3" '希望
                                    '2015/07/21 Bando Upd Start =================================
                                    If w_Comment = "" Then
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Else
                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    End If
                                    '2015/07/21 Bando Upd End   =================================
                                Case "4" '再掲
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                Case "5" '委員会
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                Case "6" '応援
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                Case Else 'その他
                                    w_BackColor = Color.White
                            End Select

                            '代休発生勤務 文字/背景色
                            If General.g_lngDaikyuMng = 0 Then

                                w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)

                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                        End If
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var2 <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var2)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================
                        End If

                        .Cells(w_Row, eventArgs.Column).BackColor = w_BackColor

                        '予定と実績が異なる時、予定側の時間年休も更新する
                        w_blnFLG = False

                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                            w_VarPlan = .GetText(w_Row + 1, eventArgs.Column)
                            If m_blnJissekiUseFlg Then
                                '二段表示の時
                                If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                    '下段選択の時
                                    w_VarPlan = .GetText(w_Row - 1, eventArgs.Column)
                                    If w_VarPlan <> "" Then
                                        '上段にデータが存在する時
                                        w_RowPlan = w_Row - 1
                                        w_blnFLG = True
                                    End If
                                End If
                            ElseIf w_VarPlan <> "" Then
                                '一段表示　かつ　下段にデータが存在する時
                                w_RowPlan = w_Row + 1
                                w_blnFLG = True
                            End If
                        End If

                        If w_blnFLG Then
                            '予定と実績が異なる時
                            '2015/04/10 Bando Upd Start =============================
                            'Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "")
                            'w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "", w_Comment)
                            w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                            '2015/04/10 Bando Upd End   =============================

                            '勤務記号貼り付け
                            .SetText(w_RowPlan, eventArgs.Column, w_VarPlan)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN2
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        '2015/07/21 Bando Upd Start ===========================
                                        If w_Comment = "" Then
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Else
                                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                        End If
                                        '2015/07/21 Bando Upd End   ===========================
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then

                                    w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)

                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = .GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, eventArgs.Column)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            .Cells(w_RowPlan, eventArgs.Column).BackColor = w_BackColor

                            '理由区分が違う場合は勤務変更扱い
                            If w_RiyuKBN <> w_RiyuKBN2 Then
                                .Cells(w_Row, eventArgs.Column).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                            End If
                        End If

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合

                            '4週ｽﾌﾟﾚｯﾄﾞのときの列番号取得
                            If Get_Col_4W(w_Date, w_Col) = True Then

                                'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                                sprSheet_4W.Sheets(0).SetText(w_Row, w_Col, w_Var)

                                '色分け（時間入力の判断はw_Time<>0で行う）
                                If w_Time <> "" Then
                                    '時間年休をを取得している場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                Else
                                    Select Case w_RiyuKBN
                                        Case "1" '通常
                                            w_BackColor = Color.White
                                        Case "2" '要請
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                        Case "3" '希望
                                            '2015/07/21 Bando Upd Start ===================
                                            If w_Comment = "" Then
                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                            Else
                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                            End If
                                            '2015/07/21 Bando Upd End   ===================
                                        Case "4" '再掲
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                        Case "5" '委員会
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                        Case "6" '応援
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                        Case Else 'その他
                                            w_BackColor = Color.White
                                    End Select

                                    '代休発生勤務 文字/背景色
                                    If General.g_lngDaikyuMng = 0 Then

                                        w_Var2 = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If w_Var2 <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var2)

                                            w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                End If
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add Start ===========================
                                    '控除があるか判断し　背景色変更
                                    w_Var2 = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                            w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                            Exit For
                                                        End If
                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                        Exit For
                                                    End If
                                                Next
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add End   ===========================
                                End If

                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor = w_BackColor

                                '予定と実績が異なる時、予定側の時間年休も更新する
                                If w_blnFLG Then
                                    '勤務記号貼り付け
                                    sprSheet_4W.Sheets(0).SetText(w_RowPlan, w_Col, w_VarPlan)

                                    '色分け（時間入力の判断はw_Time<>0で行う）
                                    If w_Time <> "" Then
                                        '時間年休をを取得している場合
                                        w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                    Else
                                        Select Case w_RiyuKBN2
                                            Case "1" '通常
                                                w_BackColor = Color.White
                                            Case "2" '要請
                                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                            Case "3" '希望
                                                '2015/07/21 Bando Upd Start ===================
                                                If w_Comment = "" Then
                                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                Else
                                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                End If
                                                '2015/07/21 Bando Upd End   ===================
                                            Case "4" '再掲
                                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                            Case "5" '委員会
                                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                            Case "6" '応援
                                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                            Case Else 'その他
                                                w_BackColor = Color.White
                                        End Select

                                        '代休発生勤務 文字/背景色
                                        If General.g_lngDaikyuMng = 0 Then

                                            w_Var2 = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                            If w_Var2 <> "" Then
                                                w_StaffIdx = Integer.Parse(w_Var2)

                                                w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var2 <> "" Then
                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                    End If
                                                End If
                                            End If
                                        End If
                                        '2015/07/22 Bando Add Start ===========================
                                        '控除があるか判断し　背景色変更
                                        w_Var2 = sprSheet_4W.Sheets(0).GetText(eventArgs.Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If w_Var2 <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var2)
                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var2 <> "" Then
                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                        If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                Exit For
                                                            End If
                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                            Exit For
                                                        End If
                                                    Next
                                                End If
                                            End If
                                        End If
                                        '2015/07/22 Bando Add End   ===========================
                                    End If

                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor = w_BackColor

                                    '理由区分が違う場合は勤務変更扱い
                                    If w_RiyuKBN <> w_RiyuKBN2 Then
                                        sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                    End If
                                End If
                            End If
                        End If
                        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                        ''2016/04/05 Ishiga add start----
                        'm_UndoKaisu = m_UndoKaisu + 1
                        'm_UndoIdx = m_UndoIdx + 1
                        'm_UndoIdxHendou = m_UndoIdxHendou + 1
                        '----------------------------------------------------------------------------------------------------
                        Call Set_UndoData()
                        '2016/04/05 Ishiga add end------
                    End If

                    'ｸﾗｽｵﾌﾞｼﾞｪｸﾄ解放
                    w_clsObj = Nothing

                    '処理のちらつきを隠す
                    picCover.Top = picBase.Top
                    picCover.Left = picBase.Left
                    picCover.Width = picBase.Width
                    picCover.Height = picBase.Height
                    picCover.Visible = True

                    For w_Loop = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計

                            '個人別集計 計算実行(計画期間)
                            Call RunReCalc_PUser(w_Loop)
                        End If
                    Next w_Loop

                    picCover.Visible = False
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_LeaveCell(ByVal eventSender As System.Object, ByVal eventArgs As LeaveCellEventArgs) Handles sprSheet_M.LeaveCell

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_LeaveCell"
        Try
            If eventArgs.NewRow < m_StaffRow.StartRow OrElse m_StaffRow.EndRow < eventArgs.NewRow Then
                '職員表示行より大きいまたは小さいとき
                eventArgs.Cancel = True
                Exit Sub
            End If

            If eventArgs.NewColumn < m_JissekiKikan.KinmuDataStartCol OrElse m_KeikakuKikan.KinmuDataEndCol < eventArgs.NewColumn Then
                '実績開始列より小さいまたは計画終了列より大きいとき
                eventArgs.Cancel = True
                Exit Sub
            End If

            Call Set_CopyMenu(eventArgs.NewColumn, eventArgs.NewRow, False)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_MouseMoveEvent(ByVal eventSender As System.Object, ByVal eventArgs As MouseEventArgs) Handles sprSheet_M.MouseMove

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_MouseMove"

        Try
            'ﾏｳｽ位置列／行取得
            m_CellRange_v = sprSheet_M.GetCellFromPixel(0, 0, eventArgs.X, eventArgs.Y)

            '処理対象外の位置であれば、処理を抜けます
            If m_CellRange_v.Column = -1 OrElse m_CellRange_v.Row = -1 OrElse (m_CurRow = m_CellRange_v.Row AndAlso m_CurCol = m_CellRange_v.Column) Then
                Exit Sub
            End If

            '別スレッドで使用するので縦線用、横線用に変数を分けます
            m_CellRange_h = m_CellRange_v

            m_CurRow = m_CellRange_v.Row
            m_CurCol = m_CellRange_v.Column

            m_v_yPos = eventArgs.Y
            m_v_xPos = eventArgs.X
            m_h_yPos = m_v_yPos
            m_h_xPos = m_v_xPos
            m_SelSheet = sprSheet_M

            '縦線の制御（別スレッドで実行）
            Dim vthread As New Thread(New ThreadStart(AddressOf setVLineWorker))
            vthread.Start()

            '横線の制御
            Call hlineMove()

            'ﾂｰﾙﾁｯﾌﾟ設定
            Call Set_ToolTipText(m_CurCol, m_CurRow, sprSheet_M, False)

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'Undo制御
    '2016/04/05 Ishiga upd start--------------------------------------------------------------------------------------------------
    'Private Sub Set_UndoData(ByVal p_Col As Integer, ByVal p_Row As Integer, ByVal p_Col2 As Integer, ByVal p_Row2 As Integer)
    Private Sub Set_UndoData()
        '2016/04/05 Ishiga upd end------------------------------------------------------------------------------------------------

        Const W_SUBNAME As String = "NSK0000HA Set_UndoData"

        Dim w_Cnt As Integer '2016/04/06 Yamanishi Add
        Dim w_Int As Integer
        'Dim w_Index As Integer '2016/04/06 Yamanishi Del
        '2016/04/05 Ishiga add start---
        Dim w_StCol As Integer
        Dim w_EdCol As Integer
        '2016/04/05 Ishiga add end-----
        Try
            '2016/04/06 Yamanishi Add ---------------------------------------------------------------------------
            m_UndoKaisu = m_UndoKaisu + 1
            If m_UndoMaxKensu < m_UndoKaisu Then
                m_UndoKaisu = m_UndoMaxKensu
            End If

            m_UndoIdx = m_UndoIdx + 1
            m_UndoIdxHendou = m_UndoIdxHendou + 1
            '----------------------------------------------------------------------------------------------------
            '2016/04/05 Ishiga upd start-------------------
            ''元に戻す使用可
            'm_lstmnuEdit(M_MenuUndo).Enabled = True

            ''ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用可
            'm_lstmnuPopup(M_PopUndo).Enabled = True

            If m_FirstFlg = True Then
                '元に戻す使用不可
                m_lstmnuEdit(M_MenuUndo).Enabled = False

                'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
                m_lstmnuPopup(M_PopUndo).Enabled = False

                m_FirstFlg = False
            Else
                '元に戻す使用可
                m_lstmnuEdit(M_MenuUndo).Enabled = True

                'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用可
                m_lstmnuPopup(M_PopUndo).Enabled = True
            End If

            'やり直し使用可
            m_lstmnuEdit(M_MenuRedo).Enabled = False

            'ﾎﾟｯﾌﾟｱｯﾌﾟやり直し使用可
            m_lstmnuPopup(M_PopRedo).Enabled = False
            '2016/04/05 Ishiga upd end---------------------

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                w_Int = 1
                '2016/04/05 Ishiga add start-------------------
                w_StCol = m_KeikakuKikan.KinmuDataStartCol
                w_EdCol = m_KeikakuKikan.KinmuDataEndCol
                '2016/04/05 Ishiga add end---------------------
            Else
                '4週画面表示中の場合
                w_Int = 2

                '2016/04/05 Ishiga add start-------------------
                Get_Col_4W(m_KeikakuKikan.StartDate, w_StCol)
                Get_Col_4W(m_KeikakuKikan.EndDate, w_EdCol)
                '2016/04/05 Ishiga add end---------------------
            End If

            With m_Spread(w_Int).Sheets(0)

                '2016/04/05 Ishiga upd start------------------------------------------------------------------------------------------------------------------------
                '.CopyRange(p_Row, p_Col, m_UndoArea.StartRow + p_Row - m_StaffRow.StartRow, p_Col, p_Row2 - p_Row + 1, p_Col2 - p_Col + 1, False)

                ''-- 現在のﾃﾞｰﾀを 退避 -------
                ''Undo格納配列定義
                'ReDim Preserve m_UndoData(UBound(m_UndoData) + 1)
                'w_Index = UBound(m_UndoData)

                ''現在のﾃﾞｰﾀ領域 退避開始位置 設定
                'm_UndoData(w_Index).MotoStartCol = p_Col
                'm_UndoData(w_Index).MotoStartRow = p_Row
                'm_UndoData(w_Index).MotoEndCol = p_Col2
                'm_UndoData(w_Index).MotoEndRow = p_Row2

                ''ｺﾋﾟｰ先位置退避
                'm_UndoData(w_Index).StartCol = p_Col
                'm_UndoData(w_Index).StartRow = m_UndoArea.StartRow + p_Row - m_StaffRow.StartRow
                'm_UndoData(w_Index).EndCol = p_Col2
                'm_UndoData(w_Index).EndRow = m_UndoArea.StartRow + p_Row2 - m_StaffRow.StartRow


                If m_UndoIdxHendou > m_UndoMaxKensu Then
                    m_UndoIdxHendou = m_UndoIdxHendou Mod m_UndoMaxKensu
                    If m_UndoIdxHendou = 0 Then
                        m_UndoIdxHendou = 1
                    End If
                End If

                '.CopyRange(p_Row, p_Col, m_UndoArea(m_UndoIdxHendou).StartRow + p_Row - m_StaffRow.StartRow, p_Col, p_Row2 - p_Row + 1, p_Col2 - p_Col + 1, False)
                .CopyRange(m_StaffRow.StartRow, w_StCol, m_UndoArea(m_UndoIdxHendou).StartRow,
                           w_StCol, (m_StaffRow.EndRow - m_StaffRow.StartRow) + 1, (w_EdCol - w_StCol) + 1, False)
                '2016/04/05 Ishiga upd end--------------------------------------------------------------------------------------------------------------------------

            End With
            '2016/04/06 Yamanishi Add ----------------------------------------------------------------------
            '控除データを全員分退避させる
            w_Cnt = 0
            ReDim m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt)
            For i As Integer = 1 To UBound(m_StaffData)
                If UBound(m_StaffData(i).Kojyo) > 0 Then
                    w_Cnt += 1
                    ReDim Preserve m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt)
                    m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt).StaffMngID = m_StaffData(i).ID
                    m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt).Data = General.paDeepCopy(m_StaffData(i).Kojyo)
                End If
            Next i
            '代休データを全員分退避させる
            If General.g_lngDaikyuMng = 0 Then
                w_Cnt = 0
                ReDim m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt)
                For i As Integer = 1 To UBound(m_StaffData)
                    If UBound(m_StaffData(i).Daikyu) > 0 Then
                        w_Cnt += 1
                        ReDim Preserve m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt)
                        m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt).StaffMngID = m_StaffData(i).ID
                        m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt).Data = General.paDeepCopy(m_StaffData(i).Daikyu)
                    End If
                Next i
            End If
            '-----------------------------------------------------------------------------------------------
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
    '   'Undo代休データ制御
    '   'p_Mode --- 0:代休データ退避 1:退避データを格納
    'Private Sub Set_UndoDaikyuData(ByVal p_Mode As Integer)

    '	Const W_SUBNAME As String = "NSK0000HA Set_UndoDaikyuData"

    '	Dim w_Int As Integer
    '	Dim w_Int2 As Integer
    '	Dim w_Cnt As Integer
    '       Try
    '           If p_Mode = 0 Then
    '               For w_Int = 1 To UBound(m_StaffData)
    '                   If m_StaffData(w_Int).OuenStaffFlg = 0 Then
    '                       '代休データ退避用配列確保
    '                       w_Cnt = UBound(m_StaffData(w_Int).Daikyu)
    '                       ReDim m_StaffData(w_Int).BackDaikyu(w_Cnt)

    '                       For w_Int2 = 1 To w_Cnt
    '                           m_StaffData(w_Int).BackDaikyu(w_Int2) = m_StaffData(w_Int).Daikyu(w_Int2)
    '                       Next w_Int2
    '                   End If
    '               Next w_Int
    '           ElseIf p_Mode = 1 Then
    '               For w_Int = 1 To UBound(m_StaffData)
    '                   If m_StaffData(w_Int).OuenStaffFlg = 0 Then
    '                       '代休データ退避用配列確保
    '                       w_Cnt = UBound(m_StaffData(w_Int).BackDaikyu)
    '                       ReDim m_StaffData(w_Int).Daikyu(w_Cnt)

    '                       For w_Int2 = 1 To w_Cnt
    '                           m_StaffData(w_Int).Daikyu(w_Int2) = m_StaffData(w_Int).BackDaikyu(w_Int2)
    '                       Next w_Int2
    '                   End If
    '               Next w_Int
    '           End If

    '   	Catch ex As Exception
    '           Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
    '           End
    '       End Try
    '   End Sub
    '----------------------------------------------------------------------------------------------------
    '貼り付け
    Private Sub PasteData()

        Const W_SUBNAME As String = "NSK0000HA PasteData"

        Dim w_Int As Integer
        'ｺﾋﾟｰのﾃﾞｰﾀ形式ﾌﾗｸﾞ
        Dim w_CopyData_SelFlg As Integer
        'ﾍﾟｰｽﾄ先の選択形式ﾌﾗｸﾞ
        Dim w_PasteData_SelFlg As Integer
        Dim w_CellRange() As Model.CellRange

        'ｺﾋﾟｰのﾃﾞｰﾀ形式ﾌﾗｸﾞ 定数
        Const W_COPYDATA_ONECELL As Integer = 1
        Const W_COPYDATA_CELLBLOCK As Integer = 2
        '元のﾃﾞｰﾀ形式ﾌﾗｸﾞ 定数
        Const W_PASTEDATA_ONECELL As Integer = 1
        Const W_PASTEDATA_ONECELLBLOCK As Integer = 2
        Const W_PASTEDATA_CELLBLOCK As Integer = 3
        Try
            '貼り付け中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_PASTE_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ヶ月表示
                w_Int = 1
            Else
                '４週表示(配列Index)
                w_Int = 2
            End If

            With m_Spread(w_Int).Sheets(0)

                '元ﾃﾞｰﾀの形式
                If m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.StartRow = m_CopyData.EndRow Then
                    '1ｾﾙ の場合
                    w_CopyData_SelFlg = W_COPYDATA_ONECELL
                Else
                    'ｾﾙﾌﾞﾛｯｸ の場合
                    w_CopyData_SelFlg = W_COPYDATA_CELLBLOCK
                End If

                w_CellRange = .GetSelections

                If w_CellRange.Length = 0 OrElse (w_CellRange.Length = 1 AndAlso w_CellRange(0).RowCount = 1 AndAlso w_CellRange(0).ColumnCount = 1) Then
                    '1ｾﾙ 選択状態の場合
                    w_PasteData_SelFlg = W_PASTEDATA_ONECELL
                ElseIf w_CellRange.Length = 1 Then
                    '1ｾﾙﾌﾞﾛｯｸ 選択状態の場合
                    w_PasteData_SelFlg = W_PASTEDATA_ONECELLBLOCK
                Else
                    'ﾏﾙﾁｾﾙﾌﾞﾛｯｸ 選択状態の場合
                    w_PasteData_SelFlg = W_PASTEDATA_CELLBLOCK
                End If

                '元ﾃﾞｰﾀの形式
                Select Case w_CopyData_SelFlg
                    Case W_COPYDATA_ONECELL
                        '元ﾃﾞｰﾀの形式 1ｾﾙ の場合
                        '選択状態
                        Select Case w_PasteData_SelFlg
                            Case W_PASTEDATA_ONECELL
                                '1ｾﾙ 選択状態の場合

                                Call PasteData_OneSel()

                            Case W_PASTEDATA_ONECELLBLOCK
                                '1ﾌﾞﾛｯｸ 選択状態の場合

                                Call PasteData_MultiSel()

                            Case W_PASTEDATA_CELLBLOCK

                                'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ﾍﾟｰｽﾄ 実行
                                Call PasteData_MultiSel()

                            Case Else
                        End Select

                    Case W_COPYDATA_CELLBLOCK
                        '元ﾃﾞｰﾀの形式 ｾﾙﾌﾞﾛｯｸ の場合
                        '選択状態
                        Select Case w_PasteData_SelFlg
                            Case W_PASTEDATA_ONECELL
                                '1ｾﾙ 選択状態の場合

                                Call PasteData_OneSel()

                            Case W_PASTEDATA_ONECELLBLOCK
                                '1ｾﾙﾌﾞﾛｯｸ 選択状態の場合

                                Call PasteData_MultiSel()

                            Case W_PASTEDATA_CELLBLOCK
                                'ﾏﾙﾁｾﾙﾌﾞﾛｯｸ 選択状態の場合

                                Call PasteData_MultiSel()

                            Case Else
                        End Select
                    Case Else
                End Select
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '消去
    Private Sub DeleteData()

        Const W_SUBNAME As String = "NSK0000HA DeleteData"

        Dim w_Int As Integer
        Dim w_CellRange() As Model.CellRange
        Try
            '消去中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_DELTE_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                w_Int = 1
            Else
                w_Int = 2
            End If

            With m_Spread(w_Int).Sheets(0)

                '選択されているｾﾙﾌﾞﾛｯｸを取得
                w_CellRange = .GetSelections

                '連続したｾﾙﾌﾟﾛｯｸか？
                If w_CellRange.Length <= 1 Then
                    '1ｾﾙ  or 1ｾﾙﾌﾞﾛｯｸ 選択状態の場合
                    Call DeleteData_OneSel()
                Else
                    Call DeleteData_MultiSel()
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '消去
    Private Sub DeleteData_MultiSel()

        Const W_SUBNAME As String = "NSK0000HA DeleteData_MultiSel"

        Dim w_Col As Integer
        Dim w_Col_4W As Integer
        Dim w_Col_M As Integer
        Dim w_Row As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_Int As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Bool As Boolean
        Dim w_KikanStartCol As Integer
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_CellRange() As Model.CellRange
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        ''UndoData用配列　定義
        ''2016/04/05 Ishiga upd start----------------
        ''ReDim m_UndoData(0)
        'm_UndoKaisu = m_UndoKaisu + 1
        'If m_UndoMaxKensu < m_UndoKaisu Then
        '    m_UndoKaisu = m_UndoMaxKensu
        'End If

        'm_UndoIdx = m_UndoIdx + 1
        'm_UndoIdxHendou = m_UndoIdxHendou + 1
        ''2016/04/05 Ishiga upd end------------------
        '----------------------------------------------------------------------------------------------------
        Try
            'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

            If m_SelViewKikan = 0 Then
                With sprSheet_M.Sheets(0)

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    w_CellRange = .GetSelections

                    '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                    For w_Int = 0 To w_CellRange.Length - 1

                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        If w_EndRow > m_StaffRow.EndRow Then
                            w_EndRow = m_StaffRow.EndRow
                        End If

                        '編集可能ｾﾙ範囲 ﾁｪｯｸ
                        'ﾃﾞｰﾀ行 範囲内か ?
                        If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '計画ﾃﾞｰﾀ列 範囲内か ?
                        If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_EndCol <= m_KeikakuKikan.KinmuDataEndCol)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ削除

                                '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = -1
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If IsNumeric(w_Var) = True Then
                                    'ｲﾝﾃﾞｯｸｽ取得
                                    w_StaffIdx = Integer.Parse(w_Var)
                                End If

                                For w_Col = w_StartCol To w_EndCol
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                    w_Cnt = -1
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_Var, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            End If
                                        End If
                                    End If

                                    If w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀの場合
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    ElseIf w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = False Then
                                        '再掲部署以外の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            'ERROR
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                    '#001-----St
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        '届出使用時は届出があれば切り取り不可
                                        With General.g_objSyouninData
                                            .mKC_UNIQUESEQNO = ""
                                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                            .mKC_TargetDate = w_CurrentDate

                                            If .mChkKinmuChange = False Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "届出申請済み勤務を"
                                                Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End With
                                    End If
                                    '#001-----Ed
                                    If General.g_lngDaikyuMng = 0 Then
                                        '代休ﾁｪｯｸ
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            Exit Sub
                                        End If
                                    End If

                                    'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                    '控除データを削除
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If

                                    '配列番号 取得
                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If IsNumeric(w_Var) = True Then
                                        w_strKojyoData = ""
                                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                            If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                                                '配列初期化
                                                m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).init()

                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    Next w_Int

                    For w_Int = 0 To w_CellRange.Length - 1

                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '-- 現在選択中のｾﾙ消去 ---
                        If m_MaxShowLine > 1 Then
                            For w_Row = w_StartRow To w_EndRow
                                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ切り取り
                                    .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                                End If
                            Next w_Row
                        Else
                            .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                        End If

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合

                            For w_Row = w_StartRow To w_EndRow
                                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ切り取り
                                    For w_Col = w_StartCol To w_EndCol
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                            sprSheet_4W.Sheets(0).ClearRange(w_StartRow, w_Col_4W, 1, 1, False)
                                        End If
                                    Next w_Col
                                End If
                            Next w_Row
                        End If
                    Next w_Int
                End With
            Else
                '4週画面表示中の場合

                With sprSheet_4W.Sheets(0)

                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
                    m_CopyData.StartCol = 0
                    m_CopyData.StartRow = 0
                    m_CopyData.EndCol = 0
                    m_CopyData.EndRow = 0

                    w_CellRange = .GetSelections

                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                            '勤務ﾃﾞｰﾀ開始列格納
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                                Exit Sub
                            End If
                        Else
                            '勤務ﾃﾞｰﾀ開始列格納
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If

                        'ﾃﾞｰﾀ行 範囲内か ?
                        If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '計画ﾃﾞｰﾀ列 範囲内か ?
                        If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ削除

                                '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = -1
                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If IsNumeric(w_Var) = True Then
                                    'ｲﾝﾃﾞｯｸｽ取得
                                    w_StaffIdx = Integer.Parse(w_Var)
                                End If

                                For w_Col = w_StartCol To w_EndCol
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務を"
                                        Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    '勤務ﾃﾞｰﾀ格納ｲﾝﾃﾞｯｸｽ取得（4週/1ｹ月）
                                    '4週/1ｹ月の場合
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If

                                    If w_StaffIdx <> -1 AndAlso g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀの場合
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    ElseIf w_StaffIdx <> -1 AndAlso g_SaikeiFlg = False Then
                                        '再掲部署以外の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            'ERROR
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務を"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                    '#001-----St
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        '届出使用時は届出があれば切り取り不可
                                        With General.g_objSyouninData
                                            .mKC_UNIQUESEQNO = ""
                                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                            .mKC_TargetDate = w_CurrentDate

                                            If .mChkKinmuChange = False Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "届出申請済み勤務を"
                                                Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End With
                                    End If
                                    '#001-----Ed
                                    If General.g_lngDaikyuMng = 0 Then
                                        '代休ﾁｪｯｸ
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_DELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            Exit Sub
                                        End If
                                    End If

                                    'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                    '控除データを削除
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If

                                    '配列番号 取得
                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If IsNumeric(w_Var) = True Then
                                        w_strKojyoData = ""
                                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_Var)).Kojyo)
                                            If m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                                                '配列初期化
                                                m_StaffData(Integer.Parse(w_Var)).Kojyo(w_lngKojyoLoop).init()

                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    Next w_Int

                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '-- 現在選択中のｾﾙ消去 ---
                        If m_MaxShowLine > 1 Then
                            For w_Row = w_StartRow To w_EndRow
                                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ切り取り
                                    .ClearRange(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1, False)
                                End If
                            Next w_Row
                        Else
                            .ClearRange(w_StartRow, w_StartCol, w_EndRow - w_StartRow + 1, w_EndCol - w_StartCol + 1, False)
                        End If

                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ切り取り
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    '1ヶ月用列番号取得
                                    If Get_Col_M(w_Var, w_Col_M) = True Then
                                        sprSheet_M.Sheets(0).ClearRange(w_StartRow, w_Col_M, 1, 1, False)
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    Next w_Int
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '貼り付け
    Private Sub PasteData_MultiSel()

        Const W_SUBNAME As String = "NSK0000HA PasteData_MultiSel"

        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Col_4W As Integer
        Dim w_Col_M As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_StartCol2 As Integer
        Dim w_EndCol2 As Integer
        Dim w_StartRow2 As Integer
        Dim w_EndRow2 As Integer
        Dim w_KikanStartCol As Integer
        Dim w_Int As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Text As Object
        Dim w_Bool As Boolean
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_RowMultiColFlg As Boolean
        Dim w_ColMultiRowFlg As Boolean
        Dim w_Start As Integer
        Dim w_End As Integer
        Dim w_Lng As Integer
        Dim w_CurrentDate As Integer
        Dim w_ColCnt As Integer
        Dim w_RowCnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_CellSizeCol As Integer
        Dim w_CellSizeRow As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_YYYYMMDD As Object
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_KibouCnt As Integer
        Dim w_IntCol As Integer
        Dim w_IntRow As Integer
        Dim w_StaffRow() As KibouKinmu_Type
        Dim w_DataCnt As Integer
        Dim w_DataLoop As Integer
        Dim w_StaffRowChk As Boolean
        Dim w_blnColChk As Boolean
        Dim w_KibouChk As Boolean
        Dim w_CellRange() As Model.CellRange
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_KibouCntDate As Integer
        Dim w_blnColChkDate As Boolean
        '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

        'スタッフ行情報配列初期化
        w_DataCnt = 0
        ReDim w_StaffRow(0)
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        ''UndoData用配列初期化
        ''2016/04/05 Ishiga upd start-----------------
        ''ReDim m_UndoData(0)
        'm_UndoKaisu = m_UndoKaisu + 1
        'If m_UndoMaxKensu < m_UndoKaisu Then
        '    m_UndoKaisu = m_UndoMaxKensu
        'End If

        'm_UndoIdx = m_UndoIdx + 1
        'm_UndoIdxHendou = m_UndoIdxHendou + 1
        ''2016/04/05 Ishiga upd end-------------------
        ''ReDim m_KojyoUndoData(0)
        '----------------------------------------------------------------------------------------------------
        Try
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                With sprSheet_M.Sheets(0)

                    If g_HopeNumFlg = "1" Then
                        'ｺﾋﾟｰ元の勤務に希望勤務があるかどうか？
                        w_KibouChk = False
                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                    If ColorTranslator.ToOle(.Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                        '希望勤務あり
                                        w_KibouChk = True
                                        Exit For
                                    End If
                                Next w_IntCol
                            End If
                            If w_KibouChk = True Then Exit For
                        Next w_IntRow

                        If g_HopeNum = 0 AndAlso w_KibouChk = True Then
                            '希望勤務入力が不可のためｴﾗｰ
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "希望勤務入力が不可のため"
                            '「&1コピーできません。」
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If

                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    If g_HopeNumDateFlg = "1" Then
                        'ｺﾋﾟｰ元の勤務に希望勤務があるかどうか？
                        w_KibouChk = False
                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                    If ColorTranslator.ToOle(.Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                        '希望勤務あり
                                        w_KibouChk = True
                                        Exit For
                                    End If
                                Next w_IntCol
                            End If
                            If w_KibouChk = True Then Exit For
                        Next w_IntRow

                        If g_HopeNumDate = 0 AndAlso w_KibouChk = True Then
                            '希望勤務入力が不可のためｴﾗｰ
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "希望勤務(日付別)入力が不可のため"
                            '「&1コピーできません。」
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                    w_CellRange = .GetSelections

                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        '元ﾃﾞｰﾀの大きさ
                        w_StartCol2 = w_StartCol
                        w_StartRow2 = w_StartRow
                        w_EndCol2 = w_StartCol2 + (m_CopyData.EndCol - m_CopyData.StartCol)
                        w_EndRow2 = w_StartRow2 + (m_CopyData.EndRow - m_CopyData.StartRow)

                        '編集可能ｾﾙ範囲 ﾁｪｯｸ
                        'ﾃﾞｰﾀ行 範囲内か ?
                        If Not ((m_StaffRow.StartRow <= w_StartRow2) AndAlso (w_EndRow2 <= m_StaffRow.EndRow)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '計画ﾃﾞｰﾀ列 範囲内か ?
                        If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol2) AndAlso (w_EndCol2 <= m_KeikakuKikan.KinmuDataEndCol)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow2 To w_EndRow2
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け

                                If g_HopeNumFlg = "1" AndAlso g_HopeNum > 0 Then
                                    'スタッフ行を取得
                                    w_StaffRowChk = False
                                    For w_DataLoop = 1 To UBound(w_StaffRow)
                                        If w_StaffRow(w_DataLoop).StaffRow = w_Row Then
                                            w_StaffRowChk = True
                                        End If
                                    Next w_DataLoop

                                    If w_StaffRowChk = False Then
                                        w_DataCnt = w_DataCnt + 1
                                        ReDim Preserve w_StaffRow(w_DataCnt)
                                        w_StaffRow(w_DataCnt).StaffRow = w_Row

                                        '変更前希望勤務回数取得
                                        '該当職員のｺﾋﾟｰ先範囲外の希望勤務回数をｶｳﾝﾄする
                                        w_KibouCnt = 0

                                        For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                                w_KibouCnt = w_KibouCnt + 1
                                            End If
                                        Next w_IntCol

                                        w_StaffRow(w_DataCnt).KibouCnt = w_KibouCnt
                                    End If
                                End If

                                For w_Col = w_StartCol2 To w_EndCol2
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        '勤務変更
                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var = "" Then
                                            '勤務記号がないとき
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    If g_SaikeiFlg = True Then
                                        '再掲部署の場合で実績ﾃﾞｰﾀは貼り付け不可
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                '1ｹ月/1ｹ月,4週/4週の場合
                                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                w_Cnt = w_Col - w_KeikakuCol + 1
                                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                '4週/1ｹ月の場合
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                End If

                                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                Else
                                                    w_Cnt = 0
                                                End If
                                            End If

                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            End If
                        Next w_Row

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け
                                For w_Col = w_StartCol To w_EndCol
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        '勤務変更
                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var = "" Then
                                            '勤務記号がないとき
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var)

                                        '再掲部署の場合で実績ﾃﾞｰﾀは貼り付け不可
                                        If g_SaikeiFlg = True Then
                                            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                '1ｹ月/1ｹ月,4週/4週の場合
                                                w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                w_Cnt = w_Col - w_KeikakuCol + 1
                                            ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                '4週/1ｹ月の場合
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                End If

                                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                Else
                                                    w_Cnt = 0
                                                End If
                                            End If

                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If

                                        '日付を取得
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_YYYYMMDD = w_Var

                                            If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                '届出のコンポーネントありの時
                                                w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                                                w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                                If w_Var <> "" Then
                                                    Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                    With General.g_objSyouninData
                                                        .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                        .mKC_TargetDate = w_YYYYMMDD

                                                        If .mChkKinmuChange = False Then
                                                            '勤務変更不可
                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                            ReDim w_strMsg(1)
                                                            w_strMsg(1) = ""
                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                            '************************************************
                                                            Exit Sub
                                                        End If
                                                    End With
                                                End If
                                            End If
                                        End If
                                    End If

                                    '休日・代休には貼り付けれないようにする
                                    If General.g_lngDaikyuMng = 0 Then
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsNumeric(w_Var) = True Then
                                            If InStr(m_HolDateStr, Convert.ToString(Integer.Parse(w_Var))) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 7) Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "休日に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                            Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                            '2015/04/10 Bando Upd End   =========================================

                                            If w_KinmuCD <> "" Then
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "代休に"
                                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            End If
                        Next w_Row

                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                        w_ColCnt = 0
                        w_RowCnt = 0
                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け
                                For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var = "" Then
                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                            '1ｹ月/1ｹ月,4週/4週の場合
                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                            w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                            '4週/1ｹ月の場合
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If

                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                        End If

                                        '配列番号 取得
                                        w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            '職員管理番号 取得
                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    w_ColCnt = w_ColCnt + 1
                                Next w_Col
                            End If

                            w_ColCnt = 0
                            w_RowCnt = w_RowCnt + 1
                        Next w_Row

                        If m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.StartRow = m_CopyData.EndRow Then
                            '元ﾃﾞｰﾀの形式が1ｾﾙ の場合
                            If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                '日当直のコンポーネントありの時
                                w_Var = .GetText(m_CopyData.StartRow, m_CopyData.StartCol)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start =========================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                    '2015/04/10 Bando Upd End   =========================================
                                End If

                                For w_Row = w_StartRow To w_EndRow
                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け

                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)

                                            For w_Col = w_StartCol To w_EndCol
                                                '日付を取得
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_YYYYMMDD = w_Var

                                                    With General.g_objGetData
                                                        .p職員区分 = 0
                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                        .pチェック基準日 = w_YYYYMMDD
                                                        .p処理区分 = 0
                                                        .pチェック勤務CD = w_KinmuCD

                                                        If .mChkKinmuDuty = False Then
                                                            '勤務変更不可
                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                            ReDim w_strMsg(1)
                                                            w_strMsg(1) = ""
                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                            '************************************************
                                                            Exit Sub
                                                        End If
                                                    End With
                                                End If
                                            Next w_Col
                                        End If
                                    End If
                                Next w_Row
                            End If
                        Else
                            If w_StartCol = w_EndCol AndAlso w_StartRow = w_EndRow Then
                                '選択ｾﾙが1ｾﾙの場合
                            Else
                                'ｺﾋﾟｰﾃﾞｰﾀと同じ大きさか？
                                If Not (m_CopyData.EndCol - m_CopyData.StartCol = w_EndCol - w_StartCol AndAlso m_CopyData.EndRow - m_CopyData.StartRow = w_EndRow - w_StartRow) Then

                                    If m_CopyData.StartRow = m_CopyData.EndRow AndAlso m_CopyData.EndCol - m_CopyData.StartCol = w_EndCol - w_StartCol Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                                        w_ColCnt = 0
                                        For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                            w_Var = .GetText(m_CopyData.StartRow, w_Col)
                                            If w_Var <> "" Then
                                                For w_Row = w_StartRow To w_EndRow
                                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                        '勤務のみ貼り付け
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)

                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                            End If

                                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If

                                                        '配列番号 取得
                                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                        If IsNumeric(w_Var) = True Then
                                                            '職員管理番号 取得
                                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                                ReDim w_strMsg(1)
                                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                                Exit Sub
                                                            End If
                                                        End If
                                                    End If
                                                Next w_Row
                                            Else
                                                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                    '日当直のコンポーネントありの時
                                                    '2015/04/10 Bando Upd Start =========================================
                                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                    Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                    '2015/04/10 Bando Upd End   =========================================
                                                    w_Col2 = w_Col - m_CopyData.StartCol + w_StartCol

                                                    '日付を取得
                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col2)
                                                    If w_Var <> "" Then
                                                        w_YYYYMMDD = w_Var

                                                        For w_Row = w_StartRow To w_EndRow
                                                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                                '勤務のみ貼り付け

                                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                                If IsNumeric(w_Var) = True Then
                                                                    w_StaffIdx = Integer.Parse(w_Var)

                                                                    With General.g_objGetData
                                                                        .p職員区分 = 0
                                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                        .pチェック基準日 = w_YYYYMMDD
                                                                        .p処理区分 = 0
                                                                        .pチェック勤務CD = w_KinmuCD

                                                                        If .mChkKinmuDuty = False Then
                                                                            '勤務変更不可
                                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                                            ReDim w_strMsg(1)
                                                                            w_strMsg(1) = ""
                                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                            '************************************************
                                                                            Exit Sub
                                                                        End If
                                                                    End With
                                                                End If
                                                            End If
                                                        Next w_Row
                                                    End If
                                                End If
                                            End If

                                            w_ColCnt = w_ColCnt + 1
                                        Next w_Col

                                        w_RowMultiColFlg = True
                                    ElseIf m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.EndRow - m_CopyData.StartRow = w_EndRow - w_StartRow Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                                        w_RowCnt = 0
                                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け
                                                w_Var = .GetText(w_Row, m_CopyData.StartCol)
                                                If w_Var = "" Then
                                                    For w_Col = w_StartCol To w_EndCol
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_StartCol - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                            End If

                                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If

                                                        '配列番号 取得
                                                        w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                        If IsNumeric(w_Var) = True Then
                                                            '職員管理番号 取得
                                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                                ReDim w_strMsg(1)
                                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                                Exit Sub
                                                            End If
                                                        End If
                                                    Next w_Col
                                                Else
                                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                        '日当直のコンポーネントありの時
                                                        '2015/04/10 Bando Upd Start =========================================
                                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                        Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                        '2015/04/10 Bando Upd End   =========================================
                                                        w_Row2 = w_Row - m_CopyData.StartRow + w_StartRow

                                                        w_Var = .GetText(w_Row2, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                        If IsNumeric(w_Var) = True Then
                                                            w_StaffIdx = Integer.Parse(w_Var)

                                                            For w_Col = w_StartCol To w_EndCol
                                                                '日付を取得
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var <> "" Then
                                                                    w_YYYYMMDD = w_Var

                                                                    With General.g_objGetData
                                                                        .p職員区分 = 0
                                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                        .pチェック基準日 = w_YYYYMMDD
                                                                        .p処理区分 = 0
                                                                        .pチェック勤務CD = w_KinmuCD

                                                                        If .mChkKinmuDuty = False Then
                                                                            '勤務変更不可
                                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                                            ReDim w_strMsg(1)
                                                                            w_strMsg(1) = ""
                                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                            '************************************************
                                                                            Exit Sub
                                                                        End If
                                                                    End With
                                                                End If
                                                            Next w_Col
                                                        End If
                                                    End If
                                                End If
                                            End If
                                            w_RowCnt = w_RowCnt + 1
                                        Next w_Row

                                        w_ColMultiRowFlg = True
                                    Else
                                        'ERROR
                                        w_CellSizeCol = m_CopyData.EndCol - m_CopyData.StartCol + 1
                                        w_CellSizeRow = m_CopyData.EndRow - m_CopyData.StartRow + 1
                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = Convert.ToString(w_CellSizeRow)
                                        w_strMsg(2) = Convert.ToString(w_CellSizeCol)
                                        Call Set_MsgZOrder("NS0108", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If
                                Else
                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                        '日当直のコンポーネントありの時
                                        For w_Row = w_StartRow To w_EndRow
                                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け

                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                If IsNumeric(w_Var) = True Then
                                                    w_StaffIdx = Integer.Parse(w_Var)

                                                    For w_Col = w_StartCol To w_EndCol
                                                        '日付を取得
                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var <> "" Then
                                                            w_YYYYMMDD = w_Var

                                                            w_Col2 = w_Col - w_StartCol + m_CopyData.StartCol
                                                            w_Row2 = w_Row - w_StartRow + m_CopyData.StartRow

                                                            w_Var = .GetText(w_Row2, w_Col2)
                                                            If w_Var <> "" Then
                                                                '2015/04/10 Bando Upd Start =========================================
                                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                                '2015/04/10 Bando Upd End   =========================================
                                                            End If

                                                            With General.g_objGetData
                                                                .p職員区分 = 0
                                                                .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                .pチェック基準日 = w_YYYYMMDD
                                                                .p処理区分 = 0
                                                                .pチェック勤務CD = w_KinmuCD

                                                                If .mChkKinmuDuty = False Then
                                                                    '勤務変更不可
                                                                    '*******ﾒｯｾｰｼﾞ***********************************
                                                                    ReDim w_strMsg(1)
                                                                    w_strMsg(1) = ""
                                                                    Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                    '************************************************
                                                                    Exit Sub
                                                                End If
                                                            End With
                                                        End If
                                                    Next w_Col
                                                End If
                                            End If
                                        Next w_Row
                                    End If
                                End If
                            End If
                        End If
                    Next w_Int
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''代休データを退避
                    'If General.g_lngDaikyuMng = 0 Then
                    '    Call Set_UndoDaikyuData(0)
                    'End If
                    '----------------------------------------------------------------------------------------------------
                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        '元ﾃﾞｰﾀの大きさ
                        w_StartCol2 = w_StartCol
                        w_StartRow2 = w_StartRow
                        w_EndCol2 = w_StartCol2 + (m_CopyData.EndCol - m_CopyData.StartCol)
                        w_EndRow2 = w_StartRow2 + (m_CopyData.EndRow - m_CopyData.StartRow)

                        w_Cnt = 0
                        'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

                        '控除を取得している場合削除する
                        For w_Row = w_StartRow To w_EndRow
                            For w_Col = w_StartCol To w_EndCol
                                If m_CopyData.StartCol = m_CopyData.EndCol Then
                                    w_Cnt = w_Row - w_StartRow + 1
                                Else
                                    w_Cnt = w_Cnt + 1
                                End If

                                If w_Cnt > UBound(m_KojyoCopyData) Then
                                    w_Cnt = 1
                                End If

                                'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    w_CurrentDate = Integer.Parse(w_Var)
                                    For w_Lng = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate Then

                                            'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_Lng) '2016/04/06 Yamanishi Del
                                            m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoCopyData(w_Cnt)
                                            m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate

                                            Exit For
                                        End If
                                    Next

                                    If w_Lng > UBound(m_StaffData(w_StaffIdx).Kojyo) AndAlso m_KojyoCopyData(w_Cnt).lngDate <> 0 Then
                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Lng)

                                        m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoCopyData(w_Cnt)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate
                                    End If
                                End If
                            Next w_Col
                        Next w_Row

                        '元ﾃﾞｰﾀの形式
                        If m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.StartRow = m_CopyData.EndRow Then
                            '1ｾﾙ の場合
                            For w_Row = w_StartRow To w_EndRow
                                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ貼り付け
                                    For w_Col = w_StartCol To w_EndCol

                                        'UndoData格納
                                        'Call Set_UndoData(w_Col, w_Row, w_Col, w_Row) '2016/04/05 Ishiga del

                                        '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                                        .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_Row, w_Col, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                            '4週/1ｹ月の場合

                                            w_Var = .GetText(w_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_Bool = True
                                            Else
                                                w_Bool = False
                                            End If

                                            w_Text = w_Var

                                            '勤務変更の場合
                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                If IsNumeric(w_Var) = True Then
                                                    w_StaffIdx = Integer.Parse(w_Var)
                                                    '4週/1ｹ月の場合
                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                    If w_Var <> "" Then
                                                        w_CurrentDate = Integer.Parse(w_Var)
                                                    End If

                                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                    Else
                                                        w_Cnt = 0
                                                    End If

                                                    If w_Var <= m_KeikakuKikan.EndDate Then
                                                        '2015/04/10 Bando Upd Start =========================================
                                                        'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                        Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                        '2015/04/10 Bando Upd End   =========================================
                                                        If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse w_RiyuKBN <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN OrElse w_KangoCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).OuenKangoCD Then
                                                            '勤務CDが予定と異なる場合
                                                            .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                                        End If
                                                    Else
                                                        '勤務CDが予定と同じ場合
                                                        '通常
                                                        .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                        .Cells(w_Row, w_Col).BackColor = Color.White
                                                    End If
                                                End If
                                            End If

                                            w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                            w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                                sprSheet_4W.Sheets(0).SetText(w_Row, w_Col_4W, w_Text)
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).BackColor = ColorTranslator.FromOle(w_BackColor)
                                            End If
                                        End If
                                    Next w_Col
                                End If
                            Next w_Row
                        Else
                            '1ﾌﾞﾛｯｸの場合

                            If w_RowMultiColFlg = True Then
                                'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき
                                w_Start = w_StartRow
                                w_End = w_EndRow
                            ElseIf w_ColMultiRowFlg = True Then
                                'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき
                                w_Start = w_StartCol
                                w_End = w_EndCol
                            Else
                                w_Start = 0
                                w_End = 0
                            End If

                            For w_Lng = w_Start To w_End
                                If w_RowMultiColFlg = True Then
                                    'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                    If ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If
                                Else
                                    w_Bool = True
                                End If

                                If w_Bool = True Then
                                    If w_RowMultiColFlg = True Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                        'UndoData格納
                                        'Call Set_UndoData(w_StartCol, w_Lng, w_EndCol, w_Lng) '2016/04/05 Ishiga del

                                    ElseIf w_ColMultiRowFlg = True Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                        'UndoData格納
                                        'Call Set_UndoData(w_Lng, w_StartRow, w_Lng, w_EndRow) '2016/04/05 Ishiga del
                                    Else
                                        If w_StartCol = w_EndCol AndAlso w_StartRow = w_EndRow Then
                                            '選択ｾﾙが1ｾﾙの場合
                                            'UndoData格納
                                            'Call Set_UndoData(w_StartCol2, w_StartRow2, w_EndCol2, w_EndRow2) '2016/04/05 Ishiga del
                                        Else
                                            'UndoData格納
                                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del
                                        End If
                                    End If

                                    '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                                    If m_MaxShowLine > 1 Then
                                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け

                                                If w_RowMultiColFlg = True Then
                                                    'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_Lng, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                ElseIf w_ColMultiRowFlg = True Then
                                                    'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_Lng, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                Else
                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                End If
                                            End If
                                        Next w_Row
                                    Else
                                        If w_RowMultiColFlg = True Then
                                            'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_Lng, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        ElseIf w_ColMultiRowFlg = True Then
                                            'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_Lng, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        Else
                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        End If
                                    End If
                                End If
                            Next w_Lng

                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合
                                If w_RowMultiColFlg = True OrElse w_ColMultiRowFlg = True Then
                                    'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき
                                    'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                    For w_Row = w_StartRow To w_EndRow
                                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                            '勤務のみ貼り付け
                                            For w_Col = w_StartCol To w_EndCol

                                                w_Var = .GetText(w_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_Bool = True
                                                Else
                                                    w_Bool = False
                                                End If

                                                w_Text = w_Var

                                                '勤務変更の場合
                                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                    '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                    If IsNumeric(w_Var) = True Then
                                                        w_StaffIdx = Integer.Parse(w_Var)
                                                        '4週/1ｹ月の場合
                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var <> "" Then
                                                            w_CurrentDate = Integer.Parse(w_Var)
                                                        End If
                                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                        Else
                                                            w_Cnt = 0
                                                        End If

                                                        If w_Var <= m_KeikakuKikan.EndDate Then
                                                            '2015/04/10 Bando Upd Start =========================================
                                                            'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                            Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                            '2015/04/10 Bando Upd End   =========================================
                                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                '勤務CDが予定と異なる場合
                                                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                                .Cells(w_Row, w_Col).BackColor = Color.White
                                                            End If
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                                        End If
                                                    End If
                                                End If

                                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                                    sprSheet_4W.Sheets(0).SetText(w_Row, w_Col_4W, w_Text)
                                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                End If
                                            Next w_Col
                                        End If
                                    Next w_Row
                                Else
                                    For w_Row = w_StartRow2 To w_EndRow2
                                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                            '勤務のみ貼り付け
                                            For w_Col = w_StartCol2 To w_EndCol2

                                                w_Var = .GetText(w_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_Bool = True
                                                Else
                                                    w_Bool = False
                                                End If

                                                w_Text = w_Var

                                                '勤務変更の場合
                                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                    '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                                    If IsNumeric(w_Var) = True Then
                                                        w_StaffIdx = Integer.Parse(w_Var)
                                                        '4週/1ｹ月の場合
                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var <> "" Then
                                                            w_CurrentDate = Integer.Parse(w_Var)
                                                        End If

                                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                        Else
                                                            w_Cnt = 0
                                                        End If

                                                        If w_Var <= m_KeikakuKikan.EndDate Then
                                                            '2015/04/10 Bando Upd Start =========================================
                                                            'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                            Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                            '2015/04/10 Bando Upd End   =========================================
                                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                '勤務CDが予定と異なる場合
                                                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                                .Cells(w_Row, w_Col).BackColor = Color.White
                                                            End If
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                                        End If
                                                    End If
                                                End If

                                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                                    sprSheet_4W.Sheets(0).SetText(w_Row, w_Col_4W, w_Text)
                                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                End If
                                            Next w_Col
                                        End If
                                    Next w_Row
                                End If
                            End If
                        End If
                    Next w_Int
                End With
            Else
                '4週画面表示中の場合

                With sprSheet_4W.Sheets(0)

                    If g_HopeNumFlg = "1" Then
                        'ｺﾋﾟｰ元の勤務に希望勤務があるかどうか？
                        w_KibouChk = False
                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                    If ColorTranslator.ToOle(.Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                        w_KibouChk = True
                                        Exit For
                                    End If
                                Next w_IntCol
                            End If
                            If w_KibouChk = True Then Exit For
                        Next w_IntRow

                        If g_HopeNum = 0 AndAlso w_KibouChk = True Then
                            '希望勤務入力が不可のためｴﾗｰ
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "希望勤務入力が不可のため"
                            '「&1コピーできません。」
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    If g_HopeNumDateFlg = "1" Then
                        'ｺﾋﾟｰ元の勤務に希望勤務があるかどうか？
                        w_KibouChk = False
                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                    If ColorTranslator.ToOle(.Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                        w_KibouChk = True
                                        Exit For
                                    End If
                                Next w_IntCol
                            End If
                            If w_KibouChk = True Then Exit For
                        Next w_IntRow

                        If g_HopeNumDate = 0 AndAlso w_KibouChk = True Then
                            '希望勤務入力が不可のためｴﾗｰ
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "希望勤務(日付別)入力が不可のため"
                            '「&1コピーできません。」
                            Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If
                    End If
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
                    w_CellRange = .GetSelections

                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        '元ﾃﾞｰﾀの大きさ
                        w_StartCol2 = w_StartCol
                        w_StartRow2 = w_StartRow
                        w_EndCol2 = w_StartCol2 + (m_CopyData.EndCol - m_CopyData.StartCol)
                        w_EndRow2 = w_StartRow2 + (m_CopyData.EndRow - m_CopyData.StartRow)

                        If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                            '勤務ﾃﾞｰﾀ開始列格納
                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                                Exit Sub
                            End If
                        Else
                            '勤務ﾃﾞｰﾀ開始列格納
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If

                        'ﾃﾞｰﾀ行 範囲内か ?
                        If Not ((m_StaffRow.StartRow <= w_StartRow2) AndAlso (w_EndRow2 <= m_StaffRow.EndRow)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '計画ﾃﾞｰﾀ列 範囲内か ?
                        If Not ((w_KikanStartCol <= w_StartCol2) AndAlso (w_EndCol2 <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                            'ERROR
                            Exit Sub
                        End If

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow2 To w_EndRow2
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け

                                If g_HopeNumFlg = "1" AndAlso g_HopeNum > 0 Then
                                    'スタッフ行を取得
                                    w_StaffRowChk = False
                                    For w_DataLoop = 1 To UBound(w_StaffRow)
                                        If w_StaffRow(w_DataLoop).StaffRow = w_Row Then
                                            w_StaffRowChk = True
                                        End If
                                    Next w_DataLoop

                                    If w_StaffRowChk = False Then
                                        w_DataCnt = w_DataCnt + 1
                                        ReDim Preserve w_StaffRow(w_DataCnt)
                                        w_StaffRow(w_DataCnt).StaffRow = w_Row

                                        '変更前希望勤務回数取得
                                        '該当職員のｺﾋﾟｰ先範囲外の希望勤務回数をｶｳﾝﾄする
                                        w_KibouCnt = 0

                                        For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                                w_KibouCnt = w_KibouCnt + 1
                                            End If
                                        Next w_IntCol

                                        w_StaffRow(w_DataCnt).KibouCnt = w_KibouCnt
                                    End If
                                End If

                                For w_Col = w_StartCol2 To w_EndCol2
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        w_CurrentDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                                        If Get_Col_4W(w_CurrentDate, w_Col_4W) = False Then
                                            w_Col_4W = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
                                        End If

                                        '勤務変更
                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var = "" Then
                                            '勤務記号がないとき
                                            If w_Col_4W <= w_Col AndAlso w_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                                                '計画期間外の4週部分のとき
                                            Else
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    If g_SaikeiFlg = True Then
                                        '再掲部署の場合で実績ﾃﾞｰﾀは貼り付け不可
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            End If
                        Next w_Row

                        '部署異動、配属期間内か ?
                        For w_Row = w_StartRow To w_EndRow
                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け
                                For w_Col = w_StartCol To w_EndCol
                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "他部署の勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                        'ERROR
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "確定済み勤務に"
                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                        Exit Sub
                                    End If

                                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        w_CurrentDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                                        If Get_Col_4W(w_CurrentDate, w_Col_4W) = False Then
                                            w_Col_4W = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
                                        End If

                                        '勤務変更
                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var = "" Then
                                            '勤務記号がないとき
                                            If w_Col_4W <= w_Col AndAlso w_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                                                '計画期間外の4週部分のとき
                                            Else
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If IsNumeric(w_Var) = True Then
                                        w_StaffIdx = Integer.Parse(w_Var)

                                        '再掲部署の場合で実績ﾃﾞｰﾀは貼り付け不可
                                        If g_SaikeiFlg = True Then
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If

                                        '日付を取得
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_YYYYMMDD = w_Var

                                            If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                '届出のコンポーネントありの時
                                                w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine
                                                w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                                If w_Var <> "" Then
                                                    Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                    With General.g_objSyouninData
                                                        .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                        .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                        .mKC_TargetDate = w_YYYYMMDD

                                                        If .mChkKinmuChange = False Then
                                                            '勤務変更不可
                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                            ReDim w_strMsg(1)
                                                            w_strMsg(1) = ""
                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                            '************************************************
                                                            Exit Sub
                                                        End If
                                                    End With
                                                End If
                                            End If
                                        End If
                                    End If
                                    '休日・代休には貼り付けれないようにする
                                    If General.g_lngDaikyuMng = 0 Then
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsNumeric(w_Var) = True Then
                                            If InStr(m_HolDateStr, Convert.ToString(Integer.Parse(w_Var))) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 7) Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "休日に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                            Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                            '2015/04/10 Bando Upd End  =========================================
                                            If w_KinmuCD <> "" Then
                                                If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = "代休に"
                                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            End If
                        Next w_Row

                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                        w_ColCnt = 0
                        w_RowCnt = 0
                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け
                                For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var = "" Then
                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                            '1ｹ月/1ｹ月,4週/4週の場合
                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                            w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                            '4週/1ｹ月の場合
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                        End If

                                        '配列番号 取得
                                        w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If IsNumeric(w_Var) = True Then
                                            '職員管理番号 取得
                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                    w_ColCnt = w_ColCnt + 1
                                Next w_Col
                            End If
                            w_ColCnt = 0
                            w_RowCnt = w_RowCnt + 1
                        Next w_Row

                        If m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.StartRow = m_CopyData.EndRow Then
                            '元ﾃﾞｰﾀの形式が1ｾﾙ の場合
                            If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                '日当直のコンポーネントありの時
                                w_Var = .GetText(m_CopyData.StartRow, m_CopyData.StartCol)
                                If w_Var <> "" Then
                                    '2015/04/10 Bando Upd Start =========================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                    '2015/04/10 Bando Upd End   =========================================
                                End If

                                For w_Row = w_StartRow To w_EndRow
                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け

                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)

                                            For w_Col = w_StartCol To w_EndCol
                                                '日付を取得
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_YYYYMMDD = w_Var

                                                    With General.g_objGetData
                                                        .p職員区分 = 0
                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                        .pチェック基準日 = w_YYYYMMDD
                                                        .p処理区分 = 0
                                                        .pチェック勤務CD = w_KinmuCD

                                                        If .mChkKinmuDuty = False Then
                                                            '勤務変更不可
                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                            ReDim w_strMsg(1)
                                                            w_strMsg(1) = ""
                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                            '************************************************
                                                            Exit Sub
                                                        End If
                                                    End With
                                                End If
                                            Next w_Col
                                        End If
                                    End If
                                Next w_Row
                            End If
                        Else
                            If w_StartCol = w_EndCol AndAlso w_StartRow = w_EndRow Then
                                '選択ｾﾙが1ｾﾙの場合
                            Else
                                'ｺﾋﾟｰﾃﾞｰﾀと同じ大きさか？
                                If Not (m_CopyData.EndCol - m_CopyData.StartCol = w_EndCol - w_StartCol AndAlso m_CopyData.EndRow - m_CopyData.StartRow = w_EndRow - w_StartRow) Then
                                    If m_CopyData.StartRow = m_CopyData.EndRow AndAlso m_CopyData.EndCol - m_CopyData.StartCol = w_EndCol - w_StartCol Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                                        w_ColCnt = 0
                                        For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                            w_Var = .GetText(m_CopyData.StartRow, w_Col)
                                            If w_Var = "" Then
                                                For w_Row = w_StartRow To w_EndRow
                                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                        '勤務のみ貼り付け
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                            End If
                                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If

                                                        '配列番号 取得
                                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                        If w_Var <> "" Then
                                                            '職員管理番号 取得
                                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                                ReDim w_strMsg(1)
                                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                                Exit Sub
                                                            End If
                                                        End If
                                                    End If
                                                Next w_Row
                                            Else
                                                If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                    '日当直のコンポーネントありの時
                                                    '2015/04/10 Bando Upd Start =========================================
                                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                    Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                    '2015/04/10 Bando Upd End   =========================================
                                                    w_Col2 = w_Col - m_CopyData.StartCol + w_StartCol

                                                    '日付を取得
                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col2)
                                                    If w_Var <> "" Then
                                                        w_YYYYMMDD = w_Var

                                                        For w_Row = w_StartRow To w_EndRow
                                                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                                '勤務のみ貼り付け

                                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                                If IsNumeric(w_Var) = True Then
                                                                    w_StaffIdx = Integer.Parse(w_Var)

                                                                    With General.g_objGetData
                                                                        .p職員区分 = 0
                                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                        .pチェック基準日 = w_YYYYMMDD
                                                                        .p処理区分 = 0
                                                                        .pチェック勤務CD = w_KinmuCD

                                                                        If .mChkKinmuDuty = False Then
                                                                            '勤務変更不可
                                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                                            ReDim w_strMsg(1)
                                                                            w_strMsg(1) = ""
                                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                            '************************************************
                                                                            Exit Sub
                                                                        End If
                                                                    End With
                                                                End If
                                                            End If
                                                        Next w_Row
                                                    End If
                                                End If
                                            End If
                                            w_ColCnt = w_ColCnt + 1
                                        Next w_Col

                                        w_RowMultiColFlg = True
                                    ElseIf m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.EndRow - m_CopyData.StartRow = w_EndRow - w_StartRow Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                        'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                                        w_RowCnt = 0
                                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け
                                                w_Var = .GetText(w_Row, m_CopyData.StartCol)
                                                If w_Var = "" Then
                                                    For w_Col = w_StartCol To w_EndCol
                                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                                            '1ｹ月/1ｹ月,4週/4週の場合
                                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                                            w_Cnt = w_StartCol - w_KeikakuCol + 1
                                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                                            '4週/1ｹ月の場合
                                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                            If w_Var <> "" Then
                                                                w_CurrentDate = Integer.Parse(w_Var)
                                                            End If
                                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                            Else
                                                                w_Cnt = 0
                                                            End If
                                                        End If

                                                        '配列番号 取得
                                                        w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                        If IsNumeric(w_Var) = True Then
                                                            '職員管理番号 取得
                                                            If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                                ReDim w_strMsg(1)
                                                                w_strMsg(1) = "確定済み勤務に未割当は"
                                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                                Exit Sub
                                                            End If
                                                        End If
                                                    Next w_Col
                                                Else
                                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                                        '日当直のコンポーネントありの時
                                                        '2015/04/10 Bando Upd Start =========================================
                                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                        Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                        '2015/04/10 Bando Upd End   =========================================
                                                        w_Row2 = w_Row - m_CopyData.StartRow + w_StartRow

                                                        w_Var = .GetText(w_Row2, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                        If IsNumeric(w_Var) = True Then
                                                            w_StaffIdx = Integer.Parse(w_Var)

                                                            For w_Col = w_StartCol To w_EndCol
                                                                '日付を取得
                                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                                If w_Var <> "" Then
                                                                    w_YYYYMMDD = w_Var

                                                                    With General.g_objGetData
                                                                        .p職員区分 = 0
                                                                        .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                        .pチェック基準日 = w_YYYYMMDD
                                                                        .p処理区分 = 0
                                                                        .pチェック勤務CD = w_KinmuCD

                                                                        If .mChkKinmuDuty = False Then
                                                                            '勤務変更不可
                                                                            '*******ﾒｯｾｰｼﾞ***********************************
                                                                            ReDim w_strMsg(1)
                                                                            w_strMsg(1) = ""
                                                                            Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                            '************************************************
                                                                            Exit Sub
                                                                        End If
                                                                    End With
                                                                End If
                                                            Next w_Col
                                                        End If
                                                    End If
                                                End If
                                            End If
                                            w_RowCnt = w_RowCnt + 1
                                        Next w_Row

                                        w_ColMultiRowFlg = True
                                    Else
                                        'ERROR
                                        w_CellSizeCol = m_CopyData.EndCol - m_CopyData.StartCol + 1
                                        w_CellSizeRow = m_CopyData.EndRow - m_CopyData.StartRow + 1
                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = Convert.ToString(w_CellSizeRow)
                                        w_strMsg(2) = Convert.ToString(w_CellSizeCol)
                                        Call Set_MsgZOrder("NS0108", w_strMsg, w_MsgRc, 0)

                                        Exit Sub
                                    End If
                                Else
                                    If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                        '日当直のコンポーネントありの時
                                        For w_Row = w_StartRow To w_EndRow
                                            If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け

                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                If IsNumeric(w_Var) = True Then
                                                    w_StaffIdx = Integer.Parse(w_Var)

                                                    For w_Col = w_StartCol To w_EndCol
                                                        '日付を取得
                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var <> "" Then
                                                            w_YYYYMMDD = w_Var

                                                            w_Col2 = w_Col - w_StartCol + m_CopyData.StartCol
                                                            w_Row2 = w_Row - w_StartRow + m_CopyData.StartRow

                                                            w_Var = .GetText(w_Row2, w_Col2)
                                                            If w_Var <> "" Then
                                                                '2015/04/10 Bando Upd Start =========================================
                                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                                '2015/04/10 Bando Upd End   =========================================
                                                            End If

                                                            With General.g_objGetData
                                                                .p職員区分 = 0
                                                                .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                                .pチェック基準日 = w_YYYYMMDD
                                                                .p処理区分 = 0
                                                                .pチェック勤務CD = w_KinmuCD

                                                                If .mChkKinmuDuty = False Then
                                                                    '勤務変更不可
                                                                    '*******ﾒｯｾｰｼﾞ***********************************
                                                                    ReDim w_strMsg(1)
                                                                    w_strMsg(1) = ""
                                                                    Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                                    '************************************************
                                                                    Exit Sub
                                                                End If
                                                            End With
                                                        End If
                                                    Next w_Col
                                                End If
                                            End If
                                        Next w_Row
                                    End If
                                End If
                            End If
                        End If
                    Next w_Int
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''代休データを退避
                    'If General.g_lngDaikyuMng = 0 Then
                    '    Call Set_UndoDaikyuData(0)
                    'End If
                    '----------------------------------------------------------------------------------------------------
                    For w_Int = 0 To w_CellRange.Length - 1

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(w_Int).Column
                        w_StartRow = w_CellRange(w_Int).Row
                        w_EndCol = w_CellRange(w_Int).Column + w_CellRange(w_Int).ColumnCount - 1
                        w_EndRow = w_CellRange(w_Int).Row + w_CellRange(w_Int).RowCount - 1

                        w_Cnt = 0
                        'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

                        '控除を取得している場合削除する
                        For w_Row = w_StartRow To w_EndRow
                            For w_Col = w_StartCol To w_EndCol
                                If m_CopyData.StartCol = m_CopyData.EndCol Then
                                    w_Cnt = w_Row - w_StartRow + 1
                                Else
                                    w_Cnt = w_Cnt + 1
                                End If
                                If w_Cnt > UBound(m_KojyoCopyData) Then
                                    w_Cnt = 1
                                End If

                                'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                w_StaffIdx = Integer.Parse(w_Var)

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                w_CurrentDate = Integer.Parse(w_Var)

                                For w_Lng = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                    If m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate Then
                                        'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_Lng) '2016/04/06 Yamanishi Del
                                        m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoCopyData(w_Cnt)
                                        m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate

                                        Exit For
                                    End If
                                Next

                                If w_Lng > UBound(m_StaffData(w_StaffIdx).Kojyo) AndAlso m_KojyoCopyData(w_Cnt).lngDate <> 0 Then
                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Lng)
                                    m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoCopyData(w_Cnt)
                                    m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate
                                End If
                            Next w_Col
                        Next w_Row

                        '元ﾃﾞｰﾀの大きさ
                        w_StartCol2 = w_StartCol
                        w_StartRow2 = w_StartRow
                        w_EndCol2 = w_StartCol2 + (m_CopyData.EndCol - m_CopyData.StartCol)
                        w_EndRow2 = w_StartRow2 + (m_CopyData.EndRow - m_CopyData.StartRow)

                        '元ﾃﾞｰﾀの形式
                        If m_CopyData.StartCol = m_CopyData.EndCol AndAlso m_CopyData.StartRow = m_CopyData.EndRow Then
                            '1ｾﾙ の場合

                            For w_Row = w_StartRow To w_EndRow
                                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ貼り付け
                                    For w_Col = w_StartCol To w_EndCol

                                        'UndoData格納
                                        'Call Set_UndoData(w_Col, w_Row, w_Col, w_Row) '2016/04/05 Ishiga del

                                        '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                                        .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_Row, w_Col, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        w_Text = w_Var

                                        '勤務変更の場合
                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                            '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                            If IsNumeric(w_Var) = True Then
                                                w_StaffIdx = Integer.Parse(w_Var)

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_CurrentDate = Integer.Parse(w_Var)
                                                End If
                                                If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                    w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                Else
                                                    w_Cnt = 0
                                                End If

                                                If w_Var <= m_KeikakuKikan.EndDate Then
                                                    '2015/04/10 Bando Upd Start =========================================
                                                    'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                    Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                    '2015/04/10 Bando Upd End   =========================================
                                                    If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                        '勤務CDが予定と異なる場合
                                                        .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                    Else
                                                        '勤務CDが予定と同じ場合
                                                        '通常
                                                        .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                        .Cells(w_Row, w_Col).BackColor = Color.White
                                                    End If
                                                Else
                                                    '勤務CDが予定と同じ場合
                                                    '通常
                                                    .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                    .Cells(w_Row, w_Col).BackColor = Color.White
                                                End If
                                            End If
                                        End If

                                        w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                        w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        '1ヶ月用列番号取得
                                        If Get_Col_M(w_Var, w_Col_M) = True Then
                                            sprSheet_M.Sheets(0).SetText(w_Row, w_Col_M, w_Text)
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).BackColor = ColorTranslator.FromOle(w_BackColor)
                                        End If
                                    Next w_Col
                                End If
                            Next w_Row
                        Else
                            '1ﾌﾞﾛｯｸの場合

                            If w_RowMultiColFlg = True Then
                                'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき
                                w_Start = w_StartRow
                                w_End = w_EndRow
                            ElseIf w_ColMultiRowFlg = True Then
                                'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき
                                w_Start = w_StartCol
                                w_End = w_EndCol
                            Else
                                w_Start = 0
                                w_End = 0
                            End If

                            For w_Lng = w_Start To w_End
                                If w_RowMultiColFlg = True Then
                                    'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                    If ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Lng - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If
                                Else
                                    w_Bool = True
                                End If

                                If w_Bool = True Then
                                    If w_RowMultiColFlg = True Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき
                                        'UndoData格納
                                        'Call Set_UndoData(w_StartCol, w_Lng, w_EndCol, w_Lng) '2016/04/05 Ishiga del

                                    ElseIf w_ColMultiRowFlg = True Then
                                        'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき
                                        'UndoData格納
                                        'Call Set_UndoData(w_Lng, w_StartRow, w_Lng, w_EndRow) '2016/04/05 Ishiga del

                                    Else
                                        If w_StartCol = w_EndCol AndAlso w_StartRow = w_EndRow Then
                                            '選択ｾﾙが1ｾﾙの場合
                                            'UndoData格納
                                            'Call Set_UndoData(w_StartCol2, w_StartRow2, w_EndCol2, w_EndRow2) '2016/04/05 Ishiga del
                                        Else
                                            'UndoData格納
                                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del
                                        End If
                                    End If

                                    '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                                    If m_MaxShowLine > 1 Then
                                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                                '勤務のみ貼り付け

                                                If w_RowMultiColFlg = True Then
                                                    'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_Lng, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                ElseIf w_ColMultiRowFlg = True Then
                                                    'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_Lng, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                Else
                                                    'ｺﾋﾟｰ実行
                                                    .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                                End If
                                            End If
                                        Next w_Row
                                    Else
                                        If w_RowMultiColFlg = True Then
                                            'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき

                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_Lng, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        ElseIf w_ColMultiRowFlg = True Then
                                            'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_Lng, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        Else
                                            'ｺﾋﾟｰ実行
                                            .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)

                                        End If
                                    End If
                                End If
                            Next w_Lng

                            If w_RowMultiColFlg = True OrElse w_ColMultiRowFlg = True Then
                                'ｺﾋﾟｰﾃﾞｰﾀが1行複数列で、選択ｾﾙの列数が同一で複数行選択されているとき
                                'ｺﾋﾟｰﾃﾞｰﾀが1列複数行で、選択ｾﾙの行数が同一で複数列選択されているとき

                                For w_Row = w_StartRow To w_EndRow
                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け
                                        For w_Col = w_StartCol To w_EndCol
                                            w_Var = .GetText(w_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_Text = w_Var

                                                '勤務変更の場合
                                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                    '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                    If IsNumeric(w_Var) = True Then
                                                        w_StaffIdx = Integer.Parse(w_Var)

                                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                        If w_Var <> "" Then
                                                            w_CurrentDate = Integer.Parse(w_Var)
                                                        End If
                                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                        Else
                                                            w_Cnt = 0
                                                        End If

                                                        If w_Var <= m_KeikakuKikan.EndDate Then
                                                            '2015/04/10 Bando Upd Start =========================================
                                                            'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                            Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                            '2015/04/10 Bando Upd End   =========================================
                                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                                '勤務CDが予定と異なる場合
                                                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                            Else
                                                                '勤務CDが予定と同じ場合
                                                                '通常
                                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                                .Cells(w_Row, w_Col).BackColor = Color.White
                                                            End If
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                                        End If
                                                    End If
                                                End If

                                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                If w_Var <> "" Then
                                                    w_Bool = True
                                                Else
                                                    w_Bool = False
                                                End If

                                                '1ヶ月用列番号取得
                                                If Get_Col_M(w_Var, w_Col_M) = True Then
                                                    sprSheet_M.Sheets(0).SetText(w_Row, w_Col_M, w_Text)
                                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).BackColor = ColorTranslator.FromOle(w_BackColor)
                                                End If
                                            End If
                                        Next w_Col
                                    End If
                                Next w_Row
                            Else
                                For w_Row = w_StartRow2 To w_EndRow2
                                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                        '勤務のみ貼り付け
                                        For w_Col = w_StartCol2 To w_EndCol2

                                            w_Var = .GetText(w_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_Bool = True
                                            Else
                                                w_Bool = False
                                            End If

                                            w_Text = w_Var

                                            '勤務変更の場合
                                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                                '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                                If IsNumeric(w_Var) = True Then
                                                    w_StaffIdx = Integer.Parse(w_Var)

                                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                                    If w_Var <> "" Then
                                                        w_CurrentDate = Integer.Parse(w_Var)
                                                    End If

                                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                        w_Cnt = w_GetCol - w_KeikakuCol + 1
                                                    Else
                                                        w_Cnt = 0
                                                    End If

                                                    If w_Var <= m_KeikakuKikan.EndDate Then
                                                        '2015/04/10 Bando Upd Start =========================================
                                                        'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                                        Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                        '2015/04/10 Bando Upd End   =========================================
                                                        If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD Then
                                                            '勤務CDが予定と異なる場合
                                                            .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色
                                                        Else
                                                            '勤務CDが予定と同じ場合
                                                            '通常
                                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                            .Cells(w_Row, w_Col).BackColor = Color.White
                                                        End If
                                                    Else
                                                        '勤務CDが予定と同じ場合
                                                        '通常
                                                        .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                        .Cells(w_Row, w_Col).BackColor = Color.White
                                                    End If
                                                End If
                                            End If

                                            w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                            w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_Bool = True
                                            Else
                                                w_Bool = False
                                            End If

                                            '1ヶ月用列番号取得
                                            If Get_Col_M(w_Var, w_Col_M) = True Then
                                                sprSheet_M.Sheets(0).SetText(w_Row, w_Col_M, w_Text)
                                                sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                                sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).BackColor = ColorTranslator.FromOle(w_BackColor)
                                            End If
                                        Next w_Col
                                    End If
                                Next w_Row
                            End If
                        End If
                    Next w_Int
                End With
            End If

            'セルの罫線を初期化
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                With sprSheet_M.Sheets(0)

                    '貼り付け先の罫線を初期化する。
                    Call SetBorder(sprSheet_M, w_StartRow, w_StartCol, w_EndRow, w_EndCol, 1, 1, 1, 1, 0, Color.Black)

                    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    For w_Row = w_StartRow To w_EndRow
                        If m_MaxShowLine > 1 AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                            '--------------------
                            '背景色を元に戻す
                            '--------------------
                            '明細の背景色を元に戻す
                            Call SetBorder(sprSheet_M, w_Row, M_KinmuDataStart_Col, w_Row, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                        End If

                        For w_Col = w_StartCol To w_EndCol
                            If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                            ElseIf w_Row = m_Row Then  '選択セルと同行
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                            ElseIf w_Col = m_Col Then  '選択セルと同列
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                            End If
                        Next w_Col
                    Next w_Row
                End With
            Else
                '4週画面表示中の場合
                With sprSheet_4W.Sheets(0)

                    '貼り付け先の罫線を初期化する。
                    Call SetBorder(sprSheet_4W, w_StartRow, w_StartCol, w_EndRow, w_EndCol, 1, 1, 1, 1, 0, Color.Black)

                    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    For w_Row = w_StartRow To w_EndRow
                        If m_MaxShowLine > 1 AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                            '--------------------
                            '背景色を元に戻す
                            '--------------------
                            '明細の背景色を元に戻す
                            Call SetBorder(sprSheet_4W, w_Row, M_KinmuDataStart_Col, w_Row, m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                        End If

                        For w_Col = w_StartCol To w_EndCol
                            If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                            ElseIf w_Row = m_Row Then  '選択セルと同行
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                            ElseIf w_Col = m_Col Then  '選択セルと同列
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                            End If
                        Next w_Col
                    Next w_Row
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If g_HopeNumFlg = "1" Then
                        '該当職員のｺﾋﾟｰ先範囲外の希望勤務回数をｶｳﾝﾄする
                        For w_DataLoop = 1 To UBound(w_StaffRow)
                            If w_StaffRow(w_DataLoop).StaffRow = w_Row Then
                                w_KibouCnt = 0

                                For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                    If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_IntCol).BackColor) = m_Kibou_Back Then
                                        w_KibouCnt = w_KibouCnt + 1
                                    End If
                                Next w_IntCol

                                If w_KibouChk = True AndAlso w_KibouCnt > g_HopeNum Then
                                    w_blnColChk = True
                                End If

                                Exit For
                            End If
                        Next w_DataLoop
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            If g_HopeNumFlg = "1" AndAlso w_blnColChk = True Then
                '希望回数制限オーバーダイアログ表示
                If g_KibouNumDiaLogFlg = 1 Then
                    'ワーニング
                    ReDim w_strMsg(2)
                    w_strMsg(1) = "希望勤務"
                    w_strMsg(2) = "設定された希望勤務回数"
                    '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                    Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                    If w_MsgRc = MsgBoxResult.No Then
                        '元に戻す
                        Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuUndo), New System.EventArgs())
                        Exit Sub
                    End If
                Else
                    'エラー
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "設定された希望勤務回数を超えているため"
                    '「&1入力できません。」
                    Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                    '元に戻す
                    Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuUndo), New System.EventArgs())
                    Exit Sub
                End If
            End If

            '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
            'コピー先領域の希望勤務(日付別)回数をカウントする
            '１ヶ月表示の場合
            If w_Col_M = 0 Then
                For w_Col = w_StartCol To w_EndCol
                    w_KibouCntDate = 0

                    For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_Col).BackColor) = m_Kibou_Back Then
                                w_KibouCntDate = w_KibouCntDate + 1
                            End If

                            If w_KibouChk = True AndAlso w_KibouCntDate > g_HopeNumDate Then
                                w_blnColChkDate = True
                            End If
                        End If
                    Next w_Row
                Next w_Col
            Else
                '4週表示の場合
                For w_Col = w_Col_M - (w_EndCol - w_StartCol) To w_Col_M
                    w_KibouCntDate = 0

                    For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_Col).BackColor) = m_Kibou_Back Then
                                w_KibouCntDate = w_KibouCntDate + 1
                            End If

                            If w_KibouChk = True AndAlso w_KibouCntDate > g_HopeNumDate Then
                                w_blnColChkDate = True
                            End If
                        End If
                    Next w_Row
                Next w_Col
            End If
            If g_HopeNumDateFlg = "1" AndAlso w_blnColChkDate = True Then
                '希望回数制限オーバーダイアログ表示
                If g_KibouNumDiaLogFlg = 1 Then
                    'ワーニング
                    ReDim w_strMsg(2)
                    w_strMsg(1) = "希望勤務"
                    w_strMsg(2) = "設定された希望勤務(日付別)回数"
                    '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                    Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                    If w_MsgRc = MsgBoxResult.No Then
                        '元に戻す
                        Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuUndo), New System.EventArgs())
                        Exit Sub
                    End If
                Else
                    'エラー
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "設定された希望勤務(日付別)回数を超えているため"
                    '「&1入力できません。」
                    Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                    '元に戻す
                    Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuUndo), New System.EventArgs())
                    Exit Sub
                End If
            End If
            '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '貼り付け
    Private Sub PasteData_OneSel()

        Const W_SUBNAME As String = "NSK0000HA PasteData_OneSel"

        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Col_4W As Integer
        Dim w_Col_M As Integer
        Dim w_ColIdx As Integer
        Dim w_Row As Integer
        Dim w_RowIdx As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_KikanStartCol As Integer
        Dim w_Int As Integer
        Dim w_Cnt As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_VarPlan(,) As Object = Nothing
        Dim w_Text As Object
        Dim w_Bool As Boolean
        Dim w_blnFLG As Boolean
        Dim w_ForeColor As Integer
        Dim w_Plan_Fore(,) As Integer
        Dim w_BackColor As Integer
        Dim w_Plan_Back(,) As Integer
        Dim w_CurrentDate As Integer
        Dim w_ColCnt As Integer
        Dim w_RowCnt As Integer
        Dim w_KeikakuCol As Integer
        Dim w_StaffIdx As Integer
        Dim w_GetCol As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_YYYYMMDD As Object = String.Empty
        Dim w_UniqueSeqNO As String = String.Empty
        Dim w_Row2 As Integer
        Dim w_KangoCD As String = String.Empty
        Dim w_strMsg() As String
        Dim w_IntCol As Integer
        Dim w_IntRow As Integer
        Dim w_KibouCnt As Integer
        Dim w_KibouCol() As Integer
        Dim w_CopyData_Kibou() As Integer
        Dim w_blnColChk As Boolean
        Dim w_DataCnt As Integer
        Dim w_KibouChk As Boolean
        Dim w_Start_Col_M As Integer
        Dim w_End_Col_M As Integer
        '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
        Dim w_KibouCntDate As Integer
        Dim w_blnColChkDate As Boolean
        Dim w_CopyData_Kibou_Date() As Integer
        '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

        Try
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                ReDim w_KibouCol(0)
                ReDim w_CopyData_Kibou(0)
                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                ReDim w_CopyData_Kibou_Date(0)
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                If g_HopeNumFlg = "1" Then
                    'ｺﾋﾟｰ元の希望勤務回数を取得する
                    w_DataCnt = 0
                    For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow

                        If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then

                            w_KibouCnt = 0

                            For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                    '希望勤務あり
                                    w_KibouChk = True
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_CopyData_Kibou(w_DataCnt)
                            w_CopyData_Kibou(w_DataCnt) = w_KibouCnt
                        End If
                    Next w_IntRow

                    If g_HopeNum = 0 AndAlso w_KibouChk = True Then
                        '希望勤務入力が不可のためｴﾗｰ
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望勤務入力が不可のため"
                        '「&1コピーできません。」
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If

                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                If g_HopeNumDateFlg = "1" Then
                    'ｺﾋﾟｰ元の希望勤務回数を取得する
                    w_DataCnt = 0
                    For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow

                        If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then

                            w_KibouCnt = 0

                            For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                    '希望勤務あり
                                    w_KibouChk = True
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_CopyData_Kibou(w_DataCnt)
                            w_CopyData_Kibou(w_DataCnt) = w_KibouCnt
                        End If
                    Next w_IntRow

                    w_DataCnt = 0
                    For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol

                        w_KibouCnt = 0

                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then

                                If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                End If
                            End If
                        Next w_IntRow

                        ReDim Preserve w_CopyData_Kibou_Date(w_DataCnt)
                        w_CopyData_Kibou_Date(w_DataCnt) = w_KibouCnt
                        w_DataCnt = w_DataCnt + 1
                    Next w_IntCol

                    If g_HopeNumDate = 0 AndAlso w_KibouChk = True Then
                        '希望勤務入力が不可のためｴﾗｰ
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望勤務(日付別)入力が不可のため"
                        '「&1コピーできません。」
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                w_DataCnt = 0

                With sprSheet_M.Sheets(0)

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    w_StartCol = .ActiveColumn.Index
                    w_StartRow = .ActiveRow.Index
                    w_EndCol = w_StartCol + (m_CopyData.EndCol - m_CopyData.StartCol)
                    w_EndRow = w_StartRow + (m_CopyData.EndRow - m_CopyData.StartRow)

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_StartCol) AndAlso (w_EndCol <= m_KeikakuKikan.KinmuDataEndCol)) Then
                        'ERROR
                        Exit Sub
                    End If

                    'もし一段表示の隠し行に貼り付けようとした時
                    If m_blnJissekiUseFlg = False AndAlso (w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        'ERROR
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "下段（隠し）側には"
                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        '基本的に制御されているが、もし二段表示の上段に貼り付けようとした時
                        If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            'ERROR
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "上段（計画）側には"
                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If

                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックで貼り付け可能
                        ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ貼り付け

                            '該当職員のｺﾋﾟｰ先範囲外の希望勤務回数をｶｳﾝﾄする
                            w_KibouCnt = 0
                            For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_IntCol).BackColor) = m_Kibou_Back AndAlso (w_IntCol < w_StartCol OrElse w_EndCol < w_IntCol) Then
                                    w_KibouCnt = w_KibouCnt + 1
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_KibouCol(w_DataCnt)

                            w_KibouCol(w_DataCnt) = w_KibouCnt

                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務に"
                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If

                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    '勤務変更
                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var = "" Then
                                        '勤務記号がないとき
                                        ReDim w_strMsg(1)
                                        w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                        If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                            '二段表示の下段を選択中の時
                                            w_Var = .GetText(w_Row - 1, w_Col)
                                            If w_Var = "" Then
                                                '上段に勤務記号がないとき
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        Else
                                            '二段表示の上段を選択中、または一段表示の時
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                End If

                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If IsNumeric(w_Var) = True Then
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    '再掲部署の場合で実績ﾃﾞｰﾀの場合は貼り付け不可
                                    If g_SaikeiFlg = True Then
                                        '職員管理番号 取得
                                        If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                            '1ｹ月/1ｹ月,4週/4週の場合
                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                            w_Cnt = w_Col - w_KeikakuCol + 1
                                        ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                            '4週/1ｹ月の場合
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                        End If
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務に"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    '日付を取得
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_YYYYMMDD = w_Var

                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                .mKC_TargetDate = w_YYYYMMDD

                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    'w_strMsg(1) = "時間外が既に登録されているため~n"
                                                    w_strMsg(1) = "届出が既に登録されているため~n" '#001
                                                    Call General.paMsgDsp("NS0110", w_strMsg)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If

                                        If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                            '日当直のコンポーネントありの時
                                            w_Col2 = w_Col - w_StartCol + m_CopyData.StartCol
                                            w_Row2 = w_Row - w_StartRow + m_CopyData.StartRow

                                            w_Var = .GetText(w_Row2, w_Col2)
                                            If w_Var <> "" Then
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                '2015/04/10 Bando Upd End   =========================================
                                            End If

                                            With General.g_objGetData
                                                .p職員区分 = 0
                                                .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                .pチェック基準日 = w_YYYYMMDD
                                                .p処理区分 = 0
                                                .pチェック勤務CD = w_KinmuCD

                                                If .mChkKinmuDuty = False Then
                                                    '勤務変更不可
                                                    '*******ﾒｯｾｰｼﾞ***********************************
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = ""
                                                    Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                    '************************************************
                                                    Exit Sub
                                                End If
                                            End With
                                        End If

                                        If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                            '届出のコンポーネントありの時
                                            w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                                            w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                            If w_Var <> "" Then
                                                Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                With General.g_objSyouninData
                                                    .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                    .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                    .mKC_TargetDate = w_YYYYMMDD

                                                    If .mChkKinmuChange = False Then
                                                        '勤務変更不可
                                                        '*******ﾒｯｾｰｼﾞ***********************************
                                                        ReDim w_strMsg(1)
                                                        w_strMsg(1) = ""
                                                        Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                        '************************************************
                                                        Exit Sub
                                                    End If
                                                End With
                                            End If
                                        End If
                                    End If
                                End If

                                '休日・代休には貼り付けれないようにする
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If IsNumeric(w_Var) = True Then
                                        If InStr(m_HolDateStr, Convert.ToString(Integer.Parse(w_Var))) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 7) Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "休日に"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        '2015/04/10 Bando Upd Start =========================================
                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                        Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                        '2015/04/10 Bando Upd End   =========================================

                                        If w_KinmuCD <> "" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        '勤務変更
                                        If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                            '二段表示の下段を選択中の時
                                            w_Var = .GetText(w_Row - 1, w_Col)
                                            If w_Var <> "" Then
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                '2015/04/10 Bando Upd End   =========================================

                                                If w_KinmuCD <> "" Then
                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                        ReDim w_strMsg(1)
                                                        w_strMsg(1) = "代休に"
                                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                        Exit Sub
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If

                                If w_KinmuCD <> "" AndAlso w_YYYYMMDD <> "" Then
                                    If Check_YoubiLimit(w_YYYYMMDD, w_KinmuCD) = False Then
                                        Exit Sub
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '希望回数チェック
                    If g_HopeNumFlg = "1" Then
                        w_blnColChk = False
                        For w_DataCnt = 1 To UBound(w_CopyData_Kibou)
                            If w_CopyData_Kibou(w_DataCnt) + w_KibouCol(w_DataCnt) > g_HopeNum AndAlso w_KibouChk = True Then
                                w_blnColChk = True
                            End If
                        Next w_DataCnt

                        If w_blnColChk = True Then
                            '希望回数制限オーバーダイアログ表示
                            If g_KibouNumDiaLogFlg = 1 Then
                                'ワーニング
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "設定された希望勤務回数"
                                '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                                Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                                If w_MsgRc = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            Else
                                'エラー
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "設定された希望勤務回数を超えているため"
                                '「&1入力できません。」
                                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If
                    End If
                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    If g_HopeNumDateFlg = "1" Then
                        w_blnColChkDate = False
                        w_DataCnt = 0

                        'コピー先の各日付ごとに希望回数(日付別)をチェック
                        For w_IntCol = w_StartCol To w_StartCol + (m_CopyData.EndCol - m_CopyData.StartCol)
                            w_KibouCntDate = 0
                            For w_IntRow = m_StaffRow.StartRow To m_StaffRow.EndRow
                                '2014/05/27 Shibata add start P-06991-----------------------------------------------------------------------
                                If w_IntRow < w_StartRow OrElse w_IntRow > w_StartRow + (m_CopyData.EndRow - m_CopyData.StartRow) Then
                                    If (w_IntRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                        If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                            w_KibouCntDate = w_KibouCntDate + 1
                                        End If
                                    End If
                                End If
                                '2014/05/27 Shibata add end   P-06991-----------------------------------------------------------------------
                                If (w_KibouCntDate + w_CopyData_Kibou_Date(w_DataCnt)) > g_HopeNumDate AndAlso w_KibouChk = True Then
                                    w_blnColChkDate = True
                                End If
                            Next w_IntRow

                            w_DataCnt = w_DataCnt + 1
                        Next w_IntCol

                        If w_blnColChkDate = True Then
                            '希望回数制限オーバーダイアログ表示
                            If g_KibouNumDiaLogFlg = 1 Then
                                'ワーニング
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "設定された希望勤務(日付別)回数"
                                '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                                Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                                If w_MsgRc = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            Else
                                'エラー
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "設定された希望勤務(日付別)回数を超えているため"
                                '「&1入力できません。」
                                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If
                    End If
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                    'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                    w_ColCnt = 0
                    w_RowCnt = 0
                    For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックで貼り付け可能
                        ElseIf ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ貼り付け
                            For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var = "" Then
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                    End If

                                    '配列番号 取得
                                    w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If IsNumeric(w_Var) = True Then
                                        '職員管理番号 取得
                                        If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務に未割当は"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If
                                End If
                                w_ColCnt = w_ColCnt + 1
                            Next w_Col
                        End If
                        w_ColCnt = 0
                        w_RowCnt = w_RowCnt + 1
                    Next w_Row
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start------------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end--------------------

                    'ReDim m_KojyoUndoData(0)
                    ''Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                    ' ''全消去前の代休データを退避
                    ''If General.g_lngDaikyuMng = 0 Then
                    ''    Call Set_UndoDaikyuData(0)
                    ''End If
                    '----------------------------------------------------------------------------------------------------
                    w_Cnt = 0

                    '控除を取得している場合削除する
                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            'ReDim Preserve m_KojyoUndoData(w_Cnt) '2016/04/06 Yamanishi Del

                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            w_StaffIdx = Integer.Parse(w_Var)

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            w_CurrentDate = Integer.Parse(w_Var)

                            For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                If m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate Then
                                    'm_KojyoUndoData(w_Cnt) = m_StaffData(w_StaffIdx).Kojyo(w_Int) '2016/04/06 Yamanishi Del
                                    m_StaffData(w_StaffIdx).Kojyo(w_Int) = m_KojyoCopyData(w_Cnt)
                                    m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate

                                    Exit For
                                End If
                            Next

                            If w_Int > UBound(m_StaffData(w_StaffIdx).Kojyo) AndAlso m_KojyoCopyData(w_Cnt).lngDate <> 0 Then
                                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int)
                                m_StaffData(w_StaffIdx).Kojyo(w_Int) = m_KojyoCopyData(w_Cnt)
                                m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate
                            End If
                        Next w_Col
                    Next w_Row

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '勤務変更
                        If m_blnJissekiUseFlg = False Then
                            '一段表示の時
                            w_ColIdx = w_EndCol - w_StartCol
                            w_RowIdx = (w_EndRow - w_StartRow) \ m_MaxShowLine
                            If w_ColIdx >= 0 AndAlso w_RowIdx >= 0 Then
                                ReDim w_Plan_Fore(w_ColIdx, w_RowIdx)
                                ReDim w_Plan_Back(w_ColIdx, w_RowIdx)
                                ReDim w_VarPlan(w_ColIdx, w_RowIdx)

                                For w_Row = w_StartRow To w_EndRow
                                    '一段表示の時はセルブロックで貼り付け可能
                                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                        For w_Col = w_StartCol To w_EndCol
                                            '予定データをコピー前に保存しておく
                                            w_ColIdx = w_Col - w_StartCol
                                            w_RowIdx = (w_Row - w_StartRow) \ m_MaxShowLine

                                            w_Var = .GetText(w_Row, w_Col)
                                            w_VarPlan(w_ColIdx, w_RowIdx) = w_Var

                                            w_Plan_Fore(w_ColIdx, w_RowIdx) = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                            w_Plan_Back(w_ColIdx, w_RowIdx) = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)
                                        Next w_Col
                                    End If
                                Next w_Row
                            End If
                        End If
                    End If

                    '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                    If m_MaxShowLine > 1 Then
                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け

                                'ｺﾋﾟｰ実行
                                .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        'ｺﾋﾟｰ実行
                        .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)
                    End If

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合

                        For w_Row = w_StartRow To w_EndRow
                            If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                '実績段非表示の時はセルブロックで貼り付け可能
                            ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け
                                For w_Col = w_StartCol To w_EndCol

                                    w_blnFLG = False '初期化

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    w_Text = w_Var

                                    '勤務変更の場合
                                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                        '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            '4週/1ｹ月の場合
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var <> "" Then
                                                w_CurrentDate = Integer.Parse(w_Var)
                                            End If
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                            If w_Var <= m_KeikakuKikan.EndDate Then
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time  )
                                                Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                                '2015/04/10 Bando Upd End   =========================================
                                                If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse w_RiyuKBN <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN OrElse w_KangoCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).OuenKangoCD Then

                                                    '勤務CDが予定と異なる場合
                                                    .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                                                    If m_blnJissekiUseFlg = False Then
                                                        '一段表示の時
                                                        w_Var = .GetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col)
                                                        If w_Var = "" Then
                                                            '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                                            w_ColIdx = w_Col - w_StartCol
                                                            w_RowIdx = (w_Row - w_StartRow) \ m_MaxShowLine

                                                            .SetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col, w_VarPlan(w_ColIdx, w_RowIdx))
                                                            .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore(w_ColIdx, w_RowIdx))
                                                            .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back(w_ColIdx, w_RowIdx))
                                                            w_blnFLG = True
                                                        End If
                                                    End If
                                                Else
                                                    '勤務CDが予定と同じ場合
                                                    '通常
                                                    .Cells(w_Row, w_Col).ForeColor = Color.Black
                                                End If
                                            Else
                                                '勤務CDが予定と同じ場合
                                                '通常
                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                            End If
                                        End If
                                    End If

                                    w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                    w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    If Get_Col_4W(w_Var, w_Col_4W) = True Then
                                        '文字列、色設定
                                        sprSheet_4W.Sheets(0).SetText(w_Row, w_Col_4W, w_Text)
                                        sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                        sprSheet_4W.Sheets(0).Cells(w_Row, w_Col_4W).BackColor = ColorTranslator.FromOle(w_BackColor)

                                        If w_blnFLG Then
                                            '一段表示の時
                                            w_Var = sprSheet_4W.Sheets(0).GetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_4W)
                                            If w_Var = "" Then
                                                '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                                sprSheet_4W.Sheets(0).SetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_4W, w_VarPlan(w_ColIdx, w_RowIdx))
                                                sprSheet_4W.Sheets(0).Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_4W).ForeColor = ColorTranslator.FromOle(w_Plan_Fore(w_ColIdx, w_RowIdx))
                                                sprSheet_4W.Sheets(0).Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_4W).BackColor = ColorTranslator.FromOle(w_Plan_Back(w_ColIdx, w_RowIdx))
                                            End If
                                        End If
                                    End If
                                Next w_Col
                            End If
                        Next w_Row
                    ElseIf (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                        '1ｹ月/1ｹ月,4週/4週の場合

                        '勤務変更の場合
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            For w_Row = w_StartRow To w_EndRow
                                If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                    '実績段非表示の時はセルブロックで貼り付け可能
                                ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                    '勤務のみ貼り付け
                                    For w_Col = w_StartCol To w_EndCol

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        w_Text = w_Var

                                        '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If IsNumeric(w_Var) = True Then
                                            w_StaffIdx = Integer.Parse(w_Var)
                                            '1ｹ月/1ｹ月,4週/4週の場合
                                            w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                            w_Cnt = w_Col - w_KeikakuCol + 1
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                            Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                            '2015/04/10 Bando Upd End   =========================================
                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse w_RiyuKBN <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN OrElse w_KangoCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).OuenKangoCD Then

                                                '勤務CDが予定と異なる場合
                                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                                                If m_blnJissekiUseFlg = False Then
                                                    '一段表示の時
                                                    w_Var = .GetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col)
                                                    If w_Var = "" Then
                                                        '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                                        w_ColIdx = w_Col - w_StartCol
                                                        w_RowIdx = (w_Row - w_StartRow) \ m_MaxShowLine

                                                        .SetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col, w_VarPlan(w_ColIdx, w_RowIdx))
                                                        .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore(w_ColIdx, w_RowIdx))
                                                        .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back(w_ColIdx, w_RowIdx))
                                                    End If
                                                End If
                                            Else
                                                '勤務CDが予定と同じ場合
                                                '通常
                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                            End If
                                        End If
                                    Next w_Col
                                End If
                            Next w_Row
                        End If
                    End If
                End With
            Else
                '4週画面表示中の場合

                ReDim w_KibouCol(0)
                ReDim w_CopyData_Kibou(0)
                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                ReDim w_CopyData_Kibou_Date(0)
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                If g_HopeNumFlg = "1" Then
                    'ｺﾋﾟｰ元の希望勤務回数を取得する
                    w_DataCnt = 0
                    For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                        If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            w_KibouCnt = 0
                            For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                    '希望勤務あり
                                    w_KibouChk = True
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_CopyData_Kibou(w_DataCnt)
                            w_CopyData_Kibou(w_DataCnt) = w_KibouCnt
                        End If
                    Next w_IntRow

                    If g_HopeNum = 0 AndAlso w_KibouChk = True Then
                        '希望勤務入力が不可のためｴﾗｰ
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望勤務入力が不可のため"
                        '「&1コピーできません。」
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If
                '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                If g_HopeNumDateFlg = "1" Then
                    'ｺﾋﾟｰ元の希望勤務回数を取得する
                    w_DataCnt = 0
                    For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                        If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            w_KibouCnt = 0
                            For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol
                                If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                    '希望勤務あり
                                    w_KibouChk = True
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_CopyData_Kibou(w_DataCnt)
                            w_CopyData_Kibou(w_DataCnt) = w_KibouCnt
                        End If
                    Next w_IntRow

                    w_DataCnt = 0
                    For w_IntCol = m_CopyData.StartCol To m_CopyData.EndCol

                        w_KibouCnt = 0

                        For w_IntRow = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_IntRow - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then

                                If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                                    w_KibouCnt = w_KibouCnt + 1
                                End If
                            End If
                        Next w_IntRow

                        ReDim Preserve w_CopyData_Kibou_Date(w_DataCnt)
                        w_CopyData_Kibou_Date(w_DataCnt) = w_KibouCnt
                        w_DataCnt = w_DataCnt + 1
                    Next w_IntCol

                    If g_HopeNumDate = 0 AndAlso w_KibouChk = True Then
                        '希望勤務入力が不可のためｴﾗｰ
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "希望勤務(日付別)入力が不可のため"
                        '「&1コピーできません。」
                        Call Set_MsgZOrder("NS0105", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                End If
                '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                w_DataCnt = 0

                With sprSheet_4W.Sheets(0)

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    w_StartCol = .ActiveColumn.Index
                    w_StartRow = .ActiveRow.Index
                    w_EndCol = w_StartCol + (m_CopyData.EndCol - m_CopyData.StartCol)
                    w_EndRow = w_StartRow + (m_CopyData.EndRow - m_CopyData.StartRow)

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            Exit Sub
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_StartRow) AndAlso (w_EndRow <= m_StaffRow.EndRow)) Then
                        'ERROR
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((w_KikanStartCol <= w_StartCol) AndAlso (w_EndCol <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                        'ERROR
                        Exit Sub
                    End If

                    'もし一段表示の隠し行に貼り付けようとした時
                    If m_blnJissekiUseFlg = False AndAlso (w_StartRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        'ERROR
                        ReDim w_strMsg(1)
                        w_strMsg(1) = "下段（隠し）側には"
                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    For w_Row = w_StartRow To w_EndRow
                        '基本的に制御されているが、もし二段表示の上段に貼り付けようとした時
                        If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            'ERROR
                            ReDim w_strMsg(1)
                            w_strMsg(1) = "上段（計画）側には"
                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                            Exit Sub
                        End If

                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックで貼り付け可能
                        ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ貼り付け

                            '該当職員のｺﾋﾟｰ先範囲外の希望勤務回数をｶｳﾝﾄする

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            '1ヶ月用列番号取得
                            If Get_Col_M(w_Var, w_Start_Col_M) = True Then
                            End If

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_EndCol)
                            If w_Var <> "" Then
                                w_Bool = True
                            Else
                                w_Bool = False
                            End If

                            '1ヶ月用列番号取得
                            If Get_Col_M(w_Var, w_End_Col_M) = True Then
                            End If

                            w_KibouCnt = 0
                            For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_Row, w_IntCol).BackColor) = m_Kibou_Back AndAlso (w_IntCol < w_Start_Col_M OrElse w_End_Col_M < w_IntCol) Then
                                    w_KibouCnt = w_KibouCnt + 1
                                End If
                            Next w_IntCol

                            w_DataCnt = w_DataCnt + 1
                            ReDim Preserve w_KibouCol(w_DataCnt)

                            w_KibouCol(w_DataCnt) = w_KibouCnt

                            For w_Col = w_StartCol To w_EndCol
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "他部署の勤務に"
                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                    'ERROR
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "確定済み勤務に"
                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                    Exit Sub
                                End If
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                    w_CurrentDate = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"))
                                    If Get_Col_4W(w_CurrentDate, w_Col_4W) = False Then
                                        w_Col_4W = m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol + 1
                                    End If

                                    '勤務変更
                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var = "" Then
                                        '勤務記号がないとき
                                        If w_Col_4W <= w_Col AndAlso w_Col <= m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol Then
                                            '計画期間外の4週部分のとき
                                        Else
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "勤務が確定されていないか他部署で確定されているため"
                                            If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                                '二段表示の下段を選択中の時
                                                w_Var = .GetText(w_Row - 1, w_Col)
                                                If w_Var = "" Then
                                                    '上段に勤務記号がないとき
                                                    Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                    Exit Sub
                                                End If
                                            Else
                                                '二段表示の上段を選択中、または一段表示の時
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                End If

                                w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If IsNumeric(w_Var) = True Then
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    '再掲部署の場合で実績ﾃﾞｰﾀの場合は貼り付け不可
                                    If g_SaikeiFlg = True Then
                                        '職員管理番号 取得
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            Else
                                                w_Cnt = 0
                                            End If
                                            If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "確定済み勤務に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    End If

                                    '日付を取得
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_YYYYMMDD = w_Var

                                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                            With General.g_objSyouninData
                                                .mKC_UNIQUESEQNO = ""
                                                .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                .mKC_TargetDate = w_YYYYMMDD
                                                If .mChkKinmuChange = False Then
                                                    ReDim w_strMsg(1)
                                                    'w_strMsg(1) = "時間外が既に登録されているため~n"
                                                    w_strMsg(1) = "届出が既に登録されているため~n" '#001
                                                    Call General.paMsgDsp("NS0110", w_strMsg)
                                                    Exit Sub
                                                End If
                                            End With
                                        End If

                                        If m_PackageFLG = 1 OrElse m_PackageFLG = 3 Then
                                            '日当直のコンポーネントありの時
                                            w_Col2 = w_Col - w_StartCol + m_CopyData.StartCol
                                            w_Row2 = w_Row - w_StartRow + m_CopyData.StartRow

                                            w_Var = .GetText(w_Row2, w_Col2)
                                            If w_Var <> "" Then
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                '2015/04/10 Bando Upd End   =========================================
                                            End If

                                            With General.g_objGetData
                                                .p職員区分 = 0
                                                .p職員番号 = m_StaffData(w_StaffIdx).ID
                                                .pチェック基準日 = w_YYYYMMDD
                                                .p処理区分 = 0
                                                .pチェック勤務CD = w_KinmuCD

                                                If .mChkKinmuDuty = False Then
                                                    '勤務変更不可
                                                    '*******ﾒｯｾｰｼﾞ***********************************
                                                    ReDim w_strMsg(1)
                                                    w_strMsg(1) = ""
                                                    Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                    '************************************************
                                                    Exit Sub
                                                End If
                                            End With
                                        End If

                                        If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                            '届出のコンポーネントありの時
                                            w_Row2 = w_Row - (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine

                                            w_Var = .GetText(w_Row2 + m_AppliData, w_Col)
                                            If w_Var <> "" Then
                                                Call Get_AppliMark(w_Var, w_UniqueSeqNO, "", "", "", 0, 0, "")

                                                With General.g_objSyouninData
                                                    .mKC_UNIQUESEQNO = w_UniqueSeqNO
                                                    .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                                    .mKC_TargetDate = w_YYYYMMDD

                                                    If .mChkKinmuChange = False Then
                                                        '勤務変更不可
                                                        '*******ﾒｯｾｰｼﾞ***********************************
                                                        ReDim w_strMsg(1)
                                                        w_strMsg(1) = ""
                                                        Call Set_MsgZOrder("NS0110", w_strMsg, w_MsgRc, 0)
                                                        '************************************************
                                                        Exit Sub
                                                    End If
                                                End With
                                            End If
                                        End If
                                    End If
                                End If

                                '休日・代休には貼り付けれないようにする
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If IsNumeric(w_Var) = True Then
                                        If InStr(m_HolDateStr, Convert.ToString(Integer.Parse(w_Var))) > 0 OrElse (m_SundayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 1) OrElse (m_SaturdayDaikyuFlg = 1 AndAlso Weekday(Date.Parse(Format(Integer.Parse(w_Var), "0000/00/00"))) = 7) Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "休日に"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        '2015/04/10 Bando Upd Start =========================================
                                        'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                        Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                        '2015/04/10 Bando Upd End   =========================================

                                        If w_KinmuCD <> "" Then
                                            If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(1) = "代休に"
                                                Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                Exit Sub
                                            End If
                                        End If
                                    ElseIf m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                        '勤務変更
                                        If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                            '二段表示の下段を選択中の時
                                            w_Var = .GetText(w_Row - 1, w_Col)
                                            If w_Var <> "" Then
                                                '2015/04/10 Bando Upd Start =========================================
                                                'Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "")
                                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                                                '2015/04/10 Bando Upd End   =========================================

                                                If w_KinmuCD <> "" Then
                                                    If g_KinmuM(Integer.Parse(w_KinmuCD)).HolBunruiCD = General.G_STRDAIKYUBUNRUI Then
                                                        ReDim w_strMsg(1)
                                                        w_strMsg(1) = "代休に"
                                                        Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)
                                                        Exit Sub
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row

                    '希望回数チェック
                    If g_HopeNumFlg = "1" Then
                        w_blnColChk = False
                        For w_DataCnt = 1 To UBound(w_CopyData_Kibou)
                            If w_CopyData_Kibou(w_DataCnt) + w_KibouCol(w_DataCnt) > g_HopeNum AndAlso w_KibouChk = True Then
                                w_blnColChk = True
                            End If
                        Next w_DataCnt

                        If w_blnColChk = True Then
                            '希望回数制限オーバーダイアログ表示
                            If g_KibouNumDiaLogFlg = 1 Then
                                'ワーニング
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "設定された希望勤務回数"
                                '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                                Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                                If w_MsgRc = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            Else
                                'エラー
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "設定された希望勤務回数を超えているため"
                                '「&1入力できません。」
                                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If
                    End If
                    '2014/05/14 Shimpo add start P-06991-----------------------------------------------------------------------
                    If g_HopeNumDateFlg = "1" Then

                        w_blnColChkDate = False
                        w_DataCnt = 0

                        For w_Col = w_StartCol To w_StartCol + (m_CopyData.EndCol - m_CopyData.StartCol)
                            w_KibouCntDate = 0
                            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                                '2014/05/27 Shibata add start P-06991-----------------------------------------------------------------------
                                If w_Row < w_StartRow OrElse w_Row > w_StartRow + (m_CopyData.EndRow - m_CopyData.StartRow) Then
                                    If (w_Row) Mod m_MaxShowLine = m_KinmuPlan Then
                                        If ColorTranslator.ToOle(sprSheet_4W.Sheets(0).Cells(w_Row, w_Col).BackColor) = m_Kibou_Back Then
                                            w_KibouCntDate = w_KibouCntDate + 1
                                        End If
                                    End If
                                End If
                                '2014/05/27 Shibata add end   P-06991-----------------------------------------------------------------------
                                If (w_KibouCntDate + w_CopyData_Kibou_Date(w_DataCnt)) > g_HopeNumDate AndAlso w_KibouChk = True Then
                                    w_blnColChkDate = True
                                End If
                            Next w_Row

                            w_DataCnt = w_DataCnt + 1
                        Next w_Col

                        If w_blnColChkDate = True Then
                            '希望回数制限オーバーダイアログ表示
                            If g_KibouNumDiaLogFlg = 1 Then
                                'ワーニング
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "希望勤務"
                                w_strMsg(2) = "設定された希望勤務(日付別)回数"
                                '「&1が&2を超えています。~nこのまま登録してもよろしいですか。」
                                Call Set_MsgZOrder("NS0150", w_strMsg, w_MsgRc, 0)
                                If w_MsgRc = MsgBoxResult.No Then
                                    Exit Sub
                                End If
                            Else
                                'エラー
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "設定された希望勤務(日付別)回数を超えているため"
                                '「&1入力できません。」
                                Call Set_MsgZOrder("NS0099", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If
                    End If
                    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------

                    'ｺﾋﾟｰﾃﾞｰﾀが空白のとき
                    w_ColCnt = 0
                    w_RowCnt = 0
                    For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックで貼り付け可能
                        ElseIf ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ貼り付け
                            For w_Col = m_CopyData.StartCol To m_CopyData.EndCol
                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var = "" Then
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_StartCol + w_ColCnt - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_StartCol + w_ColCnt)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                    End If

                                    '配列番号 取得
                                    w_Var = .GetText(w_StartRow + w_RowCnt, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If IsNumeric(w_Var) = True Then
                                        '職員管理番号 取得
                                        If m_StaffData(Integer.Parse(w_Var)).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "確定済み勤務に未割当は"
                                            Call Set_MsgZOrder("NS0107", w_strMsg, w_MsgRc, 0)

                                            Exit Sub
                                        End If
                                    End If
                                End If
                                w_ColCnt = w_ColCnt + 1
                            Next w_Col
                        End If
                        w_ColCnt = 0
                        w_RowCnt = w_RowCnt + 1
                    Next w_Row
                    '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
                    ''UndoData格納
                    ''2016/04/05 Ishiga upd start------------------
                    ''ReDim m_UndoData(0)
                    'm_UndoKaisu = m_UndoKaisu + 1
                    'If m_UndoMaxKensu < m_UndoKaisu Then
                    '    m_UndoKaisu = m_UndoMaxKensu
                    'End If

                    'm_UndoIdx = m_UndoIdx + 1
                    'm_UndoIdxHendou = m_UndoIdxHendou + 1
                    ''2016/04/05 Ishiga upd end--------------------

                    'ReDim m_KojyoUndoData(0)
                    ''Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                    ' ''全消去前の代休データを退避
                    ''If General.g_lngDaikyuMng = 0 Then
                    ''    Call Set_UndoDaikyuData(0)
                    ''End If
                    '----------------------------------------------------------------------------------------------------
                    w_Cnt = 0

                    '控除を取得している場合削除する
                    For w_Row = w_StartRow To w_EndRow
                        For w_Col = w_StartCol To w_EndCol

                            w_Cnt = w_Cnt + 1
                            'ReDim Preserve m_KojyoUndoData(w_Cnt) '2016/04/06 Yamanishi Del

                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            w_StaffIdx = Integer.Parse(w_Var)

                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                            w_CurrentDate = Integer.Parse(w_Var)

                            For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                If m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate Then
                                    'm_KojyoUndoData(w_Cnt) = m_StaffData(w_StaffIdx).Kojyo(w_Int) '2016/04/06 Yamanishi Del
                                    m_StaffData(w_StaffIdx).Kojyo(w_Int) = m_KojyoCopyData(w_Cnt)
                                    m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate

                                    Exit For
                                End If
                            Next

                            If w_Int > UBound(m_StaffData(w_StaffIdx).Kojyo) AndAlso m_KojyoCopyData(w_Cnt).lngDate <> 0 Then
                                ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_Int)
                                m_StaffData(w_StaffIdx).Kojyo(w_Int) = m_KojyoCopyData(w_Cnt)
                                m_StaffData(w_StaffIdx).Kojyo(w_Int).lngDate = w_CurrentDate
                            End If
                        Next w_Col
                    Next w_Row

                    If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '勤務変更
                        If m_blnJissekiUseFlg = False Then
                            '一段表示の時
                            w_ColIdx = w_EndCol - w_StartCol
                            w_RowIdx = (w_EndRow - w_StartRow) \ m_MaxShowLine
                            If w_ColIdx >= 0 AndAlso w_RowIdx >= 0 Then
                                ReDim w_Plan_Fore(w_ColIdx, w_RowIdx)
                                ReDim w_Plan_Back(w_ColIdx, w_RowIdx)
                                ReDim w_VarPlan(w_ColIdx, w_RowIdx)

                                For w_Row = w_StartRow To w_EndRow
                                    '一段表示の時はセルブロックで貼り付け可能
                                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                                        For w_Col = w_StartCol To w_EndCol
                                            '予定データをコピー前に保存しておく
                                            w_ColIdx = w_Col - w_StartCol
                                            w_RowIdx = (w_Row - w_StartRow) \ m_MaxShowLine

                                            w_Var = .GetText(w_Row, w_Col)
                                            w_VarPlan(w_ColIdx, w_RowIdx) = w_Var

                                            w_Plan_Fore(w_ColIdx, w_RowIdx) = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                            w_Plan_Back(w_ColIdx, w_RowIdx) = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)
                                        Next w_Col
                                    End If
                                Next w_Row
                            End If
                        End If
                    End If

                    '-- COPYﾃﾞｰﾀを ｱｸﾃｨﾌﾞｾﾙに ｺﾋﾟｰ --------
                    If m_MaxShowLine > 1 Then
                        For w_Row = m_CopyData.StartRow To m_CopyData.EndRow
                            If ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_CopyData.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                                '勤務のみ貼り付け

                                'ｺﾋﾟｰ実行
                                .CopyRange(w_Row, m_CopyData.StartCol, w_StartRow + w_Row - m_CopyData.StartRow, w_StartCol, 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)
                            End If
                        Next w_Row
                    Else
                        'ｺﾋﾟｰ実行
                        .CopyRange(m_CopyData.StartRow, m_CopyData.StartCol, w_StartRow, w_StartCol, m_CopyData.EndRow - m_CopyData.StartRow + 1, m_CopyData.EndCol - m_CopyData.StartCol + 1, False)
                    End If

                    For w_Row = w_StartRow To w_EndRow
                        If m_blnJissekiUseFlg = False AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                            '実績段非表示の時はセルブロックで貼り付け可能
                        ElseIf ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ貼り付け
                            For w_Col = w_StartCol To w_EndCol

                                w_blnFLG = False '初期化

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                w_Text = w_Var

                                '勤務変更の場合
                                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then

                                    '比較対象となる配列ｲﾝﾃﾞｯｸｽ格納
                                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If IsNumeric(w_Var) = True Then
                                        w_StaffIdx = Integer.Parse(w_Var)
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_CurrentDate = Integer.Parse(w_Var)
                                        End If
                                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_CurrentDate, w_GetCol) = True Then
                                            w_Cnt = w_GetCol - w_KeikakuCol + 1
                                        Else
                                            w_Cnt = 0
                                        End If
                                        If w_Var <= m_KeikakuKikan.EndDate Then
                                            '2015/04/10 Bando Upd Start =========================================
                                            'Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                                            Call Get_KinmuMark(w_Text, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, "")
                                            '2015/04/10 Bando Upd End   =========================================
                                            If w_KinmuCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).KinmuCD OrElse w_RiyuKBN <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).RiyuKBN OrElse w_KangoCD <> m_StaffData(w_StaffIdx).CompKinmuData(w_Cnt).OuenKangoCD Then
                                                '勤務CDが予定と異なる場合
                                                .Cells(w_Row, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore) '予定⇒実績変更勤務  文字色

                                                If m_blnJissekiUseFlg = False Then
                                                    '一段表示の時
                                                    w_Var = .GetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col)
                                                    If w_Var = "" Then
                                                        '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                                        w_ColIdx = w_Col - w_StartCol
                                                        w_RowIdx = (w_Row - w_StartRow) \ m_MaxShowLine

                                                        .SetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col, w_VarPlan(w_ColIdx, w_RowIdx))
                                                        .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).ForeColor = ColorTranslator.FromOle(w_Plan_Fore(w_ColIdx, w_RowIdx))
                                                        .Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col).BackColor = ColorTranslator.FromOle(w_Plan_Back(w_ColIdx, w_RowIdx))
                                                        w_blnFLG = True
                                                    End If
                                                End If
                                            Else
                                                '勤務CDが予定と同じ場合
                                                '通常
                                                .Cells(w_Row, w_Col).ForeColor = Color.Black
                                            End If
                                        Else
                                            '勤務CDが予定と同じ場合
                                            '通常
                                            .Cells(w_Row, w_Col).ForeColor = Color.Black
                                        End If
                                    End If
                                End If

                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                '1ヶ月用列番号取得
                                If Get_Col_M(w_Var, w_Col_M) = True Then
                                    sprSheet_M.Sheets(0).SetText(w_Row, w_Col_M, w_Text)
                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col_M).BackColor = ColorTranslator.FromOle(w_BackColor)

                                    If w_blnFLG Then
                                        '一段表示の時
                                        w_Var = sprSheet_M.Sheets(0).GetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_M)
                                        If w_Var = "" Then
                                            '「予定」＝「実績」という状態の時、予定のデータは下段に保存しておく
                                            sprSheet_M.Sheets(0).SetText(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_M, w_VarPlan(w_ColIdx, w_RowIdx))
                                            sprSheet_M.Sheets(0).Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_M).ForeColor = ColorTranslator.FromOle(w_Plan_Fore(w_ColIdx, w_RowIdx))
                                            sprSheet_M.Sheets(0).Cells(w_Row + m_KinmuJisseki - m_KinmuPlan, w_Col_M).BackColor = ColorTranslator.FromOle(w_Plan_Back(w_ColIdx, w_RowIdx))
                                        End If
                                    End If
                                End If
                            Next w_Col
                        End If
                    Next w_Row
                End With
            End If

            'セルの罫線を初期化
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                '貼り付け先の罫線を初期化する。
                Call SetBorder(sprSheet_M, w_StartRow, w_StartCol, w_EndRow, w_EndCol, 1, 1, 1, 1, 0, Color.Black)

                'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                For w_Row = w_StartRow To w_EndRow
                    If m_MaxShowLine > 1 AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                        '--------------------
                        '背景色を元に戻す
                        '--------------------
                        '明細の背景色を元に戻す
                        Call SetBorder(sprSheet_M, w_Row, M_KinmuDataStart_Col, w_Row, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                    End If

                    For w_Col = w_StartCol To w_EndCol
                        If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                            Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                        ElseIf w_Row = m_Row Then  '選択セルと同行
                            Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                        ElseIf w_Col = m_Col Then  '選択セルと同列
                            Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                        End If
                    Next w_Col
                Next w_Row
            Else
                '4週画面表示中の場合

                '貼り付け先の罫線を初期化する。
                Call SetBorder(sprSheet_4W, w_StartRow, w_StartCol, w_EndRow, w_EndCol, 1, 1, 1, 1, 0, Color.Black)

                'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                For w_Row = w_StartRow To w_EndRow
                    If m_MaxShowLine > 1 AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_MaxShowLine - 1 Then
                        '--------------------
                        '背景色を元に戻す
                        '--------------------
                        '明細の背景色を元に戻す
                        Call SetBorder(sprSheet_4W, w_Row, M_KinmuDataStart_Col, w_Row, m_KeikakuKikan.KinmuDataEndCol, 0, 2, 0, 0, 0, Color.Black)
                    End If

                    For w_Col = w_StartCol To w_EndCol
                        If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                            Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                        ElseIf w_Row = m_Row Then  '選択セルと同行
                            Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                        ElseIf w_Col = m_Col Then  '選択セルと同列
                            Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                        End If
                    Next w_Col
                Next w_Row
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '元に戻す
    '2016/04/05 Ishiga upd start-------------------
    'Private Sub UndoData()
    Private Sub UndoData(ByVal p_index As Integer)
        '2016/04/05 Ishiga upd end-----------------

        Const W_SUBNAME As String = "NSK0000HA UndoData"

        'Dim w_Int As Integer '2016/04/06 Yamanishi Del
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Row As Integer
        Dim w_Bool As Boolean
        Dim w_Var As Object
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_Text As Object
        Dim w_StartCol As Integer
        Dim w_Cnt As Integer
        '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
        'Dim w_StaffIdx As Integer
        'Dim w_CurrentDate As Integer
        'Dim w_Lng As Integer
        '----------------------------------------------------------------------------------------------------
        '2016/04/05 Ishiga add start---
        Dim w_StCol As Integer
        Dim w_EdCol As Integer
        '2016/04/05 Ishiga add end-----
        Try
            '2016/04/05 Ishiga add start-----------------------
            ''元に戻し中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            'sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_ROLLBACK_STR
            'sbrMain.Refresh()
            '2016/04/06 Yamanishi Add ---------------------------------------------------------------------------
            '退避用控除データができていない可能性を考慮（パッとは思いつきませんが、念のため…）
            w_Cnt = UBound(m_UndoArea(m_UndoIdxHendou).UndoKojyo)
            If w_Cnt = 0 Then
                For i As Integer = 1 To UBound(m_StaffData)
                    If UBound(m_StaffData(i).Kojyo) > 0 Then
                        w_Cnt += 1
                        ReDim Preserve m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt)
                        m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt).StaffMngID = m_StaffData(i).ID
                        m_UndoArea(m_UndoIdxHendou).UndoKojyo(w_Cnt).Data = General.paDeepCopy(m_StaffData(i).Kojyo)
                    End If
                Next i
            End If
            '同じく代休データ
            If General.g_lngDaikyuMng = 0 Then
                w_Cnt = UBound(m_UndoArea(m_UndoIdxHendou).UndoDaikyu)
                If w_Cnt = 0 Then
                    For i As Integer = 1 To UBound(m_StaffData)
                        If UBound(m_StaffData(i).Daikyu) > 0 Then
                            w_Cnt += 1
                            ReDim Preserve m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt)
                            m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt).StaffMngID = m_StaffData(i).ID
                            m_UndoArea(m_UndoIdxHendou).UndoDaikyu(w_Cnt).Data = General.paDeepCopy(m_StaffData(i).Daikyu)
                        End If
                    Next i
                End If
            End If
            '----------------------------------------------------------------------------------------------------
            If p_index = 0 Then
                '元に戻す
                '元に戻し中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_ROLLBACK_STR
                sbrMain.Refresh()

                m_UndoIdx = m_UndoIdx - 1
                If m_UndoMaxKensu >= m_UndoIdx Then
                    m_UndoIdxHendou = m_UndoIdx

                ElseIf m_UndoIdx Mod m_UndoMaxKensu = 0 Then
                    m_UndoIdxHendou = m_UndoMaxKensu Mod m_UndoIdx
                Else
                    m_UndoIdxHendou = m_UndoIdxHendou - 1
                End If

                If m_RedoCnt = 0 Then
                    m_RedoCnt = m_UndoKaisu
                End If
                m_UndoKaisu = m_UndoKaisu - 1
            ElseIf p_index = 1 Then
                'やり直す
                'やり直し中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
                sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_REDO_STR
                sbrMain.Refresh()

                m_UndoIdx = m_UndoIdx + 1
                If m_UndoIdx > m_UndoMaxKensu Then

                    If m_UndoIdx Mod m_UndoMaxKensu = 0 Then
                        m_UndoIdxHendou = m_UndoMaxKensu Mod m_UndoIdx
                    Else
                        m_UndoIdxHendou = m_UndoIdx Mod m_UndoMaxKensu
                    End If

                    If m_UndoIdxHendou = 0 Then
                        m_UndoIdxHendou = 1
                    End If
                Else
                    m_UndoIdxHendou = m_UndoIdx
                End If
                m_UndoKaisu = m_UndoKaisu + 1
            End If
            '2016/04/06 Yamanishi Add ---------------------------------------------------------------------------
            '退避用控除から控除を復活させる
            For i As Integer = 1 To UBound(m_StaffData)
                ReDim m_StaffData(i).Kojyo(0)
                For j As Integer = 1 To UBound(m_UndoArea(m_UndoIdxHendou).UndoKojyo)
                    If m_StaffData(i).ID = m_UndoArea(m_UndoIdxHendou).UndoKojyo(j).StaffMngID Then
                        m_StaffData(i).Kojyo = General.paDeepCopy(m_UndoArea(m_UndoIdxHendou).UndoKojyo(j).Data)
                    End If
                Next j
            Next i
            '同じく代休データ
            If General.g_lngDaikyuMng = 0 Then
                For i As Integer = 1 To UBound(m_StaffData)
                    ReDim m_StaffData(i).Daikyu(0)
                    For j As Integer = 1 To UBound(m_UndoArea(m_UndoIdxHendou).UndoDaikyu)
                        If m_StaffData(i).ID = m_UndoArea(m_UndoIdxHendou).UndoDaikyu(j).StaffMngID Then
                            m_StaffData(i).Daikyu = General.paDeepCopy(m_UndoArea(m_UndoIdxHendou).UndoDaikyu(j).Data)
                        End If
                    Next j
                Next i
            End If
            '----------------------------------------------------------------------------------------------------
            Get_Col_4W(m_KeikakuKikan.StartDate, w_StCol)
            Get_Col_4W(m_KeikakuKikan.EndDate, w_EdCol)
            '2016/04/05 Ishiga add end-------------------------

            If m_SelViewKikan = 0 Then
                '1ｹ月/1ｹ月,4週/4週期間表示中のとき

                With sprSheet_M.Sheets(0)

                    '2016/04/05 Ishiga upd start--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                    'For w_Int = 1 To UBound(m_UndoData)
                    '    'ｺﾋﾟｰ実行
                    '    .CopyRange(m_UndoData(w_Int).StartRow, m_UndoData(w_Int).StartCol, m_UndoData(w_Int).MotoStartRow, m_UndoData(w_Int).MotoStartCol, _
                    '                m_UndoData(w_Int).EndRow - m_UndoData(w_Int).StartRow + 1, m_UndoData(w_Int).EndCol - m_UndoData(w_Int).StartCol + 1, False)

                    '    Call SetBorder(sprSheet_M, m_UndoData(w_Int).MotoStartRow, m_UndoData(w_Int).MotoStartCol, m_UndoData(w_Int).MotoEndRow, m_UndoData(w_Int).MotoEndCol, 1, 1, 1, 1, 0, Color.Black)

                    '    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    '    For w_Row = m_UndoData(w_Int).MotoStartRow To m_UndoData(w_Int).MotoEndRow
                    '        For w_Col = m_UndoData(w_Int).MotoStartCol To m_UndoData(w_Int).MotoEndCol


                    'ｺﾋﾟｰ実行
                    .CopyRange(m_UndoArea(m_UndoIdxHendou).StartRow, m_KeikakuKikan.KinmuDataStartCol, m_StaffRow.StartRow, m_KeikakuKikan.KinmuDataStartCol,
                                (m_StaffRow.EndRow - m_StaffRow.StartRow) + 1, (m_KeikakuKikan.KinmuDataEndCol - m_KeikakuKikan.KinmuDataStartCol) + 1, False)

                    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                            '2016/04/05 Ishiga upd end----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                            If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                            ElseIf w_Row = m_Row Then  '選択セルと同行
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                            ElseIf w_Col = m_Col Then  '選択セルと同列
                                Call SetBorder(sprSheet_M, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                            End If
                            '2016/04/06 Yamanishi Del ----------------------------------------------------------------------
                            ''控除データも元に戻す
                            'If UBound(m_KojyoUndoData) > 0 Then
                            '    w_Cnt = w_Cnt + 1
                            '    If w_Cnt > UBound(m_KojyoUndoData) Then
                            '        w_Cnt = 1
                            '    End If

                            '    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            '    w_StaffIdx = Integer.Parse(w_Var)

                            '    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                            '    w_CurrentDate = Integer.Parse(w_Var)

                            '    For w_Lng = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                            '        If m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate Then
                            '            '配列初期化
                            '            m_StaffData(w_StaffIdx).Kojyo(w_Lng).init()

                            '            If m_KojyoUndoData(w_Cnt).lngDate <> 0 Then
                            '                m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoUndoData(w_Cnt)
                            '                m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate
                            '            End If

                            '            Exit For
                            '        End If
                            '    Next
                            'End If
                            '-----------------------------------------------------------------------------------------------
                        Next w_Col
                    Next w_Row

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合
                        '2016/04/05 Ishiga upd start-------------------------------------------------------------------------------------------------------
                        'For w_Row = m_UndoData(w_Int).MotoStartRow To m_UndoData(w_Int).MotoEndRow
                        '    For w_Col = m_UndoData(w_Int).MotoStartCol To m_UndoData(w_Int).MotoEndCol

                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                '2016/04/05 Ishiga upd end-------------------------------------------------------------------------------------------------

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                w_Text = w_Var

                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                If Get_Col_4W(w_Var, w_Col2) = True Then
                                    sprSheet_4W.Sheets(0).SetText(w_Row, w_Col2, w_Text)
                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                    sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                End If
                            Next w_Col
                        Next w_Row
                    End If
                    'Next w_Int

                    'UNDOﾃﾞｰﾀの位置情報 退避変数 初期化
                    'ReDim m_UndoData(0)'2016/04/05 Ishiga del
                    'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del
                End With
            Else
                '4週期間表示中のとき

                With sprSheet_4W.Sheets(0)

                    '2016/04/05 Ishiga upd start----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                    'For w_Int = 1 To UBound(m_UndoData)
                    '    'ｺﾋﾟｰ実行
                    '    .CopyRange(m_UndoData(w_Int).StartRow, m_UndoData(w_Int).StartCol, m_UndoData(w_Int).MotoStartRow, m_UndoData(w_Int).MotoStartCol, _
                    '                                    m_UndoData(w_Int).EndRow - m_UndoData(w_Int).StartRow + 1, m_UndoData(w_Int).EndCol - m_UndoData(w_Int).StartCol + 1, False)

                    '    Call SetBorder(sprSheet_4W, m_UndoData(w_Int).MotoStartRow, m_UndoData(w_Int).MotoStartCol, m_UndoData(w_Int).MotoEndRow, m_UndoData(w_Int).MotoEndCol, 1, 1, 1, 1, 0, Color.Black)

                    '    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    '    For w_Row = m_UndoData(w_Int).MotoStartRow To m_UndoData(w_Int).MotoEndRow
                    '        For w_Col = m_UndoData(w_Int).MotoStartCol To m_UndoData(w_Int).MotoEndCol

                    'ｺﾋﾟｰ実行
                    .CopyRange(m_UndoArea(m_UndoIdxHendou).StartRow, w_StCol, m_StaffRow.StartRow, w_StCol,
                                (m_StaffRow.EndRow - m_StaffRow.StartRow) + 1, (w_EdCol - w_StCol) + 1, False)

                    'ﾏｳｽで選択されている行・列のみ赤線を設定し直す。
                    For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                        For w_Col = w_StCol To w_EdCol
                            '2016/04/05 Ishiga upd end------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                            If w_Row = m_Row AndAlso w_Col = m_Col Then '選択セル
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 2, 0, Color.Red)
                            ElseIf w_Row = m_Row Then  '選択セルと同行
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 2, 0, 0, 0, Color.Red)
                            ElseIf w_Col = m_Col Then  '選択セルと同列
                                Call SetBorder(sprSheet_4W, w_Row, w_Col, w_Row, w_Col, 0, 0, 0, 2, 0, Color.Red)
                            End If
                            '2016/04/06 Yamanishi Del ----------------------------------------------------------------------
                            ''控除データも元に戻す
                            'If UBound(m_KojyoUndoData) > 0 Then
                            '    w_Cnt = w_Cnt + 1
                            '    If w_Cnt > UBound(m_KojyoUndoData) Then
                            '        w_Cnt = 1
                            '    End If

                            '    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            '    w_StaffIdx = Integer.Parse(w_Var)

                            '    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)

                            '    If w_Var <> "" Then '2016/04/05 Ishiga add
                            '        w_CurrentDate = Integer.Parse(w_Var)

                            '        For w_Lng = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                            '            If m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate Then
                            '                '配列初期化
                            '                m_StaffData(w_StaffIdx).Kojyo(w_Lng).init()

                            '                If m_KojyoUndoData(w_Cnt).lngDate <> 0 Then
                            '                    m_StaffData(w_StaffIdx).Kojyo(w_Lng) = m_KojyoUndoData(w_Cnt)
                            '                    m_StaffData(w_StaffIdx).Kojyo(w_Lng).lngDate = w_CurrentDate
                            '                End If

                            '                Exit For
                            '            End If
                            '        Next
                            '    End If '2016/04/05 Ishiga add
                            'End If
                            '-----------------------------------------------------------------------------------------------
                        Next w_Col
                    Next w_Row

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ｹ月の場合

                        '2016/04/05 Ishiga upd start----------------------------------------------------------------------------------------------------
                        'For w_Row = m_UndoData(w_Int).MotoStartRow To m_UndoData(w_Int).MotoEndRow
                        '    For w_Col = m_UndoData(w_Int).MotoStartCol To m_UndoData(w_Int).MotoEndCol

                        For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                            For w_Col = w_StCol To w_EdCol
                                '2016/04/05 Ishiga upd end----------------------------------------------------------------------------------------------

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                w_Text = w_Var

                                w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)


                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                '1ヶ月用列番号取得
                                '*/*/*/*/*/*/*/*/*/*/*/
                                If Get_Col_M(w_Var, w_Col2) = True Then
                                    sprSheet_M.Sheets(0).SetText(w_Row, w_Col2, w_Text)
                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = ColorTranslator.FromOle(w_ForeColor)
                                    sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = ColorTranslator.FromOle(w_BackColor)
                                End If
                            Next w_Col
                        Next w_Row
                    End If
                    'Next w_Int

                    'UNDOﾃﾞｰﾀの位置情報 退避変数 初期化
                    'ReDim m_UndoData(0) '2016/04/05 Ishiga del
                    'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''代休退避データを取得
            'If General.g_lngDaikyuMng = 0 Then
            '    Call Set_UndoDaikyuData(1)
            'End If
            '----------------------------------------------------------------------------------------------------
            '2016/04/05 Ishiga upd start------------------
            ''元に戻す使用不可
            'm_lstmnuEdit(M_MenuUndo).Enabled = False

            ''ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
            'm_lstmnuPopup(M_PopUndo).Enabled = False

            'Undoの制御
            If m_UndoKaisu - 1 = 0 Then
                '元に戻す使用不可
                m_lstmnuEdit(M_MenuUndo).Enabled = False

                'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
                m_lstmnuPopup(M_PopUndo).Enabled = False
            Else
                '元に戻す使用可
                m_lstmnuEdit(M_MenuUndo).Enabled = True

                'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用可
                m_lstmnuPopup(M_PopUndo).Enabled = True
            End If

            'Redoの制御
            If m_RedoCnt = m_UndoKaisu Then
                'やり直し使用不可
                m_lstmnuEdit(M_MenuRedo).Enabled = False

                'ﾎﾟｯﾌﾟｱｯﾌﾟやり直し使用不可
                m_lstmnuPopup(M_PopRedo).Enabled = False

                m_RedoCnt = 0
            Else
                'やり直し使用可
                m_lstmnuEdit(M_MenuRedo).Enabled = True

                'ﾎﾟｯﾌﾟｱｯﾌﾟやり直し使用可
                m_lstmnuPopup(M_PopRedo).Enabled = True
            End If
            '2016/04/05 Ishiga upd end--------------------

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '全消去
    Private Sub DeleteAllData()

        Const W_SUBNAME As String = "NSK0000HA DeleteAllData"

        Dim w_TaishoFlg As Boolean
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Row As Integer
        Dim w_Lng As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_Bool As Boolean
        Dim w_Text As Object
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_KikanStartCol As Integer
        Dim w_StaffIdx As Integer
        Dim w_NotDelFlg As Boolean
        Dim w_GetCol As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_CellRange() As Model.CellRange
        Try
            '確認ﾒｯｾｰｼﾞ表示
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '計画変更
                ReDim w_strMsg(1)
                w_strMsg(1) = "~n（確定済み勤務は消去されません。）"
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '計画新規
                ReDim w_strMsg(1)
                w_strMsg(1) = ""
                '#001-----St
                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                    w_strMsg(1) = "~n（届出申請済み勤務は消去されません。）"
                End If
                '#001-----Ed
            Else
                '勤務変更（使用不可）
                Exit Sub
            End If

            Call Set_MsgZOrder("NS0109", w_strMsg, w_MsgRc, 0)

            If w_MsgRc = MsgBoxResult.No Then
                Exit Sub
            End If

            '消去中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_DELTE_STR
            sbrMain.Refresh()
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''UndoData格納用配列　定義
            ''2016/04/05 Ishiga upd start------------------
            ''ReDim m_UndoData(0)
            'm_UndoKaisu = m_UndoKaisu + 1
            'If m_UndoMaxKensu < m_UndoKaisu Then
            '    m_UndoKaisu = m_UndoMaxKensu
            'End If

            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            ''2016/04/05 Ishiga upd end--------------------
            ''2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''ReDim m_KojyoUndoData(0)
            '----------------------------------------------------------------------------------------------------
            ''全消去前の代休データを退避
            'If General.g_lngDaikyuMng = 0 Then
            '    Call Set_UndoDaikyuData(0)
            'End If
            '----------------------------------------------------------------------------------------------------
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                With sprSheet_M.Sheets(0)

                    .ClearSelection()

                    '選択範囲設定（他部署の勤務、実績データは選択しない）
                    w_TaishoFlg = False
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ消去

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                '配属期間内か ?
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                    '配属期間外のとき

                                    If w_TaishoFlg = True Then
                                        '現在選択されているセルブロックを取得し、内部に保持
                                        .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                        .SetActiveCell(w_Row, w_StartCol, False)

                                        '対象ﾌﾗｸﾞをOFFにする
                                        w_TaishoFlg = False
                                    End If
                                Else
                                    '配属期間内の場合

                                    '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                    w_Cnt = -1
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col) '#001
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_Var, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            End If
                                        End If
                                    End If

                                    w_NotDelFlg = False
                                    If w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            '実績ﾃﾞｰﾀの場合
                                            w_NotDelFlg = True
                                        End If
                                    ElseIf w_StaffIdx <> -1 AndAlso w_Cnt <> -1 AndAlso g_SaikeiFlg = False Then
                                        '再掲部署以外の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            w_NotDelFlg = True
                                        End If
                                    End If
                                    '#001-----St
                                    '届出チェック
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        With General.g_objSyouninData
                                            .mKC_UNIQUESEQNO = ""
                                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                            .mKC_TargetDate = w_Var

                                            If .mChkKinmuChange = False Then
                                                w_NotDelFlg = True
                                            End If
                                        End With
                                    End If
                                    '#001-----Ed
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_ALL_CHK, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "代休を取得しているため"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                    '控除データを削除
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If
                                    If IsNumeric(w_Var) = True Then
                                        w_strKojyoData = ""
                                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                                                '配列初期化
                                                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                                Exit For
                                            End If
                                        Next
                                    End If

                                    If w_NotDelFlg = True Then
                                        '消去不可の場合
                                        If w_TaishoFlg = True Then
                                            '現在選択されているセルブロックを取得し、内部に保持
                                            .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                            .SetActiveCell(w_Row, w_StartCol, False)

                                            w_TaishoFlg = False
                                        End If
                                    Else
                                        If w_TaishoFlg = False Then
                                            w_TaishoFlg = True
                                            w_StartCol = w_Col
                                        End If
                                        w_EndCol = w_Col
                                    End If
                                End If
                            Next w_Col

                            If w_TaishoFlg = True Then
                                '現在選択されているセルブロックを取得し、内部に保持
                                .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                .SetActiveCell(w_Row, w_StartCol, False)

                                w_TaishoFlg = False
                            End If
                        End If
                    Next w_Row

                    '選択されているセルブロックを取得
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 Then
                        If General.g_lngDaikyuMng = 0 Then
                            '代休ﾁｪｯｸ
                            For w_Lng = 0 To w_CellRange.Length - 1

                                '選択ｾﾙの大きさ
                                w_StartCol = w_CellRange(w_Lng).Column
                                w_StartRow = w_CellRange(w_Lng).Row
                                w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                                w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                                For w_Int2 = w_StartRow To w_EndRow
                                    w_StaffIdx = -1
                                    w_Var = .GetText(w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If IsNumeric(w_Var) = True Then
                                        'ｲﾝﾃﾞｯｸｽ取得
                                        w_StaffIdx = Integer.Parse(w_Var)
                                    End If

                                    For w_Int3 = w_StartCol To w_EndCol
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Int3)
                                        If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                            w_YYYYMMDD = Integer.Parse(w_Var)
                                            If Check_Daikyu(M_ALLDELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                                Exit Sub
                                            End If
                                        End If
                                    Next w_Int3
                                Next w_Int2
                            Next w_Lng
                        End If

                        For w_Lng = 0 To w_CellRange.Length - 1

                            '選択ｾﾙの大きさ
                            w_StartCol = w_CellRange(w_Lng).Column
                            w_StartRow = w_CellRange(w_Lng).Row
                            w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                            w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                            'UndoData格納
                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                            '値 消去
                            .ClearRange(w_CellRange(w_Lng).Row, w_CellRange(w_Lng).Column, w_CellRange(w_Lng).RowCount, w_CellRange(w_Lng).ColumnCount, False)

                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合

                                For w_Row = w_StartRow To w_EndRow
                                    For w_Col = w_StartCol To w_EndCol

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        w_Text = w_Var

                                        w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                        w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        If Get_Col_4W(w_Var, w_Col2) = True Then
                                            sprSheet_4W.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                            If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                            Else
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                            End If
                                        End If
                                    Next w_Col
                                Next w_Row
                            End If
                        Next w_Lng
                    ElseIf w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1) Then

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1

                        If General.g_lngDaikyuMng = 0 Then
                            For w_Int2 = w_StartRow To w_EndRow
                                w_StaffIdx = -1
                                w_Var = .GetText(w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If IsNumeric(w_Var) = True Then
                                    'ｲﾝﾃﾞｯｸｽ取得
                                    w_StaffIdx = Integer.Parse(w_Var)
                                End If

                                For w_Int3 = w_StartCol To w_EndCol
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Int3)
                                    If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_ALLDELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            Exit Sub
                                        End If
                                    End If
                                Next w_Int3
                            Next w_Int2
                        End If

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '値 消去
                        .ClearRange(w_CellRange(0).Row, w_CellRange(0).Column, w_CellRange(0).RowCount, w_CellRange(0).ColumnCount, False)

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合
                            For w_Row = w_StartRow To w_EndRow
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    w_Text = w_Var

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    If Get_Col_4W(w_Var, w_Col2) = True Then
                                        sprSheet_4W.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                        If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                        Else
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                        End If
                                    End If
                                Next w_Col
                            Next w_Row
                        End If
                    End If

                    .ClearSelection()
                End With
            Else
                '4週期間表示のとき
                With sprSheet_4W.Sheets(0)

                    'ｾﾙﾌﾞﾛｯｸの選択を解除
                    .ClearSelection()

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    '選択範囲設定（他部署の勤務、実績データは選択しない）
                    w_TaishoFlg = False
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ消去

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = w_KikanStartCol To m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol

                                '配属期間内か ?
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                    '配属期間外または、計画期間外確定データのとき
                                    If w_TaishoFlg = True Then
                                        '現在選択されているセルブロックを取得し、内部に保持
                                        .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                        .SetActiveCell(w_Row, w_StartCol, False)

                                        w_TaishoFlg = False
                                    End If
                                Else
                                    '配属期間内の場合

                                    '4週/1ｹ月の場合
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If

                                    w_NotDelFlg = False
                                    If w_StaffIdx <> -1 AndAlso g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            w_NotDelFlg = True
                                        End If
                                    ElseIf w_StaffIdx <> -1 AndAlso g_SaikeiFlg = False Then
                                        '再掲部署以外の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            w_NotDelFlg = True
                                        End If
                                    End If
                                    '#001-----St
                                    '届出チェック
                                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        With General.g_objSyouninData
                                            .mKC_UNIQUESEQNO = ""
                                            .mKC_StaffMngID = m_StaffData(w_StaffIdx).ID
                                            .mKC_TargetDate = w_Var

                                            If .mChkKinmuChange = False Then
                                                w_NotDelFlg = True
                                            End If
                                        End With
                                    End If
                                    '#001-----Ed
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_ALL_CHK, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            ReDim w_strMsg(1)
                                            w_strMsg(1) = "代休を取得しているため"
                                            Call Set_MsgZOrder("NS0098", w_strMsg, w_MsgRc, 0)
                                            Exit Sub
                                        End If
                                    End If

                                    'ReDim Preserve m_KojyoUndoData(UBound(m_KojyoUndoData) + 1) '2016/04/06 Yamanishi Del

                                    '控除データを削除
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_CurrentDate = Integer.Parse(w_Var)
                                    End If

                                    If IsNumeric(w_Var) = True Then
                                        w_strKojyoData = ""
                                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                                'm_KojyoUndoData(UBound(m_KojyoUndoData)) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop) '2016/04/06 Yamanishi Del

                                                '配列初期化
                                                m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                                Exit For
                                            End If
                                        Next
                                    End If

                                    If w_NotDelFlg = True Then
                                        '実績データのとき
                                        If w_TaishoFlg = True Then
                                            '現在選択されているセルブロックを取得し、内部に保持
                                            .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                            .SetActiveCell(w_Row, w_StartCol, False)

                                            w_TaishoFlg = False
                                        End If
                                    Else
                                        If w_TaishoFlg = False Then
                                            w_TaishoFlg = True
                                            w_StartCol = w_Col
                                        End If
                                        w_EndCol = w_Col
                                    End If
                                End If
                            Next w_Col

                            If w_TaishoFlg = True Then
                                '現在選択されているセルブロックを取得し、内部に保持
                                .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                .SetActiveCell(w_Row, w_StartCol, False)

                                w_TaishoFlg = False
                            End If
                        End If
                    Next w_Row

                    '選択されているセルブロックを取得
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 Then
                        If General.g_lngDaikyuMng = 0 Then
                            '代休ﾁｪｯｸ
                            For w_Lng = 0 To w_CellRange.Length - 1

                                '選択ｾﾙの大きさ
                                w_StartCol = w_CellRange(w_Lng).Column
                                w_StartRow = w_CellRange(w_Lng).Row
                                w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                                w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                                For w_Int2 = w_StartRow To w_EndRow
                                    w_StaffIdx = -1
                                    w_Var = .GetText(w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If IsNumeric(w_Var) = True Then
                                        'ｲﾝﾃﾞｯｸｽ取得
                                        w_StaffIdx = Integer.Parse(w_Var)
                                    End If

                                    For w_Int3 = w_StartCol To w_EndCol
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Int3)
                                        If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                            w_YYYYMMDD = Integer.Parse(w_Var)
                                            If Check_Daikyu(M_ALLDELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                                Exit Sub
                                            End If
                                        End If
                                    Next w_Int3
                                Next w_Int2
                            Next w_Lng
                        End If

                        For w_Lng = 0 To w_CellRange.Length - 1

                            '選択ｾﾙの大きさ
                            w_StartCol = w_CellRange(w_Lng).Column
                            w_StartRow = w_CellRange(w_Lng).Row
                            w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                            w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                            'UndoData格納
                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                            '値 消去
                            .ClearRange(w_CellRange(w_Lng).Row, w_CellRange(w_Lng).Column, w_CellRange(w_Lng).RowCount, w_CellRange(w_Lng).ColumnCount, False)

                            For w_Row = w_StartRow To w_EndRow
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    w_Text = w_Var

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    '1ヶ月用列番号取得
                                    If Get_Col_M(w_Var, w_Col2) = True Then
                                        sprSheet_M.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                        If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                        Else
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                        End If
                                    End If
                                Next w_Col
                            Next w_Row
                        Next w_Lng
                    ElseIf w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1) Then

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1

                        If General.g_lngDaikyuMng = 0 Then
                            For w_Int2 = w_StartRow To w_EndRow
                                w_StaffIdx = -1
                                w_Var = .GetText(w_Int2, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If IsNumeric(w_Var) = True Then
                                    'ｲﾝﾃﾞｯｸｽ取得
                                    w_StaffIdx = Integer.Parse(w_Var)
                                End If

                                For w_Int3 = w_StartCol To w_EndCol
                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Int3)
                                    If IsNumeric(w_Var) = True AndAlso w_StaffIdx <> -1 Then
                                        w_YYYYMMDD = Integer.Parse(w_Var)
                                        If Check_Daikyu(M_ALLDELETE, w_YYYYMMDD, w_StaffIdx, "") = False Then
                                            Exit Sub
                                        End If
                                    End If
                                Next w_Int3
                            Next w_Int2
                        End If

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '値 消去
                        .ClearRange(w_CellRange(0).Row, w_CellRange(0).Column, w_CellRange(0).RowCount, w_CellRange(0).ColumnCount, False)

                        For w_Row = w_StartRow To w_EndRow
                            For w_Col = w_StartCol To w_EndCol

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                w_Text = w_Var

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                '1ヶ月用列番号取得
                                If Get_Col_M(w_Var, w_Col2) = True Then
                                    sprSheet_M.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                    If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                    Else
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                    End If
                                End If
                            Next w_Col
                        Next w_Row
                    End If

                    .ClearSelection()
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    ''' <summary>
    ''' 勤務記号消去（通常勤務のみ）
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub DeleteAllDataNormal()
        Const W_SUBNAME As String = "NSK0000HA DeleteAllDataNormal"

        Dim w_TaishoFlg As Boolean
        Dim w_Col As Integer
        Dim w_Col2 As Integer
        Dim w_Row As Integer
        Dim w_Lng As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_CurrentDate As Integer
        Dim w_KeikakuCol As Integer
        Dim w_Cnt As Integer
        Dim w_Bool As Boolean
        Dim w_Text As Object
        Dim w_ForeColor As Integer
        Dim w_BackColor As Integer
        Dim w_StartCol As Integer
        Dim w_EndCol As Integer
        Dim w_StartRow As Integer
        Dim w_EndRow As Integer
        Dim w_KikanStartCol As Integer
        Dim w_StaffIdx As Integer
        Dim w_NotDelFlg As Boolean
        Dim w_GetCol As Integer
        Dim w_Int2 As Integer
        Dim w_Int3 As Integer
        Dim w_YYYYMMDD As Integer
        Dim w_strMsg() As String
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Dim w_kojoFlg As Boolean
        Dim w_Int As Integer
        Dim w_CellRange() As Model.CellRange
        Try
            '確認ﾒｯｾｰｼﾞ表示
            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                '計画変更
                ReDim w_strMsg(1)
                w_strMsg(1) = "~n（確定済み勤務は消去されません。）"
            ElseIf m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                '計画新規
                ReDim w_strMsg(1)
                w_strMsg(1) = ""
            Else
                '勤務変更（使用不可）
                Exit Sub
            End If

            Call Set_MsgZOrder("NS0109", w_strMsg, w_MsgRc, 0)

            If w_MsgRc = MsgBoxResult.No Then
                Exit Sub
            End If

            '消去中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_DELTE_STR
            sbrMain.Refresh()
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''UndoData格納用配列　定義
            ''2016/04/05 Ishiga upd start--------------------
            ''ReDim m_UndoData(0)
            'm_UndoKaisu = m_UndoKaisu + 1
            'If m_UndoMaxKensu < m_UndoKaisu Then
            '    m_UndoKaisu = m_UndoMaxKensu
            'End If

            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            ''2016/04/05 Ishiga upd end----------------------

            'ReDim m_KojyoUndoData(0)

            ' ''全消去前の代休データを退避
            ''If General.g_lngDaikyuMng = 0 Then
            ''    Call Set_UndoDaikyuData(0)
            ''End If
            '----------------------------------------------------------------------------------------------------
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                With sprSheet_M.Sheets(0)

                    .ClearSelection()

                    '選択範囲設定（他部署の勤務、実績データは選択しない）
                    w_TaishoFlg = False
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ消去

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                                '控除データ
                                w_kojoFlg = False
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If IsNumeric(w_Var) AndAlso w_Var <> "" AndAlso (w_StaffIdx <> -1) Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                            w_kojoFlg = True
                                            Exit For
                                        End If
                                    Next

                                    '代休データ
                                    For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                        '代休取得済みであるかチェック
                                        For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = w_CurrentDate Then
                                                w_kojoFlg = True
                                                Exit For
                                            End If
                                        Next w_Int2
                                    Next w_Int
                                End If

                                '背景色で判断。色つきは削除しない
                                ''2015/07/22 Bando Upd Start ========================
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Yousei_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Kibou_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Saikei_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Iin_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Ouen_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Appli_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_KibouCom_Back) _
                                OrElse w_kojoFlg Then
                                    ''2015/07/22 Bando Upd End   ========================

                                    If w_TaishoFlg = True Then
                                        '現在選択されているセルブロックを取得し、内部に保持
                                        .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                        .SetActiveCell(w_Row, w_StartCol, False)

                                        '対象ﾌﾗｸﾞをOFFにする
                                        w_TaishoFlg = False
                                    End If
                                Else
                                    '上記以外

                                    '勤務ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                                    w_Cnt = -1
                                    If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                                        '1ｹ月/1ｹ月,4週/4週の場合
                                        w_KeikakuCol = m_KeikakuKikan.KinmuDataStartCol
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    ElseIf m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                        '4週/1ｹ月の場合
                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = True Then
                                            If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True AndAlso Get_Col_4W(w_Var, w_GetCol) = True Then
                                                w_Cnt = w_GetCol - w_KeikakuCol + 1
                                            End If
                                        End If
                                    End If

                                    If w_TaishoFlg = False Then
                                        w_TaishoFlg = True
                                        w_StartCol = w_Col
                                    End If
                                    w_EndCol = w_Col
                                End If
                            Next w_Col

                            If w_TaishoFlg = True Then
                                '現在選択されているセルブロックを取得し、内部に保持
                                .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                .SetActiveCell(w_Row, w_StartCol, False)

                                w_TaishoFlg = False
                            End If
                        End If
                    Next w_Row

                    '選択されているセルブロックを取得
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 Then

                        For w_Lng = 0 To w_CellRange.Length - 1

                            '選択ｾﾙの大きさ
                            w_StartCol = w_CellRange(w_Lng).Column
                            w_StartRow = w_CellRange(w_Lng).Row
                            w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                            w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                            'UndoData格納
                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                            '値 消去
                            .ClearRange(w_CellRange(w_Lng).Row, w_CellRange(w_Lng).Column, w_CellRange(w_Lng).RowCount, w_CellRange(w_Lng).ColumnCount, False)

                            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                                '4週/1ｹ月の場合

                                For w_Row = w_StartRow To w_EndRow
                                    For w_Col = w_StartCol To w_EndCol

                                        w_Var = .GetText(w_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        w_Text = w_Var

                                        w_ForeColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor)
                                        w_BackColor = ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor)

                                        w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var <> "" Then
                                            w_Bool = True
                                        Else
                                            w_Bool = False
                                        End If

                                        If Get_Col_4W(w_Var, w_Col2) = True Then
                                            sprSheet_4W.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                            If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                            Else
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                                sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                            End If
                                        End If
                                    Next w_Col
                                Next w_Row
                            End If
                        Next w_Lng
                    ElseIf w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1) Then

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '値 消去
                        .ClearRange(w_CellRange(0).Row, w_CellRange(0).Column, w_CellRange(0).RowCount, w_CellRange(0).ColumnCount, False)

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ｹ月の場合
                            For w_Row = w_StartRow To w_EndRow
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    w_Text = w_Var

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    If Get_Col_4W(w_Var, w_Col2) = True Then
                                        sprSheet_4W.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                        If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                        Else
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                            sprSheet_4W.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                        End If
                                    End If
                                Next w_Col
                            Next w_Row
                        End If
                    End If

                    .ClearSelection()
                End With
            Else
                '4週期間表示のとき
                With sprSheet_4W.Sheets(0)

                    'ｾﾙﾌﾞﾛｯｸの選択を解除
                    .ClearSelection()

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    '選択範囲設定（他部署の勤務、実績データは選択しない）
                    w_TaishoFlg = False
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow
                        If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ消去

                            '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = -1
                            w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If IsNumeric(w_Var) = True Then
                                'ｲﾝﾃﾞｯｸｽ取得
                                w_StaffIdx = Integer.Parse(w_Var)
                            End If

                            For w_Col = w_KikanStartCol To m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                                '控除データ
                                w_kojoFlg = False
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If IsNumeric(w_Var) AndAlso w_Var <> "" AndAlso (w_StaffIdx <> -1) Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                            w_kojoFlg = True
                                            Exit For
                                        End If
                                    Next

                                    '代休データ
                                    For w_Int = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                        '代休取得済みであるかチェック
                                        For w_Int2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail)
                                            If m_StaffData(w_StaffIdx).Daikyu(w_Int).DaikyuDetail(w_Int2).DaikyuDate = w_CurrentDate Then
                                                w_kojoFlg = True
                                                Exit For
                                            End If
                                        Next w_Int2
                                    Next w_Int
                                End If

                                '背景色で判断。色つきは削除しない
                                If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Yousei_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Kibou_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Saikei_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Iin_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Ouen_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Daikyu_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Appli_Back) _
                                OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) _
                                OrElse w_kojoFlg Then

                                    '配属期間外または、計画期間外確定データのとき
                                    If w_TaishoFlg = True Then
                                        '現在選択されているセルブロックを取得し、内部に保持
                                        .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                        .SetActiveCell(w_Row, w_StartCol, False)

                                        w_TaishoFlg = False
                                    End If
                                Else
                                    '配属期間内の場合

                                    '4週/1ｹ月の場合
                                    If Get_Col_4W(m_KeikakuKikan.StartDate, w_KeikakuCol) = True Then
                                        w_Cnt = w_Col - w_KeikakuCol + 1
                                    Else
                                        w_Cnt = 0
                                    End If

                                    w_NotDelFlg = False
                                    If w_StaffIdx <> -1 AndAlso g_SaikeiFlg = True Then
                                        '再掲部署の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA Then
                                            w_NotDelFlg = True
                                        End If
                                    ElseIf w_StaffIdx <> -1 AndAlso g_SaikeiFlg = False Then
                                        '再掲部署以外の場合
                                        If m_StaffData(w_StaffIdx).KinmuData(w_Cnt).DataFlg = M_JISSEKIDATA AndAlso m_StaffData(w_StaffIdx).KinmuData(w_Cnt).KakuteiFlg = M_GAITOBUSHO Then
                                            w_NotDelFlg = True
                                        End If
                                    End If


                                    If w_TaishoFlg = False Then
                                        w_TaishoFlg = True
                                        w_StartCol = w_Col
                                    End If
                                    w_EndCol = w_Col
                                End If
                            Next w_Col

                            If w_TaishoFlg = True Then
                                '現在選択されているセルブロックを取得し、内部に保持
                                .AddSelection(w_Row, w_StartCol, 1, w_EndCol - w_StartCol + 1)
                                .SetActiveCell(w_Row, w_StartCol, False)

                                w_TaishoFlg = False
                            End If
                        End If
                    Next w_Row

                    '選択されているセルブロックを取得
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 Then

                        For w_Lng = 0 To w_CellRange.Length - 1

                            '選択ｾﾙの大きさ
                            w_StartCol = w_CellRange(w_Lng).Column
                            w_StartRow = w_CellRange(w_Lng).Row
                            w_EndCol = w_CellRange(w_Lng).Column + w_CellRange(w_Lng).ColumnCount - 1
                            w_EndRow = w_CellRange(w_Lng).Row + w_CellRange(w_Lng).RowCount - 1

                            'UndoData格納
                            'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                            '値 消去
                            .ClearRange(w_CellRange(w_Lng).Row, w_CellRange(w_Lng).Column, w_CellRange(w_Lng).RowCount, w_CellRange(w_Lng).ColumnCount, False)

                            For w_Row = w_StartRow To w_EndRow
                                For w_Col = w_StartCol To w_EndCol

                                    w_Var = .GetText(w_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    w_Text = w_Var

                                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var <> "" Then
                                        w_Bool = True
                                    Else
                                        w_Bool = False
                                    End If

                                    '1ヶ月用列番号取得
                                    If Get_Col_M(w_Var, w_Col2) = True Then
                                        sprSheet_M.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                        If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                        Else
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                            sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                        End If
                                    End If
                                Next w_Col
                            Next w_Row
                        Next w_Lng
                    ElseIf w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1) Then

                        '選択ｾﾙの大きさ
                        w_StartCol = w_CellRange(0).Column
                        w_StartRow = w_CellRange(0).Row
                        w_EndCol = w_CellRange(0).Column + w_CellRange(0).ColumnCount - 1
                        w_EndRow = w_CellRange(0).Row + w_CellRange(0).RowCount - 1

                        'UndoData格納
                        'Call Set_UndoData(w_StartCol, w_StartRow, w_EndCol, w_EndRow) '2016/04/05 Ishiga del

                        '値 消去
                        .ClearRange(w_CellRange(0).Row, w_CellRange(0).Column, w_CellRange(0).RowCount, w_CellRange(0).ColumnCount, False)

                        For w_Row = w_StartRow To w_EndRow
                            For w_Col = w_StartCol To w_EndCol

                                w_Var = .GetText(w_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                w_Text = w_Var

                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_Bool = True
                                Else
                                    w_Bool = False
                                End If

                                '1ヶ月用列番号取得
                                If Get_Col_M(w_Var, w_Col2) = True Then
                                    sprSheet_M.Sheets(0).SetText(w_Row, w_Col2, w_Text)

                                    If .Cells(w_Row, w_Col).BackColor.A = 0 Then
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = Color.Black
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = Color.White
                                    Else
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).ForeColor = .Cells(w_Row, w_Col).ForeColor
                                        sprSheet_M.Sheets(0).Cells(w_Row, w_Col2).BackColor = .Cells(w_Row, w_Col).BackColor
                                    End If
                                End If
                            Next w_Col
                        Next w_Row
                    End If

                    .ClearSelection()
                End With
            End If

            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                    '勤務のみ集計
                    '計画期間の個人別集計
                    Call RunReCalc_PUser(w_Row)

                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週期間の個人別集計
                        Call RunReCalc_User_4W(w_Row)
                        Call RunReCalc_PUser_Jisseki(w_Row)
                    End If
                End If
            Next w_Row

            For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                '計画期間の日別集計
                Call RunReCalc_PDay(w_Col)
            Next w_Col

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol) = True Then
                    For w_Col = w_StartCol To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                        '計画期間の最後の4週部分の日別集計
                        Call RunReCalc_PDay_4W(w_Col)
                    Next w_Col
                End If
            End If

            Set_UndoData() '2016/04/05 Ishiga add

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'CopyDataをｸﾘｱする
    Private Sub CopyData_Clear()

        Const W_SUBNAME As String = "NSK0000HA CopyData_Clear"

        Dim w_Int As Integer
        Try
            '前ｺﾋﾟｰﾃﾞｰﾀの位置情報 退避変数 初期化
            m_CopyData.StartCol = 0
            m_CopyData.StartRow = 0
            m_CopyData.EndCol = 0
            m_CopyData.EndRow = 0

            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int).Sheets(0)
                    '-- 前ｺﾋﾟｰﾃﾞｰﾀ 消去 -------------------
                    .ClearRange(m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow - m_CopyArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    Call SubSetStyle(m_Spread(w_Int), m_CopyArea.StartRow, M_KinmuDataStart_Col, m_CopyArea.EndRow, .ColumnCount - 1, 0, 0, , Color.White)
                End With
            Next w_Int

            '貼り付け使用不可
            m_lstmnuEdit(M_MenuPaste).Enabled = False

            'ﾎﾟｯﾌﾟｱｯﾌﾟ貼り付け使用不可
            m_lstmnuPopup(M_PopPaste).Enabled = False

            '貼り付け使用不可
            m_blnPopPasteFLG = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'UndoDataをｸﾘｱする
    Private Sub UndoData_Clear()

        Const W_SUBNAME As String = "NSK0000HA UndoData_Clear"

        Dim w_Int As Integer
        Try
            'UNDOﾃﾞｰﾀの位置情報 退避変数 初期化
            '2016/04/05 Ishiga upd start----------
            'ReDim m_UndoData(0)
            m_UndoIdx = 0
            m_UndoIdxHendou = 0
            m_UndoKaisu = 0
            m_RedoCnt = 0
            '2016/04/05 Ishiga upd end------------
            'ReDim m_KojyoUndoData(0) '2016/04/06 Yamanishi Del

            For w_Int = 1 To UBound(m_Spread)
                With m_Spread(w_Int).Sheets(0)
                    '-- 前UNDOﾃﾞｰﾀ 消去 -------------------
                    '2016/04/05 Ishiga upd start--------------------------------------------------------------------------------------------------------------------------------------------
                    '.ClearRange(m_UndoArea.StartRow, M_KinmuDataStart_Col, m_UndoArea.EndRow - m_UndoArea.StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)

                    'Call SubSetStyle(m_Spread(w_Int), m_UndoArea.StartRow, M_KinmuDataStart_Col, m_UndoArea.EndRow, .ColumnCount - 1, 0, 0, , Color.White)

                    .ClearRange(m_UndoArea(1).StartRow, M_KinmuDataStart_Col, m_UndoArea(m_UndoMaxKensu).EndRow - m_UndoArea(1).StartRow + 1, .ColumnCount - M_KinmuDataStart_Col, False)
                    '2016/04/05 Ishiga upd end----------------------------------------------------------------------------------------------------------------------------------------------
                End With
            Next w_Int
            '2016/04/06 Yamanishi Del ---------------------------------------------------------------------------
            ''2016/04/05 Ishiga add start--------------
            'm_UndoKaisu = m_UndoKaisu + 1
            'm_UndoIdx = m_UndoIdx + 1
            'm_UndoIdxHendou = m_UndoIdxHendou + 1
            '----------------------------------------------------------------------------------------------------
            Call Set_UndoData()
            '2016/04/05 Ishiga add end----------------

            '元に戻す使用不可
            m_lstmnuEdit(M_MenuUndo).Enabled = False

            'ﾎﾟｯﾌﾟｱｯﾌﾟ元に戻す使用不可
            m_lstmnuPopup(M_PopUndo).Enabled = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '時間年休入力(右クリックから)
    Private Sub InputJikanNenkyu()

        Const W_SUBNAME As String = "NSK0000HA InputJikanNenkyu"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Row2 As Integer
        Dim w_RowPlan As Integer
        Dim w_blnFLG As Boolean
        Dim w_KikanStartCol As Integer
        Dim w_MsgRc As Integer
        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_VarPlan As Object = Nothing
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_RiyuKBN2 As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Flg As String = String.Empty
        Dim w_KangoCD As String = String.Empty
        Dim w_StaffIdx As Integer
        Dim w_Date As String = String.Empty
        Dim w_StaffID As String = String.Empty
        Dim w_Loop As Integer
        '2018/03/12 Yamanishi Upd -------------------------------------------
        'Dim w_RecCnt As Integer
        'Dim w_Pos As Integer
        'Dim w_BunruiCD As String 'HolidayBunruiCD
        'Dim w_StartTime As String 'FromTime
        'Dim w_EndTime As String 'ToTime
        'Dim w_KBN As String 'DateKbn
        'Dim w_NenkyuTime As String '時間年休
        'Dim w_HolSubFlg As String '休憩減算フラグ
        'Dim w_DayTime As String '日勤時間
        'Dim w_NightTime As String '夜勤時間
        'Dim w_NextNightTime As String '翌日夜勤時間
        'Dim w_clsObj As Object
        Dim w_strTime As String = String.Empty
        Dim w_BunruiCD As String = String.Empty     'HolidayBunruiCD
        Dim w_StartTime As Integer                  'FromTime
        Dim w_EndTime As Integer                    'ToTime
        Dim w_KBN As String = String.Empty          'DateKbn
        Dim w_NenkyuTime As Integer                 '時間年休
        Dim w_HolSubFlg As String = String.Empty    '休憩減算フラグ
        Dim w_DayTime As Integer                    '日勤時間
        Dim w_NightTime As Integer                  '夜勤時間
        Dim w_NextNightTime As Integer              '翌日夜勤時間
        Dim w_clsObj As NsAid_NSA0050H.clsNSA0050H
        '--------------------------------------------------------------------
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_DutyKinmuCD() As Object '日当直勤務CD
        Dim w_GroupCD() As Object '日当直グループCD
        Dim w_DutyIndex As Integer
        Dim w_strMsg() As String
        Dim w_lngKojyoLoop As Integer
        Dim w_strWorkIdx As String '退避
        Dim w_lngWorkLoop As Integer '退避
        Dim w_lngNo As Integer
        Dim w_lngDataCnt As Integer
        Dim w_BackColor As Color
        Dim w_CellRange() As Model.CellRange
        Dim kojoEvent() As EventList_Type
        '#001-----St
        Dim w_nenkyDispFlg As Boolean
        Dim w_regAppliKbn As String
        Dim w_appliKbn As String = String.Empty
        '#001-----Ed
        Dim w_Comment As String = String.Empty '2015/04/10 Bando Add
        Try
            w_strWorkIdx = ""
            w_lngWorkLoop = 0

            'ｺﾋﾟｰ中 ｽﾃｰﾀｽﾊﾞｰ/ﾒｯｾｰｼﾞ 取得
            sbrMain.Items.Item(M_StatusBarKey_InformationText).Text = G_COPY_STR
            sbrMain.Refresh()

            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合
                With sprSheet_M.Sheets(0)

                    '連続したｾﾙﾌﾟﾛｯｸ or 複数のｾﾙﾌﾞﾛｯｸ？
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 OrElse (w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1)) Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "複数の選択範囲"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    w_Col = .ActiveColumn.Index
                    w_Row = .ActiveRow.Index

                    '編集可能ｾﾙ範囲 ﾁｪｯｸ
                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_Row) AndAlso (w_Row <= m_StaffRow.EndRow)) Then
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((m_KeikakuKikan.KinmuDataStartCol <= w_Col) AndAlso (w_Col <= m_KeikakuKikan.KinmuDataEndCol)) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "計画期間外の勤務"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '勤務行以外?
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan OrElse (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                    Else
                        'ERROR
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "他部署の勤務"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "他部署確定データ"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '二段表示の上段をクリックした時
                        w_Var = .GetText(w_Row + 1, w_Col)
                        If w_Var <> "" Then
                            'まず下段を確認する
                            w_Row2 = w_Row + 1
                            w_blnFLG = True
                        Else
                            '下段にデータが存在しない時は上段を確認する
                            w_Row2 = w_Row
                            w_Var = .GetText(w_Row, w_Col)
                            If w_Var <> "" Then
                                w_blnFLG = True
                            Else
                                w_blnFLG = False
                            End If
                        End If
                    Else
                        w_Row2 = w_Row
                        w_Var = .GetText(w_Row, w_Col)
                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    End If

                    If w_blnFLG = True Then
                        '2015/04/10 Bando Upd Start ===========================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   ===========================

                        If g_SaikeiFlg = True Then
                            '再掲部署の場合
                            If w_RiyuKBN <> "4" Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "再掲勤務以外"
                                w_strMsg(2) = "時間年休"
                                Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        Else
                            '再掲部署以外
                            If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN AndAlso w_RiyuKBN = "4" Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "再掲勤務"
                                w_strMsg(2) = "時間年休"
                                Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If

                        If IsNumeric(w_KinmuCD) = False Then
                            Exit Sub
                        End If
                    Else
                        Exit Sub
                    End If

                    '--------------------------------------------------
                    '   時間年休入力画面  表示
                    '--------------------------------------------------
                    w_clsObj = New NsAid_NSA0050H.clsNSA0050H

                    'ﾌﾟﾛﾊﾟﾃｨ設定
                    'Inatalltype渡し
                    w_clsObj.pInstallType = General.g_InstallType
                    '部品ｵﾌﾞｼﾞｪｸﾄ渡し
                    w_clsObj.pGetDataObj = General.g_objGetData
                    w_clsObj.pSelectDateObj = General.g_objSelectDate
                    w_clsObj.pGetMasterObj = General.g_objGetMaster
                    w_clsObj.pSecurityObj = General.g_objSecurity
                    '利用者情報
                    w_clsObj.pUserID = General.g_strUserID
                    w_clsObj.pUserName = General.g_strUserName

                    w_clsObj.pDispKbn = "0" '呼出元画面区分(0:計画画面)
                    w_clsObj.pAppliUseFlg = "1" '届出コンポーネント使用FLG(1:未使用)
                    w_clsObj.pGetKbnFlg = "2" '取得内容FLG(2:時間指定のみ)
                    '#001-----St
                    w_nenkyDispFlg = True
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出を仕様するときは時間休を入力させない
                        w_nenkyDispFlg = False
                    End If
                    w_clsObj.pNenkyDispFlg = w_nenkyDispFlg
                    '#001-----Ed
                    If w_KangoCD = "" Then
                        w_clsObj.pOuenFlg = 0
                    Else
                        w_clsObj.pOuenFlg = 1
                    End If

                    '応援先勤務部署CD
                    w_clsObj.pOuenKangoCD = w_KangoCD

                    w_Var = .GetText(w_Row, M_StaffName_Col)
                    If w_Var <> "" Then
                        w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                    ElseIf m_blnJissekiUseFlg AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '職員名称が取得できず、勤務変更で二段表示をしている場合
                        '一行上(二段表示の上段)の職員名称を取得する
                        w_Var = .GetText(w_Row - 1, M_StaffName_Col)
                        If w_Var <> "" Then
                            w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                        Else
                            w_clsObj.pAppliStaffName = ""
                        End If
                    Else
                        w_clsObj.pAppliStaffName = ""
                    End If

                    '対象年月日
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var <> "" Then
                        w_Date = Convert.ToString(w_Var)
                        w_clsObj.pTargetDate = w_Date
                    End If

                    'KinmuCD
                    w_clsObj.pKinmuCD = w_KinmuCD

                    '看護単位CD
                    w_clsObj.pSelKinmuDeptCD = General.g_strSelKinmuDeptCD

                    '職員管理番号
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                    If w_Var <> "" Then
                        w_StaffID = Convert.ToString(w_Var)
                        w_clsObj.pAppliStaffMngID = w_StaffID
                    End If

                    '職員番号
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_StaffIdx = Integer.Parse(w_Var)
                            w_clsObj.pAppliStaffID = m_StaffData(w_StaffIdx).PreID
                        End If
                    End If

                    w_strWorkIdx = Convert.ToString(w_StaffIdx)
                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_Var).Kojyo)
                        If Double.Parse(w_Date) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate Then
                            w_lngWorkLoop = w_lngKojyoLoop '退避(控除データ位置)
                            Exit For
                        End If
                    Next w_lngKojyoLoop

                    If w_lngWorkLoop <> 0 Then
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate)
                            If InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop))) <= 0 Then
                                '次画面へ
                                w_clsObj.pKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                            Else
                                '2018/02/23 Yamanishi Upd --------------------------------------------------------------------------------------------------------------
                                'w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate, _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)

                                w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                                '---------------------------------------------------------------------------------------------------------------------------------------
                            End If
                        Next w_lngKojyoLoop
                    End If

                    '行事データ受渡
                    ReDim kojoEvent(0)
                    chkEventTargetStaff(w_StaffID, w_Date, kojoEvent)
                    For i As Integer = 1 To UBound(kojoEvent)
                        w_clsObj.pEventData(kojoEvent(i).uniqNo, kojoEvent(i).EventName, kojoEvent(i).Time_st, kojoEvent(i).Time_ed) = kojoEvent(i).allFlg
                    Next

                    '採用CD
                    w_clsObj.pAppliStaffSaiyoCD = Get_SaiyoCD(Integer.Parse(w_Date), w_StaffID)

                    'HospitalCD
                    w_clsObj.pHospitalCD = General.g_strHospitalCD

                    If m_PackageFLG = 0 OrElse m_PackageFLG = 2 Then
                        '日当直を使用していない場合
                        w_clsObj.pDutyUseFlg = "1"
                        w_clsObj.pDutyKinmuCD = ""
                        w_clsObj.pDutyKinmuCD2 = ""
                        w_clsObj.pAppliStaffDutyGroupCD = ""
                        w_clsObj.pAppliStaffDutyGroupCD2 = ""
                    Else
                        '日当直を使用する場合
                        w_clsObj.pDutyUseFlg = "0"

                        w_Var = .GetText(w_Row - ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_DutyData, w_Col)
                        If w_Var <> "" Then
                            '日当直取得
                            ReDim w_DutyKinmuCD(0)
                            ReDim w_GroupCD(0)

                            'ﾃﾞｰﾀごとに分割
                            Call Get_DutyMark(w_Var, w_DutyKinmuCD, w_GroupCD)

                            w_DutyIndex = 0
                            For w_Loop = 1 To UBound(w_DutyKinmuCD)
                                If IsNumeric(w_DutyKinmuCD(w_Loop)) = True Then
                                    If w_DutyIndex = 0 Then
                                        w_clsObj.pDutyKinmuCD = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD = w_GroupCD(w_Loop)
                                        w_DutyIndex = 1
                                    ElseIf w_DutyIndex = 1 Then
                                        w_clsObj.pDutyKinmuCD2 = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD2 = w_GroupCD(w_Loop)
                                        w_DutyIndex = 2
                                    End If
                                End If
                            Next w_Loop

                            If w_DutyIndex = 0 Then
                                w_clsObj.pDutyKinmuCD = ""
                                w_clsObj.pAppliStaffDutyGroupCD = ""
                            End If

                            If w_DutyIndex <= 1 Then
                                w_clsObj.pDutyKinmuCD2 = ""
                                w_clsObj.pAppliStaffDutyGroupCD2 = ""
                            End If
                        Else
                            w_clsObj.pDutyKinmuCD = ""
                            w_clsObj.pDutyKinmuCD2 = ""
                            w_clsObj.pAppliStaffDutyGroupCD = ""
                            w_clsObj.pAppliStaffDutyGroupCD2 = ""
                        End If
                    End If

                    '#001-----St
                    w_regAppliKbn = "0"
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出使用時、届出が登録されているか確認する
                        w_Var = .GetText(w_Row - ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, w_Col)
                        Get_AppliMark(w_Var, "", "", "", w_appliKbn, 0, 0, "")
                        'ブランクなら届出登録なし
                        If Not w_Var.Equals("") Then
                            w_regAppliKbn = "1"
                            If w_appliKbn.Equals("1") Then
                                w_regAppliKbn = "2"
                            End If
                        End If
                    End If
                    w_clsObj.pRegistAppliKbn = w_regAppliKbn
                    '#001-----Ed

                    '2018/03/12 Yamanishi Upd Start ------------------------------------------------------------------------------------------------
                    ''時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
                    'w_RecCnt = Len(w_Time) / 28

                    'w_Pos = 1

                    'For w_Loop = 1 To w_RecCnt
                    '    'HolidayBunruiCD
                    '    w_BunruiCD = Mid(w_Time, w_Pos, 2)

                    '    w_Pos = w_Pos + 2

                    '    'FromTime
                    '    w_StartTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_StartTime) = False Then
                    '        w_StartTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'ToTime
                    '    w_EndTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_EndTime) = False Then
                    '        w_EndTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'DateKbn
                    '    w_KBN = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '時間年休
                    '    w_NenkyuTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NenkyuTime) = False Then
                    '        w_NenkyuTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '休憩減算フラグ
                    '    w_HolSubFlg = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '日勤時間
                    '    w_DayTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_DayTime) = False Then
                    '        w_DayTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '夜勤時間
                    '    w_NightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NightTime) = False Then
                    '        w_NightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '翌日夜勤時間
                    '    w_NextNightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NextNightTime) = False Then
                    '        w_NextNightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, Integer.Parse(w_StartTime), Integer.Parse(w_EndTime), w_KBN, "", Integer.Parse(w_NenkyuTime), w_HolSubFlg, Integer.Parse(w_DayTime), Integer.Parse(w_NightTime), Integer.Parse(w_NextNightTime)) = ""
                    'Next w_Loop

                    '時間年休件数取得
                    w_strTime = w_Time

                    While w_strTime <> ""
                        w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                   w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime)
                        w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, w_StartTime, w_EndTime, w_KBN, "",
                                               w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime) = ""
                    End While
                    '2018/03/12 Yamanishi Upd End --------------------------------------------------------------------------------------------------

                    Call Set_DialogZOrder(1)
                    w_clsObj.pProcessObj = Me
                    '時間年休入力 表示
                    w_clsObj.mShowWindow()

                    Me.Refresh()

                    Call Set_DialogZOrder(0)

                    '入力された値を取得する
                    If w_clsObj.pOKFlg = True Then
                        '初期化
                        w_Time = ""
                        If w_clsObj.pReasonKBN = 6 OrElse Double.Parse(w_RiyuKBN) = 6 Then
                            w_RiyuKBN = w_clsObj.pReasonKBN
                            w_KangoCD = w_clsObj.pOuenKangoCD
                        End If

                        If w_lngWorkLoop = 0 Then
                            '元データがない場合、配列確保
                            w_clsObj.pIndex = 1
                            If w_clsObj.pAllTimeFrom <> 0 AndAlso w_clsObj.pAllTimeTo <> 0 Then
                                '戻り値が空でなければ
                                w_lngNo = UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo) + 1
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo)
                                m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).init()

                                w_lngDataCnt = w_clsObj.pAllKojyoDataCount
                                For w_lngKojyoLoop = 1 To w_lngDataCnt
                                    w_clsObj.pIndex = w_lngKojyoLoop
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngNikkinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strShinryoKbn(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeFrom(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeTo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYokuYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strKinmuDetailCD(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strNextFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strHolSubFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).UniqueseqNo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).Seq(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngDate = w_clsObj.pAllKDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD
                                Next w_lngKojyoLoop
                            End If
                        Else
                            'データがある場合、上書き
                            w_lngDataCnt = w_clsObj.pAllKojyoDataCount
                            '配列初期化
                            m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).init()

                            For w_lngKojyoLoop = 1 To w_lngDataCnt
                                w_clsObj.pIndex = w_lngKojyoLoop
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strNextFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).Seq(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate = w_clsObj.pAllKDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                            Next w_lngKojyoLoop
                        End If

                        '時間年休文字列(１件は１１ﾊﾞｲﾄ)取得
                        For w_Loop = 1 To w_clsObj.pDataCount
                            w_clsObj.pIndex = w_Loop

                            '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                            ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                            'w_BunruiCD = w_clsObj.pHolBunruiCD
                            'If w_BunruiCD = "" Then
                            '    w_Time = w_Time & Space(2)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 2}", w_BunruiCD)
                            'End If
                            ''FromTime(ﾊﾞｲﾄ数４)
                            'w_StartTime = Convert.ToString(w_clsObj.pFromTime)
                            'If w_StartTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_StartTime)
                            'End If
                            ''ToTime(ﾊﾞｲﾄ数４)
                            'w_EndTime = Convert.ToString(w_clsObj.pToTime)
                            'If w_EndTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_EndTime)
                            'End If
                            ''DateKbn(ﾊﾞｲﾄ数１)
                            'w_KBN = w_clsObj.pNextdayFlg
                            'w_Time = w_Time & w_KBN
                            ''時間年休
                            'w_NenkyuTime = Convert.ToString(w_clsObj.pNenkyuTime)
                            'If w_NenkyuTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NenkyuTime)
                            'End If
                            ''休憩減算フラグ
                            'w_HolSubFlg = w_clsObj.pHolGensanFlg2
                            'w_Time = w_Time & w_HolSubFlg
                            ''日勤時間
                            'w_DayTime = Convert.ToString(w_clsObj.pDayTime)
                            'If w_DayTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_DayTime)
                            'End If
                            ''夜勤時間
                            'w_NightTime = Convert.ToString(w_clsObj.pNightDayTime)
                            'If w_NightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NightTime)
                            'End If
                            ''翌日夜勤時間
                            'w_NextNightTime = Convert.ToString(w_clsObj.pNextNightTime)
                            'If w_NextNightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NextNightTime)
                            'End If

                            w_Time = w_Time & Set_NenkyuTime(w_clsObj.pHolBunruiCD, w_clsObj.pFromTime, w_clsObj.pToTime,
                                                             w_clsObj.pNextdayFlg, w_clsObj.pNenkyuTime, w_clsObj.pHolGensanFlg2,
                                                             w_clsObj.pDayTime, w_clsObj.pNightDayTime, w_clsObj.pNextNightTime)
                            '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                        Next w_Loop

                        '2015/04/10 Bando Upd Start =============================
                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   =============================

                        '勤務記号貼り付け
                        .SetText(w_Row2, w_Col, w_Var)

                        '色分け（時間入力の判断はw_Time<>0で行う）
                        If w_Time <> "" Then
                            '時間年休をを取得している場合
                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                        Else
                            Select Case w_RiyuKBN
                                Case "1" '通常
                                    w_BackColor = Color.White
                                Case "2" '要請
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                Case "3" '希望
                                    '2015/07/21 Bando Upd Start ======================
                                    If w_Comment = "" Then
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Else
                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    End If
                                    '2015/07/21 Bando Upd End   ======================
                                Case "4" '再掲
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                Case "5" '委員会
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                Case "6" '応援
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                Case Else 'その他
                                    w_BackColor = Color.White
                            End Select

                            '代休発生勤務 文字/背景色
                            If General.g_lngDaikyuMng = 0 Then
                                w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                        End If
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var2 <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var2)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================
                        End If

                        .Cells(w_Row2, w_Col).BackColor = w_BackColor

                        '予定と実績が異なる時、予定側の時間年休も更新する
                        w_blnFLG = False
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            w_VarPlan = .GetText(w_Row2 + 1, w_Col)
                            If m_blnJissekiUseFlg Then
                                '二段表示の時
                                If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                    '下段選択の時
                                    w_VarPlan = .GetText(w_Row2 - 1, w_Col)
                                    If w_VarPlan <> "" Then
                                        '上段にデータが存在する時
                                        w_RowPlan = w_Row2 - 1
                                        w_blnFLG = True
                                    End If
                                End If
                            ElseIf w_VarPlan <> "" Then
                                '一段表示　かつ　下段にデータが存在する時
                                w_RowPlan = w_Row2 + 1
                                w_blnFLG = True
                            End If
                        End If

                        If w_blnFLG Then
                            '予定と実績が異なる時
                            '2015/04/10 Bando Upd Start ==============================
                            'Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "")
                            'w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "", w_Comment)
                            w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                            '2015/04/10 Bando Upd End   ==============================

                            '勤務記号貼り付け
                            .SetText(w_RowPlan, w_Col, w_VarPlan)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN2
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        '2015/07/21 Bando Upd Start ======================
                                        If w_Comment = "" Then
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Else
                                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                        End If
                                        '2015/07/21 Bando Upd End   =====================
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        'w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            .Cells(w_RowPlan, w_Col).BackColor = w_BackColor

                            '理由区分が違う場合は勤務変更扱い
                            If w_RiyuKBN <> w_RiyuKBN2 Then
                                .Cells(w_Row2, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                            End If
                        End If

                        If Get_Col_4W(w_Date, w_Col) = True Then

                            'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                            sprSheet_4W.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        '2015/07/21 Bando Upd Start ===================
                                        If w_Comment = "" Then
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Else
                                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                        End If
                                        '2015/07/21 Bando Upd End   ===================
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            sprSheet_4W.Sheets(0).Cells(w_Row2, w_Col).BackColor = w_BackColor

                            '予定と実績が異なる時、予定側の時間年休も更新する
                            If w_blnFLG Then
                                '勤務記号貼り付け
                                sprSheet_4W.Sheets(0).SetText(w_RowPlan, w_Col, w_VarPlan)

                                '色分け（時間入力の判断はw_Time<>0で行う）
                                If w_Time <> "" Then
                                    '時間年休をを取得している場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                Else
                                    Select Case w_RiyuKBN2
                                        Case "1" '通常
                                            w_BackColor = Color.White
                                        Case "2" '要請
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                        Case "3" '希望
                                            '2015/07/21 Bando Upd Start ===================
                                            If w_Comment = "" Then
                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                            Else
                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                            End If
                                            '2015/07/21 Bando Upd End   ===================
                                        Case "4" '再掲
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                        Case "5" '委員会
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                        Case "6" '応援
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                        Case Else 'その他
                                            w_BackColor = Color.White
                                    End Select

                                    '代休発生勤務 文字/背景色
                                    If General.g_lngDaikyuMng = 0 Then
                                        w_Var2 = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        If w_Var2 <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var2)
                                            w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                End If
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add Start ===========================
                                    '控除があるか判断し　背景色変更
                                    w_Var2 = sprSheet_4W.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                            w_Var2 = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                            Exit For
                                                        End If
                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                        Exit For
                                                    End If
                                                Next
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add End   ===========================
                                End If

                                sprSheet_4W.Sheets(0).Cells(w_RowPlan, w_Col).BackColor = w_BackColor

                                '理由区分が違う場合は勤務変更扱い
                                If w_RiyuKBN <> w_RiyuKBN2 Then
                                    sprSheet_4W.Sheets(0).Cells(w_Row2, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                End If
                            End If
                        End If
                    End If

                    'ｸﾗｽｵﾌﾞｼﾞｪｸﾄ解放
                    w_clsObj = Nothing

                    '処理のちらつきを隠す
                    picCover.Top = picBase.Top
                    picCover.Left = picBase.Left
                    picCover.Width = picBase.Width
                    picCover.Height = picBase.Height
                    picCover.Visible = True
                    For w_Loop = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計
                            '個人別集計 計算実行(計画期間)
                            Call RunReCalc_PUser(w_Loop)
                        End If
                    Next w_Loop

                    picCover.Visible = False
                End With
            Else
                '4週画面表示中の場合
                With sprSheet_4W.Sheets(0)

                    '連続したｾﾙﾌﾟﾛｯｸか？
                    w_CellRange = .GetSelections

                    If w_CellRange.Length > 1 OrElse (w_CellRange.Length = 1 AndAlso (w_CellRange(0).RowCount <> 1 OrElse w_CellRange(0).ColumnCount <> 1)) Then
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ の場合
                        'ﾏﾙﾁ ｾﾙﾌﾞﾛｯｸ ｺﾋﾟｰ機能 使用不可
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "複数の選択範囲"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    w_Col = .ActiveColumn.Index
                    w_Row = .ActiveRow.Index

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    'ﾃﾞｰﾀ行 範囲内か ?
                    If Not ((m_StaffRow.StartRow <= w_Row) AndAlso (w_Row <= m_StaffRow.EndRow)) Then
                        Exit Sub
                    End If

                    '計画ﾃﾞｰﾀ列 範囲内か ?
                    If Not ((w_KikanStartCol <= w_Col) AndAlso (w_Col <= m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol)) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "計画期間外の勤務"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '勤務行以外?
                    If (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan OrElse (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                    Else
                        'ERROR
                        Exit Sub
                    End If

                    '部署異動、配属期間内か ?
                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "他部署の勤務"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).ForeColor) = m_Tabusho_Fore) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "他部署確定データ"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If
                    If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                        'ERROR
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "計画期間外の確定済み勤務"
                        w_strMsg(2) = "時間年休"
                        Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                        Exit Sub
                    End If

                    '背景色が黒の時も時間年休入力不可
                    If (.Cells(w_Row, w_Col).BackColor.Equals(Color.Black)) Then
                        'ERROR
                        Exit Sub
                    End If

                    If m_blnJissekiUseFlg AndAlso (w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                        '二段表示の上段をクリックした時
                        w_Var = .GetText(w_Row + 1, w_Col)
                        If w_Var <> "" Then
                            'まず下段を確認する
                            w_Row2 = w_Row + 1
                            w_blnFLG = True
                        Else
                            '下段にデータが存在しない時は上段を確認する
                            w_Row2 = w_Row
                            w_Var = .GetText(w_Row, w_Col)
                            If w_Var <> "" Then
                                w_blnFLG = True
                            Else
                                w_blnFLG = False
                            End If
                        End If
                    Else
                        w_Row2 = w_Row
                        w_Var = .GetText(w_Row, w_Col)
                        If w_Var <> "" Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                    End If

                    If w_blnFLG = True Then
                        '2015/04/10 Bando Upd Start =================================
                        'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time)
                        Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_Flg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   =================================
                        If g_SaikeiFlg = True Then
                            '再掲部署の場合
                            If w_RiyuKBN <> "4" Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "再掲勤務以外"
                                w_strMsg(2) = "時間年休"
                                Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        Else
                            '再掲部署以外
                            If m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEJISSEKI AndAlso m_PgmFlg <> General.G_PGMSTARTFLG_CHANGEPLAN AndAlso w_RiyuKBN = "4" Then
                                ReDim w_strMsg(2)
                                w_strMsg(1) = "再掲勤務"
                                w_strMsg(2) = "時間年休"
                                Call Set_MsgZOrder("NS0011", w_strMsg, w_MsgRc, 0)
                                Exit Sub
                            End If
                        End If

                        If IsNumeric(w_KinmuCD) = False Then
                            Exit Sub
                        End If
                    Else
                        Exit Sub
                    End If

                    '--------------------------------------------------
                    '   時間年休入力画面  表示
                    '--------------------------------------------------
                    w_clsObj = New NsAid_NSA0050H.clsNSA0050H

                    'ﾌﾟﾛﾊﾟﾃｨ設定
                    'Inatalltype渡し
                    w_clsObj.pInstallType = General.g_InstallType
                    '部品ｵﾌﾞｼﾞｪｸﾄ渡し
                    w_clsObj.pGetDataObj = General.g_objGetData
                    w_clsObj.pSelectDateObj = General.g_objSelectDate
                    w_clsObj.pGetMasterObj = General.g_objGetMaster
                    w_clsObj.pSecurityObj = General.g_objSecurity
                    '利用者情報
                    w_clsObj.pUserID = General.g_strUserID
                    w_clsObj.pUserName = General.g_strUserName

                    w_clsObj.pDispKbn = "0" '呼出元画面区分(0:計画画面)
                    w_clsObj.pAppliUseFlg = "1" '届出コンポーネント使用FLG(1:未使用)
                    w_clsObj.pGetKbnFlg = "2" '取得内容FLG(2:時間指定のみ)
                    '#001-----St
                    w_nenkyDispFlg = True
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出を仕様するときは時間休を入力させない
                        w_nenkyDispFlg = False
                    End If
                    w_clsObj.pNenkyDispFlg = w_nenkyDispFlg
                    '#001-----Ed
                    If w_KangoCD = "" Then
                        w_clsObj.pOuenFlg = 0
                    Else
                        w_clsObj.pOuenFlg = 1
                    End If

                    '応援先勤務部署CD
                    w_clsObj.pOuenKangoCD = w_KangoCD

                    w_Var = .GetText(w_Row, M_StaffName_Col)
                    If w_Var <> "" Then
                        w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                    ElseIf m_blnJissekiUseFlg AndAlso m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_blnJissekiUseFlg AndAlso m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                        '職員名称が取得できず、勤務変更で二段表示をしている場合
                        '一行上(二段表示の上段)の職員名称を取得する
                        w_Var = .GetText(w_Row - 1, M_StaffName_Col)
                        If w_Var <> "" Then
                            w_clsObj.pAppliStaffName = Convert.ToString(w_Var)
                        Else
                            w_clsObj.pAppliStaffName = ""
                        End If
                    Else
                        w_clsObj.pAppliStaffName = ""
                    End If

                    '対象年月日
                    w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                    If w_Var <> "" Then
                        w_Date = Convert.ToString(w_Var)
                        w_clsObj.pTargetDate = w_Date
                    End If

                    'KinmuCD
                    w_clsObj.pKinmuCD = w_KinmuCD

                    '看護単位CD
                    w_clsObj.pSelKinmuDeptCD = General.g_strSelKinmuDeptCD

                    '職員管理番号
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_4W)
                    If w_Var <> "" Then
                        w_StaffID = Convert.ToString(w_Var)
                        w_clsObj.pAppliStaffMngID = w_StaffID
                    End If

                    '職員番号
                    w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_StaffIdx = Integer.Parse(w_Var)
                            w_clsObj.pAppliStaffID = m_StaffData(w_StaffIdx).PreID
                        End If
                    End If

                    w_strWorkIdx = Convert.ToString(w_StaffIdx)
                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_Var).Kojyo)
                        If Double.Parse(w_Date) = m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate Then
                            w_lngWorkLoop = w_lngKojyoLoop '退避(控除データ位置)
                            Exit For
                        End If
                    Next w_lngKojyoLoop

                    If w_lngWorkLoop <> 0 Then
                        For w_lngKojyoLoop = 1 To UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate)
                            '次画面へ
                            If InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop))) <= 0 Then
                                w_clsObj.pKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop), m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                       m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                            Else
                                '2018/02/23 Yamanishi Upd --------------------------------------------------------------------------------------------------------------
                                'w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate, _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop), _
                                '                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)

                                w_clsObj.pOuenKojyoDataGet(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate,
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop),
                                                           m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop)) = m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop)
                                '---------------------------------------------------------------------------------------------------------------------------------------
                            End If
                        Next w_lngKojyoLoop
                    End If

                    '行事データ受渡
                    ReDim kojoEvent(0)
                    chkEventTargetStaff(w_StaffID, w_Date, kojoEvent)
                    For i As Integer = 1 To UBound(kojoEvent)
                        w_clsObj.pEventData(kojoEvent(i).uniqNo, kojoEvent(i).EventName, kojoEvent(i).Time_st, kojoEvent(i).Time_ed) = kojoEvent(i).allFlg
                    Next

                    '採用CD
                    w_clsObj.pAppliStaffSaiyoCD = Get_SaiyoCD(Integer.Parse(w_Date), w_StaffID)

                    'HospitalCD
                    w_clsObj.pHospitalCD = General.g_strHospitalCD

                    If m_PackageFLG = 0 OrElse m_PackageFLG = 2 Then
                        '日当直を使用していない場合
                        w_clsObj.pDutyUseFlg = "1"
                        w_clsObj.pDutyKinmuCD = ""
                        w_clsObj.pDutyKinmuCD2 = ""
                        w_clsObj.pAppliStaffDutyGroupCD = ""
                        w_clsObj.pAppliStaffDutyGroupCD2 = ""
                    Else
                        '日当直を使用する場合
                        w_clsObj.pDutyUseFlg = "0"

                        w_Var = .GetText(w_Row - ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_DutyData, w_Col)
                        If w_Var <> "" Then
                            '日当直取得
                            ReDim w_DutyKinmuCD(0)
                            ReDim w_GroupCD(0)

                            'ﾃﾞｰﾀごとに分割
                            Call Get_DutyMark(w_Var, w_DutyKinmuCD, w_GroupCD)

                            w_DutyIndex = 0
                            For w_Loop = 1 To UBound(w_DutyKinmuCD)
                                If IsNumeric(w_DutyKinmuCD(w_Loop)) = True Then
                                    If w_DutyIndex = 0 Then
                                        w_clsObj.pDutyKinmuCD = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD = w_GroupCD(w_Loop)
                                        w_DutyIndex = 1
                                    ElseIf w_DutyIndex = 1 Then
                                        w_clsObj.pDutyKinmuCD2 = w_DutyKinmuCD(w_Loop)
                                        w_clsObj.pAppliStaffDutyGroupCD2 = w_GroupCD(w_Loop)
                                        w_DutyIndex = 2
                                    End If
                                End If
                            Next w_Loop
                            If w_DutyIndex = 0 Then
                                w_clsObj.pDutyKinmuCD = ""
                                w_clsObj.pAppliStaffDutyGroupCD = ""
                            End If
                            If w_DutyIndex <= 1 Then
                                w_clsObj.pDutyKinmuCD2 = ""
                                w_clsObj.pAppliStaffDutyGroupCD2 = ""
                            End If
                        Else
                            w_clsObj.pDutyKinmuCD = ""
                            w_clsObj.pDutyKinmuCD2 = ""
                            w_clsObj.pAppliStaffDutyGroupCD = ""
                            w_clsObj.pAppliStaffDutyGroupCD2 = ""
                        End If
                    End If

                    '#001-----St
                    w_regAppliKbn = "0"
                    If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                        '届出使用時、届出が登録されているか確認する
                        w_Var = .GetText(w_Row - ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, w_Col)
                        Get_AppliMark(w_Var, "", "", "", w_appliKbn, 0, 0, "")
                        'ブランクなら届出登録なし
                        If Not w_Var.Equals("") Then
                            w_regAppliKbn = "1"
                            If w_appliKbn.Equals("1") Then
                                w_regAppliKbn = "2"
                            End If
                        End If
                    End If
                    w_clsObj.pRegistAppliKbn = w_regAppliKbn
                    '#001-----Ed

                    '2018/03/12 Yamanishi Upd Start ------------------------------------------------------------------------------------------------
                    ''時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
                    'w_RecCnt = Len(w_Time) / 28

                    'w_Pos = 1

                    'For w_Loop = 1 To w_RecCnt
                    '    'HolidayBunruiCD
                    '    w_BunruiCD = Mid(w_Time, w_Pos, 2)

                    '    w_Pos = w_Pos + 2

                    '    'FromTime
                    '    w_StartTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_StartTime) = False Then
                    '        w_StartTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'ToTime
                    '    w_EndTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_EndTime) = False Then
                    '        w_EndTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    'DateKbn
                    '    w_KBN = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '時間年休
                    '    w_NenkyuTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NenkyuTime) = False Then
                    '        w_NenkyuTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '休憩減算フラグ
                    '    w_HolSubFlg = Mid(w_Time, w_Pos, 1)

                    '    w_Pos = w_Pos + 1

                    '    '日勤時間
                    '    w_DayTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_DayTime) = False Then
                    '        w_DayTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '夜勤時間
                    '    w_NightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NightTime) = False Then
                    '        w_NightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    '翌日夜勤時間
                    '    w_NextNightTime = Mid(w_Time, w_Pos, 4)
                    '    If IsNumeric(w_NextNightTime) = False Then
                    '        w_NextNightTime = "0"
                    '    End If

                    '    w_Pos = w_Pos + 4

                    '    w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, Integer.Parse(w_StartTime), Integer.Parse(w_EndTime), w_KBN, "", Integer.Parse(w_NenkyuTime), w_HolSubFlg, Integer.Parse(w_DayTime), Integer.Parse(w_NightTime), Integer.Parse(w_NextNightTime)) = ""
                    'Next w_Loop

                    '時間年休件数取得
                    w_strTime = w_Time

                    While w_strTime <> ""
                        w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                   w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime)
                        w_clsObj.pAppliDataGet("", w_BunruiCD, 0, "", 0, 0, w_StartTime, w_EndTime, w_KBN, "",
                                               w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime) = ""
                    End While
                    '2018/03/12 Yamanishi Upd End --------------------------------------------------------------------------------------------------

                    Call Set_DialogZOrder(1)
                    w_clsObj.pProcessObj = Me
                    '時間年休入力 表示
                    w_clsObj.mShowWindow()

                    Call Set_DialogZOrder(0)

                    '入力された値を取得する
                    If w_clsObj.pOKFlg = True Then
                        '初期化
                        w_Time = ""

                        If w_clsObj.pReasonKBN = 6 OrElse Double.Parse(w_RiyuKBN) = 6 Then
                            w_RiyuKBN = w_clsObj.pReasonKBN
                            w_KangoCD = w_clsObj.pOuenKangoCD
                        End If

                        If w_lngWorkLoop = 0 Then
                            '元データがない場合、配列確保
                            w_clsObj.pIndex = 1

                            If w_clsObj.pTimeFrom <> 0 AndAlso w_clsObj.pTimeTo <> 0 Then
                                '戻り値が空でなければ
                                w_lngNo = UBound(m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo) + 1
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo)
                                m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).init()

                                w_lngDataCnt = w_clsObj.pAllKojyoDataCount

                                For w_lngKojyoLoop = 1 To w_lngDataCnt
                                    w_clsObj.pIndex = w_lngKojyoLoop

                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngNikkinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strShinryoKbn(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeFrom(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngTimeTo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngYokuYakinTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strKinmuDetailCD(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strNextFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).strHolSubFlg(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).UniqueseqNo(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).Seq(w_lngDataCnt)
                                    ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngDate = w_clsObj.pAllKDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                    m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngNo).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                                Next w_lngKojyoLoop
                            End If
                        Else
                            'データがある場合、上書き
                            w_lngDataCnt = w_clsObj.pAllKojyoDataCount

                            '配列初期化
                            m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).init()

                            For w_lngKojyoLoop = 1 To w_lngDataCnt
                                w_clsObj.pIndex = w_lngKojyoLoop

                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strNextFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).Seq(w_lngDataCnt)
                                ReDim Preserve m_StaffData(w_strWorkIdx).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngDataCnt) '2018/02/23 Yamanishi Add

                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngDate = w_clsObj.pAllKDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailDate(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailDate
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngNikkinTime(w_lngKojyoLoop) = w_clsObj.pAllNikkinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strShinryoKbn(w_lngKojyoLoop) = w_clsObj.pAllShinryoKbn
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeFrom(w_lngKojyoLoop) = w_clsObj.pAllTimeFrom
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngTimeTo(w_lngKojyoLoop) = w_clsObj.pAllTimeTo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngYokuYakinTime(w_lngKojyoLoop) = w_clsObj.pAllYokuYakinTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strKinmuDetailCD(w_lngKojyoLoop) = w_clsObj.pAllKinmuDetailCD
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strNextFlg(w_lngKojyoLoop) = w_clsObj.pAllNextFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).lngKinmuDetailTime(w_lngKojyoLoop) = w_clsObj.pAllKoujyoTime
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).strHolSubFlg(w_lngKojyoLoop) = w_clsObj.pAllHolGensanFlg
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).UniqueseqNo(w_lngKojyoLoop) = w_clsObj.pUniqNo
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).Seq(w_lngKojyoLoop) = w_clsObj.pSeq
                                m_StaffData(Integer.Parse(w_strWorkIdx)).Kojyo(w_lngWorkLoop).OuenKinmuDeptCD(w_lngKojyoLoop) = w_clsObj.pAllOuenKinmuDeptCD '2018/02/23 Yamanishi Add
                            Next w_lngKojyoLoop
                        End If

                        '時間年休文字列(１件は１１ﾊﾞｲﾄ)取得
                        For w_Loop = 1 To w_clsObj.pDataCount
                            w_clsObj.pIndex = w_Loop

                            '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                            ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                            'w_BunruiCD = w_clsObj.pHolBunruiCD
                            'If w_BunruiCD = "" Then
                            '    w_Time = w_Time & Space(2)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 2}", w_BunruiCD)
                            'End If
                            ''FromTime(ﾊﾞｲﾄ数４)
                            'w_StartTime = Convert.ToString(w_clsObj.pFromTime)
                            'If w_StartTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_StartTime)
                            'End If
                            ''ToTime(ﾊﾞｲﾄ数４)
                            'w_EndTime = Convert.ToString(w_clsObj.pToTime)
                            'If w_EndTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_EndTime)
                            'End If
                            ''DateKbn(ﾊﾞｲﾄ数１)
                            'w_KBN = w_clsObj.pNextdayFlg
                            'w_Time = w_Time & w_KBN
                            ''時間年休
                            'w_NenkyuTime = Convert.ToString(w_clsObj.pNenkyuTime)
                            'If w_NenkyuTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NenkyuTime)
                            'End If
                            ''休憩減算フラグ
                            'w_HolSubFlg = w_clsObj.pHolGensanFlg2
                            'w_Time = w_Time & w_HolSubFlg
                            ''日勤時間
                            'w_DayTime = Convert.ToString(w_clsObj.pDayTime)
                            'If w_DayTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_DayTime)
                            'End If
                            ''夜勤時間
                            'w_NightTime = Convert.ToString(w_clsObj.pNightDayTime)
                            'If w_NightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NightTime)
                            'End If
                            ''翌日夜勤時間
                            'w_NextNightTime = Convert.ToString(w_clsObj.pNextNightTime)
                            'If w_NextNightTime = "" Then
                            '    w_Time = w_Time & Space(4)
                            'Else
                            '    w_Time = w_Time & String.Format("{0, 4}", w_NextNightTime)
                            'End If

                            w_Time = w_Time & Set_NenkyuTime(w_clsObj.pHolBunruiCD, w_clsObj.pFromTime, w_clsObj.pToTime,
                                                             w_clsObj.pNextdayFlg, w_clsObj.pNenkyuTime, w_clsObj.pHolGensanFlg2,
                                                             w_clsObj.pDayTime, w_clsObj.pNightDayTime, w_clsObj.pNextNightTime)
                            '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                        Next w_Loop

                        '2015/04/10 Bando Upd Start =====================================
                        'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                        w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                        '2015/04/10 Bando Upd End   =====================================

                        '勤務記号貼り付け
                        .SetText(w_Row2, w_Col, w_Var)

                        '色分け（時間入力の判断はw_Time<>0で行う）
                        If w_Time <> "" Then
                            '時間年休をを取得している場合
                            w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                        Else
                            Select Case w_RiyuKBN
                                Case "1" '通常
                                    w_BackColor = Color.White
                                Case "2" '要請
                                    w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                Case "3" '希望
                                    '2015/07/21 Bando Upd Start ===========================
                                    If w_Comment = "" Then
                                        w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                    Else
                                        w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                    End If
                                    '2015/07/21 Bando Upd End   ===========================
                                Case "4" '再掲
                                    w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                Case "5" '委員会
                                    w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                Case "6" '応援
                                    w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                Case Else 'その他
                                    w_BackColor = Color.White
                            End Select

                            '代休発生勤務 文字/背景色
                            If General.g_lngDaikyuMng = 0 Then
                                w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                            w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                        End If
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add Start ===========================
                            '控除があるか判断し　背景色変更
                            w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var2 <> "" Then
                                w_StaffIdx = Integer.Parse(w_Var2)
                                If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                    'w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                    If w_Var2 <> "" Then
                                        For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                            If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                    Exit For
                                                End If
                                                w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                Exit For
                                            End If
                                        Next
                                    End If
                                End If
                            End If
                            '2015/07/22 Bando Add End   ===========================
                        End If

                        .Cells(w_Row2, w_Col).BackColor = w_BackColor

                        '予定と実績が異なる時、予定側の時間年休も更新する
                        w_blnFLG = False
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            w_VarPlan = .GetText(w_Row2 + 1, w_Col)
                            If m_blnJissekiUseFlg Then
                                '二段表示の時
                                If (w_Row2 - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                    '下段選択の時
                                    w_VarPlan = .GetText(w_Row2 - 1, w_Col)
                                    If w_VarPlan <> "" AndAlso Not .Cells(w_Row2 - 1, w_Col).BackColor.Equals(Color.Black) Then
                                        '上段にデータが存在 かつ 上段の背景色が黒の時
                                        w_RowPlan = w_Row2 - 1
                                        w_blnFLG = True
                                    End If
                                End If
                            ElseIf w_VarPlan <> "" Then
                                '一段表示　かつ　下段にデータが存在する時
                                w_RowPlan = w_Row2 + 1
                                w_blnFLG = True
                            End If
                        End If

                        If w_blnFLG Then
                            '予定と実績が異なる時
                            '2015/04/10 Bando Upd Start ===================================
                            'Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "")
                            'w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time)
                            Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "", w_Comment)
                            w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                            '2015/04/10 Bando Upd End   ===================================

                            '勤務記号貼り付け
                            .SetText(w_RowPlan, w_Col, w_VarPlan)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN2
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        '2015/07/21 Bando Upd Start ===========================
                                        If w_Comment = "" Then
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Else
                                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                        End If
                                        '2015/07/21 Bando Upd End   ===========================
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        'w_Var2 = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            .Cells(w_RowPlan, w_Col).BackColor = w_BackColor

                            '理由区分が違う場合は勤務変更扱い
                            If w_RiyuKBN <> w_RiyuKBN2 Then
                                .Cells(w_Row2, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                            End If
                        End If

                        If Get_Col_M(w_Date, w_Col) = True Then

                            'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                            sprSheet_M.Sheets(0).SetText(w_Row2, w_Col, w_Var)

                            '色分け（時間入力の判断はw_Time<>0で行う）
                            If w_Time <> "" Then
                                '時間年休をを取得している場合
                                w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                            Else
                                Select Case w_RiyuKBN
                                    Case "1" '通常
                                        w_BackColor = Color.White
                                    Case "2" '要請
                                        w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                    Case "3" '希望
                                        '2015/07/21 Bando Upd Start ===================
                                        If w_Comment = "" Then
                                            w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                        Else
                                            w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                        End If
                                        '2015/07/21 Bando Upd End   ===================
                                    Case "4" '再掲
                                        w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                    Case "5" '委員会
                                        w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                    Case "6" '応援
                                        w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                    Case Else 'その他
                                        w_BackColor = Color.White
                                End Select

                                '代休発生勤務 文字/背景色
                                If General.g_lngDaikyuMng = 0 Then
                                    w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                            End If
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add Start ===========================
                                '控除があるか判断し　背景色変更
                                w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                If w_Var2 <> "" Then
                                    w_StaffIdx = Integer.Parse(w_Var2)
                                    If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                        'w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                        If w_Var2 <> "" Then
                                            For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                    If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                        Exit For
                                                    End If
                                                    w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                    Exit For
                                                End If
                                            Next
                                        End If
                                    End If
                                End If
                                '2015/07/22 Bando Add End   ===========================
                            End If

                            sprSheet_M.Sheets(0).Cells(w_Row2, w_Col).BackColor = w_BackColor

                            '予定と実績が異なる時、予定側の時間年休も更新する
                            If w_blnFLG Then
                                '勤務記号貼り付け
                                sprSheet_M.Sheets(0).SetText(w_RowPlan, w_Col, w_VarPlan)

                                '色分け（時間入力の判断はw_Time<>0で行う）
                                If w_Time <> "" Then
                                    '時間年休をを取得している場合
                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                Else
                                    Select Case w_RiyuKBN2
                                        Case "1" '通常
                                            w_BackColor = Color.White
                                        Case "2" '要請
                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                        Case "3" '希望
                                            '2015/07/21 Bando Upd Start ===================
                                            If w_Comment = "" Then
                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                            Else
                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                            End If
                                            '2015/07/21 Bando Upd End   ===================
                                        Case "4" '再掲
                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                        Case "5" '委員会
                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                        Case "6" '応援
                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                        Case Else 'その他
                                            w_BackColor = Color.White
                                    End Select

                                    '代休発生勤務 文字/背景色
                                    If General.g_lngDaikyuMng = 0 Then
                                        w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                        If w_Var2 <> "" Then
                                            w_StaffIdx = Integer.Parse(w_Var2)
                                            w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_StaffIdx) = True Then
                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                End If
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add Start ===========================
                                    '控除があるか判断し　背景色変更
                                    w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                    If w_Var2 <> "" Then
                                        w_StaffIdx = Integer.Parse(w_Var2)
                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                            'w_Var2 = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                                            w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                                            If w_Var2 <> "" Then
                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                            Exit For
                                                        End If
                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                        Exit For
                                                    End If
                                                Next
                                            End If
                                        End If
                                    End If
                                    '2015/07/22 Bando Add End   ===========================
                                End If

                                sprSheet_M.Sheets(0).Cells(w_RowPlan, w_Col).BackColor = w_BackColor

                                '理由区分が違う場合は勤務変更扱い
                                If w_RiyuKBN <> w_RiyuKBN2 Then
                                    sprSheet_M.Sheets(0).Cells(w_Row2, w_Col).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                End If
                            End If
                        End If
                    End If

                    'ｸﾗｽｵﾌﾞｼﾞｪｸﾄ解放
                    w_clsObj = Nothing

                    '処理のちらつきを隠す
                    picCover.Top = picBase.Top
                    picCover.Left = picBase.Left
                    picCover.Width = picBase.Width
                    picCover.Height = picBase.Height
                    picCover.Visible = True

                    For w_Loop = m_StaffRow.StartRow To m_StaffRow.EndRow
                        If ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_Loop - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                            '勤務のみ集計

                            '個人別集計 計算実行(計画期間)
                            Call RunReCalc_PUser(w_Loop)
                            '4週個人別集計 計算実行(計画期間)
                            Call RunReCalc_User_4W(w_Loop)
                            Call RunReCalc_PUser_Jisseki(w_Loop)
                        End If
                    Next w_Loop

                    picCover.Visible = False
                End With
            End If

            '2016/04/05 Ishiga add start---
            Call Set_UndoData()
            '2016/04/05 Ishiga add end-----

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    'BlockSelectedでは、１行複数列の場合に動作しなかった
    Private Sub sprSheet_M_SelChange(ByVal eventSender As System.Object, ByVal eventArgs As SelectionChangedEventArgs) Handles sprSheet_M.SelectionChanged

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_SelChange"
        Try
            If eventArgs.Range.ColumnCount = 1 AndAlso eventArgs.Range.RowCount = 1 Then
                Exit Sub
            End If

            'ブロック選択された時は左上のセル位置を渡す
            Call Set_CopyMenu(eventArgs.Range.Column, eventArgs.Range.Row, True)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_TopChange(ByVal eventSender As System.Object, ByVal eventArgs As TopChangeEventArgs) Handles sprSheet_M.TopChange

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_TopLeftChange"

        Static w_Top As Integer
        Try
            'TopRowの制御
            If w_Top <> eventArgs.NewTop Then
                sprPTotal.SetViewportTopRow(0, eventArgs.NewTop)
                w_Top = eventArgs.NewTop
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_TopLeftChange(ByVal eventSender As System.Object, ByVal eventArgs As LeftChangeEventArgs) Handles sprSheet_M.LeftChange

        Const W_SUBNAME As String = "NSK0000HA sprSheet_M_TopLeftChange"

        Static w_Left As Integer
        Try
            'LeftColの制御
            If w_Left <> eventArgs.NewLeft Then
                sprDayTotal_M.SetViewportLeftColumn(0, eventArgs.NewLeft)
                w_Left = eventArgs.NewLeft
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub tbrMain_ButtonClick(ByVal eventSender As System.Object, ByVal eventArgs As ToolStripItemClickedEventArgs) Handles tbrMain.ItemClicked

        Const W_SUBNAME As String = "NSK0000HA tbrMain_ButtonClick"

        Dim w_Loop As Integer
        Dim w_intShowLine As Integer
        Dim w_ShowLineFLG As Boolean
        Try
            Select Case eventArgs.ClickedItem.Name
                Case M_ToolBarKey_NormalEnd
                    '保存終了
                    Call m_lstmnuFile_Click(m_lstmnuFile.Item(M_MenuEnd), New System.EventArgs())

                '2017/08/07 Angelo Add st---------------------------------------------------------------------------
                Case M_ToolBarKey_SaveCall
                    '保存呼出
                    Call m_lstmnuFile_Click(m_lstmnuFile.Item(M_MenuSaveCall), New System.EventArgs())
                '2017/08/07 Angelo Add en---------------------------------------------------------------------------

                Case M_ToolBarKey_KakuteiEnd
                    '確定終了
                    Call m_lstmnuFile_Click(m_lstmnuFile.Item(M_MenuKakutei), New System.EventArgs())

                Case M_ToolBarKey_StaffEdit
                    '職員情報設定
                    Call m_lstmnuSet_Click(m_lstmnuSet.Item(M_MenuStaff), New System.EventArgs())

                Case M_ToolBarKey_AutoAssign
                    '自動割当
                    Call m_lstmnuJidou_Click(m_lstmnuJidou.Item(M_MenuJidouRun), New System.EventArgs())

                Case M_ToolBarKey_Palette
                    'ﾊﾟﾚｯﾄ画面
                    Call m_lstmnuView_Click(m_lstmnuView.Item(M_MenuPalette), New System.EventArgs())

                Case M_ToolBarKey_Search
                    '検索
                    Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuKensaku), New System.EventArgs())

                Case M_ToolBarKey_Tikan
                    '置換
                    Call m_lstmnuEdit_Click(m_lstmnuEdit.Item(M_MenuChikan), New System.EventArgs())

                Case M_ToolBarKey_PlanTwo
                    '勤務表示切替
                    w_intShowLine = -1
                    w_ShowLineFLG = False

                    For w_Loop = 0 To 3
                        If m_lstmnuKinmuView(w_Loop).Available Then
                            If w_ShowLineFLG = True Then
                                w_intShowLine = w_Loop
                                Exit For
                            End If
                            If m_lstmnuKinmuView(w_Loop).Checked Then
                                w_ShowLineFLG = True
                            End If
                        End If
                    Next w_Loop

                    If w_intShowLine = -1 Then
                        For w_Loop = 0 To 3
                            If m_lstmnuKinmuView(w_Loop).Available Then
                                w_intShowLine = w_Loop
                                Exit For
                            End If
                        Next w_Loop
                    End If

                    Call m_lstmnuKinmuView_Click(m_lstmnuKinmuView.Item(w_intShowLine), New System.EventArgs())

                Case M_ToolBarKey_ErrorCheck
                    'エラーチェック実行
                    Call m_lstmnuTool_Click(m_lstmnuTool.Item(M_MenuReCheck), New System.EventArgs())

                Case M_ToolBarKey_ErrorList
                    Call m_lstmnuTool_Click(m_lstmnuTool.Item(M_MenuErrorList), New System.EventArgs())

                Case M_ToolBarKey_Gyouji
                    '行事
                    If m_GyoujiFlg Then
                        m_GyoujiFlg = False
                    Else
                        m_GyoujiFlg = True
                    End If

                    For w_Loop = 0 To 3
                        If m_lstmnuKinmuView(w_Loop).Available Then
                            If m_lstmnuKinmuView(w_Loop).Checked Then
                                w_intShowLine = w_Loop
                                Exit For
                            End If
                        End If
                    Next w_Loop

                    Call m_lstmnuKinmuView_Click(m_lstmnuKinmuView.Item(w_intShowLine), New System.EventArgs())
                    '2014/06/03 Shimizu add start P-06980----
                Case M_ToolBarKey_TimeTable
                    Call m_lstmnuView_Click(m_lstmnuView.Item(M_MenuTimeTable), New System.EventArgs())
                    '2014/06/03 Shimizu add start P-06980----
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub Set_ErrorList()

        Const W_SUBNAME As String = "NSK0000HA Set_ErrorList"


        Dim w_ErrInfForm As Object
        Dim w_intCnt As Integer
        Dim w_SprObj As FpSpread = Nothing
        Dim w_Var As Object
        Dim w_Int As Integer
        Dim w_intTeam As Integer
        Dim w_lngViewFrom As Integer
        Dim w_lngViewTo As Integer
        Dim w_intSelStaffIdx As Integer
        Dim w_intSelDateIdx As Integer
        Dim w_SelectIndex As Integer

        'ｴﾗｰ情報表示画面設定
        w_ErrInfForm = New frmNSK0000HN

        ReDim g_NotPatternError2(0)
        ReDim g_NotKinmuError2(0)
        ReDim g_KikanError2(0)
        ReDim g_RenzokuError2(0) '2015/05/13 Ishiga add

        w_intCnt = 0
        Try
            For w_Int = m_StaffRow.StartRow To m_StaffRow.EndRow
                If w_Int = m_StaffRow.StartRow Then
                    '4週/1ヶ月の場合の計画期間開始日を取得する
                    If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                        '4週/1ヶ月の場合
                        If m_SelViewKikan = 0 Then
                            w_SprObj = sprSheet_M
                            w_lngViewFrom = m_KeikakuKikan.StartDate
                            w_lngViewTo = m_KeikakuKikan.EndDate
                        Else
                            w_SprObj = sprSheet_4W
                            w_SelectIndex = Integer.Parse(GetItemData(cmbKikan, cmbKikan.SelectedIndex))
                            w_lngViewFrom = m_4WeekKikan(w_SelectIndex).StartDate
                            w_lngViewTo = m_4WeekKikan(w_SelectIndex).EndDate
                        End If
                    Else
                        w_SprObj = sprSheet_M
                        w_lngViewFrom = m_KeikakuKikan.StartDate
                        w_lngViewTo = m_KeikakuKikan.EndDate
                    End If
                End If

                'チームを取得する
                w_intTeam = 0
                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ヶ月の場合
                    If m_SelViewKikan = 0 Then
                        w_Var = w_SprObj.Sheets(0).GetText(w_Int, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    Else
                        w_Var = w_SprObj.Sheets(0).GetText(w_Int, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    End If
                Else
                    w_Var = w_SprObj.Sheets(0).GetText(w_Int, m_StaffZokusei(M_HairetuNo).SetCol_M)
                End If

                If IsNumeric(w_Var) = True Then
                    w_intTeam = m_StaffData(Integer.Parse(w_Var)).Team
                End If

                If cmbTeam.Visible = True Then
                    If (cmbTeam.SelectedIndex = 0 OrElse cmbTeam.SelectedIndex = w_intTeam) Then
                        'ｴﾗｰﾁｪｯｸを行う
                        If (w_Int - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                            If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                Call Check_PersonalCalc2(w_Int, True)
                                Call Check_PersonalCalc3(w_Int, True)
                            Else
                                Call Check_PersonalCalc2(w_Int, False)
                                Call Check_PersonalCalc3(w_Int, False)
                            End If
                        End If
                        w_intCnt = w_intCnt + 1
                    End If
                Else
                    If (w_Int - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                            Call Check_PersonalCalc2(w_Int, True)
                            Call Check_PersonalCalc3(w_Int, True)
                        Else
                            Call Check_PersonalCalc2(w_Int, False)
                            Call Check_PersonalCalc3(w_Int, False)
                        End If
                    End If
                    w_intCnt = w_intCnt + 1
                End If

                If w_intCnt = 1 Then
                    '計画期間／表示期間
                    w_ErrInfForm.pViewFrom = w_lngViewFrom
                    w_ErrInfForm.pViewTo = w_lngViewTo
                    'ｴﾗｰﾁｪｯｸ項目
                    w_ErrInfForm.pCountCheck = m_lstmnuCheck(M_MenuKinmuCount).Checked '回数ﾁｪｯｸ
                    w_ErrInfForm.pIntervalCheck = m_lstmnuCheck(M_MenuKinmuInterval).Checked '間隔ﾁｪｯｸ
                    w_ErrInfForm.pPatternCheck = m_lstmnuCheck(M_MenuKinmuPattern).Checked '禁止ﾊﾟﾀｰﾝ
                    w_ErrInfForm.pNotKinmuCheck = m_lstmnuCheck(M_MenuKinsiKinmu).Checked '禁止勤務
                    w_ErrInfForm.pStaffPatternCheck = m_lstmnuCheck(M_MenuStaffPattern).Checked '禁止職員ﾊﾟﾀｰﾝ
                    w_ErrInfForm.pGiryoType = m_lstmnuCheck(M_MenuGiryoCheck).Checked '経験区分の組み合わせ
                    w_ErrInfForm.pRenzokuKinmuCheck = m_lstmnuCheck(M_MenuRenzokuKinmuInterval).Checked '連続勤務
                    w_ErrInfForm.pAbsoluteKinmuCheck = m_lstmnuCheck(M_MenuAbsoluteKinmu).Checked '必須勤務
                End If
            Next w_Int

            '禁止職員ﾊﾟﾀｰﾝﾁｪｯｸ
            ReDim g_NotStaffPatternError2(0)
            If m_lstmnuCheck(M_MenuStaffPattern).Checked = True Then
                For w_Int = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    Call Check_DayNotSetStaffPattern(w_Int)
                Next w_Int
            End If

            '経験区分の組み合わせチェック
            ReDim g_NotGiryoCheckError(0)
            If m_lstmnuCheck(M_MenuGiryoCheck).Checked = True Then
                For w_Int = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    Call Check_GiryoType(w_Int)
                Next w_Int
            End If

            '必須対象勤務コード取得
            Call getAbsKinmuData()

            '必須勤務チェック
            ReDim g_NotAbsKinmuCheckError(0)
            ReDim m_RenzokuCnt(UBound(m_StaffData), UBound(m_strAbsKinmuCD))

            If m_lstmnuCheck(M_MenuAbsoluteKinmu).Checked Then
                For w_Int = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    Call Check_AbsoluteKinmu(w_Int)
                Next w_Int
            End If

            '表示
            w_ErrInfForm.ShowDialog(Me)

            '2018-12-18 DARREN UPDATE START
            'w_intSelStaffIdx = w_ErrInfForm.pStaffIdxGet
            'w_intSelDateIdx = w_ErrInfForm.pDateIdxGet

            'w_ErrInfForm = Nothing

            ''カーソルをあわせる
            'Call Set_Cursor(w_intSelStaffIdx, w_intSelDateIdx)

            If w_ErrInfForm.pStaffIdxGet <> 0 Then
                w_intSelStaffIdx = w_ErrInfForm.pStaffIdxGet
                w_intSelDateIdx = w_ErrInfForm.pDateIdxGet

                'カーソルをあわせる
                Call Set_Cursor(w_intSelStaffIdx, w_intSelDateIdx)
            End If

            w_ErrInfForm = Nothing
            '2018-12-18 DARREN UPDATE END

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '集計対象外チェック
    Private Function Check_OutCalc(ByVal p_Row As Integer, ByVal p_Seq As Integer, ByVal p_SpreadNo As Integer) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Check_OutCalc"

        Dim w_Var As Object
        Dim w_StaffID As String
        Dim w_JobCD As String
        Dim w_PostCD As String
        Dim w_StaffLoop As Integer

        '初期値
        Check_OutCalc = False
        w_StaffID = ""
        w_JobCD = ""
        w_PostCD = ""
        Try
            '職員管理番号取得
            If p_SpreadNo = 1 Then
                w_Var = m_Spread(p_SpreadNo).Sheets(0).GetText(p_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                If w_Var <> "" Then
                    w_StaffID = Convert.ToString(w_Var)
                    '職員数分ﾙｰﾌﾟ
                    For w_StaffLoop = 1 To UBound(m_StaffData)
                        If m_StaffData(w_StaffLoop).ID = w_StaffID Then
                            '対象職員の職種、役職CD取得
                            w_JobCD = String.Format("{0, 4}", m_StaffData(w_StaffLoop).JobCode)
                            w_PostCD = String.Format("{0, 4}", m_StaffData(w_StaffLoop).PostCode)

                            Exit For
                        End If
                    Next w_StaffLoop
                Else
                    '職員管理番号がない場合、対象外とする
                    Exit Function
                End If
            ElseIf p_SpreadNo = 2 Then
                w_Var = m_Spread(p_SpreadNo).Sheets(0).GetText(p_Row, m_StaffZokusei(M_StaffID).SetCol_4W)
                If w_Var <> "" Then
                    w_StaffID = Convert.ToString(w_Var)
                    '職員数分ﾙｰﾌﾟ
                    For w_StaffLoop = 1 To UBound(m_StaffData)
                        If m_StaffData(w_StaffLoop).ID = w_StaffID Then
                            '対象職員の職種、役職CD取得
                            w_JobCD = String.Format("{0, 4}", m_StaffData(w_StaffLoop).JobCode)
                            w_PostCD = String.Format("{0, 4}", m_StaffData(w_StaffLoop).PostCode)

                            Exit For
                        End If
                    Next w_StaffLoop
                Else
                    '職員管理番号がない場合、対象外とする
                    Exit Function
                End If
            Else
                Exit Function
            End If

            '計画単位？
            Select Case p_SpreadNo
                Case 1 '１ヶ月（ﾃﾞｰﾀ："1"）
                    '対象外職種かどうか
                    If w_JobCD <> "" AndAlso InStr(m_VMtrx(p_Seq).CalcJobStr, w_JobCD) > 0 Then
                        '対象外職種
                        Exit Function
                    End If

                    '対象外役職かどうか
                    If w_PostCD <> "" AndAlso InStr(m_VMtrx(p_Seq).CalcPostStr, w_PostCD) > 0 Then
                        '対象外役職
                        Exit Function
                    End If

                Case 2 '４週（ﾃﾞｰﾀ："2"）
                    '対象外職種かどうか
                    If w_JobCD <> "" AndAlso InStr(m_VMtrx(p_Seq).CalcJobStr, w_JobCD) > 0 Then
                        '対象外職種
                        Exit Function
                    End If

                    '対象外役職かどうか
                    If w_PostCD <> "" AndAlso InStr(m_VMtrx(p_Seq).CalcPostStr, w_PostCD) > 0 Then
                        '対象外役職
                        Exit Function
                    End If

                Case Else
                    Exit Function
            End Select

            Check_OutCalc = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '2018/03/07 Yamanishi Upd Start ---------------------------------------------------------------------------------------------
    ''控除データ取得 取得
    'Private Sub Get_KojyoData(ByVal p_FromDate As Integer, ByVal p_ToDate As Integer, ByVal p_StaffIdx As Integer)

    '    Const W_SUBNAME As String = "NSK0000HA Get_KojyoData"

    '    Dim w_Rs As ADODB.Recordset
    '    Dim w_Date_F As ADODB.Field
    '    Dim w_KinmuDetailDate_F As ADODB.Field
    '    Dim w_NikkinTime_F As ADODB.Field
    '    Dim w_ShinryoKbn_F As ADODB.Field
    '    Dim w_TimeFrom_F As ADODB.Field
    '    Dim w_TimeTo_F As ADODB.Field
    '    Dim w_YakinTime_F As ADODB.Field
    '    Dim w_YokuYakinTime_F As ADODB.Field
    '    Dim w_KinmuDetailCD_F As ADODB.Field
    '    Dim w_NextFlg_F As ADODB.Field
    '    Dim w_KinmuDetailTime_F As ADODB.Field
    '    Dim w_HolSubFlg_F As ADODB.Field
    '    Dim w_UniqueseqNo_F As ADODB.Field
    '    Dim w_Seq_F As ADODB.Field
    '    Dim w_Date As Integer
    '    Dim w_PreDate As Integer
    '    Dim w_RecCnt As Integer
    '    Dim w_Int As Integer
    '    Dim w_Index As Integer
    '    Dim w_DayIndex As Integer
    '    Dim w_strSql As String
    '    Try
    '        '控除データ格納配列の初期化
    '        ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(0)

    '        '届出CD
    '        '2017/11/20 Yamanishi Upd Start ------------------------------------------------------------------------
    '        'w_strSql = "Select * "
    '        'w_strSql = w_strSql & "From NS_KINMUDETAIL_F "
    '        'w_strSql = w_strSql & "Where HOSPITALCD = '" & General.g_strHospitalCD & "' "
    '        'w_strSql = w_strSql & "And STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
    '        ''w_strSql = w_strSql & "And DATEF >= " & p_FromDate & " "
    '        'w_strSql = w_strSql & "And DATEF >= " & Date.Parse(p_FromDate.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd") & " " '2016/09/30 Yamanishi Upd
    '        'w_strSql = w_strSql & "And   DATEF <= " & p_ToDate & " "
    '        'w_strSql = w_strSql & "Order By DATEF "
    '        w_Date = Integer.Parse(Date.Parse(p_FromDate.ToString("0000/00/00")).AddDays(-1).ToString("yyyyMMdd"))
    '        w_strSql = " SELECT "
    '        w_strSql = w_strSql & "   KD.DATEF "
    '        w_strSql = w_strSql & " , KD.KINMUDETAILDATE "
    '        w_strSql = w_strSql & " , KD.DAYTIME "
    '        w_strSql = w_strSql & " , KD.REZEPTCALCKBN "
    '        w_strSql = w_strSql & " , KD.FROMTIME "
    '        w_strSql = w_strSql & " , KD.TOTIME "
    '        w_strSql = w_strSql & " , KD.NIGHTTIME "
    '        w_strSql = w_strSql & " , KD.NEXTNIGHTTIME "
    '        w_strSql = w_strSql & " , KD.KINMUDETAILCD "
    '        w_strSql = w_strSql & " , KD.NEXTDAYFLG "
    '        w_strSql = w_strSql & " , KD.KINMUDETAILTIME "
    '        w_strSql = w_strSql & " , KD.HOLSUBFLG "
    '        w_strSql = w_strSql & " , KD.UNIQUESEQNO "
    '        w_strSql = w_strSql & " , KD.SEQ "
    '        w_strSql = w_strSql & " FROM "
    '        w_strSql = w_strSql & "   NS_KINMUDETAIL_F KD "
    '        If m_intSelSaveNo > 0 Then
    '            w_strSql = w_strSql & "   LEFT OUTER JOIN NS_KINMUIDOINFO_F KI "
    '            w_strSql = w_strSql & "     ON  KI.HOSPITALCD  = KD.HOSPITALCD "
    '            w_strSql = w_strSql & "     AND KI.STAFFMNGID  = KD.STAFFMNGID "
    '            w_strSql = w_strSql & "     AND KD.DATEF BETWEEN KI.IDODATE AND KI.ENDDATE "
    '            w_strSql = w_strSql & "   LEFT OUTER JOIN NS_PLANCONTROL_F PC "
    '            w_strSql = w_strSql & "     ON  PC.HOSPITALCD  = KD.HOSPITALCD "
    '            w_strSql = w_strSql & "     AND KD.DATEF BETWEEN PC.PLANPERIODFROM AND PC.PLANPERIODTO "
    '        End If
    '        w_strSql = w_strSql & " WHERE "
    '        w_strSql = w_strSql & "     KD.HOSPITALCD  = '" & General.g_strHospitalCD & "' "
    '        w_strSql = w_strSql & " AND KD.STAFFMNGID  = '" & m_StaffData(p_StaffIdx).ID & "' "
    '        w_strSql = w_strSql & " AND KD.DATEF BETWEEN  " & w_Date & " AND " & p_ToDate
    '        If m_intSelSaveNo > 0 Then
    '            w_strSql = w_strSql & " AND (KI.KINMUDEPTCD IS NULL "
    '            w_strSql = w_strSql & "  OR  KI.KINMUDEPTCD <> '" & General.g_strSelKinmuDeptCD & "' "
    '            w_strSql = w_strSql & "  OR  PC.PLANNO      IS NULL "
    '            w_strSql = w_strSql & "  OR  PC.PLANNO      <>  " & m_PlanNo & ") "
    '            w_strSql = w_strSql & " UNION ALL "
    '            w_strSql = w_strSql & " SELECT "
    '            w_strSql = w_strSql & "   KD.DATEF "
    '            w_strSql = w_strSql & " , KD.KINMUDETAILDATE "
    '            w_strSql = w_strSql & " , KD.DAYTIME "
    '            w_strSql = w_strSql & " , KD.REZEPTCALCKBN "
    '            w_strSql = w_strSql & " , KD.FROMTIME "
    '            w_strSql = w_strSql & " , KD.TOTIME "
    '            w_strSql = w_strSql & " , KD.NIGHTTIME "
    '            w_strSql = w_strSql & " , KD.NEXTNIGHTTIME "
    '            w_strSql = w_strSql & " , KD.KINMUDETAILCD "
    '            w_strSql = w_strSql & " , KD.NEXTDAYFLG "
    '            w_strSql = w_strSql & " , KD.KINMUDETAILTIME "
    '            w_strSql = w_strSql & " , KD.HOLSUBFLG "
    '            w_strSql = w_strSql & " , KD.UNIQUESEQNO "
    '            w_strSql = w_strSql & " , KD.SEQ "
    '            w_strSql = w_strSql & " FROM NS_TEMPKINMUDETAIL_F KD "
    '            w_strSql = w_strSql & "   INNER JOIN NS_KINMUIDOINFO_F KI "
    '            w_strSql = w_strSql & "     ON  KI.HOSPITALCD  = KD.HOSPITALCD "
    '            w_strSql = w_strSql & "     AND KI.STAFFMNGID  = KD.STAFFMNGID "
    '            w_strSql = w_strSql & "     AND KD.DATEF BETWEEN KI.IDODATE AND KI.ENDDATE "
    '            w_strSql = w_strSql & "     AND KI.KINMUDEPTCD = KD.KINMUDEPTCD "
    '            w_strSql = w_strSql & "   INNER JOIN NS_PLANCONTROL_F PC "
    '            w_strSql = w_strSql & "     ON  PC.HOSPITALCD  = KD.HOSPITALCD "
    '            w_strSql = w_strSql & "     AND PC.PLANNO      = KD.PLANNO "
    '            w_strSql = w_strSql & "     AND KD.DATEF BETWEEN PC.PLANPERIODFROM AND PC.PLANPERIODTO "
    '            w_strSql = w_strSql & " WHERE "
    '            w_strSql = w_strSql & "     KD.HOSPITALCD  = '" & General.g_strHospitalCD & "' "
    '            w_strSql = w_strSql & " AND KD.PLANNO      =  " & m_PlanNo
    '            w_strSql = w_strSql & " AND KD.KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
    '            w_strSql = w_strSql & " AND KD.SAVENO      =  " & m_intSelSaveNo
    '            w_strSql = w_strSql & " AND KD.STAFFMNGID  = '" & m_StaffData(p_StaffIdx).ID & "' "
    '            w_strSql = w_strSql & " AND KD.DATEF BETWEEN  " & w_Date & " AND " & p_ToDate
    '        End If
    '        w_strSql = w_strSql & "ORDER BY DATEF, NEXTDAYFLG, FROMTIME, SEQ "
    '        '2017/11/20 Yamanishi Upd End --------------------------------------------------------------------------

    '        'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ 生成
    '        w_Rs = General.paDBRecordSetOpen(w_strSql)

    '        If w_Rs.RecordCount <= 0 Then
    '        Else
    '            With w_Rs
    '                .MoveLast()
    '                w_RecCnt = .RecordCount
    '                .MoveFirst()

    '                w_Date_F = .Fields("DATEF")
    '                w_KinmuDetailDate_F = .Fields("KINMUDETAILDATE")
    '                w_NikkinTime_F = .Fields("DAYTIME")
    '                w_ShinryoKbn_F = .Fields("REZEPTCALCKBN")
    '                w_TimeFrom_F = .Fields("FROMTIME")
    '                w_TimeTo_F = .Fields("TOTIME")
    '                w_YakinTime_F = .Fields("NIGHTTIME")
    '                w_YokuYakinTime_F = .Fields("NEXTNIGHTTIME")
    '                w_KinmuDetailCD_F = .Fields("KINMUDETAILCD")
    '                w_NextFlg_F = .Fields("NEXTDAYFLG")
    '                w_KinmuDetailTime_F = .Fields("KINMUDETAILTIME")
    '                w_HolSubFlg_F = .Fields("HolSubFlg")
    '                w_UniqueseqNo_F = .Fields("UNIQUESEQNO")
    '                w_Seq_F = .Fields("SEQ")

    '                w_PreDate = 0

    '                For w_Int = 1 To w_RecCnt

    '                    w_Date = IIf(IsDBNull(w_Date_F.Value), 0, w_Date_F.Value)

    '                    '日付が違ったら配列ｲﾝﾃﾞｯｸｽを１つ加算
    '                    If w_Date <> w_PreDate Then
    '                        '初期化
    '                        w_Index = UBound(m_StaffData(p_StaffIdx).Kojyo) + 1

    '                        w_DayIndex = 1
    '                        ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index)
    '                        '配列初期化
    '                        m_StaffData(p_StaffIdx).Kojyo(w_Index).init()
    '                    End If

    '                    '配列の拡張
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngKinmuDetailDate(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngNikkinTime(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).strShinryoKbn(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngTimeFrom(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngTimeTo(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngYakinTime(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngYokuYakinTime(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).strKinmuDetailCD(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).strNextFlg(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).lngKinmuDetailTime(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).strHolSubFlg(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).UniqueseqNo(w_DayIndex)
    '                    ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_Index).Seq(w_DayIndex)

    '                    '年月日
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngDate = w_Date
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngKinmuDetailDate(w_DayIndex) = IIf(IsDBNull(w_KinmuDetailDate_F.Value), "0", w_KinmuDetailDate_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngNikkinTime(w_DayIndex) = IIf(IsDBNull(w_NikkinTime_F.Value), "0", w_NikkinTime_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).strShinryoKbn(w_DayIndex) = IIf(IsDBNull(w_ShinryoKbn_F.Value), "0", w_ShinryoKbn_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngTimeFrom(w_DayIndex) = IIf(IsDBNull(w_TimeFrom_F.Value), "0", w_TimeFrom_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngTimeTo(w_DayIndex) = IIf(IsDBNull(w_TimeTo_F.Value), "0", w_TimeTo_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngYakinTime(w_DayIndex) = IIf(IsDBNull(w_YakinTime_F.Value), "0", w_YakinTime_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngYokuYakinTime(w_DayIndex) = IIf(IsDBNull(w_YokuYakinTime_F.Value), "0", w_YokuYakinTime_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).strKinmuDetailCD(w_DayIndex) = IIf(IsDBNull(w_KinmuDetailCD_F.Value), "", w_KinmuDetailCD_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).strNextFlg(w_DayIndex) = IIf(IsDBNull(w_NextFlg_F.Value), "", w_NextFlg_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).lngKinmuDetailTime(w_DayIndex) = IIf(IsDBNull(w_KinmuDetailTime_F.Value), "0", w_KinmuDetailTime_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).strHolSubFlg(w_DayIndex) = IIf(IsDBNull(w_HolSubFlg_F.Value), "", w_HolSubFlg_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).UniqueseqNo(w_DayIndex) = IIf(IsDBNull(w_UniqueseqNo_F.Value), "", w_UniqueseqNo_F.Value)
    '                    m_StaffData(p_StaffIdx).Kojyo(w_Index).Seq(w_DayIndex) = IIf(IsDBNull(w_Seq_F.Value), "0", w_Seq_F.Value)

    '                    w_DayIndex = w_DayIndex + 1

    '                    '日付退避
    '                    w_PreDate = w_Date

    '                    .MoveNext()
    '                Next w_Int
    '            End With
    '        End If

    '        w_Rs.Close()

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
    '        End
    '    End Try
    'End Sub

    '控除データ取得 取得
    Private Sub Get_KojyoData(ByVal p_FromDate As Integer, ByVal p_ToDate As Integer, ByVal p_StaffIdx As Integer)
        Const W_SUBNAME As String = "NSK0000HA Get_KojyoData"

        Dim w_DayCnt As Integer
        Dim w_DtlCnt As Integer
        Dim w_Min As Integer
        Try
            '控除データ格納配列の初期化
            ReDim m_StaffData(p_StaffIdx).Kojyo(0)

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p職員番号 = m_StaffData(p_StaffIdx).ID
                .p開始年月日 = p_FromDate
                .p終了年月日 = p_ToDate
                .p職員区分 = 0 '職員管理番号
                .p日付区分 = 1 '期間
                .p勤務詳細全日応援除外Flg = 1
                '保存呼出画面で適用ボタン押下時、連携された保存番号で表示を行う。
                If m_intSelSaveNo > 0 Then
                    '控除（一時保存）を取得
                    .p取得区分 = 1
                    .p計画番号 = m_PlanNo       '計画番号
                    .p保存番号 = m_intSelSaveNo '保存番号
                Else
                    '控除を取得
                    .p取得区分 = 0
                End If

                If .mGetKinmuDetail Then

                    w_DayCnt = 0
                    .p勤務詳細年月日 = p_FromDate

                    For i As Integer = 1 To .f勤務詳細期間日数

                        w_DtlCnt = .f勤務詳細日別件数
                        If w_DtlCnt > 0 Then
                            w_DayCnt = w_DayCnt + 1

                            '配列初期化
                            ReDim Preserve m_StaffData(p_StaffIdx).Kojyo(w_DayCnt)
                            m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).init(w_DtlCnt)

                            For j As Integer = 1 To w_DtlCnt
                                .p勤務詳細日別索引 = j

                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).Seq(j) = j - 1
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngDate = .f勤務詳細年月日
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngKinmuDetailDate(j) = .f勤務詳細勤務年月日
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).strKinmuDetailCD(j) = .f勤務詳細CD
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngKinmuDetailTime(j) = .f控除時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngTimeFrom(j) = .f勤務詳細開始時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).OuenKinmuDeptCD(j) = .f勤務詳細応援勤務部署CD
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngTimeTo(j) = .f勤務詳細終了時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).strNextFlg(j) = .f勤務詳細翌日FLG
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).strShinryoKbn(j) = .f勤務詳細診療報酬計算KBN
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).strHolSubFlg(j) = .f休憩減算フラグ2
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).UniqueseqNo(j) = .f勤務詳細UNIQUESEQNO

                                w_Min = .f勤務詳細日勤時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngNikkinTime(j) = (w_Min \ 60) * 100 + (w_Min Mod 60)

                                w_Min = .f勤務詳細夜勤時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngYakinTime(j) = (w_Min \ 60) * 100 + (w_Min Mod 60)

                                w_Min = .f勤務詳細翌日夜勤時間
                                m_StaffData(p_StaffIdx).Kojyo(w_DayCnt).lngYokuYakinTime(j) = (w_Min \ 60) * 100 + (w_Min Mod 60)
                            Next j
                        End If
                        Call .m翌日勤務詳細
                    Next i
                End If
            End With
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2018/03/07 Yamanishi Upd End -----------------------------------------------------------------------------------------------

    '控除更新
    Private Function UpDate_Kojyo() As Boolean

        Const W_SUBNAME As String = "NSK0000HA UpDate_Kojyo"

        Dim sb As New System.Text.StringBuilder
        Dim w_Index As Integer
        Dim w_DateIdx As Integer
        Dim w_SEQIdx As Integer
        Dim w_StaffID As String '職員管理番号
        Dim w_Date As Integer '日付
        Dim w_SysDate As String
        Dim w_EndDate As Integer
        Dim w_StartDate As Integer

        UpDate_Kojyo = True
        Try
            '更新日時 取得
            w_SysDate = General.paGetDateString(Now, True)

            '計画開始日取得
            w_StartDate = m_KeikakuKikan.StartDate
            '計画終了日取得
            w_EndDate = m_KeikakuKikan.EndDate

            For w_Index = 1 To UBound(m_StaffData)
                If m_StaffData(w_Index).OuenStaffFlg = 0 Then '2018/01/18 Yamanishi Add
                    '職員管理番号
                    w_StaffID = m_StaffData(w_Index).ID

                    '計画期間内の控除ﾃﾞｰﾀをすべて削除する
                    'Delete文 編集
                    sb.Length = 0
                    sb.AppendLine("DELETE FROM NS_KINMUDETAIL_F ")
                    sb.AppendLine("WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'")
                    sb.AppendLine(" AND STAFFMNGID = '" & w_StaffID & "'")
                    sb.AppendLine(" AND DATEF >= " & w_StartDate)
                    sb.AppendLine(" AND DATEF <= " & w_EndDate)
                    '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------
                    sb.AppendLine(" AND (GETCONTENTSKBN IS NULL")
                    sb.AppendLine("  OR  GETCONTENTSKBN <> '" & General.G_GetContentsKbn_Full & "')")
                    '----------------------------------------------------------------------------------------------------
                    Call General.paDBExecute(sb.ToString)

                    For w_DateIdx = 1 To UBound(m_StaffData(w_Index).Kojyo)
                        '日付
                        w_Date = m_StaffData(w_Index).Kojyo(w_DateIdx).lngDate

                        '計画期間内の部分
                        '取得期間を変更したため計画期間を厳密に判定する
                        If w_EndDate >= w_Date AndAlso w_Date >= w_StartDate Then
                            For w_SEQIdx = 1 To UBound(m_StaffData(w_Index).Kojyo(w_DateIdx).lngKinmuDetailDate)

                                sb.Length = 0
                                sb.AppendLine("INSERT INTO NS_KINMUDETAIL_F(")
                                sb.AppendLine("  HOSPITALCD")
                                sb.AppendLine(" ,STAFFMNGID")
                                sb.AppendLine(" ,DATEF")
                                sb.AppendLine(" ,SEQ")
                                sb.AppendLine(" ,KINMUDETAILDATE")
                                sb.AppendLine(" ,FROMTIME")
                                '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------
                                sb.AppendLine(" ,GETCONTENTSKBN")
                                sb.AppendLine(" ,OUENKINMUDEPTCD")
                                '----------------------------------------------------------------------------------------------------
                                sb.AppendLine(" ,TOTIME")
                                sb.AppendLine(" ,NEXTDAYFLG")
                                sb.AppendLine(" ,KINMUDETAILTIME")
                                sb.AppendLine(" ,HOLSUBFLG")
                                sb.AppendLine(" ,KINMUDETAILCD")
                                sb.AppendLine(" ,REZEPTCALCKBN")
                                sb.AppendLine(" ,DAYTIME")
                                sb.AppendLine(" ,NIGHTTIME")
                                sb.AppendLine(" ,NEXTNIGHTTIME")
                                sb.AppendLine(" ,UNIQUESEQNO")
                                sb.AppendLine(" ,REGISTFIRSTTIMEDATE")
                                sb.AppendLine(" ,LASTUPDTIMEDATE")
                                sb.AppendLine(" ,REGISTRANTID")
                                sb.AppendLine(") VALUES (")
                                sb.AppendLine(" '" & General.g_strHospitalCD & "'")
                                sb.AppendLine(",'" & w_StaffID & "'")
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngDate)
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).Seq(w_SEQIdx))
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngKinmuDetailDate(w_SEQIdx))
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngTimeFrom(w_SEQIdx))
                                '2018/02/23 Yamanishi Add ---------------------------------------------------------------------------
                                sb.AppendLine(",'" & General.G_GetContentsKbn_Time & "'")
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).OuenKinmuDeptCD(w_SEQIdx) & "'")
                                '----------------------------------------------------------------------------------------------------
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngTimeTo(w_SEQIdx))
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).strNextFlg(w_SEQIdx) & "'")
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngKinmuDetailTime(w_SEQIdx))
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).strHolSubFlg(w_SEQIdx) & "'")
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).strKinmuDetailCD(w_SEQIdx) & "'")
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).strShinryoKbn(w_SEQIdx) & "'")
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngNikkinTime(w_SEQIdx))
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngYakinTime(w_SEQIdx))
                                sb.AppendLine("," & m_StaffData(w_Index).Kojyo(w_DateIdx).lngYokuYakinTime(w_SEQIdx))
                                sb.AppendLine(",'" & m_StaffData(w_Index).Kojyo(w_DateIdx).UniqueseqNo(w_SEQIdx) & "'")
                                sb.AppendLine("," & w_SysDate)
                                sb.AppendLine("," & w_SysDate)
                                sb.AppendLine(",'" & General.g_strUserID & "'")
                                sb.AppendLine(")")

                                Call General.paDBExecute(sb.ToString)
                            Next w_SEQIdx
                        End If
                    Next w_DateIdx
                End If '2018/01/18 Yamanishi Add
            Next w_Index

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '控除全消去
    Private Sub KojyoDeleteAllData()

        Const W_SUBNAME As String = "Nskk001 KojyoDeleteAllData"

        Dim w_Col As Integer
        Dim w_Row As Integer
        Dim w_Var As Object
        Dim w_CurrentDate As Integer
        Dim w_KikanStartCol As Integer
        Dim w_StaffIdx As Integer
        Dim w_strKojyoData As String
        Dim w_lngKojyoLoop As Integer
        Try
            If m_SelViewKikan = 0 Then
                '1ｹ月画面表示中の場合

                With sprSheet_M.Sheets(0)

                    'ｾﾙﾌﾞﾛｯｸの選択を解除
                    .ClearSelection()

                    '選択範囲設定（他病棟の勤務、実績データは選択しない）
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow

                        '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                        w_StaffIdx = -1
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                        If IsNumeric(w_Var) = True Then
                            'ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = Integer.Parse(w_Var)
                        End If

                        For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                            '配属期間内か ?
                            If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) Then
                                '配属期間外のとき
                            Else

                                '控除データを削除
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                End If
                                If IsNumeric(w_Var) = True Then
                                    w_strKojyoData = ""
                                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                            '配列初期化
                                            m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                            Exit For
                                        End If
                                    Next
                                End If
                            End If
                        Next w_Col
                    Next w_Row
                End With
            Else
                '4週期間表示のとき

                With sprSheet_4W.Sheets(0)

                    'ｾﾙﾌﾞﾛｯｸの選択を解除
                    .ClearSelection()

                    If m_4WeekKikan(m_SelViewKikan).StartDate <= m_KeikakuKikan.StartDate Then
                        '勤務ﾃﾞｰﾀ開始列格納
                        If Get_Col_4W(m_KeikakuKikan.StartDate, w_KikanStartCol) = False Then
                            w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                        End If
                    Else
                        '勤務ﾃﾞｰﾀ開始列格納
                        w_KikanStartCol = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol
                    End If

                    '選択範囲設定（他病棟の勤務、実績データは選択しない）
                    For w_Row = m_ViewRow.StartRow To m_ViewRow.EndRow

                        '職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                        w_StaffIdx = -1
                        w_Var = .GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                        If IsNumeric(w_Var) = True Then
                            'ｲﾝﾃﾞｯｸｽ取得
                            w_StaffIdx = Integer.Parse(w_Var)
                        End If

                        For w_Col = w_KikanStartCol To m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol

                            '配属期間内か ?
                            If (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_MonthBefore_Back) OrElse (ColorTranslator.ToOle(.Cells(w_Row, w_Col).BackColor) = m_Jisseki4W_Back) Then
                                '配属期間外または、計画期間外確定データのとき
                            Else

                                '控除データを削除
                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_Col)
                                If w_Var <> "" Then
                                    w_CurrentDate = Integer.Parse(w_Var)
                                End If
                                If IsNumeric(w_Var) = True Then
                                    w_strKojyoData = ""
                                    For w_lngKojyoLoop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                        If m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).lngDate = w_CurrentDate Then
                                            '配列初期化
                                            m_StaffData(w_StaffIdx).Kojyo(w_lngKojyoLoop).init()

                                            Exit For
                                        End If
                                    Next
                                End If
                            End If
                        Next w_Col
                    Next w_Row
                End With
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2016/08/30 Yamanishi Upd Start ------------------------------------------------------------------
    ''2016/04/21 Yamanishi Upd ------------------------------------------------------------------
    ''Private Function fncGetBeforeNextNightTime(ByVal p_StaffIdx As Integer, ByVal p_KinmuCD As String, ByVal p_Date As Integer) As Integer
    'Private Function fncGetBeforeNextNightTime(ByVal p_StaffIdx As Integer, ByVal p_KinmuCD As String, _
    '                                           ByVal p_Date As Integer, ByRef p_BeforeNextTotalNightTime As Integer) As Integer
    '    '---------------------------------------------------------------------------------------

    '    Const W_SUBNAME As String = "NSK0000HA fncGetBeforeNextNightTime"

    '    Dim w_Int As Integer
    '    Dim w_SaiyoCD As String = String.Empty
    '    Dim w_SaiyoCnt As Integer
    '    Dim w_RecCnt As Integer
    '    Dim w_TimeM() As Saiyo_Type

    '    fncGetBeforeNextNightTime = 0
    '    p_BeforeNextTotalNightTime = 0 '2016/04/21 Yamanishi Add
    '    Try
    '        For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).SaiyoData)
    '            If m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoDate <= p_Date AndAlso m_StaffData(p_StaffIdx).SaiyoData(w_Int).TentaiDate >= p_Date Then

    '                w_SaiyoCD = m_StaffData(p_StaffIdx).SaiyoData(w_Int).SaiyoCD
    '                Exit For
    '            End If
    '        Next w_Int

    '        ReDim w_TimeM(0)

    '        '配列確保
    '        w_SaiyoCnt = UBound(w_TimeM) + 1
    '        ReDim Preserve w_TimeM(w_SaiyoCnt)
    '        w_TimeM(w_SaiyoCnt).SaiyoCD = w_SaiyoCD

    '        General.g_objGetData.p病院CD = General.g_strHospitalCD
    '        General.g_objGetData.p採用条件CD = w_SaiyoCD
    '        General.g_objGetData.p看護単位CD = General.g_strSelKinmuDeptCD
    '        General.g_objGetData.p勤務CD = p_KinmuCD
    '        If General.g_objGetData.mGetKinmuTime = False Then
    '        Else
    '            w_RecCnt = General.g_objGetData.f勤務時間件数

    '            For w_Int = 1 To w_RecCnt
    '                General.g_objGetData.p勤務時間索引 = w_Int

    '                fncGetBeforeNextNightTime = General.g_objGetData.f翌日夜勤時間
    '                p_BeforeNextTotalNightTime = General.g_objGetData.f翌夜勤総時間 '2016/04/21 Yamanishi Add
    '            Next w_Int
    '        End If

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
    '        End
    '    End Try
    'End Function
    Private Function fncGetBeforeNextNightTime(ByVal p_StaffIdx As Integer, ByVal p_Date As Integer, ByVal p_Row As Integer,
                                               ByRef p_BeforeNextTotalNightTime As Integer) As Integer
        Const W_SUBNAME As String = "NSK0000HA fncGetBeforeNextNightTime"
        Dim w_Int As Integer
        Dim w_Int2 As Integer
        Dim w_strTime As String
        Dim w_Time As String
        Dim w_iHHmm As Integer
        Dim w_iMin As Integer
        Dim w_LastDayFlg As Boolean
        Dim w_TimeOuenFlg As Boolean
        Dim w_PreKinmuCD As String
        Dim w_PreKinmuDeptCD As String
        Dim w_PreOuenDeptCD As String
        Dim w_NextNenkyuTime As Integer
        Dim w_NextOuenTime As Integer
        Dim w_NextKojyoTime As Integer
        Dim w_NextKojyoTimeNotCalcTotal As Integer
        Try
            fncGetBeforeNextNightTime = 0
            p_BeforeNextTotalNightTime = 0

            w_LastDayFlg = False
            w_PreKinmuDeptCD = ""
            For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).IdoHistory)
                If m_StaffData(p_StaffIdx).IdoHistory(w_Int).IdoYMD <= p_Date AndAlso p_Date <= m_StaffData(p_StaffIdx).IdoHistory(w_Int).SyuryoYMD Then
                    w_PreKinmuDeptCD = m_StaffData(p_StaffIdx).IdoHistory(w_Int).CD
                    w_LastDayFlg = (p_Date = m_StaffData(p_StaffIdx).IdoHistory(w_Int).SyuryoYMD)
                    Exit For
                End If
            Next w_Int
            If Not w_LastDayFlg Then '最終日でない場合のみ取得
                w_PreKinmuCD = ""
                w_Time = ""
                w_PreOuenDeptCD = ""
                Call Get_PreKinmuCD(w_PreKinmuCD, p_Date, p_StaffIdx, p_Row, w_Time, w_PreOuenDeptCD)

                '翌日夜勤時間から時間年休を減算する
                w_strTime = w_Time
                w_NextNenkyuTime = 0
                While w_strTime <> ""
                    '2018/03/08 Yamanishi Upd -----------------------------------------------------------------------------
                    'w_Time = General.paLeft(w_strTime, 28)
                    'w_strTime = Mid(w_strTime, 29)
                    ''翌日夜勤時間
                    'w_iHHmm = Integer.Parse(Mid(w_Time, 25, 4))
                    'w_NextNenkyuTime = w_NextNenkyuTime + (w_iHHmm \ 100) * 60 + (w_iHHmm Mod 100)

                    w_strTime = Get_NenkyuTime(w_strTime, 0, 0, w_iHHmm)

                    '翌日夜勤時間
                    w_NextNenkyuTime = w_NextNenkyuTime + HHmmToMin(w_iHHmm)
                    '------------------------------------------------------------------------------------------------------
                End While

                '控除時間を考慮する
                w_TimeOuenFlg = False
                w_NextOuenTime = 0
                w_NextKojyoTime = 0
                w_NextKojyoTimeNotCalcTotal = 0
                For w_Int = 1 To UBound(m_StaffData(p_StaffIdx).Kojyo)
                    If p_Date = m_StaffData(p_StaffIdx).Kojyo(w_Int).lngDate Then
                        '翌日夜勤時間を合計
                        For w_Int2 = 1 To UBound(m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime)
                            '翌日夜勤時間
                            w_iHHmm = m_StaffData(p_StaffIdx).Kojyo(w_Int).lngYokuYakinTime(w_Int2)
                            w_iMin = (w_iHHmm \ 100) * 60 + (w_iHHmm Mod 100)
                            If InStr(m_strOuenKojyoCD, General.paFormatSpace(m_StaffData(p_StaffIdx).Kojyo(w_Int).strKinmuDetailCD(w_Int2), 10)) Then
                                '2018/03/01 Yamanishi Upd -------------------------------------------------------------------------------
                                'w_TimeOuenFlg = True
                                'w_NextOuenTime = w_NextOuenTime + w_iMin

                                If m_StaffData(p_StaffIdx).Kojyo(w_Int).OuenKinmuDeptCD(w_Int2) = General.g_strSelKinmuDeptCD OrElse Not General.g_UseMultiOuenFlg Then
                                    w_TimeOuenFlg = True
                                    w_NextOuenTime = w_NextOuenTime + w_iMin
                                Else
                                    w_NextKojyoTimeNotCalcTotal = w_NextKojyoTimeNotCalcTotal + w_iMin
                                End If
                                '--------------------------------------------------------------------------------------------------------
                            ElseIf InStr(m_NotCalcTotalNightKojyoCD, General.paFormatSpace(m_StaffData(p_StaffIdx).Kojyo(w_Int).strKinmuDetailCD(w_Int2), 10)) Then
                                w_NextKojyoTimeNotCalcTotal = w_NextKojyoTimeNotCalcTotal + w_iMin
                            Else
                                w_NextKojyoTime = w_NextKojyoTime + w_iMin
                            End If
                        Next w_Int2
                    End If
                Next w_Int

                '翌日夜勤時間の計算
                If w_PreKinmuDeptCD = General.g_strSelKinmuDeptCD Then
                    '表示部署勤務の場合
                    If w_PreOuenDeptCD <> "" AndAlso w_PreOuenDeptCD <> General.g_strSelKinmuDeptCD AndAlso Not w_TimeOuenFlg Then
                        '他部署へ全日応援している場合
                        fncGetBeforeNextNightTime = 0
                    Else
                        fncGetBeforeNextNightTime = GetKinmuTime(w_PreKinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                        w_iMin = w_NextNenkyuTime + w_NextOuenTime + w_NextKojyoTime + w_NextKojyoTimeNotCalcTotal
                        If fncGetBeforeNextNightTime < w_iMin Then
                            fncGetBeforeNextNightTime = 0
                        Else
                            fncGetBeforeNextNightTime = fncGetBeforeNextNightTime - w_iMin
                        End If
                    End If
                ElseIf w_PreOuenDeptCD = General.g_strSelKinmuDeptCD Then
                    If w_TimeOuenFlg Then
                        '他部署から時間応援で表示部署に来ている場合
                        fncGetBeforeNextNightTime = w_NextOuenTime
                    Else
                        '他部署から全日応援で表示部署に来ている場合
                        fncGetBeforeNextNightTime = GetKinmuTime(w_PreKinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextNightTime)
                    End If
                    '2018/03/01 Yamanishi Add -------------------------------------------------------------------------------
                ElseIf General.g_UseMultiOuenFlg AndAlso w_TimeOuenFlg Then
                    '他部署から時間応援で表示部署に来ている場合
                    fncGetBeforeNextNightTime = w_NextOuenTime
                    '--------------------------------------------------------------------------------------------------------
                Else
                    fncGetBeforeNextNightTime = 0
                End If

                '翌日夜勤総時間の計算
                If w_PreKinmuDeptCD = General.g_strSelKinmuDeptCD OrElse w_PreOuenDeptCD = General.g_strSelKinmuDeptCD OrElse m_OuenTotalNightFullFlg = 1 Then
                    p_BeforeNextTotalNightTime = GetKinmuTime(w_PreKinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.NextTotalNightTime)
                    w_iMin = w_NextNenkyuTime + w_NextKojyoTime
                    If p_BeforeNextTotalNightTime < w_iMin Then
                        p_BeforeNextTotalNightTime = 0
                    Else
                        p_BeforeNextTotalNightTime = p_BeforeNextTotalNightTime - w_iMin
                    End If
                Else
                    p_BeforeNextTotalNightTime = 0
                End If
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function
    '2016/08/30 Yamanishi Upd End --------------------------------------------------------------------
    '曜日制限チェック
    Private Function Check_YoubiLimit(ByVal p_Date As Object, ByVal p_KinmuCD As String) As Boolean

        Const W_SUBNAME As String = "NSK0000HA Check_YoubiLimit"

        Dim w_intLoop1 As Integer
        Dim w_intLoop2 As Integer
        Dim w_chkValue As String = String.Empty
        Dim w_strYoubi As String = String.Empty
        Dim w_strMsg() As String

        Check_YoubiLimit = False
        Try
            '曜日を取得
            If InStr(m_HolDateStr, p_Date) > 0 Then
                If InStr(m_OffDayStr, p_Date) > 0 Then
                    w_chkValue = "8"
                    w_strYoubi = "休日"
                Else
                    w_chkValue = "7"
                    w_strYoubi = "祝日"
                End If

                '曜日制限チェック
                For w_intLoop1 = 1 To UBound(g_KinmuM)
                    If g_KinmuM(w_intLoop1).CD = p_KinmuCD Then
                        For w_intLoop2 = 1 To UBound(g_KinmuM(w_intLoop1).YoubiLimit)
                            If w_chkValue = g_KinmuM(w_intLoop1).YoubiLimit(w_intLoop2) Then
                                '制限対象の場合、処理抜け
                                ReDim w_strMsg(2)
                                w_strMsg(1) = w_strYoubi
                                w_strMsg(2) = g_KinmuM(w_intLoop1).KinmuName
                                Call General.paMsgDsp("NS0011", w_strMsg)
                                Exit Function
                            End If
                        Next w_intLoop2
                        Exit For
                    End If
                Next w_intLoop1
            Else
                Select Case Weekday(Date.Parse(Format(Integer.Parse(p_Date), "0000/00/00")))
                    Case FirstDayOfWeek.Monday
                        w_chkValue = "0"
                        w_strYoubi = "月曜日"
                    Case FirstDayOfWeek.Tuesday
                        w_chkValue = "1"
                        w_strYoubi = "火曜日"
                    Case FirstDayOfWeek.Wednesday
                        w_chkValue = "2"
                        w_strYoubi = "水曜日"
                    Case FirstDayOfWeek.Thursday
                        w_chkValue = "3"
                        w_strYoubi = "木曜日"
                    Case FirstDayOfWeek.Friday
                        w_chkValue = "4"
                        w_strYoubi = "金曜日"
                    Case FirstDayOfWeek.Saturday
                        w_chkValue = "5"
                        w_strYoubi = "土曜日"
                    Case FirstDayOfWeek.Sunday
                        w_chkValue = "6"
                        w_strYoubi = "日曜日"
                End Select

                '曜日制限チェック
                For w_intLoop1 = 1 To UBound(g_KinmuM)
                    If g_KinmuM(w_intLoop1).CD = p_KinmuCD Then
                        For w_intLoop2 = 1 To UBound(g_KinmuM(w_intLoop1).YoubiLimit)
                            If w_chkValue = g_KinmuM(w_intLoop1).YoubiLimit(w_intLoop2) Then
                                '制限対象の場合、処理抜け
                                ReDim w_strMsg(2)
                                w_strMsg(1) = w_strYoubi
                                w_strMsg(2) = g_KinmuM(w_intLoop1).KinmuName
                                Call General.paMsgDsp("NS0011", w_strMsg)
                                Exit Function
                            End If
                        Next w_intLoop2
                        Exit For
                    End If
                Next w_intLoop1
            End If

            Check_YoubiLimit = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '経験区分の組み合わせチェック
    Private Sub Check_GiryoType(ByVal p_DayCount As Integer)

        Const W_SUBNAME As String = "NSK0000HA Check_GiryoType"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_lngStaffCount As Integer
        Dim w_lngCheckCount As Integer
        Dim w_lngSeqCount As Integer
        Dim w_lngGiryouNinzu_1 As Integer
        Dim w_lngGiryouNinzu_2 As Integer
        Dim w_lngGiryouNinzu_3 As Integer
        Dim w_lngGiryouNinzu_4 As Integer
        Dim w_lngTargetDate As Integer
        Dim w_bolErrFlg As Boolean
        Dim w_Col4W As Integer
        Dim w_KinmuCD As String
        Dim w_str As String = String.Empty
        Dim w_Count As Integer
        Dim w_Flg As Integer
        Dim w_MaxCount As Integer
        Dim w_lngLoop As Integer
        Dim w_lngDataCnt As Integer
        Dim w_Loop As Integer
        Dim w_KinmuViewflg As Integer
        Dim w_objSpread As FpSpread     '--- 20110223 isida add ---

        Try
            '与えられた列番号が計画期間列以降か
            If p_DayCount < m_KeikakuKikan.KinmuDataStartCol AndAlso m_KeikakuKikan.KinmuDataEndCol < p_DayCount Then
                '計画期間外なので計算しない
                Exit Sub
            End If

            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, p_DayCount)
            If w_Var = "" Then
                '日付が取得できないので処理抜け出し
                Exit Sub
            End If

            w_lngTargetDate = w_Var
            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                '日付として判断できないので処理抜け出し
                Exit Sub
            End If

            '4週用列番号取得
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(w_Var, w_Col4W) = False Then
                    Exit Sub
                End If
            End If

            For w_Loop = 0 To 3
                If m_lstmnuKinmuView(w_Loop).Available = True Then
                    If m_lstmnuKinmuView(w_Loop).Checked = True Then
                        w_KinmuViewflg = w_Loop + 1
                        Exit For
                    End If
                End If
            Next w_Loop

            'チェック対象の勤務コードごとにループ
            For w_lngCheckCount = 1 To UBound(m_GiryoCheck)
                '勤務コードのSeqごとにループ
                For w_lngSeqCount = 1 To UBound(m_GiryoCheck(w_lngCheckCount).Giryo)

                    w_bolErrFlg = False
                    w_lngGiryouNinzu_1 = 0
                    w_lngGiryouNinzu_2 = 0
                    w_lngGiryouNinzu_3 = 0
                    w_lngGiryouNinzu_4 = 0
                    w_Count = 0
                    w_Flg = 1
                    w_lngLoop = 0
                    ReDim m_ErrStaffData(0)

                    w_MaxCount = (m_StaffRow.EndRow - m_StaffRow.StartRow) / UBound(m_StaffData)
                    '職員ごとにループ
                    For w_lngStaffCount = m_StaffRow.StartRow To m_StaffRow.EndRow
                        '--- 20110223 isida chg st ---
                        'w_Count = w_Count + 1
                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week And m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週/1ヶ月
                            w_objSpread = sprSheet_4W

                            '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_Var = w_objSpread.Sheets(0).GetText(w_lngStaffCount, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                            If w_Var <> "" Then
                                If IsNumeric(w_Var) = True Then
                                    w_Count = CInt(w_Var)
                                Else
                                    '職員情報が取得できないので処理抜け出し
                                    w_objSpread = Nothing
                                    Exit Sub
                                End If
                            Else
                                '職員情報が取得できないので処理抜け出し
                                w_objSpread = Nothing
                                Exit Sub
                            End If
                        Else
                            '4週/1ヶ月
                            w_objSpread = sprSheet_M

                            '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                            w_Var = w_objSpread.Sheets(0).GetText(w_lngStaffCount, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            If w_Var <> "" Then
                                If IsNumeric(w_Var) = True Then
                                    w_Count = CInt(w_Var)
                                Else
                                    '職員情報が取得できないので処理抜け出し
                                    w_objSpread = Nothing
                                    Exit Sub
                                End If
                            Else
                                '職員情報が取得できないので処理抜け出し
                                w_objSpread = Nothing
                                Exit Sub
                            End If
                        End If
                        '--- 20110223 isida chg ed ---

                        w_KinmuCD = ""

                        '一段表示の場合か新規計画は一段だけを見る
                        If w_KinmuViewflg = 1 OrElse m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                            w_Var = sprSheet_M.Sheets(0).GetText(w_lngStaffCount, p_DayCount)
                            If w_Var <> "" Then
                                '2015/04/10 Bando Upd Start =========================================
                                'Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str)
                                Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str, "")
                                '2015/04/10 Bando Upd End   =========================================
                            End If
                        Else
                            '二段目の勤務があるかどうかチェック
                            w_Var2 = sprSheet_M.Sheets(0).GetText(w_lngStaffCount + 1, p_DayCount)
                            If w_Var2 <> "" Then
                                '二段目の勤務がある場合は二段目の勤務を取得
                                '2015/04/10 Bando Upd Start =========================================
                                'Call Get_KinmuMark(w_Var2, w_KinmuCD, w_str, w_str, w_str, w_str)
                                Call Get_KinmuMark(w_Var2, w_KinmuCD, w_str, w_str, w_str, w_str, "")
                                '2015/04/10 Bando Upd End   =========================================
                            Else
                                '一段目の勤務があるかどうかチェック
                                w_Var = sprSheet_M.Sheets(0).GetText(w_lngStaffCount, p_DayCount)
                                If w_Var <> "" Then
                                    '一段目の勤務がない場合は一段目の勤務を取得
                                    '2015/04/10 Bando Upd End   =========================================
                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str)
                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str, "")
                                    '2015/04/10 Bando Upd End   =========================================
                                End If
                            End If
                        End If

                        '対象のスプレッドに値が入っているか
                        If w_KinmuCD <> "" Then

                            '取得した勤務コードが経験区分の組み合わせ対象の勤務コードの場合
                            If w_KinmuCD = m_GiryoCheck(w_lngCheckCount).KinmuCD Then

                                w_lngLoop = w_lngLoop + 1
                                ReDim Preserve m_ErrStaffData(w_lngLoop)
                                m_ErrStaffData(w_lngLoop).StaffName = m_StaffData(w_Count).StaffName
                                m_ErrStaffData(w_lngLoop).Row = w_lngStaffCount

                                '経験区分ごとに人数を加算
                                Select Case m_StaffData(w_Count).GiryoBunruiCD
                                    Case M_SKILLBUNRUICD_1 'リーダー
                                        w_lngGiryouNinzu_1 = w_lngGiryouNinzu_1 + 1
                                        If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu1 = w_lngGiryouNinzu_1 Then
                                            If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu2 = w_lngGiryouNinzu_2 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu3 = w_lngGiryouNinzu_3 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu4 = w_lngGiryouNinzu_4 Then
                                                w_bolErrFlg = True
                                            End If
                                        ElseIf m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu1 < w_lngGiryouNinzu_1 Then
                                            '経験区分の組み合わせの人数以上なので処理を終了
                                            w_bolErrFlg = False
                                            Exit For
                                        End If

                                    Case M_SKILLBUNRUICD_2 'サブリーダー
                                        w_lngGiryouNinzu_2 = w_lngGiryouNinzu_2 + 1
                                        If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu2 = w_lngGiryouNinzu_2 Then
                                            If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu1 = w_lngGiryouNinzu_1 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu3 = w_lngGiryouNinzu_3 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu4 = w_lngGiryouNinzu_4 Then
                                                w_bolErrFlg = True
                                            End If
                                        ElseIf m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu2 < w_lngGiryouNinzu_2 Then
                                            '経験区分の組み合わせの人数以上なので処理を終了
                                            w_bolErrFlg = False
                                            Exit For
                                        End If

                                    Case M_SKILLBUNRUICD_3 'スタッフ
                                        w_lngGiryouNinzu_3 = w_lngGiryouNinzu_3 + 1
                                        If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu3 = w_lngGiryouNinzu_3 Then
                                            If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu1 = w_lngGiryouNinzu_1 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu2 = w_lngGiryouNinzu_2 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu4 = w_lngGiryouNinzu_4 Then
                                                w_bolErrFlg = True
                                            End If
                                        ElseIf m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu3 < w_lngGiryouNinzu_3 Then
                                            '経験区分の組み合わせの人数以上なので処理を終了
                                            w_bolErrFlg = False
                                            Exit For
                                        End If

                                    Case M_SKILLBUNRUICD_4 '新人
                                        w_lngGiryouNinzu_4 = w_lngGiryouNinzu_4 + 1
                                        If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu4 = w_lngGiryouNinzu_4 Then
                                            If m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu1 = w_lngGiryouNinzu_1 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu2 = w_lngGiryouNinzu_2 AndAlso m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu3 = w_lngGiryouNinzu_3 Then
                                                w_bolErrFlg = True
                                            End If
                                        ElseIf m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).GiryoNinzu4 < w_lngGiryouNinzu_4 Then
                                            '経験区分の組み合わせの人数以上なので処理を終了
                                            w_bolErrFlg = False
                                            Exit For
                                        End If
                                        '上記経験区分に設定されていない職員
                                    Case Else
                                        w_bolErrFlg = False
                                        Exit For
                                End Select
                            End If
                        End If
                        w_lngStaffCount = w_lngStaffCount + (w_MaxCount - 1)
                    Next w_lngStaffCount

                    'エラーを格納
                    If w_bolErrFlg = True Then

                        For w_lngLoop = 1 To UBound(m_ErrStaffData)
                            '配列確保
                            w_lngDataCnt = UBound(g_NotGiryoCheckError) + 1
                            ReDim Preserve g_NotGiryoCheckError(w_lngDataCnt)
                            g_NotGiryoCheckError(w_lngDataCnt).StaffName = m_ErrStaffData(w_lngLoop).StaffName
                            g_NotGiryoCheckError(w_lngDataCnt).StaffIdx = m_ErrStaffData(w_lngLoop).Row

                            '配列確保
                            ReDim Preserve g_NotGiryoCheckError(w_lngDataCnt).Data(1)
                            g_NotGiryoCheckError(w_lngDataCnt).Data(1).ErrorFlg = True
                            g_NotGiryoCheckError(w_lngDataCnt).Data(1).ErrorDate = w_lngTargetDate
                            g_NotGiryoCheckError(w_lngDataCnt).Data(1).ErrorPattern = m_GiryoCheck(w_lngCheckCount).Giryo(w_lngSeqCount).Mark & "　" & "パターン" & w_lngSeqCount
                            '対象列番号
                            If m_SelViewKikan = 0 Then
                                g_NotGiryoCheckError(w_lngDataCnt).Data(1).ColIdx = p_DayCount
                            Else
                                '４週画面の場合
                                g_NotGiryoCheckError(w_lngDataCnt).Data(1).ColIdx = w_Col4W
                            End If
                        Next w_lngLoop
                    End If
                Next w_lngSeqCount
            Next w_lngCheckCount
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '禁止職員パターンのエラーチェック
    '   与えられた列番号のチェックを行う
    '   注意：この列番号は1ヶ月用ｽﾌﾟﾚｯﾄﾞの列番号のみとします
    '   　　　４週用のｽﾌﾟﾚｯﾄﾞからこの関数を呼ぶ場合は、
    '   　　　１ヶ月用の列番号を取得後使用してください
    Private Sub Check_DayNotSetStaffPattern(ByVal pCol As Integer)
        Const W_SUBNAME As String = "NSK0000HA Check_DayNotSetStaffPattern"

        Dim w_Var As Object
        Dim w_Col4W As Integer
        Dim w_Row As Integer
        Dim w_lngLoop As Integer
        Dim w_lngLoop2 As Integer
        Dim w_lngLoop3 As Integer
        Dim w_lngLoop4 As Integer
        Dim w_lngLoop5 As Integer
        Dim w_lngDataCnt As Integer
        Dim w_lngTargetDate As Integer
        Dim w_KinmuCD As String = String.Empty
        Dim w_str As String = String.Empty
        Dim w_HitFlg As Boolean
        Dim w_ErrFlg As Boolean
        Try
            '与えられた列番号が計画期間列以降か
            If pCol < m_KeikakuKikan.KinmuDataStartCol AndAlso m_KeikakuKikan.KinmuDataEndCol < pCol Then
                '計画期間外なので計算しない
                Exit Sub
            End If

            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, pCol)
            If w_Var = "" Then
                '日付が取得できないので処理抜け出し
                Exit Sub
            End If

            w_lngTargetDate = w_Var
            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                '日付として判断できないので処理抜け出し
                Exit Sub
            End If

            '4週用列番号取得
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(w_Var, w_Col4W) = False Then
                    Exit Sub
                End If
            End If

            '初期化
            For w_lngLoop = 1 To UBound(m_AllocKinmuData)
                ReDim m_AllocKinmuData(w_lngLoop).StaffInfo(0)
            Next w_lngLoop

            '集計項目数Loop
            For w_Row = m_StaffRow.StartRow To m_StaffRow.EndRow
                w_Var = sprSheet_M.Sheets(0).GetText(w_Row, pCol)
                If w_Var <> "" Then
                    '2015/04/10 Bando Upd Start =========================================
                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str)
                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_str, w_str, w_str, w_str, "")
                    '2015/04/10 Bando Upd End   =========================================
                    '割当対象勤務か判断
                    For w_lngLoop = 1 To UBound(m_AllocKinmuData)
                        If w_KinmuCD = m_AllocKinmuData(w_lngLoop).KinmuCD Then
                            w_lngDataCnt = UBound(m_AllocKinmuData(w_lngLoop).StaffInfo) + 1
                            '配列確保
                            ReDim Preserve m_AllocKinmuData(w_lngLoop).StaffInfo(w_lngDataCnt)

                            '職員管理番号取得
                            w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_StaffID).SetCol_M)
                            m_AllocKinmuData(w_lngLoop).StaffInfo(w_lngDataCnt).StaffMngID = w_Var

                            '職員氏名取得
                            w_Var = sprSheet_M.Sheets(0).GetText(w_Row, m_StaffZokusei(M_HairetuNo).SetCol_M)
                            m_AllocKinmuData(w_lngLoop).StaffInfo(w_lngDataCnt).StaffName = m_StaffData(w_Var).StaffName
                            m_AllocKinmuData(w_lngLoop).StaffInfo(w_lngDataCnt).StaffRow = Convert.ToString(w_Row)

                            Exit For
                        End If
                    Next w_lngLoop
                End If
            Next w_Row

            'ｴﾗｰﾁｪｯｸ
            For w_lngLoop = 1 To UBound(m_NotStaffPatternInfo)
                For w_lngLoop2 = 1 To UBound(m_AllocKinmuData)
                    If m_NotStaffPatternInfo(w_lngLoop).AllocCD = m_AllocKinmuData(w_lngLoop2).BunruiCD Then
                        If UBound(m_AllocKinmuData(w_lngLoop2).StaffInfo) > 1 Then
                            For w_lngLoop3 = 1 To UBound(m_NotStaffPatternInfo(w_lngLoop).Data)
                                w_ErrFlg = True
                                For w_lngLoop4 = 1 To UBound(m_NotStaffPatternInfo(w_lngLoop).Data(w_lngLoop3).StaffMngID)
                                    w_HitFlg = False
                                    For w_lngLoop5 = 1 To UBound(m_AllocKinmuData(w_lngLoop2).StaffInfo)
                                        If m_NotStaffPatternInfo(w_lngLoop).Data(w_lngLoop3).StaffMngID(w_lngLoop4) = m_AllocKinmuData(w_lngLoop2).StaffInfo(w_lngLoop5).StaffMngID Then
                                            w_HitFlg = True
                                            Exit For
                                        End If
                                    Next w_lngLoop5
                                    If w_HitFlg = False Then
                                        w_ErrFlg = False
                                        Exit For
                                    End If
                                Next w_lngLoop4

                                'ﾁｪｯｸ対象の場合
                                If w_ErrFlg = True Then
                                    For w_lngLoop4 = 1 To UBound(m_NotStaffPatternInfo(w_lngLoop).Data(w_lngLoop3).StaffMngID)
                                        '配列確保
                                        w_lngDataCnt = UBound(g_NotStaffPatternError2) + 1
                                        ReDim Preserve g_NotStaffPatternError2(w_lngDataCnt)

                                        '職員情報取得
                                        For w_lngLoop5 = 1 To UBound(m_AllocKinmuData(w_lngLoop2).StaffInfo)
                                            If m_NotStaffPatternInfo(w_lngLoop).Data(w_lngLoop3).StaffMngID(w_lngLoop4) = m_AllocKinmuData(w_lngLoop2).StaffInfo(w_lngLoop5).StaffMngID Then
                                                g_NotStaffPatternError2(w_lngDataCnt).StaffName = m_AllocKinmuData(w_lngLoop2).StaffInfo(w_lngLoop5).StaffName
                                                g_NotStaffPatternError2(w_lngDataCnt).StaffIdx = m_AllocKinmuData(w_lngLoop2).StaffInfo(w_lngLoop5).StaffRow

                                                '配列確保
                                                ReDim g_NotStaffPatternError2(w_lngDataCnt).Data(1)
                                                g_NotStaffPatternError2(w_lngDataCnt).Data(1).ErrorFlg = True
                                                g_NotStaffPatternError2(w_lngDataCnt).Data(1).ErrorDate = w_lngTargetDate
                                                g_NotStaffPatternError2(w_lngDataCnt).Data(1).ErrorPattern = m_AllocKinmuData(w_lngLoop2).KinmuMark & Space(1) & "パターン" & StrConv(Convert.ToString(w_lngLoop3), VbStrConv.Wide)
                                                '対象列番号
                                                If m_SelViewKikan = 0 Then
                                                    g_NotStaffPatternError2(w_lngDataCnt).Data(1).ColIdx = pCol
                                                Else
                                                    '４週画面の場合
                                                    g_NotStaffPatternError2(w_lngDataCnt).Data(1).ColIdx = w_Col4W
                                                End If
                                                Exit For
                                            End If
                                        Next w_lngLoop5
                                    Next w_lngLoop4
                                End If
                            Next w_lngLoop3
                        Else
                            Exit For
                        End If
                    End If
                Next w_lngLoop2
            Next w_lngLoop

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '割当勤務情報取得
    Private Sub GetAllocKinmu()

        Const W_SUBNAME As String = "NSK0000HH GetAllocKinmu"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_i As Integer
        Dim w_Cnt As Integer
        Dim w_MarkF_F As ADODB.Field
        Dim w_Code_F As ADODB.Field
        Dim w_BCode_F As ADODB.Field
        Try
            '--- 勤務名称ﾏｽﾀ(割当対象のもの) -----
            'richard update start
            'w_Sql = "Select MarkF, KinmuCD, AllocBunruiCD "
            'w_Sql = w_Sql & "From NS_KINMUNAME_M "
            'w_Sql = w_Sql & "Where AllocFlg = '2' "
            'w_Sql = w_Sql & "And HospitalCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "Order By DispNo "
            ''ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_KINMUNAME_M_01(w_Rs) '<43>
            'richard update end

            With w_Rs
                If .RecordCount < 1 Then
                Else
                    'ﾚｺｰﾄﾞ件数格納
                    .MoveLast()
                    w_Cnt = .RecordCount
                    .MoveFirst()

                    w_MarkF_F = .Fields("MarkF")
                    w_Code_F = .Fields("KinmuCD")
                    w_BCode_F = .Fields("AllocBunruiCD")

                    '配列に格納
                    ReDim m_AllocKinmuData(w_Cnt)
                    For w_i = 1 To w_Cnt
                        m_AllocKinmuData(w_i).KinmuMark = w_MarkF_F.Value
                        m_AllocKinmuData(w_i).KinmuCD = w_Code_F.Value
                        m_AllocKinmuData(w_i).BunruiCD = w_BCode_F.Value & ""
                        '配列確保
                        ReDim m_AllocKinmuData(w_i).StaffInfo(0)

                        .MoveNext()
                    Next w_i
                End If
            End With

            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '超勤データの有無チェック
    Private Function Check_OverKinmuData(ByVal p_Date As Object, ByVal p_StaffMngID As String) As Boolean
        Const W_SUBNAME As String = "NSK0000HA Check_OverKinmuData"


        Dim w_strMsg() As String

        Check_OverKinmuData = False
        Try
            '超勤データ取得
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p承認区分 = 2 '0:調整F、1:明細F、2:両方
                .p職員区分 = 0 '0:職員管理番号
                .p職員番号 = p_StaffMngID '選択職員管理番号
                .p日付区分 = 0 '0:単一日
                .p開始年月日 = p_Date '開始年月日
                .p終了年月日 = 0 '終了年月日

                If .mGetOverKinmu = True Then
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "時間外が既に登録されているため~n"
                    Call General.paMsgDsp("NS0110", w_strMsg)
                    Exit Function
                End If
            End With

            Check_OverKinmuData = True

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '代休を日付順にソートする
    Private Sub SortDaikyu(ByVal p_intStaffIdx As Integer)

        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "clsNSW0200P SortDaikyu"

        Dim w_Int As Integer
        Dim w_Int2 As Integer
        'ｿｰﾄ用配列の確保
        Dim w_WorkTbl As Daikyu_Type
        Try
            '職員人数分 繰り返し
            For w_Int = 1 To UBound(m_StaffData(p_intStaffIdx).Daikyu)
                '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                For w_Int2 = 1 To UBound(m_StaffData(p_intStaffIdx).Daikyu) - w_Int
                    '並び替え 実行 ?
                    If (m_StaffData(p_intStaffIdx).Daikyu(w_Int2).HolDate > m_StaffData(p_intStaffIdx).Daikyu(w_Int2 + 1).HolDate) Then
                        '日付
                        w_WorkTbl = m_StaffData(p_intStaffIdx).Daikyu(w_Int2)
                        m_StaffData(p_intStaffIdx).Daikyu(w_Int2) = m_StaffData(p_intStaffIdx).Daikyu(w_Int2 + 1)
                        m_StaffData(p_intStaffIdx).Daikyu(w_Int2 + 1) = w_WorkTbl
                    End If
                Next w_Int2
                '待ち処理
            Next w_Int

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Sub
    '2018/02/28 Yamanshi Upd Start ----------------------------------------------------------------------------------------------
    ''PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
    ''Private Sub subGetKinmuTimeM()
    ''    Const W_SUBNAME As String = "NSK0000HA subGetKinmuTimeM"

    ''    Dim w_strSql As String
    ''    Dim w_lngWorkLoop As Integer
    ''    Dim w_lngTimeHHMM As Integer
    ''    Dim w_lngKensu As Integer
    ''    Dim w_Rs As ADODB.Recordset
    ''    Dim w_Saiyou_F As ADODB.Field '採用条件CD
    ''    Dim w_KinmuCD_F As ADODB.Field '勤務CD
    ''    Dim w_KinmuTime_F As ADODB.Field '実勤務時間
    ''    Dim w_DayTime_F As ADODB.Field '日勤時間
    ''    Dim w_NightTime_F As ADODB.Field '夜勤時間
    ''    Dim w_NextNightTime_F As ADODB.Field '翌日夜勤時間
    ''    '2016/04/28 T.K add st --------------------
    ''    Dim w_TotalNightTime_F As ADODB.Field     '総夜勤時間
    ''    Dim w_NextTotalNightTime_F As ADODB.Field '翌夜勤総時間
    ''    '2016/04/28 T.K add ed --------------------
    ''    Dim w_FirstFromTime_F As ADODB.Field '前半開始時刻
    ''    Dim w_SecToTime_F As ADODB.Field '後半終了時刻

    ''    Try
    ''        '初期化
    ''        m_objGetTimeM = New Hashtable

    ''        '**** 時間マスタ取得 ****
    ''        w_strSql = "select EMPCD" '採用コード
    ''        w_strSql = w_strSql & ", KINMUCD" '勤務コード
    ''        w_strSql = w_strSql & ", WORKTIMENUM" '実勤務時間
    ''        w_strSql = w_strSql & ", DAYTIME" '日勤時間
    ''        w_strSql = w_strSql & ", NIGHTTIME" '夜勤時間
    ''        w_strSql = w_strSql & ", NEXTNIGHTTIME" '翌日夜勤時間
    ''        '2016/04/28 T.K add st ---------------------------
    ''        w_strSql = w_strSql & ", TOTALNIGHTTIME"     '総夜勤時間
    ''        w_strSql = w_strSql & ", NEXTTOTALNIGHTTIME" '翌夜勤総時間
    ''        '2016/04/28 T.K add ed ---------------------------
    ''        w_strSql = w_strSql & ", FIRSTFROMTIME" '前半開始時刻
    ''        w_strSql = w_strSql & ", SECTOTIME" '後半終了時刻
    ''        w_strSql = w_strSql & " from NS_KINMUTIME_M "
    ''        w_strSql = w_strSql & " where (KINMUDEPTCD =  '0000' or KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "')"
    ''        w_strSql = w_strSql & " and HospitalCD = '" & General.g_strHospitalCD & "'"
    ''        w_strSql = w_strSql & " order by KinmuCD"

    ''        w_Rs = General.paDBRecordSetOpen(w_strSql)

    ''        With w_Rs
    ''            If .RecordCount <= 0 Then
    ''                'ﾃﾞｰﾀがない時
    ''            Else

    ''                'ﾃﾞｰﾀがある時
    ''                .MoveLast()
    ''                w_lngKensu = .RecordCount
    ''                .MoveFirst()

    ''                'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ
    ''                w_Saiyou_F = .Fields("EMPCD")
    ''                w_KinmuCD_F = .Fields("KINMUCD")
    ''                w_KinmuTime_F = .Fields("WORKTIMENUM")
    ''                w_DayTime_F = .Fields("DAYTIME")
    ''                w_NightTime_F = .Fields("NIGHTTIME")
    ''                w_NextNightTime_F = .Fields("NEXTNIGHTTIME")
    ''                '2016/04/28 T.K add st  -----------------------
    ''                w_TotalNightTime_F = .Fields("TOTALNIGHTTIME")
    ''                w_NextTotalNightTime_F = .Fields("NEXTTOTALNIGHTTIME")
    ''                '2016/04/28 T.K add ed ------------------------
    ''                w_FirstFromTime_F = .Fields("FIRSTFROMTIME")
    ''                w_SecToTime_F = .Fields("SECTOTIME")

    ''                For w_lngWorkLoop = 1 To w_lngKensu
    ''                    '実勤務時間
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "A") = Integer.Parse(IIf(IsDBNull(w_KinmuTime_F.Value), 0, w_KinmuTime_F.Value))
    ''                    '日勤時間
    ''                    w_lngTimeHHMM = Integer.Parse(IIf(IsDBNull(w_DayTime_F.Value), 0, w_DayTime_F.Value))
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "B") = ((w_lngTimeHHMM \ 100) * 60) + (w_lngTimeHHMM Mod 100)
    ''                    '夜勤時間
    ''                    w_lngTimeHHMM = Integer.Parse(IIf(IsDBNull(w_NightTime_F.Value), 0, w_NightTime_F.Value))
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "C") = ((w_lngTimeHHMM \ 100) * 60) + (w_lngTimeHHMM Mod 100)
    ''                    '翌日夜勤時間
    ''                    w_lngTimeHHMM = Integer.Parse(IIf(IsDBNull(w_NextNightTime_F.Value), 0, w_NextNightTime_F.Value))
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "D") = ((w_lngTimeHHMM \ 100) * 60) + (w_lngTimeHHMM Mod 100)
    ''                    '前半開始時刻
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "E") = Integer.Parse(General.paGetDbFieldVal(w_FirstFromTime_F, 0))
    ''                    '後半終了時刻
    ''                    m_objGetTimeM.Item(Convert.ToString(w_Saiyou_F.Value & "") & Convert.ToString(w_KinmuCD_F.Value & "") & "F") = Integer.Parse(General.paGetDbFieldVal(w_SecToTime_F, 0))
    ''                    '2016/04/28 T.K add st --------------------------
    ''                    '総夜勤時間
    ''                    w_lngTimeHHMM = General.paGetDbFieldVal(w_TotalNightTime_F, 0)
    ''                    m_objGetTimeM(w_Saiyou_F.Value & w_KinmuCD_F.Value & "G") = ((w_lngTimeHHMM \ 100) * 60) + (w_lngTimeHHMM Mod 100)
    ''                    '翌夜勤総時間
    ''                    w_lngTimeHHMM = General.paGetDbFieldVal(w_NextTotalNightTime_F, 0)
    ''                    m_objGetTimeM(w_Saiyou_F.Value & w_KinmuCD_F.Value & "H") = ((w_lngTimeHHMM \ 100) * 60) + (w_lngTimeHHMM Mod 100)
    ''                    '2016/04/28 T.K add ed --------------------------

    ''                    .MoveNext()
    ''                Next w_lngWorkLoop
    ''            End If
    ''            .Close()
    ''        End With

    ''        w_Rs = Nothing

    ''    Catch ex As Exception
    ''        Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
    ''    End Try
    ''End Sub

    'Private Sub subGetKinmuTimeM()
    '    Const W_SUBNAME As String = "NSK0000HA subGetKinmuTimeM"

    '    Dim w_Rs As ADODB.Recordset = Nothing
    '    Dim w_Sql As String
    '    Dim w_Key As String
    '    Dim w_Col As String
    '    Dim w_Data As Integer

    '    Try
    '        '初期化
    '        m_dicKinmuTimeM = New Dictionary(Of String, Integer)

    '        '**** 時間マスタ取得 ****
    '        'richard update start
    '        'w_Sql = ""
    '        'w_Sql = w_Sql & " SELECT "
    '        'w_Sql = w_Sql & "   EMPCD "       '採用CD
    '        'w_Sql = w_Sql & " , KINMUDEPTCD " '勤務部署CD
    '        'w_Sql = w_Sql & " , KINMUCD "     '勤務CD
    '        'For i As gKinmuTimeMCol = M_gKinmuTimeMCol_Min To M_gKinmuTimeMCol_Max
    '        '    w_Sql = w_Sql & " , " & i.ToString("G")
    '        'Next i
    '        'w_Sql = w_Sql & " FROM NS_KINMUTIME_M "
    '        'w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
    '        'w_Rs = General.paDBRecordSetOpen(w_Sql)
    '        Call NSK0000H_sql.select_NS_KINMUTIME_M_01(w_Rs, M_gKinmuTimeMCol_Min, M_gKinmuTimeMCol_Max) '<44>
    '        'richard update end


    '        Do Until w_Rs.EOF
    '            w_Key = w_Rs.Fields("EMPCD").Value & "," & w_Rs.Fields("KINMUDEPTCD").Value & "," & w_Rs.Fields("KINMUCD").Value & ","

    '            For i As gKinmuTimeMCol = M_gKinmuTimeMCol_Min To M_gKinmuTimeMCol_Max

    '                w_Col = i.ToString("G")
    '                w_Data = General.paGetDbFieldVal(w_Rs.Fields(w_Col), 0)

    '                Select Case i
    '                    Case gKinmuTimeMCol.WorkTimeNum, _
    '                         gKinmuTimeMCol.FirstFromTime, _
    '                         gKinmuTimeMCol.SecToTime
    '                        '実勤務時間・前半開始時刻・後半終了時刻では計算しない
    '                    Case Else
    '                        w_Data = ((w_Data \ 100) * 60) + (w_Data Mod 100)
    '                End Select

    '                m_dicKinmuTimeM(w_Key & w_Col) = w_Data
    '            Next i

    '            Call w_Rs.MoveNext()
    '        Loop

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
    '    Finally
    '        If w_Rs IsNot Nothing Then
    '            Call w_Rs.Close()
    '        End If
    '    End Try
    'End Sub
    'Private Function GetKinmuTime(ByVal p_KinmuCD As String, ByVal p_Idx As Integer, ByVal p_iDate As Integer, ByVal p_Col As gKinmuTimeMCol) As Integer
    '    Const W_SUBNAME As String = "NSK0000HA GetKinmuTime"

    '    Static w_Idx_bk As Integer = -1
    '    Static w_iDate_bk As Integer = -1
    '    Static w_EmpCD As String = ""
    '    Static w_KinmuDeptCD As String = ""
    '    Dim w_Col As String
    '    Dim w_Key As String
    '    Try
    '        w_Col = p_Col.ToString("G")

    '        If w_Idx_bk = p_Idx AndAlso w_iDate_bk = p_iDate Then
    '            '直近と同じ職員インデックス・年月日なら何もしない
    '        Else
    '            w_Idx_bk = p_Idx
    '            w_iDate_bk = p_iDate
    '            w_EmpCD = ""
    '            w_KinmuDeptCD = ""

    '            For i As Integer = 1 To UBound(m_StaffData(p_Idx).SaiyoData)
    '                If m_StaffData(p_Idx).SaiyoData(i).SaiyoDate <= p_iDate AndAlso _
    '                   p_iDate <= m_StaffData(p_Idx).SaiyoData(i).TentaiDate Then
    '                    w_EmpCD = m_StaffData(p_Idx).SaiyoData(i).SaiyoCD
    '                End If
    '            Next i
    '            For i As Integer = 1 To UBound(m_StaffData(p_Idx).IdoHistory)
    '                If m_StaffData(p_Idx).IdoHistory(i).IdoYMD <= p_iDate AndAlso _
    '                   p_iDate <= m_StaffData(p_Idx).IdoHistory(i).SyuryoYMD Then
    '                    w_KinmuDeptCD = m_StaffData(p_Idx).IdoHistory(i).CD
    '                End If
    '            Next i
    '        End If

    '        For i As Integer = 1 To 5
    '            Select Case i
    '                Case 1
    '                    w_Key = w_EmpCD & "," & w_KinmuDeptCD & "," & p_KinmuCD & ","
    '                Case 2
    '                    w_Key = w_EmpCD & ",0000," & p_KinmuCD & ","
    '                Case 3
    '                    w_Key = "00000," & w_KinmuDeptCD & "," & p_KinmuCD & ","
    '                Case 4
    '                    w_Key = "00000,0000," & p_KinmuCD & ","
    '                Case Else
    '                    Return 0
    '            End Select
    '            If m_dicKinmuTimeM.ContainsKey(w_Key & w_Col) Then
    '                Return m_dicKinmuTimeM(w_Key & w_Col)
    '            End If
    '        Next i

    '        Return 0

    '    Catch ex As Exception
    '        Call General.paTrpMsg(Err.Number, W_SUBNAME)
    '    End Try
    'End Function
    ''PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正-----------------------------------------

    Private Function GetKinmuTime(ByVal p_KinmuCD As String, ByVal p_Idx As Integer, ByVal p_iDate As Integer, ByVal p_Col As gKinmuTimeMCol) As Integer
        Const W_SUBNAME As String = "NSK0000HA GetKinmuTime"

        Dim w_Key As String
        Dim w_Col As Integer = p_Col
        Dim w_Value As String
        Dim w_Var() As String
        Dim w_Var2() As String
        Dim w_iFmDate As Integer
        Dim w_iToDate As Integer
        Try
            If String.IsNullOrEmpty(p_KinmuCD) Then Return 0

            w_Key = m_StaffData(p_Idx).ID & ";" & p_KinmuCD & ";"
            If m_dicKinmuTimeM Is Nothing Then
                m_dicKinmuTimeM = New Dictionary(Of String, String)
            End If

            If Not m_dicKinmuTimeM.ContainsKey(w_Key & w_Col) Then
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD '施設コード
                    .p職員番号 = m_StaffData(p_Idx).ID '職員管理番号
                    .p勤務CD = p_KinmuCD               '選択された勤務CD
                    .p職員区分 = 0                     '職員区分
                    .p看護単位CD = ""

                    If .mGetPersonalKinmuTime Then
                        For i As Integer = 1 To .f勤務時間件数
                            .p勤務時間索引 = i

                            w_iFmDate = .f有効開始日
                            w_iToDate = .f有効終了日

                            For j As Integer = M_gKinmuTimeMCol_Min To M_gKinmuTimeMCol_Max
                                Select Case j
                                    Case gKinmuTimeMCol.WorkTimeNum
                                        w_Value = .f実勤務時間
                                    Case gKinmuTimeMCol.DayTime
                                        w_Value = .f日勤時間
                                    Case gKinmuTimeMCol.NightTime
                                        w_Value = .f夜勤時間
                                    Case gKinmuTimeMCol.NextNightTime
                                        w_Value = .f翌日夜勤時間
                                    Case gKinmuTimeMCol.TotalNightTime
                                        w_Value = .f総夜勤時間
                                    Case gKinmuTimeMCol.NextTotalNightTime
                                        w_Value = .f翌夜勤総時間
                                    Case gKinmuTimeMCol.FirstFromTime
                                        w_Value = .f前半開始時刻
                                    Case gKinmuTimeMCol.SecToTime
                                        w_Value = .f後半終了時刻
                                    Case Else
                                        w_Value = String.Empty
                                End Select

                                w_Value &= "," & w_iFmDate & "," & w_iToDate
                                If i = 1 Then
                                    m_dicKinmuTimeM(w_Key & j) = w_Value
                                Else
                                    m_dicKinmuTimeM(w_Key & j) = m_dicKinmuTimeM(w_Key & j) & ";" & w_Value
                                End If
                            Next j
                        Next i
                    End If
                End With
            End If

            If m_dicKinmuTimeM.ContainsKey(w_Key & w_Col) Then
                w_Var = General.paSplit(m_dicKinmuTimeM(w_Key & w_Col), ";")
                For i As Integer = 0 To UBound(w_Var)
                    w_Var2 = General.paSplit(w_Var(i), ",")
                    w_iFmDate = Integer.Parse(w_Var2(1))
                    w_iToDate = Integer.Parse(w_Var2(2))

                    If w_iFmDate <= p_iDate AndAlso p_iDate <= w_iToDate Then
                        Return Integer.Parse(w_Var2(0))
                    End If
                Next i
            End If

            Return 0
        Catch ex As Exception
            Call General.paTrpMsg(Err.Number, W_SUBNAME)
        End Try
    End Function

    Private Sub CalcDayNightTime(ByVal p_KikanCol As KikanCol_Type, ByVal p_Idx As Integer, ByVal p_iDate As Integer, ByVal p_Row As Integer,
                                 ByVal p_Col As Integer, ByVal p_KinmuCD As String, ByVal p_Time As String, ByVal p_JikanOuenFlg As Boolean,
                                 ByRef p_DayTime As Integer, ByRef p_NightTime As Integer, ByRef p_TotalNightTime As Integer)
        Const W_SUBNAME As String = "NSK0000HA CalcDayNightTime"

        Dim w_EmpFlg As Boolean
        Dim w_HaizokuFlg As Boolean
        Dim w_NextNightCalcFlg As Boolean
        Dim w_KojyoCD As String
        Dim w_KojyoCalcFlg As Boolean
        Dim w_strTime As String
        Dim w_DayHHmm As Integer
        Dim w_NightHHmm As Integer
        Dim w_NextNightHHmm As Integer
        Dim w_DayCalcTime As Integer
        Dim w_NightCalcTime As Integer
        Dim w_NextNightCalcTime As Integer
        Dim w_TotalNightCalcTime As Integer
        Dim w_NextTotalNightCalcTime As Integer
        Dim w_DayKinmuTime As Integer
        Dim w_NightKinmuTime As Integer
        Dim w_NextNightKinmuTime As Integer
        Dim w_TotalNightKinmuTime As Integer
        Dim w_NextTotalNightKinmuTime As Integer
        Try
            '日勤時間
            p_DayTime = 0
            '夜勤時間
            p_NightTime = 0
            '総夜勤時間
            p_TotalNightTime = 0

            w_DayCalcTime = 0
            w_NightCalcTime = 0
            w_NextNightCalcTime = 0
            w_TotalNightCalcTime = 0
            w_NextTotalNightCalcTime = 0

            '個人別時間年休を計算する
            w_strTime = p_Time

            While w_strTime <> ""
                w_strTime = Get_NenkyuTime(w_strTime, w_DayHHmm, w_NightHHmm, w_NextNightHHmm)

                If m_StaffData(p_Idx).OuenStaffFlg = 0 Then
                    '日勤時間
                    w_DayCalcTime = w_DayCalcTime + HHmmToMin(w_DayHHmm)
                    '当日夜勤時間
                    w_NightCalcTime = w_NightCalcTime + HHmmToMin(w_NightHHmm)
                    '翌日夜勤時間
                    w_NextNightCalcTime = w_NextNightCalcTime + HHmmToMin(w_NextNightHHmm)
                End If

                '当日夜勤時間
                w_TotalNightCalcTime = w_TotalNightCalcTime + HHmmToMin(w_NightHHmm)
                '翌日夜勤時間
                w_NextTotalNightCalcTime = w_NextTotalNightCalcTime + HHmmToMin(w_NextNightHHmm)
            End While

            '控除時間を考慮する
            For i As Integer = 1 To UBound(m_StaffData(p_Idx).Kojyo)
                '現在のセルのデータのみ計算
                If m_StaffData(p_Idx).Kojyo(i).lngDate = p_iDate Then

                    For j As Integer = 1 To UBound(m_StaffData(p_Idx).Kojyo(i).Seq)

                        w_KojyoCalcFlg = True
                        w_KojyoCD = m_StaffData(p_Idx).Kojyo(i).strKinmuDetailCD(j)

                        w_DayHHmm = m_StaffData(p_Idx).Kojyo(i).lngNikkinTime(j)
                        w_NightHHmm = m_StaffData(p_Idx).Kojyo(i).lngYakinTime(j)
                        w_NextNightHHmm = m_StaffData(p_Idx).Kojyo(i).lngYokuYakinTime(j)

                        If m_StaffData(p_Idx).OuenStaffFlg = 0 Then
                            'pass
                        ElseIf General.g_UseMultiOuenFlg Then
                            If m_StaffData(p_Idx).Kojyo(i).OuenKinmuDeptCD(j) <> General.g_strSelKinmuDeptCD Then
                                w_KojyoCalcFlg = False
                            End If
                        Else
                            If InStr(m_strOuenKojyoCD, General.paFormatSpace(w_KojyoCD, 10)) = 0 Then
                                w_KojyoCalcFlg = False
                            End If
                        End If

                        If w_KojyoCalcFlg Then
                            '日勤時間を合計
                            w_DayCalcTime = w_DayCalcTime + HHmmToMin(w_DayHHmm)
                            '夜勤時間を合計
                            w_NightCalcTime = w_NightCalcTime + HHmmToMin(w_NightHHmm)
                            '翌日夜勤時間を合計
                            w_NextNightCalcTime = w_NextNightCalcTime + HHmmToMin(w_NextNightHHmm)
                        End If

                        '必要なデータをよりわけ
                        If InStr(m_NotCalcTotalNightKojyoCD & "," & m_strOuenKojyoCD, General.paFormatSpace(w_KojyoCD, 10)) = 0 Then
                            '夜勤時間を合計
                            w_TotalNightCalcTime = w_TotalNightCalcTime + HHmmToMin(w_NightHHmm)
                            '翌日夜勤時間を合計
                            w_NextTotalNightCalcTime = w_NextTotalNightCalcTime + HHmmToMin(w_NextNightHHmm)
                        End If
                    Next j
                End If
            Next i

            w_EmpFlg = False
            For i As Integer = 1 To UBound(m_StaffData(p_Idx).SaiyoData)
                If m_StaffData(p_Idx).SaiyoData(i).SaiyoDate <= p_iDate AndAlso p_iDate <= m_StaffData(p_Idx).SaiyoData(i).TentaiDate Then
                    w_EmpFlg = True
                    Exit For
                End If
            Next i

            If w_EmpFlg Then

                w_HaizokuFlg = False
                For i As Integer = 1 To UBound(m_StaffData(p_Idx).IdoData)
                    If m_StaffData(p_Idx).IdoData(i).IdoYMD <= p_iDate AndAlso p_iDate <= m_StaffData(p_Idx).IdoData(i).SyuryoYMD Then
                        w_HaizokuFlg = True
                        Exit For
                    End If
                Next i

                '翌夜勤時間計算
                w_NextNightCalcFlg = True

                If p_Col = p_KikanCol.KinmuDataEndCol Then
                    '期間の最終日
                    w_NextNightCalcFlg = False

                    If p_iDate = p_KikanCol.EndDate Then
                        For i As Integer = 1 To UBound(m_StaffData(p_Idx).SaiyoData)
                            If m_StaffData(p_Idx).SaiyoData(i).TentaiDate = p_iDate Then
                                '退職日の場合は復活
                                w_NextNightCalcFlg = True
                                Exit For
                            End If
                        Next i

                        If Not w_NextNightCalcFlg Then
                            For i As Integer = 1 To UBound(m_StaffData(p_Idx).IdoHistory)
                                If m_StaffData(p_Idx).IdoHistory(i).SyuryoYMD = p_iDate Then
                                    '異動日の場合は復活
                                    w_NextNightCalcFlg = True
                                    Exit For
                                End If
                            Next i
                        End If
                    End If
                End If

                If w_HaizokuFlg Then
                    w_DayKinmuTime = GetKinmuTime(p_KinmuCD, p_Idx, p_iDate, gKinmuTimeMCol.DayTime)
                    w_NightKinmuTime = GetKinmuTime(p_KinmuCD, p_Idx, p_iDate, gKinmuTimeMCol.NightTime)
                    If w_NextNightCalcFlg Then
                        w_NextNightKinmuTime = GetKinmuTime(p_KinmuCD, p_Idx, p_iDate, gKinmuTimeMCol.NextNightTime)
                    End If

                    If m_StaffData(p_Idx).OuenStaffFlg = 1 AndAlso p_JikanOuenFlg Then
                        '日勤時間
                        p_DayTime = Math.Min(w_DayCalcTime, w_DayKinmuTime)

                        '夜勤時間
                        p_NightTime = Math.Min(w_NightCalcTime, w_NightKinmuTime)

                        If w_NextNightCalcFlg Then
                            '翌夜勤時間
                            p_NightTime = p_NightTime + Math.Min(w_NextNightCalcTime, w_NextNightKinmuTime)
                        End If
                    Else
                        '日勤時間
                        p_DayTime = Math.Max(w_DayKinmuTime - w_DayCalcTime, 0)

                        '夜勤時間
                        p_NightTime = Math.Max(w_NightKinmuTime - w_NightCalcTime, 0)

                        If w_NextNightCalcFlg Then
                            '翌夜勤時間
                            p_NightTime = p_NightTime + Math.Max(w_NextNightKinmuTime - w_NextNightCalcTime, 0)
                        End If
                    End If
                End If

                w_TotalNightKinmuTime = GetKinmuTime(p_KinmuCD, p_Idx, p_iDate, gKinmuTimeMCol.TotalNightTime)
                If w_NextNightCalcFlg Then
                    w_NextTotalNightKinmuTime = GetKinmuTime(p_KinmuCD, p_Idx, p_iDate, gKinmuTimeMCol.NextTotalNightTime)
                End If

                '総夜勤時間
                p_TotalNightTime = Math.Max(w_TotalNightKinmuTime - w_TotalNightCalcTime, 0)

                If w_NextNightCalcFlg Then
                    '翌夜勤総時間
                    p_TotalNightTime = p_TotalNightTime + Math.Max(w_NextTotalNightKinmuTime - w_NextTotalNightCalcTime, 0)
                End If
            End If

            If p_KikanCol.StartDate = p_iDate Then
                p_NightTime = p_NightTime + fncGetBeforeNextNightTime(p_Idx, General.paGetDateIntegerFromDate(General.paGetDateFromDateInteger(p_iDate).AddDays(-1)), p_Row, w_NextTotalNightCalcTime)
                p_TotalNightTime = p_TotalNightTime + w_NextTotalNightCalcTime
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Err.Number, W_SUBNAME)
        End Try
    End Sub
    '2018/02/28 Yamanshi Upd End ------------------------------------------------------------------------------------------------

    '分に変換(38.3⇒2310)
    Private Function fncChangeMinite(ByVal p_sngTime As Single) As Single

        Const W_SUBNAME As String = "NSK0000HA fncChangeMinite"

        Dim w_varWork As Object
        Dim w_lngLoop As Integer
        Dim w_sngTime As Single

        fncChangeMinite = 0
        Try
            If p_sngTime = 0 Then
                fncChangeMinite = 0
            End If

            w_varWork = General.paSplit(Convert.ToString(p_sngTime), ".")

            For w_lngLoop = 0 To UBound(w_varWork)
                If w_lngLoop = 0 Then
                    w_sngTime = w_sngTime + (Single.Parse(w_varWork(0)) * 60)
                ElseIf w_lngLoop = 1 Then
                    If Len(w_varWork(1) & "") = 1 Then
                        w_sngTime = w_sngTime + Single.Parse(w_varWork(1)) * 10
                    Else
                        w_sngTime = w_sngTime + Single.Parse(w_varWork(1))
                    End If
                End If
            Next w_lngLoop

            fncChangeMinite = w_sngTime

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Function

    '引数に、分と端数処理区分を受け取り
    '端数処理後の分を返す
    Private Function TimeRound(ByVal p_lngMinute As Integer, ByVal p_strKBN As String) As Integer
        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "NSC0000HA TimeRound"

        Dim w_lngHH As Integer
        Dim w_lngMM As Integer
        Try
            w_lngHH = p_lngMinute \ 60
            w_lngMM = p_lngMinute Mod 60

            Select Case p_strKBN
                '切上げ
                Case "2"
                    If w_lngMM > 0 Then
                        w_lngHH = w_lngHH + 1
                        w_lngMM = 0
                    End If
                    '切捨て
                Case "3"
                    If w_lngMM > 0 Then
                        w_lngMM = 0
                    End If
                    'そのまま
                Case Else

            End Select

            TimeRound = w_lngHH * 60 + w_lngMM

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Function

    '外枠罫線の描画が出来ないため、簡易関数を作成（中罫線不可）
    'p_spr:対象のスプレッド
    'p_Top, p_Bottom, p_Left, p_Right:上下左右の罫線指定（0:変更無し, 1:罫線無し, 2:罫線あり）
    'p_OutLine:外枠の罫線指定（0:変更無し, 1:罫線無し, 2:罫線あり）
    'p_Color:色指定
    Private Sub SetBorder(ByVal p_spr As FpSpread, ByVal p_Row As Integer, ByVal p_Col As Integer,
                                                                        ByVal p_Row2 As Integer, ByVal p_Col2 As Integer,
                                                                        ByVal p_Top As Integer, ByVal p_Bottom As Integer,
                                                                        ByVal p_Left As Integer, ByVal p_Right As Integer,
                                                                        ByVal p_OutLine As Integer, ByVal p_Color As Color)
        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "NSK0000HA SetBorder"

        Dim w_IB As IBorder
        Dim w_IB2 As IBorder = Nothing
        Dim w_Style As New StyleInfo
        Dim w_LB As LineBorder
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_Top As Boolean
        Dim w_Bottom As Boolean
        Dim w_Left As Boolean
        Dim w_Right As Boolean
        Dim w_CBS_T As ComplexBorderSide
        Dim w_CBS_B As ComplexBorderSide
        Dim w_CBS_L As ComplexBorderSide
        Dim w_CBS_R As ComplexBorderSide
        Dim w_CBS_黒有 As New ComplexBorderSide(Color.Black, 1)
        Dim w_CBS_黒無 As New ComplexBorderSide(Color.Black, 0)
        Dim w_CBS_色有 As New ComplexBorderSide(p_Color, 1)
        Dim w_Kbn_T As Integer
        Dim w_Kbn_B As Integer
        Dim w_Kbn_L As Integer
        Dim w_Kbn_R As Integer
        Dim w_Kbn_T_bk As Integer
        Dim w_Kbn_B_bk As Integer
        Dim w_Kbn_L_bk As Integer
        Dim w_Kbn_R_bk As Integer
        Try
            If p_Color = Color.Red Then
                Exit Sub
            End If

            '列の罫線の場合
            If p_Row = -1 Then
                p_Row = 0
                p_Row2 = p_spr.Sheets(0).RowCount - 1
            End If

            '行の罫線の場合
            If p_Col = -1 Then
                p_Col = 0
                p_Col2 = p_spr.Sheets(0).ColumnCount - 1
            End If

            '最大行数チェック
            If p_Row2 >= p_spr.Sheets(0).RowCount Then
                p_Row2 = p_spr.Sheets(0).RowCount - 1
            End If

            '最大列数チェック
            If p_Col2 >= p_spr.Sheets(0).ColumnCount Then
                p_Col2 = p_spr.Sheets(0).ColumnCount - 1
            End If

            '外枠の罫線ではない場合
            If p_OutLine = 0 Then
                '***********************************
                '  セルに依存しない場合の罫線設定
                '***********************************
                '上
                If p_Top = 1 Then
                    w_Top = False
                Else
                    w_Top = True
                End If

                '下
                If p_Bottom = 1 Then
                    w_Bottom = False
                Else
                    w_Bottom = True
                End If

                '左
                If p_Left = 1 Then
                    w_Left = False
                Else
                    w_Left = True
                End If

                '右
                If p_Right = 1 Then
                    w_Right = False
                Else
                    w_Right = True
                End If

                'LineBorderを初期化するたびに上書きされてしまうので、全セルを走査する
                For w_RowLoop = p_Row To p_Row2
                    For w_ColLoop = p_Col To p_Col2
                        '黒を指定した場合
                        If p_Color = Color.Black Then
                            w_IB = p_spr.Sheets(0).Cells(w_RowLoop, w_ColLoop).Border

                            '*********************************
                            '  セルに依存する場合の罫線設定
                            '*********************************
                            '上
                            If p_Top = 0 Then
                                If w_IB Is Nothing Then
                                    w_Top = False
                                Else
                                    If w_IB.Inset.Top = 1 Then
                                        w_Top = True
                                    Else
                                        w_Top = False
                                    End If
                                End If
                            End If

                            '下
                            If p_Bottom = 0 Then
                                If w_IB Is Nothing Then
                                    w_Bottom = False
                                Else
                                    If w_IB.Inset.Bottom = 1 Then
                                        w_Bottom = True
                                    Else
                                        w_Bottom = False
                                    End If
                                End If
                            End If

                            '左
                            If p_Left = 0 Then
                                If w_IB Is Nothing Then
                                    w_Left = False
                                Else
                                    If w_IB.Inset.Left = 1 Then
                                        w_Left = True
                                    Else
                                        w_Left = False
                                    End If
                                End If
                            End If

                            '右
                            If p_Right = 0 Then
                                If w_IB Is Nothing Then
                                    w_Right = False
                                Else
                                    If w_IB.Inset.Right = 1 Then
                                        w_Right = True
                                    Else
                                        w_Right = False
                                    End If
                                End If
                            End If

                            w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                            p_spr.Sheets(0).Cells(w_RowLoop, w_ColLoop).Border = w_LB

                            '黒以外を指定した場合（カーソル位置の罫線のみの考慮）
                        Else
                            w_IB = p_spr.Sheets(0).Cells(w_RowLoop, w_ColLoop).Border

                            '上
                            If w_IB Is Nothing Then
                                w_CBS_T = w_CBS_黒無
                                w_Kbn_T = 0
                            Else
                                If w_IB.Inset.Top = 1 Then
                                    w_CBS_T = w_CBS_黒有
                                    w_Kbn_T = 1
                                Else
                                    w_CBS_T = w_CBS_黒無
                                    w_Kbn_T = 0
                                End If
                            End If

                            '下
                            If p_Bottom = 2 OrElse (w_RowLoop = m_CurRow AndAlso w_ColLoop = m_CurCol AndAlso (p_spr.Equals(sprSheet_M) OrElse p_spr.Equals(sprSheet_4W))) Then
                                w_CBS_B = w_CBS_色有
                                w_Kbn_B = 2
                            Else
                                If w_IB Is Nothing Then
                                    w_CBS_B = w_CBS_黒無
                                    w_Kbn_B = 0
                                Else
                                    If w_IB.Inset.Bottom = 1 Then
                                        w_CBS_B = w_CBS_黒有
                                        w_Kbn_B = 1
                                    Else
                                        w_CBS_B = w_CBS_黒無
                                        w_Kbn_B = 0
                                    End If
                                End If
                            End If

                            '左
                            If w_IB Is Nothing Then
                                w_CBS_L = w_CBS_黒無
                                w_Kbn_L = 0
                            Else
                                If w_IB.Inset.Left = 1 Then
                                    w_CBS_L = w_CBS_黒有
                                    w_Kbn_L = 1
                                Else
                                    w_CBS_L = w_CBS_黒無
                                    w_Kbn_L = 0
                                End If
                            End If

                            '右
                            If p_Right = 2 OrElse (w_RowLoop = m_CurRow AndAlso w_ColLoop = m_CurCol AndAlso (p_spr.Equals(sprSheet_M) OrElse p_spr.Equals(sprSheet_4W))) Then
                                w_CBS_R = w_CBS_色有
                                w_Kbn_R = 2
                            Else
                                If w_IB Is Nothing Then
                                    w_CBS_R = w_CBS_黒無
                                    w_Kbn_R = 0
                                Else
                                    If w_IB.Inset.Right = 1 Then
                                        w_CBS_R = w_CBS_黒有
                                        w_Kbn_R = 1
                                    Else
                                        w_CBS_R = w_CBS_黒無
                                        w_Kbn_R = 0
                                    End If
                                End If
                            End If

                            If w_Kbn_T = w_Kbn_T_bk AndAlso w_Kbn_B = w_Kbn_B_bk AndAlso w_Kbn_L = w_Kbn_L_bk AndAlso w_Kbn_R = w_Kbn_R_bk Then
                            Else
                                w_IB2 = New ComplexBorder(w_CBS_L, w_CBS_T, w_CBS_R, w_CBS_B)
                                w_Kbn_T_bk = w_Kbn_T
                                w_Kbn_B_bk = w_Kbn_B
                                w_Kbn_L_bk = w_Kbn_L
                                w_Kbn_R_bk = w_Kbn_R
                            End If

                            p_spr.Sheets(0).Cells(w_RowLoop, w_ColLoop).Border = w_IB2
                        End If
                    Next w_ColLoop
                Next w_RowLoop

                '外枠の罫線の場合
            Else
                '***********************************
                '  セルに依存しない場合の罫線設定
                '***********************************
                If p_OutLine = 1 Then
                    w_Top = False
                    w_Bottom = False
                    w_Left = False
                    w_Right = False
                Else
                    w_Top = True
                    w_Bottom = True
                    w_Left = True
                    w_Right = True
                End If

                If p_Row = p_Row2 AndAlso p_Col = p_Col2 Then

                    '指定したセルを描画
                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col).Border = w_LB

                ElseIf p_Row = p_Row2 Then

                    '一番左のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row, p_Col).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '右
                    If w_IB Is Nothing Then
                        w_Right = False
                    Else
                        If w_IB.Inset.Right = 1 Then
                            w_Right = True
                        Else
                            w_Right = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col).Border = w_LB

                    '一番右のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row, p_Col2).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '右（上の処理で上書きされたフラグを戻す）
                    If p_OutLine = 1 Then
                        w_Right = False
                    Else
                        w_Right = True
                    End If

                    '左
                    If w_IB Is Nothing Then
                        w_Left = False
                    Else
                        If w_IB.Inset.Left = 1 Then
                            w_Left = True
                        Else
                            w_Left = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col2).Border = w_LB

                    '残りのセルを描画
                    For w_ColLoop = p_Col + 1 To p_Col2 - 1
                        w_IB = p_spr.Sheets(0).Cells(p_Row, w_ColLoop).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '左
                        If w_IB Is Nothing Then
                            w_Left = False
                        Else
                            If w_IB.Inset.Left = 1 Then
                                w_Left = True
                            Else
                                w_Left = False
                            End If
                        End If

                        '右
                        If w_IB Is Nothing Then
                            w_Right = False
                        Else
                            If w_IB.Inset.Right = 1 Then
                                w_Right = True
                            Else
                                w_Right = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(p_Row, w_ColLoop).Border = w_LB
                    Next w_ColLoop

                ElseIf p_Col = p_Col2 Then

                    '一番上のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row, p_Col).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '下
                    If w_IB Is Nothing Then
                        w_Bottom = False
                    Else
                        If w_IB.Inset.Bottom = 1 Then
                            w_Bottom = True
                        Else
                            w_Bottom = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col).Border = w_LB

                    '一番下のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row2, p_Col).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '下（上の処理で上書きされたフラグを戻す）
                    If p_OutLine = 1 Then
                        w_Bottom = False
                    Else
                        w_Bottom = True
                    End If

                    '上
                    If w_IB Is Nothing Then
                        w_Top = False
                    Else
                        If w_IB.Inset.Top = 1 Then
                            w_Top = True
                        Else
                            w_Top = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row2, p_Col).Border = w_LB

                    '残りのセルを描画
                    For w_RowLoop = p_Row + 1 To p_Row2 - 1
                        w_IB = p_spr.Sheets(0).Cells(w_RowLoop, p_Col).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '上
                        If w_IB Is Nothing Then
                            w_Top = False
                        Else
                            If w_IB.Inset.Top = 1 Then
                                w_Top = True
                            Else
                                w_Top = False
                            End If
                        End If

                        '下
                        If w_IB Is Nothing Then
                            w_Bottom = False
                        Else
                            If w_IB.Inset.Bottom = 1 Then
                                w_Bottom = True
                            Else
                                w_Bottom = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(w_RowLoop, p_Col).Border = w_LB
                    Next w_RowLoop

                Else

                    '左上のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row, p_Col).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '下
                    If w_IB Is Nothing Then
                        w_Bottom = False
                    Else
                        If w_IB.Inset.Bottom = 1 Then
                            w_Bottom = True
                        Else
                            w_Bottom = False
                        End If
                    End If

                    '右
                    If w_IB Is Nothing Then
                        w_Right = False
                    Else
                        If w_IB.Inset.Right = 1 Then
                            w_Right = True
                        Else
                            w_Right = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col).Border = w_LB

                    '右上のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row, p_Col2).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '右（上の処理で上書きされたフラグを戻す）
                    If p_OutLine = 1 Then
                        w_Right = False
                    Else
                        w_Right = True
                    End If

                    '下
                    If w_IB Is Nothing Then
                        w_Bottom = False
                    Else
                        If w_IB.Inset.Bottom = 1 Then
                            w_Bottom = True
                        Else
                            w_Bottom = False
                        End If
                    End If

                    '左
                    If w_IB Is Nothing Then
                        w_Left = False
                    Else
                        If w_IB.Inset.Left = 1 Then
                            w_Left = True
                        Else
                            w_Left = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row, p_Col2).Border = w_LB

                    '左下のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row2, p_Col).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '下, 左（上の処理で上書きされたフラグを戻す）
                    If p_OutLine = 1 Then
                        w_Bottom = False
                        w_Left = False
                    Else
                        w_Bottom = True
                        w_Left = True
                    End If

                    '上
                    If w_IB Is Nothing Then
                        w_Top = False
                    Else
                        If w_IB.Inset.Top = 1 Then
                            w_Top = True
                        Else
                            w_Top = False
                        End If
                    End If

                    '右
                    If w_IB Is Nothing Then
                        w_Right = False
                    Else
                        If w_IB.Inset.Right = 1 Then
                            w_Right = True
                        Else
                            w_Right = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row2, p_Col).Border = w_LB

                    '右下のセルを描画
                    w_IB = p_spr.Sheets(0).Cells(p_Row2, p_Col2).Border

                    '*********************************
                    '  セルに依存する場合の罫線設定
                    '*********************************
                    '右（上の処理で上書きされたフラグを戻す）
                    If p_OutLine = 1 Then
                        w_Right = False
                    Else
                        w_Right = True
                    End If

                    '上
                    If w_IB Is Nothing Then
                        w_Top = False
                    Else
                        If w_IB.Inset.Top = 1 Then
                            w_Top = True
                        Else
                            w_Top = False
                        End If
                    End If

                    '左
                    If w_IB Is Nothing Then
                        w_Left = False
                    Else
                        If w_IB.Inset.Left = 1 Then
                            w_Left = True
                        Else
                            w_Left = False
                        End If
                    End If

                    w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                    p_spr.Sheets(0).Cells(p_Row2, p_Col2).Border = w_LB

                    '上下の罫線を描画
                    For w_ColLoop = p_Col + 1 To p_Col2 - 1
                        '上の罫線を描画
                        w_IB = p_spr.Sheets(0).Cells(p_Row, w_ColLoop).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '上（上の処理で上書きされたフラグを戻す）
                        If p_OutLine = 1 Then
                            w_Top = False
                        Else
                            w_Top = True
                        End If

                        '下
                        If w_IB Is Nothing Then
                            w_Bottom = False
                        Else
                            If w_IB.Inset.Bottom = 1 Then
                                w_Bottom = True
                            Else
                                w_Bottom = False
                            End If
                        End If

                        '左
                        If w_IB Is Nothing Then
                            w_Left = False
                        Else
                            If w_IB.Inset.Left = 1 Then
                                w_Left = True
                            Else
                                w_Left = False
                            End If
                        End If

                        '右
                        If w_IB Is Nothing Then
                            w_Right = False
                        Else
                            If w_IB.Inset.Right = 1 Then
                                w_Right = True
                            Else
                                w_Right = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(p_Row, w_ColLoop).Border = w_LB

                        '下の罫線を描画
                        w_IB = p_spr.Sheets(0).Cells(p_Row2, w_ColLoop).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '下（上の処理で上書きされたフラグを戻す）
                        If p_OutLine = 1 Then
                            w_Bottom = False
                        Else
                            w_Bottom = True
                        End If

                        '上
                        If w_IB Is Nothing Then
                            w_Top = False
                        Else
                            If w_IB.Inset.Top = 1 Then
                                w_Top = True
                            Else
                                w_Top = False
                            End If
                        End If

                        '左
                        If w_IB Is Nothing Then
                            w_Left = False
                        Else
                            If w_IB.Inset.Left = 1 Then
                                w_Left = True
                            Else
                                w_Left = False
                            End If
                        End If

                        '右
                        If w_IB Is Nothing Then
                            w_Right = False
                        Else
                            If w_IB.Inset.Right = 1 Then
                                w_Right = True
                            Else
                                w_Right = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(p_Row2, w_ColLoop).Border = w_LB
                    Next w_ColLoop

                    '左右の罫線を描画
                    For w_RowLoop = p_Row + 1 To p_Row2 - 1
                        '左の罫線を描画
                        w_IB = p_spr.Sheets(0).Cells(w_RowLoop, p_Col).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '左（上の処理で上書きされたフラグを戻す）
                        If p_OutLine = 1 Then
                            w_Left = False
                        Else
                            w_Left = True
                        End If

                        '上
                        If w_IB Is Nothing Then
                            w_Top = False
                        Else
                            If w_IB.Inset.Top = 1 Then
                                w_Top = True
                            Else
                                w_Top = False
                            End If
                        End If

                        '下
                        If w_IB Is Nothing Then
                            w_Bottom = False
                        Else
                            If w_IB.Inset.Bottom = 1 Then
                                w_Bottom = True
                            Else
                                w_Bottom = False
                            End If
                        End If

                        '右
                        If w_IB Is Nothing Then
                            w_Right = False
                        Else
                            If w_IB.Inset.Right = 1 Then
                                w_Right = True
                            Else
                                w_Right = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(w_RowLoop, p_Col).Border = w_LB

                        '下の罫線を描画
                        w_IB = p_spr.Sheets(0).Cells(w_RowLoop, p_Col2).Border

                        '*********************************
                        '  セルに依存する場合の罫線設定
                        '*********************************
                        '右（上の処理で上書きされたフラグを戻す）
                        If p_OutLine = 1 Then
                            w_Right = False
                        Else
                            w_Right = True
                        End If

                        '上
                        If w_IB Is Nothing Then
                            w_Top = False
                        Else
                            If w_IB.Inset.Top = 1 Then
                                w_Top = True
                            Else
                                w_Top = False
                            End If
                        End If

                        '下
                        If w_IB Is Nothing Then
                            w_Bottom = False
                        Else
                            If w_IB.Inset.Bottom = 1 Then
                                w_Bottom = True
                            Else
                                w_Bottom = False
                            End If
                        End If

                        '左
                        If w_IB Is Nothing Then
                            w_Left = False
                        Else
                            If w_IB.Inset.Left = 1 Then
                                w_Left = True
                            Else
                                w_Left = False
                            End If
                        End If

                        w_LB = New LineBorder(p_Color, 1, w_Left, w_Top, w_Right, w_Bottom)
                        p_spr.Sheets(0).Cells(w_RowLoop, p_Col2).Border = w_LB
                    Next w_RowLoop
                End If
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), General.g_ErrorProc)
            End
        End Try
    End Sub

    'スタイルの設定を行う関数
    'p_spr:対象のスプレッド
    'p_CellType_Text:セルタイプ（ラベル）の設定（0:設定しない, 1:設定する）
    'p_CellType_Num:セルタイプ（数値）の設定（0:設定しない, 1:設定する）
    'p_ForeColor:文字色の設定（省略可）
    'p_BackColor:背景色の設定（省略可）
    'p_HAlign:横位置の設定（省略可）
    'p_VAlign:縦位置の設定（省略可）
    Private Sub SubSetStyle(ByVal p_spr As FpSpread, ByVal p_Row As Integer, ByVal p_Col As Integer,
                                                                            ByVal p_Row2 As Integer, ByVal p_Col2 As Integer,
                                                                            ByVal p_CellType_Text As Integer, ByVal p_CellType_Num As Integer,
                                                                            Optional ByVal p_ForeColor As Object = Nothing,
                                                                            Optional ByVal p_BackColor As Object = Nothing,
                                                                            Optional ByVal p_HAlign As CellHorizontalAlignment = CellHorizontalAlignment.General,
                                                                            Optional ByVal p_VAlign As CellVerticalAlignment = CellVerticalAlignment.General)
        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "NSK0000HA SubSetStyle"

        Dim w_Style As New StyleInfo
        Dim w_RowLoop As Integer
        Dim w_ColLoop As Integer
        Dim w_TextCellType As New CellType.TextCellType
        Dim w_NumCellType As New CellType.NumberCellType
        Try
            '初期化
            w_NumCellType.MaximumValue = 99999999999.0#
            w_NumCellType.MinimumValue = -99999999999.0#
            w_NumCellType.DecimalPlaces = 0
            w_NumCellType.EnableSubEditor = False

            '列の罫線の場合
            If p_Row = -1 Then
                p_Row = 0
                p_Row2 = p_spr.Sheets(0).RowCount - 1
            End If

            '行の罫線の場合
            If p_Col = -1 Then
                p_Col = 0
                p_Col2 = p_spr.Sheets(0).ColumnCount - 1
            End If

            '最大行数チェック
            If p_Row2 >= p_spr.Sheets(0).RowCount Then
                p_Row2 = p_spr.Sheets(0).RowCount - 1
            End If

            '最大列数チェック
            If p_Col2 >= p_spr.Sheets(0).ColumnCount Then
                p_Col2 = p_spr.Sheets(0).ColumnCount - 1
            End If

            '指定した全セルの変更を行う
            For w_RowLoop = p_Row To p_Row2
                For w_ColLoop = p_Col To p_Col2
                    '元のスタイル情報を取得する
                    w_Style = p_spr.Sheets(0).Models.Style.GetDirectInfo(w_RowLoop, w_ColLoop, w_Style)
                    w_Style.Locked = True

                    'セルタイプ（ラベル）の設定
                    If p_CellType_Text = 1 Then
                        w_Style.CellType = w_TextCellType
                    End If

                    'セルタイプ（数値）の設定
                    If p_CellType_Num = 1 Then
                        w_Style.CellType = w_NumCellType
                    End If

                    '文字色の設定
                    If p_ForeColor IsNot Nothing Then
                        w_Style.ForeColor = p_ForeColor
                    End If

                    '背景色の設定
                    If p_BackColor IsNot Nothing Then
                        w_Style.BackColor = p_BackColor
                    End If

                    '横位置の設定
                    If Not p_HAlign.Equals(CellHorizontalAlignment.General) Then
                        w_Style.HorizontalAlignment = p_HAlign
                    End If

                    '縦位置の設定
                    If Not p_VAlign.Equals(CellVerticalAlignment.General) Then
                        w_Style.VerticalAlignment = p_VAlign
                    End If

                    '変更したのスタイル情報を設定する
                    p_spr.Sheets(0).Models.Style.SetDirectInfo(w_RowLoop, w_ColLoop, w_Style)
                Next w_ColLoop
            Next w_RowLoop

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), General.g_ErrorProc)
            End
        End Try
    End Sub

    'コントロール配列の代わりにリストに格納する
    Private Sub subSetCtlList()
        m_lstmnuCheck.Add(_mnuCheck_0)
        m_lstmnuCheck.Add(_mnuCheck_1)
        m_lstmnuCheck.Add(_mnuCheck_2)
        m_lstmnuCheck.Add(_mnuCheck_3)
        m_lstmnuCheck.Add(_mnuCheck_4)
        m_lstmnuCheck.Add(_mnuCheck_5)
        m_lstmnuCheck.Add(_mnuCheck_6)
        m_lstmnuCheck.Add(_mnuCheck_7)
        m_lstmnuCheck.Add(_mnuCheck_8)
        m_lstmnuCheck.Add(_mnuCheck_9)
        m_lstmnuCheck.Add(_mnuCheck_10)

        m_lstmnuData.Add(_mnuData_0)
        m_lstmnuData.Add(_mnuData_1)
        m_lstmnuData.Add(_mnuData_2)
        m_lstmnuData.Add(_mnuData_3)

        m_lstmnuEdit.Add(_mnuEdit_0)
        m_lstmnuEdit.Add(_mnuEdit_1)
        m_lstmnuEdit.Add(_mnuEdit_2)
        m_lstmnuEdit.Add(_mnuEdit_3)
        m_lstmnuEdit.Add(_mnuEdit_4)
        m_lstmnuEdit.Add(_mnuEdit_5)
        m_lstmnuEdit.Add(_mnuEdit_6)
        m_lstmnuEdit.Add(_mnuEdit_7)
        m_lstmnuEdit.Add(_mnuEdit_8)
        m_lstmnuEdit.Add(_mnuEdit_9)
        m_lstmnuEdit.Add(_mnuEdit_10)
        m_lstmnuEdit.Add(_mnuEdit_11)
        m_lstmnuEdit.Add(_mnuEdit_12)
        m_lstmnuEdit.Add(_mnuEdit_13)
        m_lstmnuEdit.Add(_mnuEdit_14) '2016/04/05 Ishiga add

        m_lstmnuFile.Add(_mnuFile_0)
        m_lstmnuFile.Add(_mnuFile_1)
        m_lstmnuFile.Add(_mnuFile_2)
        m_lstmnuFile.Add(_mnuFile_3)
        m_lstmnuFile.Add(_mnuFile_4)
        m_lstmnuFile.Add(_mnuFile_5)
        m_lstmnuFile.Add(_mnuFile_6)
        m_lstmnuFile.Add(_mnuFile_7)
        m_lstmnuFile.Add(_mnuFile_8)
        m_lstmnuFile.Add(_mnuFile_9) '2017/08/09 Angelo Add

        m_lstmnuFont.Add(_mnuFont_0)
        m_lstmnuFont.Add(_mnuFont_1)
        m_lstmnuFont.Add(_mnuFont_2)

        m_lstmnuJidou.Add(_mnuJidou_0)

        m_lstmnuKikan.Add(_mnuKikan_0)

        m_lstmnuKinmuView.Add(_mnuKinmuView_0)
        m_lstmnuKinmuView.Add(_mnuKinmuView_1)
        m_lstmnuKinmuView.Add(_mnuKinmuView_2)
        m_lstmnuKinmuView.Add(_mnuKinmuView_3)

        m_lstmnuMain.Add(_mnuMain_0)
        m_lstmnuMain.Add(_mnuMain_1)
        m_lstmnuMain.Add(_mnuMain_2)
        m_lstmnuMain.Add(_mnuMain_3)
        m_lstmnuMain.Add(_mnuMain_4)
        m_lstmnuMain.Add(_mnuMain_5)
        m_lstmnuMain.Add(_mnuMain_6)

        m_lstmnuPopup.Add(_mnuPopup_0)
        m_lstmnuPopup.Add(_mnuPopup_1)
        m_lstmnuPopup.Add(_mnuPopup_2)
        m_lstmnuPopup.Add(_mnuPopup_3)
        m_lstmnuPopup.Add(_mnuPopup_4)
        m_lstmnuPopup.Add(_mnuPopup_5)
        m_lstmnuPopup.Add(_mnuPopup_6)
        m_lstmnuPopup.Add(_mnuPopup_7)
        m_lstmnuPopup.Add(_mnuPopup_8)
        m_lstmnuPopup.Add(_mnuPopup_9)
        m_lstmnuPopup.Add(_mnuPopup_10)
        m_lstmnuPopup.Add(_mnuPopup_11)
        m_lstmnuPopup.Add(_mnuPopup_12)
        m_lstmnuPopup.Add(_mnuPopup_13)
        m_lstmnuPopup.Add(_mnuPopup_14) '2016/04/05 Ishiga add

        m_lstmnuSet.Add(_mnuSet_0)
        m_lstmnuSet.Add(_mnuSet_1)
        m_lstmnuSet.Add(_mnuSet_2)

        m_lstmnuTeam.Add(_mnuTeam_0)

        m_lstmnuTool.Add(_mnuTool_0)
        m_lstmnuTool.Add(_mnuTool_1)
        m_lstmnuTool.Add(_mnuTool_2)
        m_lstmnuTool.Add(_mnuTool_3)
        m_lstmnuTool.Add(_mnuTool_4)
        m_lstmnuTool.Add(_mnuTool_5)
        m_lstmnuTool.Add(_mnuTool_6)
        m_lstmnuTool.Add(_mnuTool_7)

        m_lstmnuView.Add(_mnuView_0)
        m_lstmnuView.Add(_mnuView_1)
        m_lstmnuView.Add(_mnuView_2)
        m_lstmnuView.Add(_mnuView_3)
        m_lstmnuView.Add(_mnuView_4)
        m_lstmnuView.Add(_mnuView_5)
        m_lstmnuView.Add(_mnuView_6)
        m_lstmnuView.Add(_mnuView_7)
        m_lstmnuView.Add(_mnuView_8)
        m_lstmnuView.Add(_mnuView_9)
        m_lstmnuView.Add(_mnuView_10)
        m_lstmnuView.Add(_mnuView_11)
        '2014/06/20 Y.Doi P-06980  ADD START ------
        m_lstmnuView.Add(_mnuView_12)
        m_lstmnuView.Add(_mnuView_13)
        '2014/06/20 Y.Doi P-06980  ADD END --------
    End Sub

    'ステータスバーの日時表示用のタイマー
    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        sbrMain.Items.Item(M_StatusBarKey_NowDate).Text = Format(Now, "yyyy/MM/dd")
        sbrMain.Items.Item(M_StatusBarKey_NowTime).Text = Format(Now, "HH:mm")
        sbrMain.Refresh()
    End Sub

    Private Sub SetItemData(ByVal p_Cmb As ComboBox, ByVal p_Index As Integer, ByVal p_Item As Object)
        m_CmbHT(p_Cmb.Name & " " & p_Index) = p_Item
    End Sub

    Private Function GetItemData(ByVal p_Cmb As ComboBox, ByVal p_Index As Integer) As Object
        GetItemData = m_CmbHT(p_Cmb.Name & " " & p_Index)
    End Function

    Private Function fncGetNum(ByVal p_bool As Boolean) As Integer
        If p_bool = True Then
            Return -1
        Else
            Return 0
        End If
    End Function

    Private Function fncGetBool(ByVal p_num As Integer) As Boolean
        If p_num = -1 Then
            Return True
        Else
            Return False
        End If
    End Function

    Private Sub frmNSK0000HA_KeyDown(ByVal sender As System.Object, ByVal e As KeyEventArgs) Handles MyBase.KeyDown
        '2012/11/29 Ishiga add start---
        Dim w_Row As Integer
        Dim w_Col As Integer
        '2012/11/29 Ishiga add end-----
        If e.Control Then
            Select Case e.KeyCode
                Case Keys.S
                    '保存
                    If _mnuFile_0.Enabled AndAlso _mnuFile_0.Available Then
                        Call m_lstmnuFile_Click(_mnuFile_0, New System.EventArgs)
                    End If

                Case Keys.P
                    '印刷
                    If _mnuFile_5.Enabled AndAlso _mnuFile_5.Available Then
                        Call m_lstmnuFile_Click(_mnuFile_5, New System.EventArgs)
                    End If

                Case Keys.Z
                    '元に戻す
                    If _mnuEdit_0.Enabled AndAlso _mnuEdit_0.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_0, New System.EventArgs)
                    End If

                    '2016/04/05 Ishiga add start---------------------------------------
                Case Keys.Y
                    'やり直し
                    If _mnuEdit_14.Enabled AndAlso _mnuEdit_14.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_14, New System.EventArgs)
                    End If
                    '2016/04/05 Ishiga add end-----------------------------------------

                Case Keys.X
                    '切り取り
                    If _mnuEdit_2.Enabled AndAlso _mnuEdit_2.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_2, New System.EventArgs)
                    End If

                Case Keys.C
                    'コピー
                    If _mnuEdit_3.Enabled AndAlso _mnuEdit_3.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_3, New System.EventArgs)
                    End If

                Case Keys.V
                    '貼り付け
                    If _mnuEdit_4.Enabled AndAlso _mnuEdit_4.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_4, New System.EventArgs)
                    End If

                Case Keys.F
                    '検索
                    If _mnuEdit_7.Enabled AndAlso _mnuEdit_7.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_7, New System.EventArgs)
                    End If

                Case Keys.H
                    '置換
                    If _mnuEdit_8.Enabled AndAlso _mnuEdit_8.Available Then
                        Call m_lstmnuEdit_Click(_mnuEdit_8, New System.EventArgs)
                    End If

            End Select
        End If

        If Not e.Control Then
            If e.KeyCode = Keys.Delete Then
                '消去
                If _mnuEdit_5.Enabled AndAlso _mnuEdit_5.Available Then
                    Call m_lstmnuEdit_Click(_mnuEdit_5, New System.EventArgs)
                End If
            End If

            'ショートカットキー判定
            If IsNumOrFuncKey(e.KeyCode) Then

                If m_SelViewKikan = 0 Then
                    '1ヶ月
                    w_Row = sprSheet_M.Sheets(0).ActiveRowIndex
                    w_Col = sprSheet_M.Sheets(0).ActiveColumnIndex
                Else
                    '4週
                    w_Row = sprSheet_4W.Sheets(0).ActiveRowIndex
                    w_Col = sprSheet_4W.Sheets(0).ActiveColumnIndex
                End If

                '計画ﾃﾞｰﾀ列 範囲内か ?
                If (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) AndAlso m_blnJissekiUseFlg Then
                    '勤務変更 かつ 予定と実績を分けて表示 の時
                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) <> m_KinmuJisseki Then
                        '勤務実績以外の行の場合
                        Exit Sub
                    End If
                Else
                    'その他
                    If ((w_Row - m_StaffRow.StartRow) Mod m_MaxShowLine) <> m_KinmuPlan Then
                        '勤務予定以外の行の場合
                        Exit Sub
                    End If
                End If

                '設定がなければスルー
                If Not g_objKeyBoard.ContainsKey(e.KeyCode) Then Exit Sub

                'パレット設定退避
                Dim tmpKinm As String = m_SelNowKinmuCD
                Dim tmpRiyu As String = m_SelNowRiyuKbn

                m_SelNowKinmuCD = g_objKeyBoard(e.KeyCode)
                m_SelNowRiyuKbn = "1"

                If m_SelViewKikan = 0 Then
                    '1ヶ月
                    RunKinmuPaste_M(w_Col, w_Row, False)
                Else
                    '4週
                    RunKinmuPaste_4W(w_Col, w_Row, False)
                End If

                m_SelNowKinmuCD = tmpKinm
                m_SelNowRiyuKbn = tmpRiyu
            End If
        End If
    End Sub

    ''' <summary>
    ''' 時間外届出累計バッチ起動処理
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub updOvKnmApprvRuikei()

        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc         'プロシージャ名の一時待避
        General.g_ErrorProc = "frmNSK0000HA updOvKnmApprvRuikei"

        Const W_300B As String = "NSW0300B"

        Dim w_strCmdLine As String
        Dim w_strExePath As String
        Dim w_procDate As String

        Try
            w_procDate = General.paGetDateStringFromInteger(m_KeikakuKikan.StartDate, General.G_DATE_ENUM.yyyyMM)
            w_procDate = w_procDate & ":" & judgeOvKinmDate(m_KeikakuKikan.EndDate)

            'コマンドライン引数設定
            w_strCmdLine = "1"                                          'フォーム表示あり
            w_strCmdLine = w_strCmdLine & "," & "2"                     'フラグ（部署）
            w_strCmdLine = w_strCmdLine & "," & General.g_strHospitalCD         '病院コード
            w_strCmdLine = w_strCmdLine & "," & w_procDate              '処理年月
            w_strCmdLine = w_strCmdLine & "," & General.g_strUserID             '更新者ID
            w_strCmdLine = w_strCmdLine & "," & General.g_strSelKinmuDeptCD     '部署コード
            'Exe Pathの取得
            w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

            'EXE起動
            Call Shell(w_strExePath & W_300B & " " & w_strCmdLine, vbNormalFocus)

        Catch ex As Exception
            Throw
        End Try
    End Sub
    '**********************************************************************
    '*  関数名      : judgeOvKinmDate
    '*  概要        : 超勤日計上のとき、月末時点なら翌月を返す。
    '*
    '*  @param      : p_date        yyyymmdd型の日付
    '**********************************************************************
    Private Function judgeOvKinmDate(ByVal p_Date As Long) As Long

        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc        'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "NSC0000HA judgeOvKinmDate"

        Dim w_Date As Date
        Try
            judgeOvKinmDate = General.paLeftB(p_Date, 6)

            '計上日取得
            w_Date = General.paGetDateFromDateInteger(p_Date)
            If General.paRight(General.paGetDateStringFromDate(DateAdd("d", 1, w_Date), General.G_DATE_ENUM.yyyyMMdd), 2) = "01" Then
                judgeOvKinmDate = General.paGetDateStringFromDate(DateAdd("m", 1, w_Date), General.G_DATE_ENUM.yyyyMM)
            End If

            General.g_ErrorProc = w_PreErrorProc        '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Function

    '縦はスレッド生成するためデリゲートが必要
    Delegate Sub setVLineDelegate()

    Private Sub setVLine()
        Call vlineMove()
    End Sub

    Sub setVLineWorker()
        Invoke(New setVLineDelegate(AddressOf setVLine))
    End Sub

    Private Sub vlineMove()
        Dim w_Left As Integer
        Dim w_CellRange_v2 As Model.CellRange

        If (M_YYYYMMDDLabel_Row < m_CurRow AndAlso m_CurRow <= m_StaffRow.EndRow AndAlso m_CurCol > M_StaffName_Col) OrElse (m_CurRow > m_StaffRow.EndRow AndAlso M_StaffName_Col < m_CurCol AndAlso m_CurCol <= m_KeikakuKikan.KinmuDataEndCol) Then

            For w_Left = 1 To m_CellWidth
                w_CellRange_v2 = m_SelSheet.GetCellFromPixel(0, 0, m_v_xPos + w_Left, m_v_yPos)
                If m_CellRange_v.Equals(w_CellRange_v2) = False Then
                    Exit For
                End If
            Next

            vLine.Left = m_SelSheet.Left + m_v_xPos + w_Left
        End If
    End Sub

    Private Sub hlineMove()
        Dim w_top As Integer
        Dim w_CellRange_h2 As Model.CellRange

        If (M_YYYYMMDDLabel_Row < m_CurRow AndAlso m_CurRow <= m_StaffRow.EndRow AndAlso m_CurCol > M_StaffName_Col) OrElse (m_CurRow > m_StaffRow.EndRow AndAlso M_StaffName_Col < m_CurCol AndAlso m_CurCol <= m_KeikakuKikan.KinmuDataEndCol) Then

            For w_top = 1 To m_CellHeight
                w_CellRange_h2 = m_SelSheet.GetCellFromPixel(0, 0, m_h_xPos, m_h_yPos + w_top)
                If m_CellRange_h.Equals(w_CellRange_h2) = False Then
                    Exit For
                End If
            Next

            hLine.Top = m_SelSheet.Top + m_h_yPos + w_top
        End If
    End Sub

    Private Sub subSetCrossPointLength()
        Const W_SUBNAME As String = "NSK0000HA subSetCrossPointLength"

        Dim sprSheet As FarPoint.Win.Spread.FpSpread
        Dim sprDay As FarPoint.Win.Spread.FpSpread

        Try
            If m_SelViewKikan = 0 Then
                '1ヶ月用
                sprSheet = sprSheet_M
                sprDay = sprDayTotal_M
            Else
                '４週用
                sprSheet = sprSheet_4W
                sprDay = sprDayTotal_4W
            End If

            If Not m_sumLineDispFlg Then
                '集計まで線を引かない
                vLine.SetBounds(sprSheet.Left, sprSheet.Top, 1, sprSheet.Height)
                hLine.SetBounds(sprSheet.Left, sprSheet.Top, sprSheet.Width, 1)
            Else
                '集計まで線を引く
                vLine.SetBounds(sprSheet.Left, sprSheet.Top, 1, (sprSheet.Height + sprDay.Height) - m_scrollBerSize)
                hLine.SetBounds(sprSheet.Left, sprSheet.Top, (sprSheet.Width + sprPTotal.Width) - m_scrollBerSize, 1)
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
        End Try
    End Sub

    ''' <summary>
    ''' キーボード対応勤務取得
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub Get_KeyBoardKinmu()
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA Get_KeyBoardKinmu"

        Dim sb As New System.Text.StringBuilder
        Dim rs As ADODB.Recordset
        Dim cnt As Integer
        Dim inputKey As Integer
        Dim kinmuCd As String

        Try
            '初期化
            g_objKeyBoard = New Dictionary(Of Integer, String)

            sb.Length = 0
            sb.AppendLine("SELECT ")
            sb.AppendLine("  KEYBOARDKEY")
            sb.AppendLine(" ,KINMUCD")
            sb.AppendLine("FROM")
            sb.AppendLine(" NS_KEYBOARD_F")
            sb.AppendLine("WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'")
            sb.AppendLine(" AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'")
            rs = General.paDBRecordSetOpen(sb.ToString)

            If rs.RecordCount <= 0 Then
                'データなし
            Else
                With rs
                    '件数取得
                    .MoveLast()
                    cnt = .RecordCount
                    .MoveFirst()

                    For i As Integer = 1 To cnt
                        '値取得
                        inputKey = General.paGetDbFieldVal(.Fields("KEYBOARDKEY"), 0)
                        kinmuCd = General.paGetDbFieldVal(.Fields("KINMUCD"), "")

                        If inputKey <> 0 AndAlso Not String.IsNullOrEmpty(kinmuCd) Then
                            'データが取得可能時のみ取得する
                            g_objKeyBoard.Item(inputKey) = kinmuCd
                        End If
                        .MoveNext()
                    Next
                    .Close()
                End With
            End If
            rs = Nothing

            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    ''' <summary>
    ''' 行事予定データ取得
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub getEventData()
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA getEventData"

        Dim sb As New System.Text.StringBuilder
        Dim w_rs As ADODB.Recordset
        Dim w_From As Integer
        Dim w_To As Integer
        Dim cnt As Integer '件数
        Dim idx As Integer
        Dim staffCnt As Integer
        Dim uniq As String = String.Empty
        Dim uniq_bk As String = String.Empty
        Dim deptCd As String = String.Empty
        '2014/07/07 Shimizu add end P-06980---
        Dim dateidx As String = String.Empty
        Dim dateidx_bk As String = String.Empty
        '2014/07/07 Shimizu add end P-06980---

        Try
            '期間判定
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                w_From = m_KeikakuKikan.StartDate
                w_To = m_KeikakuKikan.EndDate
            Else
                If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                    '計画期間を含む４週期間の開始日
                    w_From = m_4WeekKikan(1).StartDate
                    '計画期間を含む４週期間の終了日
                    w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                Else
                    '計画期間を含む４週期間の開始日
                    w_From = Integer.Parse(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_4WeekKikan(1).EndDate, "0000/00/00"))), "yyyyMMdd"))
                    '計画期間を含む４週期間の終了日
                    w_To = m_4WeekKikan(UBound(m_4WeekKikan)).EndDate
                End If
            End If

            '初期化
            idx = 0
            staffCnt = 0
            ReDim m_EventData(idx)

            '行事をDBから取得（行事と研修合わせて取得）
            sb.Length = 0
            sb.AppendLine("SELECT ")
            sb.AppendLine("  E.UNIQUESEQNO AS UNIQUESEQNO")
            '2014/06/13  Y.SHIMPO P-07063  ADD　START-----------------------
            sb.AppendLine(" ,D.DATEIDX")
            '2014/06/13  Y.SHIMPO P-07063  ADD　END-------------------------
            '2014/06/06  Y.SHIMPO P-07063  UPD　START-----------------------
            'sb.AppendLine(" ,E.DATEF AS DATEF")
            sb.AppendLine(" ,D.DATEF AS DATEF")
            'sb.AppendLine(" ,E.FROMTIME AS FROMTIME")
            sb.AppendLine(" ,D.FROMTIME AS FROMTIME")
            'sb.AppendLine(" ,E.TOTIME")
            sb.AppendLine(" ,D.TOTIME")
            '2014/06/06  Y.SHIMPO P-07063  UPD　END-------------------------
            sb.AppendLine(" ,E.EVENTKBN")
            sb.AppendLine(" ,E.TARGETKINMUDEPTCD")
            sb.AppendLine(" ,E.EVENTNAME")
            sb.AppendLine(" ,S.STAFFMNGID AS STAFFMNGID")
            sb.AppendLine(" ,M.STAFFID AS STAFFID")
            sb.AppendLine(" ,B.STAFFNAME")
            sb.AppendLine(" ,P.POSTCD")
            sb.AppendLine(" ,PM.NAME")
            sb.AppendLine("FROM NS_EVENT_F E")
            '2014/06/06  Y.SHIMPO P-07063  ADD　START-----------------------
            sb.AppendLine("INNER JOIN NS_EVENTDATE_F D")
            sb.AppendLine("  ON D.HOSPITALCD = E.HOSPITALCD")
            sb.AppendLine("  AND D.UNIQUESEQNO = E.UNIQUESEQNO")
            '2014/06/06  Y.SHIMPO P-07063  ADD　END-------------------------
            sb.AppendLine("  LEFT OUTER JOIN (NS_EVENTPARTICIPANT_F S") '行事参加者一覧から参加者取得
            sb.AppendLine("    INNER JOIN NS_STAFFBASISINFO_F B")
            sb.AppendLine("      ON S.HOSPITALCD = B.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = B.STAFFMNGID")
            sb.AppendLine("    INNER JOIN (NS_POSTIDOINFO_F P ") '役職異動歴から役職取得
            sb.AppendLine("      INNER JOIN NS_POST_M PM ")
            sb.AppendLine("        ON P.HOSPITALCD = PM.HOSPITALCD")
            sb.AppendLine("        AND P.POSTCD = PM.POSTCD)")
            sb.AppendLine("      ON S.HOSPITALCD = P.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = P.STAFFMNGID) ")
            sb.AppendLine("    INNER JOIN NS_STAFFMNGHISTORY_F M") '履歴管理から職員番号取得（ソート）
            sb.AppendLine("      ON S.HOSPITALCD = M.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = M.STAFFMNGID")
            sb.AppendLine("    ON E.HOSPITALCD = S.HOSPITALCD")
            sb.AppendLine("    AND E.UNIQUESEQNO = S.UNIQUESEQNO ")
            '2014/06/06  Y.SHIMPO P-07063  UPD　START-----------------------
            sb.AppendLine("    AND D.DATEIDX = S.DATEIDX")
            'sb.AppendLine("    AND (P.IDODATE <= E.DATEF")
            sb.AppendLine("    AND (P.IDODATE <= D.DATEF")
            'sb.AppendLine("         AND P.ENDDATE >= E.DATEF)")
            sb.AppendLine("         AND P.ENDDATE >= D.DATEF)")
            'sb.AppendLine("    AND (M.EMPDATE <= E.DATEF")
            sb.AppendLine("    AND (M.EMPDATE <= D.DATEF")
            'sb.AppendLine("         AND E.DATEF <= M.RETIREDATE)")
            sb.AppendLine("         AND D.DATEF <= M.RETIREDATE)")
            sb.AppendLine("WHERE E.HOSPITALCD = '" & General.g_strHospitalCD & "'")
            'sb.AppendLine("  AND (E.DATEF <= " & w_To.ToString)
            sb.AppendLine("  AND (D.DATEF <= " & w_To.ToString)
            'sb.AppendLine("       AND E.DATEF >= " & w_From.ToString & ")")
            sb.AppendLine("       AND D.DATEF >= " & w_From.ToString & ")")
            '2014/06/06  Y.SHIMPO P-07063  UPD　END-------------------------
            sb.AppendLine("  AND (E.TARGETKINMUDEPTCD IS NULL")
            sb.AppendLine("       OR E.TARGETKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "')")
            sb.AppendLine("UNION") '研修も取得する（UNION)
            sb.AppendLine("SELECT ")
            sb.AppendLine("  E.UNIQUESEQNO AS UNIQUESEQNO")
            '2014/06/13  Y.SHIMPO P-07063  ADD　START-----------------------
            sb.AppendLine(" ,D.DATEIDX")
            '2014/06/13  Y.SHIMPO P-07063  ADD　END-------------------------
            '2014/06/06  Y.SHIMPO P-07063  UPD　START-----------------------
            'sb.AppendLine(" ,E.DATEF AS DATEF")
            sb.AppendLine(" ,D.DATEF AS DATEF")
            'sb.AppendLine(" ,E.FROMTIME AS FROMTIME")
            sb.AppendLine(" ,D.FROMTIME AS FROMTIME")
            'sb.AppendLine(" ,E.TOTIME")
            sb.AppendLine(" ,D.TOTIME")
            '2014/06/06  Y.SHIMPO P-07063  UPD　END-------------------------
            sb.AppendLine(" ,E.EVENTKBN")
            sb.AppendLine(" ,E.TARGETKINMUDEPTCD")
            sb.AppendLine(" ,E.EVENTNAME")
            sb.AppendLine(" ,S.STAFFMNGID AS STAFFMNGID")
            sb.AppendLine(" ,M.STAFFID AS STAFFID")
            sb.AppendLine(" ,B.STAFFNAME")
            sb.AppendLine(" ,P.POSTCD")
            sb.AppendLine(" ,PM.NAME")
            sb.AppendLine("FROM NS_EVENT_F E")
            '2014/06/06  Y.SHIMPO P-07063  ADD　START-----------------------
            sb.AppendLine("INNER JOIN NS_EVENTDATE_F D")
            sb.AppendLine("  ON D.HOSPITALCD = E.HOSPITALCD")
            sb.AppendLine("  AND D.UNIQUESEQNO = E.UNIQUESEQNO")
            '2014/06/06  Y.SHIMPO P-07063  ADD　END-------------------------
            sb.AppendLine("  LEFT OUTER JOIN (NS_STUDYSANKADATE_F S") '研修参加日付から参加者取得
            sb.AppendLine("    INNER JOIN NS_STAFFBASISINFO_F B")
            sb.AppendLine("      ON S.HOSPITALCD = B.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = B.STAFFMNGID")
            sb.AppendLine("    INNER JOIN (NS_POSTIDOINFO_F P ") '役職異動歴から役職取得
            sb.AppendLine("      INNER JOIN NS_POST_M PM ")
            sb.AppendLine("        ON P.HOSPITALCD = PM.HOSPITALCD")
            sb.AppendLine("        AND P.POSTCD = PM.POSTCD)")
            sb.AppendLine("      ON S.HOSPITALCD = P.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = P.STAFFMNGID)")
            sb.AppendLine("    INNER JOIN NS_STAFFMNGHISTORY_F M") '履歴管理から職員番号取得（ソート）
            sb.AppendLine("      ON S.HOSPITALCD = M.HOSPITALCD")
            sb.AppendLine("      AND S.STAFFMNGID = M.STAFFMNGID")
            sb.AppendLine("    ON E.HOSPITALCD = S.HOSPITALCD")
            sb.AppendLine("    AND E.NENDO = S.NENDO")
            sb.AppendLine("    AND E.STUDYIDX = S.STUDYIDX")
            'sb.AppendLine("    AND E.DATEIDX = S.DATEIDX")
            '2014/06/06  Y.SHIMPO P-07063  UPD　START-----------------------
            'sb.AppendLine("    AND (P.IDODATE <= E.DATEF")
            sb.AppendLine("    AND (P.IDODATE <= D.DATEF")
            'sb.AppendLine("         AND P.ENDDATE >= E.DATEF)")
            sb.AppendLine("         AND P.ENDDATE >= D.DATEF)")
            'sb.AppendLine("    AND (M.EMPDATE <= E.DATEF")
            sb.AppendLine("    AND (M.EMPDATE <= D.DATEF")
            'sb.AppendLine("         AND E.DATEF <= M.RETIREDATE)")
            sb.AppendLine("         AND D.DATEF <= M.RETIREDATE)")
            sb.AppendLine("WHERE E.HOSPITALCD = '" & General.g_strHospitalCD & "'")
            'sb.AppendLine("  AND (E.DATEF <= " & w_To.ToString)
            sb.AppendLine("  AND (D.DATEF <= " & w_To.ToString)
            'sb.AppendLine("       AND E.DATEF >= " & w_From.ToString & ")")
            sb.AppendLine("       AND D.DATEF >= " & w_From.ToString & ")")
            '2014/06/06  Y.SHIMPO P-07063  UPD　END-------------------------
            sb.AppendLine("  AND (E.TARGETKINMUDEPTCD IS NULL")
            sb.AppendLine("       OR E.TARGETKINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "')")
            sb.AppendLine("  AND E.NENDO IS NOT NULL")
            sb.AppendLine("  AND E.STUDYIDX IS NOT NULL")
            'sb.AppendLine("  AND E.DATEIDX IS NOT NULL")
            sb.AppendLine("ORDER BY DATEF, FROMTIME, UNIQUESEQNO, STAFFID")
            w_rs = General.paDBRecordSetOpen(sb.ToString)

            If w_rs.RecordCount <= 0 Then
                'データがない
            Else
                With w_rs
                    '件数取得
                    .MoveLast()
                    cnt = .RecordCount
                    .MoveFirst()

                    For i As Integer = 1 To cnt
                        'ユニークNO取得
                        '2014/07/07 Shimizu upd start P-06980---------------------------------
                        '2014/06/13  Y.SHIMPO P-07063  UPD　START-----------------------
                        'uniq = General.paGetDbFieldVal(.Fields("UNIQUESEQNO"), "")
                        'uniq = General.paGetDbFieldVal(.Fields("UNIQUESEQNO"), "") & General.paGetDbFieldVal(.Fields("DATEIDX"), "")
                        '2014/06/13  Y.SHIMPO P-07063  UPD　END-------------------------
                        uniq = General.paGetDbFieldVal(.Fields("UNIQUESEQNO"), "")
                        dateidx = General.paGetDbFieldVal(.Fields("DATEIDX"), 0)
                        '2014/07/07 Shimizu upd end P-06980------------------------------------
                        deptCd = General.paGetDbFieldVal(.Fields("TARGETKINMUDEPTCD"), "")

                        '2014/07/07 Shimizu upd start P-06980---
                        'If Not uniq.Equals(uniq_bk) Then
                        If (Not uniq.Equals(uniq_bk)) OrElse (Not dateidx.Equals(dateidx_bk)) Then
                            '2014/07/07 Shimizu upd end P-06980---
                            '前回と違えば別の行事予定なので配列拡張
                            idx += 1
                            ReDim Preserve m_EventData(idx)
                            m_EventData(idx).init()

                            '行事データ格納
                            m_EventData(idx).EventName = General.paGetDbFieldVal(.Fields("EVENTNAME"), "")
                            m_EventData(idx).DateF = General.paGetDbFieldVal(.Fields("DATEF"), 0)
                            m_EventData(idx).Time_st = General.paGetDbFieldVal(.Fields("FROMTIME"), 0)
                            m_EventData(idx).Time_ed = General.paGetDbFieldVal(.Fields("TOTIME"), 0)
                            m_EventData(idx).uniqNo = uniq
                            If String.IsNullOrEmpty(deptCd) Then m_EventData(idx).allFlg = True

                            '参加職員人数初期化
                            staffCnt = 0

                        End If

                        '参加者を取得
                        staffCnt += 1
                        ReDim Preserve m_EventData(idx).EventStaff(staffCnt)

                        m_EventData(idx).EventStaff(staffCnt).staffMngId = General.paGetDbFieldVal(.Fields("STAFFMNGID"), "")
                        m_EventData(idx).EventStaff(staffCnt).staffNm = General.paGetDbFieldVal(.Fields("STAFFNAME"), "")
                        m_EventData(idx).EventStaff(staffCnt).postNm = General.paGetDbFieldVal(.Fields("NAME"), "")

                        'ユニークNO退避
                        uniq_bk = uniq
                        '2014/07/07 Shimizu upd start P-06980---
                        dateidx_bk = dateidx
                        '2014/07/07 Shimizu upd end P-06980---
                        .MoveNext()
                    Next
                    .Close()
                End With
            End If
            w_rs = Nothing

            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    ''' <summary>
    ''' 行事予定を表示する
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub setEventData()
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA setEventData"

        Dim w_TextCellType As New FarPoint.Win.Spread.CellType.TextCellType
        Dim w_Style As New FarPoint.Win.Spread.StyleInfo
        Dim w_Col As Integer
        Dim w_Var As Object
        Dim w_dataIdx As Integer
        Dim tmpInt As Integer
        Dim tmpStr As String
        Dim eveCnt As Integer
        Dim w_stCol As Integer
        Dim w_edCol As Integer
        Dim w_TextCellType2 As New FarPoint.Win.Spread.CellType.TextCellType
        Dim w_Style2 As New FarPoint.Win.Spread.StyleInfo

        Try
            '行事予定表示行（ヘッダ）の書式設定
            w_TextCellType.Multiline = True
            w_TextCellType.ReadOnly = True
            w_Style.Reset()
            w_Style.CellType = w_TextCellType
            w_Style.Locked = True
            '行事予定表示行（明細）の書式設定
            w_TextCellType2 = New VerticalTextCell
            w_TextCellType2.Multiline = True
            w_TextCellType2.ReadOnly = True
            w_Style2.Reset()
            w_Style2.CellType = w_TextCellType2
            w_Style2.Locked = True

            '一ヶ月 or 4週
            w_dataIdx = 0
            sprSheet_M.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, -1, w_Style2)
            sprSheet_M.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, 1, w_Style)
            'sprSheet_M.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, 2, w_Style) '2017/09/12 Yamanishi Del

            Call SetBorder(sprSheet_M, M_EVENTLABEL_ROW, 1, M_EVENTLABEL_ROW, 2, 2, 2, 2, 2, 0, Color.Black)
            Call SetBorder(sprSheet_M, M_EVENTLABEL_ROW, 2, M_EVENTLABEL_ROW, 2, 2, 2, 2, 2, 0, Color.Black)

            sprSheet_M.Sheets(0).SetText(M_EVENTLABEL_ROW, 1, "行事予定")
            '2017/09/12 Yamanishi Upd --------------------------------------------------------------------------------------------------------
            'sprSheet_M.Sheets(0).SetText(M_EVENTLABEL_ROW, 2, fncStringNewline("採用条件", 2))
            ''2014/07/10 Shimizu add start P-06980---
            'If m_strKinmuEmSecondFlg = "1" Then
            '    sprSheet_M.Sheets(0).Cells(M_EVENTLABEL_ROW, M_EmpShrtNghtData_Col).HorizontalAlignment = CellHorizontalAlignment.Center
            'End If
            ''2014/07/10 Shimizu add end P-06980---
            sprSheet_M.Sheets(0).SetText(M_EVENTLABEL_ROW, M_EmpShrtNghtData_Col, "　　　 採用条件")
            '---------------------------------------------------------------------------------------------------------------------------------
            '期間設定
            If (m_PlanType = BasNSK0000H.gePlanType.PlanType_Month) OrElse (m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Week) Then
                '2013/07/31 Ishiga upd start-----------------
                'w_stCol = m_KeikakuKikan.StartDate
                'w_edCol = m_KeikakuKikan.EndDate
                w_stCol = m_KeikakuKikan.KinmuDataStartCol
                w_edCol = m_KeikakuKikan.KinmuDataEndCol
                '2013/07/31 Ishiga upd end-------------------
            Else
                For idx As Integer = 0 To UBound(m_4WeekKikan)
                    If idx = 0 Then w_stCol = m_4WeekKikan(idx).KinmuDataStartCol
                    If idx = UBound(m_4WeekKikan) Then w_edCol = w_edCol
                Next
            End If
            For w_Col = w_stCol To m_KeikakuKikan.KinmuDataEndCol
                '日付取得
                w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                If String.IsNullOrEmpty(w_Var) Then Continue For
                If Not Integer.TryParse(w_Var, tmpInt) Then Continue For
                If Not IsDate(Format(tmpInt, "0000/00/00")) Then Continue For

                '行事予定と日付が一致するかチェック
                '初期の一件目のみ
                tmpStr = ""
                eveCnt = 0
                For Each eveData As EventList_Type In m_EventData
                    If tmpInt = eveData.DateF Then
                        eveCnt += 1
                        If eveCnt = 1 Then tmpStr = eveData.EventName
                    End If
                Next

                '行事名称設定
                sprSheet_M.Sheets(0).SetText(M_EVENTLABEL_ROW, w_Col, fncGetEventDetailString(tmpStr, M_GYOJIMAXLETTER, IIf(eveCnt > 1, True, False)))
            Next w_Col

            '行事予定行集計背景色変更
            For sumCol As Integer = m_KeikakuKikan.PersonalStartCol To m_KeikakuKikan.PersonalEndCol
                sprPTotal.Sheets(0).Cells(M_EVENTLABEL_ROW, w_dataIdx).BackColor = Color.Silver
                w_dataIdx = w_dataIdx + 1
            Next sumCol

            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '1ヶ月/4週のみ4週用にも設定
                sprSheet_4W.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, -1, w_Style2)
                sprSheet_4W.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, 1, w_Style)
                'sprSheet_4W.Sheets(0).Models.Style.SetDirectInfo(M_EVENTLABEL_ROW, 2, w_Style) '2017/09/12 Yamanishi Del

                Call SetBorder(sprSheet_4W, M_EVENTLABEL_ROW, 1, M_EVENTLABEL_ROW, 2, 2, 2, 2, 2, 0, Color.Black)
                Call SetBorder(sprSheet_4W, M_EVENTLABEL_ROW, 2, M_EVENTLABEL_ROW, 2, 2, 2, 2, 2, 0, Color.Black)

                sprSheet_4W.Sheets(0).SetText(M_EVENTLABEL_ROW, 1, "行事予定")
                '2017/09/12 Yamanishi Upd --------------------------------------------------------------------------------------------------------
                'sprSheet_4W.Sheets(0).SetText(M_EVENTLABEL_ROW, 2, fncStringNewline("採用条件", 2))
                ''2014/07/10 Shimizu add start P-06980---
                'If m_strKinmuEmSecondFlg = "1" Then
                '    sprSheet_4W.Sheets(0).Cells(M_EVENTLABEL_ROW, M_EmpShrtNghtData_Col).HorizontalAlignment = CellHorizontalAlignment.Center
                'End If
                '---------------------------------------------------------------------------------------------------------------------------------
                sprSheet_4W.Sheets(0).SetText(M_EVENTLABEL_ROW, M_EmpShrtNghtData_Col, "　　　 採用条件")
                '2014/07/10 Shimizu add end P-06980---
                For idx As Integer = 0 To UBound(m_4WeekKikan)
                    w_dataIdx = 0
                    For w_Col = m_4WeekKikan(idx).KinmuDataStartCol To m_4WeekKikan(idx).KinmuDataEndCol
                        '日付取得
                        w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                        If String.IsNullOrEmpty(w_Var) Then Continue For
                        If Not Integer.TryParse(w_Var, tmpInt) Then Continue For
                        If Not IsDate(Format(tmpInt, "0000/00/00")) Then Continue For

                        '行事予定と日付が一致するかチェック
                        tmpStr = ""
                        eveCnt = 0
                        For Each eveData As EventList_Type In m_EventData
                            If tmpInt = eveData.DateF Then
                                eveCnt += 1
                                If eveCnt = 1 Then tmpStr = eveData.EventName
                            End If
                        Next

                        '行事名称設定
                        sprSheet_4W.Sheets(0).SetText(M_EVENTLABEL_ROW, w_Col, fncGetEventDetailString(tmpStr, M_GYOJIMAXLETTER, IIf(eveCnt > 1, True, False)))
                    Next

                    '行事予定行集計背景色変更
                    For sumCol As Integer = m_4WeekKikan(idx).PersonalStartCol To m_4WeekKikan(idx).PersonalEndCol
                        sprPTotal.Sheets(0).Cells(M_EVENTLABEL_ROW, w_dataIdx).BackColor = Color.Silver
                        w_dataIdx = w_dataIdx + 1
                    Next sumCol
                Next
            End If

            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    ''' <summary>
    ''' 行事予定対象者か判定
    ''' </summary>
    ''' <param name="p_mngid"></param>
    ''' <param name="p_date"></param>
    ''' <param name="p_kojoEve"></param>
    ''' <remarks></remarks>
    Private Sub chkEventTargetStaff(ByVal p_mngid As String, ByVal p_date As Integer, ByRef p_kojoEve() As EventList_Type)
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA chkEventTargetStaff"

        Dim idx As Integer = 0

        Try
            '行事予定から対象日の行事予定者かどうか判定
            For i As Integer = 1 To UBound(m_EventData)
                If p_date = m_EventData(i).DateF Then
                    '対象日→対象者か判定
                    For j As Integer = 1 To UBound(m_EventData(i).EventStaff)
                        If p_mngid = m_EventData(i).EventStaff(j).staffMngId Then
                            '配列拡張
                            idx += 1
                            ReDim Preserve p_kojoEve(idx)
                            p_kojoEve(idx) = General.paDeepCopy(m_EventData(i))
                            Exit For
                        End If
                    Next j
                End If
            Next i

            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    ''' <summary>
    ''' 文字列作成（行事予定明細用）
    ''' </summary>
    ''' <param name="p_strValue"></param>
    ''' <param name="p_maxLetter"></param>
    ''' <param name="p_eveFlg"></param>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Private Function fncGetEventDetailString(ByVal p_strValue As String, Optional ByVal p_maxLetter As Integer = M_GYOJIMAXLETTER, Optional ByVal p_eveFlg As Boolean = False) As String
        Dim w_strReturn As String = String.Empty
        Dim cutFlg As Boolean = False
        Dim w_tmpStr As String

        Try
            '全角化
            w_tmpStr = StrConv(p_strValue, VbStrConv.Wide)
            w_tmpStr = w_tmpStr.Replace("－", "―")

            '最大文字数以上は返却
            If p_maxLetter < w_tmpStr.Length Then
                w_strReturn = w_tmpStr.Substring(0, p_maxLetter) & "…"
            Else
                w_strReturn = w_tmpStr
                If p_eveFlg Then
                    w_strReturn = w_strReturn & " …"
                End If
            End If

        Catch ex As Exception
            Throw
        End Try
        Return w_strReturn
    End Function

    ''' <summary>
    ''' 文字列の編集
    ''' </summary>
    ''' <param name="p_strValue"></param>
    ''' <param name="p_Index"></param>
    ''' <param name="p_maxLetter"></param>
    ''' <param name="p_eveFlg"></param>
    ''' <returns></returns>
    ''' 引数　p_strValue　文字列　改行する文字列を設定
    ''' 編集する文字列を何byteで改行するかを設定　p_strValue
    ''' <remarks></remarks>
    Private Function fncStringNewline(ByVal p_strValue As String, ByVal p_Index As Integer, Optional ByVal p_maxLetter As Integer = 0, Optional ByVal p_eveFlg As Boolean = False) As String
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA fncStringNewline"

        Dim w_str As String
        Dim w_CutIndex As Integer
        Dim w_StartIndex As Integer
        Dim w_strReturn As String
        Dim w_lngMax As Integer
        Dim w_tmpStr As String

        Try
            '全角化
            w_tmpStr = StrConv(p_strValue, VbStrConv.Wide)

            '改行が必要か確認
            If General.paLenB(w_tmpStr) <= p_Index Then
                w_strReturn = w_tmpStr
                If p_eveFlg Then
                    '文字列がなくても複数件数ある場合は「…」
                    w_strReturn = w_strReturn & vbCrLf & "："
                End If
                Return w_strReturn
            End If

            w_StartIndex = 1
            w_strReturn = ""
            w_lngMax = Fix(General.paLenB(w_tmpStr) / p_Index)
            If General.paLenB(w_tmpStr) Mod p_Index >= p_Index - w_lngMax Then
                w_lngMax = w_lngMax + 1
            End If

            If p_maxLetter > 0 Then
                '最大文字数設定時、最大文字数は10文字
                If w_lngMax > M_GYOJIMAXLETTER Then
                    w_lngMax = M_GYOJIMAXLETTER
                End If
            End If

            For w_Index As Integer = 0 To w_lngMax - 1
                '改行処理を行うバイト数の設定
                w_CutIndex = p_Index

                w_str = General.paMidB(w_tmpStr, w_StartIndex, w_CutIndex)

                '不正な箇所で切り取っていないか確認
                If InStr(w_tmpStr, w_str) <= 0 Then
                    w_CutIndex = w_CutIndex - 1
                End If

                w_strReturn = w_strReturn & General.paMidB(w_tmpStr, w_StartIndex, w_CutIndex)

                '最後の列には改行を行わない
                If w_Index <> w_lngMax - 1 Then
                    w_strReturn = w_strReturn & vbCrLf
                End If

                w_StartIndex = w_StartIndex + w_CutIndex
            Next w_Index

            '残った文字列がある場合は改行込みで連結する
            If General.paMidB(w_tmpStr, w_StartIndex) <> "" Then
                If p_maxLetter > 0 Then
                    '最大文字数設定時は「…」
                    w_strReturn = w_strReturn & vbCrLf & "："
                Else
                    w_strReturn = w_strReturn & vbCrLf & General.paMidB(w_tmpStr, w_StartIndex)
                End If
            Else
                If p_eveFlg Then
                    '文字列がなくても複数件数ある場合は「…」
                    w_strReturn = w_strReturn & vbCrLf & "："
                End If
            End If

            General.g_ErrorProc = w_PreErrorProc
            Return w_strReturn
        Catch ex As Exception
            Throw
        End Try
    End Function

    ''' <summary>
    ''' 対象職員の夜勤専従・短時間者情報取得
    ''' </summary>
    ''' <param name="p_from">期間開始日</param>
    ''' <param name="p_to">期間終了日</param>
    ''' <remarks></remarks>
    Private Sub subGetNightShortData(ByVal p_from As Integer, ByVal p_to As Integer)
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA subGetNightShortData"

        Dim cnt As Integer

        Try
            With General.g_objIdoData
                For stfIdx As Integer = 1 To UBound(m_StaffData)
                    '初期化
                    ReDim m_StaffData(stfIdx).NightWork(0)
                    ReDim m_StaffData(stfIdx).ShortWork(0)

                    .pHospitalCD = General.g_strHospitalCD
                    .pStaffMngID = m_StaffData(stfIdx).ID
                    .pDateFlg = 1
                    .pDateFrom = p_from
                    .pDateTo = p_to
                    .pSortFlg = 0

                    '夜勤専従
                    If Not .mGetNightWorkerIdo Then
                    Else
                        cnt = .fNW_NightWorkerCount
                        ReDim m_StaffData(stfIdx).NightWork(cnt)
                        For i As Integer = 1 To cnt
                            .mNW_NightWorkerIdx = i
                            m_StaffData(stfIdx).NightWork(i).Date_from = .fNW_DateFrom
                            m_StaffData(stfIdx).NightWork(i).Date_to = .fNW_DateTo
                        Next
                    End If

                    '短時間制度
                    If Not .mGetShortTimeIdo Then
                    Else
                        cnt = .fST_ShortTimeCount
                        ReDim m_StaffData(stfIdx).ShortWork(cnt)
                        For i As Integer = 1 To cnt
                            .mST_ShortTimeIdx = i
                            m_StaffData(stfIdx).ShortWork(i).Date_from = .fST_DateFrom
                            m_StaffData(stfIdx).ShortWork(i).Date_to = .fST_DateTo
                            m_StaffData(stfIdx).ShortWork(i).ReasonCd = .fST_ReasonCd
                            m_StaffData(stfIdx).ShortWork(i).ReasonRNm = .fST_SecName
                        Next
                    End If
                Next
            End With
            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    ''' <summary>
    ''' 採用条件記号取得
    ''' </summary>
    ''' <param name="p_idx"></param>
    ''' <param name="p_from"></param>
    ''' <param name="p_to"></param>
    ''' <param name="p_dispMark"></param>
    ''' <param name="p_dispColor"></param>
    ''' <returns></returns>
    ''' <remarks>採用条件列に表示する記号とカラーを取得する</remarks>
    Private Function fncGetEmpMark(ByVal p_idx As Integer, ByVal p_from As Integer, ByVal p_to As Integer,
                                   ByRef p_dispMark As String, ByRef p_dispColor As Color) As Boolean
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA fncGetEmpMark"

        Const WC_DOUBLE As String = "両"
        Const WC_SHORT As String = "短"
        Const WC_NIGHT As String = "夜"

        Dim iloop As Integer
        Dim empCd As String = String.Empty
        Dim dispMark As String = String.Empty
        Dim dispColor As Color
        Dim nigFlg As Boolean = False '夜勤
        Dim shtFlg As Boolean = False '採用
        Dim loop_st1 As Integer
        Dim loop_st2 As Integer
        Dim loop_st3 As Integer
        Dim loop_ed1 As Integer
        Dim loop_ed2 As Integer
        Dim loop_ed3 As Integer
        Dim loop_step As Integer

        Try
            If m_dipsMarkChkKbn = 0 Then
                '期間前からチェック
                loop_st1 = 1
                loop_st2 = 1
                loop_st3 = 1
                loop_ed1 = UBound(m_StaffData(p_idx).SaiyoData)
                loop_ed2 = UBound(m_StaffData(p_idx).NightWork)
                loop_ed3 = UBound(m_StaffData(p_idx).ShortWork)
                loop_step = 1
            Else
                '期間後からチェック
                loop_st1 = UBound(m_StaffData(p_idx).SaiyoData)
                loop_st2 = UBound(m_StaffData(p_idx).NightWork)
                loop_st3 = UBound(m_StaffData(p_idx).ShortWork)
                loop_ed1 = 1
                loop_ed2 = 1
                loop_ed3 = 1
                loop_step = -1
            End If

            '採用条件判定
            For iloop = loop_st1 To loop_ed1 Step loop_step
                If m_StaffData(p_idx).SaiyoData(iloop).SaiyoDate <= p_to AndAlso p_from <= m_StaffData(p_idx).SaiyoData(iloop).TentaiDate Then
                    '期間に該当すれば採用条件取得
                    empCd = m_StaffData(p_idx).SaiyoData(iloop).SaiyoCD
                    Exit For
                End If
            Next
            '表示対象に該当するかどうか判定
            For iloop = 1 To UBound(m_DispEmpMark)
                If InStr(m_DispEmpMark(iloop).EmpCd, General.paFormatSpace(empCd, 5)) > 0 AndAlso Not String.IsNullOrEmpty(empCd) Then
                    '該当すれば黄緑
                    dispMark = m_DispEmpMark(iloop).Mark
                    dispColor = Color.GreenYellow
                    Exit For
                End If
            Next

            '夜勤専従者かどうか判定
            For iloop = loop_st2 To loop_ed2 Step loop_step
                If m_StaffData(p_idx).NightWork(iloop).Date_from <= p_to AndAlso p_from <= m_StaffData(p_idx).NightWork(iloop).Date_to Then
                    '期間に該当すれば採用条件取得
                    nigFlg = True
                    Exit For
                End If
            Next

            '短時間制度取得者かどうか判定
            For iloop = loop_st3 To loop_ed3 Step loop_step
                If m_StaffData(p_idx).ShortWork(iloop).Date_from <= p_to AndAlso p_from <= m_StaffData(p_idx).ShortWork(iloop).Date_to Then
                    '期間に該当すれば採用条件取得
                    shtFlg = True
                    Exit For
                End If
            Next

            '表示文字、色決定
            If nigFlg AndAlso shtFlg Then
                '夜勤専従 and 短時間制度取得
                dispMark = WC_DOUBLE
                dispColor = Color.SkyBlue

            ElseIf nigFlg Then
                '夜勤専従
                dispMark = WC_NIGHT
                dispColor = Color.MediumPurple

            ElseIf shtFlg Then
                '短時間制度取得
                dispMark = WC_SHORT
                dispColor = Color.Orange

            End If

            '記号未取得は何もしない
            If String.IsNullOrEmpty(dispMark) Then Return False

            p_dispMark = dispMark
            p_dispColor = dispColor

            General.g_ErrorProc = w_PreErrorProc
            Return True
        Catch ex As Exception
            Throw
        End Try
    End Function

    ''' <summary>
    ''' 採用条件ツールチップ生成
    ''' </summary>
    ''' <param name="p_row"></param>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Private Function fncGetTxtEmpData(ByVal p_row As Integer) As String
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA fncGetEmpMark"

        Const WC_SHRT As String = "短時間"
        Const WC_NGHT As String = "夜勤専従"

        Dim rtnTxt As String = String.Empty
        Dim var As Object
        Dim stfIdx As Integer
        Dim w_from As Integer
        Dim w_to As Integer
        Dim w_i As Integer
        Dim tmpEmpCd As String
        Dim secName As String
        Dim Date_st As Integer
        Dim Date_ed As Integer
        Dim diffFlg As Boolean
        Dim empData() As MtrxType
        Dim empIdx As Short
        Dim activeRow As Integer = p_row

        Try
            '職員ｲﾝﾃﾞｯｸｽ取得
            If m_SelViewKikan = 0 Then
                '現在選択されている行を取得
                If activeRow = 0 Then activeRow = sprSheet_M.Sheets(0).ActiveRow.Index

                var = sprSheet_M.Sheets(0).GetText(activeRow, m_StaffZokusei(M_HairetuNo).SetCol_M)
                stfIdx = Integer.Parse(Convert.ToString(var))

                '期間
                w_from = m_KeikakuKikan.StartDate
                w_to = m_KeikakuKikan.EndDate
            Else
                '現在選択されている行を取得
                If activeRow = 0 Then activeRow = sprSheet_4W.Sheets(0).ActiveRow.Index

                var = sprSheet_4W.Sheets(0).GetText(activeRow, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                stfIdx = Integer.Parse(Convert.ToString(var))

                '期間
                w_from = m_4WeekKikan(m_SelViewKikan).StartDate
                w_to = m_4WeekKikan(m_SelViewKikan).EndDate
            End If

            '--採用条件
            tmpEmpCd = ""
            ReDim empData(0)
            For w_i = 1 To UBound(m_StaffData(stfIdx).SaiyoData)
                If m_StaffData(stfIdx).SaiyoData(w_i).SaiyoDate <= w_to AndAlso w_from <= m_StaffData(stfIdx).SaiyoData(w_i).TentaiDate Then
                    '期間に該当すれば採用条件取得
                    tmpEmpCd = m_StaffData(stfIdx).SaiyoData(w_i).SaiyoCD
                    secName = m_StaffData(stfIdx).SaiyoData(w_i).strSecName
                    Date_st = m_StaffData(stfIdx).SaiyoData(w_i).SaiyoDate
                    Date_ed = m_StaffData(stfIdx).SaiyoData(w_i).TentaiDate

                    '表示対象採用かチェック
                    diffFlg = False
                    For l As Short = 1 To UBound(m_DispEmpMark)
                        If InStr(m_DispEmpMark(l).EmpCd, General.paFormatSpace(tmpEmpCd, 5)) > 0 AndAlso Not String.IsNullOrEmpty(tmpEmpCd) Then
                            diffFlg = True
                            Exit For
                        End If
                    Next
                    If Not diffFlg Then Continue For

                    '既に取得済みかどうか判定
                    diffFlg = True
                    For l As Short = 1 To UBound(empData)
                        If empData(l).BunruiCD = tmpEmpCd Then
                            diffFlg = False
                            empIdx = l
                        End If
                    Next

                    If diffFlg Then
                        '未取得時
                        ReDim Preserve empData(UBound(empData) + 1)
                        empData(UBound(empData)).BunruiCD = tmpEmpCd
                        empData(UBound(empData)).MtrxName = secName
                        empData(UBound(empData)).CalcKinmuStr = General.paGetDateStringFromInteger(Date_st) _
                                                                & "～" & General.paGetDateStringFromInteger(Date_ed)
                    Else
                        '取得時
                        empData(empIdx).CalcKinmuStr = empData(empIdx).CalcKinmuStr & ", " & General.paGetDateStringFromInteger(Date_st) _
                                                       & "～" & General.paGetDateStringFromInteger(Date_ed)
                    End If
                End If
            Next

            '表示文字列編集
            For w_i = 1 To UBound(empData)
                rtnTxt = rtnTxt & fncFmtTipTxt(empData(w_i).MtrxName) & empData(w_i).CalcKinmuStr
                rtnTxt = rtnTxt & vbCrLf
            Next

            '--夜勤専従
            diffFlg = False
            For w_i = 1 To UBound(m_StaffData(stfIdx).NightWork)
                If m_StaffData(stfIdx).NightWork(w_i).Date_from <= w_to AndAlso w_from <= m_StaffData(stfIdx).NightWork(w_i).Date_to Then
                    If Not diffFlg Then
                        '初回
                        rtnTxt = rtnTxt & fncFmtTipTxt(WC_NGHT) & General.paGetDateStringFromInteger(m_StaffData(stfIdx).NightWork(w_i).Date_from) _
                                 & "～" & General.paGetDateStringFromInteger(m_StaffData(stfIdx).NightWork(w_i).Date_to)
                        diffFlg = True
                    Else
                        '2回目以降
                        rtnTxt = rtnTxt & ", " & General.paGetDateStringFromInteger(m_StaffData(stfIdx).NightWork(w_i).Date_from) _
                                 & "～" & General.paGetDateStringFromInteger(m_StaffData(stfIdx).NightWork(w_i).Date_to)
                    End If
                End If

                If w_i = UBound(m_StaffData(stfIdx).NightWork) AndAlso diffFlg Then
                    '最後に改行
                    rtnTxt = rtnTxt & vbCrLf
                End If
            Next

            '--短時間
            diffFlg = False
            For w_i = 1 To UBound(m_StaffData(stfIdx).ShortWork)
                If m_StaffData(stfIdx).ShortWork(w_i).Date_from <= w_to AndAlso w_from <= m_StaffData(stfIdx).ShortWork(w_i).Date_to Then
                    If Not diffFlg Then
                        '初回
                        rtnTxt = rtnTxt & fncFmtTipTxt(WC_SHRT) & General.paGetDateStringFromInteger(m_StaffData(stfIdx).ShortWork(w_i).Date_from) _
                                 & "～" & General.paGetDateStringFromInteger(m_StaffData(stfIdx).ShortWork(w_i).Date_to)
                        diffFlg = True
                    Else
                        '2回目以降
                        rtnTxt = rtnTxt & ", " & General.paGetDateStringFromInteger(m_StaffData(stfIdx).ShortWork(w_i).Date_from) _
                                 & "～" & General.paGetDateStringFromInteger(m_StaffData(stfIdx).ShortWork(w_i).Date_to)
                    End If
                End If

                If w_i = UBound(m_StaffData(stfIdx).NightWork) AndAlso diffFlg Then
                    '最後に改行
                    rtnTxt = rtnTxt & vbCrLf
                End If
            Next

            If Not String.IsNullOrEmpty(rtnTxt) Then
                '最後の改行を省く
                rtnTxt = rtnTxt.TrimEnd()
                rtnTxt = rtnTxt.Replace("0000/00/00", "9999/99/99")
            End If

            General.g_ErrorProc = w_PreErrorProc
            Return rtnTxt
        Catch ex As Exception
            Throw
        End Try
    End Function

    ''' <summary>
    ''' ツールチップテキスト編集
    ''' </summary>
    ''' <param name="stTarget"></param>
    ''' <returns></returns>
    ''' <remarks></remarks>
    Public Function fncFmtTipTxt(ByVal stTarget As String) As String
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA fncFmtTipTxt"

        Dim MAX As Integer = 12
        Dim size As Integer
        Dim difSize As Integer
        Dim rtnStr As String

        Try
            'バイト数を求める
            size = System.Text.Encoding.GetEncoding("Shift_JIS").GetByteCount(stTarget)
            difSize = MAX - size
            If difSize <= 0 Then
                rtnStr = stTarget
            Else
                rtnStr = stTarget & Space(difSize)
            End If

            General.g_ErrorProc = w_PreErrorProc
            Return rtnStr
        Catch ex As Exception
            Throw
        End Try
    End Function

    ''' <summary>
    ''' スプレッドデフォルトキー無効化
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub subChgSpreadKeyMap()
        Dim w_PreErrorProc As String = General.g_ErrorProc
        General.g_ErrorProc = "NSC0000HA subChgSpreadKeyMap"

        Dim im_m As New FarPoint.Win.Spread.InputMap
        Dim im_4w As New FarPoint.Win.Spread.InputMap

        Try
            'デフォルトで設定されているF2、F3、F4をとりあえず無効化
            '「F2」：編集モードが有効になっている場合は、アクティブセル内の値を消去
            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F2, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F2, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F2, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F2, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            '「F3」：編集モードが有効になっている場合は、日付時刻型セルに現在の日時を入力
            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F3, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F3, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F3, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F3, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            '「F4」：日付時刻型セルで編集モードが有効になっている場合は、日付を選択するためのポップアップカレンダーをスプレッドシートに表示
            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F4, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F4, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            im_m = sprSheet_M.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_4w = sprSheet_4W.GetInputMap(FarPoint.Win.Spread.InputMapMode.WhenAncestorOfFocused)
            im_m.Put(New FarPoint.Win.Spread.Keystroke(Keys.F4, Keys.None), FarPoint.Win.Spread.SpreadActions.None)
            im_4w.Put(New FarPoint.Win.Spread.Keystroke(Keys.F4, Keys.None), FarPoint.Win.Spread.SpreadActions.None)

            General.g_ErrorProc = w_PreErrorProc
        Catch ex As Exception
            Throw
        End Try
    End Sub

    '勤務開始,終了時間を返却する
    Private Sub GetKinmuFromToTime(
            ByVal p_StaffIdx As Integer,
            ByVal p_KinmuCD As String,
            ByVal p_Date As Integer,
            ByRef p_StTime As Integer,
            ByRef p_EdTime As Integer)
        Const W_SUBNAME As String = "NSK0000HA GetKinmuFromToTime"

        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
        'Dim w_SaiyoCD As String = String.Empty
        'Dim w_lngSaiyoLoop As Integer
        'Dim w_CheckSaiyoCD() As String
        'Dim w_lngSaiyoCnt As Integer
        'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
        Try
            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------
            'p_StTime = 0
            'p_EdTime = 0

            'For i As Integer = 1 To UBound(m_StaffData(p_StaffIdx).SaiyoData)
            '    If m_StaffData(p_StaffIdx).SaiyoData(i).SaiyoDate <= p_Date AndAlso m_StaffData(p_StaffIdx).SaiyoData(i).TentaiDate >= p_Date Then
            '        w_SaiyoCD = m_StaffData(p_StaffIdx).SaiyoData(i).SaiyoCD
            '        Exit For
            '    End If
            'Next

            'If Not String.IsNullOrEmpty(w_SaiyoCD) Then
            '    ReDim w_CheckSaiyoCD(2)
            '    '勤務時間取得の優先順位を決定
            '    '*** 採用CDを第一優先
            '    w_CheckSaiyoCD(1) = w_SaiyoCD
            '    '*** 共通を第二優先
            '    w_CheckSaiyoCD(2) = "00000"

            '    w_lngSaiyoCnt = 0
            '    For w_lngSaiyoLoop = 1 To UBound(w_CheckSaiyoCD)
            '        If Not String.IsNullOrEmpty(m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoLoop) & p_KinmuCD & "A")) Then
            '            w_lngSaiyoCnt = w_lngSaiyoLoop
            '            Exit For
            '        End If
            '    Next w_lngSaiyoLoop

            '    If w_lngSaiyoCnt <> 0 Then
            '        p_StTime = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "E")
            '        p_EdTime = m_objGetTimeM.Item(w_CheckSaiyoCD(w_lngSaiyoCnt) & p_KinmuCD & "F")
            '    End If
            'End If

            p_StTime = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.FirstFromTime)
            p_EdTime = GetKinmuTime(p_KinmuCD, p_StaffIdx, p_Date, gKinmuTimeMCol.SecToTime)
            'PKGバグ:勤務時間取得時に勤務部署を参照しないのを修正----------------------------------------

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub sprSheet_M_Paint(ByVal sender As Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles sprSheet_M.Paint
        Dim rowLoop As Integer
        Dim colLoop As Integer
        Dim weekDayStr As String

        Try
            With sprSheet_M.Sheets(0)
                For colLoop = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    weekDayStr = .GetText(M_WeekLabel_Row, colLoop)

                    If (m_WeekEndColorFlg = "1" AndAlso (weekDayStr = "土" OrElse weekDayStr = "日")) OrElse
                            (m_HolidayColorFlg = "1" AndAlso (weekDayStr = "祝" OrElse weekDayStr = "休")) Then
                        For rowLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If .Cells(rowLoop, colLoop).BackColor.A = 0 Then
                                .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back)
                            ElseIf .Cells(rowLoop, colLoop).BackColor = Color.White Then
                                .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back)
                            End If
                        Next
                    Else
                        For rowLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back) Then
                                .Cells(rowLoop, colLoop).BackColor = Color.White
                            End If
                        Next
                    End If
                Next
            End With
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), "")
            End
        End Try
    End Sub

    Private Sub sprSheet_4W_Paint(ByVal sender As Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles sprSheet_4W.Paint
        Dim rowLoop As Integer
        Dim colLoop As Integer
        Dim weekDayStr As String

        Try
            With sprSheet_4W.Sheets(0)
                For colLoop = m_4WeekKikan(m_SelViewKikan).KinmuDataStartCol To m_4WeekKikan(m_SelViewKikan).KinmuDataEndCol
                    weekDayStr = .GetText(M_WeekLabel_Row, colLoop)

                    If (m_WeekEndColorFlg = "1" AndAlso (weekDayStr = "土" OrElse weekDayStr = "日")) OrElse
                            (m_HolidayColorFlg = "1" AndAlso (weekDayStr = "祝" OrElse weekDayStr = "休")) Then
                        For rowLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If .Cells(rowLoop, colLoop).BackColor.A = 0 Then
                                .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back)
                            ElseIf .Cells(rowLoop, colLoop).BackColor = Color.White Then
                                .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back)
                            End If
                        Next
                    Else
                        For rowLoop = m_StaffRow.StartRow To m_StaffRow.EndRow
                            If .Cells(rowLoop, colLoop).BackColor = ColorTranslator.FromOle(m_WeekEnd_Back) Then
                                .Cells(rowLoop, colLoop).BackColor = Color.White
                            End If
                        Next
                    End If
                Next
            End With
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), "")
            End
        End Try
    End Sub

    '指定された職員の対象SEQの勤務累計回数を取得する
    Private Sub GetSumCntData(ByVal p_StaffIdx As Integer, ByVal p_Seq As Integer)
        Const W_SUBNAME As String = "NSK0000HA GetSumCntData"

        Dim w_OneDayKinmuCD As String
        Dim w_HalfDayKinmuCD As String
        Dim w_VarKinmuCD As Object
        Dim w_StDate As Integer
        Dim w_EdDate As Integer
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset

        Try
            w_OneDayKinmuCD = ""
            w_HalfDayKinmuCD = ""

            If m_SelViewKikan = 0 Then
                m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).Cnt = 0
                m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).GetFlg = True

                w_VarKinmuCD = General.paSplit(m_HMtrx(p_Seq).CalcKinmuStr, ",")
                For i As Integer = 1 To UBound(m_HMtrx(p_Seq).Ratio)
                    If m_HMtrx(p_Seq).Ratio(i) = 1 Then
                        If String.IsNullOrEmpty(w_OneDayKinmuCD) Then
                            w_OneDayKinmuCD = "'" & w_VarKinmuCD(i - 1) & "'"
                        Else
                            w_OneDayKinmuCD = w_OneDayKinmuCD & ", '" & w_VarKinmuCD(i - 1) & "'"
                        End If
                    Else
                        If String.IsNullOrEmpty(w_HalfDayKinmuCD) Then
                            w_HalfDayKinmuCD = "'" & w_VarKinmuCD(i - 1) & "'"
                        Else
                            w_HalfDayKinmuCD = w_HalfDayKinmuCD & ", '" & w_VarKinmuCD(i - 1) & "'"
                        End If
                    End If
                Next

                If General.paRight(m_KeikakuKikan.StartDate, 4) = m_SumStMMdd Then
                    Exit Sub
                End If

                w_StDate = (m_KeikakuKikan.StartDate \ 10000) & m_SumStMMdd
                w_EdDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                If w_StDate > w_EdDate Then
                    w_StDate = w_StDate - 10000
                End If
            Else
                m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).Cnt = 0
                m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).GetFlg = True

                w_VarKinmuCD = General.paSplit(m_HMtrx_4Week(p_Seq).CalcKinmuStr, ",")
                For i As Integer = 1 To UBound(m_HMtrx_4Week(p_Seq).Ratio)
                    If m_HMtrx_4Week(p_Seq).Ratio(i) = 1 Then
                        If String.IsNullOrEmpty(w_OneDayKinmuCD) Then
                            w_OneDayKinmuCD = "'" & w_VarKinmuCD(i - 1) & "'"
                        Else
                            w_OneDayKinmuCD = w_OneDayKinmuCD & ", '" & w_VarKinmuCD(i - 1) & "'"
                        End If
                    Else
                        If String.IsNullOrEmpty(w_HalfDayKinmuCD) Then
                            w_HalfDayKinmuCD = "'" & w_VarKinmuCD(i - 1) & "'"
                        Else
                            w_HalfDayKinmuCD = w_HalfDayKinmuCD & ", '" & w_VarKinmuCD(i - 1) & "'"
                        End If
                    End If
                Next

                If General.paRight(m_4WeekKikan(m_SelViewKikan).StartDate, 4) = m_SumStMMdd Then
                    Exit Sub
                End If

                w_StDate = (m_4WeekKikan(m_SelViewKikan).StartDate \ 10000) & m_SumStMMdd
                w_EdDate = Format(Date.Parse(Format(m_4WeekKikan(m_SelViewKikan).StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                If w_StDate > w_EdDate Then
                    w_StDate = w_StDate - 10000
                End If
                If w_EdDate >= m_KeikakuKikan.StartDate Then
                    w_EdDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                End If
            End If

            '2015/04/28 Ishiga add start------------
            '設定がない場合"000"を固定でセットする
            If w_OneDayKinmuCD = "" Then
                w_OneDayKinmuCD = "'000'"
            End If
            If w_HalfDayKinmuCD = "" Then
                w_HalfDayKinmuCD = "'000'"
            End If

            'richard update start
            'w_Sql = ""
            'w_Sql = w_Sql & "SELECT ( "
            'w_Sql = w_Sql & "	SELECT COUNT(*) "
            'w_Sql = w_Sql & "	FROM NS_KINMURESULT_F "
            'w_Sql = w_Sql & "	WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "		AND DATEF >= " & w_StDate & " "
            'w_Sql = w_Sql & "		AND DATEF <= " & w_EdDate & " "
            'w_Sql = w_Sql & "		AND STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
            'w_Sql = w_Sql & "		AND KINMUCD IN (" & w_OneDayKinmuCD & ") "
            'w_Sql = w_Sql & ") + ( "
            'w_Sql = w_Sql & "	SELECT COUNT(*) "
            'w_Sql = w_Sql & "	FROM NS_KINMURESULT_F "
            'w_Sql = w_Sql & "	WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "		AND DATEF >= " & w_StDate & " "
            'w_Sql = w_Sql & "		AND DATEF <= " & w_EdDate & " "
            'w_Sql = w_Sql & "		AND STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
            'w_Sql = w_Sql & "		AND KINMUCD IN (" & w_HalfDayKinmuCD & ") "
            'w_Sql = w_Sql & ") * 0.5 "
            ''2014/07/03 Ishiga upd start-------------------------------------------------------------
            ''w_Sql = w_Sql & "FROM DUAL "

            ''パッケージ情報
            'If General.g_InstallType = General.BasGeneral.gInstall_Enum.AccessType_SQL Then
            '    'ｲﾝｽﾄｰﾙﾀｲﾌﾟ(SQLServer)
            'Else
            '    'ｲﾝｽﾄｰﾙﾀｲﾌﾟ(Access,Oracle)
            '    w_Sql = w_Sql & "FROM DUAL "
            'End If
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            '<46>
            Call NSK0000H_sql.select_NS_KINMURESULT_F_01(w_Rs, w_StDate, w_EdDate, m_StaffData, p_StaffIdx, w_OneDayKinmuCD, w_HalfDayKinmuCD)
            'richard update end

            If w_Rs.RecordCount > 0 Then
                If m_SelViewKikan = 0 Then
                    m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).Cnt = w_Rs.Fields(0).Value
                    m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).GetFlg = True
                Else
                    m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).Cnt = w_Rs.Fields(0).Value
                    m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).GetFlg = True
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '指定された職員の対象SEQの勤務累計回数を取得する
    Private Sub GetSumHolTimeData(ByVal p_StaffIdx As Integer, ByVal p_Seq As Integer)
        Const W_SUBNAME As String = "NSK0000HA GetSumHolTimeData"

        Dim w_StDate As Integer
        Dim w_EdDate As Integer
        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_HolTimeCD As String

        Try
            w_HolTimeCD = ""

            If m_SelViewKikan = 0 Then
                m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).Cnt = 0
                m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).GetFlg = True

                For i As Integer = 1 To UBound(m_SumHolTimeData)
                    If m_SumHolTimeData(i).SEQ = p_Seq Then
                        w_HolTimeCD = m_SumHolTimeData(i).CD
                        Exit For
                    End If
                Next

                If General.paRight(m_KeikakuKikan.StartDate, 4) = m_SumStMMdd Then
                    Exit Sub
                End If

                w_StDate = (m_KeikakuKikan.StartDate \ 10000) & m_SumStMMdd
                w_EdDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                If w_StDate > w_EdDate Then
                    w_StDate = w_StDate - 10000
                End If
            Else
                m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).Cnt = 0
                m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).GetFlg = True

                For i As Integer = 1 To UBound(m_SumHolTimeData_4W)
                    If m_SumHolTimeData_4W(i).SEQ = p_Seq Then
                        w_HolTimeCD = m_SumHolTimeData_4W(i).CD
                        Exit For
                    End If
                Next

                If General.paRight(m_4WeekKikan(m_SelViewKikan).StartDate, 4) = m_SumStMMdd Then
                    Exit Sub
                End If

                w_StDate = (m_4WeekKikan(m_SelViewKikan).StartDate \ 10000) & m_SumStMMdd
                w_EdDate = Format(Date.Parse(Format(m_4WeekKikan(m_SelViewKikan).StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                If w_StDate > w_EdDate Then
                    w_StDate = w_StDate - 10000
                End If
            End If
            'richard update start
            'w_Sql = ""
            'w_Sql = w_Sql & "SELECT SUM(NENKYUTIME) "
            'w_Sql = w_Sql & "FROM NS_NENKYU_F "
            'w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            'w_Sql = w_Sql & "	AND STAFFMNGID = '" & m_StaffData(p_StaffIdx).ID & "' "
            'w_Sql = w_Sql & "	AND DATEF >= " & w_StDate & " "
            'w_Sql = w_Sql & "	AND DATEF <= " & w_EdDate & " "
            'w_Sql = w_Sql & "	AND GETCONTENTSKBN = '4' "
            'w_Sql = w_Sql & "	AND HOLIDAYBUNRUICD = '" & w_HolTimeCD & "' "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_NENKYU_F_02(w_Rs, m_StaffData, p_StaffIdx, w_StDate, w_EdDate, w_HolTimeCD) '<16>
            'richard update end

            If w_Rs.RecordCount > 0 Then
                If m_SelViewKikan = 0 Then
                    m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).Cnt = General.paGetDbFieldVal(w_Rs.Fields(0), 0)
                    m_StaffData(p_StaffIdx).SumCntData.SumSeq(p_Seq).GetFlg = True
                Else
                    m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).Cnt = General.paGetDbFieldVal(w_Rs.Fields(0), 0)
                    m_StaffData(p_StaffIdx).SumCntData_4W(m_SelViewKikan).SumSeq(p_Seq).GetFlg = True
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub


    ''' <summary>
    ''' スプレッドの縦書き設定クラス
    ''' </summary>
    ''' <remarks></remarks>
    Private Class VerticalTextCell
        Inherits FarPoint.Win.Spread.CellType.TextCellType

        Public Overrides Sub PaintCell(ByVal g As System.Drawing.Graphics, ByVal r As System.Drawing.Rectangle, ByVal appearance As FarPoint.Win.Spread.Appearance,
                                       ByVal value As Object, ByVal isSelected As Boolean, ByVal isLocked As Boolean, ByVal zoomFactor As Single)
            Dim backColorBrush As Brush = New SolidBrush(appearance.BackColor)
            Dim foreColorBrush As Brush = New SolidBrush(appearance.ForeColor)
            Dim s As New StringFormat
            '2014/07/14 Shimizu upd start P-06980----
            's.FormatFlags = StringFormatFlags.DirectionVertical
            s.FormatFlags = StringFormatFlags.NoWrap & StringFormatFlags.DirectionVertical
            '2014/07/14 Shimizu upd end P-06980----

            '2014/07/11 Shimizu add start P-06980----
            s.LineAlignment = StringAlignment.Center
            '2014/07/11 Shimizu add end P-06980----
            g.FillRectangle(backColorBrush, r)

            '2014/07/11 Shimizu upd start P-06980----
            'g.DrawString(CStr(value), appearance.Font, foreColorBrush, New RectangleF(r.X, r.Y, r.Width, r.Height), s)
            g.DrawString(CStr(value), appearance.Font, foreColorBrush, New RectangleF(r.X - 2, r.Y, r.Width, r.Height), s)
            '2014/07/11 Shimizu upd end P-06980----            backColorBrush.Dispose()
            foreColorBrush.Dispose()
        End Sub
    End Class
    '2014/05/14 Shimpo  add start P-06991-----------------------------------------------------------------------
    '指定した日付の希望勤務数をカウント（個別勤務計画作成での日付別希望勤務数の判定に使用）
    Public Function Get_HopeNum_Of_Date(ByVal w_YYYYMMDD As Integer) As Integer
        Dim w_IntCol As Integer
        Dim w_IntRow As Integer
        Dim w_Kibou_Cnt As Integer

        w_Kibou_Cnt = 0

        For w_IntCol = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
            If w_YYYYMMDD = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_IntCol) Then
                For w_IntRow = M_KinmuDataStart_Row To m_StaffRow.EndRow
                    If (w_IntRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        If ColorTranslator.ToOle(sprSheet_M.Sheets(0).Cells(w_IntRow, w_IntCol).BackColor) = m_Kibou_Back Then
                            w_Kibou_Cnt = w_Kibou_Cnt + 1
                        End If
                    End If
                Next w_IntRow
            End If
        Next w_IntCol

        Return w_Kibou_Cnt
    End Function
    '2014/05/14 Shimpo add end P-06991-------------------------------------------------------------------------
    '2014/06/03 Shimizu add start P-06980----
    Private Sub RunTimeTable()
        Const W_SUBNAME As String = "NSK0000HA RunTimeTable"

        Dim w_kojoEve() As EventList_Type
        Dim w_regAppliKbn As String
        Dim w_appliKbn As String
        Dim w_NewIndex As Integer

        Dim w_Var As String
        Dim w_Var2 As String
        'Dim w_VarPlan As String
        'Dim w_RowPlan As Integer
        Dim w_OldKinmuCD As String = String.Empty
        Dim w_OldRiyuKBN As String = String.Empty
        Dim w_OldKangoCD As String = String.Empty
        '2014/07/08 Shimizu add start P-06980----
        '部署異動、配属期間内か ?
        Dim w_IntervalFlg As Boolean = False
        '2014/07/08 Shimizu add end P-06980----
        Dim w_KinmuCD As String = String.Empty
        Dim w_RiyuKBN As String = String.Empty
        Dim w_RiyuKBN2 As String = String.Empty
        Dim w_KakuteiFlg As String = String.Empty
        Dim w_KangoCD As String = String.Empty
        Dim w_Time As String = String.Empty
        Dim w_Col As Integer
        Dim w_OtherCol As Integer
        Dim w_TargetCol As Integer
        Dim w_OtherTargetCol As Integer
        Dim w_TargetDay As Integer
        Dim w_LoopRow As Integer
        Dim w_DataRow As Integer
        Dim w_LoopCol As Integer
        Dim w_LoopKikan As Integer
        Dim w_Loop As Integer
        Dim w_Loop2 As Integer
        Dim w_StaffID As String
        Dim w_StaffName As String
        'Dim w_clsObj As Object
        Dim w_clsObj As NsAid_NSK0070H.clsNSK0070H '2018/03/12 Yamanishi Upd
        Dim w_Date As Integer
        Dim w_SaiyoCD As String
        Dim w_Targetdate As String = String.Empty
        Dim w_blnFLG As Boolean
        Dim w_StaffPreID As String
        Dim w_StartCol() As Integer
        Dim w_StartCol2 As Integer
        Dim w_EndCol() As Integer
        Dim w_StaffIdx As Integer
        Dim w_DaikyuStaffIdx As Integer
        Dim w_KojyoIndex As Integer
        Dim w_RecCnt As Integer
        '2018/03/12 Yamanishi Upd -------------------------------------------
        'Dim w_Pos As Integer
        'Dim w_BunruiCD As String
        'Dim w_StartTime As String
        'Dim w_EndTime As String
        'Dim w_KBN As String
        'Dim w_NenkyuTime As String
        'Dim w_HolSubFlg As String
        'Dim w_DayTime As String
        'Dim w_NightTime As String
        'Dim w_NextNightTime As String
        Dim w_strTime As String = String.Empty
        Dim w_BunruiCD As String = String.Empty 'HolidayBunruiCD
        Dim w_StartTime As Integer 'FromTime
        Dim w_EndTime As Integer 'ToTime
        Dim w_KBN As String = String.Empty 'DateKbn
        Dim w_NenkyuTime As Integer '時間年休
        Dim w_HolSubFlg As String = String.Empty '休憩減算フラグ
        Dim w_DayTime As Integer '日勤時間
        Dim w_NightTime As Integer '夜勤時間
        Dim w_NextNightTime As Integer '翌日夜勤時間
        '--------------------------------------------------------------------
        Dim w_BackColor As Color
        Dim w_IntBackColor As Integer
        Dim w_IntForeColor As Integer
        Dim w_startBeforDay As Integer
        Dim w_OuenStaffFlg As Boolean
        Dim w_strMsg() As String '2015/04/15 Bando Add
        Dim w_MsgRc As Integer
        '2015/07/24 Bando Add Start ===============================
        Dim w_Comment As String = String.Empty
        Dim w_OldComment As String = String.Empty
        '2015/07/24 Bando Add End   ===============================
        '2017/12/04 Bando Add -------------------------------------------------------
        Dim withMode As Object '１カ月モードか４週８休モードかを指定
        '-------------------------------------------------------
        Try

            '4Wのシートのほうが情報量が多いため必ず4Wのシートより情報を取得し
            '4W、Mの順でデータを設定していく
            '作業シート取得
            'ReDim w_StartCol(UBound(m_4WeekKikan))
            'ReDim w_EndCol(UBound(m_4WeekKikan))
            'For w_LoopKikan = 1 To UBound(m_4WeekKikan)
            '    w_StartCol(w_LoopKikan) = m_4WeekKikan(w_LoopKikan).KinmuDataStartCol
            '    w_EndCol(w_LoopKikan) = m_4WeekKikan(w_LoopKikan).KinmuDataEndCol
            'Next w_LoopKikan
            'w_TargetCol = m_StaffZokusei(M_HairetuNo).SetCol_4W
            'w_OtherTargetCol = m_StaffZokusei(M_HairetuNo).SetCol_M

            '2017/12/04 Bando Upd Start -----------------
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                '4週／1ヶ月の場合

                ReDim w_StartCol(UBound(m_4WeekKikan))
                ReDim w_EndCol(UBound(m_4WeekKikan))
                For w_LoopKikan = 1 To UBound(m_4WeekKikan)
                    w_StartCol(w_LoopKikan) = m_4WeekKikan(w_LoopKikan).KinmuDataStartCol
                    w_EndCol(w_LoopKikan) = m_4WeekKikan(w_LoopKikan).KinmuDataEndCol
                Next w_LoopKikan

                w_TargetCol = m_StaffZokusei(M_HairetuNo).SetCol_4W
                w_OtherTargetCol = m_StaffZokusei(M_HairetuNo).SetCol_M
                withMode = sprSheet_4W.Sheets(0)
            Else
                '4週／4週、1ヶ月／1ヶ月の場合
                ReDim w_StartCol(1)
                ReDim w_EndCol(1)
                w_StartCol(1) = m_KeikakuKikan.KinmuDataStartCol
                w_EndCol(1) = m_KeikakuKikan.KinmuDataEndCol

                w_TargetCol = m_StaffZokusei(M_HairetuNo).SetCol_M
                w_OtherTargetCol = m_StaffZokusei(M_HairetuNo).SetCol_M
                withMode = sprSheet_M.Sheets(0)
            End If
            '2017/12/04 Bando Upd End   -----------------


            w_startBeforDay = Integer.Parse(Format(DateAdd(DateInterval.Day, -1, Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00"))), "yyyyMMdd"))

            '2017/12/04 Bando Upd Start --------------
            'With sprSheet_4W.Sheets(0)
            With withMode
                '2017/12/04 Bando Upd End   --------------

                '対象年月日
                If m_SelViewKikan = 0 Then
                    w_Col = sprSheet_M.Sheets(0).ActiveColumnIndex
                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                Else
                    w_Col = sprSheet_4W.Sheets(0).ActiveColumnIndex
                    w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                End If

                w_TargetDay = 0
                If w_Var <> "" Then
                    w_TargetDay = Integer.Parse(w_Var)
                End If

                '計画ﾃﾞｰﾀ範囲内か ?
                If Not ((w_TargetDay >= m_KeikakuKikan.StartDate) AndAlso (w_TargetDay <= m_KeikakuKikan.EndDate)) Then
                    '2015/04/15 Bando Add Start ===========================
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "日付"
                    Call Set_MsgZOrder("NS0002", w_strMsg, w_MsgRc, 0)
                    '2015/04/15 Bando Add End   ===========================
                    Exit Sub
                End If

                '--------------------------------------------------
                '   タイムテーブル画面  表示
                '--------------------------------------------------
                w_clsObj = New NsAid_NSK0070H.clsNSK0070H
                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm '施設情報
                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                w_clsObj.pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                w_clsObj.pPgmFlg = m_PgmFlg
                w_clsObj.pSaikeiFlg = g_SaikeiFlg '再掲部署FLG
                w_clsObj.pStrAccessModule = "NSK0000HA" '呼出元ID
                '対象年月日
                If m_SelViewKikan = 0 Then
                    w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                Else
                    w_Var = sprSheet_4W.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_Col)
                End If

                If w_Var <> "" Then
                    w_TargetDay = Integer.Parse(w_Var)
                    w_clsObj.pTargetDay = w_TargetDay
                End If
                w_clsObj.pDaikyuMng = General.g_lngDaikyuMng '代休管理(途中で変更される不整合が怖いので渡しておく)
                w_clsObj.pPackageFLG = m_PackageFLG 'パッケージマスタ
                w_clsObj.pblnAppliUseFlg = m_blnAppliUseFlg 'False:時間年休表示、True:届出表示
                w_clsObj.pSecurityObj = General.g_objSecurity 'セキュリティ部品
                w_clsObj.pSelectDeptObj = General.g_objSelectDept '部署ポップアップ部品
                w_clsObj.pGetDataObj = General.g_objGetData '職員取得部品
                w_clsObj.pSelectStaffObj = General.g_objSelectStaff '職員ポップアップ部品
                w_clsObj.pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                w_clsObj.pComCyokinObj = General.g_objComCyokin
                w_clsObj.pSyouninDataObj = General.g_objSyouninData '承認部品

                'ﾌﾟﾛﾊﾟﾃｨ設定
                w_clsObj.pInstallType = General.g_InstallType 'インストールタイプ

                '職員数分Loop
                '計画画面複数段対応(応援者含む)
                For w_LoopRow = m_StaffRow.StartRow To m_StaffRow.EndRow
                    'これでデータの存在する行のみを取得できるはず
                    If (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                        w_Var = .GetText(w_LoopRow, w_TargetCol)
                        If w_Var <> "" Then
                            If IsNumeric(w_Var) = True Then
                                'データ配列Indexを取得
                                w_StaffIdx = Integer.Parse(w_Var)

                                '2014/07/08 Shimizu add start P-06980----
                                '部署異動、配属期間内か ?(一日でも計画期間が配属期間内であれば対象)
                                w_IntervalFlg = False
                                For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                    '2014/07/09 Shimizu upd start P-06980----
                                    'If (m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD <= m_KeikakuKikan.StartDate AndAlso _
                                    '   m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD >= m_KeikakuKikan.StartDate) _
                                    '       OrElse _
                                    '   (m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD <= m_KeikakuKikan.EndDate AndAlso _
                                    '   m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD >= m_KeikakuKikan.EndDate) Then
                                    If (m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD <= m_KeikakuKikan.StartDate AndAlso
                                        m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD >= m_KeikakuKikan.StartDate) _
                                            OrElse
                                        (m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD <= m_KeikakuKikan.EndDate AndAlso
                                        m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD >= m_KeikakuKikan.EndDate) _
                                            OrElse
                                        (m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD >= m_KeikakuKikan.StartDate AndAlso
                                        m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD <= m_KeikakuKikan.EndDate) Then
                                        '2014/07/09 Shimizu upd end P-06980----
                                        w_IntervalFlg = True
                                        Exit For
                                    End If
                                Next

                                If w_IntervalFlg Then
                                    '2014/07/08 Shimizu add end P-06980----

                                    '職員管理番号
                                    w_StaffID = m_StaffData(w_StaffIdx).ID
                                    '職員番号
                                    w_StaffPreID = m_StaffData(w_StaffIdx).PreID
                                    '職員氏名
                                    w_StaffName = m_StaffData(w_StaffIdx).StaffName

                                    'セルの色
                                    w_IntBackColor = ColorTranslator.ToOle(.Cells(w_LoopRow, M_StaffName_Col).BackColor)

                                    '職員が応援者かどうか
                                    If m_StaffData(w_StaffIdx).OuenStaffFlg = 1 Then
                                        w_OuenStaffFlg = True
                                    Else
                                        w_OuenStaffFlg = False
                                    End If

                                    '職員情報
                                    w_clsObj.pStaffInfo(w_StaffID _
                                                        , w_StaffPreID _
                                                        , w_StaffName _
                                                        , w_IntBackColor) = w_OuenStaffFlg


                                    '代休情報(代休管理を行う場合のみ)
                                    If General.g_lngDaikyuMng = 0 Then
                                        For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu)
                                            w_clsObj.pDaikyuInfo(w_StaffID _
                                                               , m_StaffData(w_StaffIdx).Daikyu(w_Loop).HolDate _
                                                               , m_StaffData(w_StaffIdx).Daikyu(w_Loop).HolKinmuCD _
                                                               , m_StaffData(w_StaffIdx).Daikyu(w_Loop).GetKbn _
                                                               , m_StaffData(w_StaffIdx).Daikyu(w_Loop).OutPutList) _
                                                                    = m_StaffData(w_StaffIdx).Daikyu(w_Loop).RemainderHol

                                            For w_Loop2 = 1 To UBound(m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail)
                                                w_clsObj.pDaikyuDetailInfo(w_StaffID _
                                                                       , m_StaffData(w_StaffIdx).Daikyu(w_Loop).HolDate _
                                                                       , m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).DaikyuDate _
                                                                       , m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).DaikyuKinmuCD) _
                                                                            = m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).GetFlg
                                            Next
                                        Next
                                    End If

                                    '勤務地異動情報
                                    For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).IdoData)
                                        w_clsObj.pIdoInfo(w_StaffID _
                                                           , m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD _
                                                           , m_StaffData(w_StaffIdx).IdoData(w_Loop).IdoYMD2) _
                                                                = m_StaffData(w_StaffIdx).IdoData(w_Loop).SyuryoYMD
                                    Next
                                    '期間数でループ
                                    For w_LoopKikan = 1 To UBound(w_StartCol)
                                        '列数でループ
                                        For w_LoopCol = w_StartCol(w_LoopKikan) To w_EndCol(w_LoopKikan)

                                            '年月日
                                            w_Var = .GetText(M_YYYYMMDDLabel_Row, w_LoopCol)

                                            If w_Var <> "" Then
                                                w_Date = Integer.Parse(w_Var)
                                            End If

                                            '前日含む計画期間のデータのみ取得
                                            If w_Date >= w_startBeforDay AndAlso w_Date <= m_KeikakuKikan.EndDate Then

                                                '採用CD
                                                w_SaiyoCD = "00000"
                                                For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).SaiyoData)
                                                    If m_StaffData(w_StaffIdx).SaiyoData(w_Loop).SaiyoDate <= w_Date AndAlso
                                                            m_StaffData(w_StaffIdx).SaiyoData(w_Loop).TentaiDate >= w_Date Then
                                                        w_SaiyoCD = m_StaffData(w_StaffIdx).SaiyoData(w_Loop).SaiyoCD
                                                        Exit For
                                                    End If
                                                Next w_Loop

                                                If m_blnJissekiUseFlg AndAlso
                                                        (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso
                                                        (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse
                                                        m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                    '二段表示の場合

                                                    w_Var = .GetText(w_LoopRow + 1, w_LoopCol)

                                                    If w_Var <> "" Then
                                                        'まず下段を確認する
                                                        w_DataRow = w_LoopRow + 1
                                                        w_blnFLG = True
                                                    Else
                                                        '下段にﾃﾞｰﾀが存在しない時は上段を確認する
                                                        w_DataRow = w_LoopRow
                                                        w_Var = .GetText(w_DataRow, w_LoopCol)

                                                        If w_Var <> "" Then
                                                            w_blnFLG = True
                                                        Else
                                                            w_blnFLG = False
                                                        End If
                                                    End If
                                                Else

                                                    '一段のみの場合
                                                    w_DataRow = w_LoopRow
                                                    w_Var = .GetText(w_DataRow, w_LoopCol)

                                                    If w_Var <> "" Then
                                                        w_blnFLG = True
                                                    Else
                                                        w_blnFLG = False
                                                    End If
                                                End If

                                                w_regAppliKbn = "0"
                                                If m_PackageFLG = 2 OrElse m_PackageFLG = 3 Then
                                                    '届出使用時、届出が登録されているか確認する
                                                    w_Var = .GetText(w_LoopRow - ((w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine) + m_AppliData, w_LoopCol)
                                                    Get_AppliMark(w_Var, "", "", "", w_appliKbn, 0, 0, "")
                                                    'ブランクなら届出登録なし
                                                    If Not w_Var.Equals("") Then
                                                        w_regAppliKbn = "1"
                                                        If w_appliKbn.Equals("1") Then
                                                            w_regAppliKbn = "2"
                                                        End If
                                                    End If
                                                End If

                                                '勤務データ受渡
                                                If w_blnFLG Then
                                                    'ﾃﾞｰﾀが存在する場合
                                                    'ﾃﾞｰﾀごとに分割

                                                    '2015/04/10 Bando Upd Start ===========================
                                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                                                    '2015/04/10 Bando Upd End   ===========================
                                                    w_clsObj.pDateInfo(w_StaffID _
                                                         , w_Date _
                                                         , w_SaiyoCD _
                                                         , w_RiyuKBN _
                                                         , w_KinmuCD _
                                                         , w_KakuteiFlg _
                                                         , w_KangoCD _
                                                         , w_Comment) = w_regAppliKbn

                                                    '2018/03/12 Yamanishi Upd Start ------------------------------------------------------------------------------------------------
                                                    ''時間年休件数取得（１件につき２８ﾊﾞｲﾄ）
                                                    'w_RecCnt = Len(w_Time) / 28

                                                    'w_Pos = 1

                                                    'For w_Loop = 1 To w_RecCnt
                                                    '    'HolidayBunruiCD
                                                    '    w_BunruiCD = Mid(w_Time, w_Pos, 2)

                                                    '    w_Pos = w_Pos + 2

                                                    '    'FromTime
                                                    '    w_StartTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_StartTime) = False Then
                                                    '        w_StartTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    'ToTime
                                                    '    w_EndTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_EndTime) = False Then
                                                    '        w_EndTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    'DateKbn
                                                    '    w_KBN = Mid(w_Time, w_Pos, 1)

                                                    '    w_Pos = w_Pos + 1

                                                    '    '時間年休
                                                    '    w_NenkyuTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_NenkyuTime) = False Then
                                                    '        w_NenkyuTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    '休憩減算フラグ
                                                    '    w_HolSubFlg = Mid(w_Time, w_Pos, 1)

                                                    '    w_Pos = w_Pos + 1

                                                    '    '日勤時間
                                                    '    w_DayTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_DayTime) = False Then
                                                    '        w_DayTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    '夜勤時間
                                                    '    w_NightTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_NightTime) = False Then
                                                    '        w_NightTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    '翌日夜勤時間
                                                    '    w_NextNightTime = Mid(w_Time, w_Pos, 4)
                                                    '    If IsNumeric(w_NextNightTime) = False Then
                                                    '        w_NextNightTime = "0"
                                                    '    End If

                                                    '    w_Pos = w_Pos + 4

                                                    '    w_clsObj.pJikanNenkyuDataInfo(w_StaffID _
                                                    '                        , w_Date _
                                                    '                        , w_BunruiCD _
                                                    '                        , Integer.Parse(w_StartTime) _
                                                    '                        , Integer.Parse(w_EndTime) _
                                                    '                        , w_KBN _
                                                    '                        , Integer.Parse(w_NenkyuTime) _
                                                    '                        , w_HolSubFlg _
                                                    '                        , Integer.Parse(w_DayTime) _
                                                    '                        , Integer.Parse(w_NightTime)
                                                    '                        ) = Integer.Parse(w_NextNightTime)
                                                    'Next w_Loop

                                                    '時間年休件数取得
                                                    w_strTime = w_Time

                                                    While w_strTime <> ""
                                                        w_strTime = Get_NenkyuTime(w_strTime, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                                                   w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime, w_NextNightTime)
                                                        w_clsObj.pJikanNenkyuDataInfo(w_StaffID, w_Date, w_BunruiCD, w_StartTime, w_EndTime, w_KBN,
                                                                                      w_NenkyuTime, w_HolSubFlg, w_DayTime, w_NightTime) = w_NextNightTime
                                                    End While
                                                    '2018/03/12 Yamanishi Upd End --------------------------------------------------------------------------------------------------

                                                    w_KojyoIndex = 0
                                                    For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                        If w_Date = m_StaffData(w_StaffIdx).Kojyo(w_Loop).lngDate Then
                                                            w_KojyoIndex = w_Loop '退避(控除データ位置)
                                                            Exit For
                                                        End If
                                                    Next w_Loop

                                                    If w_KojyoIndex <> 0 Then
                                                        For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate)
                                                            If InStr(m_strOuenKojyoCD, String.Format("{0, 10}", m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_Loop))) <= 0 Then
                                                                '次画面へ
                                                                w_clsObj.pKojyoDataGet(w_StaffID,
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngDate,
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngNikkinTime(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strShinryoKbn(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeFrom(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeTo(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYakinTime(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYokuYakinTime(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailTime(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strHolSubFlg(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).UniqueseqNo(w_Loop),
                                                                                       m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strNextFlg(w_Loop)) = m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).Seq(w_Loop)

                                                            Else
                                                                '2018/03/12 Yamanishi Upd --------------------------------------------------------------------------------------
                                                                'w_clsObj.pOuenKojyoDataGet(w_StaffID, _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngDate, _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngNikkinTime(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strShinryoKbn(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeFrom(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeTo(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYakinTime(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYokuYakinTime(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailTime(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strHolSubFlg(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).UniqueseqNo(w_Loop), _
                                                                '                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strNextFlg(w_Loop)) = m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).Seq(w_Loop)

                                                                w_clsObj.pOuenKojyoDataGet(w_StaffID,
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngDate,
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngNikkinTime(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strShinryoKbn(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeFrom(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeTo(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYakinTime(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYokuYakinTime(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailTime(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strHolSubFlg(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).UniqueseqNo(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strNextFlg(w_Loop),
                                                                                           m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).OuenKinmuDeptCD(w_Loop)) = m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).Seq(w_Loop)
                                                                '---------------------------------------------------------------------------------------------------------------
                                                            End If

                                                        Next w_Loop '控除のデータ数でループ
                                                    End If '控除のデータが存在しているか
                                                Else
                                                    '勤務データが存在しない場合

                                                    w_clsObj.pDateInfo(w_StaffID _
                                                         , w_Date _
                                                         , w_SaiyoCD _
                                                         , "" _
                                                         , "" _
                                                         , "0" _
                                                         , "" _
                                                         , "") = ""
                                                End If

                                                '行事データ受渡
                                                ReDim w_kojoEve(0)
                                                chkEventTargetStaff(w_StaffID, w_Date, w_kojoEve)
                                                For w_Loop = 1 To UBound(w_kojoEve)
                                                    w_clsObj.pEventData(w_StaffID _
                                                                      , w_Date _
                                                                      , w_kojoEve(w_Loop).uniqNo _
                                                                      , w_kojoEve(w_Loop).EventName _
                                                                      , w_kojoEve(w_Loop).Time_st _
                                                                      , w_kojoEve(w_Loop).Time_ed) = w_kojoEve(w_Loop).allFlg
                                                Next


                                            End If '前日を含んで計画期間内か
                                        Next w_LoopCol '列数でループ
                                    Next w_LoopKikan '期間数でループ
                                    '2014/07/08 Shimizu add start P-06980----
                                End If
                                '2014/07/08 Shimizu add end P-06980----
                            End If
                        End If
                    End If 'データの存在する行のみ
                Next w_LoopRow '職員数分Loop

                w_clsObj.pProcessObj = Me

                '画面表示
                w_clsObj.mShowWindow()
                '入力された値を取得する
                If w_clsObj.pOKFlg = True Then

                    '職員数分Loop
                    '計画画面複数段対応(応援者は無視)
                    For w_LoopRow = m_StaffRow.StartRow To m_StaffRow.EndRow - (m_OuenStaffCnt * m_MaxShowLine)
                        'これでデータの存在する列のみを取得できるはず
                        If (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan Then
                            w_Var = .GetText(w_LoopRow, w_TargetCol)
                            If w_Var <> "" Then
                                If IsNumeric(w_Var) = True Then
                                    'データ配列Indexを取得
                                    w_StaffIdx = Integer.Parse(w_Var)

                                    '職員管理番号の検索
                                    w_clsObj.pSearchID = m_StaffData(w_StaffIdx).ID


                                    If Not w_clsObj.pSearchID.Equals("0") Then
                                        '職員検索の失敗は無視

                                        '代休情報を取得
                                        If General.g_lngDaikyuMng = 0 Then
                                            ReDim m_StaffData(w_StaffIdx).Daikyu(0)
                                            For w_Loop = 1 To w_clsObj.pDaikyuDataCount
                                                w_clsObj.pIndex = w_Loop
                                                ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(w_Loop)
                                                m_StaffData(w_StaffIdx).Daikyu(w_Loop).HolDate = w_clsObj.pHolDate
                                                m_StaffData(w_StaffIdx).Daikyu(w_Loop).HolKinmuCD = w_clsObj.pHolKinmuCD
                                                m_StaffData(w_StaffIdx).Daikyu(w_Loop).GetKbn = w_clsObj.pGetKbn
                                                m_StaffData(w_StaffIdx).Daikyu(w_Loop).OutPutList = w_clsObj.pOutPutList
                                                m_StaffData(w_StaffIdx).Daikyu(w_Loop).RemainderHol = w_clsObj.pRemainderHol
                                                ReDim m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(0)
                                                For w_Loop2 = 1 To w_clsObj.pDaikyuDetailDataCount
                                                    w_clsObj.pIndex2 = w_Loop2
                                                    ReDim Preserve m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2)
                                                    m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).DaikyuDate = w_clsObj.pDaikyuDate
                                                    m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).DaikyuKinmuCD = w_clsObj.pDaikyuKinmuCD
                                                    m_StaffData(w_StaffIdx).Daikyu(w_Loop).DaikyuDetail(w_Loop2).GetFlg = w_clsObj.pGetFlg
                                                Next w_Loop2
                                            Next w_Loop

                                            Call SortDaikyu(w_StaffIdx)
                                        End If
                                        '期間数でループ
                                        For w_LoopKikan = 1 To UBound(w_StartCol)
                                            '列数でループ
                                            For w_LoopCol = w_StartCol(w_LoopKikan) To w_EndCol(w_LoopKikan)

                                                '年月日
                                                w_Var = .GetText(M_YYYYMMDDLabel_Row, w_LoopCol)

                                                w_Date = 0
                                                If w_Var <> "" Then
                                                    w_Date = Integer.Parse(w_Var)
                                                End If

                                                '計画期間のデータのみ取得
                                                If w_Date >= m_KeikakuKikan.StartDate AndAlso w_Date <= m_KeikakuKikan.EndDate Then
                                                    '日付の検索
                                                    w_clsObj.pSearchDay = w_Date

                                                    If Not w_clsObj.pSearchDay = 0 Then
                                                        '日付の検索失敗は無視

                                                        If m_blnJissekiUseFlg AndAlso
                                                            (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso
                                                            (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse
                                                            m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                            '二段表示の場合

                                                            w_Var = .GetText(w_LoopRow + 1, w_LoopCol)
                                                            '他部署の勤務でも計画期間外の実績データでもなく勤務が設定されているか
                                                            If w_Var <> "" AndAlso
                                                                Not ((ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_MonthBefore_Back) OrElse (ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_Jisseki4W_Back)) Then
                                                                'まず下段を確認する
                                                                w_DataRow = w_LoopRow + 1
                                                                w_blnFLG = True
                                                                w_Var2 = .GetText(w_LoopRow, w_LoopCol)

                                                                '上段のデータと勤務コードが違う場合文字の色を変更する
                                                                '2015/04/10 Bando Upd Start ===========================
                                                                'Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                                                Call Get_KinmuMark(w_Var2, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                                                                '2015/04/10 Bando Upd End   ===========================
                                                                If w_KinmuCD <> w_clsObj.pKinmuCD Then
                                                                    .Cells(w_DataRow, w_LoopCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                                Else
                                                                    .Cells(w_DataRow, w_LoopCol).ForeColor = Color.Black
                                                                End If

                                                            Else
                                                                '下段にﾃﾞｰﾀが存在しない時は上段を確認する
                                                                w_DataRow = w_LoopRow
                                                                w_Var = .GetText(w_DataRow, w_LoopCol)
                                                                '他部署の勤務でも計画期間外の実績データでもなく勤務が設定されているか
                                                                If w_Var <> "" AndAlso
                                                                    Not ((ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_MonthBefore_Back) OrElse (ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_Jisseki4W_Back)) Then
                                                                    w_blnFLG = True
                                                                    '上段のデータと勤務コードが違う場合勤務変更扱い
                                                                    '2015/04/10 Bando Upd Start ========================
                                                                    'Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                                                    Call Get_KinmuMark(w_Var, w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, "")
                                                                    '2015/04/10 Bando Upd End   ========================

                                                                    If w_KinmuCD <> w_clsObj.pKinmuCD Then
                                                                        w_DataRow = w_LoopRow + 1
                                                                        .Cells(w_DataRow, w_LoopCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                                    End If
                                                                Else
                                                                    w_blnFLG = False
                                                                End If

                                                            End If
                                                        Else
                                                            '一段のみの場合
                                                            w_DataRow = w_LoopRow
                                                            w_Var = .GetText(w_DataRow, w_LoopCol)
                                                            '他部署の勤務でも計画期間外の実績データでもなく勤務が設定されているか
                                                            If w_Var <> "" AndAlso
                                                                Not ((ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_MonthBefore_Back) OrElse (ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor) = m_Jisseki4W_Back)) Then
                                                                w_blnFLG = True
                                                            Else
                                                                w_blnFLG = False
                                                            End If
                                                        End If



                                                        '勤務データ確認
                                                        If w_blnFLG Then

                                                            'ﾃﾞｰﾀが存在する場合
                                                            'ﾃﾞｰﾀごとに分割
                                                            '2015/04/10 Bando Upd Start ===========================
                                                            'Call Get_KinmuMark(w_Var, w_OldKinmuCD, w_OldRiyuKBN, w_KakuteiFlg, w_OldKangoCD, 0)
                                                            Call Get_KinmuMark(w_Var, w_OldKinmuCD, w_OldRiyuKBN, w_KakuteiFlg, w_OldKangoCD, 0, w_OldComment)
                                                            '2015/04/10 Bando Upd End   ===========================

                                                            '他部署確定データの場合処理を行わない
                                                            If w_KakuteiFlg <> "1" Then

                                                                w_KinmuCD = w_clsObj.pKinmuCD
                                                                w_RiyuKBN = w_clsObj.pReasonKBN
                                                                w_KangoCD = w_clsObj.pOuenKangoCD
                                                                w_KakuteiFlg = w_clsObj.pKakuteiFlg
                                                                w_Comment = w_clsObj.pComment
                                                                w_KojyoIndex = 0
                                                                For w_Loop = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                    If w_Date = m_StaffData(w_StaffIdx).Kojyo(w_Loop).lngDate Then
                                                                        w_KojyoIndex = w_Loop '退避(控除データ位置)
                                                                        Exit For
                                                                    End If
                                                                Next w_Loop

                                                                w_RecCnt = w_clsObj.pAllKojyoDataCount

                                                                If w_KojyoIndex = 0 Then
                                                                    '元データがない場合、配列確保

                                                                    If w_RecCnt > 0 Then
                                                                        '戻り値が空でなければ
                                                                        w_NewIndex = UBound(m_StaffData(w_StaffIdx).Kojyo) + 1
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex)

                                                                        m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).init()

                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngKinmuDetailDate(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngNikkinTime(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strShinryoKbn(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngTimeFrom(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngTimeTo(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngYakinTime(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngYokuYakinTime(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strKinmuDetailCD(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strNextFlg(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngKinmuDetailTime(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strHolSubFlg(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).UniqueseqNo(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).Seq(w_RecCnt)
                                                                        ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).OuenKinmuDeptCD(w_RecCnt) '2018/03/12 Yamanishi Add

                                                                        For w_Loop = 1 To w_RecCnt
                                                                            w_clsObj.pIndex = w_Loop


                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngDate = w_clsObj.pAllKDate
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngKinmuDetailDate(w_Loop) = w_clsObj.pAllKinmuDetailDate
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngNikkinTime(w_Loop) = w_clsObj.pAllNikkinTime
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strShinryoKbn(w_Loop) = w_clsObj.pAllShinryoKbn
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngTimeFrom(w_Loop) = w_clsObj.pAllTimeFrom
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngTimeTo(w_Loop) = w_clsObj.pAllTimeTo
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngYakinTime(w_Loop) = w_clsObj.pAllYakinTime
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngYokuYakinTime(w_Loop) = w_clsObj.pAllYokuYakinTime
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strKinmuDetailCD(w_Loop) = w_clsObj.pAllKinmuDetailCD
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strNextFlg(w_Loop) = w_clsObj.pAllNextFlg
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).lngKinmuDetailTime(w_Loop) = w_clsObj.pAllKoujyoTime
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).strHolSubFlg(w_Loop) = w_clsObj.pAllHolGensanFlg
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).UniqueseqNo(w_Loop) = w_clsObj.pUniqNo
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).Seq(w_Loop) = w_clsObj.pSeq
                                                                            m_StaffData(w_StaffIdx).Kojyo(w_NewIndex).OuenKinmuDeptCD(w_Loop) = w_clsObj.pAllOuenKinmuDeptCD '2018/03/12 Yamanishi Add
                                                                        Next w_Loop
                                                                    End If
                                                                Else
                                                                    'データがある場合、上書き

                                                                    '配列初期化
                                                                    m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).init()

                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngNikkinTime(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strShinryoKbn(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeFrom(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeTo(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYakinTime(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYokuYakinTime(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strNextFlg(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailTime(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strHolSubFlg(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).UniqueseqNo(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).Seq(w_RecCnt)
                                                                    ReDim Preserve m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).OuenKinmuDeptCD(w_RecCnt) '2018/03/12 Yamanishi Add

                                                                    For w_Loop = 1 To w_RecCnt
                                                                        w_clsObj.pIndex = w_Loop
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngDate = w_clsObj.pAllKDate
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailDate(w_Loop) = w_clsObj.pAllKinmuDetailDate
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngNikkinTime(w_Loop) = w_clsObj.pAllNikkinTime
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strShinryoKbn(w_Loop) = w_clsObj.pAllShinryoKbn
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeFrom(w_Loop) = w_clsObj.pAllTimeFrom
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngTimeTo(w_Loop) = w_clsObj.pAllTimeTo
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYakinTime(w_Loop) = w_clsObj.pAllYakinTime
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngYokuYakinTime(w_Loop) = w_clsObj.pAllYokuYakinTime
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strKinmuDetailCD(w_Loop) = w_clsObj.pAllKinmuDetailCD
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strNextFlg(w_Loop) = w_clsObj.pAllNextFlg
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).lngKinmuDetailTime(w_Loop) = w_clsObj.pAllKoujyoTime
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).strHolSubFlg(w_Loop) = w_clsObj.pAllHolGensanFlg
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).UniqueseqNo(w_Loop) = w_clsObj.pUniqNo
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).Seq(w_Loop) = w_clsObj.pSeq
                                                                        m_StaffData(w_StaffIdx).Kojyo(w_KojyoIndex).OuenKinmuDeptCD(w_Loop) = w_clsObj.pAllOuenKinmuDeptCD '2018/03/12 Yamanishi Add
                                                                    Next w_Loop
                                                                End If

                                                                '時間年休文字列(１件は１１ﾊﾞｲﾄ)取得
                                                                w_Time = ""
                                                                For w_Loop = 1 To w_clsObj.pJikanNenkyuDataCount
                                                                    w_clsObj.pIndex = w_Loop

                                                                    '2018/03/08 Yamanishi Upd Start ------------------------------------------------------------------
                                                                    ''HolidayBunruiCD(ﾊﾞｲﾄ数２)
                                                                    'w_BunruiCD = w_clsObj.pHolBunruiCD
                                                                    'If w_BunruiCD = "" Then
                                                                    '    w_Time = w_Time & Space(2)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 2}", w_BunruiCD)
                                                                    'End If
                                                                    ''FromTime(ﾊﾞｲﾄ数４)
                                                                    'w_StartTime = Convert.ToString(w_clsObj.pFromTime)
                                                                    'If w_StartTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_StartTime)
                                                                    'End If
                                                                    ''ToTime(ﾊﾞｲﾄ数４)
                                                                    'w_EndTime = Convert.ToString(w_clsObj.pToTime)
                                                                    'If w_EndTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_EndTime)
                                                                    'End If
                                                                    ''DateKbn(ﾊﾞｲﾄ数１)
                                                                    'w_KBN = w_clsObj.pNextdayFlg
                                                                    'w_Time = w_Time & w_KBN
                                                                    ''時間年休
                                                                    'w_NenkyuTime = Convert.ToString(w_clsObj.pNenkyuTime)
                                                                    'If w_NenkyuTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_NenkyuTime)
                                                                    'End If
                                                                    ''休憩減算フラグ
                                                                    'w_HolSubFlg = w_clsObj.pHolGensanFlg2
                                                                    'If w_HolSubFlg = "" Then
                                                                    '    w_Time = w_Time & Space(1)
                                                                    'Else
                                                                    '    w_Time = w_Time & w_HolSubFlg
                                                                    'End If
                                                                    ''日勤時間
                                                                    'w_DayTime = Convert.ToString(w_clsObj.pDayTime)
                                                                    'If w_DayTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_DayTime)
                                                                    'End If
                                                                    ''夜勤時間
                                                                    'w_NightTime = Convert.ToString(w_clsObj.pNightDayTime)
                                                                    'If w_NightTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_NightTime)
                                                                    'End If
                                                                    ''翌日夜勤時間
                                                                    'w_NextNightTime = Convert.ToString(w_clsObj.pNextNightTime)
                                                                    'If w_NextNightTime = "" Then
                                                                    '    w_Time = w_Time & Space(4)
                                                                    'Else
                                                                    '    w_Time = w_Time & String.Format("{0, 4}", w_NextNightTime)
                                                                    'End If

                                                                    w_Time = w_Time & Set_NenkyuTime(w_clsObj.pHolBunruiCD, w_clsObj.pFromTime, w_clsObj.pToTime,
                                                                                                     w_clsObj.pNextdayFlg, w_clsObj.pNenkyuTime, w_clsObj.pHolGensanFlg2,
                                                                                                     w_clsObj.pDayTime, w_clsObj.pNightDayTime, w_clsObj.pNextNightTime)
                                                                    '2018/03/08 Yamanishi Upd End --------------------------------------------------------------------
                                                                Next w_Loop

                                                                '2015/04/10 Bando Upd Start ============================
                                                                'w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time)
                                                                w_Var = Set_KinmuMark(w_KinmuCD, w_RiyuKBN, w_KakuteiFlg, w_KangoCD, w_Time, w_Comment)
                                                                '2015/04/10 Bando Upd End   ============================

                                                                If Not (m_blnJissekiUseFlg) AndAlso _
                                                                    (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso _
                                                                    (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse _
                                                                    m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then
                                                                    '一段表示で予定のデータが保存されておらず予定と実績が異なる場合
                                                                    w_Var2 = .GetText(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol)
                                                                    If w_Var2 = "" AndAlso (w_KinmuCD <> w_OldKinmuCD OrElse w_RiyuKBN <> w_OldRiyuKBN OrElse w_KangoCD <> w_OldKangoCD OrElse w_Comment <> w_OldComment) Then
                                                                        '現在表示されている予定データを予定の隠し行に保存
                                                                        w_Var2 = .GetText(w_DataRow, w_LoopCol)
                                                                        w_IntForeColor = ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).ForeColor)
                                                                        w_IntBackColor = ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).BackColor)

                                                                        .SetText(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol, w_Var2)
                                                                        .Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol).ForeColor = ColorTranslator.FromOle(w_IntForeColor)
                                                                        .Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol).BackColor = ColorTranslator.FromOle(w_IntBackColor)

                                                                        'ついでに貼り付ける文字の色を赤に変更
                                                                        .Cells(w_DataRow, w_LoopCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                                    End If
                                                                End If

                                                                '勤務記号貼り付け
                                                                .SetText(w_DataRow, w_LoopCol, w_Var)

                                                                '色分け（時間入力の判断はw_Time<>0で行う）
                                                                If w_Time <> "" Then
                                                                    '時間年休を取得している場合
                                                                    w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)

                                                                Else
                                                                    Select Case w_RiyuKBN
                                                                        Case "1" '通常
                                                                            w_BackColor = Color.White
                                                                        Case "2" '要請
                                                                            w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                                        Case "3" '希望
                                                                            '2015/07/24 Bando Upd Start =====================
                                                                            If w_Comment = "" Then
                                                                                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                            Else
                                                                                w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                            End If
                                                                            '2015/07/24 Bando Upd End   =====================
                                                                        Case "4" '再掲
                                                                            w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                                        Case "5" '委員会
                                                                            w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                                        Case "6" '応援
                                                                            w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                                        Case Else 'その他
                                                                            w_BackColor = Color.White
                                                                    End Select

                                                                    '代休発生勤務 文字/背景色
                                                                    If General.g_lngDaikyuMng = 0 Then
                                                                        w_Var2 = .GetText(w_DataRow, w_TargetCol)
                                                                        If w_Var2 <> "" Then
                                                                            w_DaikyuStaffIdx = Integer.Parse(w_Var2)
                                                                            w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_LoopCol)
                                                                            If w_Var2 <> "" Then
                                                                                If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_DaikyuStaffIdx) = True Then
                                                                                    w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                                End If
                                                                            End If
                                                                        End If
                                                                    End If
                                                                    '2015/07/22 Bando Add Start ===========================
                                                                    '控除があるか判断し　背景色変更
                                                                    w_Var2 = .GetText(w_DataRow, w_TargetCol)
                                                                    If w_Var2 <> "" Then
                                                                        w_StaffIdx = Integer.Parse(w_Var2)
                                                                        If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                        w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_LoopCol)
                                                                            If w_Var2 <> "" Then
                                                                                For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                                    If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                                        If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                                            Exit For
                                                                                        End If
                                                                                        w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                                        Exit For
                                                                                    End If
                                                                                Next
                                                                            End If
                                                                        End If
                                                                    End If
                                                                    '2015/07/22 Bando Add End   ===========================
                                                                End If

                                                                .Cells(w_DataRow, w_LoopCol).BackColor = w_BackColor

                                                                '予定側は文字の色等更新しない
                                                                ''予定と実績が異なる時、予定側の時間年休も更新する
                                                                'w_blnFLG = False
                                                                'If m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN Then
                                                                '    w_VarPlan = .GetText(w_DataRow + 1, w_LoopCol)
                                                                '    If m_blnJissekiUseFlg Then
                                                                '        '二段表示の時
                                                                '        If (w_DataRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki Then
                                                                '            '下段選択の時
                                                                '            w_VarPlan = .GetText(w_DataRow - 1, w_LoopCol)
                                                                '            If w_VarPlan <> "" AndAlso Not .Cells(w_DataRow - 1, w_LoopCol).BackColor.Equals(Color.Black) Then
                                                                '                '上段にデータが存在 かつ 上段の背景色が黒の時
                                                                '                w_RowPlan = w_DataRow - 1
                                                                '                w_blnFLG = True
                                                                '            End If
                                                                '        End If
                                                                '    ElseIf w_VarPlan <> "" Then
                                                                '        '一段表示　かつ　下段にデータが存在する時
                                                                '        w_RowPlan = w_DataRow + 1
                                                                '        w_blnFLG = True
                                                                '    End If
                                                                'End If

                                                                'If w_blnFLG Then
                                                                '    '予定と実績が異なる時
                                                                '    Call Get_KinmuMark(w_VarPlan, w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, "")
                                                                '    w_VarPlan = Set_KinmuMark(w_KinmuCD, w_RiyuKBN2, w_KakuteiFlg, w_KangoCD, w_Time)

                                                                '    '勤務記号貼り付け
                                                                '    .SetText(w_RowPlan, w_LoopCol, w_VarPlan)

                                                                '    '色分け（時間入力の判断はw_Time<>0で行う）
                                                                '    If w_Time <> "" Then
                                                                '        '時間年休をを取得している場合
                                                                '        w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                                '    Else
                                                                '        Select Case w_RiyuKBN2
                                                                '            Case "1" '通常
                                                                '                w_BackColor = Color.White
                                                                '            Case "2" '要請
                                                                '                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                                '            Case "3" '希望
                                                                '                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                '            Case "4" '再掲
                                                                '                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                                '            Case "5" '委員会
                                                                '                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                                '            Case "6" '応援
                                                                '                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                                '            Case Else 'その他
                                                                '                w_BackColor = Color.White
                                                                '        End Select

                                                                '        '代休発生勤務(文字 / 背景色)
                                                                '        If General.g_lngDaikyuMng = 0 Then
                                                                '            w_Var2 = .GetText(w_RowPlan, w_TargetCol)
                                                                '            If w_Var2 <> "" Then
                                                                '                w_DaikyuStaffIdx = Integer.Parse(w_Var2)
                                                                '                w_Var2 = .GetText(M_YYYYMMDDLabel_Row, w_LoopCol)
                                                                '                If w_Var2 <> "" Then
                                                                '                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_DaikyuStaffIdx) = True Then
                                                                '                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                '                    End If
                                                                '                End If
                                                                '            End If
                                                                '        End If
                                                                '    End If

                                                                '    .Cells(w_RowPlan, w_LoopCol).BackColor = w_BackColor

                                                                '    '理由区分が違う場合は勤務変更扱い
                                                                '    If w_RiyuKBN <> w_RiyuKBN2 Then
                                                                '        .Cells(w_DataRow, w_LoopCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                                '    End If
                                                                'End If


                                                                If Get_Col_M(w_Date, w_OtherCol) = True Then

                                                                    'KinmuName/勤務ｺｰﾄﾞ/理由区分/時間数/確定Flg 貼り付け
                                                                    sprSheet_M.Sheets(0).SetText(w_DataRow, w_OtherCol, w_Var)


                                                                    '色分け（時間入力の判断はw_Time<>0で行う）
                                                                    If w_Time <> "" Then
                                                                        '時間年休をを取得している場合
                                                                        w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                                    Else
                                                                        Select Case w_RiyuKBN
                                                                            Case "1" '通常
                                                                                w_BackColor = Color.White
                                                                            Case "2" '要請
                                                                                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                                            Case "3" '希望
                                                                                '2015/07/24 Bando Upd Start =====================
                                                                                If w_Comment = "" Then
                                                                                    w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                                Else
                                                                                    w_BackColor = ColorTranslator.FromOle(m_KibouCom_Back)
                                                                                End If
                                                                                '2015/07/24 Bando Upd End   =====================
                                                                            Case "4" '再掲
                                                                                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                                            Case "5" '委員会
                                                                                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                                            Case "6" '応援
                                                                                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                                            Case Else 'その他
                                                                                w_BackColor = Color.White
                                                                        End Select

                                                                        '代休発生勤務 文字/背景色
                                                                        If General.g_lngDaikyuMng = 0 Then
                                                                            w_Var2 = sprSheet_M.Sheets(0).GetText(w_DataRow, w_OtherTargetCol)
                                                                            If w_Var2 <> "" Then
                                                                                w_DaikyuStaffIdx = Integer.Parse(w_Var2)
                                                                                w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_OtherCol)
                                                                                If w_Var2 <> "" Then
                                                                                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_DaikyuStaffIdx) = True Then
                                                                                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                                    End If
                                                                                End If
                                                                            End If
                                                                        End If
                                                                        '2015/07/22 Bando Add Start ===========================
                                                                        '控除があるか判断し　背景色変更
                                                                        w_Var2 = sprSheet_M.Sheets(0).GetText(w_DataRow, w_OtherTargetCol)
                                                                        If w_Var2 <> "" Then
                                                                            w_StaffIdx = Integer.Parse(w_Var2)
                                                                            If UBound(m_StaffData(w_StaffIdx).Kojyo) > 0 Then
                                                                                w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_OtherCol)
                                                                                If w_Var2 <> "" Then
                                                                                    For w_i As Integer = 1 To UBound(m_StaffData(w_StaffIdx).Kojyo)
                                                                                        If w_Var2 = m_StaffData(w_StaffIdx).Kojyo(w_i).lngDate Then
                                                                                            If (UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeFrom) = 0 And UBound(m_StaffData(w_StaffIdx).Kojyo(w_i).lngTimeTo) = 0) Or w_RiyuKBN = "6" Then
                                                                                                Exit For
                                                                                            End If
                                                                                            w_BackColor = ColorTranslator.FromOle(m_Kojo_Back)
                                                                                            Exit For
                                                                                        End If
                                                                                    Next
                                                                                End If
                                                                            End If
                                                                        End If
                                                                        '2015/07/22 Bando Add End   ===========================
                                                                    End If

                                                                    sprSheet_M.Sheets(0).Cells(w_DataRow, w_OtherCol).BackColor = w_BackColor

                                                                    '文字色と背景色を表示している方のテーブルのものと同じにする
                                                                    w_IntForeColor = ColorTranslator.ToOle(.Cells(w_DataRow, w_LoopCol).ForeColor)

                                                                    sprSheet_M.Sheets(0).Cells(w_DataRow, w_OtherCol).ForeColor = ColorTranslator.FromOle(w_IntForeColor)

                                                                    If Not (m_blnJissekiUseFlg) AndAlso _
                                                                        (w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan AndAlso _
                                                                        (m_PgmFlg = General.G_PGMSTARTFLG_CHANGEJISSEKI OrElse _
                                                                        m_PgmFlg = General.G_PGMSTARTFLG_CHANGEPLAN) Then

                                                                        '一段表示の場合元のシートの予定隠し行のデータをそっくりコピーする
                                                                        w_Var2 = .GetText(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol)
                                                                        w_IntForeColor = ColorTranslator.ToOle(.Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol).ForeColor)
                                                                        w_IntBackColor = ColorTranslator.ToOle(.Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_LoopCol).BackColor)

                                                                        sprSheet_M.Sheets(0).SetText(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_OtherCol, w_Var2)
                                                                        sprSheet_M.Sheets(0).Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_OtherCol).ForeColor = ColorTranslator.FromOle(w_IntForeColor)
                                                                        sprSheet_M.Sheets(0).Cells(w_DataRow + m_KinmuJisseki - m_KinmuPlan, w_OtherCol).BackColor = ColorTranslator.FromOle(w_IntBackColor)
                                                                    End If

                                                                    '予定側は文字の色等更新しない
                                                                    ''予定と実績が異なる時、予定側の時間年休も更新する
                                                                    'If w_blnFLG Then
                                                                    '    '勤務記号貼り付け
                                                                    '    sprSheet_M.Sheets(0).SetText(w_RowPlan, w_OtherCol, w_VarPlan)

                                                                    '    '色分け（時間入力の判断はw_Time<>0で行う）
                                                                    '    If w_Time <> "" Then
                                                                    '        '時間年休をを取得している場合
                                                                    '        w_BackColor = ColorTranslator.FromOle(m_KinmuTime_Back)
                                                                    '    Else
                                                                    '        Select Case w_RiyuKBN2
                                                                    '            Case "1" '通常
                                                                    '                w_BackColor = Color.White
                                                                    '            Case "2" '要請
                                                                    '                w_BackColor = ColorTranslator.FromOle(m_Yousei_Back)
                                                                    '            Case "3" '希望
                                                                    '                w_BackColor = ColorTranslator.FromOle(m_Kibou_Back)
                                                                    '            Case "4" '再掲
                                                                    '                w_BackColor = ColorTranslator.FromOle(m_Saikei_Back)
                                                                    '            Case "5" '委員会
                                                                    '                w_BackColor = ColorTranslator.FromOle(m_Iin_Back)
                                                                    '            Case "6" '応援
                                                                    '                w_BackColor = ColorTranslator.FromOle(m_Ouen_Back)
                                                                    '            Case Else 'その他
                                                                    '                w_BackColor = Color.White
                                                                    '        End Select

                                                                    '        '代休発生勤務 文字/背景色
                                                                    '        If General.g_lngDaikyuMng = 0 Then
                                                                    '            w_Var2 = sprSheet_M.Sheets(0).GetText(w_RowPlan, w_OtherTargetCol)
                                                                    '            If w_Var2 <> "" Then
                                                                    '                w_DaikyuStaffIdx = Integer.Parse(w_Var2)
                                                                    '                w_Var2 = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, w_OtherCol)
                                                                    '                If w_Var2 <> "" Then
                                                                    '                    If Check_DaikyuBackColor(Integer.Parse(w_Var2), w_DaikyuStaffIdx) = True Then
                                                                    '                        w_BackColor = ColorTranslator.FromOle(m_Daikyu_Back)
                                                                    '                    End If
                                                                    '                End If
                                                                    '            End If
                                                                    '        End If
                                                                    '    End If

                                                                    '    sprSheet_M.Sheets(0).Cells(w_RowPlan, w_OtherCol).BackColor = w_BackColor

                                                                    '    '理由区分が違う場合は勤務変更扱い
                                                                    '    If w_RiyuKBN <> w_RiyuKBN2 Then
                                                                    '        sprSheet_M.Sheets(0).Cells(w_DataRow, w_OtherCol).ForeColor = ColorTranslator.FromOle(m_Comp_Fore)
                                                                    '    End If
                                                                    'End If
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            Next w_LoopCol '列数でループ
                                        Next w_LoopKikan '期間数でループ
                                    End If
                                End If
                            End If
                        End If 'これでデータの存在する列のみを取得できるはず
                    Next w_LoopRow '職員行数分ループ
                End If '保存するよう指示がある

                'ｸﾗｽｵﾌﾞｼﾞｪｸﾄ解放
                w_clsObj = Nothing
                '処理のちらつきを隠す
                picCover.Top = picBase.Top
                picCover.Left = picBase.Left
                picCover.Width = picBase.Width
                picCover.Height = picBase.Height
                picCover.Visible = True

                For w_LoopRow = m_StaffRow.StartRow To m_StaffRow.EndRow
                    If ((w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuPlan) OrElse ((w_LoopRow - m_StaffRow.StartRow) Mod m_MaxShowLine = m_KinmuJisseki) Then
                        '勤務のみ集計
                        '計画期間の個人別集計
                        Call RunReCalc_PUser(w_LoopRow)

                        If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                            '4週期間の個人別集計
                            Call RunReCalc_User_4W(w_LoopRow)
                            Call RunReCalc_PUser_Jisseki(w_LoopRow)
                        End If
                    End If
                Next w_LoopRow

                For w_Col = m_KeikakuKikan.KinmuDataStartCol To m_KeikakuKikan.KinmuDataEndCol
                    '計画期間の日別集計
                    Call RunReCalc_PDay(w_Col)
                Next w_Col

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    If Get_Col_4W(Format(DateAdd(DateInterval.Day, 1, Date.Parse(Format(m_KeikakuKikan.EndDate, "0000/00/00"))), "yyyyMMdd"), w_StartCol2) = True Then
                        For w_Col = w_StartCol2 To m_4WeekKikan(UBound(m_4WeekKikan)).KinmuDataEndCol
                            '計画期間の最後の4週部分の日別集計
                            Call RunReCalc_PDay_4W(w_Col)
                        Next w_Col
                    End If
                End If

                picCover.Visible = False
            End With
        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub
    '2014/06/03 Shimizu add end P-06980----

    '必須勤務パターン取得
    Private Sub getAbsKinmuData()
        Const W_SUBNAME As String = "NSK0000HA getAbsKinmuData"

        Dim w_Sql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_DataCnt As Integer
        Dim w_LoopCnt As Integer

        Try
            '配列初期化
            ReDim m_strAbsKinmuCD(0)
            w_DataCnt = 0
            'richard update start
            'w_Sql = ""
            'w_Sql = w_Sql & "SELECT "
            'w_Sql = w_Sql & "    ALLOCKBN, "
            'w_Sql = w_Sql & "    KINMUCD1, "
            'w_Sql = w_Sql & "    KINMUCD2 "
            'w_Sql = w_Sql & "FROM "
            'w_Sql = w_Sql & "    NS_KINMUPATTERN_F "
            'w_Sql = w_Sql & "WHERE "
            'w_Sql = w_Sql & "    HOSPITALCD = '" & General.g_strHospitalCD & "' AND "
            'w_Sql = w_Sql & "    KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' AND "
            'w_Sql = w_Sql & "    ALLOCKBN IN ('3', '4', '5') "
            'w_Sql = w_Sql & "ORDER BY "
            'w_Sql = w_Sql & "    SEQ "
            'w_Rs = General.paDBRecordSetOpen(w_Sql)
            Call NSK0000H_sql.select_NS_KEYBOARD_F_01(w_Rs) '<45>
            'richard update end

            With w_Rs
                If .RecordCount > 0 Then
                    'ﾃﾞｰﾀがある時
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()

                    '取得した件数分配列を拡張する
                    ReDim Preserve m_strAbsKinmuCD(w_DataCnt)

                    '取得した件数分ループする
                    For w_LoopCnt = 1 To w_DataCnt
                        m_strAbsKinmuCD(w_LoopCnt).AllocKbn = .Fields("ALLOCKBN").Value

                        ReDim m_strAbsKinmuCD(w_LoopCnt).KinmuCD(2)

                        For i As Integer = 1 To 2
                            m_strAbsKinmuCD(w_LoopCnt).KinmuCD(i) = General.paGetDbFieldVal(.Fields("KINMUCD" & i), String.Empty)
                        Next

                        .MoveNext()
                    Next w_LoopCnt
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '必須勤務チェック
    Private Sub Check_AbsoluteKinmu(ByVal p_DayCount As Integer)
        Const W_SUBNAME As String = "NSK0000HA Check_AbsoluteKinmu"
        Const W_MSG As String = "必須とする連続勤務を取得してください"

        Dim w_Var As Object
        Dim w_Var2 As Object
        Dim w_lngStaffCount As Integer
        Dim w_lngTargetDate As Integer
        Dim w_bolErrFlg As Boolean
        Dim w_bolMatchFlg As Boolean
        Dim w_Col4W As Integer
        Dim w_KinmuCD As String
        Dim w_Count As Integer
        Dim w_MaxCount As Integer
        Dim w_lngLoop As Integer
        Dim w_lngDataCnt As Integer
        Dim w_Loop As Integer
        Dim w_KinmuViewflg As Integer
        Dim w_objSpread As FpSpread
        Dim w_ErrStaffData() As ErrStaffData_Type
        Dim w_StDateFlg As Boolean
        Dim w_PreDate As Integer

        Try
            w_Var = sprSheet_M.Sheets(0).GetText(M_YYYYMMDDLabel_Row, p_DayCount)
            If w_Var = "" Then
                '日付が取得できないので処理抜け出し
                Exit Sub
            End If

            w_lngTargetDate = w_Var
            If IsDate(Format(Integer.Parse(w_Var), "0000/00/00")) = False Then
                '日付として判断できないので処理抜け出し
                Exit Sub
            End If

            '4週用列番号取得
            If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week AndAlso m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                If Get_Col_4W(w_Var, w_Col4W) = False Then
                    Exit Sub
                End If
            End If

            For w_Loop = 0 To 3
                If m_lstmnuKinmuView(w_Loop).Available = True Then
                    If m_lstmnuKinmuView(w_Loop).Checked = True Then
                        w_KinmuViewflg = w_Loop + 1
                        Exit For
                    End If
                End If
            Next w_Loop

            w_Count = 0
            ReDim m_ErrStaffData(0)

            w_MaxCount = (m_StaffRow.EndRow - m_StaffRow.StartRow + 1) / UBound(m_StaffData)

            '職員ごとにループ
            For w_lngStaffCount = m_StaffRow.StartRow To m_StaffRow.EndRow
                '計画期間初日？
                w_StDateFlg = (m_KeikakuKikan.KinmuDataStartCol = p_DayCount)

                If m_PlanType = BasNSK0000H.gePlanType.PlanType_Week And m_ViewFromTo = BasNSK0000H.geViewType.ViewType_Month Then
                    '4週/1ヶ月
                    w_objSpread = sprSheet_4W

                    '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                    w_Var = w_objSpread.Sheets(0).GetText(w_lngStaffCount, m_StaffZokusei(M_HairetuNo).SetCol_4W)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_Count = CInt(w_Var)
                        Else
                            '職員情報が取得できないので処理抜け出し
                            w_objSpread = Nothing
                            Exit Sub
                        End If
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_objSpread = Nothing
                        Exit Sub
                    End If
                Else
                    '4週/1ヶ月
                    w_objSpread = sprSheet_M

                    '該当行の職員ﾃﾞｰﾀ格納配列ｲﾝﾃﾞｯｸｽ取得
                    w_Var = w_objSpread.Sheets(0).GetText(w_lngStaffCount, m_StaffZokusei(M_HairetuNo).SetCol_M)
                    If w_Var <> "" Then
                        If IsNumeric(w_Var) = True Then
                            w_Count = CInt(w_Var)
                        Else
                            '職員情報が取得できないので処理抜け出し
                            w_objSpread = Nothing
                            Exit Sub
                        End If
                    Else
                        '職員情報が取得できないので処理抜け出し
                        w_objSpread = Nothing
                        Exit Sub
                    End If
                End If

StDate:
                '初期化
                ReDim w_ErrStaffData(0)
                w_lngLoop = 0
                w_bolErrFlg = False
                w_bolMatchFlg = False
                w_KinmuCD = ""

                If w_StDateFlg Then
                    '計画期間初日の場合、一度前日の勤務の判定処理を行っておく
                    w_PreDate = Format(Date.Parse(Format(w_lngTargetDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")

                    With General.g_objGetData
                        .p病院CD = General.g_strHospitalCD '施設コード
                        .p職員区分 = 0 '職員区分
                        .p職員番号 = m_StaffData(w_Count).ID '職員管理番号
                        .p勤務取得区分 = 1 '実績
                        .p日付区分 = 0 '日付区分
                        .p開始年月日 = w_PreDate '開始年月日
                        .p終了年月日 = w_PreDate '終了年月日
                        .p確定部署CD = ""

                        If .mGetkinmu Then
                            .p実績年月日 = w_PreDate
                            w_KinmuCD = .f実績勤務CD
                        End If
                    End With
                Else
                    '一段表示の場合か新規計画は一段だけを見る
                    If w_KinmuViewflg = 1 OrElse m_PgmFlg = General.G_PGMSTARTFLG_NEWPLAN Then
                        w_Var = sprSheet_M.Sheets(0).GetText(w_lngStaffCount, p_DayCount)
                        If w_Var <> "" Then
                            Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                        End If
                    Else
                        '二段目の勤務があるかどうかチェック
                        w_Var2 = sprSheet_M.Sheets(0).GetText(w_lngStaffCount + 1, p_DayCount)
                        If w_Var2 <> "" Then
                            '二段目の勤務がある場合は二段目の勤務を取得
                            Call Get_KinmuMark(w_Var2, w_KinmuCD, "", "", "", "", "")
                        Else
                            '一段目の勤務があるかどうかチェック
                            w_Var = sprSheet_M.Sheets(0).GetText(w_lngStaffCount, p_DayCount)
                            If w_Var <> "" Then
                                '一段目の勤務がない場合は一段目の勤務を取得
                                Call Get_KinmuMark(w_Var, w_KinmuCD, "", "", "", "", "")
                            End If
                        End If
                    End If
                End If

                For w_Loop = 1 To UBound(m_strAbsKinmuCD)
                    '対象のスプレッドに値が入っているか
                    If String.IsNullOrEmpty(w_KinmuCD) Then
                        If m_RenzokuCnt(w_Count, w_Loop) > 0 Then
                            '必須勤務判定の途中だった場合
                            If m_strAbsKinmuCD(w_Loop).AllocKbn <> "5" Then
                                '完全一致,前方一致
                                'エラー
                                w_lngLoop = w_lngLoop + 1
                                ReDim Preserve w_ErrStaffData(w_lngLoop)
                                w_ErrStaffData(w_lngLoop).StaffName = m_StaffData(w_Count).StaffName
                                w_ErrStaffData(w_lngLoop).Row = w_lngStaffCount
                                w_ErrStaffData(w_lngLoop).ErrorDate = w_lngTargetDate
                                If m_SelViewKikan = 0 Then
                                    w_ErrStaffData(w_lngLoop).Col = p_DayCount
                                Else
                                    w_ErrStaffData(w_lngLoop).Col = w_Col4W
                                End If

                                w_bolErrFlg = True
                            End If

                            '連続勤務カウントクリア
                            m_RenzokuCnt(w_Count, w_Loop) = 0
                        End If
                    Else
                        '必須勤務判定の対象かどうか
                        If m_strAbsKinmuCD(w_Loop).KinmuCD(m_RenzokuCnt(w_Count, w_Loop) + 1) = w_KinmuCD Then
                            '対象
                            '必須勤務判定が最後まで完了したか？
                            If m_RenzokuCnt(w_Count, w_Loop) = 1 Then
                                '完了
                                '連続勤務カウントクリア
                                m_RenzokuCnt(w_Count, w_Loop) = 0

                                '完全一致
                                w_bolMatchFlg = True
                            Else
                                '未完了
                                '連続勤務カウント加算
                                m_RenzokuCnt(w_Count, w_Loop) = m_RenzokuCnt(w_Count, w_Loop) + 1
                            End If
                        Else
                            '非対象
                            If m_RenzokuCnt(w_Count, w_Loop) > 0 Then
                                '必須勤務判定の途中だった場合
                                If m_strAbsKinmuCD(w_Loop).AllocKbn <> "5" Then
                                    '完全一致,前方一致
                                    'エラー
                                    w_lngLoop = w_lngLoop + 1
                                    ReDim Preserve w_ErrStaffData(w_lngLoop)
                                    w_ErrStaffData(w_lngLoop).StaffName = m_StaffData(w_Count).StaffName
                                    w_ErrStaffData(w_lngLoop).Row = w_lngStaffCount
                                    w_ErrStaffData(w_lngLoop).ErrorDate = w_lngTargetDate
                                    If m_SelViewKikan = 0 Then
                                        w_ErrStaffData(w_lngLoop).Col = p_DayCount
                                    Else
                                        w_ErrStaffData(w_lngLoop).Col = w_Col4W
                                    End If
                                    w_bolErrFlg = True
                                End If

                                '連続勤務カウントクリア
                                m_RenzokuCnt(w_Count, w_Loop) = 0
                            Else
                                '必須勤務の２番目の勤務からいきなり始まった場合
                                If m_strAbsKinmuCD(w_Loop).KinmuCD(2) = w_KinmuCD Then
                                    If m_strAbsKinmuCD(w_Loop).AllocKbn <> "4" Then
                                        '完全一致,後方一致
                                        'エラー
                                        w_lngLoop = w_lngLoop + 1
                                        ReDim Preserve w_ErrStaffData(w_lngLoop)
                                        w_ErrStaffData(w_lngLoop).StaffName = m_StaffData(w_Count).StaffName
                                        w_ErrStaffData(w_lngLoop).Row = w_lngStaffCount
                                        If Not w_StDateFlg AndAlso m_KeikakuKikan.KinmuDataStartCol = p_DayCount Then
                                            w_ErrStaffData(w_lngLoop).ErrorDate = w_lngTargetDate
                                            If m_SelViewKikan = 0 Then
                                                w_ErrStaffData(w_lngLoop).Col = p_DayCount
                                            Else
                                                w_ErrStaffData(w_lngLoop).Col = w_Col4W
                                            End If
                                        Else
                                            w_ErrStaffData(w_lngLoop).ErrorDate = Format(Date.Parse(Format(w_lngTargetDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")
                                            If m_SelViewKikan = 0 Then
                                                w_ErrStaffData(w_lngLoop).Col = p_DayCount - 1
                                            Else
                                                If Not Get_Col_4W(w_ErrStaffData(w_lngLoop).ErrorDate, w_ErrStaffData(w_lngLoop).Col) Then
                                                    Exit Sub
                                                End If
                                            End If
                                        End If

                                        w_bolErrFlg = True
                                    End If

                                    '連続勤務カウントクリア
                                    m_RenzokuCnt(w_Count, w_Loop) = 0
                                End If
                            End If
                        End If
                    End If
                Next w_Loop

                If w_StDateFlg Then
                    w_StDateFlg = False
                    GoTo stdate
                End If

                If w_bolErrFlg AndAlso Not w_bolMatchFlg Then
                    'エラー格納（１件のみ）
                    ReDim Preserve m_ErrStaffData(UBound(m_ErrStaffData) + 1)
                    m_ErrStaffData(UBound(m_ErrStaffData)) = w_ErrStaffData(1)
                End If

                w_lngStaffCount = w_lngStaffCount + (w_MaxCount - 1)
            Next w_lngStaffCount

            'エラーを格納
            For w_lngLoop = 1 To UBound(m_ErrStaffData)
                '配列確保
                w_lngDataCnt = UBound(g_NotAbsKinmuCheckError) + 1
                ReDim Preserve g_NotAbsKinmuCheckError(w_lngDataCnt)
                g_NotAbsKinmuCheckError(w_lngDataCnt).StaffName = m_ErrStaffData(w_lngLoop).StaffName
                g_NotAbsKinmuCheckError(w_lngDataCnt).StaffIdx = m_ErrStaffData(w_lngLoop).Row

                '配列確保
                ReDim Preserve g_NotAbsKinmuCheckError(w_lngDataCnt).Data(1)
                g_NotAbsKinmuCheckError(w_lngDataCnt).Data(1).ErrorFlg = True
                g_NotAbsKinmuCheckError(w_lngDataCnt).Data(1).ErrorDate = m_ErrStaffData(w_lngLoop).ErrorDate
                g_NotAbsKinmuCheckError(w_lngDataCnt).Data(1).ColIdx = m_ErrStaffData(w_lngLoop).Col
                g_NotAbsKinmuCheckError(w_lngDataCnt).Data(1).ErrorPattern = W_MSG
            Next w_lngLoop

        Catch ex As Exception
            Call General.paTrpMsg(Str(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Private Sub subGetResultCntData(ByVal p_StaffIdx As Integer)
        Const W_SUBNAME As String = "NSK0000HA subGetResultCntData"

        Dim w_CalcDate As Integer
        Dim w_StDate As Integer
        Dim w_EdDate As Integer
        Dim w_KinmuCD As String

        Try
            If UBound(m_StaffData(p_StaffIdx).ResultCnt) > 0 Then
                Exit Sub
            Else
                w_KinmuCD = w_KinmuCD
            End If

            ReDim m_StaffData(p_StaffIdx).ResultCnt(UBound(m_CheckHMtrx))

            w_EdDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-1), "yyyyMMdd")

            For i As Integer = 1 To UBound(m_CheckHMtrx)
                If m_CheckHMtrx(i).BunruiCD = "30" Then
                    w_CalcDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-m_StaffData(p_StaffIdx).KinmuCondition(i).RenkyuCountMax), "yyyyMMdd")
                Else
                    w_CalcDate = Format(Date.Parse(Format(m_KeikakuKikan.StartDate, "0000/00/00")).AddDays(-m_StaffData(p_StaffIdx).KinmuCondition(i).RenzokuCountMax), "yyyyMMdd")
                End If

                If w_StDate = 0 OrElse w_StDate > w_CalcDate Then
                    w_StDate = w_CalcDate
                End If
            Next

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD '施設コード
                .p職員区分 = 0 '職員区分
                .p職員番号 = m_StaffData(p_StaffIdx).ID '職員管理番号
                .p勤務取得区分 = 1 '実績
                .p日付区分 = 1 '日付区分
                .p開始年月日 = w_StDate '開始年月日
                .p終了年月日 = w_EdDate '終了年月日
                .p確定部署CD = ""

                If .mGetkinmu Then
                    .p実績年月日 = w_EdDate

                    For i As Integer = 1 To .f期間日数
                        w_KinmuCD = .f実績勤務CD

                        For j As Integer = 1 To UBound(m_CheckHMtrx)
                            If (m_CheckHMtrx(j).BunruiCD <> "30" AndAlso i > m_StaffData(p_StaffIdx).KinmuCondition(j).RenzokuCountMax) OrElse _
                                    (m_CheckHMtrx(j).BunruiCD = "30" AndAlso i > m_StaffData(p_StaffIdx).KinmuCondition(j).RenkyuCountMax) Then
                                Continue For
                            End If

                            If InStr(m_CheckHMtrx(j).CalcKinmuStr, w_KinmuCD) > 0 AndAlso Not String.IsNullOrEmpty(w_KinmuCD) Then
                                m_StaffData(p_StaffIdx).ResultCnt(j) = m_StaffData(p_StaffIdx).ResultCnt(j) + 1
                            Else
                                Continue For
                            End If
                        Next

                        .m前日実績()
                    Next
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Err.Number, W_SUBNAME)
            End
        End Try
    End Sub
End Class